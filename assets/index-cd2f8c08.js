var UG=Object.defineProperty;var NG=(n,e,t)=>e in n?UG(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var u=(n,e,t)=>(NG(n,typeof e!="symbol"?e+"":e,t),t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function t(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerPolicy&&(r.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?r.credentials="include":s.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(s){if(s.ep)return;s.ep=!0;const r=t(s);fetch(s.href,r)}})();let cL,yR=null;function mc(){return cL}function lL(n){if(n==null){console.warn("Oh no: someone tried registering a non-existend gltf-loader. When you see this log it might mean that needle-engine is being imported multiple times. Please check your project setup.");return}yR!==n&&(yR=n,cL=new n)}/**
 * @license
 * Copyright 2010-2023 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const qh="161dev",Eu={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},Tu={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},hL=0,VC=1,uL=2,zG=3,GG=0,tM=1,iM=2,Oa=3,Es=0,mn=1,Ai=2,rn=0,Th=1,cd=2,HC=3,QC=4,nM=5,Ah=100,dL=101,fL=102,jC=103,K0=104,pL=200,mL=201,gL=202,AL=203,Z0=204,$0=205,vL=206,yL=207,bL=208,_L=209,xL=210,wL=211,SL=212,CL=213,EL=214,sM=0,y_=1,Vg=2,ld=3,hp=4,b_=5,__=6,BA=7,DA=0,TL=1,ML=2,Fr=0,Hg=1,rM=2,IL=3,oM=4,RL=5,PL=6,WC="attached",BL="detached",x_=300,_l=301,Nh=302,Oo=303,up=304,Sp=306,Lo=1e3,ts=1001,hd=1002,Nt=1003,dp=1004,VG=1004,Zc=1005,HG=1005,St=1006,Wu=1007,QG=1007,kr=1008,jG=1008,gi=1009,DL=1010,OL=1011,w_=1012,aM=1013,ca=1014,Ji=1015,sn=1016,cM=1017,lM=1018,ul=1020,kL=1021,xi=1023,S_=1024,LL=1025,Mh=1026,zh=1027,tc=1028,hM=1029,Sh=1030,uM=1031,dM=1033,eg=33776,y0=33777,b0=33778,tg=33779,eb=35840,qC=35841,tb=35842,XC=35843,C_=36196,ib=37492,nb=37496,sb=37808,YC=37809,JC=37810,KC=37811,Qg=37812,ZC=37813,$C=37814,eE=37815,tE=37816,iE=37817,nE=37818,sE=37819,rE=37820,oE=37821,ig=36492,aE=36494,cE=36495,FL=36283,lE=36284,hE=36285,uE=36286,jg=2200,fM=2201,UL=2202,ud=2300,Gh=2301,_0=2302,Lu=2400,Fu=2401,Wg=2402,E_=2500,pM=2501,NL=0,mM=1,rb=2,OA=3e3,ac=3001,Ts=3200,T_=3201,Xh=0,zL=1,is="",zt="srgb",Ri="srgb-linear",kA="display-p3",Cp="display-p3-linear",qg="linear",Ui="srgb",Xg="rec709",Yg="p3",GL=0,hh=7680,VL=7681,HL=7682,QL=7683,jL=34055,WL=34056,qL=5386,dE=512,XL=513,YL=514,JL=515,KL=516,ZL=517,$L=518,ob=519,e2=512,t2=513,i2=514,gM=515,n2=516,s2=517,r2=518,o2=519,Jg=35044,Vs=35048,WG=35040,qG=35045,XG=35049,YG=35041,JG=35046,KG=35050,ZG=35042,$G="100",ab="300 es",cb=1035,ic=2e3,Kg=2001;class ls{addEventListener(e,t){this._listeners===void 0&&(this._listeners={});const i=this._listeners;i[e]===void 0&&(i[e]=[]),i[e].indexOf(t)===-1&&i[e].push(t)}hasEventListener(e,t){if(this._listeners===void 0)return!1;const i=this._listeners;return i[e]!==void 0&&i[e].indexOf(t)!==-1}removeEventListener(e,t){if(this._listeners===void 0)return;const s=this._listeners[e];if(s!==void 0){const r=s.indexOf(t);r!==-1&&s.splice(r,1)}}dispatchEvent(e){if(this._listeners===void 0)return;const i=this._listeners[e.type];if(i!==void 0){e.target=this;const s=i.slice(0);for(let r=0,o=s.length;r<o;r++)s[r].call(this,e);e.target=null}}}const Bs=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let bR=1234567;const qu=Math.PI/180,fp=180/Math.PI;function to(){const n=Math.random()*4294967295|0,e=Math.random()*4294967295|0,t=Math.random()*4294967295|0,i=Math.random()*4294967295|0;return(Bs[n&255]+Bs[n>>8&255]+Bs[n>>16&255]+Bs[n>>24&255]+"-"+Bs[e&255]+Bs[e>>8&255]+"-"+Bs[e>>16&15|64]+Bs[e>>24&255]+"-"+Bs[t&63|128]+Bs[t>>8&255]+"-"+Bs[t>>16&255]+Bs[t>>24&255]+Bs[i&255]+Bs[i>>8&255]+Bs[i>>16&255]+Bs[i>>24&255]).toLowerCase()}function pn(n,e,t){return Math.max(e,Math.min(t,n))}function AM(n,e){return(n%e+e)%e}function eV(n,e,t,i,s){return i+(n-e)*(s-i)/(t-e)}function tV(n,e,t){return n!==e?(t-n)/(e-n):0}function ng(n,e,t){return(1-t)*n+t*e}function iV(n,e,t,i){return ng(n,e,1-Math.exp(-t*i))}function nV(n,e=1){return e-Math.abs(AM(n,e*2)-e)}function sV(n,e,t){return n<=e?0:n>=t?1:(n=(n-e)/(t-e),n*n*(3-2*n))}function rV(n,e,t){return n<=e?0:n>=t?1:(n=(n-e)/(t-e),n*n*n*(n*(n*6-15)+10))}function oV(n,e){return n+Math.floor(Math.random()*(e-n+1))}function aV(n,e){return n+Math.random()*(e-n)}function cV(n){return n*(.5-Math.random())}function lV(n){n!==void 0&&(bR=n);let e=bR+=1831565813;return e=Math.imul(e^e>>>15,e|1),e^=e+Math.imul(e^e>>>7,e|61),((e^e>>>14)>>>0)/4294967296}function hV(n){return n*qu}function uV(n){return n*fp}function fE(n){return(n&n-1)===0&&n!==0}function dV(n){return Math.pow(2,Math.ceil(Math.log(n)/Math.LN2))}function lb(n){return Math.pow(2,Math.floor(Math.log(n)/Math.LN2))}function fV(n,e,t,i,s){const r=Math.cos,o=Math.sin,a=r(t/2),c=o(t/2),l=r((e+i)/2),h=o((e+i)/2),d=r((e-i)/2),f=o((e-i)/2),p=r((i-e)/2),m=o((i-e)/2);switch(s){case"XYX":n.set(a*h,c*d,c*f,a*l);break;case"YZY":n.set(c*f,a*h,c*d,a*l);break;case"ZXZ":n.set(c*d,c*f,a*h,a*l);break;case"XZX":n.set(a*h,c*m,c*p,a*l);break;case"YXY":n.set(c*p,a*h,c*m,a*l);break;case"ZYZ":n.set(c*m,c*p,a*h,a*l);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+s)}}function ur(n,e){switch(e.constructor){case Float32Array:return n;case Uint32Array:return n/4294967295;case Uint16Array:return n/65535;case Uint8Array:return n/255;case Int32Array:return Math.max(n/2147483647,-1);case Int16Array:return Math.max(n/32767,-1);case Int8Array:return Math.max(n/127,-1);default:throw new Error("Invalid component type.")}}function Vt(n,e){switch(e.constructor){case Float32Array:return n;case Uint32Array:return Math.round(n*4294967295);case Uint16Array:return Math.round(n*65535);case Uint8Array:return Math.round(n*255);case Int32Array:return Math.round(n*2147483647);case Int16Array:return Math.round(n*32767);case Int8Array:return Math.round(n*127);default:throw new Error("Invalid component type.")}}const Vn={DEG2RAD:qu,RAD2DEG:fp,generateUUID:to,clamp:pn,euclideanModulo:AM,mapLinear:eV,inverseLerp:tV,lerp:ng,damp:iV,pingpong:nV,smoothstep:sV,smootherstep:rV,randInt:oV,randFloat:aV,randFloatSpread:cV,seededRandom:lV,degToRad:hV,radToDeg:uV,isPowerOfTwo:fE,ceilPowerOfTwo:dV,floorPowerOfTwo:lb,setQuaternionFromProperEuler:fV,normalize:Vt,denormalize:ur};class ie{constructor(e=0,t=0){ie.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,i=this.y,s=e.elements;return this.x=s[0]*t+s[3]*i+s[6],this.y=s[1]*t+s[4]*i+s[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const i=this.dot(e)/t;return Math.acos(pn(i,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,i=this.y-e.y;return t*t+i*i}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const i=Math.cos(t),s=Math.sin(t),r=this.x-e.x,o=this.y-e.y;return this.x=r*i-o*s+e.x,this.y=r*s+o*i+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class Dt{constructor(e,t,i,s,r,o,a,c,l){Dt.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],e!==void 0&&this.set(e,t,i,s,r,o,a,c,l)}set(e,t,i,s,r,o,a,c,l){const h=this.elements;return h[0]=e,h[1]=s,h[2]=a,h[3]=t,h[4]=r,h[5]=c,h[6]=i,h[7]=o,h[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],this}extractBasis(e,t,i){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),i.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const i=e.elements,s=t.elements,r=this.elements,o=i[0],a=i[3],c=i[6],l=i[1],h=i[4],d=i[7],f=i[2],p=i[5],m=i[8],g=s[0],y=s[3],A=s[6],v=s[1],b=s[4],_=s[7],T=s[2],E=s[5],M=s[8];return r[0]=o*g+a*v+c*T,r[3]=o*y+a*b+c*E,r[6]=o*A+a*_+c*M,r[1]=l*g+h*v+d*T,r[4]=l*y+h*b+d*E,r[7]=l*A+h*_+d*M,r[2]=f*g+p*v+m*T,r[5]=f*y+p*b+m*E,r[8]=f*A+p*_+m*M,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],i=e[1],s=e[2],r=e[3],o=e[4],a=e[5],c=e[6],l=e[7],h=e[8];return t*o*h-t*a*l-i*r*h+i*a*c+s*r*l-s*o*c}invert(){const e=this.elements,t=e[0],i=e[1],s=e[2],r=e[3],o=e[4],a=e[5],c=e[6],l=e[7],h=e[8],d=h*o-a*l,f=a*c-h*r,p=l*r-o*c,m=t*d+i*f+s*p;if(m===0)return this.set(0,0,0,0,0,0,0,0,0);const g=1/m;return e[0]=d*g,e[1]=(s*l-h*i)*g,e[2]=(a*i-s*o)*g,e[3]=f*g,e[4]=(h*t-s*c)*g,e[5]=(s*r-a*t)*g,e[6]=p*g,e[7]=(i*c-l*t)*g,e[8]=(o*t-i*r)*g,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,i,s,r,o,a){const c=Math.cos(r),l=Math.sin(r);return this.set(i*c,i*l,-i*(c*o+l*a)+o+e,-s*l,s*c,-s*(-l*o+c*a)+a+t,0,0,1),this}scale(e,t){return this.premultiply(Cw.makeScale(e,t)),this}rotate(e){return this.premultiply(Cw.makeRotation(-e)),this}translate(e,t){return this.premultiply(Cw.makeTranslation(e,t)),this}makeTranslation(e,t){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,t,0,0,1),this}makeRotation(e){const t=Math.cos(e),i=Math.sin(e);return this.set(t,-i,0,i,t,0,0,0,1),this}makeScale(e,t){return this.set(e,0,0,0,t,0,0,0,1),this}equals(e){const t=this.elements,i=e.elements;for(let s=0;s<9;s++)if(t[s]!==i[s])return!1;return!0}fromArray(e,t=0){for(let i=0;i<9;i++)this.elements[i]=e[i+t];return this}toArray(e=[],t=0){const i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e}clone(){return new this.constructor().fromArray(this.elements)}}const Cw=new Dt;function a2(n){for(let e=n.length-1;e>=0;--e)if(n[e]>=65535)return!0;return!1}const pV={Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function Tf(n,e){return new pV[n](e)}function Zg(n){return document.createElementNS("http://www.w3.org/1999/xhtml",n)}function c2(){const n=Zg("canvas");return n.style.display="block",n}const _R={};function Xu(n){n in _R||(_R[n]=!0,console.warn(n))}const xR=new Dt().set(.8224621,.177538,0,.0331941,.9668058,0,.0170827,.0723974,.9105199),wR=new Dt().set(1.2249401,-.2249404,0,-.0420569,1.0420571,0,-.0196376,-.0786361,1.0982735),kv={[Ri]:{transfer:qg,primaries:Xg,toReference:n=>n,fromReference:n=>n},[zt]:{transfer:Ui,primaries:Xg,toReference:n=>n.convertSRGBToLinear(),fromReference:n=>n.convertLinearToSRGB()},[Cp]:{transfer:qg,primaries:Yg,toReference:n=>n.applyMatrix3(wR),fromReference:n=>n.applyMatrix3(xR)},[kA]:{transfer:Ui,primaries:Yg,toReference:n=>n.convertSRGBToLinear().applyMatrix3(wR),fromReference:n=>n.applyMatrix3(xR).convertLinearToSRGB()}},mV=new Set([Ri,Cp]),_i={enabled:!0,_workingColorSpace:Ri,get workingColorSpace(){return this._workingColorSpace},set workingColorSpace(n){if(!mV.has(n))throw new Error(`Unsupported working color space, "${n}".`);this._workingColorSpace=n},convert:function(n,e,t){if(this.enabled===!1||e===t||!e||!t)return n;const i=kv[e].toReference,s=kv[t].fromReference;return s(i(n))},fromWorkingColorSpace:function(n,e){return this.convert(n,this._workingColorSpace,e)},toWorkingColorSpace:function(n,e){return this.convert(n,e,this._workingColorSpace)},getPrimaries:function(n){return kv[n].primaries},getTransfer:function(n){return n===is?qg:kv[n].transfer}};function Zf(n){return n<.04045?n*.0773993808:Math.pow(n*.9478672986+.0521327014,2.4)}function Ew(n){return n<.0031308?n*12.92:1.055*Math.pow(n,.41666)-.055}let Nd;class vM{static getDataURL(e){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement>"u")return e.src;let t;if(e instanceof HTMLCanvasElement)t=e;else{Nd===void 0&&(Nd=Zg("canvas")),Nd.width=e.width,Nd.height=e.height;const i=Nd.getContext("2d");e instanceof ImageData?i.putImageData(e,0,0):i.drawImage(e,0,0,e.width,e.height),t=Nd}return t.width>2048||t.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),t.toDataURL("image/jpeg",.6)):t.toDataURL("image/png")}static sRGBToLinear(e){if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap){const t=Zg("canvas");t.width=e.width,t.height=e.height;const i=t.getContext("2d");i.drawImage(e,0,0,e.width,e.height);const s=i.getImageData(0,0,e.width,e.height),r=s.data;for(let o=0;o<r.length;o++)r[o]=Zf(r[o]/255)*255;return i.putImageData(s,0,0),t}else if(e.data){const t=e.data.slice(0);for(let i=0;i<t.length;i++)t instanceof Uint8Array||t instanceof Uint8ClampedArray?t[i]=Math.floor(Zf(t[i]/255)*255):t[i]=Zf(t[i]);return{data:t,width:e.width,height:e.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}let gV=0;class nl{constructor(e=null){this.isSource=!0,Object.defineProperty(this,"id",{value:gV++}),this.uuid=to(),this.data=e,this.version=0}set needsUpdate(e){e===!0&&this.version++}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.images[this.uuid]!==void 0)return e.images[this.uuid];const i={uuid:this.uuid,url:""},s=this.data;if(s!==null){let r;if(Array.isArray(s)){r=[];for(let o=0,a=s.length;o<a;o++)s[o].isDataTexture?r.push(Tw(s[o].image)):r.push(Tw(s[o]))}else r=Tw(s);i.url=r}return t||(e.images[this.uuid]=i),i}}function Tw(n){return typeof HTMLImageElement<"u"&&n instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&n instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&n instanceof ImageBitmap?vM.getDataURL(n):n.data?{data:Array.from(n.data),width:n.width,height:n.height,type:n.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let AV=0;class Ft extends ls{constructor(e=Ft.DEFAULT_IMAGE,t=Ft.DEFAULT_MAPPING,i=ts,s=ts,r=St,o=kr,a=xi,c=gi,l=Ft.DEFAULT_ANISOTROPY,h=is){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:AV++}),this.uuid=to(),this.name="",this.source=new nl(e),this.mipmaps=[],this.mapping=t,this.channel=0,this.wrapS=i,this.wrapT=s,this.magFilter=r,this.minFilter=o,this.anisotropy=l,this.format=a,this.internalFormat=null,this.type=c,this.offset=new ie(0,0),this.repeat=new ie(1,1),this.center=new ie(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Dt,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,typeof h=="string"?this.colorSpace=h:(Xu("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace=h===ac?zt:is),this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(e=null){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.channel=e.channel,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.colorSpace=e.colorSpace,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];const i={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(i.userData=this.userData),t||(e.textures[this.uuid]=i),i}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==x_)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case Lo:e.x=e.x-Math.floor(e.x);break;case ts:e.x=e.x<0?0:1;break;case hd:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x);break}if(e.y<0||e.y>1)switch(this.wrapT){case Lo:e.y=e.y-Math.floor(e.y);break;case ts:e.y=e.y<0?0:1;break;case hd:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y);break}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&(this.version++,this.source.needsUpdate=!0)}get encoding(){return Xu("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace===zt?ac:OA}set encoding(e){Xu("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace=e===ac?zt:is}}Ft.DEFAULT_IMAGE=null;Ft.DEFAULT_MAPPING=x_;Ft.DEFAULT_ANISOTROPY=1;class tt{constructor(e=0,t=0,i=0,s=1){tt.prototype.isVector4=!0,this.x=e,this.y=t,this.z=i,this.w=s}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,i,s){return this.x=e,this.y=t,this.z=i,this.w=s,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==void 0?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const t=this.x,i=this.y,s=this.z,r=this.w,o=e.elements;return this.x=o[0]*t+o[4]*i+o[8]*s+o[12]*r,this.y=o[1]*t+o[5]*i+o[9]*s+o[13]*r,this.z=o[2]*t+o[6]*i+o[10]*s+o[14]*r,this.w=o[3]*t+o[7]*i+o[11]*s+o[15]*r,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,i,s,r;const c=e.elements,l=c[0],h=c[4],d=c[8],f=c[1],p=c[5],m=c[9],g=c[2],y=c[6],A=c[10];if(Math.abs(h-f)<.01&&Math.abs(d-g)<.01&&Math.abs(m-y)<.01){if(Math.abs(h+f)<.1&&Math.abs(d+g)<.1&&Math.abs(m+y)<.1&&Math.abs(l+p+A-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;const b=(l+1)/2,_=(p+1)/2,T=(A+1)/2,E=(h+f)/4,M=(d+g)/4,I=(m+y)/4;return b>_&&b>T?b<.01?(i=0,s=.707106781,r=.707106781):(i=Math.sqrt(b),s=E/i,r=M/i):_>T?_<.01?(i=.707106781,s=0,r=.707106781):(s=Math.sqrt(_),i=E/s,r=I/s):T<.01?(i=.707106781,s=.707106781,r=0):(r=Math.sqrt(T),i=M/r,s=I/r),this.set(i,s,r,t),this}let v=Math.sqrt((y-m)*(y-m)+(d-g)*(d-g)+(f-h)*(f-h));return Math.abs(v)<.001&&(v=1),this.x=(y-m)/v,this.y=(d-g)/v,this.z=(f-h)/v,this.w=Math.acos((l+p+A-1)/2),this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this.z=e.z+(t.z-e.z)*i,this.w=e.w+(t.w-e.w)*i,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class l2 extends ls{constructor(e=1,t=1,i={}){super(),this.isRenderTarget=!0,this.width=e,this.height=t,this.depth=1,this.scissor=new tt(0,0,e,t),this.scissorTest=!1,this.viewport=new tt(0,0,e,t);const s={width:e,height:t,depth:1};i.encoding!==void 0&&(Xu("THREE.WebGLRenderTarget: option.encoding has been replaced by option.colorSpace."),i.colorSpace=i.encoding===ac?zt:is),i=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:St,depthBuffer:!0,stencilBuffer:!1,depthTexture:null,samples:0},i),this.texture=new Ft(s,i.mapping,i.wrapS,i.wrapT,i.magFilter,i.minFilter,i.format,i.type,i.anisotropy,i.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.flipY=!1,this.texture.generateMipmaps=i.generateMipmaps,this.texture.internalFormat=i.internalFormat,this.depthBuffer=i.depthBuffer,this.stencilBuffer=i.stencilBuffer,this.depthTexture=i.depthTexture,this.samples=i.samples}setSize(e,t,i=1){(this.width!==e||this.height!==t||this.depth!==i)&&(this.width=e,this.height=t,this.depth=i,this.texture.image.width=e,this.texture.image.height=t,this.texture.image.depth=i,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return new this.constructor().copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.scissor.copy(e.scissor),this.scissorTest=e.scissorTest,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.texture.isRenderTargetTexture=!0;const t=Object.assign({},e.texture.image);return this.texture.source=new nl(t),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,e.depthTexture!==null&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class Zt extends l2{constructor(e=1,t=1,i={}){super(e,t,i),this.isWebGLRenderTarget=!0}}class M_ extends Ft{constructor(e=null,t=1,i=1,s=1){super(null),this.isDataArrayTexture=!0,this.image={data:e,width:t,height:i,depth:s},this.magFilter=Nt,this.minFilter=Nt,this.wrapR=ts,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class vV extends Zt{constructor(e=1,t=1,i=1,s={}){super(e,t,s),this.isWebGLArrayRenderTarget=!0,this.depth=i,this.texture=new M_(null,e,t,i),this.texture.isRenderTargetTexture=!0}}class I_ extends Ft{constructor(e=null,t=1,i=1,s=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:t,height:i,depth:s},this.magFilter=Nt,this.minFilter=Nt,this.wrapR=ts,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class yV extends Zt{constructor(e=1,t=1,i=1,s={}){super(e,t,s),this.isWebGL3DRenderTarget=!0,this.depth=i,this.texture=new I_(null,e,t,i),this.texture.isRenderTargetTexture=!0}}class h2 extends Zt{constructor(e=1,t=1,i=1,s={}){super(e,t,s),this.isWebGLMultipleRenderTargets=!0;const r=this.texture;this.texture=[];for(let o=0;o<i;o++)this.texture[o]=r.clone(),this.texture[o].isRenderTargetTexture=!0}setSize(e,t,i=1){if(this.width!==e||this.height!==t||this.depth!==i){this.width=e,this.height=t,this.depth=i;for(let s=0,r=this.texture.length;s<r;s++)this.texture[s].image.width=e,this.texture[s].image.height=t,this.texture[s].image.depth=i;this.dispose()}this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}copy(e){this.dispose(),this.width=e.width,this.height=e.height,this.depth=e.depth,this.scissor.copy(e.scissor),this.scissorTest=e.scissorTest,this.viewport.copy(e.viewport),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,e.depthTexture!==null&&(this.depthTexture=e.depthTexture.clone()),this.texture.length=0;for(let t=0,i=e.texture.length;t<i;t++)this.texture[t]=e.texture[t].clone(),this.texture[t].isRenderTargetTexture=!0;return this}}class Me{constructor(e=0,t=0,i=0,s=1){this.isQuaternion=!0,this._x=e,this._y=t,this._z=i,this._w=s}static slerpFlat(e,t,i,s,r,o,a){let c=i[s+0],l=i[s+1],h=i[s+2],d=i[s+3];const f=r[o+0],p=r[o+1],m=r[o+2],g=r[o+3];if(a===0){e[t+0]=c,e[t+1]=l,e[t+2]=h,e[t+3]=d;return}if(a===1){e[t+0]=f,e[t+1]=p,e[t+2]=m,e[t+3]=g;return}if(d!==g||c!==f||l!==p||h!==m){let y=1-a;const A=c*f+l*p+h*m+d*g,v=A>=0?1:-1,b=1-A*A;if(b>Number.EPSILON){const T=Math.sqrt(b),E=Math.atan2(T,A*v);y=Math.sin(y*E)/T,a=Math.sin(a*E)/T}const _=a*v;if(c=c*y+f*_,l=l*y+p*_,h=h*y+m*_,d=d*y+g*_,y===1-a){const T=1/Math.sqrt(c*c+l*l+h*h+d*d);c*=T,l*=T,h*=T,d*=T}}e[t]=c,e[t+1]=l,e[t+2]=h,e[t+3]=d}static multiplyQuaternionsFlat(e,t,i,s,r,o){const a=i[s],c=i[s+1],l=i[s+2],h=i[s+3],d=r[o],f=r[o+1],p=r[o+2],m=r[o+3];return e[t]=a*m+h*d+c*p-l*f,e[t+1]=c*m+h*f+l*d-a*p,e[t+2]=l*m+h*p+a*f-c*d,e[t+3]=h*m-a*d-c*f-l*p,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,i,s){return this._x=e,this._y=t,this._z=i,this._w=s,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t=!0){const i=e._x,s=e._y,r=e._z,o=e._order,a=Math.cos,c=Math.sin,l=a(i/2),h=a(s/2),d=a(r/2),f=c(i/2),p=c(s/2),m=c(r/2);switch(o){case"XYZ":this._x=f*h*d+l*p*m,this._y=l*p*d-f*h*m,this._z=l*h*m+f*p*d,this._w=l*h*d-f*p*m;break;case"YXZ":this._x=f*h*d+l*p*m,this._y=l*p*d-f*h*m,this._z=l*h*m-f*p*d,this._w=l*h*d+f*p*m;break;case"ZXY":this._x=f*h*d-l*p*m,this._y=l*p*d+f*h*m,this._z=l*h*m+f*p*d,this._w=l*h*d-f*p*m;break;case"ZYX":this._x=f*h*d-l*p*m,this._y=l*p*d+f*h*m,this._z=l*h*m-f*p*d,this._w=l*h*d+f*p*m;break;case"YZX":this._x=f*h*d+l*p*m,this._y=l*p*d+f*h*m,this._z=l*h*m-f*p*d,this._w=l*h*d-f*p*m;break;case"XZY":this._x=f*h*d-l*p*m,this._y=l*p*d-f*h*m,this._z=l*h*m+f*p*d,this._w=l*h*d+f*p*m;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+o)}return t===!0&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const i=t/2,s=Math.sin(i);return this._x=e.x*s,this._y=e.y*s,this._z=e.z*s,this._w=Math.cos(i),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,i=t[0],s=t[4],r=t[8],o=t[1],a=t[5],c=t[9],l=t[2],h=t[6],d=t[10],f=i+a+d;if(f>0){const p=.5/Math.sqrt(f+1);this._w=.25/p,this._x=(h-c)*p,this._y=(r-l)*p,this._z=(o-s)*p}else if(i>a&&i>d){const p=2*Math.sqrt(1+i-a-d);this._w=(h-c)/p,this._x=.25*p,this._y=(s+o)/p,this._z=(r+l)/p}else if(a>d){const p=2*Math.sqrt(1+a-i-d);this._w=(r-l)/p,this._x=(s+o)/p,this._y=.25*p,this._z=(c+h)/p}else{const p=2*Math.sqrt(1+d-i-a);this._w=(o-s)/p,this._x=(r+l)/p,this._y=(c+h)/p,this._z=.25*p}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let i=e.dot(t)+1;return i<Number.EPSILON?(i=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=i):(this._x=0,this._y=-e.z,this._z=e.y,this._w=i)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=i),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(pn(this.dot(e),-1,1)))}rotateTowards(e,t){const i=this.angleTo(e);if(i===0)return this;const s=Math.min(1,t/i);return this.slerp(e,s),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const i=e._x,s=e._y,r=e._z,o=e._w,a=t._x,c=t._y,l=t._z,h=t._w;return this._x=i*h+o*a+s*l-r*c,this._y=s*h+o*c+r*a-i*l,this._z=r*h+o*l+i*c-s*a,this._w=o*h-i*a-s*c-r*l,this._onChangeCallback(),this}slerp(e,t){if(t===0)return this;if(t===1)return this.copy(e);const i=this._x,s=this._y,r=this._z,o=this._w;let a=o*e._w+i*e._x+s*e._y+r*e._z;if(a<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,a=-a):this.copy(e),a>=1)return this._w=o,this._x=i,this._y=s,this._z=r,this;const c=1-a*a;if(c<=Number.EPSILON){const p=1-t;return this._w=p*o+t*this._w,this._x=p*i+t*this._x,this._y=p*s+t*this._y,this._z=p*r+t*this._z,this.normalize(),this}const l=Math.sqrt(c),h=Math.atan2(l,a),d=Math.sin((1-t)*h)/l,f=Math.sin(t*h)/l;return this._w=o*d+this._w*f,this._x=i*d+this._x*f,this._y=s*d+this._y*f,this._z=r*d+this._z*f,this._onChangeCallback(),this}slerpQuaternions(e,t,i){return this.copy(e).slerp(t,i)}random(){const e=Math.random(),t=Math.sqrt(1-e),i=Math.sqrt(e),s=2*Math.PI*Math.random(),r=2*Math.PI*Math.random();return this.set(t*Math.cos(s),i*Math.sin(r),i*Math.cos(r),t*Math.sin(s))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class w{constructor(e=0,t=0,i=0){w.prototype.isVector3=!0,this.x=e,this.y=t,this.z=i}set(e,t,i){return i===void 0&&(i=this.z),this.x=e,this.y=t,this.z=i,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion(SR.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(SR.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,i=this.y,s=this.z,r=e.elements;return this.x=r[0]*t+r[3]*i+r[6]*s,this.y=r[1]*t+r[4]*i+r[7]*s,this.z=r[2]*t+r[5]*i+r[8]*s,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,i=this.y,s=this.z,r=e.elements,o=1/(r[3]*t+r[7]*i+r[11]*s+r[15]);return this.x=(r[0]*t+r[4]*i+r[8]*s+r[12])*o,this.y=(r[1]*t+r[5]*i+r[9]*s+r[13])*o,this.z=(r[2]*t+r[6]*i+r[10]*s+r[14])*o,this}applyQuaternion(e){const t=this.x,i=this.y,s=this.z,r=e.x,o=e.y,a=e.z,c=e.w,l=2*(o*s-a*i),h=2*(a*t-r*s),d=2*(r*i-o*t);return this.x=t+c*l+o*d-a*h,this.y=i+c*h+a*l-r*d,this.z=s+c*d+r*h-o*l,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,i=this.y,s=this.z,r=e.elements;return this.x=r[0]*t+r[4]*i+r[8]*s,this.y=r[1]*t+r[5]*i+r[9]*s,this.z=r[2]*t+r[6]*i+r[10]*s,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this.z=e.z+(t.z-e.z)*i,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){const i=e.x,s=e.y,r=e.z,o=t.x,a=t.y,c=t.z;return this.x=s*c-r*a,this.y=r*o-i*c,this.z=i*a-s*o,this}projectOnVector(e){const t=e.lengthSq();if(t===0)return this.set(0,0,0);const i=e.dot(this)/t;return this.copy(e).multiplyScalar(i)}projectOnPlane(e){return Mw.copy(this).projectOnVector(e),this.sub(Mw)}reflect(e){return this.sub(Mw.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const i=this.dot(e)/t;return Math.acos(pn(i,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,i=this.y-e.y,s=this.z-e.z;return t*t+i*i+s*s}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,i){const s=Math.sin(t)*e;return this.x=s*Math.sin(i),this.y=Math.cos(t)*e,this.z=s*Math.cos(i),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,i){return this.x=e*Math.sin(t),this.y=i,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),i=this.setFromMatrixColumn(e,1).length(),s=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=i,this.z=s,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,t*4)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,t*3)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=(Math.random()-.5)*2,t=Math.random()*Math.PI*2,i=Math.sqrt(1-e**2);return this.x=i*Math.cos(t),this.y=i*Math.sin(t),this.z=e,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const Mw=new w,SR=new Me;class Mi{constructor(e=new w(1/0,1/0,1/0),t=new w(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){this.makeEmpty();for(let t=0,i=e.length;t<i;t+=3)this.expandByPoint(jo.fromArray(e,t));return this}setFromBufferAttribute(e){this.makeEmpty();for(let t=0,i=e.count;t<i;t++)this.expandByPoint(jo.fromBufferAttribute(e,t));return this}setFromPoints(e){this.makeEmpty();for(let t=0,i=e.length;t<i;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const i=jo.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(i),this.max.copy(e).add(i),this}setFromObject(e,t=!1){return this.makeEmpty(),this.expandByObject(e,t)}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,t=!1){e.updateWorldMatrix(!1,!1);const i=e.geometry;if(i!==void 0){const r=i.getAttribute("position");if(t===!0&&r!==void 0&&e.isInstancedMesh!==!0)for(let o=0,a=r.count;o<a;o++)e.isMesh===!0?e.getVertexPosition(o,jo):jo.fromBufferAttribute(r,o),jo.applyMatrix4(e.matrixWorld),this.expandByPoint(jo);else e.boundingBox!==void 0?(e.boundingBox===null&&e.computeBoundingBox(),Lv.copy(e.boundingBox)):(i.boundingBox===null&&i.computeBoundingBox(),Lv.copy(i.boundingBox)),Lv.applyMatrix4(e.matrixWorld),this.union(Lv)}const s=e.children;for(let r=0,o=s.length;r<o;r++)this.expandByObject(s[r],t);return this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}intersectsSphere(e){return this.clampPoint(e.center,jo),jo.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,i;return e.normal.x>0?(t=e.normal.x*this.min.x,i=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,i=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,i+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,i+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,i+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,i+=e.normal.z*this.min.z),t<=-e.constant&&i>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(cm),Fv.subVectors(this.max,cm),zd.subVectors(e.a,cm),Gd.subVectors(e.b,cm),Vd.subVectors(e.c,cm),Ql.subVectors(Gd,zd),jl.subVectors(Vd,Gd),ou.subVectors(zd,Vd);let t=[0,-Ql.z,Ql.y,0,-jl.z,jl.y,0,-ou.z,ou.y,Ql.z,0,-Ql.x,jl.z,0,-jl.x,ou.z,0,-ou.x,-Ql.y,Ql.x,0,-jl.y,jl.x,0,-ou.y,ou.x,0];return!Iw(t,zd,Gd,Vd,Fv)||(t=[1,0,0,0,1,0,0,0,1],!Iw(t,zd,Gd,Vd,Fv))?!1:(Uv.crossVectors(Ql,jl),t=[Uv.x,Uv.y,Uv.z],Iw(t,zd,Gd,Vd,Fv))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,jo).distanceTo(e)}getBoundingSphere(e){return this.isEmpty()?e.makeEmpty():(this.getCenter(e.center),e.radius=this.getSize(jo).length()*.5),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()?this:(Ic[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),Ic[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),Ic[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),Ic[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),Ic[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),Ic[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),Ic[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),Ic[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(Ic),this)}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const Ic=[new w,new w,new w,new w,new w,new w,new w,new w],jo=new w,Lv=new Mi,zd=new w,Gd=new w,Vd=new w,Ql=new w,jl=new w,ou=new w,cm=new w,Fv=new w,Uv=new w,au=new w;function Iw(n,e,t,i,s){for(let r=0,o=n.length-3;r<=o;r+=3){au.fromArray(n,r);const a=s.x*Math.abs(au.x)+s.y*Math.abs(au.y)+s.z*Math.abs(au.z),c=e.dot(au),l=t.dot(au),h=i.dot(au);if(Math.max(-Math.max(c,l,h),Math.min(c,l,h))>a)return!1}return!0}const bV=new Mi,lm=new w,Rw=new w;class Mn{constructor(e=new w,t=-1){this.isSphere=!0,this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){const i=this.center;t!==void 0?i.copy(t):bV.setFromPoints(e).getCenter(i);let s=0;for(let r=0,o=e.length;r<o;r++)s=Math.max(s,i.distanceToSquared(e[r]));return this.radius=Math.sqrt(s),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){const i=this.center.distanceToSquared(e);return t.copy(e),i>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;lm.subVectors(e,this.center);const t=lm.lengthSq();if(t>this.radius*this.radius){const i=Math.sqrt(t),s=(i-this.radius)*.5;this.center.addScaledVector(lm,s/i),this.radius+=s}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(this.center.equals(e.center)===!0?this.radius=Math.max(this.radius,e.radius):(Rw.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(lm.copy(e.center).add(Rw)),this.expandByPoint(lm.copy(e.center).sub(Rw))),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return new this.constructor().copy(this)}}const Rc=new w,Pw=new w,Nv=new w,Wl=new w,Bw=new w,zv=new w,Dw=new w;class ro{constructor(e=new w,t=new w(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.origin).addScaledVector(this.direction,e)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,Rc)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);const i=t.dot(this.direction);return i<0?t.copy(this.origin):t.copy(this.origin).addScaledVector(this.direction,i)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const t=Rc.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(Rc.copy(this.origin).addScaledVector(this.direction,t),Rc.distanceToSquared(e))}distanceSqToSegment(e,t,i,s){Pw.copy(e).add(t).multiplyScalar(.5),Nv.copy(t).sub(e).normalize(),Wl.copy(this.origin).sub(Pw);const r=e.distanceTo(t)*.5,o=-this.direction.dot(Nv),a=Wl.dot(this.direction),c=-Wl.dot(Nv),l=Wl.lengthSq(),h=Math.abs(1-o*o);let d,f,p,m;if(h>0)if(d=o*c-a,f=o*a-c,m=r*h,d>=0)if(f>=-m)if(f<=m){const g=1/h;d*=g,f*=g,p=d*(d+o*f+2*a)+f*(o*d+f+2*c)+l}else f=r,d=Math.max(0,-(o*f+a)),p=-d*d+f*(f+2*c)+l;else f=-r,d=Math.max(0,-(o*f+a)),p=-d*d+f*(f+2*c)+l;else f<=-m?(d=Math.max(0,-(-o*r+a)),f=d>0?-r:Math.min(Math.max(-r,-c),r),p=-d*d+f*(f+2*c)+l):f<=m?(d=0,f=Math.min(Math.max(-r,-c),r),p=f*(f+2*c)+l):(d=Math.max(0,-(o*r+a)),f=d>0?r:Math.min(Math.max(-r,-c),r),p=-d*d+f*(f+2*c)+l);else f=o>0?-r:r,d=Math.max(0,-(o*f+a)),p=-d*d+f*(f+2*c)+l;return i&&i.copy(this.origin).addScaledVector(this.direction,d),s&&s.copy(Pw).addScaledVector(Nv,f),p}intersectSphere(e,t){Rc.subVectors(e.center,this.origin);const i=Rc.dot(this.direction),s=Rc.dot(Rc)-i*i,r=e.radius*e.radius;if(s>r)return null;const o=Math.sqrt(r-s),a=i-o,c=i+o;return c<0?null:a<0?this.at(c,t):this.at(a,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const t=e.normal.dot(this.direction);if(t===0)return e.distanceToPoint(this.origin)===0?0:null;const i=-(this.origin.dot(e.normal)+e.constant)/t;return i>=0?i:null}intersectPlane(e,t){const i=this.distanceToPlane(e);return i===null?null:this.at(i,t)}intersectsPlane(e){const t=e.distanceToPoint(this.origin);return t===0||e.normal.dot(this.direction)*t<0}intersectBox(e,t){let i,s,r,o,a,c;const l=1/this.direction.x,h=1/this.direction.y,d=1/this.direction.z,f=this.origin;return l>=0?(i=(e.min.x-f.x)*l,s=(e.max.x-f.x)*l):(i=(e.max.x-f.x)*l,s=(e.min.x-f.x)*l),h>=0?(r=(e.min.y-f.y)*h,o=(e.max.y-f.y)*h):(r=(e.max.y-f.y)*h,o=(e.min.y-f.y)*h),i>o||r>s||((r>i||isNaN(i))&&(i=r),(o<s||isNaN(s))&&(s=o),d>=0?(a=(e.min.z-f.z)*d,c=(e.max.z-f.z)*d):(a=(e.max.z-f.z)*d,c=(e.min.z-f.z)*d),i>c||a>s)||((a>i||i!==i)&&(i=a),(c<s||s!==s)&&(s=c),s<0)?null:this.at(i>=0?i:s,t)}intersectsBox(e){return this.intersectBox(e,Rc)!==null}intersectTriangle(e,t,i,s,r){Bw.subVectors(t,e),zv.subVectors(i,e),Dw.crossVectors(Bw,zv);let o=this.direction.dot(Dw),a;if(o>0){if(s)return null;a=1}else if(o<0)a=-1,o=-o;else return null;Wl.subVectors(this.origin,e);const c=a*this.direction.dot(zv.crossVectors(Wl,zv));if(c<0)return null;const l=a*this.direction.dot(Bw.cross(Wl));if(l<0||c+l>o)return null;const h=-a*Wl.dot(Dw);return h<0?null:this.at(h/o,r)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}class Ce{constructor(e,t,i,s,r,o,a,c,l,h,d,f,p,m,g,y){Ce.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],e!==void 0&&this.set(e,t,i,s,r,o,a,c,l,h,d,f,p,m,g,y)}set(e,t,i,s,r,o,a,c,l,h,d,f,p,m,g,y){const A=this.elements;return A[0]=e,A[4]=t,A[8]=i,A[12]=s,A[1]=r,A[5]=o,A[9]=a,A[13]=c,A[2]=l,A[6]=h,A[10]=d,A[14]=f,A[3]=p,A[7]=m,A[11]=g,A[15]=y,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new Ce().fromArray(this.elements)}copy(e){const t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],t[9]=i[9],t[10]=i[10],t[11]=i[11],t[12]=i[12],t[13]=i[13],t[14]=i[14],t[15]=i[15],this}copyPosition(e){const t=this.elements,i=e.elements;return t[12]=i[12],t[13]=i[13],t[14]=i[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,i){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),i.setFromMatrixColumn(this,2),this}makeBasis(e,t,i){return this.set(e.x,t.x,i.x,0,e.y,t.y,i.y,0,e.z,t.z,i.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements,i=e.elements,s=1/Hd.setFromMatrixColumn(e,0).length(),r=1/Hd.setFromMatrixColumn(e,1).length(),o=1/Hd.setFromMatrixColumn(e,2).length();return t[0]=i[0]*s,t[1]=i[1]*s,t[2]=i[2]*s,t[3]=0,t[4]=i[4]*r,t[5]=i[5]*r,t[6]=i[6]*r,t[7]=0,t[8]=i[8]*o,t[9]=i[9]*o,t[10]=i[10]*o,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){const t=this.elements,i=e.x,s=e.y,r=e.z,o=Math.cos(i),a=Math.sin(i),c=Math.cos(s),l=Math.sin(s),h=Math.cos(r),d=Math.sin(r);if(e.order==="XYZ"){const f=o*h,p=o*d,m=a*h,g=a*d;t[0]=c*h,t[4]=-c*d,t[8]=l,t[1]=p+m*l,t[5]=f-g*l,t[9]=-a*c,t[2]=g-f*l,t[6]=m+p*l,t[10]=o*c}else if(e.order==="YXZ"){const f=c*h,p=c*d,m=l*h,g=l*d;t[0]=f+g*a,t[4]=m*a-p,t[8]=o*l,t[1]=o*d,t[5]=o*h,t[9]=-a,t[2]=p*a-m,t[6]=g+f*a,t[10]=o*c}else if(e.order==="ZXY"){const f=c*h,p=c*d,m=l*h,g=l*d;t[0]=f-g*a,t[4]=-o*d,t[8]=m+p*a,t[1]=p+m*a,t[5]=o*h,t[9]=g-f*a,t[2]=-o*l,t[6]=a,t[10]=o*c}else if(e.order==="ZYX"){const f=o*h,p=o*d,m=a*h,g=a*d;t[0]=c*h,t[4]=m*l-p,t[8]=f*l+g,t[1]=c*d,t[5]=g*l+f,t[9]=p*l-m,t[2]=-l,t[6]=a*c,t[10]=o*c}else if(e.order==="YZX"){const f=o*c,p=o*l,m=a*c,g=a*l;t[0]=c*h,t[4]=g-f*d,t[8]=m*d+p,t[1]=d,t[5]=o*h,t[9]=-a*h,t[2]=-l*h,t[6]=p*d+m,t[10]=f-g*d}else if(e.order==="XZY"){const f=o*c,p=o*l,m=a*c,g=a*l;t[0]=c*h,t[4]=-d,t[8]=l*h,t[1]=f*d+g,t[5]=o*h,t[9]=p*d-m,t[2]=m*d-p,t[6]=a*h,t[10]=g*d+f}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(_V,e,xV)}lookAt(e,t,i){const s=this.elements;return Hr.subVectors(e,t),Hr.lengthSq()===0&&(Hr.z=1),Hr.normalize(),ql.crossVectors(i,Hr),ql.lengthSq()===0&&(Math.abs(i.z)===1?Hr.x+=1e-4:Hr.z+=1e-4,Hr.normalize(),ql.crossVectors(i,Hr)),ql.normalize(),Gv.crossVectors(Hr,ql),s[0]=ql.x,s[4]=Gv.x,s[8]=Hr.x,s[1]=ql.y,s[5]=Gv.y,s[9]=Hr.y,s[2]=ql.z,s[6]=Gv.z,s[10]=Hr.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const i=e.elements,s=t.elements,r=this.elements,o=i[0],a=i[4],c=i[8],l=i[12],h=i[1],d=i[5],f=i[9],p=i[13],m=i[2],g=i[6],y=i[10],A=i[14],v=i[3],b=i[7],_=i[11],T=i[15],E=s[0],M=s[4],I=s[8],S=s[12],C=s[1],D=s[5],G=s[9],Q=s[13],L=s[2],V=s[6],O=s[10],U=s[14],H=s[3],Y=s[7],J=s[11],se=s[15];return r[0]=o*E+a*C+c*L+l*H,r[4]=o*M+a*D+c*V+l*Y,r[8]=o*I+a*G+c*O+l*J,r[12]=o*S+a*Q+c*U+l*se,r[1]=h*E+d*C+f*L+p*H,r[5]=h*M+d*D+f*V+p*Y,r[9]=h*I+d*G+f*O+p*J,r[13]=h*S+d*Q+f*U+p*se,r[2]=m*E+g*C+y*L+A*H,r[6]=m*M+g*D+y*V+A*Y,r[10]=m*I+g*G+y*O+A*J,r[14]=m*S+g*Q+y*U+A*se,r[3]=v*E+b*C+_*L+T*H,r[7]=v*M+b*D+_*V+T*Y,r[11]=v*I+b*G+_*O+T*J,r[15]=v*S+b*Q+_*U+T*se,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],i=e[4],s=e[8],r=e[12],o=e[1],a=e[5],c=e[9],l=e[13],h=e[2],d=e[6],f=e[10],p=e[14],m=e[3],g=e[7],y=e[11],A=e[15];return m*(+r*c*d-s*l*d-r*a*f+i*l*f+s*a*p-i*c*p)+g*(+t*c*p-t*l*f+r*o*f-s*o*p+s*l*h-r*c*h)+y*(+t*l*d-t*a*p-r*o*d+i*o*p+r*a*h-i*l*h)+A*(-s*a*h-t*c*d+t*a*f+s*o*d-i*o*f+i*c*h)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,i){const s=this.elements;return e.isVector3?(s[12]=e.x,s[13]=e.y,s[14]=e.z):(s[12]=e,s[13]=t,s[14]=i),this}invert(){const e=this.elements,t=e[0],i=e[1],s=e[2],r=e[3],o=e[4],a=e[5],c=e[6],l=e[7],h=e[8],d=e[9],f=e[10],p=e[11],m=e[12],g=e[13],y=e[14],A=e[15],v=d*y*l-g*f*l+g*c*p-a*y*p-d*c*A+a*f*A,b=m*f*l-h*y*l-m*c*p+o*y*p+h*c*A-o*f*A,_=h*g*l-m*d*l+m*a*p-o*g*p-h*a*A+o*d*A,T=m*d*c-h*g*c-m*a*f+o*g*f+h*a*y-o*d*y,E=t*v+i*b+s*_+r*T;if(E===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const M=1/E;return e[0]=v*M,e[1]=(g*f*r-d*y*r-g*s*p+i*y*p+d*s*A-i*f*A)*M,e[2]=(a*y*r-g*c*r+g*s*l-i*y*l-a*s*A+i*c*A)*M,e[3]=(d*c*r-a*f*r-d*s*l+i*f*l+a*s*p-i*c*p)*M,e[4]=b*M,e[5]=(h*y*r-m*f*r+m*s*p-t*y*p-h*s*A+t*f*A)*M,e[6]=(m*c*r-o*y*r-m*s*l+t*y*l+o*s*A-t*c*A)*M,e[7]=(o*f*r-h*c*r+h*s*l-t*f*l-o*s*p+t*c*p)*M,e[8]=_*M,e[9]=(m*d*r-h*g*r-m*i*p+t*g*p+h*i*A-t*d*A)*M,e[10]=(o*g*r-m*a*r+m*i*l-t*g*l-o*i*A+t*a*A)*M,e[11]=(h*a*r-o*d*r-h*i*l+t*d*l+o*i*p-t*a*p)*M,e[12]=T*M,e[13]=(h*g*s-m*d*s+m*i*f-t*g*f-h*i*y+t*d*y)*M,e[14]=(m*a*s-o*g*s-m*i*c+t*g*c+o*i*y-t*a*y)*M,e[15]=(o*d*s-h*a*s+h*i*c-t*d*c-o*i*f+t*a*f)*M,this}scale(e){const t=this.elements,i=e.x,s=e.y,r=e.z;return t[0]*=i,t[4]*=s,t[8]*=r,t[1]*=i,t[5]*=s,t[9]*=r,t[2]*=i,t[6]*=s,t[10]*=r,t[3]*=i,t[7]*=s,t[11]*=r,this}getMaxScaleOnAxis(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],i=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],s=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,i,s))}makeTranslation(e,t,i){return e.isVector3?this.set(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1):this.set(1,0,0,e,0,1,0,t,0,0,1,i,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),i=Math.sin(e);return this.set(1,0,0,0,0,t,-i,0,0,i,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),i=Math.sin(e);return this.set(t,0,i,0,0,1,0,0,-i,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),i=Math.sin(e);return this.set(t,-i,0,0,i,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const i=Math.cos(t),s=Math.sin(t),r=1-i,o=e.x,a=e.y,c=e.z,l=r*o,h=r*a;return this.set(l*o+i,l*a-s*c,l*c+s*a,0,l*a+s*c,h*a+i,h*c-s*o,0,l*c-s*a,h*c+s*o,r*c*c+i,0,0,0,0,1),this}makeScale(e,t,i){return this.set(e,0,0,0,0,t,0,0,0,0,i,0,0,0,0,1),this}makeShear(e,t,i,s,r,o){return this.set(1,i,r,0,e,1,o,0,t,s,1,0,0,0,0,1),this}compose(e,t,i){const s=this.elements,r=t._x,o=t._y,a=t._z,c=t._w,l=r+r,h=o+o,d=a+a,f=r*l,p=r*h,m=r*d,g=o*h,y=o*d,A=a*d,v=c*l,b=c*h,_=c*d,T=i.x,E=i.y,M=i.z;return s[0]=(1-(g+A))*T,s[1]=(p+_)*T,s[2]=(m-b)*T,s[3]=0,s[4]=(p-_)*E,s[5]=(1-(f+A))*E,s[6]=(y+v)*E,s[7]=0,s[8]=(m+b)*M,s[9]=(y-v)*M,s[10]=(1-(f+g))*M,s[11]=0,s[12]=e.x,s[13]=e.y,s[14]=e.z,s[15]=1,this}decompose(e,t,i){const s=this.elements;let r=Hd.set(s[0],s[1],s[2]).length();const o=Hd.set(s[4],s[5],s[6]).length(),a=Hd.set(s[8],s[9],s[10]).length();this.determinant()<0&&(r=-r),e.x=s[12],e.y=s[13],e.z=s[14],Wo.copy(this);const l=1/r,h=1/o,d=1/a;return Wo.elements[0]*=l,Wo.elements[1]*=l,Wo.elements[2]*=l,Wo.elements[4]*=h,Wo.elements[5]*=h,Wo.elements[6]*=h,Wo.elements[8]*=d,Wo.elements[9]*=d,Wo.elements[10]*=d,t.setFromRotationMatrix(Wo),i.x=r,i.y=o,i.z=a,this}makePerspective(e,t,i,s,r,o,a=ic){const c=this.elements,l=2*r/(t-e),h=2*r/(i-s),d=(t+e)/(t-e),f=(i+s)/(i-s);let p,m;if(a===ic)p=-(o+r)/(o-r),m=-2*o*r/(o-r);else if(a===Kg)p=-o/(o-r),m=-o*r/(o-r);else throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+a);return c[0]=l,c[4]=0,c[8]=d,c[12]=0,c[1]=0,c[5]=h,c[9]=f,c[13]=0,c[2]=0,c[6]=0,c[10]=p,c[14]=m,c[3]=0,c[7]=0,c[11]=-1,c[15]=0,this}makeOrthographic(e,t,i,s,r,o,a=ic){const c=this.elements,l=1/(t-e),h=1/(i-s),d=1/(o-r),f=(t+e)*l,p=(i+s)*h;let m,g;if(a===ic)m=(o+r)*d,g=-2*d;else if(a===Kg)m=r*d,g=-1*d;else throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+a);return c[0]=2*l,c[4]=0,c[8]=0,c[12]=-f,c[1]=0,c[5]=2*h,c[9]=0,c[13]=-p,c[2]=0,c[6]=0,c[10]=g,c[14]=-m,c[3]=0,c[7]=0,c[11]=0,c[15]=1,this}equals(e){const t=this.elements,i=e.elements;for(let s=0;s<16;s++)if(t[s]!==i[s])return!1;return!0}fromArray(e,t=0){for(let i=0;i<16;i++)this.elements[i]=e[i+t];return this}toArray(e=[],t=0){const i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e[t+9]=i[9],e[t+10]=i[10],e[t+11]=i[11],e[t+12]=i[12],e[t+13]=i[13],e[t+14]=i[14],e[t+15]=i[15],e}}const Hd=new w,Wo=new Ce,_V=new w(0,0,0),xV=new w(1,1,1),ql=new w,Gv=new w,Hr=new w,CR=new Ce,ER=new Me;class ws{constructor(e=0,t=0,i=0,s=ws.DEFAULT_ORDER){this.isEuler=!0,this._x=e,this._y=t,this._z=i,this._order=s}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,i,s=this._order){return this._x=e,this._y=t,this._z=i,this._order=s,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,i=!0){const s=e.elements,r=s[0],o=s[4],a=s[8],c=s[1],l=s[5],h=s[9],d=s[2],f=s[6],p=s[10];switch(t){case"XYZ":this._y=Math.asin(pn(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-h,p),this._z=Math.atan2(-o,r)):(this._x=Math.atan2(f,l),this._z=0);break;case"YXZ":this._x=Math.asin(-pn(h,-1,1)),Math.abs(h)<.9999999?(this._y=Math.atan2(a,p),this._z=Math.atan2(c,l)):(this._y=Math.atan2(-d,r),this._z=0);break;case"ZXY":this._x=Math.asin(pn(f,-1,1)),Math.abs(f)<.9999999?(this._y=Math.atan2(-d,p),this._z=Math.atan2(-o,l)):(this._y=0,this._z=Math.atan2(c,r));break;case"ZYX":this._y=Math.asin(-pn(d,-1,1)),Math.abs(d)<.9999999?(this._x=Math.atan2(f,p),this._z=Math.atan2(c,r)):(this._x=0,this._z=Math.atan2(-o,l));break;case"YZX":this._z=Math.asin(pn(c,-1,1)),Math.abs(c)<.9999999?(this._x=Math.atan2(-h,l),this._y=Math.atan2(-d,r)):(this._x=0,this._y=Math.atan2(a,p));break;case"XZY":this._z=Math.asin(-pn(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(f,l),this._y=Math.atan2(a,r)):(this._x=Math.atan2(-h,p),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,i===!0&&this._onChangeCallback(),this}setFromQuaternion(e,t,i){return CR.makeRotationFromQuaternion(e),this.setFromRotationMatrix(CR,t,i)}setFromVector3(e,t=this._order){return this.set(e.x,e.y,e.z,t)}reorder(e){return ER.setFromEuler(this),this.setFromQuaternion(ER,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}ws.DEFAULT_ORDER="XYZ";class Ar{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return(this.mask&e.mask)!==0}isEnabled(e){return(this.mask&(1<<e|0))!==0}}let wV=0;const TR=new w,Qd=new Me,Pc=new Ce,Vv=new w,hm=new w,SV=new w,CV=new Me,MR=new w(1,0,0),IR=new w(0,1,0),RR=new w(0,0,1),EV={type:"added"},TV={type:"removed"};class ge extends ls{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:wV++}),this.uuid=to(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=ge.DEFAULT_UP.clone();const e=new w,t=new ws,i=new Me,s=new w(1,1,1);function r(){i.setFromEuler(t,!1)}function o(){t.setFromQuaternion(i,void 0,!1)}t._onChange(r),i._onChange(o),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:i},scale:{configurable:!0,enumerable:!0,value:s},modelViewMatrix:{value:new Ce},normalMatrix:{value:new Dt}}),this.matrix=new Ce,this.matrixWorld=new Ce,this.matrixAutoUpdate=ge.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=ge.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new Ar,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return Qd.setFromAxisAngle(e,t),this.quaternion.multiply(Qd),this}rotateOnWorldAxis(e,t){return Qd.setFromAxisAngle(e,t),this.quaternion.premultiply(Qd),this}rotateX(e){return this.rotateOnAxis(MR,e)}rotateY(e){return this.rotateOnAxis(IR,e)}rotateZ(e){return this.rotateOnAxis(RR,e)}translateOnAxis(e,t){return TR.copy(e).applyQuaternion(this.quaternion),this.position.add(TR.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(MR,e)}translateY(e){return this.translateOnAxis(IR,e)}translateZ(e){return this.translateOnAxis(RR,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(Pc.copy(this.matrixWorld).invert())}lookAt(e,t,i){e.isVector3?Vv.copy(e):Vv.set(e,t,i);const s=this.parent;this.updateWorldMatrix(!0,!1),hm.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Pc.lookAt(hm,Vv,this.up):Pc.lookAt(Vv,hm,this.up),this.quaternion.setFromRotationMatrix(Pc),s&&(Pc.extractRotation(s.matrixWorld),Qd.setFromRotationMatrix(Pc),this.quaternion.premultiply(Qd.invert()))}add(e){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.parent!==null&&e.parent.remove(e),e.parent=this,this.children.push(e),e.dispatchEvent(EV)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let i=0;i<arguments.length;i++)this.remove(arguments[i]);return this}const t=this.children.indexOf(e);return t!==-1&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(TV)),this}removeFromParent(){const e=this.parent;return e!==null&&e.remove(this),this}clear(){return this.remove(...this.children)}attach(e){return this.updateWorldMatrix(!0,!1),Pc.copy(this.matrixWorld).invert(),e.parent!==null&&(e.parent.updateWorldMatrix(!0,!1),Pc.multiply(e.parent.matrixWorld)),e.applyMatrix4(Pc),this.add(e),e.updateWorldMatrix(!1,!0),this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let i=0,s=this.children.length;i<s;i++){const o=this.children[i].getObjectByProperty(e,t);if(o!==void 0)return o}}getObjectsByProperty(e,t,i=[]){this[e]===t&&i.push(this);const s=this.children;for(let r=0,o=s.length;r<o;r++)s[r].getObjectsByProperty(e,t,i);return i}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(hm,e,SV),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(hm,CV,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);const t=this.children;for(let i=0,s=t.length;i<s;i++)t[i].traverse(e)}traverseVisible(e){if(this.visible===!1)return;e(this);const t=this.children;for(let i=0,s=t.length;i<s;i++)t[i].traverseVisible(e)}traverseAncestors(e){const t=this.parent;t!==null&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let i=0,s=t.length;i<s;i++){const r=t[i];(r.matrixWorldAutoUpdate===!0||e===!0)&&r.updateMatrixWorld(e)}}updateWorldMatrix(e,t){const i=this.parent;if(e===!0&&i!==null&&i.matrixWorldAutoUpdate===!0&&i.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),t===!0){const s=this.children;for(let r=0,o=s.length;r<o;r++){const a=s[r];a.matrixWorldAutoUpdate===!0&&a.updateWorldMatrix(!1,!0)}}}toJSON(e){const t=e===void 0||typeof e=="string",i={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},i.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const s={};s.uuid=this.uuid,s.type=this.type,this.name!==""&&(s.name=this.name),this.castShadow===!0&&(s.castShadow=!0),this.receiveShadow===!0&&(s.receiveShadow=!0),this.visible===!1&&(s.visible=!1),this.frustumCulled===!1&&(s.frustumCulled=!1),this.renderOrder!==0&&(s.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(s.userData=this.userData),s.layers=this.layers.mask,s.matrix=this.matrix.toArray(),s.up=this.up.toArray(),this.matrixAutoUpdate===!1&&(s.matrixAutoUpdate=!1),this.isInstancedMesh&&(s.type="InstancedMesh",s.count=this.count,s.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(s.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(s.type="BatchedMesh",s.perObjectFrustumCulled=this.perObjectFrustumCulled,s.sortObjects=this.sortObjects,s.drawRanges=this._drawRanges,s.reservedRanges=this._reservedRanges,s.visibility=this._visibility,s.active=this._active,s.bounds=this._bounds.map(a=>({boxInitialized:a.boxInitialized,boxMin:a.box.min.toArray(),boxMax:a.box.max.toArray(),sphereInitialized:a.sphereInitialized,sphereRadius:a.sphere.radius,sphereCenter:a.sphere.center.toArray()})),s.maxGeometryCount=this._maxGeometryCount,s.maxVertexCount=this._maxVertexCount,s.maxIndexCount=this._maxIndexCount,s.geometryInitialized=this._geometryInitialized,s.geometryCount=this._geometryCount,s.matricesTexture=this._matricesTexture.toJSON(e),this.boundingSphere!==null&&(s.boundingSphere={center:s.boundingSphere.center.toArray(),radius:s.boundingSphere.radius}),this.boundingBox!==null&&(s.boundingBox={min:s.boundingBox.min.toArray(),max:s.boundingBox.max.toArray()}));function r(a,c){return a[c.uuid]===void 0&&(a[c.uuid]=c.toJSON(e)),c.uuid}if(this.isScene)this.background&&(this.background.isColor?s.background=this.background.toJSON():this.background.isTexture&&(s.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(s.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){s.geometry=r(e.geometries,this.geometry);const a=this.geometry.parameters;if(a!==void 0&&a.shapes!==void 0){const c=a.shapes;if(Array.isArray(c))for(let l=0,h=c.length;l<h;l++){const d=c[l];r(e.shapes,d)}else r(e.shapes,c)}}if(this.isSkinnedMesh&&(s.bindMode=this.bindMode,s.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(r(e.skeletons,this.skeleton),s.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const a=[];for(let c=0,l=this.material.length;c<l;c++)a.push(r(e.materials,this.material[c]));s.material=a}else s.material=r(e.materials,this.material);if(this.children.length>0){s.children=[];for(let a=0;a<this.children.length;a++)s.children.push(this.children[a].toJSON(e).object)}if(this.animations.length>0){s.animations=[];for(let a=0;a<this.animations.length;a++){const c=this.animations[a];s.animations.push(r(e.animations,c))}}if(t){const a=o(e.geometries),c=o(e.materials),l=o(e.textures),h=o(e.images),d=o(e.shapes),f=o(e.skeletons),p=o(e.animations),m=o(e.nodes);a.length>0&&(i.geometries=a),c.length>0&&(i.materials=c),l.length>0&&(i.textures=l),h.length>0&&(i.images=h),d.length>0&&(i.shapes=d),f.length>0&&(i.skeletons=f),p.length>0&&(i.animations=p),m.length>0&&(i.nodes=m)}return i.object=s,i;function o(a){const c=[];for(const l in a){const h=a[l];delete h.metadata,c.push(h)}return c}}clone(e){return new this.constructor().copy(this,e)}copy(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.animations=e.animations.slice(),this.userData=JSON.parse(JSON.stringify(e.userData)),t===!0)for(let i=0;i<e.children.length;i++){const s=e.children[i];this.add(s.clone())}return this}}ge.DEFAULT_UP=new w(0,1,0);ge.DEFAULT_MATRIX_AUTO_UPDATE=!0;ge.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const qo=new w,Bc=new w,Ow=new w,Dc=new w,jd=new w,Wd=new w,PR=new w,kw=new w,Lw=new w,Fw=new w;class dr{constructor(e=new w,t=new w,i=new w){this.a=e,this.b=t,this.c=i}static getNormal(e,t,i,s){s.subVectors(i,t),qo.subVectors(e,t),s.cross(qo);const r=s.lengthSq();return r>0?s.multiplyScalar(1/Math.sqrt(r)):s.set(0,0,0)}static getBarycoord(e,t,i,s,r){qo.subVectors(s,t),Bc.subVectors(i,t),Ow.subVectors(e,t);const o=qo.dot(qo),a=qo.dot(Bc),c=qo.dot(Ow),l=Bc.dot(Bc),h=Bc.dot(Ow),d=o*l-a*a;if(d===0)return r.set(0,0,0),null;const f=1/d,p=(l*c-a*h)*f,m=(o*h-a*c)*f;return r.set(1-p-m,m,p)}static containsPoint(e,t,i,s){return this.getBarycoord(e,t,i,s,Dc)===null?!1:Dc.x>=0&&Dc.y>=0&&Dc.x+Dc.y<=1}static getInterpolation(e,t,i,s,r,o,a,c){return this.getBarycoord(e,t,i,s,Dc)===null?(c.x=0,c.y=0,"z"in c&&(c.z=0),"w"in c&&(c.w=0),null):(c.setScalar(0),c.addScaledVector(r,Dc.x),c.addScaledVector(o,Dc.y),c.addScaledVector(a,Dc.z),c)}static isFrontFacing(e,t,i,s){return qo.subVectors(i,t),Bc.subVectors(e,t),qo.cross(Bc).dot(s)<0}set(e,t,i){return this.a.copy(e),this.b.copy(t),this.c.copy(i),this}setFromPointsAndIndices(e,t,i,s){return this.a.copy(e[t]),this.b.copy(e[i]),this.c.copy(e[s]),this}setFromAttributeAndIndices(e,t,i,s){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,i),this.c.fromBufferAttribute(e,s),this}clone(){return new this.constructor().copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return qo.subVectors(this.c,this.b),Bc.subVectors(this.a,this.b),qo.cross(Bc).length()*.5}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return dr.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return dr.getBarycoord(e,this.a,this.b,this.c,t)}getInterpolation(e,t,i,s,r){return dr.getInterpolation(e,this.a,this.b,this.c,t,i,s,r)}containsPoint(e){return dr.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return dr.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){const i=this.a,s=this.b,r=this.c;let o,a;jd.subVectors(s,i),Wd.subVectors(r,i),kw.subVectors(e,i);const c=jd.dot(kw),l=Wd.dot(kw);if(c<=0&&l<=0)return t.copy(i);Lw.subVectors(e,s);const h=jd.dot(Lw),d=Wd.dot(Lw);if(h>=0&&d<=h)return t.copy(s);const f=c*d-h*l;if(f<=0&&c>=0&&h<=0)return o=c/(c-h),t.copy(i).addScaledVector(jd,o);Fw.subVectors(e,r);const p=jd.dot(Fw),m=Wd.dot(Fw);if(m>=0&&p<=m)return t.copy(r);const g=p*l-c*m;if(g<=0&&l>=0&&m<=0)return a=l/(l-m),t.copy(i).addScaledVector(Wd,a);const y=h*m-p*d;if(y<=0&&d-h>=0&&p-m>=0)return PR.subVectors(r,s),a=(d-h)/(d-h+(p-m)),t.copy(s).addScaledVector(PR,a);const A=1/(y+g+f);return o=g*A,a=f*A,t.copy(i).addScaledVector(jd,o).addScaledVector(Wd,a)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}const u2={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Xl={h:0,s:0,l:0},Hv={h:0,s:0,l:0};function Uw(n,e,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?n+(e-n)*6*t:t<1/2?e:t<2/3?n+(e-n)*6*(2/3-t):n}class ye{constructor(e,t,i){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(e,t,i)}set(e,t,i){if(t===void 0&&i===void 0){const s=e;s&&s.isColor?this.copy(s):typeof s=="number"?this.setHex(s):typeof s=="string"&&this.setStyle(s)}else this.setRGB(e,t,i);return this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,t=zt){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,_i.toWorkingColorSpace(this,t),this}setRGB(e,t,i,s=_i.workingColorSpace){return this.r=e,this.g=t,this.b=i,_i.toWorkingColorSpace(this,s),this}setHSL(e,t,i,s=_i.workingColorSpace){if(e=AM(e,1),t=pn(t,0,1),i=pn(i,0,1),t===0)this.r=this.g=this.b=i;else{const r=i<=.5?i*(1+t):i+t-i*t,o=2*i-r;this.r=Uw(o,r,e+1/3),this.g=Uw(o,r,e),this.b=Uw(o,r,e-1/3)}return _i.toWorkingColorSpace(this,s),this}setStyle(e,t=zt){function i(r){r!==void 0&&parseFloat(r)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let s;if(s=/^(\w+)\(([^\)]*)\)/.exec(e)){let r;const o=s[1],a=s[2];switch(o){case"rgb":case"rgba":if(r=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return i(r[4]),this.setRGB(Math.min(255,parseInt(r[1],10))/255,Math.min(255,parseInt(r[2],10))/255,Math.min(255,parseInt(r[3],10))/255,t);if(r=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return i(r[4]),this.setRGB(Math.min(100,parseInt(r[1],10))/100,Math.min(100,parseInt(r[2],10))/100,Math.min(100,parseInt(r[3],10))/100,t);break;case"hsl":case"hsla":if(r=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return i(r[4]),this.setHSL(parseFloat(r[1])/360,parseFloat(r[2])/100,parseFloat(r[3])/100,t);break;default:console.warn("THREE.Color: Unknown color model "+e)}}else if(s=/^\#([A-Fa-f\d]+)$/.exec(e)){const r=s[1],o=r.length;if(o===3)return this.setRGB(parseInt(r.charAt(0),16)/15,parseInt(r.charAt(1),16)/15,parseInt(r.charAt(2),16)/15,t);if(o===6)return this.setHex(parseInt(r,16),t);console.warn("THREE.Color: Invalid hex color "+e)}else if(e&&e.length>0)return this.setColorName(e,t);return this}setColorName(e,t=zt){const i=u2[e.toLowerCase()];return i!==void 0?this.setHex(i,t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=Zf(e.r),this.g=Zf(e.g),this.b=Zf(e.b),this}copyLinearToSRGB(e){return this.r=Ew(e.r),this.g=Ew(e.g),this.b=Ew(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=zt){return _i.fromWorkingColorSpace(Ds.copy(this),e),Math.round(pn(Ds.r*255,0,255))*65536+Math.round(pn(Ds.g*255,0,255))*256+Math.round(pn(Ds.b*255,0,255))}getHexString(e=zt){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,t=_i.workingColorSpace){_i.fromWorkingColorSpace(Ds.copy(this),t);const i=Ds.r,s=Ds.g,r=Ds.b,o=Math.max(i,s,r),a=Math.min(i,s,r);let c,l;const h=(a+o)/2;if(a===o)c=0,l=0;else{const d=o-a;switch(l=h<=.5?d/(o+a):d/(2-o-a),o){case i:c=(s-r)/d+(s<r?6:0);break;case s:c=(r-i)/d+2;break;case r:c=(i-s)/d+4;break}c/=6}return e.h=c,e.s=l,e.l=h,e}getRGB(e,t=_i.workingColorSpace){return _i.fromWorkingColorSpace(Ds.copy(this),t),e.r=Ds.r,e.g=Ds.g,e.b=Ds.b,e}getStyle(e=zt){_i.fromWorkingColorSpace(Ds.copy(this),e);const t=Ds.r,i=Ds.g,s=Ds.b;return e!==zt?`color(${e} ${t.toFixed(3)} ${i.toFixed(3)} ${s.toFixed(3)})`:`rgb(${Math.round(t*255)},${Math.round(i*255)},${Math.round(s*255)})`}offsetHSL(e,t,i){return this.getHSL(Xl),this.setHSL(Xl.h+e,Xl.s+t,Xl.l+i)}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,i){return this.r=e.r+(t.r-e.r)*i,this.g=e.g+(t.g-e.g)*i,this.b=e.b+(t.b-e.b)*i,this}lerpHSL(e,t){this.getHSL(Xl),e.getHSL(Hv);const i=ng(Xl.h,Hv.h,t),s=ng(Xl.s,Hv.s,t),r=ng(Xl.l,Hv.l,t);return this.setHSL(i,s,r),this}setFromVector3(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}applyMatrix3(e){const t=this.r,i=this.g,s=this.b,r=e.elements;return this.r=r[0]*t+r[3]*i+r[6]*s,this.g=r[1]*t+r[4]*i+r[7]*s,this.b=r[2]*t+r[5]*i+r[8]*s,this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const Ds=new ye;ye.NAMES=u2;let MV=0;class Ot extends ls{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:MV++}),this.uuid=to(),this.name="",this.type="Material",this.blending=Th,this.side=Es,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=Z0,this.blendDst=$0,this.blendEquation=Ah,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new ye(0,0,0),this.blendAlpha=0,this.depthFunc=ld,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=ob,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=hh,this.stencilZFail=hh,this.stencilZPass=hh,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(e!==void 0)for(const t in e){const i=e[t];if(i===void 0){console.warn(`THREE.Material: parameter '${t}' has value of undefined.`);continue}const s=this[t];if(s===void 0){console.warn(`THREE.Material: '${t}' is not a property of THREE.${this.type}.`);continue}s&&s.isColor?s.set(i):s&&s.isVector3&&i&&i.isVector3?s.copy(i):this[t]=i}}toJSON(e){const t=e===void 0||typeof e=="string";t&&(e={textures:{},images:{}});const i={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};i.uuid=this.uuid,i.type=this.type,this.name!==""&&(i.name=this.name),this.color&&this.color.isColor&&(i.color=this.color.getHex()),this.roughness!==void 0&&(i.roughness=this.roughness),this.metalness!==void 0&&(i.metalness=this.metalness),this.sheen!==void 0&&(i.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(i.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(i.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(i.emissive=this.emissive.getHex()),this.emissiveIntensity&&this.emissiveIntensity!==1&&(i.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(i.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(i.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(i.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(i.shininess=this.shininess),this.clearcoat!==void 0&&(i.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(i.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(i.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(i.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(i.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,i.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.iridescence!==void 0&&(i.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(i.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(i.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(i.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(i.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),this.anisotropy!==void 0&&(i.anisotropy=this.anisotropy),this.anisotropyRotation!==void 0&&(i.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(i.anisotropyMap=this.anisotropyMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(i.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(i.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(i.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(i.lightMap=this.lightMap.toJSON(e).uuid,i.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(i.aoMap=this.aoMap.toJSON(e).uuid,i.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(i.bumpMap=this.bumpMap.toJSON(e).uuid,i.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(i.normalMap=this.normalMap.toJSON(e).uuid,i.normalMapType=this.normalMapType,i.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(i.displacementMap=this.displacementMap.toJSON(e).uuid,i.displacementScale=this.displacementScale,i.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(i.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(i.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(i.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(i.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(i.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(i.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(i.envMap=this.envMap.toJSON(e).uuid,this.combine!==void 0&&(i.combine=this.combine)),this.envMapIntensity!==void 0&&(i.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(i.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(i.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(i.gradientMap=this.gradientMap.toJSON(e).uuid),this.transmission!==void 0&&(i.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(i.transmissionMap=this.transmissionMap.toJSON(e).uuid),this.thickness!==void 0&&(i.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(i.thicknessMap=this.thicknessMap.toJSON(e).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(i.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(i.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(i.size=this.size),this.shadowSide!==null&&(i.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(i.sizeAttenuation=this.sizeAttenuation),this.blending!==Th&&(i.blending=this.blending),this.side!==Es&&(i.side=this.side),this.vertexColors===!0&&(i.vertexColors=!0),this.opacity<1&&(i.opacity=this.opacity),this.transparent===!0&&(i.transparent=!0),this.blendSrc!==Z0&&(i.blendSrc=this.blendSrc),this.blendDst!==$0&&(i.blendDst=this.blendDst),this.blendEquation!==Ah&&(i.blendEquation=this.blendEquation),this.blendSrcAlpha!==null&&(i.blendSrcAlpha=this.blendSrcAlpha),this.blendDstAlpha!==null&&(i.blendDstAlpha=this.blendDstAlpha),this.blendEquationAlpha!==null&&(i.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(i.blendColor=this.blendColor.getHex()),this.blendAlpha!==0&&(i.blendAlpha=this.blendAlpha),this.depthFunc!==ld&&(i.depthFunc=this.depthFunc),this.depthTest===!1&&(i.depthTest=this.depthTest),this.depthWrite===!1&&(i.depthWrite=this.depthWrite),this.colorWrite===!1&&(i.colorWrite=this.colorWrite),this.stencilWriteMask!==255&&(i.stencilWriteMask=this.stencilWriteMask),this.stencilFunc!==ob&&(i.stencilFunc=this.stencilFunc),this.stencilRef!==0&&(i.stencilRef=this.stencilRef),this.stencilFuncMask!==255&&(i.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==hh&&(i.stencilFail=this.stencilFail),this.stencilZFail!==hh&&(i.stencilZFail=this.stencilZFail),this.stencilZPass!==hh&&(i.stencilZPass=this.stencilZPass),this.stencilWrite===!0&&(i.stencilWrite=this.stencilWrite),this.rotation!==void 0&&this.rotation!==0&&(i.rotation=this.rotation),this.polygonOffset===!0&&(i.polygonOffset=!0),this.polygonOffsetFactor!==0&&(i.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(i.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(i.linewidth=this.linewidth),this.dashSize!==void 0&&(i.dashSize=this.dashSize),this.gapSize!==void 0&&(i.gapSize=this.gapSize),this.scale!==void 0&&(i.scale=this.scale),this.dithering===!0&&(i.dithering=!0),this.alphaTest>0&&(i.alphaTest=this.alphaTest),this.alphaHash===!0&&(i.alphaHash=!0),this.alphaToCoverage===!0&&(i.alphaToCoverage=!0),this.premultipliedAlpha===!0&&(i.premultipliedAlpha=!0),this.forceSinglePass===!0&&(i.forceSinglePass=!0),this.wireframe===!0&&(i.wireframe=!0),this.wireframeLinewidth>1&&(i.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(i.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(i.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(i.flatShading=!0),this.visible===!1&&(i.visible=!1),this.toneMapped===!1&&(i.toneMapped=!1),this.fog===!1&&(i.fog=!1),Object.keys(this.userData).length>0&&(i.userData=this.userData);function s(r){const o=[];for(const a in r){const c=r[a];delete c.metadata,o.push(c)}return o}if(t){const r=s(e.textures),o=s(e.images);r.length>0&&(i.textures=r),o.length>0&&(i.images=o)}return i}clone(){return new this.constructor().copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.blendColor.copy(e.blendColor),this.blendAlpha=e.blendAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let i=null;if(t!==null){const s=t.length;i=new Array(s);for(let r=0;r!==s;++r)i[r]=t[r].clone()}return this.clippingPlanes=i,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaHash=e.alphaHash,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){e===!0&&this.version++}}class ri extends Ot{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new ye(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=DA,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.occlusion=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this.occlusion=e.occlusion,this}}const $c=IV();function IV(){const n=new ArrayBuffer(4),e=new Float32Array(n),t=new Uint32Array(n),i=new Uint32Array(512),s=new Uint32Array(512);for(let c=0;c<256;++c){const l=c-127;l<-27?(i[c]=0,i[c|256]=32768,s[c]=24,s[c|256]=24):l<-14?(i[c]=1024>>-l-14,i[c|256]=1024>>-l-14|32768,s[c]=-l-1,s[c|256]=-l-1):l<=15?(i[c]=l+15<<10,i[c|256]=l+15<<10|32768,s[c]=13,s[c|256]=13):l<128?(i[c]=31744,i[c|256]=64512,s[c]=24,s[c|256]=24):(i[c]=31744,i[c|256]=64512,s[c]=13,s[c|256]=13)}const r=new Uint32Array(2048),o=new Uint32Array(64),a=new Uint32Array(64);for(let c=1;c<1024;++c){let l=c<<13,h=0;for(;!(l&8388608);)l<<=1,h-=8388608;l&=-8388609,h+=947912704,r[c]=l|h}for(let c=1024;c<2048;++c)r[c]=939524096+(c-1024<<13);for(let c=1;c<31;++c)o[c]=c<<23;o[31]=1199570944,o[32]=2147483648;for(let c=33;c<63;++c)o[c]=2147483648+(c-32<<23);o[63]=3347054592;for(let c=1;c<64;++c)c!==32&&(a[c]=1024);return{floatView:e,uint32View:t,baseTable:i,shiftTable:s,mantissaTable:r,exponentTable:o,offsetTable:a}}function Ir(n){Math.abs(n)>65504&&console.warn("THREE.DataUtils.toHalfFloat(): Value out of range."),n=pn(n,-65504,65504),$c.floatView[0]=n;const e=$c.uint32View[0],t=e>>23&511;return $c.baseTable[t]+((e&8388607)>>$c.shiftTable[t])}function Qm(n){const e=n>>10;return $c.uint32View[0]=$c.mantissaTable[$c.offsetTable[e]+(n&1023)]+$c.exponentTable[e],$c.floatView[0]}const Uu={toHalfFloat:Ir,fromHalfFloat:Qm},Pn=new w,Qv=new ie;class it{constructor(e,t,i=!1){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=e,this.itemSize=t,this.count=e!==void 0?e.length/t:0,this.normalized=i,this.usage=Jg,this._updateRange={offset:0,count:-1},this.updateRanges=[],this.gpuType=Ji,this.version=0}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}get updateRange(){return Xu("THREE.BufferAttribute: updateRange() is deprecated and will be removed in r169. Use addUpdateRange() instead."),this._updateRange}setUsage(e){return this.usage=e,this}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this.gpuType=e.gpuType,this}copyAt(e,t,i){e*=this.itemSize,i*=t.itemSize;for(let s=0,r=this.itemSize;s<r;s++)this.array[e+s]=t.array[i+s];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(this.itemSize===2)for(let t=0,i=this.count;t<i;t++)Qv.fromBufferAttribute(this,t),Qv.applyMatrix3(e),this.setXY(t,Qv.x,Qv.y);else if(this.itemSize===3)for(let t=0,i=this.count;t<i;t++)Pn.fromBufferAttribute(this,t),Pn.applyMatrix3(e),this.setXYZ(t,Pn.x,Pn.y,Pn.z);return this}applyMatrix4(e){for(let t=0,i=this.count;t<i;t++)Pn.fromBufferAttribute(this,t),Pn.applyMatrix4(e),this.setXYZ(t,Pn.x,Pn.y,Pn.z);return this}applyNormalMatrix(e){for(let t=0,i=this.count;t<i;t++)Pn.fromBufferAttribute(this,t),Pn.applyNormalMatrix(e),this.setXYZ(t,Pn.x,Pn.y,Pn.z);return this}transformDirection(e){for(let t=0,i=this.count;t<i;t++)Pn.fromBufferAttribute(this,t),Pn.transformDirection(e),this.setXYZ(t,Pn.x,Pn.y,Pn.z);return this}set(e,t=0){return this.array.set(e,t),this}getComponent(e,t){let i=this.array[e*this.itemSize+t];return this.normalized&&(i=ur(i,this.array)),i}setComponent(e,t,i){return this.normalized&&(i=Vt(i,this.array)),this.array[e*this.itemSize+t]=i,this}getX(e){let t=this.array[e*this.itemSize];return this.normalized&&(t=ur(t,this.array)),t}setX(e,t){return this.normalized&&(t=Vt(t,this.array)),this.array[e*this.itemSize]=t,this}getY(e){let t=this.array[e*this.itemSize+1];return this.normalized&&(t=ur(t,this.array)),t}setY(e,t){return this.normalized&&(t=Vt(t,this.array)),this.array[e*this.itemSize+1]=t,this}getZ(e){let t=this.array[e*this.itemSize+2];return this.normalized&&(t=ur(t,this.array)),t}setZ(e,t){return this.normalized&&(t=Vt(t,this.array)),this.array[e*this.itemSize+2]=t,this}getW(e){let t=this.array[e*this.itemSize+3];return this.normalized&&(t=ur(t,this.array)),t}setW(e,t){return this.normalized&&(t=Vt(t,this.array)),this.array[e*this.itemSize+3]=t,this}setXY(e,t,i){return e*=this.itemSize,this.normalized&&(t=Vt(t,this.array),i=Vt(i,this.array)),this.array[e+0]=t,this.array[e+1]=i,this}setXYZ(e,t,i,s){return e*=this.itemSize,this.normalized&&(t=Vt(t,this.array),i=Vt(i,this.array),s=Vt(s,this.array)),this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=s,this}setXYZW(e,t,i,s,r){return e*=this.itemSize,this.normalized&&(t=Vt(t,this.array),i=Vt(i,this.array),s=Vt(s,this.array),r=Vt(r,this.array)),this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=s,this.array[e+3]=r,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(e.name=this.name),this.usage!==Jg&&(e.usage=this.usage),e}}class RV extends it{constructor(e,t,i){super(new Int8Array(e),t,i)}}class PV extends it{constructor(e,t,i){super(new Uint8Array(e),t,i)}}class BV extends it{constructor(e,t,i){super(new Uint8ClampedArray(e),t,i)}}class DV extends it{constructor(e,t,i){super(new Int16Array(e),t,i)}}class yM extends it{constructor(e,t,i){super(new Uint16Array(e),t,i)}}class OV extends it{constructor(e,t,i){super(new Int32Array(e),t,i)}}class bM extends it{constructor(e,t,i){super(new Uint32Array(e),t,i)}}class kV extends it{constructor(e,t,i){super(new Uint16Array(e),t,i),this.isFloat16BufferAttribute=!0}getX(e){let t=Qm(this.array[e*this.itemSize]);return this.normalized&&(t=ur(t,this.array)),t}setX(e,t){return this.normalized&&(t=Vt(t,this.array)),this.array[e*this.itemSize]=Ir(t),this}getY(e){let t=Qm(this.array[e*this.itemSize+1]);return this.normalized&&(t=ur(t,this.array)),t}setY(e,t){return this.normalized&&(t=Vt(t,this.array)),this.array[e*this.itemSize+1]=Ir(t),this}getZ(e){let t=Qm(this.array[e*this.itemSize+2]);return this.normalized&&(t=ur(t,this.array)),t}setZ(e,t){return this.normalized&&(t=Vt(t,this.array)),this.array[e*this.itemSize+2]=Ir(t),this}getW(e){let t=Qm(this.array[e*this.itemSize+3]);return this.normalized&&(t=ur(t,this.array)),t}setW(e,t){return this.normalized&&(t=Vt(t,this.array)),this.array[e*this.itemSize+3]=Ir(t),this}setXY(e,t,i){return e*=this.itemSize,this.normalized&&(t=Vt(t,this.array),i=Vt(i,this.array)),this.array[e+0]=Ir(t),this.array[e+1]=Ir(i),this}setXYZ(e,t,i,s){return e*=this.itemSize,this.normalized&&(t=Vt(t,this.array),i=Vt(i,this.array),s=Vt(s,this.array)),this.array[e+0]=Ir(t),this.array[e+1]=Ir(i),this.array[e+2]=Ir(s),this}setXYZW(e,t,i,s,r){return e*=this.itemSize,this.normalized&&(t=Vt(t,this.array),i=Vt(i,this.array),s=Vt(s,this.array),r=Vt(r,this.array)),this.array[e+0]=Ir(t),this.array[e+1]=Ir(i),this.array[e+2]=Ir(s),this.array[e+3]=Ir(r),this}}class ot extends it{constructor(e,t,i){super(new Float32Array(e),t,i)}}class LV extends it{constructor(e,t,i){super(new Float64Array(e),t,i)}}let FV=0;const po=new Ce,Nw=new ge,qd=new w,Qr=new Mi,um=new Mi,Xn=new w;class gt extends ls{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:FV++}),this.uuid=to(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(a2(e)?bM:yM)(e,1):this.index=e,this}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return this.attributes[e]!==void 0}addGroup(e,t,i=0){this.groups.push({start:e,count:t,materialIndex:i})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){const t=this.attributes.position;t!==void 0&&(t.applyMatrix4(e),t.needsUpdate=!0);const i=this.attributes.normal;if(i!==void 0){const r=new Dt().getNormalMatrix(e);i.applyNormalMatrix(r),i.needsUpdate=!0}const s=this.attributes.tangent;return s!==void 0&&(s.transformDirection(e),s.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(e){return po.makeRotationFromQuaternion(e),this.applyMatrix4(po),this}rotateX(e){return po.makeRotationX(e),this.applyMatrix4(po),this}rotateY(e){return po.makeRotationY(e),this.applyMatrix4(po),this}rotateZ(e){return po.makeRotationZ(e),this.applyMatrix4(po),this}translate(e,t,i){return po.makeTranslation(e,t,i),this.applyMatrix4(po),this}scale(e,t,i){return po.makeScale(e,t,i),this.applyMatrix4(po),this}lookAt(e){return Nw.lookAt(e),Nw.updateMatrix(),this.applyMatrix4(Nw.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(qd).negate(),this.translate(qd.x,qd.y,qd.z),this}setFromPoints(e){const t=[];for(let i=0,s=e.length;i<s;i++){const r=e[i];t.push(r.x,r.y,r.z||0)}return this.setAttribute("position",new ot(t,3)),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Mi);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingBox.set(new w(-1/0,-1/0,-1/0),new w(1/0,1/0,1/0));return}if(e!==void 0){if(this.boundingBox.setFromBufferAttribute(e),t)for(let i=0,s=t.length;i<s;i++){const r=t[i];Qr.setFromBufferAttribute(r),this.morphTargetsRelative?(Xn.addVectors(this.boundingBox.min,Qr.min),this.boundingBox.expandByPoint(Xn),Xn.addVectors(this.boundingBox.max,Qr.max),this.boundingBox.expandByPoint(Xn)):(this.boundingBox.expandByPoint(Qr.min),this.boundingBox.expandByPoint(Qr.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Mn);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingSphere.set(new w,1/0);return}if(e){const i=this.boundingSphere.center;if(Qr.setFromBufferAttribute(e),t)for(let r=0,o=t.length;r<o;r++){const a=t[r];um.setFromBufferAttribute(a),this.morphTargetsRelative?(Xn.addVectors(Qr.min,um.min),Qr.expandByPoint(Xn),Xn.addVectors(Qr.max,um.max),Qr.expandByPoint(Xn)):(Qr.expandByPoint(um.min),Qr.expandByPoint(um.max))}Qr.getCenter(i);let s=0;for(let r=0,o=e.count;r<o;r++)Xn.fromBufferAttribute(e,r),s=Math.max(s,i.distanceToSquared(Xn));if(t)for(let r=0,o=t.length;r<o;r++){const a=t[r],c=this.morphTargetsRelative;for(let l=0,h=a.count;l<h;l++)Xn.fromBufferAttribute(a,l),c&&(qd.fromBufferAttribute(e,l),Xn.add(qd)),s=Math.max(s,i.distanceToSquared(Xn))}this.boundingSphere.radius=Math.sqrt(s),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,t=this.attributes;if(e===null||t.position===void 0||t.normal===void 0||t.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const i=e.array,s=t.position.array,r=t.normal.array,o=t.uv.array,a=s.length/3;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new it(new Float32Array(4*a),4));const c=this.getAttribute("tangent").array,l=[],h=[];for(let C=0;C<a;C++)l[C]=new w,h[C]=new w;const d=new w,f=new w,p=new w,m=new ie,g=new ie,y=new ie,A=new w,v=new w;function b(C,D,G){d.fromArray(s,C*3),f.fromArray(s,D*3),p.fromArray(s,G*3),m.fromArray(o,C*2),g.fromArray(o,D*2),y.fromArray(o,G*2),f.sub(d),p.sub(d),g.sub(m),y.sub(m);const Q=1/(g.x*y.y-y.x*g.y);isFinite(Q)&&(A.copy(f).multiplyScalar(y.y).addScaledVector(p,-g.y).multiplyScalar(Q),v.copy(p).multiplyScalar(g.x).addScaledVector(f,-y.x).multiplyScalar(Q),l[C].add(A),l[D].add(A),l[G].add(A),h[C].add(v),h[D].add(v),h[G].add(v))}let _=this.groups;_.length===0&&(_=[{start:0,count:i.length}]);for(let C=0,D=_.length;C<D;++C){const G=_[C],Q=G.start,L=G.count;for(let V=Q,O=Q+L;V<O;V+=3)b(i[V+0],i[V+1],i[V+2])}const T=new w,E=new w,M=new w,I=new w;function S(C){M.fromArray(r,C*3),I.copy(M);const D=l[C];T.copy(D),T.sub(M.multiplyScalar(M.dot(D))).normalize(),E.crossVectors(I,D);const Q=E.dot(h[C])<0?-1:1;c[C*4]=T.x,c[C*4+1]=T.y,c[C*4+2]=T.z,c[C*4+3]=Q}for(let C=0,D=_.length;C<D;++C){const G=_[C],Q=G.start,L=G.count;for(let V=Q,O=Q+L;V<O;V+=3)S(i[V+0]),S(i[V+1]),S(i[V+2])}}computeVertexNormals(){const e=this.index,t=this.getAttribute("position");if(t!==void 0){let i=this.getAttribute("normal");if(i===void 0)i=new it(new Float32Array(t.count*3),3),this.setAttribute("normal",i);else for(let f=0,p=i.count;f<p;f++)i.setXYZ(f,0,0,0);const s=new w,r=new w,o=new w,a=new w,c=new w,l=new w,h=new w,d=new w;if(e)for(let f=0,p=e.count;f<p;f+=3){const m=e.getX(f+0),g=e.getX(f+1),y=e.getX(f+2);s.fromBufferAttribute(t,m),r.fromBufferAttribute(t,g),o.fromBufferAttribute(t,y),h.subVectors(o,r),d.subVectors(s,r),h.cross(d),a.fromBufferAttribute(i,m),c.fromBufferAttribute(i,g),l.fromBufferAttribute(i,y),a.add(h),c.add(h),l.add(h),i.setXYZ(m,a.x,a.y,a.z),i.setXYZ(g,c.x,c.y,c.z),i.setXYZ(y,l.x,l.y,l.z)}else for(let f=0,p=t.count;f<p;f+=3)s.fromBufferAttribute(t,f+0),r.fromBufferAttribute(t,f+1),o.fromBufferAttribute(t,f+2),h.subVectors(o,r),d.subVectors(s,r),h.cross(d),i.setXYZ(f+0,h.x,h.y,h.z),i.setXYZ(f+1,h.x,h.y,h.z),i.setXYZ(f+2,h.x,h.y,h.z);this.normalizeNormals(),i.needsUpdate=!0}}normalizeNormals(){const e=this.attributes.normal;for(let t=0,i=e.count;t<i;t++)Xn.fromBufferAttribute(e,t),Xn.normalize(),e.setXYZ(t,Xn.x,Xn.y,Xn.z)}toNonIndexed(){function e(a,c){const l=a.array,h=a.itemSize,d=a.normalized,f=new l.constructor(c.length*h);let p=0,m=0;for(let g=0,y=c.length;g<y;g++){a.isInterleavedBufferAttribute?p=c[g]*a.data.stride+a.offset:p=c[g]*h;for(let A=0;A<h;A++)f[m++]=l[p++]}return new it(f,h,d)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const t=new gt,i=this.index.array,s=this.attributes;for(const a in s){const c=s[a],l=e(c,i);t.setAttribute(a,l)}const r=this.morphAttributes;for(const a in r){const c=[],l=r[a];for(let h=0,d=l.length;h<d;h++){const f=l[h],p=e(f,i);c.push(p)}t.morphAttributes[a]=c}t.morphTargetsRelative=this.morphTargetsRelative;const o=this.groups;for(let a=0,c=o.length;a<c;a++){const l=o[a];t.addGroup(l.start,l.count,l.materialIndex)}return t}toJSON(){const e={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),this.parameters!==void 0){const c=this.parameters;for(const l in c)c[l]!==void 0&&(e[l]=c[l]);return e}e.data={attributes:{}};const t=this.index;t!==null&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const i=this.attributes;for(const c in i){const l=i[c];e.data.attributes[c]=l.toJSON(e.data)}const s={};let r=!1;for(const c in this.morphAttributes){const l=this.morphAttributes[c],h=[];for(let d=0,f=l.length;d<f;d++){const p=l[d];h.push(p.toJSON(e.data))}h.length>0&&(s[c]=h,r=!0)}r&&(e.data.morphAttributes=s,e.data.morphTargetsRelative=this.morphTargetsRelative);const o=this.groups;o.length>0&&(e.data.groups=JSON.parse(JSON.stringify(o)));const a=this.boundingSphere;return a!==null&&(e.data.boundingSphere={center:a.center.toArray(),radius:a.radius}),e}clone(){return new this.constructor().copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const i=e.index;i!==null&&this.setIndex(i.clone(t));const s=e.attributes;for(const l in s){const h=s[l];this.setAttribute(l,h.clone(t))}const r=e.morphAttributes;for(const l in r){const h=[],d=r[l];for(let f=0,p=d.length;f<p;f++)h.push(d[f].clone(t));this.morphAttributes[l]=h}this.morphTargetsRelative=e.morphTargetsRelative;const o=e.groups;for(let l=0,h=o.length;l<h;l++){const d=o[l];this.addGroup(d.start,d.count,d.materialIndex)}const a=e.boundingBox;a!==null&&(this.boundingBox=a.clone());const c=e.boundingSphere;return c!==null&&(this.boundingSphere=c.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const BR=new Ce,cu=new ro,jv=new Mn,DR=new w,Xd=new w,Yd=new w,Jd=new w,zw=new w,Wv=new w,qv=new ie,Xv=new ie,Yv=new ie,OR=new w,kR=new w,LR=new w,Jv=new w,Kv=new w;class me extends ge{constructor(e=new gt,t=new ri){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),e.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),e.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}updateMorphTargets(){const t=this.geometry.morphAttributes,i=Object.keys(t);if(i.length>0){const s=t[i[0]];if(s!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let r=0,o=s.length;r<o;r++){const a=s[r].name||String(r);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=r}}}}getVertexPosition(e,t){const i=this.geometry,s=i.attributes.position,r=i.morphAttributes.position,o=i.morphTargetsRelative;t.fromBufferAttribute(s,e);const a=this.morphTargetInfluences;if(r&&a){Wv.set(0,0,0);for(let c=0,l=r.length;c<l;c++){const h=a[c],d=r[c];h!==0&&(zw.fromBufferAttribute(d,e),o?Wv.addScaledVector(zw,h):Wv.addScaledVector(zw.sub(t),h))}t.add(Wv)}return t}raycast(e,t){const i=this.geometry,s=this.material,r=this.matrixWorld;s!==void 0&&(i.boundingSphere===null&&i.computeBoundingSphere(),jv.copy(i.boundingSphere),jv.applyMatrix4(r),cu.copy(e.ray).recast(e.near),!(jv.containsPoint(cu.origin)===!1&&(cu.intersectSphere(jv,DR)===null||cu.origin.distanceToSquared(DR)>(e.far-e.near)**2))&&(BR.copy(r).invert(),cu.copy(e.ray).applyMatrix4(BR),!(i.boundingBox!==null&&cu.intersectsBox(i.boundingBox)===!1)&&this._computeIntersections(e,t,cu)))}_computeIntersections(e,t,i){let s;const r=this.geometry,o=this.material,a=r.index,c=r.attributes.position,l=r.attributes.uv,h=r.attributes.uv1,d=r.attributes.normal,f=r.groups,p=r.drawRange;if(a!==null)if(Array.isArray(o))for(let m=0,g=f.length;m<g;m++){const y=f[m],A=o[y.materialIndex],v=Math.max(y.start,p.start),b=Math.min(a.count,Math.min(y.start+y.count,p.start+p.count));for(let _=v,T=b;_<T;_+=3){const E=a.getX(_),M=a.getX(_+1),I=a.getX(_+2);s=Zv(this,A,e,i,l,h,d,E,M,I),s&&(s.faceIndex=Math.floor(_/3),s.face.materialIndex=y.materialIndex,t.push(s))}}else{const m=Math.max(0,p.start),g=Math.min(a.count,p.start+p.count);for(let y=m,A=g;y<A;y+=3){const v=a.getX(y),b=a.getX(y+1),_=a.getX(y+2);s=Zv(this,o,e,i,l,h,d,v,b,_),s&&(s.faceIndex=Math.floor(y/3),t.push(s))}}else if(c!==void 0)if(Array.isArray(o))for(let m=0,g=f.length;m<g;m++){const y=f[m],A=o[y.materialIndex],v=Math.max(y.start,p.start),b=Math.min(c.count,Math.min(y.start+y.count,p.start+p.count));for(let _=v,T=b;_<T;_+=3){const E=_,M=_+1,I=_+2;s=Zv(this,A,e,i,l,h,d,E,M,I),s&&(s.faceIndex=Math.floor(_/3),s.face.materialIndex=y.materialIndex,t.push(s))}}else{const m=Math.max(0,p.start),g=Math.min(c.count,p.start+p.count);for(let y=m,A=g;y<A;y+=3){const v=y,b=y+1,_=y+2;s=Zv(this,o,e,i,l,h,d,v,b,_),s&&(s.faceIndex=Math.floor(y/3),t.push(s))}}}}function UV(n,e,t,i,s,r,o,a){let c;if(e.side===mn?c=i.intersectTriangle(o,r,s,!0,a):c=i.intersectTriangle(s,r,o,e.side===Es,a),c===null)return null;Kv.copy(a),Kv.applyMatrix4(n.matrixWorld);const l=t.ray.origin.distanceTo(Kv);return l<t.near||l>t.far?null:{distance:l,point:Kv.clone(),object:n}}function Zv(n,e,t,i,s,r,o,a,c,l){n.getVertexPosition(a,Xd),n.getVertexPosition(c,Yd),n.getVertexPosition(l,Jd);const h=UV(n,e,t,i,Xd,Yd,Jd,Jv);if(h){s&&(qv.fromBufferAttribute(s,a),Xv.fromBufferAttribute(s,c),Yv.fromBufferAttribute(s,l),h.uv=dr.getInterpolation(Jv,Xd,Yd,Jd,qv,Xv,Yv,new ie)),r&&(qv.fromBufferAttribute(r,a),Xv.fromBufferAttribute(r,c),Yv.fromBufferAttribute(r,l),h.uv1=dr.getInterpolation(Jv,Xd,Yd,Jd,qv,Xv,Yv,new ie),h.uv2=h.uv1),o&&(OR.fromBufferAttribute(o,a),kR.fromBufferAttribute(o,c),LR.fromBufferAttribute(o,l),h.normal=dr.getInterpolation(Jv,Xd,Yd,Jd,OR,kR,LR,new w),h.normal.dot(i.direction)>0&&h.normal.multiplyScalar(-1));const d={a,b:c,c:l,normal:new w,materialIndex:0};dr.getNormal(Xd,Yd,Jd,d.normal),h.face=d}return h}class Ni extends gt{constructor(e=1,t=1,i=1,s=1,r=1,o=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:i,widthSegments:s,heightSegments:r,depthSegments:o};const a=this;s=Math.floor(s),r=Math.floor(r),o=Math.floor(o);const c=[],l=[],h=[],d=[];let f=0,p=0;m("z","y","x",-1,-1,i,t,e,o,r,0),m("z","y","x",1,-1,i,t,-e,o,r,1),m("x","z","y",1,1,e,i,t,s,o,2),m("x","z","y",1,-1,e,i,-t,s,o,3),m("x","y","z",1,-1,e,t,i,s,r,4),m("x","y","z",-1,-1,e,t,-i,s,r,5),this.setIndex(c),this.setAttribute("position",new ot(l,3)),this.setAttribute("normal",new ot(h,3)),this.setAttribute("uv",new ot(d,2));function m(g,y,A,v,b,_,T,E,M,I,S){const C=_/M,D=T/I,G=_/2,Q=T/2,L=E/2,V=M+1,O=I+1;let U=0,H=0;const Y=new w;for(let J=0;J<O;J++){const se=J*D-Q;for(let fe=0;fe<V;fe++){const _e=fe*C-G;Y[g]=_e*v,Y[y]=se*b,Y[A]=L,l.push(Y.x,Y.y,Y.z),Y[g]=0,Y[y]=0,Y[A]=E>0?1:-1,h.push(Y.x,Y.y,Y.z),d.push(fe/M),d.push(1-J/I),U+=1}}for(let J=0;J<I;J++)for(let se=0;se<M;se++){const fe=f+se+V*J,_e=f+se+V*(J+1),Oe=f+(se+1)+V*(J+1),qe=f+(se+1)+V*J;c.push(fe,_e,qe),c.push(_e,Oe,qe),H+=6}a.addGroup(p,H,S),p+=H,f+=U}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Ni(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function pp(n){const e={};for(const t in n){e[t]={};for(const i in n[t]){const s=n[t][i];s&&(s.isColor||s.isMatrix3||s.isMatrix4||s.isVector2||s.isVector3||s.isVector4||s.isTexture||s.isQuaternion)?s.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),e[t][i]=null):e[t][i]=s.clone():Array.isArray(s)?e[t][i]=s.slice():e[t][i]=s}}return e}function cr(n){const e={};for(let t=0;t<n.length;t++){const i=pp(n[t]);for(const s in i)e[s]=i[s]}return e}function NV(n){const e=[];for(let t=0;t<n.length;t++)e.push(n[t].clone());return e}function d2(n){return n.getRenderTarget()===null?n.outputColorSpace:_i.workingColorSpace}const Ep={clone:pp,merge:cr};var zV=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,GV=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`;class Et extends Ot{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=zV,this.fragmentShader=GV,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1,clipCullDistance:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,e!==void 0&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=pp(e.uniforms),this.uniformsGroups=NV(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.occlusion=e.occlusion,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(const s in this.uniforms){const o=this.uniforms[s].value;o&&o.isTexture?t.uniforms[s]={type:"t",value:o.toJSON(e).uuid}:o&&o.isColor?t.uniforms[s]={type:"c",value:o.getHex()}:o&&o.isVector2?t.uniforms[s]={type:"v2",value:o.toArray()}:o&&o.isVector3?t.uniforms[s]={type:"v3",value:o.toArray()}:o&&o.isVector4?t.uniforms[s]={type:"v4",value:o.toArray()}:o&&o.isMatrix3?t.uniforms[s]={type:"m3",value:o.toArray()}:o&&o.isMatrix4?t.uniforms[s]={type:"m4",value:o.toArray()}:t.uniforms[s]={value:o}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader,t.lights=this.lights,t.clipping=this.clipping;const i={};for(const s in this.extensions)this.extensions[s]===!0&&(i[s]=!0);return Object.keys(i).length>0&&(t.extensions=i),t}}let LA=class extends ge{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new Ce,this.projectionMatrix=new Ce,this.projectionMatrixInverse=new Ce,this.coordinateSystem=ic}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this.coordinateSystem=e.coordinateSystem,this}getWorldDirection(e){return super.getWorldDirection(e).negate()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}};const Yl=new w,FR=new ie,UR=new ie;class Wt extends LA{constructor(e=50,t=1,i=.1,s=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=i,this.far=s,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=e.view===null?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const t=.5*this.getFilmHeight()/e;this.fov=fp*2*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(qu*.5*this.fov);return .5*this.getFilmHeight()/e}getEffectiveFOV(){return fp*2*Math.atan(Math.tan(qu*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}getViewBounds(e,t,i){Yl.set(-1,-1,.5).applyMatrix4(this.projectionMatrixInverse),t.set(Yl.x,Yl.y).multiplyScalar(-e/Yl.z),Yl.set(1,1,.5).applyMatrix4(this.projectionMatrixInverse),i.set(Yl.x,Yl.y).multiplyScalar(-e/Yl.z)}getViewSize(e,t){return this.getViewBounds(e,FR,UR),t.subVectors(UR,FR)}setViewOffset(e,t,i,s,r,o){this.aspect=e/t,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=s,this.view.width=r,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let t=e*Math.tan(qu*.5*this.fov)/this.zoom,i=2*t,s=this.aspect*i,r=-.5*s;const o=this.view;if(this.view!==null&&this.view.enabled){const c=o.fullWidth,l=o.fullHeight;r+=o.offsetX*s/c,t-=o.offsetY*i/l,s*=o.width/c,i*=o.height/l}const a=this.filmOffset;a!==0&&(r+=e*a/this.getFilmWidth()),this.projectionMatrix.makePerspective(r,r+s,t,t-i,e,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,this.view!==null&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}const Kd=-90,Zd=1;class _M extends ge{constructor(e,t,i){super(),this.type="CubeCamera",this.renderTarget=i,this.coordinateSystem=null,this.activeMipmapLevel=0;const s=new Wt(Kd,Zd,e,t);s.layers=this.layers,this.add(s);const r=new Wt(Kd,Zd,e,t);r.layers=this.layers,this.add(r);const o=new Wt(Kd,Zd,e,t);o.layers=this.layers,this.add(o);const a=new Wt(Kd,Zd,e,t);a.layers=this.layers,this.add(a);const c=new Wt(Kd,Zd,e,t);c.layers=this.layers,this.add(c);const l=new Wt(Kd,Zd,e,t);l.layers=this.layers,this.add(l)}updateCoordinateSystem(){const e=this.coordinateSystem,t=this.children.concat(),[i,s,r,o,a,c]=t;for(const l of t)this.remove(l);if(e===ic)i.up.set(0,1,0),i.lookAt(1,0,0),s.up.set(0,1,0),s.lookAt(-1,0,0),r.up.set(0,0,-1),r.lookAt(0,1,0),o.up.set(0,0,1),o.lookAt(0,-1,0),a.up.set(0,1,0),a.lookAt(0,0,1),c.up.set(0,1,0),c.lookAt(0,0,-1);else if(e===Kg)i.up.set(0,-1,0),i.lookAt(-1,0,0),s.up.set(0,-1,0),s.lookAt(1,0,0),r.up.set(0,0,1),r.lookAt(0,1,0),o.up.set(0,0,-1),o.lookAt(0,-1,0),a.up.set(0,-1,0),a.lookAt(0,0,1),c.up.set(0,-1,0),c.lookAt(0,0,-1);else throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+e);for(const l of t)this.add(l),l.updateMatrixWorld()}update(e,t){this.parent===null&&this.updateMatrixWorld();const{renderTarget:i,activeMipmapLevel:s}=this;this.coordinateSystem!==e.coordinateSystem&&(this.coordinateSystem=e.coordinateSystem,this.updateCoordinateSystem());const[r,o,a,c,l,h]=this.children,d=e.getRenderTarget(),f=e.getActiveCubeFace(),p=e.getActiveMipmapLevel(),m=e.xr.enabled;e.xr.enabled=!1;const g=i.texture.generateMipmaps;i.texture.generateMipmaps=!1,e.setRenderTarget(i,0,s),e.render(t,r),e.setRenderTarget(i,1,s),e.render(t,o),e.setRenderTarget(i,2,s),e.render(t,a),e.setRenderTarget(i,3,s),e.render(t,c),e.setRenderTarget(i,4,s),e.render(t,l),i.texture.generateMipmaps=g,e.setRenderTarget(i,5,s),e.render(t,h),e.setRenderTarget(d,f,p),e.xr.enabled=m,i.texture.needsPMREMUpdate=!0}}class FA extends Ft{constructor(e,t,i,s,r,o,a,c,l,h){e=e!==void 0?e:[],t=t!==void 0?t:_l,super(e,t,i,s,r,o,a,c,l,h),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}class xM extends Zt{constructor(e=1,t={}){super(e,e,t),this.isWebGLCubeRenderTarget=!0;const i={width:e,height:e,depth:1},s=[i,i,i,i,i,i];t.encoding!==void 0&&(Xu("THREE.WebGLCubeRenderTarget: option.encoding has been replaced by option.colorSpace."),t.colorSpace=t.encoding===ac?zt:is),this.texture=new FA(s,t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=t.generateMipmaps!==void 0?t.generateMipmaps:!1,this.texture.minFilter=t.minFilter!==void 0?t.minFilter:St}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.colorSpace=t.colorSpace,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const i={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},s=new Ni(5,5,5),r=new Et({name:"CubemapFromEquirect",uniforms:pp(i.uniforms),vertexShader:i.vertexShader,fragmentShader:i.fragmentShader,side:mn,blending:rn});r.uniforms.tEquirect.value=t;const o=new me(s,r),a=t.minFilter;return t.minFilter===kr&&(t.minFilter=St),new _M(1,10,this).update(e,o),t.minFilter=a,o.geometry.dispose(),o.material.dispose(),this}clear(e,t,i,s){const r=e.getRenderTarget();for(let o=0;o<6;o++)e.setRenderTarget(this,o),e.clear(t,i,s);e.setRenderTarget(r)}}const Gw=new w,VV=new w,HV=new Dt;class hr{constructor(e=new w(1,0,0),t=0){this.isPlane=!0,this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,i,s){return this.normal.set(e,t,i),this.constant=s,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,i){const s=Gw.subVectors(i,t).cross(VV.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(s,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(e).addScaledVector(this.normal,-this.distanceToPoint(e))}intersectLine(e,t){const i=e.delta(Gw),s=this.normal.dot(i);if(s===0)return this.distanceToPoint(e.start)===0?t.copy(e.start):null;const r=-(e.start.dot(this.normal)+this.constant)/s;return r<0||r>1?null:t.copy(e.start).addScaledVector(i,r)}intersectsLine(e){const t=this.distanceToPoint(e.start),i=this.distanceToPoint(e.end);return t<0&&i>0||i<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){const i=t||HV.getNormalMatrix(e),s=this.coplanarPoint(Gw).applyMatrix4(e),r=this.normal.applyMatrix3(i).normalize();return this.constant=-s.dot(r),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return new this.constructor().copy(this)}}const lu=new Mn,$v=new w;class UA{constructor(e=new hr,t=new hr,i=new hr,s=new hr,r=new hr,o=new hr){this.planes=[e,t,i,s,r,o]}set(e,t,i,s,r,o){const a=this.planes;return a[0].copy(e),a[1].copy(t),a[2].copy(i),a[3].copy(s),a[4].copy(r),a[5].copy(o),this}copy(e){const t=this.planes;for(let i=0;i<6;i++)t[i].copy(e.planes[i]);return this}setFromProjectionMatrix(e,t=ic){const i=this.planes,s=e.elements,r=s[0],o=s[1],a=s[2],c=s[3],l=s[4],h=s[5],d=s[6],f=s[7],p=s[8],m=s[9],g=s[10],y=s[11],A=s[12],v=s[13],b=s[14],_=s[15];if(i[0].setComponents(c-r,f-l,y-p,_-A).normalize(),i[1].setComponents(c+r,f+l,y+p,_+A).normalize(),i[2].setComponents(c+o,f+h,y+m,_+v).normalize(),i[3].setComponents(c-o,f-h,y-m,_-v).normalize(),i[4].setComponents(c-a,f-d,y-g,_-b).normalize(),t===ic)i[5].setComponents(c+a,f+d,y+g,_+b).normalize();else if(t===Kg)i[5].setComponents(a,d,g,b).normalize();else throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+t);return this}intersectsObject(e){if(e.boundingSphere!==void 0)e.boundingSphere===null&&e.computeBoundingSphere(),lu.copy(e.boundingSphere).applyMatrix4(e.matrixWorld);else{const t=e.geometry;t.boundingSphere===null&&t.computeBoundingSphere(),lu.copy(t.boundingSphere).applyMatrix4(e.matrixWorld)}return this.intersectsSphere(lu)}intersectsSprite(e){return lu.center.set(0,0,0),lu.radius=.7071067811865476,lu.applyMatrix4(e.matrixWorld),this.intersectsSphere(lu)}intersectsSphere(e){const t=this.planes,i=e.center,s=-e.radius;for(let r=0;r<6;r++)if(t[r].distanceToPoint(i)<s)return!1;return!0}intersectsBox(e){const t=this.planes;for(let i=0;i<6;i++){const s=t[i];if($v.x=s.normal.x>0?e.max.x:e.min.x,$v.y=s.normal.y>0?e.max.y:e.min.y,$v.z=s.normal.z>0?e.max.z:e.min.z,s.distanceToPoint($v)<0)return!1}return!0}containsPoint(e){const t=this.planes;for(let i=0;i<6;i++)if(t[i].distanceToPoint(e)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}function f2(){let n=null,e=!1,t=null,i=null;function s(r,o){t(r,o),i=n.requestAnimationFrame(s)}return{start:function(){e!==!0&&t!==null&&(i=n.requestAnimationFrame(s),e=!0)},stop:function(){n.cancelAnimationFrame(i),e=!1},setAnimationLoop:function(r){t=r},setContext:function(r){n=r}}}function QV(n,e){const t=e.isWebGL2,i=new WeakMap;function s(l,h){const d=l.array,f=l.usage,p=d.byteLength,m=n.createBuffer();n.bindBuffer(h,m),n.bufferData(h,d,f),l.onUploadCallback();let g;if(d instanceof Float32Array)g=n.FLOAT;else if(d instanceof Uint16Array)if(l.isFloat16BufferAttribute)if(t)g=n.HALF_FLOAT;else throw new Error("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2.");else g=n.UNSIGNED_SHORT;else if(d instanceof Int16Array)g=n.SHORT;else if(d instanceof Uint32Array)g=n.UNSIGNED_INT;else if(d instanceof Int32Array)g=n.INT;else if(d instanceof Int8Array)g=n.BYTE;else if(d instanceof Uint8Array)g=n.UNSIGNED_BYTE;else if(d instanceof Uint8ClampedArray)g=n.UNSIGNED_BYTE;else throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+d);return{buffer:m,type:g,bytesPerElement:d.BYTES_PER_ELEMENT,version:l.version,size:p}}function r(l,h,d){const f=h.array,p=h._updateRange,m=h.updateRanges;if(n.bindBuffer(d,l),p.count===-1&&m.length===0&&n.bufferSubData(d,0,f),m.length!==0){for(let g=0,y=m.length;g<y;g++){const A=m[g];t?n.bufferSubData(d,A.start*f.BYTES_PER_ELEMENT,f,A.start,A.count):n.bufferSubData(d,A.start*f.BYTES_PER_ELEMENT,f.subarray(A.start,A.start+A.count))}h.clearUpdateRanges()}p.count!==-1&&(t?n.bufferSubData(d,p.offset*f.BYTES_PER_ELEMENT,f,p.offset,p.count):n.bufferSubData(d,p.offset*f.BYTES_PER_ELEMENT,f.subarray(p.offset,p.offset+p.count)),p.count=-1),h.onUploadCallback()}function o(l){return l.isInterleavedBufferAttribute&&(l=l.data),i.get(l)}function a(l){l.isInterleavedBufferAttribute&&(l=l.data);const h=i.get(l);h&&(n.deleteBuffer(h.buffer),i.delete(l))}function c(l,h){if(l.isGLBufferAttribute){const f=i.get(l);(!f||f.version<l.version)&&i.set(l,{buffer:l.buffer,type:l.type,bytesPerElement:l.elementSize,version:l.version});return}l.isInterleavedBufferAttribute&&(l=l.data);const d=i.get(l);if(d===void 0)i.set(l,s(l,h));else if(d.version<l.version){if(d.size!==l.array.byteLength)throw new Error("THREE.WebGLAttributes: The size of the buffer attribute's array buffer does not match the original size. Resizing buffer attributes is not supported.");r(d.buffer,l,h),d.version=l.version}}return{get:o,remove:a,update:c}}class Wn extends gt{constructor(e=1,t=1,i=1,s=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:i,heightSegments:s};const r=e/2,o=t/2,a=Math.floor(i),c=Math.floor(s),l=a+1,h=c+1,d=e/a,f=t/c,p=[],m=[],g=[],y=[];for(let A=0;A<h;A++){const v=A*f-o;for(let b=0;b<l;b++){const _=b*d-r;m.push(_,-v,0),g.push(0,0,1),y.push(b/a),y.push(1-A/c)}}for(let A=0;A<c;A++)for(let v=0;v<a;v++){const b=v+l*A,_=v+l*(A+1),T=v+1+l*(A+1),E=v+1+l*A;p.push(b,_,E),p.push(_,T,E)}this.setIndex(p),this.setAttribute("position",new ot(m,3)),this.setAttribute("normal",new ot(g,3)),this.setAttribute("uv",new ot(y,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Wn(e.width,e.height,e.widthSegments,e.heightSegments)}}var jV=`#ifdef USE_ALPHAHASH
	if ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;
#endif`,WV=`#ifdef USE_ALPHAHASH
	const float ALPHA_HASH_SCALE = 0.05;
	float hash2D( vec2 value ) {
		return fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );
	}
	float hash3D( vec3 value ) {
		return hash2D( vec2( hash2D( value.xy ), value.z ) );
	}
	float getAlphaHashThreshold( vec3 position ) {
		float maxDeriv = max(
			length( dFdx( position.xyz ) ),
			length( dFdy( position.xyz ) )
		);
		float pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );
		vec2 pixScales = vec2(
			exp2( floor( log2( pixScale ) ) ),
			exp2( ceil( log2( pixScale ) ) )
		);
		vec2 alpha = vec2(
			hash3D( floor( pixScales.x * position.xyz ) ),
			hash3D( floor( pixScales.y * position.xyz ) )
		);
		float lerpFactor = fract( log2( pixScale ) );
		float x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;
		float a = min( lerpFactor, 1.0 - lerpFactor );
		vec3 cases = vec3(
			x * x / ( 2.0 * a * ( 1.0 - a ) ),
			( x - 0.5 * a ) / ( 1.0 - a ),
			1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )
		);
		float threshold = ( x < ( 1.0 - a ) )
			? ( ( x < a ) ? cases.x : cases.y )
			: cases.z;
		return clamp( threshold , 1.0e-6, 1.0 );
	}
#endif`,qV=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;
#endif`,XV=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,YV=`#ifdef USE_ALPHATEST
	#ifdef ALPHA_TO_COVERAGE
	diffuseColor.a = smoothstep( alphaTest, alphaTest + fwidth( diffuseColor.a ), diffuseColor.a );
	if ( diffuseColor.a == 0.0 ) discard;
	#else
	if ( diffuseColor.a < alphaTest ) discard;
	#endif
#endif`,JV=`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,KV=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_CLEARCOAT ) 
		clearcoatSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_SHEEN ) 
		sheenSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometryNormal, geometryViewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,ZV=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,$V=`#ifdef USE_BATCHING
	attribute float batchId;
	uniform highp sampler2D batchingTexture;
	mat4 getBatchingMatrix( const in float i ) {
		int size = textureSize( batchingTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( batchingTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( batchingTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( batchingTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( batchingTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
#endif`,e4=`#ifdef USE_BATCHING
	mat4 batchingMatrix = getBatchingMatrix( batchId );
#endif`,t4=`vec3 transformed = vec3( position );
#ifdef USE_ALPHAHASH
	vPosition = vec3( position );
#endif`,i4=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,n4=`float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
} // validated`,s4=`#ifdef USE_IRIDESCENCE
	const mat3 XYZ_TO_REC709 = mat3(
		 3.2404542, -0.9692660,  0.0556434,
		-1.5371385,  1.8760108, -0.2040259,
		-0.4985314,  0.0415560,  1.0572252
	);
	vec3 Fresnel0ToIor( vec3 fresnel0 ) {
		vec3 sqrtF0 = sqrt( fresnel0 );
		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );
	}
	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );
	}
	float IorToFresnel0( float transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));
	}
	vec3 evalSensitivity( float OPD, vec3 shift ) {
		float phase = 2.0 * PI * OPD * 1.0e-9;
		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );
		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );
		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );
		xyz /= 1.0685e-7;
		vec3 rgb = XYZ_TO_REC709 * xyz;
		return rgb;
	}
	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {
		vec3 I;
		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );
		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );
		float cosTheta2Sq = 1.0 - sinTheta2Sq;
		if ( cosTheta2Sq < 0.0 ) {
			return vec3( 1.0 );
		}
		float cosTheta2 = sqrt( cosTheta2Sq );
		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );
		float R12 = F_Schlick( R0, 1.0, cosTheta1 );
		float T121 = 1.0 - R12;
		float phi12 = 0.0;
		if ( iridescenceIOR < outsideIOR ) phi12 = PI;
		float phi21 = PI - phi12;
		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );
		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );
		vec3 phi23 = vec3( 0.0 );
		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;
		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;
		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;
		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;
		vec3 phi = vec3( phi21 ) + phi23;
		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
		vec3 r123 = sqrt( R123 );
		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );
		vec3 C0 = R12 + Rs;
		I = C0;
		vec3 Cm = Rs - T121;
		for ( int m = 1; m <= 2; ++ m ) {
			Cm *= r123;
			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
			I += Cm * Sm;
		}
		return max( I, vec3( 0.0 ) );
	}
#endif`,r4=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vBumpMapUv );
		vec2 dSTdy = dFdy( vBumpMapUv );
		float Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = normalize( dFdx( surf_pos.xyz ) );
		vec3 vSigmaY = normalize( dFdy( surf_pos.xyz ) );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,o4=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#ifdef ALPHA_TO_COVERAGE
		float distanceToPlane, distanceGradient;
		float clipOpacity = 1.0;
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
			distanceGradient = fwidth( distanceToPlane ) / 2.0;
			clipOpacity *= smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			if ( clipOpacity == 0.0 ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			float unionClipOpacity = 1.0;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
				distanceGradient = fwidth( distanceToPlane ) / 2.0;
				unionClipOpacity *= 1.0 - smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			}
			#pragma unroll_loop_end
			clipOpacity *= 1.0 - unionClipOpacity;
		#endif
		diffuseColor.a *= clipOpacity;
		if ( diffuseColor.a == 0.0 ) discard;
	#else
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			bool clipped = true;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
			}
			#pragma unroll_loop_end
			if ( clipped ) discard;
		#endif
	#endif
#endif`,a4=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,c4=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,l4=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,h4=`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,u4=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,d4=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	varying vec3 vColor;
#endif`,f4=`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif`,p4=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
vec3 pow2( const in vec3 x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
#ifdef USE_ALPHAHASH
	varying vec3 vPosition;
#endif
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
float luminance( const in vec3 rgb ) {
	const vec3 weights = vec3( 0.2126729, 0.7151522, 0.0721750 );
	return dot( weights, rgb );
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}
vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float F_Schlick( const in float f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
} // validated`,m4=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		highp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define cubeUV_r0 1.0
	#define cubeUV_m0 - 2.0
	#define cubeUV_r1 0.8
	#define cubeUV_m1 - 1.0
	#define cubeUV_r4 0.4
	#define cubeUV_m4 2.0
	#define cubeUV_r5 0.305
	#define cubeUV_m5 3.0
	#define cubeUV_r6 0.21
	#define cubeUV_m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= cubeUV_r1 ) {
			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;
		} else if ( roughness >= cubeUV_r4 ) {
			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;
		} else if ( roughness >= cubeUV_r5 ) {
			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;
		} else if ( roughness >= cubeUV_r6 ) {
			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,g4=`vec3 transformedNormal = objectNormal;
#ifdef USE_TANGENT
	vec3 transformedTangent = objectTangent;
#endif
#ifdef USE_BATCHING
	mat3 bm = mat3( batchingMatrix );
	transformedNormal /= vec3( dot( bm[ 0 ], bm[ 0 ] ), dot( bm[ 1 ], bm[ 1 ] ), dot( bm[ 2 ], bm[ 2 ] ) );
	transformedNormal = bm * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = bm * transformedTangent;
	#endif
#endif
#ifdef USE_INSTANCING
	mat3 im = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( im[ 0 ], im[ 0 ] ), dot( im[ 1 ], im[ 1 ] ), dot( im[ 2 ], im[ 2 ] ) );
	transformedNormal = im * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = im * transformedTangent;
	#endif
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	transformedTangent = ( modelViewMatrix * vec4( transformedTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,A4=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,v4=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );
#endif`,y4=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,b4=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,_4="gl_FragColor = linearToOutputTexel( gl_FragColor );",x4=`
const mat3 LINEAR_SRGB_TO_LINEAR_DISPLAY_P3 = mat3(
	vec3( 0.8224621, 0.177538, 0.0 ),
	vec3( 0.0331941, 0.9668058, 0.0 ),
	vec3( 0.0170827, 0.0723974, 0.9105199 )
);
const mat3 LINEAR_DISPLAY_P3_TO_LINEAR_SRGB = mat3(
	vec3( 1.2249401, - 0.2249404, 0.0 ),
	vec3( - 0.0420569, 1.0420571, 0.0 ),
	vec3( - 0.0196376, - 0.0786361, 1.0982735 )
);
vec4 LinearSRGBToLinearDisplayP3( in vec4 value ) {
	return vec4( value.rgb * LINEAR_SRGB_TO_LINEAR_DISPLAY_P3, value.a );
}
vec4 LinearDisplayP3ToLinearSRGB( in vec4 value ) {
	return vec4( value.rgb * LINEAR_DISPLAY_P3_TO_LINEAR_SRGB, value.a );
}
vec4 LinearTransferOETF( in vec4 value ) {
	return value;
}
vec4 sRGBTransferOETF( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}
vec4 LinearToLinear( in vec4 value ) {
	return value;
}
vec4 LinearTosRGB( in vec4 value ) {
	return sRGBTransferOETF( value );
}`,w4=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,S4=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,C4=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,E4=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,T4=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,M4=`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,I4=`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,R4=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,P4=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,B4=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		vec2 fw = fwidth( coord ) * 0.5;
		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );
	#endif
}`,D4=`#ifdef USE_LIGHTMAP
	vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
	vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
	reflectedLight.indirectDiffuse += lightMapIrradiance;
#endif`,O4=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,k4=`LambertMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularStrength = specularStrength;`,L4=`varying vec3 vViewPosition;
struct LambertMaterial {
	vec3 diffuseColor;
	float specularStrength;
};
void RE_Direct_Lambert( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Lambert
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert`,F4=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
#if defined( USE_LIGHT_PROBES )
	uniform vec3 lightProbe[ 9 ];
#endif
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	#if defined ( LEGACY_LIGHTS )
		if ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {
			return pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );
		}
		return 1.0;
	#else
		float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
		if ( cutoffDistance > 0.0 ) {
			distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
		}
		return distanceFalloff;
	#endif
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,U4=`#ifdef USE_ENVMAP
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	#ifdef USE_ANISOTROPY
		vec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {
			#ifdef ENVMAP_TYPE_CUBE_UV
				vec3 bentNormal = cross( bitangent, viewDir );
				bentNormal = normalize( cross( bentNormal, bitangent ) );
				bentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );
				return getIBLRadiance( viewDir, bentNormal, roughness );
			#else
				return vec3( 0.0 );
			#endif
		}
	#endif
#endif`,N4=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,z4=`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometryNormal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon`,G4=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,V4=`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometryViewDir, geometryNormal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong`,H4=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( nonPerturbedNormal ) ), abs( dFdy( nonPerturbedNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	material.ior = ior;
	#ifdef USE_SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULAR_COLORMAP
			specularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;
		#endif
		#ifdef USE_SPECULAR_INTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_IRIDESCENCE
	material.iridescence = iridescence;
	material.iridescenceIOR = iridescenceIOR;
	#ifdef USE_IRIDESCENCEMAP
		material.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;
	#endif
	#ifdef USE_IRIDESCENCE_THICKNESSMAP
		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;
	#else
		material.iridescenceThickness = iridescenceThicknessMaximum;
	#endif
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEEN_COLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
	#ifdef USE_SHEEN_ROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;
	#endif
#endif
#ifdef USE_ANISOTROPY
	#ifdef USE_ANISOTROPYMAP
		mat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );
		vec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;
		vec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;
	#else
		vec2 anisotropyV = anisotropyVector;
	#endif
	material.anisotropy = length( anisotropyV );
	if( material.anisotropy == 0.0 ) {
		anisotropyV = vec2( 1.0, 0.0 );
	} else {
		anisotropyV /= material.anisotropy;
		material.anisotropy = saturate( material.anisotropy );
	}
	material.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );
	material.anisotropyT = tbn[ 0 ] * anisotropyV.x + tbn[ 1 ] * anisotropyV.y;
	material.anisotropyB = tbn[ 1 ] * anisotropyV.x - tbn[ 0 ] * anisotropyV.y;
#endif`,Q4=`struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_IRIDESCENCE
		float iridescence;
		float iridescenceIOR;
		float iridescenceThickness;
		vec3 iridescenceFresnel;
		vec3 iridescenceF0;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
	#ifdef IOR
		float ior;
	#endif
	#ifdef USE_TRANSMISSION
		float transmission;
		float transmissionAlpha;
		float thickness;
		float attenuationDistance;
		vec3 attenuationColor;
	#endif
	#ifdef USE_ANISOTROPY
		float anisotropy;
		float alphaT;
		vec3 anisotropyT;
		vec3 anisotropyB;
	#endif
};
vec3 clearcoatSpecularDirect = vec3( 0.0 );
vec3 clearcoatSpecularIndirect = vec3( 0.0 );
vec3 sheenSpecularDirect = vec3( 0.0 );
vec3 sheenSpecularIndirect = vec3(0.0 );
vec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {
    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );
    float x2 = x * x;
    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );
    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
#ifdef USE_ANISOTROPY
	float V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {
		float gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );
		float gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );
		float v = 0.5 / ( gv + gl );
		return saturate(v);
	}
	float D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {
		float a2 = alphaT * alphaB;
		highp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );
		highp float v2 = dot( v, v );
		float w2 = a2 / v2;
		return RECIPROCAL_PI * a2 * pow2 ( w2 );
	}
#endif
#ifdef USE_CLEARCOAT
	vec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {
		vec3 f0 = material.clearcoatF0;
		float f90 = material.clearcoatF90;
		float roughness = material.clearcoatRoughness;
		float alpha = pow2( roughness );
		vec3 halfDir = normalize( lightDir + viewDir );
		float dotNL = saturate( dot( normal, lightDir ) );
		float dotNV = saturate( dot( normal, viewDir ) );
		float dotNH = saturate( dot( normal, halfDir ) );
		float dotVH = saturate( dot( viewDir, halfDir ) );
		vec3 F = F_Schlick( f0, f90, dotVH );
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
		return F * ( V * D );
	}
#endif
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {
	vec3 f0 = material.specularColor;
	float f90 = material.specularF90;
	float roughness = material.roughness;
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	#ifdef USE_IRIDESCENCE
		F = mix( F, material.iridescenceFresnel, material.iridescence );
	#endif
	#ifdef USE_ANISOTROPY
		float dotTL = dot( material.anisotropyT, lightDir );
		float dotTV = dot( material.anisotropyT, viewDir );
		float dotTH = dot( material.anisotropyT, halfDir );
		float dotBL = dot( material.anisotropyB, lightDir );
		float dotBV = dot( material.anisotropyB, viewDir );
		float dotBH = dot( material.anisotropyB, halfDir );
		float V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );
		float D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );
	#else
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
	#endif
	return F * ( V * D );
}
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;
	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;
	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );
	return saturate( DG * RECIPROCAL_PI );
}
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;
	return fab;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
#ifdef USE_IRIDESCENCE
void computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#else
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#endif
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	#ifdef USE_IRIDESCENCE
		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );
	#else
		vec3 Fr = specularColor;
	#endif
	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometryNormal;
		vec3 viewDir = geometryViewDir;
		vec3 position = geometryPosition;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometryClearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecularDirect += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometryViewDir, geometryClearcoatNormal, material );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularDirect += irradiance * BRDF_Sheen( directLight.direction, geometryViewDir, geometryNormal, material.sheenColor, material.sheenRoughness );
	#endif
	reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometryViewDir, geometryNormal, material );
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecularIndirect += clearcoatRadiance * EnvironmentBRDF( geometryClearcoatNormal, geometryViewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularIndirect += irradiance * material.sheenColor * IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	#ifdef USE_IRIDESCENCE
		computeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );
	#else
		computeMultiscattering( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	#endif
	vec3 totalScattering = singleScattering + multiScattering;
	vec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,j4=`
vec3 geometryPosition = - vViewPosition;
vec3 geometryNormal = normal;
vec3 geometryViewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
vec3 geometryClearcoatNormal = vec3( 0.0 );
#ifdef USE_CLEARCOAT
	geometryClearcoatNormal = clearcoatNormal;
#endif
#ifdef USE_IRIDESCENCE
	float dotNVi = saturate( dot( normal, geometryViewDir ) );
	if ( material.iridescenceThickness == 0.0 ) {
		material.iridescence = 0.0;
	} else {
		material.iridescence = saturate( material.iridescence );
	}
	if ( material.iridescence > 0.0 ) {
		material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
	}
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometryPosition, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	vec4 spotColor;
	vec3 spotLightCoord;
	bool inSpotLightMap;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometryPosition, directLight );
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX
		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS
		#else
		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#endif
		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )
			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;
			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );
			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );
			directLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;
		#endif
		#undef SPOT_LIGHT_MAP_INDEX
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	#if defined( USE_LIGHT_PROBES )
		irradiance += getLightProbeIrradiance( lightProbe, geometryNormal );
	#endif
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometryNormal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,W4=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometryNormal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	#ifdef USE_ANISOTROPY
		radiance += getIBLAnisotropyRadiance( geometryViewDir, geometryNormal, material.roughness, material.anisotropyB, material.anisotropy );
	#else
		radiance += getIBLRadiance( geometryViewDir, geometryNormal, material.roughness );
	#endif
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometryViewDir, geometryClearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,q4=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif`,X4=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	gl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,Y4=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,J4=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		varying float vFragDepth;
		varying float vIsPerspective;
	#else
		uniform float logDepthBufFC;
	#endif
#endif`,K4=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		vFragDepth = 1.0 + gl_Position.w;
		vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
	#else
		if ( isPerspectiveMatrix( projectionMatrix ) ) {
			gl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;
			gl_Position.z *= gl_Position.w;
		}
	#endif
#endif`,Z4=`#ifdef USE_MAP
#ifdef USE_MIPMAP_BIAS
    vec4 sampledDiffuseColor = texture2D( map, vMapUv, mipmapBias );
#else
	vec4 sampledDiffuseColor = texture2D( map, vMapUv );
#endif
	#ifdef DECODE_VIDEO_TEXTURE
		sampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );
	
	#endif
	diffuseColor *= sampledDiffuseColor;
#endif`,$4=`#ifdef USE_MAP
	uniform sampler2D map;
        
#ifdef USE_MIPMAP_BIAS
    uniform float mipmapBias;
#endif
#endif`,eH=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	#if defined( USE_POINTS_UV )
		vec2 uv = vUv;
	#else
		vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
	#endif
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,tH=`#if defined( USE_POINTS_UV )
	varying vec2 vUv;
#else
	#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
		uniform mat3 uvTransform;
	#endif
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,iH=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );
	metalnessFactor *= texelMetalness.b;
#endif`,nH=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,sH=`#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,rH=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		objectNormal += morphNormal0 * morphTargetInfluences[ 0 ];
		objectNormal += morphNormal1 * morphTargetInfluences[ 1 ];
		objectNormal += morphNormal2 * morphTargetInfluences[ 2 ];
		objectNormal += morphNormal3 * morphTargetInfluences[ 3 ];
	#endif
#endif`,oH=`#ifdef USE_MORPHTARGETS
	uniform float morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
		uniform sampler2DArray morphTargetsTexture;
		uniform ivec2 morphTargetsTextureSize;
		vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
			int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
			int y = texelIndex / morphTargetsTextureSize.x;
			int x = texelIndex - y * morphTargetsTextureSize.x;
			ivec3 morphUV = ivec3( x, y, morphTargetIndex );
			return texelFetch( morphTargetsTexture, morphUV, 0 );
		}
	#else
		#ifndef USE_MORPHNORMALS
			uniform float morphTargetInfluences[ 8 ];
		#else
			uniform float morphTargetInfluences[ 4 ];
		#endif
	#endif
#endif`,aH=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		transformed += morphTarget0 * morphTargetInfluences[ 0 ];
		transformed += morphTarget1 * morphTargetInfluences[ 1 ];
		transformed += morphTarget2 * morphTargetInfluences[ 2 ];
		transformed += morphTarget3 * morphTargetInfluences[ 3 ];
		#ifndef USE_MORPHNORMALS
			transformed += morphTarget4 * morphTargetInfluences[ 4 ];
			transformed += morphTarget5 * morphTargetInfluences[ 5 ];
			transformed += morphTarget6 * morphTargetInfluences[ 6 ];
			transformed += morphTarget7 * morphTargetInfluences[ 7 ];
		#endif
	#endif
#endif`,cH=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = dFdx( vViewPosition );
	vec3 fdy = dFdy( vViewPosition );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal *= faceDirection;
	#endif
#endif
#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )
	#ifdef USE_TANGENT
		mat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn = getTangentFrame( - vViewPosition, normal,
		#if defined( USE_NORMALMAP )
			vNormalMapUv
		#elif defined( USE_CLEARCOAT_NORMALMAP )
			vClearcoatNormalMapUv
		#else
			vUv
		#endif
		);
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn[0] *= faceDirection;
		tbn[1] *= faceDirection;
	#endif
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	#ifdef USE_TANGENT
		mat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn2[0] *= faceDirection;
		tbn2[1] *= faceDirection;
	#endif
#endif
vec3 nonPerturbedNormal = normal;`,lH=`#ifdef USE_NORMALMAP_OBJECTSPACE
	normal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( USE_NORMALMAP_TANGENTSPACE )
	vec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	normal = normalize( tbn * mapN );
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,hH=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,uH=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,dH=`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,fH=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef USE_NORMALMAP_OBJECTSPACE
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )
	mat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {
		vec3 q0 = dFdx( eye_pos.xyz );
		vec3 q1 = dFdy( eye_pos.xyz );
		vec2 st0 = dFdx( uv.st );
		vec2 st1 = dFdy( uv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );
		return mat3( T * scale, B * scale, N );
	}
#endif`,pH=`#ifdef USE_OCCLUSION
    if (gl_FragColor.a > 0.0) {
        int arrayIndex = 0;
        vec2 depthUv;
        if (gl_FragCoord.x>=depthWidth) {
            arrayIndex = 1;
            depthUv = vec2((gl_FragCoord.x-depthWidth)/depthWidth, gl_FragCoord.y/depthHeight);
        } else {
            depthUv = vec2(gl_FragCoord.x/depthWidth, gl_FragCoord.y/depthHeight);
        }
        float assetDepthM = gl_FragCoord.z;
        
        float occlusion = Depth_GetBlurredOcclusionAroundUV(depthColor, depthUv, assetDepthM, arrayIndex);
        gl_FragColor *= 1.0 - occlusion;
    }
#endif`,mH=`#ifdef USE_OCCLUSION
    uniform sampler2DArray depthColor;
    uniform float depthWidth;
    uniform float depthHeight;
    float Depth_GetCameraDepthInMeters(const sampler2DArray depthTexture,
        const vec2 depthUv, int arrayIndex) {
        return texture(depthColor, vec3(depthUv.x, depthUv.y, arrayIndex)).r;
      }
    float Depth_GetOcclusion(const sampler2DArray depthTexture, const vec2 depthUv, float assetDepthM, int arrayIndex) {
        float depthMm = Depth_GetCameraDepthInMeters(depthTexture, depthUv, arrayIndex);
        const float kDepthTolerancePerM = 0.001;
        return clamp(1.0 -
            0.5 * (depthMm - assetDepthM) /
                (kDepthTolerancePerM * assetDepthM) +
            0.5, 0.0, 1.0);
    }
    float Depth_GetBlurredOcclusionAroundUV(const sampler2DArray depthTexture, const vec2 uv, float assetDepthM, int arrayIndex) {
    const float kKernelTotalWeights = 269.0;
    float sum = 0.0;
    const float kOcclusionBlurAmount = 0.0005;
    vec2 blurriness =
    vec2(kOcclusionBlurAmount, kOcclusionBlurAmount);
    float current = 0.0;
    current += Depth_GetOcclusion(
    depthTexture, uv + vec2(-1.0, -2.0) * blurriness, assetDepthM, arrayIndex);
    current += Depth_GetOcclusion(
    depthTexture, uv + vec2(+1.0, -2.0) * blurriness, assetDepthM, arrayIndex);
    current += Depth_GetOcclusion(
    depthTexture, uv + vec2(-1.0, +2.0) * blurriness, assetDepthM, arrayIndex);
    current += Depth_GetOcclusion(
    depthTexture, uv + vec2(+1.0, +2.0) * blurriness, assetDepthM, arrayIndex);
    current += Depth_GetOcclusion(
    depthTexture, uv + vec2(-2.0, +1.0) * blurriness, assetDepthM, arrayIndex);
    current += Depth_GetOcclusion(
    depthTexture, uv + vec2(+2.0, +1.0) * blurriness, assetDepthM, arrayIndex);
    current += Depth_GetOcclusion(
    depthTexture, uv + vec2(-2.0, -1.0) * blurriness, assetDepthM, arrayIndex);
    current += Depth_GetOcclusion(
    depthTexture, uv + vec2(+2.0, -1.0) * blurriness, assetDepthM, arrayIndex);
    sum += current * 4.0;
    current = 0.0;
    current += Depth_GetOcclusion(
    depthTexture, uv + vec2(-2.0, -0.0) * blurriness, assetDepthM, arrayIndex);
    current += Depth_GetOcclusion(
    depthTexture, uv + vec2(+2.0, +0.0) * blurriness, assetDepthM, arrayIndex);
    current += Depth_GetOcclusion(
    depthTexture, uv + vec2(+0.0, +2.0) * blurriness, assetDepthM, arrayIndex);
    current += Depth_GetOcclusion(
    depthTexture, uv + vec2(-0.0, -2.0) * blurriness, assetDepthM, arrayIndex);
    sum += current * 7.0;
    current = 0.0;
    current += Depth_GetOcclusion(
    depthTexture, uv + vec2(-1.0, -1.0) * blurriness, assetDepthM, arrayIndex);
    current += Depth_GetOcclusion(
    depthTexture, uv + vec2(+1.0, -1.0) * blurriness, assetDepthM, arrayIndex);
    current += Depth_GetOcclusion(
    depthTexture, uv + vec2(-1.0, +1.0) * blurriness, assetDepthM, arrayIndex);
    current += Depth_GetOcclusion(
    depthTexture, uv + vec2(+1.0, +1.0) * blurriness, assetDepthM, arrayIndex);
    sum += current * 16.0;
    current = 0.0;
    current += Depth_GetOcclusion(
    depthTexture, uv + vec2(+0.0, +1.0) * blurriness, assetDepthM, arrayIndex);
    current += Depth_GetOcclusion(
    depthTexture, uv + vec2(-0.0, -1.0) * blurriness, assetDepthM, arrayIndex);
    current += Depth_GetOcclusion(
    depthTexture, uv + vec2(-1.0, -0.0) * blurriness, assetDepthM, arrayIndex);
    current += Depth_GetOcclusion(
    depthTexture, uv + vec2(+1.0, +0.0) * blurriness, assetDepthM, arrayIndex);
    sum += current * 26.0;
    sum += Depth_GetOcclusion(depthTexture, uv, assetDepthM, arrayIndex) * 41.0;
    return sum / kKernelTotalWeights;
    }
#endif`,gH=`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = nonPerturbedNormal;
#endif`,AH=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	clearcoatNormal = normalize( tbn2 * clearcoatMapN );
#endif`,vH=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif`,yH=`#ifdef USE_IRIDESCENCEMAP
	uniform sampler2D iridescenceMap;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform sampler2D iridescenceThicknessMap;
#endif`,bH=`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= material.transmissionAlpha;
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,_H=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;
const vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );
const vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );
const float ShiftRight8 = 1. / 256.;
vec4 packDepthToRGBA( const in float v ) {
	vec4 r = vec4( fract( v * PackFactors ), v );
	r.yzw -= r.xyz * ShiftRight8;	return r * PackUpscale;
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors );
}
vec2 packDepthToRG( in highp float v ) {
	return packDepthToRGBA( v ).yx;
}
float unpackRGToDepth( const in highp vec2 v ) {
	return unpackRGBAToDepth( vec4( v.xy, 0.0, 0.0 ) );
}
vec4 pack2HalfToRGBA( vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return depth * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * depth - far );
}`,xH=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,wH=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_BATCHING
	mvPosition = batchingMatrix * mvPosition;
#endif
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,SH=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,CH=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,EH=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );
	roughnessFactor *= texelRoughness.g;
#endif`,TH=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,MH=`#if NUM_SPOT_LIGHT_COORDS > 0
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#if NUM_SPOT_LIGHT_MAPS > 0
	uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;
		bool frustumTest = inFrustum && shadowCoord.z <= 1.0;
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return shadow;
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
		vec3 lightToPosition = shadowCoord.xyz;
		float dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );		dp += shadowBias;
		vec3 bd3D = normalize( lightToPosition );
		#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
			vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
			return (
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
			) * ( 1.0 / 9.0 );
		#else
			return texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
		#endif
	}
#endif`,IH=`#if NUM_SPOT_LIGHT_COORDS > 0
	uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,RH=`#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )
	vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
	vec4 shadowWorldPosition;
#endif
#if defined( USE_SHADOWMAP )
	#if NUM_DIR_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
			vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
			vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
#endif
#if NUM_SPOT_LIGHT_COORDS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {
		shadowWorldPosition = worldPosition;
		#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;
		#endif
		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
#endif`,PH=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,BH=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,DH=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	uniform highp sampler2D boneTexture;
	mat4 getBoneMatrix( const in float i ) {
		int size = textureSize( boneTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( boneTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( boneTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( boneTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( boneTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
#endif`,OH=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,kH=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,LH=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,FH=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,UH=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,NH=`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return saturate( toneMappingExposure * color );
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 OptimizedCineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
const mat3 LINEAR_REC2020_TO_LINEAR_SRGB = mat3(
	vec3( 1.6605, - 0.1246, - 0.0182 ),
	vec3( - 0.5876, 1.1329, - 0.1006 ),
	vec3( - 0.0728, - 0.0083, 1.1187 )
);
const mat3 LINEAR_SRGB_TO_LINEAR_REC2020 = mat3(
	vec3( 0.6274, 0.0691, 0.0164 ),
	vec3( 0.3293, 0.9195, 0.0880 ),
	vec3( 0.0433, 0.0113, 0.8956 )
);
vec3 agxDefaultContrastApprox( vec3 x ) {
	vec3 x2 = x * x;
	vec3 x4 = x2 * x2;
	return + 15.5 * x4 * x2
		- 40.14 * x4 * x
		+ 31.96 * x4
		- 6.868 * x2 * x
		+ 0.4298 * x2
		+ 0.1191 * x
		- 0.00232;
}
vec3 AgXToneMapping( vec3 color ) {
	const mat3 AgXInsetMatrix = mat3(
		vec3( 0.856627153315983, 0.137318972929847, 0.11189821299995 ),
		vec3( 0.0951212405381588, 0.761241990602591, 0.0767994186031903 ),
		vec3( 0.0482516061458583, 0.101439036467562, 0.811302368396859 )
	);
	const mat3 AgXOutsetMatrix = mat3(
		vec3( 1.1271005818144368, - 0.1413297634984383, - 0.14132976349843826 ),
		vec3( - 0.11060664309660323, 1.157823702216272, - 0.11060664309660294 ),
		vec3( - 0.016493938717834573, - 0.016493938717834257, 1.2519364065950405 )
	);
	const float AgxMinEv = - 12.47393;	const float AgxMaxEv = 4.026069;
	color *= toneMappingExposure;
	color = LINEAR_SRGB_TO_LINEAR_REC2020 * color;
	color = AgXInsetMatrix * color;
	color = max( color, 1e-10 );	color = log2( color );
	color = ( color - AgxMinEv ) / ( AgxMaxEv - AgxMinEv );
	color = clamp( color, 0.0, 1.0 );
	color = agxDefaultContrastApprox( color );
	color = AgXOutsetMatrix * color;
	color = pow( max( vec3( 0.0 ), color ), vec3( 2.2 ) );
	color = LINEAR_REC2020_TO_LINEAR_SRGB * color;
	color = clamp( color, 0.0, 1.0 );
	return color;
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,zH=`#ifdef USE_TRANSMISSION
	material.transmission = transmission;
	material.transmissionAlpha = 1.0;
	material.thickness = thickness;
	material.attenuationDistance = attenuationDistance;
	material.attenuationColor = attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		material.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		material.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmitted = getIBLVolumeRefraction(
		n, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, material.ior, material.thickness,
		material.attenuationColor, material.attenuationDistance );
	material.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );
	totalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );
#endif`,GH=`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	float w0( float a ) {
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );
	}
	float w1( float a ) {
		return ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );
	}
	float w2( float a ){
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );
	}
	float w3( float a ) {
		return ( 1.0 / 6.0 ) * ( a * a * a );
	}
	float g0( float a ) {
		return w0( a ) + w1( a );
	}
	float g1( float a ) {
		return w2( a ) + w3( a );
	}
	float h0( float a ) {
		return - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );
	}
	float h1( float a ) {
		return 1.0 + w3( a ) / ( w2( a ) + w3( a ) );
	}
	vec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {
		uv = uv * texelSize.zw + 0.5;
		vec2 iuv = floor( uv );
		vec2 fuv = fract( uv );
		float g0x = g0( fuv.x );
		float g1x = g1( fuv.x );
		float h0x = h0( fuv.x );
		float h1x = h1( fuv.x );
		float h0y = h0( fuv.y );
		float h1y = h1( fuv.y );
		vec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		vec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		return g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +
			g1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );
	}
	vec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {
		vec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );
		vec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );
		vec2 fLodSizeInv = 1.0 / fLodSize;
		vec2 cLodSizeInv = 1.0 / cLodSize;
		vec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );
		vec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );
		return mix( fSample, cSample, fract( lod ) );
	}
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		float lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		return textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );
	}
	vec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( isinf( attenuationDistance ) ) {
			return vec3( 1.0 );
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
		vec3 refractedRayExit = position + transmissionRay;
		vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
		vec2 refractionCoords = ndcPos.xy / ndcPos.w;
		refractionCoords += 1.0;
		refractionCoords /= 2.0;
		vec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
		vec3 transmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );
		vec3 attenuatedColor = transmittance * transmittedLight.rgb;
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		float transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;
		return vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );
	}
#endif`,VH=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_SPECULARMAP
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,HH=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	uniform mat3 mapTransform;
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	uniform mat3 alphaMapTransform;
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	uniform mat3 lightMapTransform;
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	uniform mat3 aoMapTransform;
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	uniform mat3 bumpMapTransform;
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	uniform mat3 normalMapTransform;
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_DISPLACEMENTMAP
	uniform mat3 displacementMapTransform;
	varying vec2 vDisplacementMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	uniform mat3 emissiveMapTransform;
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	uniform mat3 metalnessMapTransform;
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	uniform mat3 roughnessMapTransform;
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	uniform mat3 anisotropyMapTransform;
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	uniform mat3 clearcoatMapTransform;
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform mat3 clearcoatNormalMapTransform;
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform mat3 clearcoatRoughnessMapTransform;
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	uniform mat3 sheenColorMapTransform;
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	uniform mat3 sheenRoughnessMapTransform;
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	uniform mat3 iridescenceMapTransform;
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform mat3 iridescenceThicknessMapTransform;
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SPECULARMAP
	uniform mat3 specularMapTransform;
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	uniform mat3 specularColorMapTransform;
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	uniform mat3 specularIntensityMapTransform;
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,QH=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	vUv = vec3( uv, 1 ).xy;
#endif
#ifdef USE_MAP
	vMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ALPHAMAP
	vAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_LIGHTMAP
	vLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_AOMAP
	vAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_BUMPMAP
	vBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_NORMALMAP
	vNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_DISPLACEMENTMAP
	vDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_EMISSIVEMAP
	vEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_METALNESSMAP
	vMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ROUGHNESSMAP
	vRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ANISOTROPYMAP
	vAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOATMAP
	vClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	vClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	vClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCEMAP
	vIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	vIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_COLORMAP
	vSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	vSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULARMAP
	vSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_COLORMAP
	vSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	vSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_TRANSMISSIONMAP
	vTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_THICKNESSMAP
	vThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;
#endif`,jH=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_BATCHING
		worldPosition = batchingMatrix * worldPosition;
	#endif
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`;const WH=`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,qH=`uniform sampler2D t2D;
uniform float backgroundIntensity;
varying vec2 vUv;
void main() {
	vec4 texColor = texture2D( t2D, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		texColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,XH=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,YH=`#ifdef ENVMAP_TYPE_CUBE
	uniform samplerCube envMap;
#elif defined( ENVMAP_TYPE_CUBE_UV )
	uniform sampler2D envMap;
#endif
uniform float flipEnvMap;
uniform float backgroundBlurriness;
uniform float backgroundIntensity;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	#ifdef ENVMAP_TYPE_CUBE
		vec4 texColor = textureCube( envMap, vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 texColor = textureCubeUV( envMap, vWorldDirection, backgroundBlurriness );
	#else
		vec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,JH=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,KH=`uniform samplerCube tCube;
uniform float tFlip;
uniform float opacity;
varying vec3 vWorldDirection;
void main() {
	vec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );
	gl_FragColor = texColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,ZH=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,$H=`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#endif
}`,eQ=`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,tQ=`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,iQ=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,nQ=`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,sQ=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,rQ=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
#include <occlusion_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <occlusion_fragment>
}`,oQ=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,aQ=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
#include <occlusion_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
	#include <occlusion_fragment>
}`,cQ=`#define LAMBERT
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,lQ=`#define LAMBERT
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_lambert_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
#include <occlusion_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_lambert_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
	#include <occlusion_fragment>
}`,hQ=`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,uQ=`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
#include <occlusion_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
	#include <occlusion_fragment>
}`,dQ=`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	vViewPosition = - mvPosition.xyz;
#endif
}`,fQ=`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
#include <occlusion_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( 0.0, 0.0, 0.0, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), diffuseColor.a );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
	#include <occlusion_fragment>
}`,pQ=`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,mQ=`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
#include <occlusion_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
	#include <occlusion_fragment>
}`,gQ=`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,AQ=`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define USE_SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef USE_SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULAR_COLORMAP
		uniform sampler2D specularColorMap;
	#endif
	#ifdef USE_SPECULAR_INTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_IRIDESCENCE
	uniform float iridescence;
	uniform float iridescenceIOR;
	uniform float iridescenceThicknessMinimum;
	uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEEN_COLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEEN_ROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
#ifdef USE_ANISOTROPY
	uniform vec2 anisotropyVector;
	#ifdef USE_ANISOTROPYMAP
		uniform sampler2D anisotropyMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
#include <occlusion_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecularDirect + sheenSpecularIndirect;
	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + ( clearcoatSpecularDirect + clearcoatSpecularIndirect ) * material.clearcoat;
	#endif
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
	#include <occlusion_fragment>
}`,vQ=`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,yQ=`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
#include <occlusion_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
	#include <occlusion_fragment>
}`,bQ=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
#ifdef USE_POINTS_UV
	varying vec2 vUv;
	uniform mat3 uvTransform;
#endif
void main() {
	#ifdef USE_POINTS_UV
		vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	#endif
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,_Q=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
#include <occlusion_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <occlusion_fragment>
}`,xQ=`#include <common>
#include <batching_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,wQ=`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <logdepthbuf_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	#include <logdepthbuf_fragment>
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,SQ=`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
	vec2 scale;
	scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
	scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,CQ=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,Bt={alphahash_fragment:jV,alphahash_pars_fragment:WV,alphamap_fragment:qV,alphamap_pars_fragment:XV,alphatest_fragment:YV,alphatest_pars_fragment:JV,aomap_fragment:KV,aomap_pars_fragment:ZV,batching_pars_vertex:$V,batching_vertex:e4,begin_vertex:t4,beginnormal_vertex:i4,bsdfs:n4,iridescence_fragment:s4,bumpmap_pars_fragment:r4,clipping_planes_fragment:o4,clipping_planes_pars_fragment:a4,clipping_planes_pars_vertex:c4,clipping_planes_vertex:l4,color_fragment:h4,color_pars_fragment:u4,color_pars_vertex:d4,color_vertex:f4,common:p4,cube_uv_reflection_fragment:m4,defaultnormal_vertex:g4,displacementmap_pars_vertex:A4,displacementmap_vertex:v4,emissivemap_fragment:y4,emissivemap_pars_fragment:b4,colorspace_fragment:_4,colorspace_pars_fragment:x4,envmap_fragment:w4,envmap_common_pars_fragment:S4,envmap_pars_fragment:C4,envmap_pars_vertex:E4,envmap_physical_pars_fragment:U4,envmap_vertex:T4,fog_vertex:M4,fog_pars_vertex:I4,fog_fragment:R4,fog_pars_fragment:P4,gradientmap_pars_fragment:B4,lightmap_fragment:D4,lightmap_pars_fragment:O4,lights_lambert_fragment:k4,lights_lambert_pars_fragment:L4,lights_pars_begin:F4,lights_toon_fragment:N4,lights_toon_pars_fragment:z4,lights_phong_fragment:G4,lights_phong_pars_fragment:V4,lights_physical_fragment:H4,lights_physical_pars_fragment:Q4,lights_fragment_begin:j4,lights_fragment_maps:W4,lights_fragment_end:q4,logdepthbuf_fragment:X4,logdepthbuf_pars_fragment:Y4,logdepthbuf_pars_vertex:J4,logdepthbuf_vertex:K4,map_fragment:Z4,map_pars_fragment:$4,map_particle_fragment:eH,map_particle_pars_fragment:tH,metalnessmap_fragment:iH,metalnessmap_pars_fragment:nH,morphcolor_vertex:sH,morphnormal_vertex:rH,morphtarget_pars_vertex:oH,morphtarget_vertex:aH,normal_fragment_begin:cH,normal_fragment_maps:lH,normal_pars_fragment:hH,normal_pars_vertex:uH,normal_vertex:dH,normalmap_pars_fragment:fH,occlusion_fragment:pH,occlusion_pars_fragment:mH,clearcoat_normal_fragment_begin:gH,clearcoat_normal_fragment_maps:AH,clearcoat_pars_fragment:vH,iridescence_pars_fragment:yH,opaque_fragment:bH,packing:_H,premultiplied_alpha_fragment:xH,project_vertex:wH,dithering_fragment:SH,dithering_pars_fragment:CH,roughnessmap_fragment:EH,roughnessmap_pars_fragment:TH,shadowmap_pars_fragment:MH,shadowmap_pars_vertex:IH,shadowmap_vertex:RH,shadowmask_pars_fragment:PH,skinbase_vertex:BH,skinning_pars_vertex:DH,skinning_vertex:OH,skinnormal_vertex:kH,specularmap_fragment:LH,specularmap_pars_fragment:FH,tonemapping_fragment:UH,tonemapping_pars_fragment:NH,transmission_fragment:zH,transmission_pars_fragment:GH,uv_pars_fragment:VH,uv_pars_vertex:HH,uv_vertex:QH,worldpos_vertex:jH,background_vert:WH,background_frag:qH,backgroundCube_vert:XH,backgroundCube_frag:YH,cube_vert:JH,cube_frag:KH,depth_vert:ZH,depth_frag:$H,distanceRGBA_vert:eQ,distanceRGBA_frag:tQ,equirect_vert:iQ,equirect_frag:nQ,linedashed_vert:sQ,linedashed_frag:rQ,meshbasic_vert:oQ,meshbasic_frag:aQ,meshlambert_vert:cQ,meshlambert_frag:lQ,meshmatcap_vert:hQ,meshmatcap_frag:uQ,meshnormal_vert:dQ,meshnormal_frag:fQ,meshphong_vert:pQ,meshphong_frag:mQ,meshphysical_vert:gQ,meshphysical_frag:AQ,meshtoon_vert:vQ,meshtoon_frag:yQ,points_vert:bQ,points_frag:_Q,shadow_vert:xQ,shadow_frag:wQ,sprite_vert:SQ,sprite_frag:CQ},De={common:{diffuse:{value:new ye(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new Dt},alphaMap:{value:null},alphaMapTransform:{value:new Dt},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new Dt}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new Dt}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new Dt}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new Dt},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new Dt},normalScale:{value:new ie(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new Dt},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new Dt}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new Dt}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new Dt}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new ye(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},occlusion:{depthColor:{value:null},depthWidth:{},depthHeight:{}},points:{diffuse:{value:new ye(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new Dt},alphaTest:{value:0},uvTransform:{value:new Dt}},sprite:{diffuse:{value:new ye(16777215)},opacity:{value:1},center:{value:new ie(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new Dt},alphaMap:{value:null},alphaMapTransform:{value:new Dt},alphaTest:{value:0}}},ys={basic:{uniforms:cr([De.common,De.specularmap,De.envmap,De.aomap,De.lightmap,De.fog,De.occlusion]),vertexShader:Bt.meshbasic_vert,fragmentShader:Bt.meshbasic_frag},lambert:{uniforms:cr([De.common,De.specularmap,De.envmap,De.aomap,De.lightmap,De.emissivemap,De.bumpmap,De.normalmap,De.displacementmap,De.fog,De.lights,De.occlusion,{emissive:{value:new ye(0)}}]),vertexShader:Bt.meshlambert_vert,fragmentShader:Bt.meshlambert_frag},phong:{uniforms:cr([De.common,De.specularmap,De.envmap,De.aomap,De.lightmap,De.emissivemap,De.bumpmap,De.normalmap,De.displacementmap,De.fog,De.lights,De.occlusion,{emissive:{value:new ye(0)},specular:{value:new ye(1118481)},shininess:{value:30}}]),vertexShader:Bt.meshphong_vert,fragmentShader:Bt.meshphong_frag},standard:{uniforms:cr([De.common,De.envmap,De.aomap,De.lightmap,De.emissivemap,De.bumpmap,De.normalmap,De.displacementmap,De.roughnessmap,De.metalnessmap,De.fog,De.lights,De.occlusion,{emissive:{value:new ye(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:Bt.meshphysical_vert,fragmentShader:Bt.meshphysical_frag},toon:{uniforms:cr([De.common,De.aomap,De.lightmap,De.emissivemap,De.bumpmap,De.normalmap,De.displacementmap,De.gradientmap,De.fog,De.lights,De.occlusion,{emissive:{value:new ye(0)}}]),vertexShader:Bt.meshtoon_vert,fragmentShader:Bt.meshtoon_frag},matcap:{uniforms:cr([De.common,De.bumpmap,De.normalmap,De.displacementmap,De.fog,De.occlusion,{matcap:{value:null}}]),vertexShader:Bt.meshmatcap_vert,fragmentShader:Bt.meshmatcap_frag},points:{uniforms:cr([De.points,De.fog,De.occlusion]),vertexShader:Bt.points_vert,fragmentShader:Bt.points_frag},dashed:{uniforms:cr([De.common,De.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Bt.linedashed_vert,fragmentShader:Bt.linedashed_frag},depth:{uniforms:cr([De.common,De.displacementmap]),vertexShader:Bt.depth_vert,fragmentShader:Bt.depth_frag},normal:{uniforms:cr([De.common,De.bumpmap,De.normalmap,De.displacementmap,De.occlusion,{opacity:{value:1}}]),vertexShader:Bt.meshnormal_vert,fragmentShader:Bt.meshnormal_frag},sprite:{uniforms:cr([De.sprite,De.fog]),vertexShader:Bt.sprite_vert,fragmentShader:Bt.sprite_frag},background:{uniforms:{uvTransform:{value:new Dt},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:Bt.background_vert,fragmentShader:Bt.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1}},vertexShader:Bt.backgroundCube_vert,fragmentShader:Bt.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:Bt.cube_vert,fragmentShader:Bt.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Bt.equirect_vert,fragmentShader:Bt.equirect_frag},distanceRGBA:{uniforms:cr([De.common,De.displacementmap,{referencePosition:{value:new w},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Bt.distanceRGBA_vert,fragmentShader:Bt.distanceRGBA_frag},shadow:{uniforms:cr([De.lights,De.fog,{color:{value:new ye(0)},opacity:{value:1}}]),vertexShader:Bt.shadow_vert,fragmentShader:Bt.shadow_frag}};ys.physical={uniforms:cr([ys.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new Dt},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new Dt},clearcoatNormalScale:{value:new ie(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new Dt},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new Dt},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new Dt},sheen:{value:0},sheenColor:{value:new ye(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new Dt},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new Dt},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new Dt},transmissionSamplerSize:{value:new ie},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new Dt},attenuationDistance:{value:0},attenuationColor:{value:new ye(0)},specularColor:{value:new ye(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new Dt},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new Dt},anisotropyVector:{value:new ie},anisotropyMap:{value:null},anisotropyMapTransform:{value:new Dt}}]),vertexShader:Bt.meshphysical_vert,fragmentShader:Bt.meshphysical_frag};const ey={r:0,b:0,g:0};function EQ(n,e,t,i,s,r,o){const a=new ye(0);let c=r===!0?0:1,l,h,d=null,f=0,p=null;function m(y,A){let v=!1,b=A.isScene===!0?A.background:null;b&&b.isTexture&&(b=(A.backgroundBlurriness>0?t:e).get(b)),b===null?g(a,c):b&&b.isColor&&(g(b,1),v=!0);const _=n.xr.getEnvironmentBlendMode();_==="additive"?i.buffers.color.setClear(0,0,0,1,o):_==="alpha-blend"&&i.buffers.color.setClear(0,0,0,0,o),(n.autoClear||v)&&n.clear(n.autoClearColor,n.autoClearDepth,n.autoClearStencil),b&&(b.isCubeTexture||b.mapping===Sp)?(h===void 0&&(h=new me(new Ni(1,1,1),new Et({name:"BackgroundCubeMaterial",uniforms:pp(ys.backgroundCube.uniforms),vertexShader:ys.backgroundCube.vertexShader,fragmentShader:ys.backgroundCube.fragmentShader,side:mn,depthTest:!1,depthWrite:!1,fog:!1})),h.geometry.deleteAttribute("normal"),h.geometry.deleteAttribute("uv"),h.onBeforeRender=function(T,E,M){this.matrixWorld.copyPosition(M.matrixWorld)},Object.defineProperty(h.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),s.update(h)),h.material.uniforms.envMap.value=b,h.material.uniforms.flipEnvMap.value=b.isCubeTexture&&b.isRenderTargetTexture===!1?-1:1,h.material.uniforms.backgroundBlurriness.value=A.backgroundBlurriness,h.material.uniforms.backgroundIntensity.value=A.backgroundIntensity,h.material.toneMapped=_i.getTransfer(b.colorSpace)!==Ui,(d!==b||f!==b.version||p!==n.toneMapping)&&(h.material.needsUpdate=!0,d=b,f=b.version,p=n.toneMapping),h.layers.enableAll(),y.unshift(h,h.geometry,h.material,0,0,null)):b&&b.isTexture&&(l===void 0&&(l=new me(new Wn(2,2),new Et({name:"BackgroundMaterial",uniforms:pp(ys.background.uniforms),vertexShader:ys.background.vertexShader,fragmentShader:ys.background.fragmentShader,side:Es,depthTest:!1,depthWrite:!1,fog:!1})),l.geometry.deleteAttribute("normal"),Object.defineProperty(l.material,"map",{get:function(){return this.uniforms.t2D.value}}),s.update(l)),l.material.uniforms.t2D.value=b,l.material.uniforms.backgroundIntensity.value=A.backgroundIntensity,l.material.toneMapped=_i.getTransfer(b.colorSpace)!==Ui,b.matrixAutoUpdate===!0&&b.updateMatrix(),l.material.uniforms.uvTransform.value.copy(b.matrix),(d!==b||f!==b.version||p!==n.toneMapping)&&(l.material.needsUpdate=!0,d=b,f=b.version,p=n.toneMapping),l.layers.enableAll(),y.unshift(l,l.geometry,l.material,0,0,null))}function g(y,A){y.getRGB(ey,d2(n)),i.buffers.color.setClear(ey.r,ey.g,ey.b,A,o)}return{getClearColor:function(){return a},setClearColor:function(y,A=1){a.set(y),c=A,g(a,c)},getClearAlpha:function(){return c},setClearAlpha:function(y){c=y,g(a,c)},render:m}}function TQ(n,e,t,i){const s=n.getParameter(n.MAX_VERTEX_ATTRIBS),r=i.isWebGL2?null:e.get("OES_vertex_array_object"),o=i.isWebGL2||r!==null,a={},c=y(null);let l=c,h=!1;function d(L,V,O,U,H){let Y=!1;if(o){const J=g(U,O,V);l!==J&&(l=J,p(l.object)),Y=A(L,U,O,H),Y&&v(L,U,O,H)}else{const J=V.wireframe===!0;(l.geometry!==U.id||l.program!==O.id||l.wireframe!==J)&&(l.geometry=U.id,l.program=O.id,l.wireframe=J,Y=!0)}H!==null&&t.update(H,n.ELEMENT_ARRAY_BUFFER),(Y||h)&&(h=!1,I(L,V,O,U),H!==null&&n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,t.get(H).buffer))}function f(){return i.isWebGL2?n.createVertexArray():r.createVertexArrayOES()}function p(L){return i.isWebGL2?n.bindVertexArray(L):r.bindVertexArrayOES(L)}function m(L){return i.isWebGL2?n.deleteVertexArray(L):r.deleteVertexArrayOES(L)}function g(L,V,O){const U=O.wireframe===!0;let H=a[L.id];H===void 0&&(H={},a[L.id]=H);let Y=H[V.id];Y===void 0&&(Y={},H[V.id]=Y);let J=Y[U];return J===void 0&&(J=y(f()),Y[U]=J),J}function y(L){const V=[],O=[],U=[];for(let H=0;H<s;H++)V[H]=0,O[H]=0,U[H]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:V,enabledAttributes:O,attributeDivisors:U,object:L,attributes:{},index:null}}function A(L,V,O,U){const H=l.attributes,Y=V.attributes;let J=0;const se=O.getAttributes();for(const fe in se)if(se[fe].location>=0){const Oe=H[fe];let qe=Y[fe];if(qe===void 0&&(fe==="instanceMatrix"&&L.instanceMatrix&&(qe=L.instanceMatrix),fe==="instanceColor"&&L.instanceColor&&(qe=L.instanceColor)),Oe===void 0||Oe.attribute!==qe||qe&&Oe.data!==qe.data)return!0;J++}return l.attributesNum!==J||l.index!==U}function v(L,V,O,U){const H={},Y=V.attributes;let J=0;const se=O.getAttributes();for(const fe in se)if(se[fe].location>=0){let Oe=Y[fe];Oe===void 0&&(fe==="instanceMatrix"&&L.instanceMatrix&&(Oe=L.instanceMatrix),fe==="instanceColor"&&L.instanceColor&&(Oe=L.instanceColor));const qe={};qe.attribute=Oe,Oe&&Oe.data&&(qe.data=Oe.data),H[fe]=qe,J++}l.attributes=H,l.attributesNum=J,l.index=U}function b(){const L=l.newAttributes;for(let V=0,O=L.length;V<O;V++)L[V]=0}function _(L){T(L,0)}function T(L,V){const O=l.newAttributes,U=l.enabledAttributes,H=l.attributeDivisors;O[L]=1,U[L]===0&&(n.enableVertexAttribArray(L),U[L]=1),H[L]!==V&&((i.isWebGL2?n:e.get("ANGLE_instanced_arrays"))[i.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](L,V),H[L]=V)}function E(){const L=l.newAttributes,V=l.enabledAttributes;for(let O=0,U=V.length;O<U;O++)V[O]!==L[O]&&(n.disableVertexAttribArray(O),V[O]=0)}function M(L,V,O,U,H,Y,J){J===!0?n.vertexAttribIPointer(L,V,O,H,Y):n.vertexAttribPointer(L,V,O,U,H,Y)}function I(L,V,O,U){if(i.isWebGL2===!1&&(L.isInstancedMesh||U.isInstancedBufferGeometry)&&e.get("ANGLE_instanced_arrays")===null)return;b();const H=U.attributes,Y=O.getAttributes(),J=V.defaultAttributeValues;for(const se in Y){const fe=Y[se];if(fe.location>=0){let _e=H[se];if(_e===void 0&&(se==="instanceMatrix"&&L.instanceMatrix&&(_e=L.instanceMatrix),se==="instanceColor"&&L.instanceColor&&(_e=L.instanceColor)),_e!==void 0){const Oe=_e.normalized,qe=_e.itemSize,ae=t.get(_e);if(ae===void 0)continue;const ve=ae.buffer,Ue=ae.type,Ge=ae.bytesPerElement,Xe=i.isWebGL2===!0&&(Ue===n.INT||Ue===n.UNSIGNED_INT||_e.gpuType===aM);if(_e.isInterleavedBufferAttribute){const ze=_e.data,Pe=ze.stride,X=_e.offset;if(ze.isInstancedInterleavedBuffer){for(let Ae=0;Ae<fe.locationSize;Ae++)T(fe.location+Ae,ze.meshPerAttribute);L.isInstancedMesh!==!0&&U._maxInstanceCount===void 0&&(U._maxInstanceCount=ze.meshPerAttribute*ze.count)}else for(let Ae=0;Ae<fe.locationSize;Ae++)_(fe.location+Ae);n.bindBuffer(n.ARRAY_BUFFER,ve);for(let Ae=0;Ae<fe.locationSize;Ae++)M(fe.location+Ae,qe/fe.locationSize,Ue,Oe,Pe*Ge,(X+qe/fe.locationSize*Ae)*Ge,Xe)}else{if(_e.isInstancedBufferAttribute){for(let ze=0;ze<fe.locationSize;ze++)T(fe.location+ze,_e.meshPerAttribute);L.isInstancedMesh!==!0&&U._maxInstanceCount===void 0&&(U._maxInstanceCount=_e.meshPerAttribute*_e.count)}else for(let ze=0;ze<fe.locationSize;ze++)_(fe.location+ze);n.bindBuffer(n.ARRAY_BUFFER,ve);for(let ze=0;ze<fe.locationSize;ze++)M(fe.location+ze,qe/fe.locationSize,Ue,Oe,qe*Ge,qe/fe.locationSize*ze*Ge,Xe)}}else if(J!==void 0){const Oe=J[se];if(Oe!==void 0)switch(Oe.length){case 2:n.vertexAttrib2fv(fe.location,Oe);break;case 3:n.vertexAttrib3fv(fe.location,Oe);break;case 4:n.vertexAttrib4fv(fe.location,Oe);break;default:n.vertexAttrib1fv(fe.location,Oe)}}}}E()}function S(){G();for(const L in a){const V=a[L];for(const O in V){const U=V[O];for(const H in U)m(U[H].object),delete U[H];delete V[O]}delete a[L]}}function C(L){if(a[L.id]===void 0)return;const V=a[L.id];for(const O in V){const U=V[O];for(const H in U)m(U[H].object),delete U[H];delete V[O]}delete a[L.id]}function D(L){for(const V in a){const O=a[V];if(O[L.id]===void 0)continue;const U=O[L.id];for(const H in U)m(U[H].object),delete U[H];delete O[L.id]}}function G(){Q(),h=!0,l!==c&&(l=c,p(l.object))}function Q(){c.geometry=null,c.program=null,c.wireframe=!1}return{setup:d,reset:G,resetDefaultState:Q,dispose:S,releaseStatesOfGeometry:C,releaseStatesOfProgram:D,initAttributes:b,enableAttribute:_,disableUnusedAttributes:E}}function MQ(n,e,t,i){const s=i.isWebGL2;let r;function o(h){r=h}function a(h,d){n.drawArrays(r,h,d),t.update(d,r,1)}function c(h,d,f){if(f===0)return;let p,m;if(s)p=n,m="drawArraysInstanced";else if(p=e.get("ANGLE_instanced_arrays"),m="drawArraysInstancedANGLE",p===null){console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}p[m](r,h,d,f),t.update(d,r,f)}function l(h,d,f){if(f===0)return;const p=e.get("WEBGL_multi_draw");if(p===null)for(let m=0;m<f;m++)this.render(h[m],d[m]);else{p.multiDrawArraysWEBGL(r,h,0,d,0,f);let m=0;for(let g=0;g<f;g++)m+=d[g];t.update(m,r,1)}}this.setMode=o,this.render=a,this.renderInstances=c,this.renderMultiDraw=l}function IQ(n,e,t){let i;function s(){if(i!==void 0)return i;if(e.has("EXT_texture_filter_anisotropic")===!0){const M=e.get("EXT_texture_filter_anisotropic");i=n.getParameter(M.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else i=0;return i}function r(M){if(M==="highp"){if(n.getShaderPrecisionFormat(n.VERTEX_SHADER,n.HIGH_FLOAT).precision>0&&n.getShaderPrecisionFormat(n.FRAGMENT_SHADER,n.HIGH_FLOAT).precision>0)return"highp";M="mediump"}return M==="mediump"&&n.getShaderPrecisionFormat(n.VERTEX_SHADER,n.MEDIUM_FLOAT).precision>0&&n.getShaderPrecisionFormat(n.FRAGMENT_SHADER,n.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}const o=typeof WebGL2RenderingContext<"u"&&n.constructor.name==="WebGL2RenderingContext";let a=t.precision!==void 0?t.precision:"highp";const c=r(a);c!==a&&(console.warn("THREE.WebGLRenderer:",a,"not supported, using",c,"instead."),a=c);const l=o||e.has("WEBGL_draw_buffers"),h=t.logarithmicDepthBuffer===!0,d=n.getParameter(n.MAX_TEXTURE_IMAGE_UNITS),f=n.getParameter(n.MAX_VERTEX_TEXTURE_IMAGE_UNITS),p=n.getParameter(n.MAX_TEXTURE_SIZE),m=n.getParameter(n.MAX_CUBE_MAP_TEXTURE_SIZE),g=n.getParameter(n.MAX_VERTEX_ATTRIBS),y=n.getParameter(n.MAX_VERTEX_UNIFORM_VECTORS),A=n.getParameter(n.MAX_VARYING_VECTORS),v=n.getParameter(n.MAX_FRAGMENT_UNIFORM_VECTORS),b=f>0,_=o||e.has("OES_texture_float"),T=b&&_,E=o?n.getParameter(n.MAX_SAMPLES):0;return{isWebGL2:o,drawBuffers:l,getMaxAnisotropy:s,getMaxPrecision:r,precision:a,logarithmicDepthBuffer:h,maxTextures:d,maxVertexTextures:f,maxTextureSize:p,maxCubemapSize:m,maxAttributes:g,maxVertexUniforms:y,maxVaryings:A,maxFragmentUniforms:v,vertexTextures:b,floatFragmentTextures:_,floatVertexTextures:T,maxSamples:E}}function RQ(n){const e=this;let t=null,i=0,s=!1,r=!1;const o=new hr,a=new Dt,c={value:null,needsUpdate:!1};this.uniform=c,this.numPlanes=0,this.numIntersection=0,this.init=function(d,f){const p=d.length!==0||f||i!==0||s;return s=f,i=d.length,p},this.beginShadows=function(){r=!0,h(null)},this.endShadows=function(){r=!1},this.setGlobalState=function(d,f){t=h(d,f,0)},this.setState=function(d,f,p){const m=d.clippingPlanes,g=d.clipIntersection,y=d.clipShadows,A=n.get(d);if(!s||m===null||m.length===0||r&&!y)r?h(null):l();else{const v=r?0:i,b=v*4;let _=A.clippingState||null;c.value=_,_=h(m,f,b,p);for(let T=0;T!==b;++T)_[T]=t[T];A.clippingState=_,this.numIntersection=g?this.numPlanes:0,this.numPlanes+=v}};function l(){c.value!==t&&(c.value=t,c.needsUpdate=i>0),e.numPlanes=i,e.numIntersection=0}function h(d,f,p,m){const g=d!==null?d.length:0;let y=null;if(g!==0){if(y=c.value,m!==!0||y===null){const A=p+g*4,v=f.matrixWorldInverse;a.getNormalMatrix(v),(y===null||y.length<A)&&(y=new Float32Array(A));for(let b=0,_=p;b!==g;++b,_+=4)o.copy(d[b]).applyMatrix4(v,a),o.normal.toArray(y,_),y[_+3]=o.constant}c.value=y,c.needsUpdate=!0}return e.numPlanes=g,e.numIntersection=0,y}}function PQ(n){let e=new WeakMap;function t(o,a){return a===Oo?o.mapping=_l:a===up&&(o.mapping=Nh),o}function i(o){if(o&&o.isTexture){const a=o.mapping;if(a===Oo||a===up)if(e.has(o)){const c=e.get(o).texture;return t(c,o.mapping)}else{const c=o.image;if(c&&c.height>0){const l=new xM(c.height);return l.fromEquirectangularTexture(n,o),e.set(o,l),o.addEventListener("dispose",s),t(l.texture,o.mapping)}else return null}}return o}function s(o){const a=o.target;a.removeEventListener("dispose",s);const c=e.get(a);c!==void 0&&(e.delete(a),c.dispose())}function r(){e=new WeakMap}return{get:i,dispose:r}}class vc extends LA{constructor(e=-1,t=1,i=1,s=-1,r=.1,o=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=i,this.bottom=s,this.near=r,this.far=o,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=e.view===null?null:Object.assign({},e.view),this}setViewOffset(e,t,i,s,r,o){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=s,this.view.width=r,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),i=(this.right+this.left)/2,s=(this.top+this.bottom)/2;let r=i-e,o=i+e,a=s+t,c=s-t;if(this.view!==null&&this.view.enabled){const l=(this.right-this.left)/this.view.fullWidth/this.zoom,h=(this.top-this.bottom)/this.view.fullHeight/this.zoom;r+=l*this.view.offsetX,o=r+l*this.view.width,a-=h*this.view.offsetY,c=a-h*this.view.height}this.projectionMatrix.makeOrthographic(r,o,a,c,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,this.view!==null&&(t.object.view=Object.assign({},this.view)),t}}const Mf=4,NR=[.125,.215,.35,.446,.526,.582],Ru=20,Vw=new vc,zR=new ye;let Hw=null,Qw=0,jw=0;const Mu=(1+Math.sqrt(5))/2,$d=1/Mu,GR=[new w(1,1,1),new w(-1,1,1),new w(1,1,-1),new w(-1,1,-1),new w(0,Mu,$d),new w(0,Mu,-$d),new w($d,0,Mu),new w(-$d,0,Mu),new w(Mu,$d,0),new w(-Mu,$d,0)];class pE{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(e,t=0,i=.1,s=100){Hw=this._renderer.getRenderTarget(),Qw=this._renderer.getActiveCubeFace(),jw=this._renderer.getActiveMipmapLevel(),this._setSize(256);const r=this._allocateTargets();return r.depthBuffer=!0,this._sceneToCubeUV(e,i,s,r),t>0&&this._blur(r,0,0,t),this._applyPMREM(r),this._cleanup(r),r}fromEquirectangular(e,t=null){return this._fromTexture(e,t)}fromCubemap(e,t=null){return this._fromTexture(e,t)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=jR(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=QR(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose()}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(Hw,Qw,jw),e.scissorTest=!1,ty(e,0,0,e.width,e.height)}_fromTexture(e,t){e.mapping===_l||e.mapping===Nh?this._setSize(e.image.length===0?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),Hw=this._renderer.getRenderTarget(),Qw=this._renderer.getActiveCubeFace(),jw=this._renderer.getActiveMipmapLevel();const i=t||this._allocateTargets();return this._textureToCubeUV(e,i),this._applyPMREM(i),this._cleanup(i),i}_allocateTargets(){const e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize,i={magFilter:St,minFilter:St,generateMipmaps:!1,type:sn,format:xi,colorSpace:Ri,depthBuffer:!1},s=HR(e,t,i),{_lodMax:r}=this;if({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=VR(r),this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==e||this._pingPongRenderTarget.height!==t){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=HR(e,t,i);const{_lodMax:o}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=VR(o)),this._blurMaterial=BQ(o,e,t)}return s}_compileMaterial(e){const t=new me(this._lodPlanes[0],e);this._renderer.compile(t,Vw)}_sceneToCubeUV(e,t,i,s){const a=new Wt(90,1,t,i),c=[1,-1,1,1,1,1],l=[1,1,1,-1,-1,-1],h=this._renderer,d=h.autoClear,f=h.toneMapping;h.getClearColor(zR),h.toneMapping=Fr,h.autoClear=!1;const p=new ri({name:"PMREM.Background",side:mn,depthWrite:!1,depthTest:!1}),m=new me(new Ni,p);let g=!1;const y=e.background;y?y.isColor&&(p.color.copy(y),e.background=null,g=!0):(p.color.copy(zR),g=!0);for(let A=0;A<6;A++){const v=A%3;v===0?(a.up.set(0,c[A],0),a.lookAt(l[A],0,0)):v===1?(a.up.set(0,0,c[A]),a.lookAt(0,l[A],0)):(a.up.set(0,c[A],0),a.lookAt(0,0,l[A]));const b=this._cubeSize;ty(s,v*b,A>2?b:0,b,b),h.setRenderTarget(s),g&&h.render(m,a),h.render(e,a)}m.geometry.dispose(),m.material.dispose(),h.toneMapping=f,h.autoClear=d,e.background=y}_textureToCubeUV(e,t){const i=this._renderer,s=e.mapping===_l||e.mapping===Nh;s?(this._cubemapMaterial===null&&(this._cubemapMaterial=jR()),this._cubemapMaterial.uniforms.flipEnvMap.value=e.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=QR());const r=s?this._cubemapMaterial:this._equirectMaterial,o=new me(this._lodPlanes[0],r),a=r.uniforms;a.envMap.value=e;const c=this._cubeSize;ty(t,0,0,3*c,2*c),i.setRenderTarget(t),i.render(o,Vw)}_applyPMREM(e){const t=this._renderer,i=t.autoClear;t.autoClear=!1;for(let s=1;s<this._lodPlanes.length;s++){const r=Math.sqrt(this._sigmas[s]*this._sigmas[s]-this._sigmas[s-1]*this._sigmas[s-1]),o=GR[(s-1)%GR.length];this._blur(e,s-1,s,r,o)}t.autoClear=i}_blur(e,t,i,s,r){const o=this._pingPongRenderTarget;this._halfBlur(e,o,t,i,s,"latitudinal",r),this._halfBlur(o,e,i,i,s,"longitudinal",r)}_halfBlur(e,t,i,s,r,o,a){const c=this._renderer,l=this._blurMaterial;o!=="latitudinal"&&o!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");const h=3,d=new me(this._lodPlanes[s],l),f=l.uniforms,p=this._sizeLods[i]-1,m=isFinite(r)?Math.PI/(2*p):2*Math.PI/(2*Ru-1),g=r/m,y=isFinite(r)?1+Math.floor(h*g):Ru;y>Ru&&console.warn(`sigmaRadians, ${r}, is too large and will clip, as it requested ${y} samples when the maximum is set to ${Ru}`);const A=[];let v=0;for(let M=0;M<Ru;++M){const I=M/g,S=Math.exp(-I*I/2);A.push(S),M===0?v+=S:M<y&&(v+=2*S)}for(let M=0;M<A.length;M++)A[M]=A[M]/v;f.envMap.value=e.texture,f.samples.value=y,f.weights.value=A,f.latitudinal.value=o==="latitudinal",a&&(f.poleAxis.value=a);const{_lodMax:b}=this;f.dTheta.value=m,f.mipInt.value=b-i;const _=this._sizeLods[s],T=3*_*(s>b-Mf?s-b+Mf:0),E=4*(this._cubeSize-_);ty(t,T,E,3*_,2*_),c.setRenderTarget(t),c.render(d,Vw)}}function VR(n){const e=[],t=[],i=[];let s=n;const r=n-Mf+1+NR.length;for(let o=0;o<r;o++){const a=Math.pow(2,s);t.push(a);let c=1/a;o>n-Mf?c=NR[o-n+Mf-1]:o===0&&(c=0),i.push(c);const l=1/(a-2),h=-l,d=1+l,f=[h,h,d,h,d,d,h,h,d,d,h,d],p=6,m=6,g=3,y=2,A=1,v=new Float32Array(g*m*p),b=new Float32Array(y*m*p),_=new Float32Array(A*m*p);for(let E=0;E<p;E++){const M=E%3*2/3-1,I=E>2?0:-1,S=[M,I,0,M+2/3,I,0,M+2/3,I+1,0,M,I,0,M+2/3,I+1,0,M,I+1,0];v.set(S,g*m*E),b.set(f,y*m*E);const C=[E,E,E,E,E,E];_.set(C,A*m*E)}const T=new gt;T.setAttribute("position",new it(v,g)),T.setAttribute("uv",new it(b,y)),T.setAttribute("faceIndex",new it(_,A)),e.push(T),s>Mf&&s--}return{lodPlanes:e,sizeLods:t,sigmas:i}}function HR(n,e,t){const i=new Zt(n,e,t);return i.texture.mapping=Sp,i.texture.name="PMREM.cubeUv",i.scissorTest=!0,i}function ty(n,e,t,i,s){n.viewport.set(e,t,i,s),n.scissor.set(e,t,i,s)}function BQ(n,e,t){const i=new Float32Array(Ru),s=new w(0,1,0);return new Et({name:"SphericalGaussianBlur",defines:{n:Ru,CUBEUV_TEXEL_WIDTH:1/e,CUBEUV_TEXEL_HEIGHT:1/t,CUBEUV_MAX_MIP:`${n}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:i},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:s}},vertexShader:wM(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:rn,depthTest:!1,depthWrite:!1})}function QR(){return new Et({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:wM(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:rn,depthTest:!1,depthWrite:!1})}function jR(){return new Et({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:wM(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:rn,depthTest:!1,depthWrite:!1})}function wM(){return`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function DQ(n){let e=new WeakMap,t=null;function i(a){if(a&&a.isTexture){const c=a.mapping,l=c===Oo||c===up,h=c===_l||c===Nh;if(l||h)if(a.isRenderTargetTexture&&a.needsPMREMUpdate===!0){a.needsPMREMUpdate=!1;let d=e.get(a);return t===null&&(t=new pE(n)),d=l?t.fromEquirectangular(a,d):t.fromCubemap(a,d),e.set(a,d),d.texture}else{if(e.has(a))return e.get(a).texture;{const d=a.image;if(l&&d&&d.height>0||h&&d&&s(d)){t=new pE(n);const f=l?t.fromEquirectangular(a):t.fromCubemap(a);return e.set(a,f),a.addEventListener("dispose",r),f.texture}else return null}}}return a}function s(a){let c=0;const l=6;for(let h=0;h<l;h++)a[h]!==void 0&&c++;return c===l}function r(a){const c=a.target;c.removeEventListener("dispose",r);const l=e.get(c);l!==void 0&&(e.delete(c),l.dispose())}function o(){e=new WeakMap,t!==null&&(t.dispose(),t=null)}return{get:i,dispose:o}}function OQ(n){const e={};function t(i){if(e[i]!==void 0)return e[i];let s;switch(i){case"WEBGL_depth_texture":s=n.getExtension("WEBGL_depth_texture")||n.getExtension("MOZ_WEBGL_depth_texture")||n.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":s=n.getExtension("EXT_texture_filter_anisotropic")||n.getExtension("MOZ_EXT_texture_filter_anisotropic")||n.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":s=n.getExtension("WEBGL_compressed_texture_s3tc")||n.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||n.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":s=n.getExtension("WEBGL_compressed_texture_pvrtc")||n.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:s=n.getExtension(i)}return e[i]=s,s}return{has:function(i){return t(i)!==null},init:function(i){i.isWebGL2?(t("EXT_color_buffer_float"),t("WEBGL_clip_cull_distance")):(t("WEBGL_depth_texture"),t("OES_texture_float"),t("OES_texture_half_float"),t("OES_texture_half_float_linear"),t("OES_standard_derivatives"),t("OES_element_index_uint"),t("OES_vertex_array_object"),t("ANGLE_instanced_arrays")),t("OES_texture_float_linear"),t("EXT_color_buffer_half_float"),t("WEBGL_multisampled_render_to_texture")},get:function(i){const s=t(i);return s===null&&console.warn("THREE.WebGLRenderer: "+i+" extension not supported."),s}}}function kQ(n,e,t,i){const s={},r=new WeakMap;function o(d){const f=d.target;f.index!==null&&e.remove(f.index);for(const m in f.attributes)e.remove(f.attributes[m]);for(const m in f.morphAttributes){const g=f.morphAttributes[m];for(let y=0,A=g.length;y<A;y++)e.remove(g[y])}f.removeEventListener("dispose",o),delete s[f.id];const p=r.get(f);p&&(e.remove(p),r.delete(f)),i.releaseStatesOfGeometry(f),f.isInstancedBufferGeometry===!0&&delete f._maxInstanceCount,t.memory.geometries--}function a(d,f){return s[f.id]===!0||(f.addEventListener("dispose",o),s[f.id]=!0,t.memory.geometries++),f}function c(d){const f=d.attributes;for(const m in f)e.update(f[m],n.ARRAY_BUFFER);const p=d.morphAttributes;for(const m in p){const g=p[m];for(let y=0,A=g.length;y<A;y++)e.update(g[y],n.ARRAY_BUFFER)}}function l(d){const f=[],p=d.index,m=d.attributes.position;let g=0;if(p!==null){const v=p.array;g=p.version;for(let b=0,_=v.length;b<_;b+=3){const T=v[b+0],E=v[b+1],M=v[b+2];f.push(T,E,E,M,M,T)}}else if(m!==void 0){const v=m.array;g=m.version;for(let b=0,_=v.length/3-1;b<_;b+=3){const T=b+0,E=b+1,M=b+2;f.push(T,E,E,M,M,T)}}else return;const y=new(a2(f)?bM:yM)(f,1);y.version=g;const A=r.get(d);A&&e.remove(A),r.set(d,y)}function h(d){const f=r.get(d);if(f){const p=d.index;p!==null&&f.version<p.version&&l(d)}else l(d);return r.get(d)}return{get:a,update:c,getWireframeAttribute:h}}function LQ(n,e,t,i){const s=i.isWebGL2;let r;function o(p){r=p}let a,c;function l(p){a=p.type,c=p.bytesPerElement}function h(p,m){n.drawElements(r,m,a,p*c),t.update(m,r,1)}function d(p,m,g){if(g===0)return;let y,A;if(s)y=n,A="drawElementsInstanced";else if(y=e.get("ANGLE_instanced_arrays"),A="drawElementsInstancedANGLE",y===null){console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}y[A](r,m,a,p*c,g),t.update(m,r,g)}function f(p,m,g){if(g===0)return;const y=e.get("WEBGL_multi_draw");if(y===null)for(let A=0;A<g;A++)this.render(p[A]/c,m[A]);else{y.multiDrawElementsWEBGL(r,m,0,a,p,0,g);let A=0;for(let v=0;v<g;v++)A+=m[v];t.update(A,r,1)}}this.setMode=o,this.setIndex=l,this.render=h,this.renderInstances=d,this.renderMultiDraw=f}function FQ(n){const e={geometries:0,textures:0},t={frame:0,calls:0,triangles:0,points:0,lines:0};function i(r,o,a){switch(t.calls++,o){case n.TRIANGLES:t.triangles+=a*(r/3);break;case n.LINES:t.lines+=a*(r/2);break;case n.LINE_STRIP:t.lines+=a*(r-1);break;case n.LINE_LOOP:t.lines+=a*r;break;case n.POINTS:t.points+=a*r;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",o);break}}function s(){t.calls=0,t.triangles=0,t.points=0,t.lines=0}return{memory:e,render:t,programs:null,autoReset:!0,reset:s,update:i}}function UQ(n,e){return n[0]-e[0]}function NQ(n,e){return Math.abs(e[1])-Math.abs(n[1])}function zQ(n,e,t){const i={},s=new Float32Array(8),r=new WeakMap,o=new tt,a=[];for(let l=0;l<8;l++)a[l]=[l,0];function c(l,h,d){const f=l.morphTargetInfluences;if(e.isWebGL2===!0){const p=h.morphAttributes.position||h.morphAttributes.normal||h.morphAttributes.color,m=p!==void 0?p.length:0;let g=r.get(h);if(g===void 0||g.count!==m){let L=function(){G.dispose(),r.delete(h),h.removeEventListener("dispose",L)};g!==void 0&&g.texture.dispose();const v=h.morphAttributes.position!==void 0,b=h.morphAttributes.normal!==void 0,_=h.morphAttributes.color!==void 0,T=h.morphAttributes.position||[],E=h.morphAttributes.normal||[],M=h.morphAttributes.color||[];let I=0;v===!0&&(I=1),b===!0&&(I=2),_===!0&&(I=3);let S=h.attributes.position.count*I,C=1;S>e.maxTextureSize&&(C=Math.ceil(S/e.maxTextureSize),S=e.maxTextureSize);const D=new Float32Array(S*C*4*m),G=new M_(D,S,C,m);G.type=Ji,G.needsUpdate=!0;const Q=I*4;for(let V=0;V<m;V++){const O=T[V],U=E[V],H=M[V],Y=S*C*4*V;for(let J=0;J<O.count;J++){const se=J*Q;v===!0&&(o.fromBufferAttribute(O,J),D[Y+se+0]=o.x,D[Y+se+1]=o.y,D[Y+se+2]=o.z,D[Y+se+3]=0),b===!0&&(o.fromBufferAttribute(U,J),D[Y+se+4]=o.x,D[Y+se+5]=o.y,D[Y+se+6]=o.z,D[Y+se+7]=0),_===!0&&(o.fromBufferAttribute(H,J),D[Y+se+8]=o.x,D[Y+se+9]=o.y,D[Y+se+10]=o.z,D[Y+se+11]=H.itemSize===4?o.w:1)}}g={count:m,texture:G,size:new ie(S,C)},r.set(h,g),h.addEventListener("dispose",L)}let y=0;for(let v=0;v<f.length;v++)y+=f[v];const A=h.morphTargetsRelative?1:1-y;d.getUniforms().setValue(n,"morphTargetBaseInfluence",A),d.getUniforms().setValue(n,"morphTargetInfluences",f),d.getUniforms().setValue(n,"morphTargetsTexture",g.texture,t),d.getUniforms().setValue(n,"morphTargetsTextureSize",g.size)}else{const p=f===void 0?0:f.length;let m=i[h.id];if(m===void 0||m.length!==p){m=[];for(let b=0;b<p;b++)m[b]=[b,0];i[h.id]=m}for(let b=0;b<p;b++){const _=m[b];_[0]=b,_[1]=f[b]}m.sort(NQ);for(let b=0;b<8;b++)b<p&&m[b][1]?(a[b][0]=m[b][0],a[b][1]=m[b][1]):(a[b][0]=Number.MAX_SAFE_INTEGER,a[b][1]=0);a.sort(UQ);const g=h.morphAttributes.position,y=h.morphAttributes.normal;let A=0;for(let b=0;b<8;b++){const _=a[b],T=_[0],E=_[1];T!==Number.MAX_SAFE_INTEGER&&E?(g&&h.getAttribute("morphTarget"+b)!==g[T]&&h.setAttribute("morphTarget"+b,g[T]),y&&h.getAttribute("morphNormal"+b)!==y[T]&&h.setAttribute("morphNormal"+b,y[T]),s[b]=E,A+=E):(g&&h.hasAttribute("morphTarget"+b)===!0&&h.deleteAttribute("morphTarget"+b),y&&h.hasAttribute("morphNormal"+b)===!0&&h.deleteAttribute("morphNormal"+b),s[b]=0)}const v=h.morphTargetsRelative?1:1-A;d.getUniforms().setValue(n,"morphTargetBaseInfluence",v),d.getUniforms().setValue(n,"morphTargetInfluences",s)}}return{update:c}}function GQ(n,e,t,i){let s=new WeakMap;function r(c){const l=i.render.frame,h=c.geometry,d=e.get(c,h);if(s.get(d)!==l&&(e.update(d),s.set(d,l)),c.isInstancedMesh&&(c.hasEventListener("dispose",a)===!1&&c.addEventListener("dispose",a),s.get(c)!==l&&(t.update(c.instanceMatrix,n.ARRAY_BUFFER),c.instanceColor!==null&&t.update(c.instanceColor,n.ARRAY_BUFFER),s.set(c,l))),c.isSkinnedMesh){const f=c.skeleton;s.get(f)!==l&&(f.update(),s.set(f,l))}return d}function o(){s=new WeakMap}function a(c){const l=c.target;l.removeEventListener("dispose",a),t.remove(l.instanceMatrix),l.instanceColor!==null&&t.remove(l.instanceColor)}return{update:r,dispose:o}}class Tp extends Ft{constructor(e,t,i,s,r,o,a,c,l,h){if(h=h!==void 0?h:Mh,h!==Mh&&h!==zh)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");i===void 0&&h===Mh&&(i=ca),i===void 0&&h===zh&&(i=ul),super(null,s,r,o,a,c,h,i,l),this.isDepthTexture=!0,this.image={width:e,height:t},this.magFilter=a!==void 0?a:Nt,this.minFilter=c!==void 0?c:Nt,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(e){return super.copy(e),this.compareFunction=e.compareFunction,this}toJSON(e){const t=super.toJSON(e);return this.compareFunction!==null&&(t.compareFunction=this.compareFunction),t}}const p2=new Ft,m2=new Tp(1,1);m2.compareFunction=gM;const g2=new M_,A2=new I_,v2=new FA,WR=[],qR=[],XR=new Float32Array(16),YR=new Float32Array(9),JR=new Float32Array(4);function Mp(n,e,t){const i=n[0];if(i<=0||i>0)return n;const s=e*t;let r=WR[s];if(r===void 0&&(r=new Float32Array(s),WR[s]=r),e!==0){i.toArray(r,0);for(let o=1,a=0;o!==e;++o)a+=t,n[o].toArray(r,a)}return r}function Qn(n,e){if(n.length!==e.length)return!1;for(let t=0,i=n.length;t<i;t++)if(n[t]!==e[t])return!1;return!0}function jn(n,e){for(let t=0,i=e.length;t<i;t++)n[t]=e[t]}function R_(n,e){let t=qR[e];t===void 0&&(t=new Int32Array(e),qR[e]=t);for(let i=0;i!==e;++i)t[i]=n.allocateTextureUnit();return t}function VQ(n,e){const t=this.cache;t[0]!==e&&(n.uniform1f(this.addr,e),t[0]=e)}function HQ(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(n.uniform2f(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(Qn(t,e))return;n.uniform2fv(this.addr,e),jn(t,e)}}function QQ(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(n.uniform3f(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else if(e.r!==void 0)(t[0]!==e.r||t[1]!==e.g||t[2]!==e.b)&&(n.uniform3f(this.addr,e.r,e.g,e.b),t[0]=e.r,t[1]=e.g,t[2]=e.b);else{if(Qn(t,e))return;n.uniform3fv(this.addr,e),jn(t,e)}}function jQ(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(n.uniform4f(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(Qn(t,e))return;n.uniform4fv(this.addr,e),jn(t,e)}}function WQ(n,e){const t=this.cache,i=e.elements;if(i===void 0){if(Qn(t,e))return;n.uniformMatrix2fv(this.addr,!1,e),jn(t,e)}else{if(Qn(t,i))return;JR.set(i),n.uniformMatrix2fv(this.addr,!1,JR),jn(t,i)}}function qQ(n,e){const t=this.cache,i=e.elements;if(i===void 0){if(Qn(t,e))return;n.uniformMatrix3fv(this.addr,!1,e),jn(t,e)}else{if(Qn(t,i))return;YR.set(i),n.uniformMatrix3fv(this.addr,!1,YR),jn(t,i)}}function XQ(n,e){const t=this.cache,i=e.elements;if(i===void 0){if(Qn(t,e))return;n.uniformMatrix4fv(this.addr,!1,e),jn(t,e)}else{if(Qn(t,i))return;XR.set(i),n.uniformMatrix4fv(this.addr,!1,XR),jn(t,i)}}function YQ(n,e){const t=this.cache;t[0]!==e&&(n.uniform1i(this.addr,e),t[0]=e)}function JQ(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(n.uniform2i(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(Qn(t,e))return;n.uniform2iv(this.addr,e),jn(t,e)}}function KQ(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(n.uniform3i(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if(Qn(t,e))return;n.uniform3iv(this.addr,e),jn(t,e)}}function ZQ(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(n.uniform4i(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(Qn(t,e))return;n.uniform4iv(this.addr,e),jn(t,e)}}function $Q(n,e){const t=this.cache;t[0]!==e&&(n.uniform1ui(this.addr,e),t[0]=e)}function ej(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(n.uniform2ui(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(Qn(t,e))return;n.uniform2uiv(this.addr,e),jn(t,e)}}function tj(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(n.uniform3ui(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if(Qn(t,e))return;n.uniform3uiv(this.addr,e),jn(t,e)}}function ij(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(n.uniform4ui(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(Qn(t,e))return;n.uniform4uiv(this.addr,e),jn(t,e)}}function nj(n,e,t){const i=this.cache,s=t.allocateTextureUnit();i[0]!==s&&(n.uniform1i(this.addr,s),i[0]=s);const r=this.type===n.SAMPLER_2D_SHADOW?m2:p2;t.setTexture2D(e||r,s)}function sj(n,e,t){const i=this.cache,s=t.allocateTextureUnit();i[0]!==s&&(n.uniform1i(this.addr,s),i[0]=s),t.setTexture3D(e||A2,s)}function rj(n,e,t){const i=this.cache,s=t.allocateTextureUnit();i[0]!==s&&(n.uniform1i(this.addr,s),i[0]=s),t.setTextureCube(e||v2,s)}function oj(n,e,t){const i=this.cache,s=t.allocateTextureUnit();i[0]!==s&&(n.uniform1i(this.addr,s),i[0]=s),t.setTexture2DArray(e||g2,s)}function aj(n){switch(n){case 5126:return VQ;case 35664:return HQ;case 35665:return QQ;case 35666:return jQ;case 35674:return WQ;case 35675:return qQ;case 35676:return XQ;case 5124:case 35670:return YQ;case 35667:case 35671:return JQ;case 35668:case 35672:return KQ;case 35669:case 35673:return ZQ;case 5125:return $Q;case 36294:return ej;case 36295:return tj;case 36296:return ij;case 35678:case 36198:case 36298:case 36306:case 35682:return nj;case 35679:case 36299:case 36307:return sj;case 35680:case 36300:case 36308:case 36293:return rj;case 36289:case 36303:case 36311:case 36292:return oj}}function cj(n,e){n.uniform1fv(this.addr,e)}function lj(n,e){const t=Mp(e,this.size,2);n.uniform2fv(this.addr,t)}function hj(n,e){const t=Mp(e,this.size,3);n.uniform3fv(this.addr,t)}function uj(n,e){const t=Mp(e,this.size,4);n.uniform4fv(this.addr,t)}function dj(n,e){const t=Mp(e,this.size,4);n.uniformMatrix2fv(this.addr,!1,t)}function fj(n,e){const t=Mp(e,this.size,9);n.uniformMatrix3fv(this.addr,!1,t)}function pj(n,e){const t=Mp(e,this.size,16);n.uniformMatrix4fv(this.addr,!1,t)}function mj(n,e){n.uniform1iv(this.addr,e)}function gj(n,e){n.uniform2iv(this.addr,e)}function Aj(n,e){n.uniform3iv(this.addr,e)}function vj(n,e){n.uniform4iv(this.addr,e)}function yj(n,e){n.uniform1uiv(this.addr,e)}function bj(n,e){n.uniform2uiv(this.addr,e)}function _j(n,e){n.uniform3uiv(this.addr,e)}function xj(n,e){n.uniform4uiv(this.addr,e)}function wj(n,e,t){const i=this.cache,s=e.length,r=R_(t,s);Qn(i,r)||(n.uniform1iv(this.addr,r),jn(i,r));for(let o=0;o!==s;++o)t.setTexture2D(e[o]||p2,r[o])}function Sj(n,e,t){const i=this.cache,s=e.length,r=R_(t,s);Qn(i,r)||(n.uniform1iv(this.addr,r),jn(i,r));for(let o=0;o!==s;++o)t.setTexture3D(e[o]||A2,r[o])}function Cj(n,e,t){const i=this.cache,s=e.length,r=R_(t,s);Qn(i,r)||(n.uniform1iv(this.addr,r),jn(i,r));for(let o=0;o!==s;++o)t.setTextureCube(e[o]||v2,r[o])}function Ej(n,e,t){const i=this.cache,s=e.length,r=R_(t,s);Qn(i,r)||(n.uniform1iv(this.addr,r),jn(i,r));for(let o=0;o!==s;++o)t.setTexture2DArray(e[o]||g2,r[o])}function Tj(n){switch(n){case 5126:return cj;case 35664:return lj;case 35665:return hj;case 35666:return uj;case 35674:return dj;case 35675:return fj;case 35676:return pj;case 5124:case 35670:return mj;case 35667:case 35671:return gj;case 35668:case 35672:return Aj;case 35669:case 35673:return vj;case 5125:return yj;case 36294:return bj;case 36295:return _j;case 36296:return xj;case 35678:case 36198:case 36298:case 36306:case 35682:return wj;case 35679:case 36299:case 36307:return Sj;case 35680:case 36300:case 36308:case 36293:return Cj;case 36289:case 36303:case 36311:case 36292:return Ej}}class Mj{constructor(e,t,i){this.id=e,this.addr=i,this.cache=[],this.type=t.type,this.setValue=aj(t.type)}}class Ij{constructor(e,t,i){this.id=e,this.addr=i,this.cache=[],this.type=t.type,this.size=t.size,this.setValue=Tj(t.type)}}class Rj{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,t,i){const s=this.seq;for(let r=0,o=s.length;r!==o;++r){const a=s[r];a.setValue(e,t[a.id],i)}}}const Ww=/(\w+)(\])?(\[|\.)?/g;function KR(n,e){n.seq.push(e),n.map[e.id]=e}function Pj(n,e,t){const i=n.name,s=i.length;for(Ww.lastIndex=0;;){const r=Ww.exec(i),o=Ww.lastIndex;let a=r[1];const c=r[2]==="]",l=r[3];if(c&&(a=a|0),l===void 0||l==="["&&o+2===s){KR(t,l===void 0?new Mj(a,n,e):new Ij(a,n,e));break}else{let d=t.map[a];d===void 0&&(d=new Rj(a),KR(t,d)),t=d}}}class x0{constructor(e,t){this.seq=[],this.map={};const i=e.getProgramParameter(t,e.ACTIVE_UNIFORMS);for(let s=0;s<i;++s){const r=e.getActiveUniform(t,s),o=e.getUniformLocation(t,r.name);Pj(r,o,this)}}setValue(e,t,i,s){const r=this.map[t];r!==void 0&&r.setValue(e,i,s)}setOptional(e,t,i){const s=t[i];s!==void 0&&this.setValue(e,i,s)}static upload(e,t,i,s){for(let r=0,o=t.length;r!==o;++r){const a=t[r],c=i[a.id];c.needsUpdate!==!1&&a.setValue(e,c.value,s)}}static seqWithValue(e,t){const i=[];for(let s=0,r=e.length;s!==r;++s){const o=e[s];o.id in t&&i.push(o)}return i}}function ZR(n,e,t){const i=n.createShader(e);return n.shaderSource(i,t),n.compileShader(i),i}const Bj=37297;let Dj=0;function Oj(n,e){const t=n.split(`
`),i=[],s=Math.max(e-6,0),r=Math.min(e+6,t.length);for(let o=s;o<r;o++){const a=o+1;i.push(`${a===e?">":" "} ${a}: ${t[o]}`)}return i.join(`
`)}function kj(n){const e=_i.getPrimaries(_i.workingColorSpace),t=_i.getPrimaries(n);let i;switch(e===t?i="":e===Yg&&t===Xg?i="LinearDisplayP3ToLinearSRGB":e===Xg&&t===Yg&&(i="LinearSRGBToLinearDisplayP3"),n){case Ri:case Cp:return[i,"LinearTransferOETF"];case zt:case kA:return[i,"sRGBTransferOETF"];default:return console.warn("THREE.WebGLProgram: Unsupported color space:",n),[i,"LinearTransferOETF"]}}function $R(n,e,t){const i=n.getShaderParameter(e,n.COMPILE_STATUS),s=n.getShaderInfoLog(e).trim();if(i&&s==="")return"";const r=/ERROR: 0:(\d+)/.exec(s);if(r){const o=parseInt(r[1]);return t.toUpperCase()+`

`+s+`

`+Oj(n.getShaderSource(e),o)}else return s}function Lj(n,e){const t=kj(e);return`vec4 ${n}( vec4 value ) { return ${t[0]}( ${t[1]}( value ) ); }`}function Fj(n,e){let t;switch(e){case Hg:t="Linear";break;case rM:t="Reinhard";break;case IL:t="OptimizedCineon";break;case oM:t="ACESFilmic";break;case PL:t="AgX";break;case RL:t="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),t="Linear"}return"vec3 "+n+"( vec3 color ) { return "+t+"ToneMapping( color ); }"}function Uj(n){return[n.extensionDerivatives||n.envMapCubeUVHeight||n.bumpMap||n.normalMapTangentSpace||n.clearcoatNormalMap||n.flatShading||n.alphaToCoverage||n.shaderID==="physical"?"#extension GL_OES_standard_derivatives : enable":"",(n.extensionFragDepth||n.logarithmicDepthBuffer)&&n.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",n.extensionDrawBuffers&&n.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(n.extensionShaderTextureLOD||n.envMap||n.transmission)&&n.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(If).join(`
`)}function Nj(n){return[n.extensionClipCullDistance?"#extension GL_ANGLE_clip_cull_distance : require":""].filter(If).join(`
`)}function zj(n){const e=[];for(const t in n){const i=n[t];i!==!1&&e.push("#define "+t+" "+i)}return e.join(`
`)}function Gj(n,e){const t={},i=n.getProgramParameter(e,n.ACTIVE_ATTRIBUTES);for(let s=0;s<i;s++){const r=n.getActiveAttrib(e,s),o=r.name;let a=1;r.type===n.FLOAT_MAT2&&(a=2),r.type===n.FLOAT_MAT3&&(a=3),r.type===n.FLOAT_MAT4&&(a=4),t[o]={type:r.type,location:n.getAttribLocation(e,o),locationSize:a}}return t}function If(n){return n!==""}function eP(n,e){const t=e.numSpotLightShadows+e.numSpotLightMaps-e.numSpotLightShadowsWithMaps;return n.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,e.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,t).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,e.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function tP(n,e){return n.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const Vj=/^[ \t]*#include +<([\w\d./]+)>/gm;function mE(n){return n.replace(Vj,Qj)}const Hj=new Map([["encodings_fragment","colorspace_fragment"],["encodings_pars_fragment","colorspace_pars_fragment"],["output_fragment","opaque_fragment"]]);function Qj(n,e){let t=Bt[e];if(t===void 0){const i=Hj.get(e);if(i!==void 0)t=Bt[i],console.warn('THREE.WebGLRenderer: Shader chunk "%s" has been deprecated. Use "%s" instead.',e,i);else throw new Error("Can not resolve #include <"+e+">")}return mE(t)}const jj=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function iP(n){return n.replace(jj,Wj)}function Wj(n,e,t,i){let s="";for(let r=parseInt(e);r<parseInt(t);r++)s+=i.replace(/\[\s*i\s*\]/g,"[ "+r+" ]").replace(/UNROLLED_LOOP_INDEX/g,r);return s}function nP(n){let e=`precision ${n.precision} float;
	precision ${n.precision} int;
	precision ${n.precision} sampler2D;
	precision ${n.precision} samplerCube;
	`;return n.isWebGL2&&(e+=`precision ${n.precision} sampler3D;
		precision ${n.precision} sampler2DArray;
		precision ${n.precision} sampler2DShadow;
		precision ${n.precision} samplerCubeShadow;
		precision ${n.precision} sampler2DArrayShadow;
		precision ${n.precision} isampler2D;
		precision ${n.precision} isampler3D;
		precision ${n.precision} isamplerCube;
		precision ${n.precision} isampler2DArray;
		precision ${n.precision} usampler2D;
		precision ${n.precision} usampler3D;
		precision ${n.precision} usamplerCube;
		precision ${n.precision} usampler2DArray;
		`),n.precision==="highp"?e+=`
#define HIGH_PRECISION`:n.precision==="mediump"?e+=`
#define MEDIUM_PRECISION`:n.precision==="lowp"&&(e+=`
#define LOW_PRECISION`),e}function qj(n){let e="SHADOWMAP_TYPE_BASIC";return n.shadowMapType===tM?e="SHADOWMAP_TYPE_PCF":n.shadowMapType===iM?e="SHADOWMAP_TYPE_PCF_SOFT":n.shadowMapType===Oa&&(e="SHADOWMAP_TYPE_VSM"),e}function Xj(n){let e="ENVMAP_TYPE_CUBE";if(n.envMap)switch(n.envMapMode){case _l:case Nh:e="ENVMAP_TYPE_CUBE";break;case Sp:e="ENVMAP_TYPE_CUBE_UV";break}return e}function Yj(n){let e="ENVMAP_MODE_REFLECTION";if(n.envMap)switch(n.envMapMode){case Nh:e="ENVMAP_MODE_REFRACTION";break}return e}function Jj(n){let e="ENVMAP_BLENDING_NONE";if(n.envMap)switch(n.combine){case DA:e="ENVMAP_BLENDING_MULTIPLY";break;case TL:e="ENVMAP_BLENDING_MIX";break;case ML:e="ENVMAP_BLENDING_ADD";break}return e}function Kj(n){const e=n.envMapCubeUVHeight;if(e===null)return null;const t=Math.log2(e)-2,i=1/e;return{texelWidth:1/(3*Math.max(Math.pow(2,t),7*16)),texelHeight:i,maxMip:t}}function Zj(n,e,t,i){const s=n.getContext(),r=t.defines;let o=t.vertexShader,a=t.fragmentShader;const c=qj(t),l=Xj(t),h=Yj(t),d=Jj(t),f=Kj(t),p=t.isWebGL2?"":Uj(t),m=Nj(t),g=zj(r),y=s.createProgram();let A,v,b=t.glslVersion?"#version "+t.glslVersion+`
`:"";t.isRawShaderMaterial?(A=["#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,g].filter(If).join(`
`),A.length>0&&(A+=`
`),v=[p,"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,g].filter(If).join(`
`),v.length>0&&(v+=`
`)):(A=[nP(t),"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,g,t.extensionClipCullDistance?"#define USE_CLIP_DISTANCE":"",t.batching?"#define USE_BATCHING":"",t.instancing?"#define USE_INSTANCING":"",t.instancingColor?"#define USE_INSTANCING_COLOR":"",t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.occlusion?"#define USE_OCCLUSION":"",t.map?"#define USE_MAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+h:"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",t.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",t.displacementMap?"#define USE_DISPLACEMENTMAP":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.anisotropy?"#define USE_ANISOTROPY":"",t.anisotropyMap?"#define USE_ANISOTROPYMAP":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",t.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaHash?"#define USE_ALPHAHASH":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",t.mapUv?"#define MAP_UV "+t.mapUv:"",t.alphaMapUv?"#define ALPHAMAP_UV "+t.alphaMapUv:"",t.lightMapUv?"#define LIGHTMAP_UV "+t.lightMapUv:"",t.aoMapUv?"#define AOMAP_UV "+t.aoMapUv:"",t.emissiveMapUv?"#define EMISSIVEMAP_UV "+t.emissiveMapUv:"",t.bumpMapUv?"#define BUMPMAP_UV "+t.bumpMapUv:"",t.normalMapUv?"#define NORMALMAP_UV "+t.normalMapUv:"",t.displacementMapUv?"#define DISPLACEMENTMAP_UV "+t.displacementMapUv:"",t.metalnessMapUv?"#define METALNESSMAP_UV "+t.metalnessMapUv:"",t.roughnessMapUv?"#define ROUGHNESSMAP_UV "+t.roughnessMapUv:"",t.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+t.anisotropyMapUv:"",t.clearcoatMapUv?"#define CLEARCOATMAP_UV "+t.clearcoatMapUv:"",t.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+t.clearcoatNormalMapUv:"",t.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+t.clearcoatRoughnessMapUv:"",t.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+t.iridescenceMapUv:"",t.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+t.iridescenceThicknessMapUv:"",t.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+t.sheenColorMapUv:"",t.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+t.sheenRoughnessMapUv:"",t.specularMapUv?"#define SPECULARMAP_UV "+t.specularMapUv:"",t.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+t.specularColorMapUv:"",t.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+t.specularIntensityMapUv:"",t.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+t.transmissionMapUv:"",t.thicknessMapUv?"#define THICKNESSMAP_UV "+t.thicknessMapUv:"",t.vertexTangents&&t.flatShading===!1?"#define USE_TANGENT":"",t.vertexColors?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUv1s?"#define USE_UV1":"",t.vertexUv2s?"#define USE_UV2":"",t.vertexUv3s?"#define USE_UV3":"",t.pointsUvs?"#define USE_POINTS_UV":"",t.flatShading?"#define FLAT_SHADED":"",t.skinning?"#define USE_SKINNING":"",t.morphTargets?"#define USE_MORPHTARGETS":"",t.morphNormals&&t.flatShading===!1?"#define USE_MORPHNORMALS":"",t.morphColors&&t.isWebGL2?"#define USE_MORPHCOLORS":"",t.morphTargetsCount>0&&t.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",t.morphTargetsCount>0&&t.isWebGL2?"#define MORPHTARGETS_TEXTURE_STRIDE "+t.morphTextureStride:"",t.morphTargetsCount>0&&t.isWebGL2?"#define MORPHTARGETS_COUNT "+t.morphTargetsCount:"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+c:"",t.sizeAttenuation?"#define USE_SIZEATTENUATION":"",t.numLightProbes>0?"#define USE_LIGHT_PROBES":"",t.useLegacyLights?"#define LEGACY_LIGHTS":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.logarithmicDepthBuffer&&t.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","	attribute vec2 uv1;","#endif","#ifdef USE_UV2","	attribute vec2 uv2;","#endif","#ifdef USE_UV3","	attribute vec2 uv3;","#endif","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","	attribute vec3 morphTarget0;","	attribute vec3 morphTarget1;","	attribute vec3 morphTarget2;","	attribute vec3 morphTarget3;","	#ifdef USE_MORPHNORMALS","		attribute vec3 morphNormal0;","		attribute vec3 morphNormal1;","		attribute vec3 morphNormal2;","		attribute vec3 morphNormal3;","	#else","		attribute vec3 morphTarget4;","		attribute vec3 morphTarget5;","		attribute vec3 morphTarget6;","		attribute vec3 morphTarget7;","	#endif","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(If).join(`
`),v=[p,nP(t),"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,g,t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.alphaToCoverage?"#define ALPHA_TO_COVERAGE":"",t.occlusion?"#define USE_OCCLUSION":"",t.map?"#define USE_MAP":"",t.matcap?"#define USE_MATCAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+l:"",t.envMap?"#define "+h:"",t.envMap?"#define "+d:"",f?"#define CUBEUV_TEXEL_WIDTH "+f.texelWidth:"",f?"#define CUBEUV_TEXEL_HEIGHT "+f.texelHeight:"",f?"#define CUBEUV_MAX_MIP "+f.maxMip+".0":"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",t.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.anisotropy?"#define USE_ANISOTROPY":"",t.anisotropyMap?"#define USE_ANISOTROPYMAP":"",t.clearcoat?"#define USE_CLEARCOAT":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.iridescence?"#define USE_IRIDESCENCE":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",t.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaTest?"#define USE_ALPHATEST":"",t.alphaHash?"#define USE_ALPHAHASH":"",t.sheen?"#define USE_SHEEN":"",t.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.vertexTangents&&t.flatShading===!1?"#define USE_TANGENT":"",t.vertexColors||t.instancingColor?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUv1s?"#define USE_UV1":"",t.vertexUv2s?"#define USE_UV2":"",t.vertexUv3s?"#define USE_UV3":"",t.pointsUvs?"#define USE_POINTS_UV":"",t.gradientMap?"#define USE_GRADIENTMAP":"",t.flatShading?"#define FLAT_SHADED":"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+c:"",t.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",t.numLightProbes>0?"#define USE_LIGHT_PROBES":"",t.useLegacyLights?"#define LEGACY_LIGHTS":"",t.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.logarithmicDepthBuffer&&t.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",t.toneMapping!==Fr?"#define TONE_MAPPING":"",t.toneMapping!==Fr?Bt.tonemapping_pars_fragment:"",t.toneMapping!==Fr?Fj("toneMapping",t.toneMapping):"",t.dithering?"#define DITHERING":"",t.opaque?"#define OPAQUE":"",Bt.colorspace_pars_fragment,Lj("linearToOutputTexel",t.outputColorSpace),t.useDepthPacking?"#define DEPTH_PACKING "+t.depthPacking:"",`
`].filter(If).join(`
`)),o=mE(o),o=eP(o,t),o=tP(o,t),a=mE(a),a=eP(a,t),a=tP(a,t),o=iP(o),a=iP(a),t.isWebGL2&&t.isRawShaderMaterial!==!0&&(b=`#version 300 es
`,A=[m,"precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+A,v=["precision mediump sampler2DArray;","#define varying in",t.glslVersion===ab?"":"layout(location = 0) out highp vec4 pc_fragColor;",t.glslVersion===ab?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+v);const _=b+A+o,T=b+v+a,E=ZR(s,s.VERTEX_SHADER,_),M=ZR(s,s.FRAGMENT_SHADER,T);s.attachShader(y,E),s.attachShader(y,M),t.index0AttributeName!==void 0?s.bindAttribLocation(y,0,t.index0AttributeName):t.morphTargets===!0&&s.bindAttribLocation(y,0,"position"),s.linkProgram(y);function I(G){if(n.debug.checkShaderErrors){const Q=s.getProgramInfoLog(y).trim(),L=s.getShaderInfoLog(E).trim(),V=s.getShaderInfoLog(M).trim();let O=!0,U=!0;if(s.getProgramParameter(y,s.LINK_STATUS)===!1)if(O=!1,typeof n.debug.onShaderError=="function")n.debug.onShaderError(s,y,E,M);else{const H=$R(s,E,"vertex"),Y=$R(s,M,"fragment");console.error("THREE.WebGLProgram: Shader Error "+s.getError()+" - VALIDATE_STATUS "+s.getProgramParameter(y,s.VALIDATE_STATUS)+`

Material Name: `+G.name+`
Material Type: `+G.type+`

Program Info Log: `+Q+`
`+H+`
`+Y)}else Q!==""?console.warn("THREE.WebGLProgram: Program Info Log:",Q):(L===""||V==="")&&(U=!1);U&&(G.diagnostics={runnable:O,programLog:Q,vertexShader:{log:L,prefix:A},fragmentShader:{log:V,prefix:v}})}s.deleteShader(E),s.deleteShader(M),S=new x0(s,y),C=Gj(s,y)}let S;this.getUniforms=function(){return S===void 0&&I(this),S};let C;this.getAttributes=function(){return C===void 0&&I(this),C};let D=t.rendererExtensionParallelShaderCompile===!1;return this.isReady=function(){return D===!1&&(D=s.getProgramParameter(y,Bj)),D},this.destroy=function(){i.releaseStatesOfProgram(this),s.deleteProgram(y),this.program=void 0},this.type=t.shaderType,this.name=t.shaderName,this.id=Dj++,this.cacheKey=e,this.usedTimes=1,this.program=y,this.vertexShader=E,this.fragmentShader=M,this}let $j=0;class e5{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){const t=e.vertexShader,i=e.fragmentShader,s=this._getShaderStage(t),r=this._getShaderStage(i),o=this._getShaderCacheForMaterial(e);return o.has(s)===!1&&(o.add(s),s.usedTimes++),o.has(r)===!1&&(o.add(r),r.usedTimes++),this}remove(e){const t=this.materialCache.get(e);for(const i of t)i.usedTimes--,i.usedTimes===0&&this.shaderCache.delete(i.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){const t=this.materialCache;let i=t.get(e);return i===void 0&&(i=new Set,t.set(e,i)),i}_getShaderStage(e){const t=this.shaderCache;let i=t.get(e);return i===void 0&&(i=new t5(e),t.set(e,i)),i}}class t5{constructor(e){this.id=$j++,this.code=e,this.usedTimes=0}}function i5(n,e,t,i,s,r,o){const a=new Ar,c=new e5,l=[],h=s.isWebGL2,d=s.logarithmicDepthBuffer,f=s.vertexTextures;let p=s.precision;const m={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function g(S){return S===0?"uv":`uv${S}`}function y(S,C,D,G,Q,L){const V=G.fog,O=Q.geometry,U=S.isMeshStandardMaterial?G.environment:null,H=(S.isMeshStandardMaterial?t:e).get(S.envMap||U),Y=H&&H.mapping===Sp?H.image.height:null,J=m[S.type];S.precision!==null&&(p=s.getMaxPrecision(S.precision),p!==S.precision&&console.warn("THREE.WebGLProgram.getParameters:",S.precision,"not supported, using",p,"instead."));const se=O.morphAttributes.position||O.morphAttributes.normal||O.morphAttributes.color,fe=se!==void 0?se.length:0;let _e=0;O.morphAttributes.position!==void 0&&(_e=1),O.morphAttributes.normal!==void 0&&(_e=2),O.morphAttributes.color!==void 0&&(_e=3);let Oe,qe,ae,ve;if(J){const vn=ys[J];Oe=vn.vertexShader,qe=vn.fragmentShader}else Oe=S.vertexShader,qe=S.fragmentShader,c.update(S),ae=c.getVertexShaderID(S),ve=c.getFragmentShaderID(S);const Ue=n.getRenderTarget(),Ge=Q.isInstancedMesh===!0,Xe=Q.isBatchedMesh===!0,ze=!!S.map,Pe=!!S.matcap,X=!!H,Ae=!!S.aoMap,ke=!!S.lightMap,be=!!S.bumpMap,je=!!S.normalMap,ct=!!S.displacementMap,F=!!S.emissiveMap,B=!!S.metalnessMap,ce=!!S.roughnessMap,Se=S.anisotropy>0,xe=S.clearcoat>0,Ie=S.iridescence>0,et=S.sheen>0,Fe=S.transmission>0,Ke=Se&&!!S.anisotropyMap,rt=xe&&!!S.clearcoatMap,At=xe&&!!S.clearcoatNormalMap,Ee=xe&&!!S.clearcoatRoughnessMap,Rt=Ie&&!!S.iridescenceMap,dt=Ie&&!!S.iridescenceThicknessMap,ft=et&&!!S.sheenColorMap,Ze=et&&!!S.sheenRoughnessMap,Ve=!!S.specularMap,pt=!!S.specularColorMap,Pt=!!S.specularIntensityMap,j=Fe&&!!S.transmissionMap,Ne=Fe&&!!S.thicknessMap,ne=!!S.gradientMap,q=!!S.alphaMap,He=S.alphaTest>0,Ye=!!S.alphaHash,at=!!S.extensions,xt=!!O.attributes.uv1,Ei=!!O.attributes.uv2,vi=!!O.attributes.uv3,fi=!!L;let Li=Fr;return S.toneMapped&&(Ue===null||Ue.isXRRenderTarget===!0)&&(Li=n.toneMapping),{isWebGL2:h,shaderID:J,shaderType:S.type,shaderName:S.name,vertexShader:Oe,fragmentShader:qe,defines:S.defines,customVertexShaderID:ae,customFragmentShaderID:ve,isRawShaderMaterial:S.isRawShaderMaterial===!0,glslVersion:S.glslVersion,precision:p,batching:Xe,instancing:Ge,instancingColor:Ge&&Q.instanceColor!==null,supportsVertexTextures:f,outputColorSpace:Ue===null?n.outputColorSpace:Ue.isXRRenderTarget===!0?Ue.texture.colorSpace:Ri,alphaToCoverage:!!S.alphaToCoverage,map:ze,matcap:Pe,envMap:X,envMapMode:X&&H.mapping,envMapCubeUVHeight:Y,aoMap:Ae,lightMap:ke,bumpMap:be,normalMap:je,displacementMap:f&&ct,emissiveMap:F,normalMapObjectSpace:je&&S.normalMapType===zL,normalMapTangentSpace:je&&S.normalMapType===Xh,metalnessMap:B,roughnessMap:ce,anisotropy:Se,anisotropyMap:Ke,clearcoat:xe,clearcoatMap:rt,clearcoatNormalMap:At,clearcoatRoughnessMap:Ee,iridescence:Ie,iridescenceMap:Rt,iridescenceThicknessMap:dt,sheen:et,sheenColorMap:ft,sheenRoughnessMap:Ze,specularMap:Ve,specularColorMap:pt,specularIntensityMap:Pt,transmission:Fe,transmissionMap:j,thicknessMap:Ne,gradientMap:ne,opaque:S.transparent===!1&&S.blending===Th&&S.alphaToCoverage===!1,alphaMap:q,alphaTest:He,alphaHash:Ye,combine:S.combine,occlusion:fi,mapUv:ze&&g(S.map.channel),aoMapUv:Ae&&g(S.aoMap.channel),lightMapUv:ke&&g(S.lightMap.channel),bumpMapUv:be&&g(S.bumpMap.channel),normalMapUv:je&&g(S.normalMap.channel),displacementMapUv:ct&&g(S.displacementMap.channel),emissiveMapUv:F&&g(S.emissiveMap.channel),metalnessMapUv:B&&g(S.metalnessMap.channel),roughnessMapUv:ce&&g(S.roughnessMap.channel),anisotropyMapUv:Ke&&g(S.anisotropyMap.channel),clearcoatMapUv:rt&&g(S.clearcoatMap.channel),clearcoatNormalMapUv:At&&g(S.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:Ee&&g(S.clearcoatRoughnessMap.channel),iridescenceMapUv:Rt&&g(S.iridescenceMap.channel),iridescenceThicknessMapUv:dt&&g(S.iridescenceThicknessMap.channel),sheenColorMapUv:ft&&g(S.sheenColorMap.channel),sheenRoughnessMapUv:Ze&&g(S.sheenRoughnessMap.channel),specularMapUv:Ve&&g(S.specularMap.channel),specularColorMapUv:pt&&g(S.specularColorMap.channel),specularIntensityMapUv:Pt&&g(S.specularIntensityMap.channel),transmissionMapUv:j&&g(S.transmissionMap.channel),thicknessMapUv:Ne&&g(S.thicknessMap.channel),alphaMapUv:q&&g(S.alphaMap.channel),vertexTangents:!!O.attributes.tangent&&(je||Se),vertexColors:S.vertexColors,vertexAlphas:S.vertexColors===!0&&!!O.attributes.color&&O.attributes.color.itemSize===4,vertexUv1s:xt,vertexUv2s:Ei,vertexUv3s:vi,pointsUvs:Q.isPoints===!0&&!!O.attributes.uv&&(ze||q),fog:!!V,useFog:S.fog===!0,fogExp2:!!V&&V.isFogExp2,useOcclusion:S.occlusion===!0,flatShading:S.flatShading===!0,sizeAttenuation:S.sizeAttenuation===!0,logarithmicDepthBuffer:d,skinning:Q.isSkinnedMesh===!0,morphTargets:O.morphAttributes.position!==void 0,morphNormals:O.morphAttributes.normal!==void 0,morphColors:O.morphAttributes.color!==void 0,morphTargetsCount:fe,morphTextureStride:_e,numDirLights:C.directional.length,numPointLights:C.point.length,numSpotLights:C.spot.length,numSpotLightMaps:C.spotLightMap.length,numRectAreaLights:C.rectArea.length,numHemiLights:C.hemi.length,numDirLightShadows:C.directionalShadowMap.length,numPointLightShadows:C.pointShadowMap.length,numSpotLightShadows:C.spotShadowMap.length,numSpotLightShadowsWithMaps:C.numSpotLightShadowsWithMaps,numLightProbes:C.numLightProbes,numClippingPlanes:o.numPlanes,numClipIntersection:o.numIntersection,dithering:S.dithering,shadowMapEnabled:n.shadowMap.enabled&&D.length>0,shadowMapType:n.shadowMap.type,toneMapping:Li,useLegacyLights:n._useLegacyLights,decodeVideoTexture:ze&&S.map.isVideoTexture===!0&&_i.getTransfer(S.map.colorSpace)===Ui,premultipliedAlpha:S.premultipliedAlpha,doubleSided:S.side===Ai,flipSided:S.side===mn,useDepthPacking:S.depthPacking>=0,depthPacking:S.depthPacking||0,index0AttributeName:S.index0AttributeName,extensionDerivatives:at&&S.extensions.derivatives===!0,extensionFragDepth:at&&S.extensions.fragDepth===!0,extensionDrawBuffers:at&&S.extensions.drawBuffers===!0,extensionShaderTextureLOD:at&&S.extensions.shaderTextureLOD===!0,extensionClipCullDistance:at&&S.extensions.clipCullDistance&&i.has("WEBGL_clip_cull_distance"),rendererExtensionFragDepth:h||i.has("EXT_frag_depth"),rendererExtensionDrawBuffers:h||i.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:h||i.has("EXT_shader_texture_lod"),rendererExtensionParallelShaderCompile:i.has("KHR_parallel_shader_compile"),customProgramCacheKey:S.customProgramCacheKey()}}function A(S){const C=[];if(S.shaderID?C.push(S.shaderID):(C.push(S.customVertexShaderID),C.push(S.customFragmentShaderID)),S.defines!==void 0)for(const D in S.defines)C.push(D),C.push(S.defines[D]);return S.isRawShaderMaterial===!1&&(v(C,S),b(C,S),C.push(n.outputColorSpace)),C.push(S.customProgramCacheKey),C.push(S.occlusion),C.join()}function v(S,C){S.push(C.precision),S.push(C.outputColorSpace),S.push(C.envMapMode),S.push(C.envMapCubeUVHeight),S.push(C.mapUv),S.push(C.alphaMapUv),S.push(C.lightMapUv),S.push(C.aoMapUv),S.push(C.bumpMapUv),S.push(C.normalMapUv),S.push(C.displacementMapUv),S.push(C.emissiveMapUv),S.push(C.metalnessMapUv),S.push(C.roughnessMapUv),S.push(C.anisotropyMapUv),S.push(C.clearcoatMapUv),S.push(C.clearcoatNormalMapUv),S.push(C.clearcoatRoughnessMapUv),S.push(C.iridescenceMapUv),S.push(C.iridescenceThicknessMapUv),S.push(C.sheenColorMapUv),S.push(C.sheenRoughnessMapUv),S.push(C.specularMapUv),S.push(C.specularColorMapUv),S.push(C.specularIntensityMapUv),S.push(C.transmissionMapUv),S.push(C.thicknessMapUv),S.push(C.combine),S.push(C.fogExp2),S.push(C.sizeAttenuation),S.push(C.morphTargetsCount),S.push(C.morphAttributeCount),S.push(C.numDirLights),S.push(C.numPointLights),S.push(C.numSpotLights),S.push(C.numSpotLightMaps),S.push(C.numHemiLights),S.push(C.numRectAreaLights),S.push(C.numDirLightShadows),S.push(C.numPointLightShadows),S.push(C.numSpotLightShadows),S.push(C.numSpotLightShadowsWithMaps),S.push(C.numLightProbes),S.push(C.shadowMapType),S.push(C.toneMapping),S.push(C.numClippingPlanes),S.push(C.numClipIntersection),S.push(C.depthPacking)}function b(S,C){a.disableAll(),C.isWebGL2&&a.enable(0),C.supportsVertexTextures&&a.enable(1),C.instancing&&a.enable(2),C.instancingColor&&a.enable(3),C.matcap&&a.enable(4),C.envMap&&a.enable(5),C.normalMapObjectSpace&&a.enable(6),C.normalMapTangentSpace&&a.enable(7),C.clearcoat&&a.enable(8),C.iridescence&&a.enable(9),C.alphaTest&&a.enable(10),C.vertexColors&&a.enable(11),C.vertexAlphas&&a.enable(12),C.vertexUv1s&&a.enable(13),C.vertexUv2s&&a.enable(14),C.vertexUv3s&&a.enable(15),C.vertexTangents&&a.enable(16),C.anisotropy&&a.enable(17),C.alphaHash&&a.enable(18),C.batching&&a.enable(19),S.push(a.mask),a.disableAll(),C.fog&&a.enable(0),C.useFog&&a.enable(1),C.flatShading&&a.enable(2),C.logarithmicDepthBuffer&&a.enable(3),C.skinning&&a.enable(4),C.morphTargets&&a.enable(5),C.morphNormals&&a.enable(6),C.morphColors&&a.enable(7),C.premultipliedAlpha&&a.enable(8),C.shadowMapEnabled&&a.enable(9),C.useLegacyLights&&a.enable(10),C.doubleSided&&a.enable(11),C.flipSided&&a.enable(12),C.useDepthPacking&&a.enable(13),C.dithering&&a.enable(14),C.transmission&&a.enable(15),C.sheen&&a.enable(16),C.opaque&&a.enable(17),C.pointsUvs&&a.enable(18),C.decodeVideoTexture&&a.enable(19),C.alphaToCoverage&&a.enable(20),S.push(a.mask)}function _(S){const C=m[S.type];let D;if(C){const G=ys[C];D=Ep.clone(G.uniforms)}else D=S.uniforms;return D}function T(S,C){let D;for(let G=0,Q=l.length;G<Q;G++){const L=l[G];if(L.cacheKey===C){D=L,++D.usedTimes;break}}return D===void 0&&(D=new Zj(n,C,S,r),l.push(D)),D}function E(S){if(--S.usedTimes===0){const C=l.indexOf(S);l[C]=l[l.length-1],l.pop(),S.destroy()}}function M(S){c.remove(S)}function I(){c.dispose()}return{getParameters:y,getProgramCacheKey:A,getUniforms:_,acquireProgram:T,releaseProgram:E,releaseShaderCache:M,programs:l,dispose:I}}function n5(){let n=new WeakMap;function e(r){let o=n.get(r);return o===void 0&&(o={},n.set(r,o)),o}function t(r){n.delete(r)}function i(r,o,a){n.get(r)[o]=a}function s(){n=new WeakMap}return{get:e,remove:t,update:i,dispose:s}}function s5(n,e){return n.groupOrder!==e.groupOrder?n.groupOrder-e.groupOrder:n.renderOrder!==e.renderOrder?n.renderOrder-e.renderOrder:n.material.id!==e.material.id?n.material.id-e.material.id:n.z!==e.z?n.z-e.z:n.id-e.id}function sP(n,e){return n.groupOrder!==e.groupOrder?n.groupOrder-e.groupOrder:n.renderOrder!==e.renderOrder?n.renderOrder-e.renderOrder:n.z!==e.z?e.z-n.z:n.id-e.id}function rP(){const n=[];let e=0;const t=[],i=[],s=[];function r(){e=0,t.length=0,i.length=0,s.length=0}function o(d,f,p,m,g,y){let A=n[e];return A===void 0?(A={id:d.id,object:d,geometry:f,material:p,groupOrder:m,renderOrder:d.renderOrder,z:g,group:y},n[e]=A):(A.id=d.id,A.object=d,A.geometry=f,A.material=p,A.groupOrder=m,A.renderOrder=d.renderOrder,A.z=g,A.group=y),e++,A}function a(d,f,p,m,g,y){const A=o(d,f,p,m,g,y);p.transmission>0?i.push(A):p.transparent===!0?s.push(A):t.push(A)}function c(d,f,p,m,g,y){const A=o(d,f,p,m,g,y);p.transmission>0?i.unshift(A):p.transparent===!0?s.unshift(A):t.unshift(A)}function l(d,f){t.length>1&&t.sort(d||s5),i.length>1&&i.sort(f||sP),s.length>1&&s.sort(f||sP)}function h(){for(let d=e,f=n.length;d<f;d++){const p=n[d];if(p.id===null)break;p.id=null,p.object=null,p.geometry=null,p.material=null,p.group=null}}return{opaque:t,transmissive:i,transparent:s,init:r,push:a,unshift:c,finish:h,sort:l}}function r5(){let n=new WeakMap;function e(i,s){const r=n.get(i);let o;return r===void 0?(o=new rP,n.set(i,[o])):s>=r.length?(o=new rP,r.push(o)):o=r[s],o}function t(){n=new WeakMap}return{get:e,dispose:t}}function o5(){const n={};return{get:function(e){if(n[e.id]!==void 0)return n[e.id];let t;switch(e.type){case"DirectionalLight":t={direction:new w,color:new ye};break;case"SpotLight":t={position:new w,direction:new w,color:new ye,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":t={position:new w,color:new ye,distance:0,decay:0};break;case"HemisphereLight":t={direction:new w,skyColor:new ye,groundColor:new ye};break;case"RectAreaLight":t={color:new ye,position:new w,halfWidth:new w,halfHeight:new w};break}return n[e.id]=t,t}}}function a5(){const n={};return{get:function(e){if(n[e.id]!==void 0)return n[e.id];let t;switch(e.type){case"DirectionalLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new ie};break;case"SpotLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new ie};break;case"PointLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new ie,shadowCameraNear:1,shadowCameraFar:1e3};break}return n[e.id]=t,t}}}let c5=0;function l5(n,e){return(e.castShadow?2:0)-(n.castShadow?2:0)+(e.map?1:0)-(n.map?1:0)}function h5(n,e){const t=new o5,i=a5(),s={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1,numLightProbes:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0,numLightProbes:0};for(let h=0;h<9;h++)s.probe.push(new w);const r=new w,o=new Ce,a=new Ce;function c(h,d){let f=0,p=0,m=0;for(let G=0;G<9;G++)s.probe[G].set(0,0,0);let g=0,y=0,A=0,v=0,b=0,_=0,T=0,E=0,M=0,I=0,S=0;h.sort(l5);const C=d===!0?Math.PI:1;for(let G=0,Q=h.length;G<Q;G++){const L=h[G],V=L.color,O=L.intensity,U=L.distance,H=L.shadow&&L.shadow.map?L.shadow.map.texture:null;if(L.isAmbientLight)f+=V.r*O*C,p+=V.g*O*C,m+=V.b*O*C;else if(L.isLightProbe){for(let Y=0;Y<9;Y++)s.probe[Y].addScaledVector(L.sh.coefficients[Y],O);S++}else if(L.isDirectionalLight){const Y=t.get(L);if(Y.color.copy(L.color).multiplyScalar(L.intensity*C),L.castShadow){const J=L.shadow,se=i.get(L);se.shadowBias=J.bias,se.shadowNormalBias=J.normalBias,se.shadowRadius=J.radius,se.shadowMapSize=J.mapSize,s.directionalShadow[g]=se,s.directionalShadowMap[g]=H,s.directionalShadowMatrix[g]=L.shadow.matrix,_++}s.directional[g]=Y,g++}else if(L.isSpotLight){const Y=t.get(L);Y.position.setFromMatrixPosition(L.matrixWorld),Y.color.copy(V).multiplyScalar(O*C),Y.distance=U,Y.coneCos=Math.cos(L.angle),Y.penumbraCos=Math.cos(L.angle*(1-L.penumbra)),Y.decay=L.decay,s.spot[A]=Y;const J=L.shadow;if(L.map&&(s.spotLightMap[M]=L.map,M++,J.updateMatrices(L),L.castShadow&&I++),s.spotLightMatrix[A]=J.matrix,L.castShadow){const se=i.get(L);se.shadowBias=J.bias,se.shadowNormalBias=J.normalBias,se.shadowRadius=J.radius,se.shadowMapSize=J.mapSize,s.spotShadow[A]=se,s.spotShadowMap[A]=H,E++}A++}else if(L.isRectAreaLight){const Y=t.get(L);Y.color.copy(V).multiplyScalar(O),Y.halfWidth.set(L.width*.5,0,0),Y.halfHeight.set(0,L.height*.5,0),s.rectArea[v]=Y,v++}else if(L.isPointLight){const Y=t.get(L);if(Y.color.copy(L.color).multiplyScalar(L.intensity*C),Y.distance=L.distance,Y.decay=L.decay,L.castShadow){const J=L.shadow,se=i.get(L);se.shadowBias=J.bias,se.shadowNormalBias=J.normalBias,se.shadowRadius=J.radius,se.shadowMapSize=J.mapSize,se.shadowCameraNear=J.camera.near,se.shadowCameraFar=J.camera.far,s.pointShadow[y]=se,s.pointShadowMap[y]=H,s.pointShadowMatrix[y]=L.shadow.matrix,T++}s.point[y]=Y,y++}else if(L.isHemisphereLight){const Y=t.get(L);Y.skyColor.copy(L.color).multiplyScalar(O*C),Y.groundColor.copy(L.groundColor).multiplyScalar(O*C),s.hemi[b]=Y,b++}}v>0&&(e.isWebGL2?n.has("OES_texture_float_linear")===!0?(s.rectAreaLTC1=De.LTC_FLOAT_1,s.rectAreaLTC2=De.LTC_FLOAT_2):(s.rectAreaLTC1=De.LTC_HALF_1,s.rectAreaLTC2=De.LTC_HALF_2):n.has("OES_texture_float_linear")===!0?(s.rectAreaLTC1=De.LTC_FLOAT_1,s.rectAreaLTC2=De.LTC_FLOAT_2):n.has("OES_texture_half_float_linear")===!0?(s.rectAreaLTC1=De.LTC_HALF_1,s.rectAreaLTC2=De.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),s.ambient[0]=f,s.ambient[1]=p,s.ambient[2]=m;const D=s.hash;(D.directionalLength!==g||D.pointLength!==y||D.spotLength!==A||D.rectAreaLength!==v||D.hemiLength!==b||D.numDirectionalShadows!==_||D.numPointShadows!==T||D.numSpotShadows!==E||D.numSpotMaps!==M||D.numLightProbes!==S)&&(s.directional.length=g,s.spot.length=A,s.rectArea.length=v,s.point.length=y,s.hemi.length=b,s.directionalShadow.length=_,s.directionalShadowMap.length=_,s.pointShadow.length=T,s.pointShadowMap.length=T,s.spotShadow.length=E,s.spotShadowMap.length=E,s.directionalShadowMatrix.length=_,s.pointShadowMatrix.length=T,s.spotLightMatrix.length=E+M-I,s.spotLightMap.length=M,s.numSpotLightShadowsWithMaps=I,s.numLightProbes=S,D.directionalLength=g,D.pointLength=y,D.spotLength=A,D.rectAreaLength=v,D.hemiLength=b,D.numDirectionalShadows=_,D.numPointShadows=T,D.numSpotShadows=E,D.numSpotMaps=M,D.numLightProbes=S,s.version=c5++)}function l(h,d){let f=0,p=0,m=0,g=0,y=0;const A=d.matrixWorldInverse;for(let v=0,b=h.length;v<b;v++){const _=h[v];if(_.isDirectionalLight){const T=s.directional[f];T.direction.setFromMatrixPosition(_.matrixWorld),r.setFromMatrixPosition(_.target.matrixWorld),T.direction.sub(r),T.direction.transformDirection(A),f++}else if(_.isSpotLight){const T=s.spot[m];T.position.setFromMatrixPosition(_.matrixWorld),T.position.applyMatrix4(A),T.direction.setFromMatrixPosition(_.matrixWorld),r.setFromMatrixPosition(_.target.matrixWorld),T.direction.sub(r),T.direction.transformDirection(A),m++}else if(_.isRectAreaLight){const T=s.rectArea[g];T.position.setFromMatrixPosition(_.matrixWorld),T.position.applyMatrix4(A),a.identity(),o.copy(_.matrixWorld),o.premultiply(A),a.extractRotation(o),T.halfWidth.set(_.width*.5,0,0),T.halfHeight.set(0,_.height*.5,0),T.halfWidth.applyMatrix4(a),T.halfHeight.applyMatrix4(a),g++}else if(_.isPointLight){const T=s.point[p];T.position.setFromMatrixPosition(_.matrixWorld),T.position.applyMatrix4(A),p++}else if(_.isHemisphereLight){const T=s.hemi[y];T.direction.setFromMatrixPosition(_.matrixWorld),T.direction.transformDirection(A),y++}}}return{setup:c,setupView:l,state:s}}function oP(n,e){const t=new h5(n,e),i=[],s=[];function r(){i.length=0,s.length=0}function o(d){i.push(d)}function a(d){s.push(d)}function c(d){t.setup(i,d)}function l(d){t.setupView(i,d)}return{init:r,state:{lightsArray:i,shadowsArray:s,lights:t},setupLights:c,setupLightsView:l,pushLight:o,pushShadow:a}}function u5(n,e){let t=new WeakMap;function i(r,o=0){const a=t.get(r);let c;return a===void 0?(c=new oP(n,e),t.set(r,[c])):o>=a.length?(c=new oP(n,e),a.push(c)):c=a[o],c}function s(){t=new WeakMap}return{get:i,dispose:s}}class NA extends Ot{constructor(e){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=Ts,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}class SM extends Ot{constructor(e){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}const d5=`void main() {
	gl_Position = vec4( position, 1.0 );
}`,f5=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`;function p5(n,e,t){let i=new UA;const s=new ie,r=new ie,o=new tt,a=new NA({depthPacking:T_}),c=new SM,l={},h=t.maxTextureSize,d={[Es]:mn,[mn]:Es,[Ai]:Ai},f=new Et({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new ie},radius:{value:4}},vertexShader:d5,fragmentShader:f5}),p=f.clone();p.defines.HORIZONTAL_PASS=1;const m=new gt;m.setAttribute("position",new it(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const g=new me(m,f),y=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=tM;let A=this.type;this.render=function(E,M,I){if(y.enabled===!1||y.autoUpdate===!1&&y.needsUpdate===!1||E.length===0)return;const S=n.getRenderTarget(),C=n.getActiveCubeFace(),D=n.getActiveMipmapLevel(),G=n.state;G.setBlending(rn),G.buffers.color.setClear(1,1,1,1),G.buffers.depth.setTest(!0),G.setScissorTest(!1);const Q=A!==Oa&&this.type===Oa,L=A===Oa&&this.type!==Oa;for(let V=0,O=E.length;V<O;V++){const U=E[V],H=U.shadow;if(H===void 0){console.warn("THREE.WebGLShadowMap:",U,"has no shadow.");continue}if(H.autoUpdate===!1&&H.needsUpdate===!1)continue;s.copy(H.mapSize);const Y=H.getFrameExtents();if(s.multiply(Y),r.copy(H.mapSize),(s.x>h||s.y>h)&&(s.x>h&&(r.x=Math.floor(h/Y.x),s.x=r.x*Y.x,H.mapSize.x=r.x),s.y>h&&(r.y=Math.floor(h/Y.y),s.y=r.y*Y.y,H.mapSize.y=r.y)),H.map===null||Q===!0||L===!0){const se=this.type!==Oa?{minFilter:Nt,magFilter:Nt}:{};H.map!==null&&H.map.dispose(),H.map=new Zt(s.x,s.y,se),H.map.texture.name=U.name+".shadowMap",H.camera.updateProjectionMatrix()}n.setRenderTarget(H.map),n.clear();const J=H.getViewportCount();for(let se=0;se<J;se++){const fe=H.getViewport(se);o.set(r.x*fe.x,r.y*fe.y,r.x*fe.z,r.y*fe.w),G.viewport(o),H.updateMatrices(U,se),i=H.getFrustum(),_(M,I,H.camera,U,this.type)}H.isPointLightShadow!==!0&&this.type===Oa&&v(H,I),H.needsUpdate=!1}A=this.type,y.needsUpdate=!1,n.setRenderTarget(S,C,D)};function v(E,M){const I=e.update(g);f.defines.VSM_SAMPLES!==E.blurSamples&&(f.defines.VSM_SAMPLES=E.blurSamples,p.defines.VSM_SAMPLES=E.blurSamples,f.needsUpdate=!0,p.needsUpdate=!0),E.mapPass===null&&(E.mapPass=new Zt(s.x,s.y)),f.uniforms.shadow_pass.value=E.map.texture,f.uniforms.resolution.value=E.mapSize,f.uniforms.radius.value=E.radius,n.setRenderTarget(E.mapPass),n.clear(),n.renderBufferDirect(M,null,I,f,g,null),p.uniforms.shadow_pass.value=E.mapPass.texture,p.uniforms.resolution.value=E.mapSize,p.uniforms.radius.value=E.radius,n.setRenderTarget(E.map),n.clear(),n.renderBufferDirect(M,null,I,p,g,null)}function b(E,M,I,S){let C=null;const D=I.isPointLight===!0?E.customDistanceMaterial:E.customDepthMaterial;if(D!==void 0)C=D;else if(C=I.isPointLight===!0?c:a,n.localClippingEnabled&&M.clipShadows===!0&&Array.isArray(M.clippingPlanes)&&M.clippingPlanes.length!==0||M.displacementMap&&M.displacementScale!==0||M.alphaMap&&M.alphaTest>0||M.map&&M.alphaTest>0){const G=C.uuid,Q=M.uuid;let L=l[G];L===void 0&&(L={},l[G]=L);let V=L[Q];V===void 0&&(V=C.clone(),L[Q]=V,M.addEventListener("dispose",T)),C=V}if(C.visible=M.visible,C.wireframe=M.wireframe,S===Oa?C.side=M.shadowSide!==null?M.shadowSide:M.side:C.side=M.shadowSide!==null?M.shadowSide:d[M.side],C.alphaMap=M.alphaMap,C.alphaTest=M.alphaTest,C.map=M.map,C.clipShadows=M.clipShadows,C.clippingPlanes=M.clippingPlanes,C.clipIntersection=M.clipIntersection,C.displacementMap=M.displacementMap,C.displacementScale=M.displacementScale,C.displacementBias=M.displacementBias,C.wireframeLinewidth=M.wireframeLinewidth,C.linewidth=M.linewidth,I.isPointLight===!0&&C.isMeshDistanceMaterial===!0){const G=n.properties.get(C);G.light=I}return C}function _(E,M,I,S,C){if(E.visible===!1)return;if(E.layers.test(M.layers)&&(E.isMesh||E.isLine||E.isPoints)&&(E.castShadow||E.receiveShadow&&C===Oa)&&(!E.frustumCulled||i.intersectsObject(E))){E.modelViewMatrix.multiplyMatrices(I.matrixWorldInverse,E.matrixWorld);const Q=e.update(E),L=E.material;if(Array.isArray(L)){const V=Q.groups;for(let O=0,U=V.length;O<U;O++){const H=V[O],Y=L[H.materialIndex];if(Y&&Y.visible){const J=b(E,Y,S,C);E.onBeforeShadow(n,E,M,I,Q,J,H),n.renderBufferDirect(I,null,Q,J,E,H),E.onAfterShadow(n,E,M,I,Q,J,H)}}}else if(L.visible){const V=b(E,L,S,C);E.onBeforeShadow(n,E,M,I,Q,V,null),n.renderBufferDirect(I,null,Q,V,E,null),E.onAfterShadow(n,E,M,I,Q,V,null)}}const G=E.children;for(let Q=0,L=G.length;Q<L;Q++)_(G[Q],M,I,S,C)}function T(E){E.target.removeEventListener("dispose",T);for(const I in l){const S=l[I],C=E.target.uuid;C in S&&(S[C].dispose(),delete S[C])}}}function m5(n,e,t){const i=t.isWebGL2;function s(){let q=!1;const He=new tt;let Ye=null;const at=new tt(0,0,0,0);return{setMask:function(xt){Ye!==xt&&!q&&(n.colorMask(xt,xt,xt,xt),Ye=xt)},setLocked:function(xt){q=xt},setClear:function(xt,Ei,vi,fi,Li){Li===!0&&(xt*=fi,Ei*=fi,vi*=fi),He.set(xt,Ei,vi,fi),at.equals(He)===!1&&(n.clearColor(xt,Ei,vi,fi),at.copy(He))},reset:function(){q=!1,Ye=null,at.set(-1,0,0,0)}}}function r(){let q=!1,He=null,Ye=null,at=null;return{setTest:function(xt){xt?Ge(n.DEPTH_TEST):Xe(n.DEPTH_TEST)},setMask:function(xt){He!==xt&&!q&&(n.depthMask(xt),He=xt)},setFunc:function(xt){if(Ye!==xt){switch(xt){case sM:n.depthFunc(n.NEVER);break;case y_:n.depthFunc(n.ALWAYS);break;case Vg:n.depthFunc(n.LESS);break;case ld:n.depthFunc(n.LEQUAL);break;case hp:n.depthFunc(n.EQUAL);break;case b_:n.depthFunc(n.GEQUAL);break;case __:n.depthFunc(n.GREATER);break;case BA:n.depthFunc(n.NOTEQUAL);break;default:n.depthFunc(n.LEQUAL)}Ye=xt}},setLocked:function(xt){q=xt},setClear:function(xt){at!==xt&&(n.clearDepth(xt),at=xt)},reset:function(){q=!1,He=null,Ye=null,at=null}}}function o(){let q=!1,He=null,Ye=null,at=null,xt=null,Ei=null,vi=null,fi=null,Li=null;return{setTest:function(ui){q||(ui?Ge(n.STENCIL_TEST):Xe(n.STENCIL_TEST))},setMask:function(ui){He!==ui&&!q&&(n.stencilMask(ui),He=ui)},setFunc:function(ui,vn,en){(Ye!==ui||at!==vn||xt!==en)&&(n.stencilFunc(ui,vn,en),Ye=ui,at=vn,xt=en)},setOp:function(ui,vn,en){(Ei!==ui||vi!==vn||fi!==en)&&(n.stencilOp(ui,vn,en),Ei=ui,vi=vn,fi=en)},setLocked:function(ui){q=ui},setClear:function(ui){Li!==ui&&(n.clearStencil(ui),Li=ui)},reset:function(){q=!1,He=null,Ye=null,at=null,xt=null,Ei=null,vi=null,fi=null,Li=null}}}const a=new s,c=new r,l=new o,h=new WeakMap,d=new WeakMap;let f={},p={},m=new WeakMap,g=[],y=null,A=!1,v=null,b=null,_=null,T=null,E=null,M=null,I=null,S=new ye(0,0,0),C=0,D=!1,G=null,Q=null,L=null,V=null,O=null;const U=n.getParameter(n.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let H=!1,Y=0;const J=n.getParameter(n.VERSION);J.indexOf("WebGL")!==-1?(Y=parseFloat(/^WebGL (\d)/.exec(J)[1]),H=Y>=1):J.indexOf("OpenGL ES")!==-1&&(Y=parseFloat(/^OpenGL ES (\d)/.exec(J)[1]),H=Y>=2);let se=null,fe={};const _e=n.getParameter(n.SCISSOR_BOX),Oe=n.getParameter(n.VIEWPORT),qe=new tt().fromArray(_e),ae=new tt().fromArray(Oe);function ve(q,He,Ye,at){const xt=new Uint8Array(4),Ei=n.createTexture();n.bindTexture(q,Ei),n.texParameteri(q,n.TEXTURE_MIN_FILTER,n.NEAREST),n.texParameteri(q,n.TEXTURE_MAG_FILTER,n.NEAREST);for(let vi=0;vi<Ye;vi++)i&&(q===n.TEXTURE_3D||q===n.TEXTURE_2D_ARRAY)?n.texImage3D(He,0,n.RGBA,1,1,at,0,n.RGBA,n.UNSIGNED_BYTE,xt):n.texImage2D(He+vi,0,n.RGBA,1,1,0,n.RGBA,n.UNSIGNED_BYTE,xt);return Ei}const Ue={};Ue[n.TEXTURE_2D]=ve(n.TEXTURE_2D,n.TEXTURE_2D,1),Ue[n.TEXTURE_CUBE_MAP]=ve(n.TEXTURE_CUBE_MAP,n.TEXTURE_CUBE_MAP_POSITIVE_X,6),i&&(Ue[n.TEXTURE_2D_ARRAY]=ve(n.TEXTURE_2D_ARRAY,n.TEXTURE_2D_ARRAY,1,1),Ue[n.TEXTURE_3D]=ve(n.TEXTURE_3D,n.TEXTURE_3D,1,1)),a.setClear(0,0,0,1),c.setClear(1),l.setClear(0),Ge(n.DEPTH_TEST),c.setFunc(ld),ct(!1),F(VC),Ge(n.CULL_FACE),be(rn);function Ge(q){f[q]!==!0&&(n.enable(q),f[q]=!0)}function Xe(q){f[q]!==!1&&(n.disable(q),f[q]=!1)}function ze(q,He){return p[q]!==He?(n.bindFramebuffer(q,He),p[q]=He,i&&(q===n.DRAW_FRAMEBUFFER&&(p[n.FRAMEBUFFER]=He),q===n.FRAMEBUFFER&&(p[n.DRAW_FRAMEBUFFER]=He)),!0):!1}function Pe(q,He){let Ye=g,at=!1;if(q)if(Ye=m.get(He),Ye===void 0&&(Ye=[],m.set(He,Ye)),q.isWebGLMultipleRenderTargets){const xt=q.texture;if(Ye.length!==xt.length||Ye[0]!==n.COLOR_ATTACHMENT0){for(let Ei=0,vi=xt.length;Ei<vi;Ei++)Ye[Ei]=n.COLOR_ATTACHMENT0+Ei;Ye.length=xt.length,at=!0}}else Ye[0]!==n.COLOR_ATTACHMENT0&&(Ye[0]=n.COLOR_ATTACHMENT0,at=!0);else Ye[0]!==n.BACK&&(Ye[0]=n.BACK,at=!0);at&&(t.isWebGL2?n.drawBuffers(Ye):e.get("WEBGL_draw_buffers").drawBuffersWEBGL(Ye))}function X(q){return y!==q?(n.useProgram(q),y=q,!0):!1}const Ae={[Ah]:n.FUNC_ADD,[dL]:n.FUNC_SUBTRACT,[fL]:n.FUNC_REVERSE_SUBTRACT};if(i)Ae[jC]=n.MIN,Ae[K0]=n.MAX;else{const q=e.get("EXT_blend_minmax");q!==null&&(Ae[jC]=q.MIN_EXT,Ae[K0]=q.MAX_EXT)}const ke={[pL]:n.ZERO,[mL]:n.ONE,[gL]:n.SRC_COLOR,[Z0]:n.SRC_ALPHA,[xL]:n.SRC_ALPHA_SATURATE,[bL]:n.DST_COLOR,[vL]:n.DST_ALPHA,[AL]:n.ONE_MINUS_SRC_COLOR,[$0]:n.ONE_MINUS_SRC_ALPHA,[_L]:n.ONE_MINUS_DST_COLOR,[yL]:n.ONE_MINUS_DST_ALPHA,[wL]:n.CONSTANT_COLOR,[SL]:n.ONE_MINUS_CONSTANT_COLOR,[CL]:n.CONSTANT_ALPHA,[EL]:n.ONE_MINUS_CONSTANT_ALPHA};function be(q,He,Ye,at,xt,Ei,vi,fi,Li,ui){if(q===rn){A===!0&&(Xe(n.BLEND),A=!1);return}if(A===!1&&(Ge(n.BLEND),A=!0),q!==nM){if(q!==v||ui!==D){if((b!==Ah||E!==Ah)&&(n.blendEquation(n.FUNC_ADD),b=Ah,E=Ah),ui)switch(q){case Th:n.blendFuncSeparate(n.ONE,n.ONE_MINUS_SRC_ALPHA,n.ONE,n.ONE_MINUS_SRC_ALPHA);break;case cd:n.blendFunc(n.ONE,n.ONE);break;case HC:n.blendFuncSeparate(n.ZERO,n.ONE_MINUS_SRC_COLOR,n.ZERO,n.ONE);break;case QC:n.blendFuncSeparate(n.ZERO,n.SRC_COLOR,n.ZERO,n.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",q);break}else switch(q){case Th:n.blendFuncSeparate(n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA,n.ONE,n.ONE_MINUS_SRC_ALPHA);break;case cd:n.blendFunc(n.SRC_ALPHA,n.ONE);break;case HC:n.blendFuncSeparate(n.ZERO,n.ONE_MINUS_SRC_COLOR,n.ZERO,n.ONE);break;case QC:n.blendFunc(n.ZERO,n.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",q);break}_=null,T=null,M=null,I=null,S.set(0,0,0),C=0,v=q,D=ui}return}xt=xt||He,Ei=Ei||Ye,vi=vi||at,(He!==b||xt!==E)&&(n.blendEquationSeparate(Ae[He],Ae[xt]),b=He,E=xt),(Ye!==_||at!==T||Ei!==M||vi!==I)&&(n.blendFuncSeparate(ke[Ye],ke[at],ke[Ei],ke[vi]),_=Ye,T=at,M=Ei,I=vi),(fi.equals(S)===!1||Li!==C)&&(n.blendColor(fi.r,fi.g,fi.b,Li),S.copy(fi),C=Li),v=q,D=!1}function je(q,He){q.side===Ai?Xe(n.CULL_FACE):Ge(n.CULL_FACE);let Ye=q.side===mn;He&&(Ye=!Ye),ct(Ye),q.blending===Th&&q.transparent===!1?be(rn):be(q.blending,q.blendEquation,q.blendSrc,q.blendDst,q.blendEquationAlpha,q.blendSrcAlpha,q.blendDstAlpha,q.blendColor,q.blendAlpha,q.premultipliedAlpha),c.setFunc(q.depthFunc),c.setTest(q.depthTest),c.setMask(q.depthWrite),a.setMask(q.colorWrite);const at=q.stencilWrite;l.setTest(at),at&&(l.setMask(q.stencilWriteMask),l.setFunc(q.stencilFunc,q.stencilRef,q.stencilFuncMask),l.setOp(q.stencilFail,q.stencilZFail,q.stencilZPass)),ce(q.polygonOffset,q.polygonOffsetFactor,q.polygonOffsetUnits),q.alphaToCoverage===!0?Ge(n.SAMPLE_ALPHA_TO_COVERAGE):Xe(n.SAMPLE_ALPHA_TO_COVERAGE)}function ct(q){G!==q&&(q?n.frontFace(n.CW):n.frontFace(n.CCW),G=q)}function F(q){q!==hL?(Ge(n.CULL_FACE),q!==Q&&(q===VC?n.cullFace(n.BACK):q===uL?n.cullFace(n.FRONT):n.cullFace(n.FRONT_AND_BACK))):Xe(n.CULL_FACE),Q=q}function B(q){q!==L&&(H&&n.lineWidth(q),L=q)}function ce(q,He,Ye){q?(Ge(n.POLYGON_OFFSET_FILL),(V!==He||O!==Ye)&&(n.polygonOffset(He,Ye),V=He,O=Ye)):Xe(n.POLYGON_OFFSET_FILL)}function Se(q){q?Ge(n.SCISSOR_TEST):Xe(n.SCISSOR_TEST)}function xe(q){q===void 0&&(q=n.TEXTURE0+U-1),se!==q&&(n.activeTexture(q),se=q)}function Ie(q,He,Ye){Ye===void 0&&(se===null?Ye=n.TEXTURE0+U-1:Ye=se);let at=fe[Ye];at===void 0&&(at={type:void 0,texture:void 0},fe[Ye]=at),(at.type!==q||at.texture!==He)&&(se!==Ye&&(n.activeTexture(Ye),se=Ye),n.bindTexture(q,He||Ue[q]),at.type=q,at.texture=He)}function et(){const q=fe[se];q!==void 0&&q.type!==void 0&&(n.bindTexture(q.type,null),q.type=void 0,q.texture=void 0)}function Fe(){try{n.compressedTexImage2D.apply(n,arguments)}catch(q){console.error("THREE.WebGLState:",q)}}function Ke(){try{n.compressedTexImage3D.apply(n,arguments)}catch(q){console.error("THREE.WebGLState:",q)}}function rt(){try{n.texSubImage2D.apply(n,arguments)}catch(q){console.error("THREE.WebGLState:",q)}}function At(){try{n.texSubImage3D.apply(n,arguments)}catch(q){console.error("THREE.WebGLState:",q)}}function Ee(){try{n.compressedTexSubImage2D.apply(n,arguments)}catch(q){console.error("THREE.WebGLState:",q)}}function Rt(){try{n.compressedTexSubImage3D.apply(n,arguments)}catch(q){console.error("THREE.WebGLState:",q)}}function dt(){try{n.texStorage2D.apply(n,arguments)}catch(q){console.error("THREE.WebGLState:",q)}}function ft(){try{n.texStorage3D.apply(n,arguments)}catch(q){console.error("THREE.WebGLState:",q)}}function Ze(){try{n.texImage2D.apply(n,arguments)}catch(q){console.error("THREE.WebGLState:",q)}}function Ve(){try{n.texImage3D.apply(n,arguments)}catch(q){console.error("THREE.WebGLState:",q)}}function pt(q){qe.equals(q)===!1&&(n.scissor(q.x,q.y,q.z,q.w),qe.copy(q))}function Pt(q){ae.equals(q)===!1&&(n.viewport(q.x,q.y,q.z,q.w),ae.copy(q))}function j(q,He){let Ye=d.get(He);Ye===void 0&&(Ye=new WeakMap,d.set(He,Ye));let at=Ye.get(q);at===void 0&&(at=n.getUniformBlockIndex(He,q.name),Ye.set(q,at))}function Ne(q,He){const at=d.get(He).get(q);h.get(He)!==at&&(n.uniformBlockBinding(He,at,q.__bindingPointIndex),h.set(He,at))}function ne(){n.disable(n.BLEND),n.disable(n.CULL_FACE),n.disable(n.DEPTH_TEST),n.disable(n.POLYGON_OFFSET_FILL),n.disable(n.SCISSOR_TEST),n.disable(n.STENCIL_TEST),n.disable(n.SAMPLE_ALPHA_TO_COVERAGE),n.blendEquation(n.FUNC_ADD),n.blendFunc(n.ONE,n.ZERO),n.blendFuncSeparate(n.ONE,n.ZERO,n.ONE,n.ZERO),n.blendColor(0,0,0,0),n.colorMask(!0,!0,!0,!0),n.clearColor(0,0,0,0),n.depthMask(!0),n.depthFunc(n.LESS),n.clearDepth(1),n.stencilMask(4294967295),n.stencilFunc(n.ALWAYS,0,4294967295),n.stencilOp(n.KEEP,n.KEEP,n.KEEP),n.clearStencil(0),n.cullFace(n.BACK),n.frontFace(n.CCW),n.polygonOffset(0,0),n.activeTexture(n.TEXTURE0),n.bindFramebuffer(n.FRAMEBUFFER,null),i===!0&&(n.bindFramebuffer(n.DRAW_FRAMEBUFFER,null),n.bindFramebuffer(n.READ_FRAMEBUFFER,null)),n.useProgram(null),n.lineWidth(1),n.scissor(0,0,n.canvas.width,n.canvas.height),n.viewport(0,0,n.canvas.width,n.canvas.height),f={},se=null,fe={},p={},m=new WeakMap,g=[],y=null,A=!1,v=null,b=null,_=null,T=null,E=null,M=null,I=null,S=new ye(0,0,0),C=0,D=!1,G=null,Q=null,L=null,V=null,O=null,qe.set(0,0,n.canvas.width,n.canvas.height),ae.set(0,0,n.canvas.width,n.canvas.height),a.reset(),c.reset(),l.reset()}return{buffers:{color:a,depth:c,stencil:l},enable:Ge,disable:Xe,bindFramebuffer:ze,drawBuffers:Pe,useProgram:X,setBlending:be,setMaterial:je,setFlipSided:ct,setCullFace:F,setLineWidth:B,setPolygonOffset:ce,setScissorTest:Se,activeTexture:xe,bindTexture:Ie,unbindTexture:et,compressedTexImage2D:Fe,compressedTexImage3D:Ke,texImage2D:Ze,texImage3D:Ve,updateUBOMapping:j,uniformBlockBinding:Ne,texStorage2D:dt,texStorage3D:ft,texSubImage2D:rt,texSubImage3D:At,compressedTexSubImage2D:Ee,compressedTexSubImage3D:Rt,scissor:pt,viewport:Pt,reset:ne}}function g5(n,e,t,i,s,r,o){const a=s.isWebGL2,c=e.has("WEBGL_multisampled_render_to_texture")?e.get("WEBGL_multisampled_render_to_texture"):null,l=typeof navigator>"u"?!1:/OculusBrowser/g.test(navigator.userAgent),h=new WeakMap;let d;const f=new WeakMap;let p=!1;try{p=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function m(F,B){return p?new OffscreenCanvas(F,B):Zg("canvas")}function g(F,B,ce,Se){let xe=1;if((F.width>Se||F.height>Se)&&(xe=Se/Math.max(F.width,F.height)),xe<1||B===!0)if(typeof HTMLImageElement<"u"&&F instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&F instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&F instanceof ImageBitmap){const Ie=B?lb:Math.floor,et=Ie(xe*F.width),Fe=Ie(xe*F.height);d===void 0&&(d=m(et,Fe));const Ke=ce?m(et,Fe):d;return Ke.width=et,Ke.height=Fe,Ke.getContext("2d").drawImage(F,0,0,et,Fe),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+F.width+"x"+F.height+") to ("+et+"x"+Fe+")."),Ke}else return"data"in F&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+F.width+"x"+F.height+")."),F;return F}function y(F){return fE(F.width)&&fE(F.height)}function A(F){return a?!1:F.wrapS!==ts||F.wrapT!==ts||F.minFilter!==Nt&&F.minFilter!==St}function v(F,B){return F.generateMipmaps&&B&&F.minFilter!==Nt&&F.minFilter!==St}function b(F){n.generateMipmap(F)}function _(F,B,ce,Se,xe=!1){if(a===!1)return B;if(F!==null){if(n[F]!==void 0)return n[F];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+F+"'")}let Ie=B;if(B===n.RED&&(ce===n.FLOAT&&(Ie=n.R32F),ce===n.HALF_FLOAT&&(Ie=n.R16F),ce===n.UNSIGNED_BYTE&&(Ie=n.R8)),B===n.RED_INTEGER&&(ce===n.UNSIGNED_BYTE&&(Ie=n.R8UI),ce===n.UNSIGNED_SHORT&&(Ie=n.R16UI),ce===n.UNSIGNED_INT&&(Ie=n.R32UI),ce===n.BYTE&&(Ie=n.R8I),ce===n.SHORT&&(Ie=n.R16I),ce===n.INT&&(Ie=n.R32I)),B===n.RG&&(ce===n.FLOAT&&(Ie=n.RG32F),ce===n.HALF_FLOAT&&(Ie=n.RG16F),ce===n.UNSIGNED_BYTE&&(Ie=n.RG8)),B===n.RGBA){const et=xe?qg:_i.getTransfer(Se);ce===n.FLOAT&&(Ie=n.RGBA32F),ce===n.HALF_FLOAT&&(Ie=n.RGBA16F),ce===n.UNSIGNED_BYTE&&(Ie=et===Ui?n.SRGB8_ALPHA8:n.RGBA8),ce===n.UNSIGNED_SHORT_4_4_4_4&&(Ie=n.RGBA4),ce===n.UNSIGNED_SHORT_5_5_5_1&&(Ie=n.RGB5_A1)}return(Ie===n.R16F||Ie===n.R32F||Ie===n.RG16F||Ie===n.RG32F||Ie===n.RGBA16F||Ie===n.RGBA32F)&&e.get("EXT_color_buffer_float"),Ie}function T(F,B,ce){return v(F,ce)===!0||F.isFramebufferTexture&&F.minFilter!==Nt&&F.minFilter!==St?Math.log2(Math.max(B.width,B.height))+1:F.mipmaps!==void 0&&F.mipmaps.length>0?F.mipmaps.length:F.isCompressedTexture&&Array.isArray(F.image)?B.mipmaps.length:1}function E(F){return F===Nt||F===dp||F===Zc?n.NEAREST:n.LINEAR}function M(F){const B=F.target;B.removeEventListener("dispose",M),S(B),B.isVideoTexture&&h.delete(B)}function I(F){const B=F.target;B.removeEventListener("dispose",I),D(B)}function S(F){const B=i.get(F);if(B.__webglInit===void 0)return;const ce=F.source,Se=f.get(ce);if(Se){const xe=Se[B.__cacheKey];xe.usedTimes--,xe.usedTimes===0&&C(F),Object.keys(Se).length===0&&f.delete(ce)}i.remove(F)}function C(F){const B=i.get(F);n.deleteTexture(B.__webglTexture);const ce=F.source,Se=f.get(ce);delete Se[B.__cacheKey],o.memory.textures--}function D(F){const B=F.texture,ce=i.get(F),Se=i.get(B);if(Se.__webglTexture!==void 0&&(n.deleteTexture(Se.__webglTexture),o.memory.textures--),F.depthTexture&&F.depthTexture.dispose(),F.isWebGLCubeRenderTarget)for(let xe=0;xe<6;xe++){if(Array.isArray(ce.__webglFramebuffer[xe]))for(let Ie=0;Ie<ce.__webglFramebuffer[xe].length;Ie++)n.deleteFramebuffer(ce.__webglFramebuffer[xe][Ie]);else n.deleteFramebuffer(ce.__webglFramebuffer[xe]);ce.__webglDepthbuffer&&n.deleteRenderbuffer(ce.__webglDepthbuffer[xe])}else{if(Array.isArray(ce.__webglFramebuffer))for(let xe=0;xe<ce.__webglFramebuffer.length;xe++)n.deleteFramebuffer(ce.__webglFramebuffer[xe]);else n.deleteFramebuffer(ce.__webglFramebuffer);if(ce.__webglDepthbuffer&&n.deleteRenderbuffer(ce.__webglDepthbuffer),ce.__webglMultisampledFramebuffer&&n.deleteFramebuffer(ce.__webglMultisampledFramebuffer),ce.__webglColorRenderbuffer)for(let xe=0;xe<ce.__webglColorRenderbuffer.length;xe++)ce.__webglColorRenderbuffer[xe]&&n.deleteRenderbuffer(ce.__webglColorRenderbuffer[xe]);ce.__webglDepthRenderbuffer&&n.deleteRenderbuffer(ce.__webglDepthRenderbuffer)}if(F.isWebGLMultipleRenderTargets)for(let xe=0,Ie=B.length;xe<Ie;xe++){const et=i.get(B[xe]);et.__webglTexture&&(n.deleteTexture(et.__webglTexture),o.memory.textures--),i.remove(B[xe])}i.remove(B),i.remove(F)}let G=0;function Q(){G=0}function L(){const F=G;return F>=s.maxTextures&&console.warn("THREE.WebGLTextures: Trying to use "+F+" texture units while this GPU supports only "+s.maxTextures),G+=1,F}function V(F){const B=[];return B.push(F.wrapS),B.push(F.wrapT),B.push(F.wrapR||0),B.push(F.magFilter),B.push(F.minFilter),B.push(F.anisotropy),B.push(F.internalFormat),B.push(F.format),B.push(F.type),B.push(F.generateMipmaps),B.push(F.premultiplyAlpha),B.push(F.flipY),B.push(F.unpackAlignment),B.push(F.colorSpace),B.join()}function O(F,B){const ce=i.get(F);if(F.isVideoTexture&&je(F),F.isRenderTargetTexture===!1&&F.version>0&&ce.__version!==F.version){const Se=F.image;if(Se===null)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else if(Se.complete===!1)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{qe(ce,F,B);return}}t.bindTexture(n.TEXTURE_2D,ce.__webglTexture,n.TEXTURE0+B)}function U(F,B){const ce=i.get(F);if(F.version>0&&ce.__version!==F.version){qe(ce,F,B);return}t.bindTexture(n.TEXTURE_2D_ARRAY,ce.__webglTexture,n.TEXTURE0+B)}function H(F,B){const ce=i.get(F);if(F.version>0&&ce.__version!==F.version){qe(ce,F,B);return}t.bindTexture(n.TEXTURE_3D,ce.__webglTexture,n.TEXTURE0+B)}function Y(F,B){const ce=i.get(F);if(F.version>0&&ce.__version!==F.version){ae(ce,F,B);return}t.bindTexture(n.TEXTURE_CUBE_MAP,ce.__webglTexture,n.TEXTURE0+B)}const J={[Lo]:n.REPEAT,[ts]:n.CLAMP_TO_EDGE,[hd]:n.MIRRORED_REPEAT},se={[Nt]:n.NEAREST,[dp]:n.NEAREST_MIPMAP_NEAREST,[Zc]:n.NEAREST_MIPMAP_LINEAR,[St]:n.LINEAR,[Wu]:n.LINEAR_MIPMAP_NEAREST,[kr]:n.LINEAR_MIPMAP_LINEAR},fe={[e2]:n.NEVER,[o2]:n.ALWAYS,[t2]:n.LESS,[gM]:n.LEQUAL,[i2]:n.EQUAL,[r2]:n.GEQUAL,[n2]:n.GREATER,[s2]:n.NOTEQUAL};function _e(F,B,ce){if(B.type===Ji&&e.has("OES_texture_float_linear")===!1&&(B.magFilter===St||B.magFilter===Wu||B.magFilter===Zc||B.magFilter===kr||B.minFilter===St||B.minFilter===Wu||B.minFilter===Zc||B.minFilter===kr)&&console.warn("THREE.WebGLRenderer: Unable to use linear filtering with floating point textures. OES_texture_float_linear not supported on this device."),ce?(n.texParameteri(F,n.TEXTURE_WRAP_S,J[B.wrapS]),n.texParameteri(F,n.TEXTURE_WRAP_T,J[B.wrapT]),(F===n.TEXTURE_3D||F===n.TEXTURE_2D_ARRAY)&&n.texParameteri(F,n.TEXTURE_WRAP_R,J[B.wrapR]),n.texParameteri(F,n.TEXTURE_MAG_FILTER,se[B.magFilter]),n.texParameteri(F,n.TEXTURE_MIN_FILTER,se[B.minFilter])):(n.texParameteri(F,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(F,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE),(F===n.TEXTURE_3D||F===n.TEXTURE_2D_ARRAY)&&n.texParameteri(F,n.TEXTURE_WRAP_R,n.CLAMP_TO_EDGE),(B.wrapS!==ts||B.wrapT!==ts)&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),n.texParameteri(F,n.TEXTURE_MAG_FILTER,E(B.magFilter)),n.texParameteri(F,n.TEXTURE_MIN_FILTER,E(B.minFilter)),B.minFilter!==Nt&&B.minFilter!==St&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),B.compareFunction&&(n.texParameteri(F,n.TEXTURE_COMPARE_MODE,n.COMPARE_REF_TO_TEXTURE),n.texParameteri(F,n.TEXTURE_COMPARE_FUNC,fe[B.compareFunction])),e.has("EXT_texture_filter_anisotropic")===!0){const Se=e.get("EXT_texture_filter_anisotropic");if(B.magFilter===Nt||B.minFilter!==Zc&&B.minFilter!==kr||B.type===Ji&&e.has("OES_texture_float_linear")===!1||a===!1&&B.type===sn&&e.has("OES_texture_half_float_linear")===!1)return;(B.anisotropy>1||i.get(B).__currentAnisotropy)&&(n.texParameterf(F,Se.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(B.anisotropy,s.getMaxAnisotropy())),i.get(B).__currentAnisotropy=B.anisotropy)}}function Oe(F,B){let ce=!1;F.__webglInit===void 0&&(F.__webglInit=!0,B.addEventListener("dispose",M));const Se=B.source;let xe=f.get(Se);xe===void 0&&(xe={},f.set(Se,xe));const Ie=V(B);if(Ie!==F.__cacheKey){xe[Ie]===void 0&&(xe[Ie]={texture:n.createTexture(),usedTimes:0},o.memory.textures++,ce=!0),xe[Ie].usedTimes++;const et=xe[F.__cacheKey];et!==void 0&&(xe[F.__cacheKey].usedTimes--,et.usedTimes===0&&C(B)),F.__cacheKey=Ie,F.__webglTexture=xe[Ie].texture}return ce}function qe(F,B,ce){let Se=n.TEXTURE_2D;(B.isDataArrayTexture||B.isCompressedArrayTexture)&&(Se=n.TEXTURE_2D_ARRAY),B.isData3DTexture&&(Se=n.TEXTURE_3D);const xe=Oe(F,B),Ie=B.source;t.bindTexture(Se,F.__webglTexture,n.TEXTURE0+ce);const et=i.get(Ie);if(Ie.version!==et.__version||xe===!0){t.activeTexture(n.TEXTURE0+ce);const Fe=_i.getPrimaries(_i.workingColorSpace),Ke=B.colorSpace===is?null:_i.getPrimaries(B.colorSpace),rt=B.colorSpace===is||Fe===Ke?n.NONE:n.BROWSER_DEFAULT_WEBGL;n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,B.flipY),n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,B.premultiplyAlpha),n.pixelStorei(n.UNPACK_ALIGNMENT,B.unpackAlignment),n.pixelStorei(n.UNPACK_COLORSPACE_CONVERSION_WEBGL,rt);const At=A(B)&&y(B.image)===!1;let Ee=g(B.image,At,!1,s.maxTextureSize);Ee=ct(B,Ee);const Rt=y(Ee)||a,dt=r.convert(B.format,B.colorSpace);let ft=r.convert(B.type),Ze=_(B.internalFormat,dt,ft,B.colorSpace,B.isVideoTexture);_e(Se,B,Rt);let Ve;const pt=B.mipmaps,Pt=a&&B.isVideoTexture!==!0&&Ze!==C_,j=et.__version===void 0||xe===!0,Ne=T(B,Ee,Rt);if(B.isDepthTexture)Ze=n.DEPTH_COMPONENT,a?B.type===Ji?Ze=n.DEPTH_COMPONENT32F:B.type===ca?Ze=n.DEPTH_COMPONENT24:B.type===ul?Ze=n.DEPTH24_STENCIL8:Ze=n.DEPTH_COMPONENT16:B.type===Ji&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),B.format===Mh&&Ze===n.DEPTH_COMPONENT&&B.type!==w_&&B.type!==ca&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),B.type=ca,ft=r.convert(B.type)),B.format===zh&&Ze===n.DEPTH_COMPONENT&&(Ze=n.DEPTH_STENCIL,B.type!==ul&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),B.type=ul,ft=r.convert(B.type))),j&&(Pt?t.texStorage2D(n.TEXTURE_2D,1,Ze,Ee.width,Ee.height):t.texImage2D(n.TEXTURE_2D,0,Ze,Ee.width,Ee.height,0,dt,ft,null));else if(B.isDataTexture)if(pt.length>0&&Rt){Pt&&j&&t.texStorage2D(n.TEXTURE_2D,Ne,Ze,pt[0].width,pt[0].height);for(let ne=0,q=pt.length;ne<q;ne++)Ve=pt[ne],Pt?t.texSubImage2D(n.TEXTURE_2D,ne,0,0,Ve.width,Ve.height,dt,ft,Ve.data):t.texImage2D(n.TEXTURE_2D,ne,Ze,Ve.width,Ve.height,0,dt,ft,Ve.data);B.generateMipmaps=!1}else Pt?(j&&t.texStorage2D(n.TEXTURE_2D,Ne,Ze,Ee.width,Ee.height),t.texSubImage2D(n.TEXTURE_2D,0,0,0,Ee.width,Ee.height,dt,ft,Ee.data)):t.texImage2D(n.TEXTURE_2D,0,Ze,Ee.width,Ee.height,0,dt,ft,Ee.data);else if(B.isCompressedTexture)if(B.isCompressedArrayTexture){Pt&&j&&t.texStorage3D(n.TEXTURE_2D_ARRAY,Ne,Ze,pt[0].width,pt[0].height,Ee.depth);for(let ne=0,q=pt.length;ne<q;ne++)Ve=pt[ne],B.format!==xi?dt!==null?Pt?t.compressedTexSubImage3D(n.TEXTURE_2D_ARRAY,ne,0,0,0,Ve.width,Ve.height,Ee.depth,dt,Ve.data,0,0):t.compressedTexImage3D(n.TEXTURE_2D_ARRAY,ne,Ze,Ve.width,Ve.height,Ee.depth,0,Ve.data,0,0):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):Pt?t.texSubImage3D(n.TEXTURE_2D_ARRAY,ne,0,0,0,Ve.width,Ve.height,Ee.depth,dt,ft,Ve.data):t.texImage3D(n.TEXTURE_2D_ARRAY,ne,Ze,Ve.width,Ve.height,Ee.depth,0,dt,ft,Ve.data)}else{Pt&&j&&t.texStorage2D(n.TEXTURE_2D,Ne,Ze,pt[0].width,pt[0].height);for(let ne=0,q=pt.length;ne<q;ne++)Ve=pt[ne],B.format!==xi?dt!==null?Pt?t.compressedTexSubImage2D(n.TEXTURE_2D,ne,0,0,Ve.width,Ve.height,dt,Ve.data):t.compressedTexImage2D(n.TEXTURE_2D,ne,Ze,Ve.width,Ve.height,0,Ve.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):Pt?t.texSubImage2D(n.TEXTURE_2D,ne,0,0,Ve.width,Ve.height,dt,ft,Ve.data):t.texImage2D(n.TEXTURE_2D,ne,Ze,Ve.width,Ve.height,0,dt,ft,Ve.data)}else if(B.isDataArrayTexture)Pt?(j&&t.texStorage3D(n.TEXTURE_2D_ARRAY,Ne,Ze,Ee.width,Ee.height,Ee.depth),t.texSubImage3D(n.TEXTURE_2D_ARRAY,0,0,0,0,Ee.width,Ee.height,Ee.depth,dt,ft,Ee.data)):t.texImage3D(n.TEXTURE_2D_ARRAY,0,Ze,Ee.width,Ee.height,Ee.depth,0,dt,ft,Ee.data);else if(B.isData3DTexture)Pt?(j&&t.texStorage3D(n.TEXTURE_3D,Ne,Ze,Ee.width,Ee.height,Ee.depth),t.texSubImage3D(n.TEXTURE_3D,0,0,0,0,Ee.width,Ee.height,Ee.depth,dt,ft,Ee.data)):t.texImage3D(n.TEXTURE_3D,0,Ze,Ee.width,Ee.height,Ee.depth,0,dt,ft,Ee.data);else if(B.isFramebufferTexture){if(j)if(Pt)t.texStorage2D(n.TEXTURE_2D,Ne,Ze,Ee.width,Ee.height);else{let ne=Ee.width,q=Ee.height;for(let He=0;He<Ne;He++)t.texImage2D(n.TEXTURE_2D,He,Ze,ne,q,0,dt,ft,null),ne>>=1,q>>=1}}else if(pt.length>0&&Rt){Pt&&j&&t.texStorage2D(n.TEXTURE_2D,Ne,Ze,pt[0].width,pt[0].height);for(let ne=0,q=pt.length;ne<q;ne++)Ve=pt[ne],Pt?t.texSubImage2D(n.TEXTURE_2D,ne,0,0,dt,ft,Ve):t.texImage2D(n.TEXTURE_2D,ne,Ze,dt,ft,Ve);B.generateMipmaps=!1}else Pt?(j&&t.texStorage2D(n.TEXTURE_2D,Ne,Ze,Ee.width,Ee.height),t.texSubImage2D(n.TEXTURE_2D,0,0,0,dt,ft,Ee)):t.texImage2D(n.TEXTURE_2D,0,Ze,dt,ft,Ee);v(B,Rt)&&b(Se),et.__version=Ie.version,B.onUpdate&&B.onUpdate(B)}F.__version=B.version}function ae(F,B,ce){if(B.image.length!==6)return;const Se=Oe(F,B),xe=B.source;t.bindTexture(n.TEXTURE_CUBE_MAP,F.__webglTexture,n.TEXTURE0+ce);const Ie=i.get(xe);if(xe.version!==Ie.__version||Se===!0){t.activeTexture(n.TEXTURE0+ce);const et=_i.getPrimaries(_i.workingColorSpace),Fe=B.colorSpace===is?null:_i.getPrimaries(B.colorSpace),Ke=B.colorSpace===is||et===Fe?n.NONE:n.BROWSER_DEFAULT_WEBGL;n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,B.flipY),n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,B.premultiplyAlpha),n.pixelStorei(n.UNPACK_ALIGNMENT,B.unpackAlignment),n.pixelStorei(n.UNPACK_COLORSPACE_CONVERSION_WEBGL,Ke);const rt=B.isCompressedTexture||B.image[0].isCompressedTexture,At=B.image[0]&&B.image[0].isDataTexture,Ee=[];for(let ne=0;ne<6;ne++)!rt&&!At?Ee[ne]=g(B.image[ne],!1,!0,s.maxCubemapSize):Ee[ne]=At?B.image[ne].image:B.image[ne],Ee[ne]=ct(B,Ee[ne]);const Rt=Ee[0],dt=y(Rt)||a,ft=r.convert(B.format,B.colorSpace),Ze=r.convert(B.type),Ve=_(B.internalFormat,ft,Ze,B.colorSpace),pt=a&&B.isVideoTexture!==!0,Pt=Ie.__version===void 0||Se===!0;let j=T(B,Rt,dt);_e(n.TEXTURE_CUBE_MAP,B,dt);let Ne;if(rt){pt&&Pt&&t.texStorage2D(n.TEXTURE_CUBE_MAP,j,Ve,Rt.width,Rt.height);for(let ne=0;ne<6;ne++){Ne=Ee[ne].mipmaps;for(let q=0;q<Ne.length;q++){const He=Ne[q];B.format!==xi?ft!==null?pt?t.compressedTexSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+ne,q,0,0,He.width,He.height,ft,He.data):t.compressedTexImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+ne,q,Ve,He.width,He.height,0,He.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):pt?t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+ne,q,0,0,He.width,He.height,ft,Ze,He.data):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+ne,q,Ve,He.width,He.height,0,ft,Ze,He.data)}}}else{Ne=B.mipmaps,pt&&Pt&&(Ne.length>0&&j++,t.texStorage2D(n.TEXTURE_CUBE_MAP,j,Ve,Ee[0].width,Ee[0].height));for(let ne=0;ne<6;ne++)if(At){pt?t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+ne,0,0,0,Ee[ne].width,Ee[ne].height,ft,Ze,Ee[ne].data):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+ne,0,Ve,Ee[ne].width,Ee[ne].height,0,ft,Ze,Ee[ne].data);for(let q=0;q<Ne.length;q++){const Ye=Ne[q].image[ne].image;pt?t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+ne,q+1,0,0,Ye.width,Ye.height,ft,Ze,Ye.data):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+ne,q+1,Ve,Ye.width,Ye.height,0,ft,Ze,Ye.data)}}else{pt?t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+ne,0,0,0,ft,Ze,Ee[ne]):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+ne,0,Ve,ft,Ze,Ee[ne]);for(let q=0;q<Ne.length;q++){const He=Ne[q];pt?t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+ne,q+1,0,0,ft,Ze,He.image[ne]):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+ne,q+1,Ve,ft,Ze,He.image[ne])}}}v(B,dt)&&b(n.TEXTURE_CUBE_MAP),Ie.__version=xe.version,B.onUpdate&&B.onUpdate(B)}F.__version=B.version}function ve(F,B,ce,Se,xe,Ie){const et=r.convert(ce.format,ce.colorSpace),Fe=r.convert(ce.type),Ke=_(ce.internalFormat,et,Fe,ce.colorSpace);if(!i.get(B).__hasExternalTextures){const At=Math.max(1,B.width>>Ie),Ee=Math.max(1,B.height>>Ie);xe===n.TEXTURE_3D||xe===n.TEXTURE_2D_ARRAY?t.texImage3D(xe,Ie,Ke,At,Ee,B.depth,0,et,Fe,null):t.texImage2D(xe,Ie,Ke,At,Ee,0,et,Fe,null)}t.bindFramebuffer(n.FRAMEBUFFER,F),be(B)?c.framebufferTexture2DMultisampleEXT(n.FRAMEBUFFER,Se,xe,i.get(ce).__webglTexture,0,ke(B)):(xe===n.TEXTURE_2D||xe>=n.TEXTURE_CUBE_MAP_POSITIVE_X&&xe<=n.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&n.framebufferTexture2D(n.FRAMEBUFFER,Se,xe,i.get(ce).__webglTexture,Ie),t.bindFramebuffer(n.FRAMEBUFFER,null)}function Ue(F,B,ce){if(n.bindRenderbuffer(n.RENDERBUFFER,F),B.depthBuffer&&!B.stencilBuffer){let Se=a===!0?n.DEPTH_COMPONENT24:n.DEPTH_COMPONENT16;if(ce||be(B)){const xe=B.depthTexture;xe&&xe.isDepthTexture&&(xe.type===Ji?Se=n.DEPTH_COMPONENT32F:xe.type===ca&&(Se=n.DEPTH_COMPONENT24));const Ie=ke(B);be(B)?c.renderbufferStorageMultisampleEXT(n.RENDERBUFFER,Ie,Se,B.width,B.height):n.renderbufferStorageMultisample(n.RENDERBUFFER,Ie,Se,B.width,B.height)}else n.renderbufferStorage(n.RENDERBUFFER,Se,B.width,B.height);n.framebufferRenderbuffer(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.RENDERBUFFER,F)}else if(B.depthBuffer&&B.stencilBuffer){const Se=ke(B);ce&&be(B)===!1?n.renderbufferStorageMultisample(n.RENDERBUFFER,Se,n.DEPTH24_STENCIL8,B.width,B.height):be(B)?c.renderbufferStorageMultisampleEXT(n.RENDERBUFFER,Se,n.DEPTH24_STENCIL8,B.width,B.height):n.renderbufferStorage(n.RENDERBUFFER,n.DEPTH_STENCIL,B.width,B.height),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.DEPTH_STENCIL_ATTACHMENT,n.RENDERBUFFER,F)}else{const Se=B.isWebGLMultipleRenderTargets===!0?B.texture:[B.texture];for(let xe=0;xe<Se.length;xe++){const Ie=Se[xe],et=r.convert(Ie.format,Ie.colorSpace),Fe=r.convert(Ie.type),Ke=_(Ie.internalFormat,et,Fe,Ie.colorSpace),rt=ke(B);ce&&be(B)===!1?n.renderbufferStorageMultisample(n.RENDERBUFFER,rt,Ke,B.width,B.height):be(B)?c.renderbufferStorageMultisampleEXT(n.RENDERBUFFER,rt,Ke,B.width,B.height):n.renderbufferStorage(n.RENDERBUFFER,Ke,B.width,B.height)}}n.bindRenderbuffer(n.RENDERBUFFER,null)}function Ge(F,B){if(B&&B.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(t.bindFramebuffer(n.FRAMEBUFFER,F),!(B.depthTexture&&B.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");(!i.get(B.depthTexture).__webglTexture||B.depthTexture.image.width!==B.width||B.depthTexture.image.height!==B.height)&&(B.depthTexture.image.width=B.width,B.depthTexture.image.height=B.height,B.depthTexture.needsUpdate=!0),O(B.depthTexture,0);const Se=i.get(B.depthTexture).__webglTexture,xe=ke(B);if(B.depthTexture.format===Mh)be(B)?c.framebufferTexture2DMultisampleEXT(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.TEXTURE_2D,Se,0,xe):n.framebufferTexture2D(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.TEXTURE_2D,Se,0);else if(B.depthTexture.format===zh)be(B)?c.framebufferTexture2DMultisampleEXT(n.FRAMEBUFFER,n.DEPTH_STENCIL_ATTACHMENT,n.TEXTURE_2D,Se,0,xe):n.framebufferTexture2D(n.FRAMEBUFFER,n.DEPTH_STENCIL_ATTACHMENT,n.TEXTURE_2D,Se,0);else throw new Error("Unknown depthTexture format")}function Xe(F){const B=i.get(F),ce=F.isWebGLCubeRenderTarget===!0;if(F.depthTexture&&!B.__autoAllocateDepthBuffer){if(ce)throw new Error("target.depthTexture not supported in Cube render targets");Ge(B.__webglFramebuffer,F)}else if(ce){B.__webglDepthbuffer=[];for(let Se=0;Se<6;Se++)t.bindFramebuffer(n.FRAMEBUFFER,B.__webglFramebuffer[Se]),B.__webglDepthbuffer[Se]=n.createRenderbuffer(),Ue(B.__webglDepthbuffer[Se],F,!1)}else t.bindFramebuffer(n.FRAMEBUFFER,B.__webglFramebuffer),B.__webglDepthbuffer=n.createRenderbuffer(),Ue(B.__webglDepthbuffer,F,!1);t.bindFramebuffer(n.FRAMEBUFFER,null)}function ze(F,B,ce){const Se=i.get(F);B!==void 0&&ve(Se.__webglFramebuffer,F,F.texture,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,0),ce!==void 0&&Xe(F)}function Pe(F){const B=F.texture,ce=i.get(F),Se=i.get(B);F.addEventListener("dispose",I),F.isWebGLMultipleRenderTargets!==!0&&(Se.__webglTexture===void 0&&(Se.__webglTexture=n.createTexture()),Se.__version=B.version,o.memory.textures++);const xe=F.isWebGLCubeRenderTarget===!0,Ie=F.isWebGLMultipleRenderTargets===!0,et=y(F)||a;if(xe){ce.__webglFramebuffer=[];for(let Fe=0;Fe<6;Fe++)if(a&&B.mipmaps&&B.mipmaps.length>0){ce.__webglFramebuffer[Fe]=[];for(let Ke=0;Ke<B.mipmaps.length;Ke++)ce.__webglFramebuffer[Fe][Ke]=n.createFramebuffer()}else ce.__webglFramebuffer[Fe]=n.createFramebuffer()}else{if(a&&B.mipmaps&&B.mipmaps.length>0){ce.__webglFramebuffer=[];for(let Fe=0;Fe<B.mipmaps.length;Fe++)ce.__webglFramebuffer[Fe]=n.createFramebuffer()}else ce.__webglFramebuffer=n.createFramebuffer();if(Ie)if(s.drawBuffers){const Fe=F.texture;for(let Ke=0,rt=Fe.length;Ke<rt;Ke++){const At=i.get(Fe[Ke]);At.__webglTexture===void 0&&(At.__webglTexture=n.createTexture(),o.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");if(a&&F.samples>0&&be(F)===!1){const Fe=Ie?B:[B];ce.__webglMultisampledFramebuffer=n.createFramebuffer(),ce.__webglColorRenderbuffer=[],t.bindFramebuffer(n.FRAMEBUFFER,ce.__webglMultisampledFramebuffer);for(let Ke=0;Ke<Fe.length;Ke++){const rt=Fe[Ke];ce.__webglColorRenderbuffer[Ke]=n.createRenderbuffer(),n.bindRenderbuffer(n.RENDERBUFFER,ce.__webglColorRenderbuffer[Ke]);const At=r.convert(rt.format,rt.colorSpace),Ee=r.convert(rt.type),Rt=_(rt.internalFormat,At,Ee,rt.colorSpace,F.isXRRenderTarget===!0),dt=ke(F);n.renderbufferStorageMultisample(n.RENDERBUFFER,dt,Rt,F.width,F.height),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0+Ke,n.RENDERBUFFER,ce.__webglColorRenderbuffer[Ke])}n.bindRenderbuffer(n.RENDERBUFFER,null),F.depthBuffer&&(ce.__webglDepthRenderbuffer=n.createRenderbuffer(),Ue(ce.__webglDepthRenderbuffer,F,!0)),t.bindFramebuffer(n.FRAMEBUFFER,null)}}if(xe){t.bindTexture(n.TEXTURE_CUBE_MAP,Se.__webglTexture),_e(n.TEXTURE_CUBE_MAP,B,et);for(let Fe=0;Fe<6;Fe++)if(a&&B.mipmaps&&B.mipmaps.length>0)for(let Ke=0;Ke<B.mipmaps.length;Ke++)ve(ce.__webglFramebuffer[Fe][Ke],F,B,n.COLOR_ATTACHMENT0,n.TEXTURE_CUBE_MAP_POSITIVE_X+Fe,Ke);else ve(ce.__webglFramebuffer[Fe],F,B,n.COLOR_ATTACHMENT0,n.TEXTURE_CUBE_MAP_POSITIVE_X+Fe,0);v(B,et)&&b(n.TEXTURE_CUBE_MAP),t.unbindTexture()}else if(Ie){const Fe=F.texture;for(let Ke=0,rt=Fe.length;Ke<rt;Ke++){const At=Fe[Ke],Ee=i.get(At);t.bindTexture(n.TEXTURE_2D,Ee.__webglTexture),_e(n.TEXTURE_2D,At,et),ve(ce.__webglFramebuffer,F,At,n.COLOR_ATTACHMENT0+Ke,n.TEXTURE_2D,0),v(At,et)&&b(n.TEXTURE_2D)}t.unbindTexture()}else{let Fe=n.TEXTURE_2D;if((F.isWebGL3DRenderTarget||F.isWebGLArrayRenderTarget)&&(a?Fe=F.isWebGL3DRenderTarget?n.TEXTURE_3D:n.TEXTURE_2D_ARRAY:console.error("THREE.WebGLTextures: THREE.Data3DTexture and THREE.DataArrayTexture only supported with WebGL2.")),t.bindTexture(Fe,Se.__webglTexture),_e(Fe,B,et),a&&B.mipmaps&&B.mipmaps.length>0)for(let Ke=0;Ke<B.mipmaps.length;Ke++)ve(ce.__webglFramebuffer[Ke],F,B,n.COLOR_ATTACHMENT0,Fe,Ke);else ve(ce.__webglFramebuffer,F,B,n.COLOR_ATTACHMENT0,Fe,0);v(B,et)&&b(Fe),t.unbindTexture()}F.depthBuffer&&Xe(F)}function X(F){const B=y(F)||a,ce=F.isWebGLMultipleRenderTargets===!0?F.texture:[F.texture];for(let Se=0,xe=ce.length;Se<xe;Se++){const Ie=ce[Se];if(v(Ie,B)){const et=F.isWebGLCubeRenderTarget?n.TEXTURE_CUBE_MAP:n.TEXTURE_2D,Fe=i.get(Ie).__webglTexture;t.bindTexture(et,Fe),b(et),t.unbindTexture()}}}function Ae(F){if(a&&F.samples>0&&be(F)===!1){const B=F.isWebGLMultipleRenderTargets?F.texture:[F.texture],ce=F.width,Se=F.height;let xe=n.COLOR_BUFFER_BIT;const Ie=[],et=F.stencilBuffer?n.DEPTH_STENCIL_ATTACHMENT:n.DEPTH_ATTACHMENT,Fe=i.get(F),Ke=F.isWebGLMultipleRenderTargets===!0;if(Ke)for(let rt=0;rt<B.length;rt++)t.bindFramebuffer(n.FRAMEBUFFER,Fe.__webglMultisampledFramebuffer),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0+rt,n.RENDERBUFFER,null),t.bindFramebuffer(n.FRAMEBUFFER,Fe.__webglFramebuffer),n.framebufferTexture2D(n.DRAW_FRAMEBUFFER,n.COLOR_ATTACHMENT0+rt,n.TEXTURE_2D,null,0);t.bindFramebuffer(n.READ_FRAMEBUFFER,Fe.__webglMultisampledFramebuffer),t.bindFramebuffer(n.DRAW_FRAMEBUFFER,Fe.__webglFramebuffer);for(let rt=0;rt<B.length;rt++){Ie.push(n.COLOR_ATTACHMENT0+rt),F.depthBuffer&&Ie.push(et);const At=Fe.__ignoreDepthValues!==void 0?Fe.__ignoreDepthValues:!1;if(At===!1&&(F.depthBuffer&&(xe|=n.DEPTH_BUFFER_BIT),F.stencilBuffer&&(xe|=n.STENCIL_BUFFER_BIT)),Ke&&n.framebufferRenderbuffer(n.READ_FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.RENDERBUFFER,Fe.__webglColorRenderbuffer[rt]),At===!0&&(n.invalidateFramebuffer(n.READ_FRAMEBUFFER,[et]),n.invalidateFramebuffer(n.DRAW_FRAMEBUFFER,[et])),Ke){const Ee=i.get(B[rt]).__webglTexture;n.framebufferTexture2D(n.DRAW_FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,Ee,0)}n.blitFramebuffer(0,0,ce,Se,0,0,ce,Se,xe,n.NEAREST),l&&n.invalidateFramebuffer(n.READ_FRAMEBUFFER,Ie)}if(t.bindFramebuffer(n.READ_FRAMEBUFFER,null),t.bindFramebuffer(n.DRAW_FRAMEBUFFER,null),Ke)for(let rt=0;rt<B.length;rt++){t.bindFramebuffer(n.FRAMEBUFFER,Fe.__webglMultisampledFramebuffer),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0+rt,n.RENDERBUFFER,Fe.__webglColorRenderbuffer[rt]);const At=i.get(B[rt]).__webglTexture;t.bindFramebuffer(n.FRAMEBUFFER,Fe.__webglFramebuffer),n.framebufferTexture2D(n.DRAW_FRAMEBUFFER,n.COLOR_ATTACHMENT0+rt,n.TEXTURE_2D,At,0)}t.bindFramebuffer(n.DRAW_FRAMEBUFFER,Fe.__webglMultisampledFramebuffer)}}function ke(F){return Math.min(s.maxSamples,F.samples)}function be(F){const B=i.get(F);return a&&F.samples>0&&e.has("WEBGL_multisampled_render_to_texture")===!0&&B.__useRenderToTexture!==!1}function je(F){const B=o.render.frame;h.get(F)!==B&&(h.set(F,B),F.update())}function ct(F,B){const ce=F.colorSpace,Se=F.format,xe=F.type;return F.isCompressedTexture===!0||F.isVideoTexture===!0||F.format===cb||ce!==Ri&&ce!==is&&(_i.getTransfer(ce)===Ui?a===!1?e.has("EXT_sRGB")===!0&&Se===xi?(F.format=cb,F.minFilter=St,F.generateMipmaps=!1):B=vM.sRGBToLinear(B):(Se!==xi||xe!==gi)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture color space:",ce)),B}this.allocateTextureUnit=L,this.resetTextureUnits=Q,this.setTexture2D=O,this.setTexture2DArray=U,this.setTexture3D=H,this.setTextureCube=Y,this.rebindTextures=ze,this.setupRenderTarget=Pe,this.updateRenderTargetMipmap=X,this.updateMultisampleRenderTarget=Ae,this.setupDepthRenderbuffer=Xe,this.setupFrameBufferTexture=ve,this.useMultisampledRTT=be}function y2(n,e,t){const i=t.isWebGL2;function s(r,o=is){let a;const c=_i.getTransfer(o);if(r===gi)return n.UNSIGNED_BYTE;if(r===cM)return n.UNSIGNED_SHORT_4_4_4_4;if(r===lM)return n.UNSIGNED_SHORT_5_5_5_1;if(r===DL)return n.BYTE;if(r===OL)return n.SHORT;if(r===w_)return n.UNSIGNED_SHORT;if(r===aM)return n.INT;if(r===ca)return n.UNSIGNED_INT;if(r===Ji)return n.FLOAT;if(r===sn)return i?n.HALF_FLOAT:(a=e.get("OES_texture_half_float"),a!==null?a.HALF_FLOAT_OES:null);if(r===kL)return n.ALPHA;if(r===xi)return n.RGBA;if(r===S_)return n.LUMINANCE;if(r===LL)return n.LUMINANCE_ALPHA;if(r===Mh)return n.DEPTH_COMPONENT;if(r===zh)return n.DEPTH_STENCIL;if(r===cb)return a=e.get("EXT_sRGB"),a!==null?a.SRGB_ALPHA_EXT:null;if(r===tc)return n.RED;if(r===hM)return n.RED_INTEGER;if(r===Sh)return n.RG;if(r===uM)return n.RG_INTEGER;if(r===dM)return n.RGBA_INTEGER;if(r===eg||r===y0||r===b0||r===tg)if(c===Ui)if(a=e.get("WEBGL_compressed_texture_s3tc_srgb"),a!==null){if(r===eg)return a.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(r===y0)return a.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(r===b0)return a.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(r===tg)return a.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(a=e.get("WEBGL_compressed_texture_s3tc"),a!==null){if(r===eg)return a.COMPRESSED_RGB_S3TC_DXT1_EXT;if(r===y0)return a.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(r===b0)return a.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(r===tg)return a.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(r===eb||r===qC||r===tb||r===XC)if(a=e.get("WEBGL_compressed_texture_pvrtc"),a!==null){if(r===eb)return a.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(r===qC)return a.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(r===tb)return a.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(r===XC)return a.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(r===C_)return a=e.get("WEBGL_compressed_texture_etc1"),a!==null?a.COMPRESSED_RGB_ETC1_WEBGL:null;if(r===ib||r===nb)if(a=e.get("WEBGL_compressed_texture_etc"),a!==null){if(r===ib)return c===Ui?a.COMPRESSED_SRGB8_ETC2:a.COMPRESSED_RGB8_ETC2;if(r===nb)return c===Ui?a.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:a.COMPRESSED_RGBA8_ETC2_EAC}else return null;if(r===sb||r===YC||r===JC||r===KC||r===Qg||r===ZC||r===$C||r===eE||r===tE||r===iE||r===nE||r===sE||r===rE||r===oE)if(a=e.get("WEBGL_compressed_texture_astc"),a!==null){if(r===sb)return c===Ui?a.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:a.COMPRESSED_RGBA_ASTC_4x4_KHR;if(r===YC)return c===Ui?a.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:a.COMPRESSED_RGBA_ASTC_5x4_KHR;if(r===JC)return c===Ui?a.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:a.COMPRESSED_RGBA_ASTC_5x5_KHR;if(r===KC)return c===Ui?a.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:a.COMPRESSED_RGBA_ASTC_6x5_KHR;if(r===Qg)return c===Ui?a.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:a.COMPRESSED_RGBA_ASTC_6x6_KHR;if(r===ZC)return c===Ui?a.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:a.COMPRESSED_RGBA_ASTC_8x5_KHR;if(r===$C)return c===Ui?a.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:a.COMPRESSED_RGBA_ASTC_8x6_KHR;if(r===eE)return c===Ui?a.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:a.COMPRESSED_RGBA_ASTC_8x8_KHR;if(r===tE)return c===Ui?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:a.COMPRESSED_RGBA_ASTC_10x5_KHR;if(r===iE)return c===Ui?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:a.COMPRESSED_RGBA_ASTC_10x6_KHR;if(r===nE)return c===Ui?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:a.COMPRESSED_RGBA_ASTC_10x8_KHR;if(r===sE)return c===Ui?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:a.COMPRESSED_RGBA_ASTC_10x10_KHR;if(r===rE)return c===Ui?a.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:a.COMPRESSED_RGBA_ASTC_12x10_KHR;if(r===oE)return c===Ui?a.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:a.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(r===ig||r===aE||r===cE)if(a=e.get("EXT_texture_compression_bptc"),a!==null){if(r===ig)return c===Ui?a.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:a.COMPRESSED_RGBA_BPTC_UNORM_EXT;if(r===aE)return a.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT;if(r===cE)return a.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT}else return null;if(r===FL||r===lE||r===hE||r===uE)if(a=e.get("EXT_texture_compression_rgtc"),a!==null){if(r===ig)return a.COMPRESSED_RED_RGTC1_EXT;if(r===lE)return a.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(r===hE)return a.COMPRESSED_RED_GREEN_RGTC2_EXT;if(r===uE)return a.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}else return null;return r===ul?i?n.UNSIGNED_INT_24_8:(a=e.get("WEBGL_depth_texture"),a!==null?a.UNSIGNED_INT_24_8_WEBGL:null):n[r]!==void 0?n[r]:null}return{convert:s}}class b2 extends Wt{constructor(e=[]){super(),this.isArrayCamera=!0,this.cameras=e}}class fr extends ge{constructor(){super(),this.isGroup=!0,this.type="Group"}}const A5={type:"move"};class qw{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new fr,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new fr,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new w,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new w),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new fr,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new w,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new w),this._grip}dispatchEvent(e){return this._targetRay!==null&&this._targetRay.dispatchEvent(e),this._grip!==null&&this._grip.dispatchEvent(e),this._hand!==null&&this._hand.dispatchEvent(e),this}connect(e){if(e&&e.hand){const t=this._hand;if(t)for(const i of e.hand.values())this._getHandJoint(t,i)}return this.dispatchEvent({type:"connected",data:e}),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(e,t,i){let s=null,r=null,o=null;const a=this._targetRay,c=this._grip,l=this._hand;if(e&&t.session.visibilityState!=="visible-blurred"){if(l&&e.hand){o=!0;for(const g of e.hand.values()){const y=t.getJointPose(g,i),A=this._getHandJoint(l,g);y!==null&&(A.matrix.fromArray(y.transform.matrix),A.matrix.decompose(A.position,A.rotation,A.scale),A.matrixWorldNeedsUpdate=!0,A.jointRadius=y.radius),A.visible=y!==null}const h=l.joints["index-finger-tip"],d=l.joints["thumb-tip"],f=h.position.distanceTo(d.position),p=.02,m=.005;l.inputState.pinching&&f>p+m?(l.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!l.inputState.pinching&&f<=p-m&&(l.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else c!==null&&e.gripSpace&&(r=t.getPose(e.gripSpace,i),r!==null&&(c.matrix.fromArray(r.transform.matrix),c.matrix.decompose(c.position,c.rotation,c.scale),c.matrixWorldNeedsUpdate=!0,r.linearVelocity?(c.hasLinearVelocity=!0,c.linearVelocity.copy(r.linearVelocity)):c.hasLinearVelocity=!1,r.angularVelocity?(c.hasAngularVelocity=!0,c.angularVelocity.copy(r.angularVelocity)):c.hasAngularVelocity=!1));a!==null&&(s=t.getPose(e.targetRaySpace,i),s===null&&r!==null&&(s=r),s!==null&&(a.matrix.fromArray(s.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale),a.matrixWorldNeedsUpdate=!0,s.linearVelocity?(a.hasLinearVelocity=!0,a.linearVelocity.copy(s.linearVelocity)):a.hasLinearVelocity=!1,s.angularVelocity?(a.hasAngularVelocity=!0,a.angularVelocity.copy(s.angularVelocity)):a.hasAngularVelocity=!1,this.dispatchEvent(A5)))}return a!==null&&(a.visible=s!==null),c!==null&&(c.visible=r!==null),l!==null&&(l.visible=o!==null),this}_getHandJoint(e,t){if(e.joints[t.jointName]===void 0){const i=new fr;i.matrixAutoUpdate=!1,i.visible=!1,e.joints[t.jointName]=i,e.add(i)}return e.joints[t.jointName]}}class v5 extends ls{constructor(e,t){super();const i=this;let s=null,r=1,o=null,a="local-floor",c=1,l=null,h=null,d=null,f=null,p=null,m=null,g=0,y=0,A=null;const v=t.getContextAttributes();let b=null,_=null;const T=[],E=[],M=new ie;let I=null;const S=new Wt;S.layers.enable(1),S.viewport=new tt;const C=new Wt;C.layers.enable(2),C.viewport=new tt;const D=[S,C],G=new b2;G.layers.enable(1),G.layers.enable(2);let Q=null,L=null;this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(ae){let ve=T[ae];return ve===void 0&&(ve=new qw,T[ae]=ve),ve.getTargetRaySpace()},this.getControllerGrip=function(ae){let ve=T[ae];return ve===void 0&&(ve=new qw,T[ae]=ve),ve.getGripSpace()},this.getHand=function(ae){let ve=T[ae];return ve===void 0&&(ve=new qw,T[ae]=ve),ve.getHandSpace()};function V(ae){const ve=E.indexOf(ae.inputSource);if(ve===-1)return;const Ue=T[ve];Ue!==void 0&&(Ue.update(ae.inputSource,ae.frame,l||o),Ue.dispatchEvent({type:ae.type,data:ae.inputSource}))}function O(){s.removeEventListener("select",V),s.removeEventListener("selectstart",V),s.removeEventListener("selectend",V),s.removeEventListener("squeeze",V),s.removeEventListener("squeezestart",V),s.removeEventListener("squeezeend",V),s.removeEventListener("end",O),s.removeEventListener("inputsourceschange",U);for(let ae=0;ae<T.length;ae++){const ve=E[ae];ve!==null&&(E[ae]=null,T[ae].disconnect(ve))}Q=null,L=null,m=null,e.setRenderTarget(b),e.clearOcclusion(),p=null,f=null,d=null,s=null,_=null,qe.stop(),i.isPresenting=!1,e.setPixelRatio(I),e.setSize(M.width,M.height,!1),i.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function(ae){r=ae,i.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(ae){a=ae,i.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return l||o},this.setReferenceSpace=function(ae){l=ae},this.getBaseLayer=function(){return f!==null?f:p},this.getBinding=function(){return d},this.getFrame=function(){return A},this.getSession=function(){return s},this.setSession=async function(ae){if(s=ae,s!==null){if(b=e.getRenderTarget(),s.addEventListener("select",V),s.addEventListener("selectstart",V),s.addEventListener("selectend",V),s.addEventListener("squeeze",V),s.addEventListener("squeezestart",V),s.addEventListener("squeezeend",V),s.addEventListener("end",O),s.addEventListener("inputsourceschange",U),v.xrCompatible!==!0&&await t.makeXRCompatible(),I=e.getPixelRatio(),e.getSize(M),s.renderState.layers===void 0||e.capabilities.isWebGL2===!1){const ve={antialias:s.renderState.layers===void 0?v.antialias:!0,alpha:!0,depth:v.depth,stencil:v.stencil,framebufferScaleFactor:r};p=new XRWebGLLayer(s,t,ve),s.updateRenderState({baseLayer:p}),e.setPixelRatio(1),e.setSize(p.framebufferWidth,p.framebufferHeight,!1),_=new Zt(p.framebufferWidth,p.framebufferHeight,{format:xi,type:gi,colorSpace:e.outputColorSpace,stencilBuffer:v.stencil})}else{let ve=null,Ue=null,Ge=null;v.depth&&(Ge=v.stencil?t.DEPTH24_STENCIL8:t.DEPTH_COMPONENT24,ve=v.stencil?zh:Mh,Ue=v.stencil?ul:ca);const Xe={colorFormat:t.RGBA8,depthFormat:Ge,scaleFactor:r};d=new XRWebGLBinding(s,t),f=d.createProjectionLayer(Xe),s.updateRenderState({layers:[f]}),e.setPixelRatio(1),e.setSize(f.textureWidth,f.textureHeight,!1),_=new Zt(f.textureWidth,f.textureHeight,{format:xi,type:gi,depthTexture:new Tp(f.textureWidth,f.textureHeight,Ue,void 0,void 0,void 0,void 0,void 0,void 0,ve),stencilBuffer:v.stencil,colorSpace:e.outputColorSpace,samples:v.antialias?4:0});const ze=e.properties.get(_);ze.__ignoreDepthValues=f.ignoreDepthValues}_.isXRRenderTarget=!0,this.setFoveation(c),l=null,o=await s.requestReferenceSpace(a),qe.setContext(s),qe.start(),i.isPresenting=!0,i.dispatchEvent({type:"sessionstart"})}},this.getEnvironmentBlendMode=function(){if(s!==null)return s.environmentBlendMode};function U(ae){for(let ve=0;ve<ae.removed.length;ve++){const Ue=ae.removed[ve],Ge=E.indexOf(Ue);Ge>=0&&(E[Ge]=null,T[Ge].disconnect(Ue))}for(let ve=0;ve<ae.added.length;ve++){const Ue=ae.added[ve];let Ge=E.indexOf(Ue);if(Ge===-1){for(let ze=0;ze<T.length;ze++)if(ze>=E.length){E.push(Ue),Ge=ze;break}else if(E[ze]===null){E[ze]=Ue,Ge=ze;break}if(Ge===-1)break}const Xe=T[Ge];Xe&&Xe.connect(Ue)}}const H=new w,Y=new w;function J(ae,ve,Ue){H.setFromMatrixPosition(ve.matrixWorld),Y.setFromMatrixPosition(Ue.matrixWorld);const Ge=H.distanceTo(Y),Xe=ve.projectionMatrix.elements,ze=Ue.projectionMatrix.elements,Pe=Xe[14]/(Xe[10]-1),X=Xe[14]/(Xe[10]+1),Ae=(Xe[9]+1)/Xe[5],ke=(Xe[9]-1)/Xe[5],be=(Xe[8]-1)/Xe[0],je=(ze[8]+1)/ze[0],ct=Pe*be,F=Pe*je,B=Ge/(-be+je),ce=B*-be;ve.matrixWorld.decompose(ae.position,ae.quaternion,ae.scale),ae.translateX(ce),ae.translateZ(B),ae.matrixWorld.compose(ae.position,ae.quaternion,ae.scale),ae.matrixWorldInverse.copy(ae.matrixWorld).invert();const Se=Pe+B,xe=X+B,Ie=ct-ce,et=F+(Ge-ce),Fe=Ae*X/xe*Se,Ke=ke*X/xe*Se;ae.projectionMatrix.makePerspective(Ie,et,Fe,Ke,Se,xe),ae.projectionMatrixInverse.copy(ae.projectionMatrix).invert()}function se(ae,ve){ve===null?ae.matrixWorld.copy(ae.matrix):ae.matrixWorld.multiplyMatrices(ve.matrixWorld,ae.matrix),ae.matrixWorldInverse.copy(ae.matrixWorld).invert()}this.updateCamera=function(ae){if(s===null)return;m&&(ae.near=g,ae.far=y),G.near=C.near=S.near=ae.near,G.far=C.far=S.far=ae.far,(Q!==G.near||L!==G.far)&&(s.updateRenderState({depthNear:G.near,depthFar:G.far}),Q=G.near,L=G.far,S.near=g,S.far=y,C.near=g,C.far=y,S.updateProjectionMatrix(),C.updateProjectionMatrix(),ae.updateProjectionMatrix());const ve=ae.parent,Ue=G.cameras;se(G,ve);for(let Ge=0;Ge<Ue.length;Ge++)se(Ue[Ge],ve);Ue.length===2?J(G,S,C):G.projectionMatrix.copy(S.projectionMatrix),fe(ae,G,ve)};function fe(ae,ve,Ue){Ue===null?ae.matrix.copy(ve.matrixWorld):(ae.matrix.copy(Ue.matrixWorld),ae.matrix.invert(),ae.matrix.multiply(ve.matrixWorld)),ae.matrix.decompose(ae.position,ae.quaternion,ae.scale),ae.updateMatrixWorld(!0),ae.projectionMatrix.copy(ve.projectionMatrix),ae.projectionMatrixInverse.copy(ve.projectionMatrixInverse),ae.isPerspectiveCamera&&(ae.fov=fp*2*Math.atan(1/ae.projectionMatrix.elements[5]),ae.zoom=1)}this.getCamera=function(){return G},this.getFoveation=function(){if(!(f===null&&p===null))return c},this.setFoveation=function(ae){c=ae,f!==null&&(f.fixedFoveation=ae),p!==null&&p.fixedFoveation!==void 0&&(p.fixedFoveation=ae)},this.getDepthTexture=function(){return m};let _e=null;function Oe(ae,ve){if(h=ve.getViewerPose(l||o),A=ve,h!==null){const Ue=h.views;p!==null&&(e.setRenderTargetFramebuffer(_,p.framebuffer),e.setRenderTarget(_));let Ge=!1;Ue.length!==G.cameras.length&&(G.cameras.length=0,Ge=!0);for(let ze=0;ze<Ue.length;ze++){const Pe=Ue[ze];let X=null;if(p!==null)X=p.getViewport(Pe);else{const ke=d.getViewSubImage(f,Pe);X=ke.viewport,ze===0&&(e.setRenderTargetTextures(_,ke.colorTexture,f.ignoreDepthValues?void 0:ke.depthStencilTexture),e.setRenderTarget(_))}let Ae=D[ze];Ae===void 0&&(Ae=new Wt,Ae.layers.enable(ze),Ae.viewport=new tt,D[ze]=Ae),Ae.matrix.fromArray(Pe.transform.matrix),Ae.matrix.decompose(Ae.position,Ae.quaternion,Ae.scale),Ae.projectionMatrix.fromArray(Pe.projectionMatrix),Ae.projectionMatrixInverse.copy(Ae.projectionMatrix).invert(),Ae.viewport.set(X.x,X.y,X.width,X.height),ze===0&&(G.matrix.copy(Ae.matrix),G.matrix.decompose(G.position,G.quaternion,G.scale)),Ge===!0&&G.cameras.push(Ae)}let Xe=null;if(s.enabledFeatures&&s.enabledFeatures.includes("depth-sensing")&&(Xe=d.getDepthInformation(Ue[0])),Xe&&Xe.isValid){if(m===null){m=Xe.texture;const ze=new Ft,Pe=e.properties.get(ze);Pe.__webglTexture=m,(Xe.depthNear!=s.renderState.depthNear||Xe.depthFar!=s.renderState.depthFar)&&(g=Xe.depthNear,y=Xe.depthFar);const X=G.cameras[0].viewport;e.setOcclusion({depthColor:ze,depthWidth:X.z,depthHeight:X.w})}}else m=null}for(let Ue=0;Ue<T.length;Ue++){const Ge=E[Ue],Xe=T[Ue];Ge!==null&&Xe!==void 0&&Xe.update(Ge,ve,l||o)}_e&&_e(ae,ve),ve.detectedPlanes&&i.dispatchEvent({type:"planesdetected",data:ve}),A=null}const qe=new f2;qe.setAnimationLoop(Oe),this.setAnimationLoop=function(ae){_e=ae},this.dispose=function(){}}}function y5(n,e){function t(A,v){A.matrixAutoUpdate===!0&&A.updateMatrix(),v.value.copy(A.matrix)}function i(A,v){v.color.getRGB(A.fogColor.value,d2(n)),v.isFog?(A.fogNear.value=v.near,A.fogFar.value=v.far):v.isFogExp2&&(A.fogDensity.value=v.density)}function s(A,v){A.depthColor.value=v.depthColor,A.depthWidth.value=v.depthWidth,A.depthHeight.value=v.depthHeight}function r(A,v,b,_,T){v.isMeshBasicMaterial||v.isMeshLambertMaterial?o(A,v):v.isMeshToonMaterial?(o(A,v),f(A,v)):v.isMeshPhongMaterial?(o(A,v),d(A,v)):v.isMeshStandardMaterial?(o(A,v),p(A,v),v.isMeshPhysicalMaterial&&m(A,v,T)):v.isMeshMatcapMaterial?(o(A,v),g(A,v)):v.isMeshDepthMaterial?o(A,v):v.isMeshDistanceMaterial?(o(A,v),y(A,v)):v.isMeshNormalMaterial?o(A,v):v.isLineBasicMaterial?(a(A,v),v.isLineDashedMaterial&&c(A,v)):v.isPointsMaterial?l(A,v,b,_):v.isSpriteMaterial?h(A,v):v.isShadowMaterial?(A.color.value.copy(v.color),A.opacity.value=v.opacity):v.isShaderMaterial&&(v.uniformsNeedUpdate=!1)}function o(A,v){A.opacity.value=v.opacity,v.color&&A.diffuse.value.copy(v.color),v.emissive&&A.emissive.value.copy(v.emissive).multiplyScalar(v.emissiveIntensity),v.map&&(A.map.value=v.map,t(v.map,A.mapTransform)),v.alphaMap&&(A.alphaMap.value=v.alphaMap,t(v.alphaMap,A.alphaMapTransform)),v.bumpMap&&(A.bumpMap.value=v.bumpMap,t(v.bumpMap,A.bumpMapTransform),A.bumpScale.value=v.bumpScale,v.side===mn&&(A.bumpScale.value*=-1)),v.normalMap&&(A.normalMap.value=v.normalMap,t(v.normalMap,A.normalMapTransform),A.normalScale.value.copy(v.normalScale),v.side===mn&&A.normalScale.value.negate()),v.displacementMap&&(A.displacementMap.value=v.displacementMap,t(v.displacementMap,A.displacementMapTransform),A.displacementScale.value=v.displacementScale,A.displacementBias.value=v.displacementBias),v.emissiveMap&&(A.emissiveMap.value=v.emissiveMap,t(v.emissiveMap,A.emissiveMapTransform)),v.specularMap&&(A.specularMap.value=v.specularMap,t(v.specularMap,A.specularMapTransform)),v.alphaTest>0&&(A.alphaTest.value=v.alphaTest);const b=e.get(v).envMap;if(b&&(A.envMap.value=b,A.flipEnvMap.value=b.isCubeTexture&&b.isRenderTargetTexture===!1?-1:1,A.reflectivity.value=v.reflectivity,A.ior.value=v.ior,A.refractionRatio.value=v.refractionRatio),v.lightMap){A.lightMap.value=v.lightMap;const _=n._useLegacyLights===!0?Math.PI:1;A.lightMapIntensity.value=v.lightMapIntensity*_,t(v.lightMap,A.lightMapTransform)}v.aoMap&&(A.aoMap.value=v.aoMap,A.aoMapIntensity.value=v.aoMapIntensity,t(v.aoMap,A.aoMapTransform))}function a(A,v){A.diffuse.value.copy(v.color),A.opacity.value=v.opacity,v.map&&(A.map.value=v.map,t(v.map,A.mapTransform))}function c(A,v){A.dashSize.value=v.dashSize,A.totalSize.value=v.dashSize+v.gapSize,A.scale.value=v.scale}function l(A,v,b,_){A.diffuse.value.copy(v.color),A.opacity.value=v.opacity,A.size.value=v.size*b,A.scale.value=_*.5,v.map&&(A.map.value=v.map,t(v.map,A.uvTransform)),v.alphaMap&&(A.alphaMap.value=v.alphaMap,t(v.alphaMap,A.alphaMapTransform)),v.alphaTest>0&&(A.alphaTest.value=v.alphaTest)}function h(A,v){A.diffuse.value.copy(v.color),A.opacity.value=v.opacity,A.rotation.value=v.rotation,v.map&&(A.map.value=v.map,t(v.map,A.mapTransform)),v.alphaMap&&(A.alphaMap.value=v.alphaMap,t(v.alphaMap,A.alphaMapTransform)),v.alphaTest>0&&(A.alphaTest.value=v.alphaTest)}function d(A,v){A.specular.value.copy(v.specular),A.shininess.value=Math.max(v.shininess,1e-4)}function f(A,v){v.gradientMap&&(A.gradientMap.value=v.gradientMap)}function p(A,v){A.metalness.value=v.metalness,v.metalnessMap&&(A.metalnessMap.value=v.metalnessMap,t(v.metalnessMap,A.metalnessMapTransform)),A.roughness.value=v.roughness,v.roughnessMap&&(A.roughnessMap.value=v.roughnessMap,t(v.roughnessMap,A.roughnessMapTransform)),e.get(v).envMap&&(A.envMapIntensity.value=v.envMapIntensity)}function m(A,v,b){A.ior.value=v.ior,v.sheen>0&&(A.sheenColor.value.copy(v.sheenColor).multiplyScalar(v.sheen),A.sheenRoughness.value=v.sheenRoughness,v.sheenColorMap&&(A.sheenColorMap.value=v.sheenColorMap,t(v.sheenColorMap,A.sheenColorMapTransform)),v.sheenRoughnessMap&&(A.sheenRoughnessMap.value=v.sheenRoughnessMap,t(v.sheenRoughnessMap,A.sheenRoughnessMapTransform))),v.clearcoat>0&&(A.clearcoat.value=v.clearcoat,A.clearcoatRoughness.value=v.clearcoatRoughness,v.clearcoatMap&&(A.clearcoatMap.value=v.clearcoatMap,t(v.clearcoatMap,A.clearcoatMapTransform)),v.clearcoatRoughnessMap&&(A.clearcoatRoughnessMap.value=v.clearcoatRoughnessMap,t(v.clearcoatRoughnessMap,A.clearcoatRoughnessMapTransform)),v.clearcoatNormalMap&&(A.clearcoatNormalMap.value=v.clearcoatNormalMap,t(v.clearcoatNormalMap,A.clearcoatNormalMapTransform),A.clearcoatNormalScale.value.copy(v.clearcoatNormalScale),v.side===mn&&A.clearcoatNormalScale.value.negate())),v.iridescence>0&&(A.iridescence.value=v.iridescence,A.iridescenceIOR.value=v.iridescenceIOR,A.iridescenceThicknessMinimum.value=v.iridescenceThicknessRange[0],A.iridescenceThicknessMaximum.value=v.iridescenceThicknessRange[1],v.iridescenceMap&&(A.iridescenceMap.value=v.iridescenceMap,t(v.iridescenceMap,A.iridescenceMapTransform)),v.iridescenceThicknessMap&&(A.iridescenceThicknessMap.value=v.iridescenceThicknessMap,t(v.iridescenceThicknessMap,A.iridescenceThicknessMapTransform))),v.transmission>0&&(A.transmission.value=v.transmission,A.transmissionSamplerMap.value=b.texture,A.transmissionSamplerSize.value.set(b.width,b.height),v.transmissionMap&&(A.transmissionMap.value=v.transmissionMap,t(v.transmissionMap,A.transmissionMapTransform)),A.thickness.value=v.thickness,v.thicknessMap&&(A.thicknessMap.value=v.thicknessMap,t(v.thicknessMap,A.thicknessMapTransform)),A.attenuationDistance.value=v.attenuationDistance,A.attenuationColor.value.copy(v.attenuationColor)),v.anisotropy>0&&(A.anisotropyVector.value.set(v.anisotropy*Math.cos(v.anisotropyRotation),v.anisotropy*Math.sin(v.anisotropyRotation)),v.anisotropyMap&&(A.anisotropyMap.value=v.anisotropyMap,t(v.anisotropyMap,A.anisotropyMapTransform))),A.specularIntensity.value=v.specularIntensity,A.specularColor.value.copy(v.specularColor),v.specularColorMap&&(A.specularColorMap.value=v.specularColorMap,t(v.specularColorMap,A.specularColorMapTransform)),v.specularIntensityMap&&(A.specularIntensityMap.value=v.specularIntensityMap,t(v.specularIntensityMap,A.specularIntensityMapTransform))}function g(A,v){v.matcap&&(A.matcap.value=v.matcap)}function y(A,v){const b=e.get(v).light;A.referencePosition.value.setFromMatrixPosition(b.matrixWorld),A.nearDistance.value=b.shadow.camera.near,A.farDistance.value=b.shadow.camera.far}return{refreshFogUniforms:i,refreshMaterialUniforms:r,refreshOcclusionUniforms:s}}function b5(n,e,t,i){let s={},r={},o=[];const a=t.isWebGL2?n.getParameter(n.MAX_UNIFORM_BUFFER_BINDINGS):0;function c(v,b){const _=b.program;i.uniformBlockBinding(v,_)}function l(v,b){let _=s[v.id];_===void 0&&(m(v),_=h(v),s[v.id]=_,v.addEventListener("dispose",y));const T=b.program;i.updateUBOMapping(v,T);const E=e.render.frame;r[v.id]!==E&&(f(v),r[v.id]=E)}function h(v){const b=d();v.__bindingPointIndex=b;const _=n.createBuffer(),T=v.__size,E=v.usage;return n.bindBuffer(n.UNIFORM_BUFFER,_),n.bufferData(n.UNIFORM_BUFFER,T,E),n.bindBuffer(n.UNIFORM_BUFFER,null),n.bindBufferBase(n.UNIFORM_BUFFER,b,_),_}function d(){for(let v=0;v<a;v++)if(o.indexOf(v)===-1)return o.push(v),v;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}function f(v){const b=s[v.id],_=v.uniforms,T=v.__cache;n.bindBuffer(n.UNIFORM_BUFFER,b);for(let E=0,M=_.length;E<M;E++){const I=Array.isArray(_[E])?_[E]:[_[E]];for(let S=0,C=I.length;S<C;S++){const D=I[S];if(p(D,E,S,T)===!0){const G=D.__offset,Q=Array.isArray(D.value)?D.value:[D.value];let L=0;for(let V=0;V<Q.length;V++){const O=Q[V],U=g(O);typeof O=="number"||typeof O=="boolean"?(D.__data[0]=O,n.bufferSubData(n.UNIFORM_BUFFER,G+L,D.__data)):O.isMatrix3?(D.__data[0]=O.elements[0],D.__data[1]=O.elements[1],D.__data[2]=O.elements[2],D.__data[3]=0,D.__data[4]=O.elements[3],D.__data[5]=O.elements[4],D.__data[6]=O.elements[5],D.__data[7]=0,D.__data[8]=O.elements[6],D.__data[9]=O.elements[7],D.__data[10]=O.elements[8],D.__data[11]=0):(O.toArray(D.__data,L),L+=U.storage/Float32Array.BYTES_PER_ELEMENT)}n.bufferSubData(n.UNIFORM_BUFFER,G,D.__data)}}}n.bindBuffer(n.UNIFORM_BUFFER,null)}function p(v,b,_,T){const E=v.value,M=b+"_"+_;if(T[M]===void 0)return typeof E=="number"||typeof E=="boolean"?T[M]=E:T[M]=E.clone(),!0;{const I=T[M];if(typeof E=="number"||typeof E=="boolean"){if(I!==E)return T[M]=E,!0}else if(I.equals(E)===!1)return I.copy(E),!0}return!1}function m(v){const b=v.uniforms;let _=0;const T=16;for(let M=0,I=b.length;M<I;M++){const S=Array.isArray(b[M])?b[M]:[b[M]];for(let C=0,D=S.length;C<D;C++){const G=S[C],Q=Array.isArray(G.value)?G.value:[G.value];for(let L=0,V=Q.length;L<V;L++){const O=Q[L],U=g(O),H=_%T;H!==0&&T-H<U.boundary&&(_+=T-H),G.__data=new Float32Array(U.storage/Float32Array.BYTES_PER_ELEMENT),G.__offset=_,_+=U.storage}}}const E=_%T;return E>0&&(_+=T-E),v.__size=_,v.__cache={},this}function g(v){const b={boundary:0,storage:0};return typeof v=="number"||typeof v=="boolean"?(b.boundary=4,b.storage=4):v.isVector2?(b.boundary=8,b.storage=8):v.isVector3||v.isColor?(b.boundary=16,b.storage=12):v.isVector4?(b.boundary=16,b.storage=16):v.isMatrix3?(b.boundary=48,b.storage=48):v.isMatrix4?(b.boundary=64,b.storage=64):v.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",v),b}function y(v){const b=v.target;b.removeEventListener("dispose",y);const _=o.indexOf(b.__bindingPointIndex);o.splice(_,1),n.deleteBuffer(s[b.id]),delete s[b.id],delete r[b.id]}function A(){for(const v in s)n.deleteBuffer(s[v]);o=[],s={},r={}}return{bind:c,update:l,dispose:A}}class Rl{constructor(e={}){const{canvas:t=c2(),context:i=null,depth:s=!0,stencil:r=!0,alpha:o=!1,antialias:a=!1,premultipliedAlpha:c=!0,preserveDrawingBuffer:l=!1,powerPreference:h="default",failIfMajorPerformanceCaveat:d=!1}=e;this.isWebGLRenderer=!0;let f;i!==null?f=i.getContextAttributes().alpha:f=o;const p=new Uint32Array(4),m=new Int32Array(4);let g=null,y=null;const A=[],v=[];this.domElement=t,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this._outputColorSpace=zt,this._useLegacyLights=!1,this.toneMapping=Fr,this.toneMappingExposure=1;const b=this;let _=!1,T=0,E=0,M=null,I=-1,S=null;const C=new tt,D=new tt;let G=null;const Q=new ye(0);let L=0,V=t.width,O=t.height,U=1,H=null,Y=null;const J=new tt(0,0,V,O),se=new tt(0,0,V,O);let fe=!1;const _e=new UA;let Oe=!1,qe=!1,ae=null;const ve=new Ce,Ue=new ie,Ge=new w,Xe={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};let ze=null;function Pe(){return M===null?U:1}let X=i;function Ae(P,z){for(let W=0;W<P.length;W++){const $=P[W],Z=t.getContext($,z);if(Z!==null)return Z}return null}try{const P={alpha:!0,depth:s,stencil:r,antialias:a,premultipliedAlpha:c,preserveDrawingBuffer:l,powerPreference:h,failIfMajorPerformanceCaveat:d};if("setAttribute"in t&&t.setAttribute("data-engine",`three.js r${qh}`),t.addEventListener("webglcontextlost",q,!1),t.addEventListener("webglcontextrestored",He,!1),t.addEventListener("webglcontextcreationerror",Ye,!1),X===null){const z=["webgl2","webgl","experimental-webgl"];if(b.isWebGL1Renderer===!0&&z.shift(),X=Ae(z,P),X===null)throw Ae(z)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}typeof WebGLRenderingContext<"u"&&X instanceof WebGLRenderingContext&&console.warn("THREE.WebGLRenderer: WebGL 1 support was deprecated in r153 and will be removed in r163."),X.getShaderPrecisionFormat===void 0&&(X.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(P){throw console.error("THREE.WebGLRenderer: "+P.message),P}let ke,be,je,ct,F,B,ce,Se,xe,Ie,et,Fe,Ke,rt,At,Ee,Rt,dt,ft,Ze,Ve,pt,Pt,j;function Ne(){ke=new OQ(X),be=new IQ(X,ke,e),ke.init(be),pt=new y2(X,ke,be),je=new m5(X,ke,be),ct=new FQ(X),F=new n5,B=new g5(X,ke,je,F,be,pt,ct),ce=new PQ(b),Se=new DQ(b),xe=new QV(X,be),Pt=new TQ(X,ke,xe,be),Ie=new kQ(X,xe,ct,Pt),et=new GQ(X,Ie,xe,ct),ft=new zQ(X,be,B),Ee=new RQ(F),Fe=new i5(b,ce,Se,ke,be,Pt,Ee),Ke=new y5(b,F),rt=new r5,At=new u5(ke,be),dt=new EQ(b,ce,Se,je,et,f,c),Rt=new p5(b,et,be),j=new b5(X,ct,be,je),Ze=new MQ(X,ke,ct,be),Ve=new LQ(X,ke,ct,be),ct.programs=Fe.programs,b.capabilities=be,b.extensions=ke,b.properties=F,b.renderLists=rt,b.shadowMap=Rt,b.state=je,b.info=ct}Ne();const ne=new v5(b,X);this.xr=ne,this.getContext=function(){return X},this.getContextAttributes=function(){return X.getContextAttributes()},this.forceContextLoss=function(){const P=ke.get("WEBGL_lose_context");P&&P.loseContext()},this.forceContextRestore=function(){const P=ke.get("WEBGL_lose_context");P&&P.restoreContext()},this.getPixelRatio=function(){return U},this.setPixelRatio=function(P){P!==void 0&&(U=P,this.setSize(V,O,!1))},this.setOcclusion=function(P){P!==void 0&&(ze=P)},this.clearOcclusion=function(){ze=null},this.getSize=function(P){return P.set(V,O)},this.setSize=function(P,z,W=!0){if(ne.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}V=P,O=z,t.width=Math.floor(P*U),t.height=Math.floor(z*U),W===!0&&(t.style.width=P+"px",t.style.height=z+"px"),this.setViewport(0,0,P,z)},this.getDrawingBufferSize=function(P){return P.set(V*U,O*U).floor()},this.setDrawingBufferSize=function(P,z,W){V=P,O=z,U=W,t.width=Math.floor(P*W),t.height=Math.floor(z*W),this.setViewport(0,0,P,z)},this.getCurrentViewport=function(P){return P.copy(C)},this.getViewport=function(P){return P.copy(J)},this.setViewport=function(P,z,W,$){P.isVector4?J.set(P.x,P.y,P.z,P.w):J.set(P,z,W,$),je.viewport(C.copy(J).multiplyScalar(U).floor())},this.getScissor=function(P){return P.copy(se)},this.setScissor=function(P,z,W,$){P.isVector4?se.set(P.x,P.y,P.z,P.w):se.set(P,z,W,$),je.scissor(D.copy(se).multiplyScalar(U).floor())},this.getScissorTest=function(){return fe},this.setScissorTest=function(P){je.setScissorTest(fe=P)},this.setOpaqueSort=function(P){H=P},this.setTransparentSort=function(P){Y=P},this.getClearColor=function(P){return P.copy(dt.getClearColor())},this.setClearColor=function(){dt.setClearColor.apply(dt,arguments)},this.getClearAlpha=function(){return dt.getClearAlpha()},this.setClearAlpha=function(){dt.setClearAlpha.apply(dt,arguments)},this.clear=function(P=!0,z=!0,W=!0){let $=0;if(P){let Z=!1;if(M!==null){const he=M.texture.format;Z=he===dM||he===uM||he===hM}if(Z){const he=M.texture.type,pe=he===gi||he===ca||he===w_||he===ul||he===cM||he===lM,Re=dt.getClearColor(),Be=dt.getClearAlpha(),Qe=Re.r,Je=Re.g,Le=Re.b;pe?(p[0]=Qe,p[1]=Je,p[2]=Le,p[3]=Be,X.clearBufferuiv(X.COLOR,0,p)):(m[0]=Qe,m[1]=Je,m[2]=Le,m[3]=Be,X.clearBufferiv(X.COLOR,0,m))}else $|=X.COLOR_BUFFER_BIT}z&&($|=X.DEPTH_BUFFER_BIT),W&&($|=X.STENCIL_BUFFER_BIT,this.state.buffers.stencil.setMask(4294967295)),X.clear($)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",q,!1),t.removeEventListener("webglcontextrestored",He,!1),t.removeEventListener("webglcontextcreationerror",Ye,!1),rt.dispose(),At.dispose(),F.dispose(),ce.dispose(),Se.dispose(),et.dispose(),Pt.dispose(),j.dispose(),Fe.dispose(),ne.dispose(),ne.removeEventListener("sessionstart",ui),ne.removeEventListener("sessionend",vn),ae&&(ae.dispose(),ae=null),en.stop()};function q(P){P.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),_=!0}function He(){console.log("THREE.WebGLRenderer: Context Restored."),_=!1;const P=ct.autoReset,z=Rt.enabled,W=Rt.autoUpdate,$=Rt.needsUpdate,Z=Rt.type;Ne(),ct.autoReset=P,Rt.enabled=z,Rt.autoUpdate=W,Rt.needsUpdate=$,Rt.type=Z}function Ye(P){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",P.statusMessage)}function at(P){const z=P.target;z.removeEventListener("dispose",at),xt(z)}function xt(P){Ei(P),F.remove(P)}function Ei(P){const z=F.get(P).programs;z!==void 0&&(z.forEach(function(W){Fe.releaseProgram(W)}),P.isShaderMaterial&&Fe.releaseShaderCache(P))}this.renderBufferDirect=function(P,z,W,$,Z,he){z===null&&(z=Xe);const pe=Z.isMesh&&Z.matrixWorld.determinant()<0,Re=N(P,z,W,$,Z);je.setMaterial($,pe);let Be=W.index,Qe=1;if($.wireframe===!0){if(Be=Ie.getWireframeAttribute(W),Be===void 0)return;Qe=2}const Je=W.drawRange,Le=W.attributes.position;let $e=Je.start*Qe,wt=(Je.start+Je.count)*Qe;he!==null&&($e=Math.max($e,he.start*Qe),wt=Math.min(wt,(he.start+he.count)*Qe)),Be!==null?($e=Math.max($e,0),wt=Math.min(wt,Be.count)):Le!=null&&($e=Math.max($e,0),wt=Math.min(wt,Le.count));const Qt=wt-$e;if(Qt<0||Qt===1/0)return;Pt.setup(Z,$,Re,W,Be);let yi,$t=Ze;if(Be!==null&&(yi=xe.get(Be),$t=Ve,$t.setIndex(yi)),Z.isMesh)$.wireframe===!0?(je.setLineWidth($.wireframeLinewidth*Pe()),$t.setMode(X.LINES)):$t.setMode(X.TRIANGLES);else if(Z.isLine){let ut=$.linewidth;ut===void 0&&(ut=1),je.setLineWidth(ut*Pe()),Z.isLineSegments?$t.setMode(X.LINES):Z.isLineLoop?$t.setMode(X.LINE_LOOP):$t.setMode(X.LINE_STRIP)}else Z.isPoints?$t.setMode(X.POINTS):Z.isSprite&&$t.setMode(X.TRIANGLES);if(Z.isBatchedMesh)$t.renderMultiDraw(Z._multiDrawStarts,Z._multiDrawCounts,Z._multiDrawCount);else if(Z.isInstancedMesh)$t.renderInstances($e,Qt,Z.count);else if(W.isInstancedBufferGeometry){const ut=W._maxInstanceCount!==void 0?W._maxInstanceCount:1/0,ei=Math.min(W.instanceCount,ut);$t.renderInstances($e,Qt,ei)}else $t.render($e,Qt)};function vi(P,z,W){P.transparent===!0&&P.side===Ai&&P.forceSinglePass===!1?(P.side=mn,P.needsUpdate=!0,ru(P,z,W),P.side=Es,P.needsUpdate=!0,ru(P,z,W),P.side=Ai):ru(P,z,W)}this.compile=function(P,z,W=null){W===null&&(W=P),y=At.get(W),y.init(),v.push(y),W.traverseVisible(function(Z){Z.isLight&&Z.layers.test(z.layers)&&(y.pushLight(Z),Z.castShadow&&y.pushShadow(Z))}),P!==W&&P.traverseVisible(function(Z){Z.isLight&&Z.layers.test(z.layers)&&(y.pushLight(Z),Z.castShadow&&y.pushShadow(Z))}),y.setupLights(b._useLegacyLights);const $=new Set;return P.traverse(function(Z){const he=Z.material;if(he)if(Array.isArray(he))for(let pe=0;pe<he.length;pe++){const Re=he[pe];vi(Re,W,Z),$.add(Re)}else vi(he,W,Z),$.add(he)}),v.pop(),y=null,$},this.compileAsync=function(P,z,W=null){const $=this.compile(P,z,W);return new Promise(Z=>{function he(){if($.forEach(function(pe){F.get(pe).currentProgram.isReady()&&$.delete(pe)}),$.size===0){Z(P);return}setTimeout(he,10)}ke.get("KHR_parallel_shader_compile")!==null?he():setTimeout(he,10)})};let fi=null;function Li(P){fi&&fi(P)}function ui(){en.stop()}function vn(){en.start()}const en=new f2;en.setAnimationLoop(Li),typeof self<"u"&&en.setContext(self),this.setAnimationLoop=function(P){fi=P,ne.setAnimationLoop(P),P===null?en.stop():en.start()},ne.addEventListener("sessionstart",ui),ne.addEventListener("sessionend",vn),this.render=function(P,z){if(z!==void 0&&z.isCamera!==!0){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(_===!0)return;P.matrixWorldAutoUpdate===!0&&P.updateMatrixWorld(),z.parent===null&&z.matrixWorldAutoUpdate===!0&&z.updateMatrixWorld(),ne.enabled===!0&&ne.isPresenting===!0&&(ne.cameraAutoUpdate===!0&&ne.updateCamera(z),z=ne.getCamera()),P.isScene===!0&&P.onBeforeRender(b,P,z,M),y=At.get(P,v.length),y.init(),v.push(y),ve.multiplyMatrices(z.projectionMatrix,z.matrixWorldInverse),_e.setFromProjectionMatrix(ve),qe=this.localClippingEnabled,Oe=Ee.init(this.clippingPlanes,qe),g=rt.get(P,A.length),g.init(),A.push(g),fo(P,z,0,b.sortObjects),g.finish(),b.sortObjects===!0&&g.sort(H,Y),this.info.render.frame++,Oe===!0&&Ee.beginShadows();const W=y.state.shadowsArray;if(Rt.render(W,P,z),Oe===!0&&Ee.endShadows(),this.info.autoReset===!0&&this.info.reset(),dt.render(g,P),y.setupLights(b._useLegacyLights),z.isArrayCamera){const $=z.cameras;for(let Z=0,he=$.length;Z<he;Z++){const pe=$[Z];Dv(g,P,pe,pe.viewport)}}else Dv(g,P,z);M!==null&&(B.updateMultisampleRenderTarget(M),B.updateRenderTargetMipmap(M)),P.isScene===!0&&P.onAfterRender(b,P,z),Pt.resetDefaultState(),I=-1,S=null,v.pop(),v.length>0?y=v[v.length-1]:y=null,A.pop(),A.length>0?g=A[A.length-1]:g=null};function fo(P,z,W,$){if(P.visible===!1)return;if(P.layers.test(z.layers)){if(P.isGroup)W=P.renderOrder;else if(P.isLOD)P.autoUpdate===!0&&P.update(z);else if(P.isLight)y.pushLight(P),P.castShadow&&y.pushShadow(P);else if(P.isSprite){if(!P.frustumCulled||_e.intersectsSprite(P)){$&&Ge.setFromMatrixPosition(P.matrixWorld).applyMatrix4(ve);const pe=et.update(P),Re=P.material;Re.visible&&g.push(P,pe,Re,W,Ge.z,null)}}else if((P.isMesh||P.isLine||P.isPoints)&&(!P.frustumCulled||_e.intersectsObject(P))){const pe=et.update(P),Re=P.material;if($&&(P.boundingSphere!==void 0?(P.boundingSphere===null&&P.computeBoundingSphere(),Ge.copy(P.boundingSphere.center)):(pe.boundingSphere===null&&pe.computeBoundingSphere(),Ge.copy(pe.boundingSphere.center)),Ge.applyMatrix4(P.matrixWorld).applyMatrix4(ve)),Array.isArray(Re)){const Be=pe.groups;for(let Qe=0,Je=Be.length;Qe<Je;Qe++){const Le=Be[Qe],$e=Re[Le.materialIndex];$e&&$e.visible&&g.push(P,pe,$e,W,Ge.z,Le)}}else Re.visible&&g.push(P,pe,Re,W,Ge.z,null)}}const he=P.children;for(let pe=0,Re=he.length;pe<Re;pe++)fo(he[pe],z,W,$)}function Dv(P,z,W,$){const Z=P.opaque,he=P.transmissive,pe=P.transparent;y.setupLightsView(W),Oe===!0&&Ee.setGlobalState(b.clippingPlanes,W),he.length>0&&su(Z,he,z,W),$&&je.viewport(C.copy($)),Z.length>0&&Ca(Z,z,W),he.length>0&&Ca(he,z,W),pe.length>0&&Ca(pe,z,W),je.buffers.depth.setTest(!0),je.buffers.depth.setMask(!0),je.buffers.color.setMask(!0),je.setPolygonOffset(!1)}function su(P,z,W,$){if((W.isScene===!0?W.overrideMaterial:null)!==null)return;const he=be.isWebGL2;ae===null&&(ae=new Zt(1,1,{generateMipmaps:!0,type:ke.has("EXT_color_buffer_half_float")?sn:gi,minFilter:kr,samples:he?4:0})),b.getDrawingBufferSize(Ue),he?ae.setSize(Ue.x,Ue.y):ae.setSize(lb(Ue.x),lb(Ue.y));const pe=b.getRenderTarget();b.setRenderTarget(ae),b.getClearColor(Q),L=b.getClearAlpha(),L<1&&b.setClearColor(16777215,.5),b.clear();const Re=b.toneMapping;b.toneMapping=Fr,Ca(P,W,$),B.updateMultisampleRenderTarget(ae),B.updateRenderTargetMipmap(ae);let Be=!1;for(let Qe=0,Je=z.length;Qe<Je;Qe++){const Le=z[Qe],$e=Le.object,wt=Le.geometry,Qt=Le.material,yi=Le.group;if(Qt.side===Ai&&$e.layers.test($.layers)){const $t=Qt.side;Qt.side=mn,Qt.needsUpdate=!0,Kt($e,W,$,wt,Qt,yi),Qt.side=$t,Qt.needsUpdate=!0,Be=!0}}Be===!0&&(B.updateMultisampleRenderTarget(ae),B.updateRenderTargetMipmap(ae)),b.setRenderTarget(pe),b.setClearColor(Q,L),b.toneMapping=Re}function Ca(P,z,W){const $=z.isScene===!0?z.overrideMaterial:null;for(let Z=0,he=P.length;Z<he;Z++){const pe=P[Z],Re=pe.object,Be=pe.geometry,Qe=$===null?pe.material:$,Je=pe.group;Re.layers.test(W.layers)&&Kt(Re,z,W,Be,Qe,Je)}}function Kt(P,z,W,$,Z,he){P.onBeforeRender(b,z,W,$,Z,he),P.modelViewMatrix.multiplyMatrices(W.matrixWorldInverse,P.matrixWorld),P.normalMatrix.getNormalMatrix(P.modelViewMatrix),Z.onBeforeRender(b,z,W,$,P,he),Z.transparent===!0&&Z.side===Ai&&Z.forceSinglePass===!1?(Z.side=mn,Z.needsUpdate=!0,b.renderBufferDirect(W,z,$,Z,P,he),Z.side=Es,Z.needsUpdate=!0,b.renderBufferDirect(W,z,$,Z,P,he),Z.side=Ai):b.renderBufferDirect(W,z,$,Z,P,he),P.onAfterRender(b,z,W,$,Z,he)}function ru(P,z,W){z.isScene!==!0&&(z=Xe);const $=F.get(P),Z=y.state.lights,he=y.state.shadowsArray,pe=Z.state.version,Re=Fe.getParameters(P,Z.state,he,z,W,ze),Be=Fe.getProgramCacheKey(Re);let Qe=$.programs;$.environment=P.isMeshStandardMaterial?z.environment:null,$.fog=z.fog,$.envMap=(P.isMeshStandardMaterial?Se:ce).get(P.envMap||$.environment),Qe===void 0&&(P.addEventListener("dispose",at),Qe=new Map,$.programs=Qe);let Je=Qe.get(Be);if(Je!==void 0){if($.currentProgram===Je&&$.lightsStateVersion===pe)return R(P,Re),Je}else Re.uniforms=Fe.getUniforms(P),P.onBuild(W,Re,b),P.onBeforeCompile(Re,b),Je=Fe.acquireProgram(Re,Be),Qe.set(Be,Je),$.uniforms=Re.uniforms;const Le=$.uniforms;return(!P.isShaderMaterial&&!P.isRawShaderMaterial||P.clipping===!0)&&(Le.clippingPlanes=Ee.uniform),R(P,Re),$.needsLights=ue(P),$.lightsStateVersion=pe,$.needsLights&&(Le.ambientLightColor.value=Z.state.ambient,Le.lightProbe.value=Z.state.probe,Le.directionalLights.value=Z.state.directional,Le.directionalLightShadows.value=Z.state.directionalShadow,Le.spotLights.value=Z.state.spot,Le.spotLightShadows.value=Z.state.spotShadow,Le.rectAreaLights.value=Z.state.rectArea,Le.ltc_1.value=Z.state.rectAreaLTC1,Le.ltc_2.value=Z.state.rectAreaLTC2,Le.pointLights.value=Z.state.point,Le.pointLightShadows.value=Z.state.pointShadow,Le.hemisphereLights.value=Z.state.hemi,Le.directionalShadowMap.value=Z.state.directionalShadowMap,Le.directionalShadowMatrix.value=Z.state.directionalShadowMatrix,Le.spotShadowMap.value=Z.state.spotShadowMap,Le.spotLightMatrix.value=Z.state.spotLightMatrix,Le.spotLightMap.value=Z.state.spotLightMap,Le.pointShadowMap.value=Z.state.pointShadowMap,Le.pointShadowMatrix.value=Z.state.pointShadowMatrix),$.currentProgram=Je,$.uniformsList=null,Je}function Ov(P){if(P.uniformsList===null){const z=P.currentProgram.getUniforms();P.uniformsList=x0.seqWithValue(z.seq,P.uniforms)}return P.uniformsList}function R(P,z){const W=F.get(P);W.outputColorSpace=z.outputColorSpace,W.batching=z.batching,W.instancing=z.instancing,W.instancingColor=z.instancingColor,W.skinning=z.skinning,W.morphTargets=z.morphTargets,W.morphNormals=z.morphNormals,W.morphColors=z.morphColors,W.morphTargetsCount=z.morphTargetsCount,W.numClippingPlanes=z.numClippingPlanes,W.numIntersection=z.numClipIntersection,W.vertexAlphas=z.vertexAlphas,W.vertexTangents=z.vertexTangents,W.toneMapping=z.toneMapping}function N(P,z,W,$,Z){z.isScene!==!0&&(z=Xe),B.resetTextureUnits();const he=z.fog,pe=$.isMeshStandardMaterial?z.environment:null,Re=M===null?b.outputColorSpace:M.isXRRenderTarget===!0?M.texture.colorSpace:Ri,Be=($.isMeshStandardMaterial?Se:ce).get($.envMap||pe),Qe=$.vertexColors===!0&&!!W.attributes.color&&W.attributes.color.itemSize===4,Je=!!W.attributes.tangent&&(!!$.normalMap||$.anisotropy>0),Le=!!W.morphAttributes.position,$e=!!W.morphAttributes.normal,wt=!!W.morphAttributes.color;let Qt=Fr;$.toneMapped&&(M===null||M.isXRRenderTarget===!0)&&(Qt=b.toneMapping);const yi=W.morphAttributes.position||W.morphAttributes.normal||W.morphAttributes.color,$t=yi!==void 0?yi.length:0,ut=F.get($),ei=y.state.lights;if(Oe===!0&&(qe===!0||P!==S)){const hs=P===S&&$.id===I;Ee.setState($,P,hs)}let Ut=!1;$.version===ut.__version?(ut.needsLights&&ut.lightsStateVersion!==ei.state.version||ut.outputColorSpace!==Re||Z.isBatchedMesh&&ut.batching===!1||!Z.isBatchedMesh&&ut.batching===!0||Z.isInstancedMesh&&ut.instancing===!1||!Z.isInstancedMesh&&ut.instancing===!0||Z.isSkinnedMesh&&ut.skinning===!1||!Z.isSkinnedMesh&&ut.skinning===!0||Z.isInstancedMesh&&ut.instancingColor===!0&&Z.instanceColor===null||Z.isInstancedMesh&&ut.instancingColor===!1&&Z.instanceColor!==null||ut.envMap!==Be||$.fog===!0&&ut.fog!==he||$.occlusion===!0||ut.numClippingPlanes!==void 0&&(ut.numClippingPlanes!==Ee.numPlanes||ut.numIntersection!==Ee.numIntersection)||ut.vertexAlphas!==Qe||ut.vertexTangents!==Je||ut.morphTargets!==Le||ut.morphNormals!==$e||ut.morphColors!==wt||ut.toneMapping!==Qt||be.isWebGL2===!0&&ut.morphTargetsCount!==$t)&&(Ut=!0):(Ut=!0,ut.__version=$.version);let Rn=ut.currentProgram;Ut===!0&&(Rn=ru($,z,Z));let yn=!1,ai=!1,wi=!1;const Fi=Rn.getUniforms(),Er=ut.uniforms;if(je.useProgram(Rn.program)&&(yn=!0,ai=!0,wi=!0),$.id!==I&&(I=$.id,ai=!0),yn||S!==P){Fi.setValue(X,"projectionMatrix",P.projectionMatrix),Fi.setValue(X,"viewMatrix",P.matrixWorldInverse);const hs=Fi.map.cameraPosition;hs!==void 0&&hs.setValue(X,Ge.setFromMatrixPosition(P.matrixWorld)),be.logarithmicDepthBuffer&&Fi.setValue(X,"logDepthBufFC",2/(Math.log(P.far+1)/Math.LN2)),($.isMeshPhongMaterial||$.isMeshToonMaterial||$.isMeshLambertMaterial||$.isMeshBasicMaterial||$.isMeshStandardMaterial||$.isShaderMaterial)&&Fi.setValue(X,"isOrthographic",P.isOrthographicCamera===!0),S!==P&&(S=P,ai=!0,wi=!0)}if(Z.isSkinnedMesh){Fi.setOptional(X,Z,"bindMatrix"),Fi.setOptional(X,Z,"bindMatrixInverse");const hs=Z.skeleton;hs&&(be.floatVertexTextures?(hs.boneTexture===null&&hs.computeBoneTexture(),Fi.setValue(X,"boneTexture",hs.boneTexture,B)):console.warn("THREE.WebGLRenderer: SkinnedMesh can only be used with WebGL 2. With WebGL 1 OES_texture_float and vertex textures support is required."))}Z.isBatchedMesh&&(Fi.setOptional(X,Z,"batchingTexture"),Fi.setValue(X,"batchingTexture",Z._matricesTexture,B));const Tr=W.morphAttributes;if((Tr.position!==void 0||Tr.normal!==void 0||Tr.color!==void 0&&be.isWebGL2===!0)&&ft.update(Z,W,Rn),(ai||ut.receiveShadow!==Z.receiveShadow)&&(ut.receiveShadow=Z.receiveShadow,Fi.setValue(X,"receiveShadow",Z.receiveShadow)),$.isMeshGouraudMaterial&&$.envMap!==null&&(Er.envMap.value=Be,Er.flipEnvMap.value=Be.isCubeTexture&&Be.isRenderTargetTexture===!1?-1:1),ai&&(Fi.setValue(X,"toneMappingExposure",b.toneMappingExposure),ut.needsLights&&K(Er,wi),he&&$.fog===!0&&Ke.refreshFogUniforms(Er,he),ze&&$.occlusion===!0&&Ke.refreshOcclusionUniforms(Er,ze),Ke.refreshMaterialUniforms(Er,$,U,O,ae),x0.upload(X,Ov(ut),Er,B)),$.isShaderMaterial&&$.uniformsNeedUpdate===!0&&(x0.upload(X,Ov(ut),Er,B),$.uniformsNeedUpdate=!1),$.isSpriteMaterial&&Fi.setValue(X,"center",Z.center),Fi.setValue(X,"modelViewMatrix",Z.modelViewMatrix),Fi.setValue(X,"normalMatrix",Z.normalMatrix),Fi.setValue(X,"modelMatrix",Z.matrixWorld),$.isShaderMaterial||$.isRawShaderMaterial){const hs=$.uniformsGroups;for(let Sw=0,FG=hs.length;Sw<FG;Sw++)if(be.isWebGL2){const vR=hs[Sw];j.update(vR,Rn),j.bind(vR,Rn)}else console.warn("THREE.WebGLRenderer: Uniform Buffer Objects can only be used with WebGL 2.")}return Rn}function K(P,z){P.ambientLightColor.needsUpdate=z,P.lightProbe.needsUpdate=z,P.directionalLights.needsUpdate=z,P.directionalLightShadows.needsUpdate=z,P.pointLights.needsUpdate=z,P.pointLightShadows.needsUpdate=z,P.spotLights.needsUpdate=z,P.spotLightShadows.needsUpdate=z,P.rectAreaLights.needsUpdate=z,P.hemisphereLights.needsUpdate=z}function ue(P){return P.isMeshLambertMaterial||P.isMeshToonMaterial||P.isMeshPhongMaterial||P.isMeshStandardMaterial||P.isShadowMaterial||P.isShaderMaterial&&P.lights===!0}this.getActiveCubeFace=function(){return T},this.getActiveMipmapLevel=function(){return E},this.getRenderTarget=function(){return M},this.setRenderTargetTextures=function(P,z,W){F.get(P.texture).__webglTexture=z,F.get(P.depthTexture).__webglTexture=W;const $=F.get(P);$.__hasExternalTextures=!0,$.__hasExternalTextures&&($.__autoAllocateDepthBuffer=W===void 0,$.__autoAllocateDepthBuffer||ke.has("WEBGL_multisampled_render_to_texture")===!0&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),$.__useRenderToTexture=!1))},this.setRenderTargetFramebuffer=function(P,z){const W=F.get(P);W.__webglFramebuffer=z,W.__useDefaultFramebuffer=z===void 0},this.setRenderTarget=function(P,z=0,W=0){M=P,T=z,E=W;let $=!0,Z=null,he=!1,pe=!1;if(P){const Be=F.get(P);Be.__useDefaultFramebuffer!==void 0?(je.bindFramebuffer(X.FRAMEBUFFER,null),$=!1):Be.__webglFramebuffer===void 0?B.setupRenderTarget(P):Be.__hasExternalTextures&&B.rebindTextures(P,F.get(P.texture).__webglTexture,F.get(P.depthTexture).__webglTexture);const Qe=P.texture;(Qe.isData3DTexture||Qe.isDataArrayTexture||Qe.isCompressedArrayTexture)&&(pe=!0);const Je=F.get(P).__webglFramebuffer;P.isWebGLCubeRenderTarget?(Array.isArray(Je[z])?Z=Je[z][W]:Z=Je[z],he=!0):be.isWebGL2&&P.samples>0&&B.useMultisampledRTT(P)===!1?Z=F.get(P).__webglMultisampledFramebuffer:Array.isArray(Je)?Z=Je[W]:Z=Je,C.copy(P.viewport),D.copy(P.scissor),G=P.scissorTest}else C.copy(J).multiplyScalar(U).floor(),D.copy(se).multiplyScalar(U).floor(),G=fe;if(je.bindFramebuffer(X.FRAMEBUFFER,Z)&&be.drawBuffers&&$&&je.drawBuffers(P,Z),je.viewport(C),je.scissor(D),je.setScissorTest(G),he){const Be=F.get(P.texture);X.framebufferTexture2D(X.FRAMEBUFFER,X.COLOR_ATTACHMENT0,X.TEXTURE_CUBE_MAP_POSITIVE_X+z,Be.__webglTexture,W)}else if(pe){const Be=F.get(P.texture),Qe=z||0;X.framebufferTextureLayer(X.FRAMEBUFFER,X.COLOR_ATTACHMENT0,Be.__webglTexture,W||0,Qe)}I=-1},this.readRenderTargetPixels=function(P,z,W,$,Z,he,pe){if(!(P&&P.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let Re=F.get(P).__webglFramebuffer;if(P.isWebGLCubeRenderTarget&&pe!==void 0&&(Re=Re[pe]),Re){je.bindFramebuffer(X.FRAMEBUFFER,Re);try{const Be=P.texture,Qe=Be.format,Je=Be.type;if(Qe!==xi&&pt.convert(Qe)!==X.getParameter(X.IMPLEMENTATION_COLOR_READ_FORMAT)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}const Le=Je===sn&&(ke.has("EXT_color_buffer_half_float")||be.isWebGL2&&ke.has("EXT_color_buffer_float"));if(Je!==gi&&pt.convert(Je)!==X.getParameter(X.IMPLEMENTATION_COLOR_READ_TYPE)&&!(Je===Ji&&(be.isWebGL2||ke.has("OES_texture_float")||ke.has("WEBGL_color_buffer_float")))&&!Le){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}z>=0&&z<=P.width-$&&W>=0&&W<=P.height-Z&&X.readPixels(z,W,$,Z,pt.convert(Qe),pt.convert(Je),he)}finally{const Be=M!==null?F.get(M).__webglFramebuffer:null;je.bindFramebuffer(X.FRAMEBUFFER,Be)}}},this.copyFramebufferToTexture=function(P,z,W=0){const $=Math.pow(2,-W),Z=Math.floor(z.image.width*$),he=Math.floor(z.image.height*$);B.setTexture2D(z,0),X.copyTexSubImage2D(X.TEXTURE_2D,W,0,0,P.x,P.y,Z,he),je.unbindTexture()},this.copyTextureToTexture=function(P,z,W,$=0){const Z=z.image.width,he=z.image.height,pe=pt.convert(W.format),Re=pt.convert(W.type);B.setTexture2D(W,0),X.pixelStorei(X.UNPACK_FLIP_Y_WEBGL,W.flipY),X.pixelStorei(X.UNPACK_PREMULTIPLY_ALPHA_WEBGL,W.premultiplyAlpha),X.pixelStorei(X.UNPACK_ALIGNMENT,W.unpackAlignment),z.isDataTexture?X.texSubImage2D(X.TEXTURE_2D,$,P.x,P.y,Z,he,pe,Re,z.image.data):z.isCompressedTexture?X.compressedTexSubImage2D(X.TEXTURE_2D,$,P.x,P.y,z.mipmaps[0].width,z.mipmaps[0].height,pe,z.mipmaps[0].data):X.texSubImage2D(X.TEXTURE_2D,$,P.x,P.y,pe,Re,z.image),$===0&&W.generateMipmaps&&X.generateMipmap(X.TEXTURE_2D),je.unbindTexture()},this.copyTextureToTexture3D=function(P,z,W,$,Z=0){if(b.isWebGL1Renderer){console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");return}const he=P.max.x-P.min.x+1,pe=P.max.y-P.min.y+1,Re=P.max.z-P.min.z+1,Be=pt.convert($.format),Qe=pt.convert($.type);let Je;if($.isData3DTexture)B.setTexture3D($,0),Je=X.TEXTURE_3D;else if($.isDataArrayTexture||$.isCompressedArrayTexture)B.setTexture2DArray($,0),Je=X.TEXTURE_2D_ARRAY;else{console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");return}X.pixelStorei(X.UNPACK_FLIP_Y_WEBGL,$.flipY),X.pixelStorei(X.UNPACK_PREMULTIPLY_ALPHA_WEBGL,$.premultiplyAlpha),X.pixelStorei(X.UNPACK_ALIGNMENT,$.unpackAlignment);const Le=X.getParameter(X.UNPACK_ROW_LENGTH),$e=X.getParameter(X.UNPACK_IMAGE_HEIGHT),wt=X.getParameter(X.UNPACK_SKIP_PIXELS),Qt=X.getParameter(X.UNPACK_SKIP_ROWS),yi=X.getParameter(X.UNPACK_SKIP_IMAGES),$t=W.isCompressedTexture?W.mipmaps[Z]:W.image;X.pixelStorei(X.UNPACK_ROW_LENGTH,$t.width),X.pixelStorei(X.UNPACK_IMAGE_HEIGHT,$t.height),X.pixelStorei(X.UNPACK_SKIP_PIXELS,P.min.x),X.pixelStorei(X.UNPACK_SKIP_ROWS,P.min.y),X.pixelStorei(X.UNPACK_SKIP_IMAGES,P.min.z),W.isDataTexture||W.isData3DTexture?X.texSubImage3D(Je,Z,z.x,z.y,z.z,he,pe,Re,Be,Qe,$t.data):W.isCompressedArrayTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),X.compressedTexSubImage3D(Je,Z,z.x,z.y,z.z,he,pe,Re,Be,$t.data)):X.texSubImage3D(Je,Z,z.x,z.y,z.z,he,pe,Re,Be,Qe,$t),X.pixelStorei(X.UNPACK_ROW_LENGTH,Le),X.pixelStorei(X.UNPACK_IMAGE_HEIGHT,$e),X.pixelStorei(X.UNPACK_SKIP_PIXELS,wt),X.pixelStorei(X.UNPACK_SKIP_ROWS,Qt),X.pixelStorei(X.UNPACK_SKIP_IMAGES,yi),Z===0&&$.generateMipmaps&&X.generateMipmap(Je),je.unbindTexture()},this.initTexture=function(P){P.isCubeTexture?B.setTextureCube(P,0):P.isData3DTexture?B.setTexture3D(P,0):P.isDataArrayTexture||P.isCompressedArrayTexture?B.setTexture2DArray(P,0):B.setTexture2D(P,0),je.unbindTexture()},this.resetState=function(){T=0,E=0,M=null,je.reset(),Pt.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return ic}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(e){this._outputColorSpace=e;const t=this.getContext();t.drawingBufferColorSpace=e===kA?"display-p3":"srgb",t.unpackColorSpace=_i.workingColorSpace===Cp?"display-p3":"srgb"}get outputEncoding(){return console.warn("THREE.WebGLRenderer: Property .outputEncoding has been removed. Use .outputColorSpace instead."),this.outputColorSpace===zt?ac:OA}set outputEncoding(e){console.warn("THREE.WebGLRenderer: Property .outputEncoding has been removed. Use .outputColorSpace instead."),this.outputColorSpace=e===ac?zt:Ri}get useLegacyLights(){return console.warn("THREE.WebGLRenderer: The property .useLegacyLights has been deprecated. Migrate your lighting according to the following guide: https://discourse.threejs.org/t/updates-to-lighting-in-three-js-r155/53733."),this._useLegacyLights}set useLegacyLights(e){console.warn("THREE.WebGLRenderer: The property .useLegacyLights has been deprecated. Migrate your lighting according to the following guide: https://discourse.threejs.org/t/updates-to-lighting-in-three-js-r155/53733."),this._useLegacyLights=e}}class _2 extends Rl{}_2.prototype.isWebGL1Renderer=!0;class P_{constructor(e,t=25e-5){this.isFogExp2=!0,this.name="",this.color=new ye(e),this.density=t}clone(){return new P_(this.color,this.density)}toJSON(){return{type:"FogExp2",name:this.name,color:this.color.getHex(),density:this.density}}}let CM=class x2{constructor(e,t=1,i=1e3){this.isFog=!0,this.name="",this.color=new ye(e),this.near=t,this.far=i}clone(){return new x2(this.color,this.near,this.far)}toJSON(){return{type:"Fog",name:this.name,color:this.color.getHex(),near:this.near,far:this.far}}};class Ws extends ge{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),e.background!==null&&(this.background=e.background.clone()),e.environment!==null&&(this.environment=e.environment.clone()),e.fog!==null&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,this.backgroundIntensity=e.backgroundIntensity,e.overrideMaterial!==null&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const t=super.toJSON(e);return this.fog!==null&&(t.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(t.object.backgroundBlurriness=this.backgroundBlurriness),this.backgroundIntensity!==1&&(t.object.backgroundIntensity=this.backgroundIntensity),t}}class zA{constructor(e,t){this.isInterleavedBuffer=!0,this.array=e,this.stride=t,this.count=e!==void 0?e.length/t:0,this.usage=Jg,this._updateRange={offset:0,count:-1},this.updateRanges=[],this.version=0,this.uuid=to()}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}get updateRange(){return Xu("THREE.InterleavedBuffer: updateRange() is deprecated and will be removed in r169. Use addUpdateRange() instead."),this._updateRange}setUsage(e){return this.usage=e,this}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,t,i){e*=this.stride,i*=t.stride;for(let s=0,r=this.stride;s<r;s++)this.array[e+s]=t.array[i+s];return this}set(e,t=0){return this.array.set(e,t),this}clone(e){e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=to()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const t=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),i=new this.constructor(t,this.stride);return i.setUsage(this.usage),i}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=to()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const tr=new w;class pr{constructor(e,t,i,s=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=e,this.itemSize=t,this.offset=i,this.normalized=s}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let t=0,i=this.data.count;t<i;t++)tr.fromBufferAttribute(this,t),tr.applyMatrix4(e),this.setXYZ(t,tr.x,tr.y,tr.z);return this}applyNormalMatrix(e){for(let t=0,i=this.count;t<i;t++)tr.fromBufferAttribute(this,t),tr.applyNormalMatrix(e),this.setXYZ(t,tr.x,tr.y,tr.z);return this}transformDirection(e){for(let t=0,i=this.count;t<i;t++)tr.fromBufferAttribute(this,t),tr.transformDirection(e),this.setXYZ(t,tr.x,tr.y,tr.z);return this}getComponent(e,t){let i=this.array[e*this.data.stride+this.offset+t];return this.normalized&&(i=ur(i,this.array)),i}setComponent(e,t,i){return this.normalized&&(i=Vt(i,this.array)),this.data.array[e*this.data.stride+this.offset+t]=i,this}setX(e,t){return this.normalized&&(t=Vt(t,this.array)),this.data.array[e*this.data.stride+this.offset]=t,this}setY(e,t){return this.normalized&&(t=Vt(t,this.array)),this.data.array[e*this.data.stride+this.offset+1]=t,this}setZ(e,t){return this.normalized&&(t=Vt(t,this.array)),this.data.array[e*this.data.stride+this.offset+2]=t,this}setW(e,t){return this.normalized&&(t=Vt(t,this.array)),this.data.array[e*this.data.stride+this.offset+3]=t,this}getX(e){let t=this.data.array[e*this.data.stride+this.offset];return this.normalized&&(t=ur(t,this.array)),t}getY(e){let t=this.data.array[e*this.data.stride+this.offset+1];return this.normalized&&(t=ur(t,this.array)),t}getZ(e){let t=this.data.array[e*this.data.stride+this.offset+2];return this.normalized&&(t=ur(t,this.array)),t}getW(e){let t=this.data.array[e*this.data.stride+this.offset+3];return this.normalized&&(t=ur(t,this.array)),t}setXY(e,t,i){return e=e*this.data.stride+this.offset,this.normalized&&(t=Vt(t,this.array),i=Vt(i,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=i,this}setXYZ(e,t,i,s){return e=e*this.data.stride+this.offset,this.normalized&&(t=Vt(t,this.array),i=Vt(i,this.array),s=Vt(s,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=i,this.data.array[e+2]=s,this}setXYZW(e,t,i,s,r){return e=e*this.data.stride+this.offset,this.normalized&&(t=Vt(t,this.array),i=Vt(i,this.array),s=Vt(s,this.array),r=Vt(r,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=i,this.data.array[e+2]=s,this.data.array[e+3]=r,this}clone(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");const t=[];for(let i=0;i<this.count;i++){const s=i*this.data.stride+this.offset;for(let r=0;r<this.itemSize;r++)t.push(this.data.array[s+r])}return new it(new this.array.constructor(t),this.itemSize,this.normalized)}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new pr(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");const t=[];for(let i=0;i<this.count;i++){const s=i*this.data.stride+this.offset;for(let r=0;r<this.itemSize;r++)t.push(this.data.array[s+r])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}class EM extends Ot{constructor(e){super(),this.isSpriteMaterial=!0,this.type="SpriteMaterial",this.color=new ye(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}let ef;const dm=new w,tf=new w,nf=new w,sf=new ie,fm=new ie,w2=new Ce,iy=new w,pm=new w,ny=new w,aP=new ie,Xw=new ie,cP=new ie;let S2=class extends ge{constructor(e=new EM){if(super(),this.isSprite=!0,this.type="Sprite",ef===void 0){ef=new gt;const t=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),i=new zA(t,5);ef.setIndex([0,1,2,0,2,3]),ef.setAttribute("position",new pr(i,3,0,!1)),ef.setAttribute("uv",new pr(i,2,3,!1))}this.geometry=ef,this.material=e,this.center=new ie(.5,.5)}raycast(e,t){e.camera===null&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),tf.setFromMatrixScale(this.matrixWorld),w2.copy(e.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(e.camera.matrixWorldInverse,this.matrixWorld),nf.setFromMatrixPosition(this.modelViewMatrix),e.camera.isPerspectiveCamera&&this.material.sizeAttenuation===!1&&tf.multiplyScalar(-nf.z);const i=this.material.rotation;let s,r;i!==0&&(r=Math.cos(i),s=Math.sin(i));const o=this.center;sy(iy.set(-.5,-.5,0),nf,o,tf,s,r),sy(pm.set(.5,-.5,0),nf,o,tf,s,r),sy(ny.set(.5,.5,0),nf,o,tf,s,r),aP.set(0,0),Xw.set(1,0),cP.set(1,1);let a=e.ray.intersectTriangle(iy,pm,ny,!1,dm);if(a===null&&(sy(pm.set(-.5,.5,0),nf,o,tf,s,r),Xw.set(0,1),a=e.ray.intersectTriangle(iy,ny,pm,!1,dm),a===null))return;const c=e.ray.origin.distanceTo(dm);c<e.near||c>e.far||t.push({distance:c,point:dm.clone(),uv:dr.getInterpolation(dm,iy,pm,ny,aP,Xw,cP,new ie),face:null,object:this})}copy(e,t){return super.copy(e,t),e.center!==void 0&&this.center.copy(e.center),this.material=e.material,this}};function sy(n,e,t,i,s,r){sf.subVectors(n,t).addScalar(.5).multiply(i),s!==void 0?(fm.x=r*sf.x-s*sf.y,fm.y=s*sf.x+r*sf.y):fm.copy(sf),n.copy(e),n.x+=fm.x,n.y+=fm.y,n.applyMatrix4(w2)}const ry=new w,lP=new w;let TM=class extends ge{constructor(){super(),this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]},isLOD:{value:!0}}),this.autoUpdate=!0}copy(e){super.copy(e,!1);const t=e.levels;for(let i=0,s=t.length;i<s;i++){const r=t[i];this.addLevel(r.object.clone(),r.distance,r.hysteresis)}return this.autoUpdate=e.autoUpdate,this}addLevel(e,t=0,i=0){t=Math.abs(t);const s=this.levels;let r;for(r=0;r<s.length&&!(t<s[r].distance);r++);return s.splice(r,0,{distance:t,hysteresis:i,object:e}),this.add(e),this}getCurrentLevel(){return this._currentLevel}getObjectForDistance(e){const t=this.levels;if(t.length>0){let i,s;for(i=1,s=t.length;i<s;i++){let r=t[i].distance;if(t[i].object.visible&&(r-=r*t[i].hysteresis),e<r)break}return t[i-1].object}return null}raycast(e,t){if(this.levels.length>0){ry.setFromMatrixPosition(this.matrixWorld);const s=e.ray.origin.distanceTo(ry);this.getObjectForDistance(s).raycast(e,t)}}update(e){const t=this.levels;if(t.length>1){ry.setFromMatrixPosition(e.matrixWorld),lP.setFromMatrixPosition(this.matrixWorld);const i=ry.distanceTo(lP)/e.zoom;t[0].object.visible=!0;let s,r;for(s=1,r=t.length;s<r;s++){let o=t[s].distance;if(t[s].object.visible&&(o-=o*t[s].hysteresis),i>=o)t[s-1].object.visible=!1,t[s].object.visible=!0;else break}for(this._currentLevel=s-1;s<r;s++)t[s].object.visible=!1}}toJSON(e){const t=super.toJSON(e);this.autoUpdate===!1&&(t.object.autoUpdate=!1),t.object.levels=[];const i=this.levels;for(let s=0,r=i.length;s<r;s++){const o=i[s];t.object.levels.push({object:o.object.uuid,distance:o.distance,hysteresis:o.hysteresis})}return t}};const hP=new w,uP=new tt,dP=new tt,_5=new w,fP=new Ce,oy=new w,Yw=new Mn,pP=new Ce,Jw=new ro;class cc extends me{constructor(e,t){super(e,t),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode=WC,this.bindMatrix=new Ce,this.bindMatrixInverse=new Ce,this.boundingBox=null,this.boundingSphere=null}computeBoundingBox(){const e=this.geometry;this.boundingBox===null&&(this.boundingBox=new Mi),this.boundingBox.makeEmpty();const t=e.getAttribute("position");for(let i=0;i<t.count;i++)this.getVertexPosition(i,oy),this.boundingBox.expandByPoint(oy)}computeBoundingSphere(){const e=this.geometry;this.boundingSphere===null&&(this.boundingSphere=new Mn),this.boundingSphere.makeEmpty();const t=e.getAttribute("position");for(let i=0;i<t.count;i++)this.getVertexPosition(i,oy),this.boundingSphere.expandByPoint(oy)}copy(e,t){return super.copy(e,t),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),this}raycast(e,t){const i=this.material,s=this.matrixWorld;i!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),Yw.copy(this.boundingSphere),Yw.applyMatrix4(s),e.ray.intersectsSphere(Yw)!==!1&&(pP.copy(s).invert(),Jw.copy(e.ray).applyMatrix4(pP),!(this.boundingBox!==null&&Jw.intersectsBox(this.boundingBox)===!1)&&this._computeIntersections(e,t,Jw)))}getVertexPosition(e,t){return super.getVertexPosition(e,t),this.applyBoneTransform(e,t),t}bind(e,t){this.skeleton=e,t===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.copy(t).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const e=new tt,t=this.geometry.attributes.skinWeight;for(let i=0,s=t.count;i<s;i++){e.fromBufferAttribute(t,i);const r=1/e.manhattanLength();r!==1/0?e.multiplyScalar(r):e.set(1,0,0,0),t.setXYZW(i,e.x,e.y,e.z,e.w)}}updateMatrixWorld(e){super.updateMatrixWorld(e),this.bindMode===WC?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode===BL?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}applyBoneTransform(e,t){const i=this.skeleton,s=this.geometry;uP.fromBufferAttribute(s.attributes.skinIndex,e),dP.fromBufferAttribute(s.attributes.skinWeight,e),hP.copy(t).applyMatrix4(this.bindMatrix),t.set(0,0,0);for(let r=0;r<4;r++){const o=dP.getComponent(r);if(o!==0){const a=uP.getComponent(r);fP.multiplyMatrices(i.bones[a].matrixWorld,i.boneInverses[a]),t.addScaledVector(_5.copy(hP).applyMatrix4(fP),o)}}return t.applyMatrix4(this.bindMatrixInverse)}}class GA extends ge{constructor(){super(),this.isBone=!0,this.type="Bone"}}class io extends Ft{constructor(e=null,t=1,i=1,s,r,o,a,c,l=Nt,h=Nt,d,f){super(null,o,a,c,l,h,s,r,d,f),this.isDataTexture=!0,this.image={data:e,width:t,height:i},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}const mP=new Ce,x5=new Ce;class Ip{constructor(e=[],t=[]){this.uuid=to(),this.bones=e.slice(0),this.boneInverses=t,this.boneMatrices=null,this.boneTexture=null,this.init()}init(){const e=this.bones,t=this.boneInverses;if(this.boneMatrices=new Float32Array(e.length*16),t.length===0)this.calculateInverses();else if(e.length!==t.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let i=0,s=this.bones.length;i<s;i++)this.boneInverses.push(new Ce)}}calculateInverses(){this.boneInverses.length=0;for(let e=0,t=this.bones.length;e<t;e++){const i=new Ce;this.bones[e]&&i.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(i)}}pose(){for(let e=0,t=this.bones.length;e<t;e++){const i=this.bones[e];i&&i.matrixWorld.copy(this.boneInverses[e]).invert()}for(let e=0,t=this.bones.length;e<t;e++){const i=this.bones[e];i&&(i.parent&&i.parent.isBone?(i.matrix.copy(i.parent.matrixWorld).invert(),i.matrix.multiply(i.matrixWorld)):i.matrix.copy(i.matrixWorld),i.matrix.decompose(i.position,i.quaternion,i.scale))}}update(){const e=this.bones,t=this.boneInverses,i=this.boneMatrices,s=this.boneTexture;for(let r=0,o=e.length;r<o;r++){const a=e[r]?e[r].matrixWorld:x5;mP.multiplyMatrices(a,t[r]),mP.toArray(i,r*16)}s!==null&&(s.needsUpdate=!0)}clone(){return new Ip(this.bones,this.boneInverses)}computeBoneTexture(){let e=Math.sqrt(this.bones.length*4);e=Math.ceil(e/4)*4,e=Math.max(e,4);const t=new Float32Array(e*e*4);t.set(this.boneMatrices);const i=new io(t,e,e,xi,Ji);return i.needsUpdate=!0,this.boneMatrices=t,this.boneTexture=i,this}getBoneByName(e){for(let t=0,i=this.bones.length;t<i;t++){const s=this.bones[t];if(s.name===e)return s}}dispose(){this.boneTexture!==null&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(e,t){this.uuid=e.uuid;for(let i=0,s=e.bones.length;i<s;i++){const r=e.bones[i];let o=t[r];o===void 0&&(console.warn("THREE.Skeleton: No bone found with UUID:",r),o=new GA),this.bones.push(o),this.boneInverses.push(new Ce().fromArray(e.boneInverses[i]))}return this.init(),this}toJSON(){const e={metadata:{version:4.6,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};e.uuid=this.uuid;const t=this.bones,i=this.boneInverses;for(let s=0,r=t.length;s<r;s++){const o=t[s];e.bones.push(o.uuid);const a=i[s];e.boneInverses.push(a.toArray())}return e}}class Or extends it{constructor(e,t,i,s=1){super(e,t,i),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=s}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){const e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}const rf=new Ce,gP=new Ce,ay=[],AP=new Mi,w5=new Ce,mm=new me,gm=new Mn;class B_ extends me{constructor(e,t,i){super(e,t),this.isInstancedMesh=!0,this.instanceMatrix=new Or(new Float32Array(i*16),16),this.instanceColor=null,this.count=i,this.boundingBox=null,this.boundingSphere=null;for(let s=0;s<i;s++)this.setMatrixAt(s,w5)}computeBoundingBox(){const e=this.geometry,t=this.count;this.boundingBox===null&&(this.boundingBox=new Mi),e.boundingBox===null&&e.computeBoundingBox(),this.boundingBox.makeEmpty();for(let i=0;i<t;i++)this.getMatrixAt(i,rf),AP.copy(e.boundingBox).applyMatrix4(rf),this.boundingBox.union(AP)}computeBoundingSphere(){const e=this.geometry,t=this.count;this.boundingSphere===null&&(this.boundingSphere=new Mn),e.boundingSphere===null&&e.computeBoundingSphere(),this.boundingSphere.makeEmpty();for(let i=0;i<t;i++)this.getMatrixAt(i,rf),gm.copy(e.boundingSphere).applyMatrix4(rf),this.boundingSphere.union(gm)}copy(e,t){return super.copy(e,t),this.instanceMatrix.copy(e.instanceMatrix),e.instanceColor!==null&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),this}getColorAt(e,t){t.fromArray(this.instanceColor.array,e*3)}getMatrixAt(e,t){t.fromArray(this.instanceMatrix.array,e*16)}raycast(e,t){const i=this.matrixWorld,s=this.count;if(mm.geometry=this.geometry,mm.material=this.material,mm.material!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),gm.copy(this.boundingSphere),gm.applyMatrix4(i),e.ray.intersectsSphere(gm)!==!1))for(let r=0;r<s;r++){this.getMatrixAt(r,rf),gP.multiplyMatrices(i,rf),mm.matrixWorld=gP,mm.raycast(e,ay);for(let o=0,a=ay.length;o<a;o++){const c=ay[o];c.instanceId=r,c.object=this,t.push(c)}ay.length=0}}setColorAt(e,t){this.instanceColor===null&&(this.instanceColor=new Or(new Float32Array(this.instanceMatrix.count*3),3)),t.toArray(this.instanceColor.array,e*3)}setMatrixAt(e,t){t.toArray(this.instanceMatrix.array,e*16)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"})}}function S5(n,e){return n.z-e.z}function C5(n,e){return e.z-n.z}class E5{constructor(){this.index=0,this.pool=[],this.list=[]}push(e,t){const i=this.pool,s=this.list;this.index>=i.length&&i.push({start:-1,count:-1,z:-1});const r=i[this.index];s.push(r),this.index++,r.start=e.start,r.count=e.count,r.z=t}reset(){this.list.length=0,this.index=0}}const of="batchId",Jl=new Ce,vP=new Ce,T5=new Ce,yP=new Ce,Kw=new UA,cy=new Mi,hu=new Mn,Am=new w,Zw=new E5,Os=new me,ly=[];function M5(n,e,t=0){const i=e.itemSize;if(n.isInterleavedBufferAttribute||n.array.constructor!==e.array.constructor){const s=n.count;for(let r=0;r<s;r++)for(let o=0;o<i;o++)e.setComponent(r+t,o,n.getComponent(r,o))}else e.array.set(n.array,t*i);e.needsUpdate=!0}class C2 extends me{get maxGeometryCount(){return this._maxGeometryCount}constructor(e,t,i=t*2,s){super(new gt,s),this.isBatchedMesh=!0,this.perObjectFrustumCulled=!0,this.sortObjects=!0,this.boundingBox=null,this.boundingSphere=null,this.customSort=null,this._drawRanges=[],this._reservedRanges=[],this._visibility=[],this._active=[],this._bounds=[],this._maxGeometryCount=e,this._maxVertexCount=t,this._maxIndexCount=i,this._geometryInitialized=!1,this._geometryCount=0,this._multiDrawCounts=new Int32Array(e),this._multiDrawStarts=new Int32Array(e),this._multiDrawCount=0,this._visibilityChanged=!0,this._matricesTexture=null,this._initMatricesTexture()}_initMatricesTexture(){let e=Math.sqrt(this._maxGeometryCount*4);e=Math.ceil(e/4)*4,e=Math.max(e,4);const t=new Float32Array(e*e*4),i=new io(t,e,e,xi,Ji);this._matricesTexture=i}_initializeGeometry(e){const t=this.geometry,i=this._maxVertexCount,s=this._maxGeometryCount,r=this._maxIndexCount;if(this._geometryInitialized===!1){for(const a in e.attributes){const c=e.getAttribute(a),{array:l,itemSize:h,normalized:d}=c,f=new l.constructor(i*h),p=new c.constructor(f,h,d);p.setUsage(c.usage),t.setAttribute(a,p)}if(e.getIndex()!==null){const a=i>65536?new Uint32Array(r):new Uint16Array(r);t.setIndex(new it(a,1))}const o=s>65536?new Uint32Array(i):new Uint16Array(i);t.setAttribute(of,new it(o,1)),this._geometryInitialized=!0}}_validateGeometry(e){if(e.getAttribute(of))throw new Error(`BatchedMesh: Geometry cannot use attribute "${of}"`);const t=this.geometry;if(!!e.getIndex()!=!!t.getIndex())throw new Error('BatchedMesh: All geometries must consistently have "index".');for(const i in t.attributes){if(i===of)continue;if(!e.hasAttribute(i))throw new Error(`BatchedMesh: Added geometry missing "${i}". All geometries must have consistent attributes.`);const s=e.getAttribute(i),r=t.getAttribute(i);if(s.itemSize!==r.itemSize||s.normalized!==r.normalized)throw new Error("BatchedMesh: All attributes must have a consistent itemSize and normalized value.")}}setCustomSort(e){return this.customSort=e,this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Mi);const e=this._geometryCount,t=this.boundingBox,i=this._active;t.makeEmpty();for(let s=0;s<e;s++)i[s]!==!1&&(this.getMatrixAt(s,Jl),this.getBoundingBoxAt(s,cy).applyMatrix4(Jl),t.union(cy))}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Mn);const e=this._geometryCount,t=this.boundingSphere,i=this._active;t.makeEmpty();for(let s=0;s<e;s++)i[s]!==!1&&(this.getMatrixAt(s,Jl),this.getBoundingSphereAt(s,hu).applyMatrix4(Jl),t.union(hu))}addGeometry(e,t=-1,i=-1){if(this._initializeGeometry(e),this._validateGeometry(e),this._geometryCount>=this._maxGeometryCount)throw new Error("BatchedMesh: Maximum geometry count reached.");const s={vertexStart:-1,vertexCount:-1,indexStart:-1,indexCount:-1};let r=null;const o=this._reservedRanges,a=this._drawRanges,c=this._bounds;this._geometryCount!==0&&(r=o[o.length-1]),t===-1?s.vertexCount=e.getAttribute("position").count:s.vertexCount=t,r===null?s.vertexStart=0:s.vertexStart=r.vertexStart+r.vertexCount;const l=e.getIndex(),h=l!==null;if(h&&(i===-1?s.indexCount=l.count:s.indexCount=i,r===null?s.indexStart=0:s.indexStart=r.indexStart+r.indexCount),s.indexStart!==-1&&s.indexStart+s.indexCount>this._maxIndexCount||s.vertexStart+s.vertexCount>this._maxVertexCount)throw new Error("BatchedMesh: Reserved space request exceeds the maximum buffer size.");const d=this._visibility,f=this._active,p=this._matricesTexture,m=this._matricesTexture.image.data;d.push(!0),f.push(!0);const g=this._geometryCount;this._geometryCount++,T5.toArray(m,g*16),p.needsUpdate=!0,o.push(s),a.push({start:h?s.indexStart:s.vertexStart,count:-1}),c.push({boxInitialized:!1,box:new Mi,sphereInitialized:!1,sphere:new Mn});const y=this.geometry.getAttribute(of);for(let A=0;A<s.vertexCount;A++)y.setX(s.vertexStart+A,g);return y.needsUpdate=!0,this.setGeometryAt(g,e),g}setGeometryAt(e,t){if(e>=this._geometryCount)throw new Error("BatchedMesh: Maximum geometry count reached.");this._validateGeometry(t);const i=this.geometry,s=i.getIndex()!==null,r=i.getIndex(),o=t.getIndex(),a=this._reservedRanges[e];if(s&&o.count>a.indexCount||t.attributes.position.count>a.vertexCount)throw new Error("BatchedMesh: Reserved space not large enough for provided geometry.");const c=a.vertexStart,l=a.vertexCount;for(const p in i.attributes){if(p===of)continue;const m=t.getAttribute(p),g=i.getAttribute(p);M5(m,g,c);const y=m.itemSize;for(let A=m.count,v=l;A<v;A++){const b=c+A;for(let _=0;_<y;_++)g.setComponent(b,_,0)}g.needsUpdate=!0}if(s){const p=a.indexStart;for(let m=0;m<o.count;m++)r.setX(p+m,c+o.getX(m));for(let m=o.count,g=a.indexCount;m<g;m++)r.setX(p+m,c);r.needsUpdate=!0}const h=this._bounds[e];t.boundingBox!==null?(h.box.copy(t.boundingBox),h.boxInitialized=!0):h.boxInitialized=!1,t.boundingSphere!==null?(h.sphere.copy(t.boundingSphere),h.sphereInitialized=!0):h.sphereInitialized=!1;const d=this._drawRanges[e],f=t.getAttribute("position");return d.count=s?o.count:f.count,this._visibilityChanged=!0,e}deleteGeometry(e){const t=this._active;return e>=t.length||t[e]===!1?this:(t[e]=!1,this._visibilityChanged=!0,this)}getBoundingBoxAt(e,t){if(this._active[e]===!1)return null;const s=this._bounds[e],r=s.box,o=this.geometry;if(s.boxInitialized===!1){r.makeEmpty();const a=o.index,c=o.attributes.position,l=this._drawRanges[e];for(let h=l.start,d=l.start+l.count;h<d;h++){let f=h;a&&(f=a.getX(f)),r.expandByPoint(Am.fromBufferAttribute(c,f))}s.boxInitialized=!0}return t.copy(r),t}getBoundingSphereAt(e,t){if(this._active[e]===!1)return null;const s=this._bounds[e],r=s.sphere,o=this.geometry;if(s.sphereInitialized===!1){r.makeEmpty(),this.getBoundingBoxAt(e,cy),cy.getCenter(r.center);const a=o.index,c=o.attributes.position,l=this._drawRanges[e];let h=0;for(let d=l.start,f=l.start+l.count;d<f;d++){let p=d;a&&(p=a.getX(p)),Am.fromBufferAttribute(c,p),h=Math.max(h,r.center.distanceToSquared(Am))}r.radius=Math.sqrt(h),s.sphereInitialized=!0}return t.copy(r),t}setMatrixAt(e,t){const i=this._active,s=this._matricesTexture,r=this._matricesTexture.image.data,o=this._geometryCount;return e>=o||i[e]===!1?this:(t.toArray(r,e*16),s.needsUpdate=!0,this)}getMatrixAt(e,t){const i=this._active,s=this._matricesTexture.image.data,r=this._geometryCount;return e>=r||i[e]===!1?null:t.fromArray(s,e*16)}setVisibleAt(e,t){const i=this._visibility,s=this._active,r=this._geometryCount;return e>=r||s[e]===!1||i[e]===t?this:(i[e]=t,this._visibilityChanged=!0,this)}getVisibleAt(e){const t=this._visibility,i=this._active,s=this._geometryCount;return e>=s||i[e]===!1?!1:t[e]}raycast(e,t){const i=this._visibility,s=this._active,r=this._drawRanges,o=this._geometryCount,a=this.matrixWorld,c=this.geometry;Os.material=this.material,Os.geometry.index=c.index,Os.geometry.attributes=c.attributes,Os.geometry.boundingBox===null&&(Os.geometry.boundingBox=new Mi),Os.geometry.boundingSphere===null&&(Os.geometry.boundingSphere=new Mn);for(let l=0;l<o;l++){if(!i[l]||!s[l])continue;const h=r[l];Os.geometry.setDrawRange(h.start,h.count),this.getMatrixAt(l,Os.matrixWorld).premultiply(a),this.getBoundingBoxAt(l,Os.geometry.boundingBox),this.getBoundingSphereAt(l,Os.geometry.boundingSphere),Os.raycast(e,ly);for(let d=0,f=ly.length;d<f;d++){const p=ly[d];p.object=this,p.batchId=l,t.push(p)}ly.length=0}Os.material=null,Os.geometry.index=null,Os.geometry.attributes={},Os.geometry.setDrawRange(0,1/0)}copy(e){return super.copy(e),this.geometry=e.geometry.clone(),this.perObjectFrustumCulled=e.perObjectFrustumCulled,this.sortObjects=e.sortObjects,this.boundingBox=e.boundingBox!==null?e.boundingBox.clone():null,this.boundingSphere=e.boundingSphere!==null?e.boundingSphere.clone():null,this._drawRanges=e._drawRanges.map(t=>({...t})),this._reservedRanges=e._reservedRanges.map(t=>({...t})),this._visibility=e._visibility.slice(),this._active=e._active.slice(),this._bounds=e._bounds.map(t=>({boxInitialized:t.boxInitialized,box:t.box.clone(),sphereInitialized:t.sphereInitialized,sphere:t.sphere.clone()})),this._maxGeometryCount=e._maxGeometryCount,this._maxVertexCount=e._maxVertexCount,this._maxIndexCount=e._maxIndexCount,this._geometryInitialized=e._geometryInitialized,this._geometryCount=e._geometryCount,this._multiDrawCounts=e._multiDrawCounts.slice(),this._multiDrawStarts=e._multiDrawStarts.slice(),this._matricesTexture=e._matricesTexture.clone(),this._matricesTexture.image.data=this._matricesTexture.image.slice(),this}dispose(){return this.geometry.dispose(),this._matricesTexture.dispose(),this._matricesTexture=null,this}onBeforeRender(e,t,i,s,r){if(!this._visibilityChanged&&!this.perObjectFrustumCulled&&!this.sortObjects)return;const o=s.getIndex(),a=o===null?1:o.array.BYTES_PER_ELEMENT,c=this._active,l=this._visibility,h=this._multiDrawStarts,d=this._multiDrawCounts,f=this._drawRanges,p=this.perObjectFrustumCulled;p&&(yP.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse).multiply(this.matrixWorld),Kw.setFromProjectionMatrix(yP,e.coordinateSystem));let m=0;if(this.sortObjects){vP.copy(this.matrixWorld).invert(),Am.setFromMatrixPosition(i.matrixWorld).applyMatrix4(vP);for(let A=0,v=l.length;A<v;A++)if(l[A]&&c[A]){this.getMatrixAt(A,Jl),this.getBoundingSphereAt(A,hu).applyMatrix4(Jl);let b=!1;if(p&&(b=!Kw.intersectsSphere(hu)),!b){const _=Am.distanceTo(hu.center);Zw.push(f[A],_)}}const g=Zw.list,y=this.customSort;y===null?g.sort(r.transparent?C5:S5):y.call(this,g,i);for(let A=0,v=g.length;A<v;A++){const b=g[A];h[m]=b.start*a,d[m]=b.count,m++}Zw.reset()}else for(let g=0,y=l.length;g<y;g++)if(l[g]&&c[g]){let A=!1;if(p&&(this.getMatrixAt(g,Jl),this.getBoundingSphereAt(g,hu).applyMatrix4(Jl),A=!Kw.intersectsSphere(hu)),!A){const v=f[g];h[m]=v.start*a,d[m]=v.count,m++}}this._multiDrawCount=m,this._visibilityChanged=!1}onBeforeShadow(e,t,i,s,r,o){this.onBeforeRender(e,null,s,r,o)}}class Ln extends Ot{constructor(e){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new ye(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.occlusion=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.fog=e.fog,this.occlusion=e.occlusion,this}}const bP=new w,_P=new w,xP=new Ce,$w=new ro,hy=new Mn;let Sn=class extends ge{constructor(e=new gt,t=new Ln){super(),this.isLine=!0,this.type="Line",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}computeLineDistances(){const e=this.geometry;if(e.index===null){const t=e.attributes.position,i=[0];for(let s=1,r=t.count;s<r;s++)bP.fromBufferAttribute(t,s-1),_P.fromBufferAttribute(t,s),i[s]=i[s-1],i[s]+=bP.distanceTo(_P);e.setAttribute("lineDistance",new ot(i,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(e,t){const i=this.geometry,s=this.matrixWorld,r=e.params.Line.threshold,o=i.drawRange;if(i.boundingSphere===null&&i.computeBoundingSphere(),hy.copy(i.boundingSphere),hy.applyMatrix4(s),hy.radius+=r,e.ray.intersectsSphere(hy)===!1)return;xP.copy(s).invert(),$w.copy(e.ray).applyMatrix4(xP);const a=r/((this.scale.x+this.scale.y+this.scale.z)/3),c=a*a,l=new w,h=new w,d=new w,f=new w,p=this.isLineSegments?2:1,m=i.index,y=i.attributes.position;if(m!==null){const A=Math.max(0,o.start),v=Math.min(m.count,o.start+o.count);for(let b=A,_=v-1;b<_;b+=p){const T=m.getX(b),E=m.getX(b+1);if(l.fromBufferAttribute(y,T),h.fromBufferAttribute(y,E),$w.distanceSqToSegment(l,h,f,d)>c)continue;f.applyMatrix4(this.matrixWorld);const I=e.ray.origin.distanceTo(f);I<e.near||I>e.far||t.push({distance:I,point:d.clone().applyMatrix4(this.matrixWorld),index:b,face:null,faceIndex:null,object:this})}}else{const A=Math.max(0,o.start),v=Math.min(y.count,o.start+o.count);for(let b=A,_=v-1;b<_;b+=p){if(l.fromBufferAttribute(y,b),h.fromBufferAttribute(y,b+1),$w.distanceSqToSegment(l,h,f,d)>c)continue;f.applyMatrix4(this.matrixWorld);const E=e.ray.origin.distanceTo(f);E<e.near||E>e.far||t.push({distance:E,point:d.clone().applyMatrix4(this.matrixWorld),index:b,face:null,faceIndex:null,object:this})}}}updateMorphTargets(){const t=this.geometry.morphAttributes,i=Object.keys(t);if(i.length>0){const s=t[i[0]];if(s!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let r=0,o=s.length;r<o;r++){const a=s[r].name||String(r);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=r}}}}};const wP=new w,SP=new w;class Go extends Sn{constructor(e,t){super(e,t),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const e=this.geometry;if(e.index===null){const t=e.attributes.position,i=[];for(let s=0,r=t.count;s<r;s+=2)wP.fromBufferAttribute(t,s),SP.fromBufferAttribute(t,s+1),i[s]=s===0?0:i[s-1],i[s+1]=i[s]+wP.distanceTo(SP);e.setAttribute("lineDistance",new ot(i,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class MM extends Sn{constructor(e,t){super(e,t),this.isLineLoop=!0,this.type="LineLoop"}}class D_ extends Ot{constructor(e){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new ye(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.occlusion=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this.occlusion=e.occlusion,this}}const CP=new Ce,gE=new ro,uy=new Mn,dy=new w;class IM extends ge{constructor(e=new gt,t=new D_){super(),this.isPoints=!0,this.type="Points",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}raycast(e,t){const i=this.geometry,s=this.matrixWorld,r=e.params.Points.threshold,o=i.drawRange;if(i.boundingSphere===null&&i.computeBoundingSphere(),uy.copy(i.boundingSphere),uy.applyMatrix4(s),uy.radius+=r,e.ray.intersectsSphere(uy)===!1)return;CP.copy(s).invert(),gE.copy(e.ray).applyMatrix4(CP);const a=r/((this.scale.x+this.scale.y+this.scale.z)/3),c=a*a,l=i.index,d=i.attributes.position;if(l!==null){const f=Math.max(0,o.start),p=Math.min(l.count,o.start+o.count);for(let m=f,g=p;m<g;m++){const y=l.getX(m);dy.fromBufferAttribute(d,y),EP(dy,y,c,s,e,t,this)}}else{const f=Math.max(0,o.start),p=Math.min(d.count,o.start+o.count);for(let m=f,g=p;m<g;m++)dy.fromBufferAttribute(d,m),EP(dy,m,c,s,e,t,this)}}updateMorphTargets(){const t=this.geometry.morphAttributes,i=Object.keys(t);if(i.length>0){const s=t[i[0]];if(s!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let r=0,o=s.length;r<o;r++){const a=s[r].name||String(r);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=r}}}}}function EP(n,e,t,i,s,r,o){const a=gE.distanceSqToPoint(n);if(a<t){const c=new w;gE.closestPointToPoint(n,c),c.applyMatrix4(i);const l=s.ray.origin.distanceTo(c);if(l<s.near||l>s.far)return;r.push({distance:l,distanceToRay:Math.sqrt(a),point:c,index:e,face:null,object:o})}}class E2 extends Ft{constructor(e,t,i,s,r,o,a,c,l){super(e,t,i,s,r,o,a,c,l),this.isVideoTexture=!0,this.minFilter=o!==void 0?o:St,this.magFilter=r!==void 0?r:St,this.generateMipmaps=!1;const h=this;function d(){h.needsUpdate=!0,e.requestVideoFrameCallback(d)}"requestVideoFrameCallback"in e&&e.requestVideoFrameCallback(d)}clone(){return new this.constructor(this.image).copy(this)}update(){const e=this.image;"requestVideoFrameCallback"in e===!1&&e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}class I5 extends Ft{constructor(e,t){super({width:e,height:t}),this.isFramebufferTexture=!0,this.magFilter=Nt,this.minFilter=Nt,this.generateMipmaps=!1,this.needsUpdate=!0}}class lc extends Ft{constructor(e,t,i,s,r,o,a,c,l,h,d,f){super(null,o,a,c,l,h,s,r,d,f),this.isCompressedTexture=!0,this.image={width:t,height:i},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}}class T2 extends lc{constructor(e,t,i,s,r,o){super(e,t,i,r,o),this.isCompressedArrayTexture=!0,this.image.depth=s,this.wrapR=ts}}class M2 extends lc{constructor(e,t,i){super(void 0,e[0].width,e[0].height,t,i,_l),this.isCompressedCubeTexture=!0,this.isCubeTexture=!0,this.image=e}}class RM extends Ft{constructor(e,t,i,s,r,o,a,c,l){super(e,t,i,s,r,o,a,c,l),this.isCanvasTexture=!0,this.needsUpdate=!0}}class ga{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(e,t){const i=this.getUtoTmapping(e);return this.getPoint(i,t)}getPoints(e=5){const t=[];for(let i=0;i<=e;i++)t.push(this.getPoint(i/e));return t}getSpacedPoints(e=5){const t=[];for(let i=0;i<=e;i++)t.push(this.getPointAt(i/e));return t}getLength(){const e=this.getLengths();return e[e.length-1]}getLengths(e=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const t=[];let i,s=this.getPoint(0),r=0;t.push(0);for(let o=1;o<=e;o++)i=this.getPoint(o/e),r+=i.distanceTo(s),t.push(r),s=i;return this.cacheArcLengths=t,t}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e,t){const i=this.getLengths();let s=0;const r=i.length;let o;t?o=t:o=e*i[r-1];let a=0,c=r-1,l;for(;a<=c;)if(s=Math.floor(a+(c-a)/2),l=i[s]-o,l<0)a=s+1;else if(l>0)c=s-1;else{c=s;break}if(s=c,i[s]===o)return s/(r-1);const h=i[s],f=i[s+1]-h,p=(o-h)/f;return(s+p)/(r-1)}getTangent(e,t){let s=e-1e-4,r=e+1e-4;s<0&&(s=0),r>1&&(r=1);const o=this.getPoint(s),a=this.getPoint(r),c=t||(o.isVector2?new ie:new w);return c.copy(a).sub(o).normalize(),c}getTangentAt(e,t){const i=this.getUtoTmapping(e);return this.getTangent(i,t)}computeFrenetFrames(e,t){const i=new w,s=[],r=[],o=[],a=new w,c=new Ce;for(let p=0;p<=e;p++){const m=p/e;s[p]=this.getTangentAt(m,new w)}r[0]=new w,o[0]=new w;let l=Number.MAX_VALUE;const h=Math.abs(s[0].x),d=Math.abs(s[0].y),f=Math.abs(s[0].z);h<=l&&(l=h,i.set(1,0,0)),d<=l&&(l=d,i.set(0,1,0)),f<=l&&i.set(0,0,1),a.crossVectors(s[0],i).normalize(),r[0].crossVectors(s[0],a),o[0].crossVectors(s[0],r[0]);for(let p=1;p<=e;p++){if(r[p]=r[p-1].clone(),o[p]=o[p-1].clone(),a.crossVectors(s[p-1],s[p]),a.length()>Number.EPSILON){a.normalize();const m=Math.acos(pn(s[p-1].dot(s[p]),-1,1));r[p].applyMatrix4(c.makeRotationAxis(a,m))}o[p].crossVectors(s[p],r[p])}if(t===!0){let p=Math.acos(pn(r[0].dot(r[e]),-1,1));p/=e,s[0].dot(a.crossVectors(r[0],r[e]))>0&&(p=-p);for(let m=1;m<=e;m++)r[m].applyMatrix4(c.makeRotationAxis(s[m],p*m)),o[m].crossVectors(s[m],r[m])}return{tangents:s,normals:r,binormals:o}}clone(){return new this.constructor().copy(this)}copy(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}toJSON(){const e={metadata:{version:4.6,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}fromJSON(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}class O_ extends ga{constructor(e=0,t=0,i=1,s=1,r=0,o=Math.PI*2,a=!1,c=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=e,this.aY=t,this.xRadius=i,this.yRadius=s,this.aStartAngle=r,this.aEndAngle=o,this.aClockwise=a,this.aRotation=c}getPoint(e,t){const i=t||new ie,s=Math.PI*2;let r=this.aEndAngle-this.aStartAngle;const o=Math.abs(r)<Number.EPSILON;for(;r<0;)r+=s;for(;r>s;)r-=s;r<Number.EPSILON&&(o?r=0:r=s),this.aClockwise===!0&&!o&&(r===s?r=-s:r=r-s);const a=this.aStartAngle+e*r;let c=this.aX+this.xRadius*Math.cos(a),l=this.aY+this.yRadius*Math.sin(a);if(this.aRotation!==0){const h=Math.cos(this.aRotation),d=Math.sin(this.aRotation),f=c-this.aX,p=l-this.aY;c=f*h-p*d+this.aX,l=f*d+p*h+this.aY}return i.set(c,l)}copy(e){return super.copy(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}toJSON(){const e=super.toJSON();return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e}fromJSON(e){return super.fromJSON(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}}class I2 extends O_{constructor(e,t,i,s,r,o){super(e,t,i,i,s,r,o),this.isArcCurve=!0,this.type="ArcCurve"}}function PM(){let n=0,e=0,t=0,i=0;function s(r,o,a,c){n=r,e=a,t=-3*r+3*o-2*a-c,i=2*r-2*o+a+c}return{initCatmullRom:function(r,o,a,c,l){s(o,a,l*(a-r),l*(c-o))},initNonuniformCatmullRom:function(r,o,a,c,l,h,d){let f=(o-r)/l-(a-r)/(l+h)+(a-o)/h,p=(a-o)/h-(c-o)/(h+d)+(c-a)/d;f*=h,p*=h,s(o,a,f,p)},calc:function(r){const o=r*r,a=o*r;return n+e*r+t*o+i*a}}}const fy=new w,eS=new PM,tS=new PM,iS=new PM;class R2 extends ga{constructor(e=[],t=!1,i="centripetal",s=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=e,this.closed=t,this.curveType=i,this.tension=s}getPoint(e,t=new w){const i=t,s=this.points,r=s.length,o=(r-(this.closed?0:1))*e;let a=Math.floor(o),c=o-a;this.closed?a+=a>0?0:(Math.floor(Math.abs(a)/r)+1)*r:c===0&&a===r-1&&(a=r-2,c=1);let l,h;this.closed||a>0?l=s[(a-1)%r]:(fy.subVectors(s[0],s[1]).add(s[0]),l=fy);const d=s[a%r],f=s[(a+1)%r];if(this.closed||a+2<r?h=s[(a+2)%r]:(fy.subVectors(s[r-1],s[r-2]).add(s[r-1]),h=fy),this.curveType==="centripetal"||this.curveType==="chordal"){const p=this.curveType==="chordal"?.5:.25;let m=Math.pow(l.distanceToSquared(d),p),g=Math.pow(d.distanceToSquared(f),p),y=Math.pow(f.distanceToSquared(h),p);g<1e-4&&(g=1),m<1e-4&&(m=g),y<1e-4&&(y=g),eS.initNonuniformCatmullRom(l.x,d.x,f.x,h.x,m,g,y),tS.initNonuniformCatmullRom(l.y,d.y,f.y,h.y,m,g,y),iS.initNonuniformCatmullRom(l.z,d.z,f.z,h.z,m,g,y)}else this.curveType==="catmullrom"&&(eS.initCatmullRom(l.x,d.x,f.x,h.x,this.tension),tS.initCatmullRom(l.y,d.y,f.y,h.y,this.tension),iS.initCatmullRom(l.z,d.z,f.z,h.z,this.tension));return i.set(eS.calc(c),tS.calc(c),iS.calc(c)),i}copy(e){super.copy(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){const s=e.points[t];this.points.push(s.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,i=this.points.length;t<i;t++){const s=this.points[t];e.points.push(s.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){const s=e.points[t];this.points.push(new w().fromArray(s))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}}function TP(n,e,t,i,s){const r=(i-e)*.5,o=(s-t)*.5,a=n*n,c=n*a;return(2*t-2*i+r+o)*c+(-3*t+3*i-2*r-o)*a+r*n+t}function R5(n,e){const t=1-n;return t*t*e}function P5(n,e){return 2*(1-n)*n*e}function B5(n,e){return n*n*e}function sg(n,e,t,i){return R5(n,e)+P5(n,t)+B5(n,i)}function D5(n,e){const t=1-n;return t*t*t*e}function O5(n,e){const t=1-n;return 3*t*t*n*e}function k5(n,e){return 3*(1-n)*n*n*e}function L5(n,e){return n*n*n*e}function rg(n,e,t,i,s){return D5(n,e)+O5(n,t)+k5(n,i)+L5(n,s)}class BM extends ga{constructor(e=new ie,t=new ie,i=new ie,s=new ie){super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=e,this.v1=t,this.v2=i,this.v3=s}getPoint(e,t=new ie){const i=t,s=this.v0,r=this.v1,o=this.v2,a=this.v3;return i.set(rg(e,s.x,r.x,o.x,a.x),rg(e,s.y,r.y,o.y,a.y)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class P2 extends ga{constructor(e=new w,t=new w,i=new w,s=new w){super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=e,this.v1=t,this.v2=i,this.v3=s}getPoint(e,t=new w){const i=t,s=this.v0,r=this.v1,o=this.v2,a=this.v3;return i.set(rg(e,s.x,r.x,o.x,a.x),rg(e,s.y,r.y,o.y,a.y),rg(e,s.z,r.z,o.z,a.z)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class DM extends ga{constructor(e=new ie,t=new ie){super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=e,this.v2=t}getPoint(e,t=new ie){const i=t;return e===1?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(e).add(this.v1)),i}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t=new ie){return t.subVectors(this.v2,this.v1).normalize()}getTangentAt(e,t){return this.getTangent(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class B2 extends ga{constructor(e=new w,t=new w){super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=e,this.v2=t}getPoint(e,t=new w){const i=t;return e===1?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(e).add(this.v1)),i}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t=new w){return t.subVectors(this.v2,this.v1).normalize()}getTangentAt(e,t){return this.getTangent(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class OM extends ga{constructor(e=new ie,t=new ie,i=new ie){super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=e,this.v1=t,this.v2=i}getPoint(e,t=new ie){const i=t,s=this.v0,r=this.v1,o=this.v2;return i.set(sg(e,s.x,r.x,o.x),sg(e,s.y,r.y,o.y)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class kM extends ga{constructor(e=new w,t=new w,i=new w){super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=e,this.v1=t,this.v2=i}getPoint(e,t=new w){const i=t,s=this.v0,r=this.v1,o=this.v2;return i.set(sg(e,s.x,r.x,o.x),sg(e,s.y,r.y,o.y),sg(e,s.z,r.z,o.z)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class LM extends ga{constructor(e=[]){super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=e}getPoint(e,t=new ie){const i=t,s=this.points,r=(s.length-1)*e,o=Math.floor(r),a=r-o,c=s[o===0?o:o-1],l=s[o],h=s[o>s.length-2?s.length-1:o+1],d=s[o>s.length-3?s.length-1:o+2];return i.set(TP(a,c.x,l.x,h.x,d.x),TP(a,c.y,l.y,h.y,d.y)),i}copy(e){super.copy(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){const s=e.points[t];this.points.push(s.clone())}return this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,i=this.points.length;t<i;t++){const s=this.points[t];e.points.push(s.toArray())}return e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){const s=e.points[t];this.points.push(new ie().fromArray(s))}return this}}var hb=Object.freeze({__proto__:null,ArcCurve:I2,CatmullRomCurve3:R2,CubicBezierCurve:BM,CubicBezierCurve3:P2,EllipseCurve:O_,LineCurve:DM,LineCurve3:B2,QuadraticBezierCurve:OM,QuadraticBezierCurve3:kM,SplineCurve:LM});class D2 extends ga{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(e){this.curves.push(e)}closePath(){const e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);if(!e.equals(t)){const i=e.isVector2===!0?"LineCurve":"LineCurve3";this.curves.push(new hb[i](t,e))}return this}getPoint(e,t){const i=e*this.getLength(),s=this.getCurveLengths();let r=0;for(;r<s.length;){if(s[r]>=i){const o=s[r]-i,a=this.curves[r],c=a.getLength(),l=c===0?0:1-o/c;return a.getPointAt(l,t)}r++}return null}getLength(){const e=this.getCurveLengths();return e[e.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const e=[];let t=0;for(let i=0,s=this.curves.length;i<s;i++)t+=this.curves[i].getLength(),e.push(t);return this.cacheLengths=e,e}getSpacedPoints(e=40){const t=[];for(let i=0;i<=e;i++)t.push(this.getPoint(i/e));return this.autoClose&&t.push(t[0]),t}getPoints(e=12){const t=[];let i;for(let s=0,r=this.curves;s<r.length;s++){const o=r[s],a=o.isEllipseCurve?e*2:o.isLineCurve||o.isLineCurve3?1:o.isSplineCurve?e*o.points.length:e,c=o.getPoints(a);for(let l=0;l<c.length;l++){const h=c[l];i&&i.equals(h)||(t.push(h),i=h)}}return this.autoClose&&t.length>1&&!t[t.length-1].equals(t[0])&&t.push(t[0]),t}copy(e){super.copy(e),this.curves=[];for(let t=0,i=e.curves.length;t<i;t++){const s=e.curves[t];this.curves.push(s.clone())}return this.autoClose=e.autoClose,this}toJSON(){const e=super.toJSON();e.autoClose=this.autoClose,e.curves=[];for(let t=0,i=this.curves.length;t<i;t++){const s=this.curves[t];e.curves.push(s.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.autoClose=e.autoClose,this.curves=[];for(let t=0,i=e.curves.length;t<i;t++){const s=e.curves[t];this.curves.push(new hb[s.type]().fromJSON(s))}return this}}class $g extends D2{constructor(e){super(),this.type="Path",this.currentPoint=new ie,e&&this.setFromPoints(e)}setFromPoints(e){this.moveTo(e[0].x,e[0].y);for(let t=1,i=e.length;t<i;t++)this.lineTo(e[t].x,e[t].y);return this}moveTo(e,t){return this.currentPoint.set(e,t),this}lineTo(e,t){const i=new DM(this.currentPoint.clone(),new ie(e,t));return this.curves.push(i),this.currentPoint.set(e,t),this}quadraticCurveTo(e,t,i,s){const r=new OM(this.currentPoint.clone(),new ie(e,t),new ie(i,s));return this.curves.push(r),this.currentPoint.set(i,s),this}bezierCurveTo(e,t,i,s,r,o){const a=new BM(this.currentPoint.clone(),new ie(e,t),new ie(i,s),new ie(r,o));return this.curves.push(a),this.currentPoint.set(r,o),this}splineThru(e){const t=[this.currentPoint.clone()].concat(e),i=new LM(t);return this.curves.push(i),this.currentPoint.copy(e[e.length-1]),this}arc(e,t,i,s,r,o){const a=this.currentPoint.x,c=this.currentPoint.y;return this.absarc(e+a,t+c,i,s,r,o),this}absarc(e,t,i,s,r,o){return this.absellipse(e,t,i,i,s,r,o),this}ellipse(e,t,i,s,r,o,a,c){const l=this.currentPoint.x,h=this.currentPoint.y;return this.absellipse(e+l,t+h,i,s,r,o,a,c),this}absellipse(e,t,i,s,r,o,a,c){const l=new O_(e,t,i,s,r,o,a,c);if(this.curves.length>0){const d=l.getPoint(0);d.equals(this.currentPoint)||this.lineTo(d.x,d.y)}this.curves.push(l);const h=l.getPoint(1);return this.currentPoint.copy(h),this}copy(e){return super.copy(e),this.currentPoint.copy(e.currentPoint),this}toJSON(){const e=super.toJSON();return e.currentPoint=this.currentPoint.toArray(),e}fromJSON(e){return super.fromJSON(e),this.currentPoint.fromArray(e.currentPoint),this}}class VA extends gt{constructor(e=[new ie(0,-.5),new ie(.5,0),new ie(0,.5)],t=12,i=0,s=Math.PI*2){super(),this.type="LatheGeometry",this.parameters={points:e,segments:t,phiStart:i,phiLength:s},t=Math.floor(t),s=pn(s,0,Math.PI*2);const r=[],o=[],a=[],c=[],l=[],h=1/t,d=new w,f=new ie,p=new w,m=new w,g=new w;let y=0,A=0;for(let v=0;v<=e.length-1;v++)switch(v){case 0:y=e[v+1].x-e[v].x,A=e[v+1].y-e[v].y,p.x=A*1,p.y=-y,p.z=A*0,g.copy(p),p.normalize(),c.push(p.x,p.y,p.z);break;case e.length-1:c.push(g.x,g.y,g.z);break;default:y=e[v+1].x-e[v].x,A=e[v+1].y-e[v].y,p.x=A*1,p.y=-y,p.z=A*0,m.copy(p),p.x+=g.x,p.y+=g.y,p.z+=g.z,p.normalize(),c.push(p.x,p.y,p.z),g.copy(m)}for(let v=0;v<=t;v++){const b=i+v*h*s,_=Math.sin(b),T=Math.cos(b);for(let E=0;E<=e.length-1;E++){d.x=e[E].x*_,d.y=e[E].y,d.z=e[E].x*T,o.push(d.x,d.y,d.z),f.x=v/t,f.y=E/(e.length-1),a.push(f.x,f.y);const M=c[3*E+0]*_,I=c[3*E+1],S=c[3*E+0]*T;l.push(M,I,S)}}for(let v=0;v<t;v++)for(let b=0;b<e.length-1;b++){const _=b+v*e.length,T=_,E=_+e.length,M=_+e.length+1,I=_+1;r.push(T,E,I),r.push(M,I,E)}this.setIndex(r),this.setAttribute("position",new ot(o,3)),this.setAttribute("uv",new ot(a,2)),this.setAttribute("normal",new ot(l,3))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new VA(e.points,e.segments,e.phiStart,e.phiLength)}}class k_ extends VA{constructor(e=1,t=1,i=4,s=8){const r=new $g;r.absarc(0,-t/2,e,Math.PI*1.5,0),r.absarc(0,t/2,e,0,Math.PI*.5),super(r.getPoints(i),s),this.type="CapsuleGeometry",this.parameters={radius:e,length:t,capSegments:i,radialSegments:s}}static fromJSON(e){return new k_(e.radius,e.length,e.capSegments,e.radialSegments)}}class L_ extends gt{constructor(e=1,t=32,i=0,s=Math.PI*2){super(),this.type="CircleGeometry",this.parameters={radius:e,segments:t,thetaStart:i,thetaLength:s},t=Math.max(3,t);const r=[],o=[],a=[],c=[],l=new w,h=new ie;o.push(0,0,0),a.push(0,0,1),c.push(.5,.5);for(let d=0,f=3;d<=t;d++,f+=3){const p=i+d/t*s;l.x=e*Math.cos(p),l.y=e*Math.sin(p),o.push(l.x,l.y,l.z),a.push(0,0,1),h.x=(o[f]/e+1)/2,h.y=(o[f+1]/e+1)/2,c.push(h.x,h.y)}for(let d=1;d<=t;d++)r.push(d,d+1,0);this.setIndex(r),this.setAttribute("position",new ot(o,3)),this.setAttribute("normal",new ot(a,3)),this.setAttribute("uv",new ot(c,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new L_(e.radius,e.segments,e.thetaStart,e.thetaLength)}}class xn extends gt{constructor(e=1,t=1,i=1,s=32,r=1,o=!1,a=0,c=Math.PI*2){super(),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:i,radialSegments:s,heightSegments:r,openEnded:o,thetaStart:a,thetaLength:c};const l=this;s=Math.floor(s),r=Math.floor(r);const h=[],d=[],f=[],p=[];let m=0;const g=[],y=i/2;let A=0;v(),o===!1&&(e>0&&b(!0),t>0&&b(!1)),this.setIndex(h),this.setAttribute("position",new ot(d,3)),this.setAttribute("normal",new ot(f,3)),this.setAttribute("uv",new ot(p,2));function v(){const _=new w,T=new w;let E=0;const M=(t-e)/i;for(let I=0;I<=r;I++){const S=[],C=I/r,D=C*(t-e)+e;for(let G=0;G<=s;G++){const Q=G/s,L=Q*c+a,V=Math.sin(L),O=Math.cos(L);T.x=D*V,T.y=-C*i+y,T.z=D*O,d.push(T.x,T.y,T.z),_.set(V,M,O).normalize(),f.push(_.x,_.y,_.z),p.push(Q,1-C),S.push(m++)}g.push(S)}for(let I=0;I<s;I++)for(let S=0;S<r;S++){const C=g[S][I],D=g[S+1][I],G=g[S+1][I+1],Q=g[S][I+1];h.push(C,D,Q),h.push(D,G,Q),E+=6}l.addGroup(A,E,0),A+=E}function b(_){const T=m,E=new ie,M=new w;let I=0;const S=_===!0?e:t,C=_===!0?1:-1;for(let G=1;G<=s;G++)d.push(0,y*C,0),f.push(0,C,0),p.push(.5,.5),m++;const D=m;for(let G=0;G<=s;G++){const L=G/s*c+a,V=Math.cos(L),O=Math.sin(L);M.x=S*O,M.y=y*C,M.z=S*V,d.push(M.x,M.y,M.z),f.push(0,C,0),E.x=V*.5+.5,E.y=O*.5*C+.5,p.push(E.x,E.y),m++}for(let G=0;G<s;G++){const Q=T+G,L=D+G;_===!0?h.push(L,L+1,Q):h.push(L+1,L,Q),I+=3}l.addGroup(A,I,_===!0?1:2),A+=I}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new xn(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class F_ extends xn{constructor(e=1,t=1,i=32,s=1,r=!1,o=0,a=Math.PI*2){super(0,e,t,i,s,r,o,a),this.type="ConeGeometry",this.parameters={radius:e,height:t,radialSegments:i,heightSegments:s,openEnded:r,thetaStart:o,thetaLength:a}}static fromJSON(e){return new F_(e.radius,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class Yh extends gt{constructor(e=[],t=[],i=1,s=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:i,detail:s};const r=[],o=[];a(s),l(i),h(),this.setAttribute("position",new ot(r,3)),this.setAttribute("normal",new ot(r.slice(),3)),this.setAttribute("uv",new ot(o,2)),s===0?this.computeVertexNormals():this.normalizeNormals();function a(v){const b=new w,_=new w,T=new w;for(let E=0;E<t.length;E+=3)p(t[E+0],b),p(t[E+1],_),p(t[E+2],T),c(b,_,T,v)}function c(v,b,_,T){const E=T+1,M=[];for(let I=0;I<=E;I++){M[I]=[];const S=v.clone().lerp(_,I/E),C=b.clone().lerp(_,I/E),D=E-I;for(let G=0;G<=D;G++)G===0&&I===E?M[I][G]=S:M[I][G]=S.clone().lerp(C,G/D)}for(let I=0;I<E;I++)for(let S=0;S<2*(E-I)-1;S++){const C=Math.floor(S/2);S%2===0?(f(M[I][C+1]),f(M[I+1][C]),f(M[I][C])):(f(M[I][C+1]),f(M[I+1][C+1]),f(M[I+1][C]))}}function l(v){const b=new w;for(let _=0;_<r.length;_+=3)b.x=r[_+0],b.y=r[_+1],b.z=r[_+2],b.normalize().multiplyScalar(v),r[_+0]=b.x,r[_+1]=b.y,r[_+2]=b.z}function h(){const v=new w;for(let b=0;b<r.length;b+=3){v.x=r[b+0],v.y=r[b+1],v.z=r[b+2];const _=y(v)/2/Math.PI+.5,T=A(v)/Math.PI+.5;o.push(_,1-T)}m(),d()}function d(){for(let v=0;v<o.length;v+=6){const b=o[v+0],_=o[v+2],T=o[v+4],E=Math.max(b,_,T),M=Math.min(b,_,T);E>.9&&M<.1&&(b<.2&&(o[v+0]+=1),_<.2&&(o[v+2]+=1),T<.2&&(o[v+4]+=1))}}function f(v){r.push(v.x,v.y,v.z)}function p(v,b){const _=v*3;b.x=e[_+0],b.y=e[_+1],b.z=e[_+2]}function m(){const v=new w,b=new w,_=new w,T=new w,E=new ie,M=new ie,I=new ie;for(let S=0,C=0;S<r.length;S+=9,C+=6){v.set(r[S+0],r[S+1],r[S+2]),b.set(r[S+3],r[S+4],r[S+5]),_.set(r[S+6],r[S+7],r[S+8]),E.set(o[C+0],o[C+1]),M.set(o[C+2],o[C+3]),I.set(o[C+4],o[C+5]),T.copy(v).add(b).add(_).divideScalar(3);const D=y(T);g(E,C+0,v,D),g(M,C+2,b,D),g(I,C+4,_,D)}}function g(v,b,_,T){T<0&&v.x===1&&(o[b]=v.x-1),_.x===0&&_.z===0&&(o[b]=T/2/Math.PI+.5)}function y(v){return Math.atan2(v.z,-v.x)}function A(v){return Math.atan2(-v.y,Math.sqrt(v.x*v.x+v.z*v.z))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Yh(e.vertices,e.indices,e.radius,e.details)}}class U_ extends Yh{constructor(e=1,t=0){const i=(1+Math.sqrt(5))/2,s=1/i,r=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-s,-i,0,-s,i,0,s,-i,0,s,i,-s,-i,0,-s,i,0,s,-i,0,s,i,0,-i,0,-s,i,0,-s,-i,0,s,i,0,s],o=[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9];super(r,o,e,t),this.type="DodecahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new U_(e.radius,e.detail)}}const py=new w,my=new w,nS=new w,gy=new dr;class FM extends gt{constructor(e=null,t=1){if(super(),this.type="EdgesGeometry",this.parameters={geometry:e,thresholdAngle:t},e!==null){const s=Math.pow(10,4),r=Math.cos(qu*t),o=e.getIndex(),a=e.getAttribute("position"),c=o?o.count:a.count,l=[0,0,0],h=["a","b","c"],d=new Array(3),f={},p=[];for(let m=0;m<c;m+=3){o?(l[0]=o.getX(m),l[1]=o.getX(m+1),l[2]=o.getX(m+2)):(l[0]=m,l[1]=m+1,l[2]=m+2);const{a:g,b:y,c:A}=gy;if(g.fromBufferAttribute(a,l[0]),y.fromBufferAttribute(a,l[1]),A.fromBufferAttribute(a,l[2]),gy.getNormal(nS),d[0]=`${Math.round(g.x*s)},${Math.round(g.y*s)},${Math.round(g.z*s)}`,d[1]=`${Math.round(y.x*s)},${Math.round(y.y*s)},${Math.round(y.z*s)}`,d[2]=`${Math.round(A.x*s)},${Math.round(A.y*s)},${Math.round(A.z*s)}`,!(d[0]===d[1]||d[1]===d[2]||d[2]===d[0]))for(let v=0;v<3;v++){const b=(v+1)%3,_=d[v],T=d[b],E=gy[h[v]],M=gy[h[b]],I=`${_}_${T}`,S=`${T}_${_}`;S in f&&f[S]?(nS.dot(f[S].normal)<=r&&(p.push(E.x,E.y,E.z),p.push(M.x,M.y,M.z)),f[S]=null):I in f||(f[I]={index0:l[v],index1:l[b],normal:nS.clone()})}}for(const m in f)if(f[m]){const{index0:g,index1:y}=f[m];py.fromBufferAttribute(a,g),my.fromBufferAttribute(a,y),p.push(py.x,py.y,py.z),p.push(my.x,my.y,my.z)}this.setAttribute("position",new ot(p,3))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}}class Yu extends $g{constructor(e){super(e),this.uuid=to(),this.type="Shape",this.holes=[]}getPointsHoles(e){const t=[];for(let i=0,s=this.holes.length;i<s;i++)t[i]=this.holes[i].getPoints(e);return t}extractPoints(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}}copy(e){super.copy(e),this.holes=[];for(let t=0,i=e.holes.length;t<i;t++){const s=e.holes[t];this.holes.push(s.clone())}return this}toJSON(){const e=super.toJSON();e.uuid=this.uuid,e.holes=[];for(let t=0,i=this.holes.length;t<i;t++){const s=this.holes[t];e.holes.push(s.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.uuid=e.uuid,this.holes=[];for(let t=0,i=e.holes.length;t<i;t++){const s=e.holes[t];this.holes.push(new $g().fromJSON(s))}return this}}const F5={triangulate:function(n,e,t=2){const i=e&&e.length,s=i?e[0]*t:n.length;let r=O2(n,0,s,t,!0);const o=[];if(!r||r.next===r.prev)return o;let a,c,l,h,d,f,p;if(i&&(r=V5(n,e,r,t)),n.length>80*t){a=l=n[0],c=h=n[1];for(let m=t;m<s;m+=t)d=n[m],f=n[m+1],d<a&&(a=d),f<c&&(c=f),d>l&&(l=d),f>h&&(h=f);p=Math.max(l-a,h-c),p=p!==0?32767/p:0}return eA(r,o,t,a,c,p,0),o}};function O2(n,e,t,i,s){let r,o;if(s===$5(n,e,t,i)>0)for(r=e;r<t;r+=i)o=MP(r,n[r],n[r+1],o);else for(r=t-i;r>=e;r-=i)o=MP(r,n[r],n[r+1],o);return o&&N_(o,o.next)&&(iA(o),o=o.next),o}function dd(n,e){if(!n)return n;e||(e=n);let t=n,i;do if(i=!1,!t.steiner&&(N_(t,t.next)||nn(t.prev,t,t.next)===0)){if(iA(t),t=e=t.prev,t===t.next)break;i=!0}else t=t.next;while(i||t!==e);return e}function eA(n,e,t,i,s,r,o){if(!n)return;!o&&r&&q5(n,i,s,r);let a=n,c,l;for(;n.prev!==n.next;){if(c=n.prev,l=n.next,r?N5(n,i,s,r):U5(n)){e.push(c.i/t|0),e.push(n.i/t|0),e.push(l.i/t|0),iA(n),n=l.next,a=l.next;continue}if(n=l,n===a){o?o===1?(n=z5(dd(n),e,t),eA(n,e,t,i,s,r,2)):o===2&&G5(n,e,t,i,s,r):eA(dd(n),e,t,i,s,r,1);break}}}function U5(n){const e=n.prev,t=n,i=n.next;if(nn(e,t,i)>=0)return!1;const s=e.x,r=t.x,o=i.x,a=e.y,c=t.y,l=i.y,h=s<r?s<o?s:o:r<o?r:o,d=a<c?a<l?a:l:c<l?c:l,f=s>r?s>o?s:o:r>o?r:o,p=a>c?a>l?a:l:c>l?c:l;let m=i.next;for(;m!==e;){if(m.x>=h&&m.x<=f&&m.y>=d&&m.y<=p&&Rf(s,a,r,c,o,l,m.x,m.y)&&nn(m.prev,m,m.next)>=0)return!1;m=m.next}return!0}function N5(n,e,t,i){const s=n.prev,r=n,o=n.next;if(nn(s,r,o)>=0)return!1;const a=s.x,c=r.x,l=o.x,h=s.y,d=r.y,f=o.y,p=a<c?a<l?a:l:c<l?c:l,m=h<d?h<f?h:f:d<f?d:f,g=a>c?a>l?a:l:c>l?c:l,y=h>d?h>f?h:f:d>f?d:f,A=AE(p,m,e,t,i),v=AE(g,y,e,t,i);let b=n.prevZ,_=n.nextZ;for(;b&&b.z>=A&&_&&_.z<=v;){if(b.x>=p&&b.x<=g&&b.y>=m&&b.y<=y&&b!==s&&b!==o&&Rf(a,h,c,d,l,f,b.x,b.y)&&nn(b.prev,b,b.next)>=0||(b=b.prevZ,_.x>=p&&_.x<=g&&_.y>=m&&_.y<=y&&_!==s&&_!==o&&Rf(a,h,c,d,l,f,_.x,_.y)&&nn(_.prev,_,_.next)>=0))return!1;_=_.nextZ}for(;b&&b.z>=A;){if(b.x>=p&&b.x<=g&&b.y>=m&&b.y<=y&&b!==s&&b!==o&&Rf(a,h,c,d,l,f,b.x,b.y)&&nn(b.prev,b,b.next)>=0)return!1;b=b.prevZ}for(;_&&_.z<=v;){if(_.x>=p&&_.x<=g&&_.y>=m&&_.y<=y&&_!==s&&_!==o&&Rf(a,h,c,d,l,f,_.x,_.y)&&nn(_.prev,_,_.next)>=0)return!1;_=_.nextZ}return!0}function z5(n,e,t){let i=n;do{const s=i.prev,r=i.next.next;!N_(s,r)&&k2(s,i,i.next,r)&&tA(s,r)&&tA(r,s)&&(e.push(s.i/t|0),e.push(i.i/t|0),e.push(r.i/t|0),iA(i),iA(i.next),i=n=r),i=i.next}while(i!==n);return dd(i)}function G5(n,e,t,i,s,r){let o=n;do{let a=o.next.next;for(;a!==o.prev;){if(o.i!==a.i&&J5(o,a)){let c=L2(o,a);o=dd(o,o.next),c=dd(c,c.next),eA(o,e,t,i,s,r,0),eA(c,e,t,i,s,r,0);return}a=a.next}o=o.next}while(o!==n)}function V5(n,e,t,i){const s=[];let r,o,a,c,l;for(r=0,o=e.length;r<o;r++)a=e[r]*i,c=r<o-1?e[r+1]*i:n.length,l=O2(n,a,c,i,!1),l===l.next&&(l.steiner=!0),s.push(Y5(l));for(s.sort(H5),r=0;r<s.length;r++)t=Q5(s[r],t);return t}function H5(n,e){return n.x-e.x}function Q5(n,e){const t=j5(n,e);if(!t)return e;const i=L2(t,n);return dd(i,i.next),dd(t,t.next)}function j5(n,e){let t=e,i=-1/0,s;const r=n.x,o=n.y;do{if(o<=t.y&&o>=t.next.y&&t.next.y!==t.y){const f=t.x+(o-t.y)*(t.next.x-t.x)/(t.next.y-t.y);if(f<=r&&f>i&&(i=f,s=t.x<t.next.x?t:t.next,f===r))return s}t=t.next}while(t!==e);if(!s)return null;const a=s,c=s.x,l=s.y;let h=1/0,d;t=s;do r>=t.x&&t.x>=c&&r!==t.x&&Rf(o<l?r:i,o,c,l,o<l?i:r,o,t.x,t.y)&&(d=Math.abs(o-t.y)/(r-t.x),tA(t,n)&&(d<h||d===h&&(t.x>s.x||t.x===s.x&&W5(s,t)))&&(s=t,h=d)),t=t.next;while(t!==a);return s}function W5(n,e){return nn(n.prev,n,e.prev)<0&&nn(e.next,n,n.next)<0}function q5(n,e,t,i){let s=n;do s.z===0&&(s.z=AE(s.x,s.y,e,t,i)),s.prevZ=s.prev,s.nextZ=s.next,s=s.next;while(s!==n);s.prevZ.nextZ=null,s.prevZ=null,X5(s)}function X5(n){let e,t,i,s,r,o,a,c,l=1;do{for(t=n,n=null,r=null,o=0;t;){for(o++,i=t,a=0,e=0;e<l&&(a++,i=i.nextZ,!!i);e++);for(c=l;a>0||c>0&&i;)a!==0&&(c===0||!i||t.z<=i.z)?(s=t,t=t.nextZ,a--):(s=i,i=i.nextZ,c--),r?r.nextZ=s:n=s,s.prevZ=r,r=s;t=i}r.nextZ=null,l*=2}while(o>1);return n}function AE(n,e,t,i,s){return n=(n-t)*s|0,e=(e-i)*s|0,n=(n|n<<8)&16711935,n=(n|n<<4)&252645135,n=(n|n<<2)&858993459,n=(n|n<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,n|e<<1}function Y5(n){let e=n,t=n;do(e.x<t.x||e.x===t.x&&e.y<t.y)&&(t=e),e=e.next;while(e!==n);return t}function Rf(n,e,t,i,s,r,o,a){return(s-o)*(e-a)>=(n-o)*(r-a)&&(n-o)*(i-a)>=(t-o)*(e-a)&&(t-o)*(r-a)>=(s-o)*(i-a)}function J5(n,e){return n.next.i!==e.i&&n.prev.i!==e.i&&!K5(n,e)&&(tA(n,e)&&tA(e,n)&&Z5(n,e)&&(nn(n.prev,n,e.prev)||nn(n,e.prev,e))||N_(n,e)&&nn(n.prev,n,n.next)>0&&nn(e.prev,e,e.next)>0)}function nn(n,e,t){return(e.y-n.y)*(t.x-e.x)-(e.x-n.x)*(t.y-e.y)}function N_(n,e){return n.x===e.x&&n.y===e.y}function k2(n,e,t,i){const s=vy(nn(n,e,t)),r=vy(nn(n,e,i)),o=vy(nn(t,i,n)),a=vy(nn(t,i,e));return!!(s!==r&&o!==a||s===0&&Ay(n,t,e)||r===0&&Ay(n,i,e)||o===0&&Ay(t,n,i)||a===0&&Ay(t,e,i))}function Ay(n,e,t){return e.x<=Math.max(n.x,t.x)&&e.x>=Math.min(n.x,t.x)&&e.y<=Math.max(n.y,t.y)&&e.y>=Math.min(n.y,t.y)}function vy(n){return n>0?1:n<0?-1:0}function K5(n,e){let t=n;do{if(t.i!==n.i&&t.next.i!==n.i&&t.i!==e.i&&t.next.i!==e.i&&k2(t,t.next,n,e))return!0;t=t.next}while(t!==n);return!1}function tA(n,e){return nn(n.prev,n,n.next)<0?nn(n,e,n.next)>=0&&nn(n,n.prev,e)>=0:nn(n,e,n.prev)<0||nn(n,n.next,e)<0}function Z5(n,e){let t=n,i=!1;const s=(n.x+e.x)/2,r=(n.y+e.y)/2;do t.y>r!=t.next.y>r&&t.next.y!==t.y&&s<(t.next.x-t.x)*(r-t.y)/(t.next.y-t.y)+t.x&&(i=!i),t=t.next;while(t!==n);return i}function L2(n,e){const t=new vE(n.i,n.x,n.y),i=new vE(e.i,e.x,e.y),s=n.next,r=e.prev;return n.next=e,e.prev=n,t.next=s,s.prev=t,i.next=t,t.prev=i,r.next=i,i.prev=r,i}function MP(n,e,t,i){const s=new vE(n,e,t);return i?(s.next=i.next,s.prev=i,i.next.prev=s,i.next=s):(s.prev=s,s.next=s),s}function iA(n){n.next.prev=n.prev,n.prev.next=n.next,n.prevZ&&(n.prevZ.nextZ=n.nextZ),n.nextZ&&(n.nextZ.prevZ=n.prevZ)}function vE(n,e,t){this.i=n,this.x=e,this.y=t,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function $5(n,e,t,i){let s=0;for(let r=e,o=t-i;r<t;r+=i)s+=(n[o]-n[r])*(n[r+1]+n[o+1]),o=r;return s}class hc{static area(e){const t=e.length;let i=0;for(let s=t-1,r=0;r<t;s=r++)i+=e[s].x*e[r].y-e[r].x*e[s].y;return i*.5}static isClockWise(e){return hc.area(e)<0}static triangulateShape(e,t){const i=[],s=[],r=[];IP(e),RP(i,e);let o=e.length;t.forEach(IP);for(let c=0;c<t.length;c++)s.push(o),o+=t[c].length,RP(i,t[c]);const a=F5.triangulate(i,s);for(let c=0;c<a.length;c+=3)r.push(a.slice(c,c+3));return r}}function IP(n){const e=n.length;e>2&&n[e-1].equals(n[0])&&n.pop()}function RP(n,e){for(let t=0;t<e.length;t++)n.push(e[t].x),n.push(e[t].y)}class z_ extends gt{constructor(e=new Yu([new ie(.5,.5),new ie(-.5,.5),new ie(-.5,-.5),new ie(.5,-.5)]),t={}){super(),this.type="ExtrudeGeometry",this.parameters={shapes:e,options:t},e=Array.isArray(e)?e:[e];const i=this,s=[],r=[];for(let a=0,c=e.length;a<c;a++){const l=e[a];o(l)}this.setAttribute("position",new ot(s,3)),this.setAttribute("uv",new ot(r,2)),this.computeVertexNormals();function o(a){const c=[],l=t.curveSegments!==void 0?t.curveSegments:12,h=t.steps!==void 0?t.steps:1,d=t.depth!==void 0?t.depth:1;let f=t.bevelEnabled!==void 0?t.bevelEnabled:!0,p=t.bevelThickness!==void 0?t.bevelThickness:.2,m=t.bevelSize!==void 0?t.bevelSize:p-.1,g=t.bevelOffset!==void 0?t.bevelOffset:0,y=t.bevelSegments!==void 0?t.bevelSegments:3;const A=t.extrudePath,v=t.UVGenerator!==void 0?t.UVGenerator:eW;let b,_=!1,T,E,M,I;A&&(b=A.getSpacedPoints(h),_=!0,f=!1,T=A.computeFrenetFrames(h,!1),E=new w,M=new w,I=new w),f||(y=0,p=0,m=0,g=0);const S=a.extractPoints(l);let C=S.shape;const D=S.holes;if(!hc.isClockWise(C)){C=C.reverse();for(let Pe=0,X=D.length;Pe<X;Pe++){const Ae=D[Pe];hc.isClockWise(Ae)&&(D[Pe]=Ae.reverse())}}const Q=hc.triangulateShape(C,D),L=C;for(let Pe=0,X=D.length;Pe<X;Pe++){const Ae=D[Pe];C=C.concat(Ae)}function V(Pe,X,Ae){return X||console.error("THREE.ExtrudeGeometry: vec does not exist"),Pe.clone().addScaledVector(X,Ae)}const O=C.length,U=Q.length;function H(Pe,X,Ae){let ke,be,je;const ct=Pe.x-X.x,F=Pe.y-X.y,B=Ae.x-Pe.x,ce=Ae.y-Pe.y,Se=ct*ct+F*F,xe=ct*ce-F*B;if(Math.abs(xe)>Number.EPSILON){const Ie=Math.sqrt(Se),et=Math.sqrt(B*B+ce*ce),Fe=X.x-F/Ie,Ke=X.y+ct/Ie,rt=Ae.x-ce/et,At=Ae.y+B/et,Ee=((rt-Fe)*ce-(At-Ke)*B)/(ct*ce-F*B);ke=Fe+ct*Ee-Pe.x,be=Ke+F*Ee-Pe.y;const Rt=ke*ke+be*be;if(Rt<=2)return new ie(ke,be);je=Math.sqrt(Rt/2)}else{let Ie=!1;ct>Number.EPSILON?B>Number.EPSILON&&(Ie=!0):ct<-Number.EPSILON?B<-Number.EPSILON&&(Ie=!0):Math.sign(F)===Math.sign(ce)&&(Ie=!0),Ie?(ke=-F,be=ct,je=Math.sqrt(Se)):(ke=ct,be=F,je=Math.sqrt(Se/2))}return new ie(ke/je,be/je)}const Y=[];for(let Pe=0,X=L.length,Ae=X-1,ke=Pe+1;Pe<X;Pe++,Ae++,ke++)Ae===X&&(Ae=0),ke===X&&(ke=0),Y[Pe]=H(L[Pe],L[Ae],L[ke]);const J=[];let se,fe=Y.concat();for(let Pe=0,X=D.length;Pe<X;Pe++){const Ae=D[Pe];se=[];for(let ke=0,be=Ae.length,je=be-1,ct=ke+1;ke<be;ke++,je++,ct++)je===be&&(je=0),ct===be&&(ct=0),se[ke]=H(Ae[ke],Ae[je],Ae[ct]);J.push(se),fe=fe.concat(se)}for(let Pe=0;Pe<y;Pe++){const X=Pe/y,Ae=p*Math.cos(X*Math.PI/2),ke=m*Math.sin(X*Math.PI/2)+g;for(let be=0,je=L.length;be<je;be++){const ct=V(L[be],Y[be],ke);ve(ct.x,ct.y,-Ae)}for(let be=0,je=D.length;be<je;be++){const ct=D[be];se=J[be];for(let F=0,B=ct.length;F<B;F++){const ce=V(ct[F],se[F],ke);ve(ce.x,ce.y,-Ae)}}}const _e=m+g;for(let Pe=0;Pe<O;Pe++){const X=f?V(C[Pe],fe[Pe],_e):C[Pe];_?(M.copy(T.normals[0]).multiplyScalar(X.x),E.copy(T.binormals[0]).multiplyScalar(X.y),I.copy(b[0]).add(M).add(E),ve(I.x,I.y,I.z)):ve(X.x,X.y,0)}for(let Pe=1;Pe<=h;Pe++)for(let X=0;X<O;X++){const Ae=f?V(C[X],fe[X],_e):C[X];_?(M.copy(T.normals[Pe]).multiplyScalar(Ae.x),E.copy(T.binormals[Pe]).multiplyScalar(Ae.y),I.copy(b[Pe]).add(M).add(E),ve(I.x,I.y,I.z)):ve(Ae.x,Ae.y,d/h*Pe)}for(let Pe=y-1;Pe>=0;Pe--){const X=Pe/y,Ae=p*Math.cos(X*Math.PI/2),ke=m*Math.sin(X*Math.PI/2)+g;for(let be=0,je=L.length;be<je;be++){const ct=V(L[be],Y[be],ke);ve(ct.x,ct.y,d+Ae)}for(let be=0,je=D.length;be<je;be++){const ct=D[be];se=J[be];for(let F=0,B=ct.length;F<B;F++){const ce=V(ct[F],se[F],ke);_?ve(ce.x,ce.y+b[h-1].y,b[h-1].x+Ae):ve(ce.x,ce.y,d+Ae)}}}Oe(),qe();function Oe(){const Pe=s.length/3;if(f){let X=0,Ae=O*X;for(let ke=0;ke<U;ke++){const be=Q[ke];Ue(be[2]+Ae,be[1]+Ae,be[0]+Ae)}X=h+y*2,Ae=O*X;for(let ke=0;ke<U;ke++){const be=Q[ke];Ue(be[0]+Ae,be[1]+Ae,be[2]+Ae)}}else{for(let X=0;X<U;X++){const Ae=Q[X];Ue(Ae[2],Ae[1],Ae[0])}for(let X=0;X<U;X++){const Ae=Q[X];Ue(Ae[0]+O*h,Ae[1]+O*h,Ae[2]+O*h)}}i.addGroup(Pe,s.length/3-Pe,0)}function qe(){const Pe=s.length/3;let X=0;ae(L,X),X+=L.length;for(let Ae=0,ke=D.length;Ae<ke;Ae++){const be=D[Ae];ae(be,X),X+=be.length}i.addGroup(Pe,s.length/3-Pe,1)}function ae(Pe,X){let Ae=Pe.length;for(;--Ae>=0;){const ke=Ae;let be=Ae-1;be<0&&(be=Pe.length-1);for(let je=0,ct=h+y*2;je<ct;je++){const F=O*je,B=O*(je+1),ce=X+ke+F,Se=X+be+F,xe=X+be+B,Ie=X+ke+B;Ge(ce,Se,xe,Ie)}}}function ve(Pe,X,Ae){c.push(Pe),c.push(X),c.push(Ae)}function Ue(Pe,X,Ae){Xe(Pe),Xe(X),Xe(Ae);const ke=s.length/3,be=v.generateTopUV(i,s,ke-3,ke-2,ke-1);ze(be[0]),ze(be[1]),ze(be[2])}function Ge(Pe,X,Ae,ke){Xe(Pe),Xe(X),Xe(ke),Xe(X),Xe(Ae),Xe(ke);const be=s.length/3,je=v.generateSideWallUV(i,s,be-6,be-3,be-2,be-1);ze(je[0]),ze(je[1]),ze(je[3]),ze(je[1]),ze(je[2]),ze(je[3])}function Xe(Pe){s.push(c[Pe*3+0]),s.push(c[Pe*3+1]),s.push(c[Pe*3+2])}function ze(Pe){r.push(Pe.x),r.push(Pe.y)}}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON(),t=this.parameters.shapes,i=this.parameters.options;return tW(t,i,e)}static fromJSON(e,t){const i=[];for(let r=0,o=e.shapes.length;r<o;r++){const a=t[e.shapes[r]];i.push(a)}const s=e.options.extrudePath;return s!==void 0&&(e.options.extrudePath=new hb[s.type]().fromJSON(s)),new z_(i,e.options)}}const eW={generateTopUV:function(n,e,t,i,s){const r=e[t*3],o=e[t*3+1],a=e[i*3],c=e[i*3+1],l=e[s*3],h=e[s*3+1];return[new ie(r,o),new ie(a,c),new ie(l,h)]},generateSideWallUV:function(n,e,t,i,s,r){const o=e[t*3],a=e[t*3+1],c=e[t*3+2],l=e[i*3],h=e[i*3+1],d=e[i*3+2],f=e[s*3],p=e[s*3+1],m=e[s*3+2],g=e[r*3],y=e[r*3+1],A=e[r*3+2];return Math.abs(a-h)<Math.abs(o-l)?[new ie(o,1-c),new ie(l,1-d),new ie(f,1-m),new ie(g,1-A)]:[new ie(a,1-c),new ie(h,1-d),new ie(p,1-m),new ie(y,1-A)]}};function tW(n,e,t){if(t.shapes=[],Array.isArray(n))for(let i=0,s=n.length;i<s;i++){const r=n[i];t.shapes.push(r.uuid)}else t.shapes.push(n.uuid);return t.options=Object.assign({},e),e.extrudePath!==void 0&&(t.options.extrudePath=e.extrudePath.toJSON()),t}class G_ extends Yh{constructor(e=1,t=0){const i=(1+Math.sqrt(5))/2,s=[-1,i,0,1,i,0,-1,-i,0,1,-i,0,0,-1,i,0,1,i,0,-1,-i,0,1,-i,i,0,-1,i,0,1,-i,0,-1,-i,0,1],r=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1];super(s,r,e,t),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new G_(e.radius,e.detail)}}class sl extends Yh{constructor(e=1,t=0){const i=[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],s=[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2];super(i,s,e,t),this.type="OctahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new sl(e.radius,e.detail)}}class fd extends gt{constructor(e=.5,t=1,i=32,s=1,r=0,o=Math.PI*2){super(),this.type="RingGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:i,phiSegments:s,thetaStart:r,thetaLength:o},i=Math.max(3,i),s=Math.max(1,s);const a=[],c=[],l=[],h=[];let d=e;const f=(t-e)/s,p=new w,m=new ie;for(let g=0;g<=s;g++){for(let y=0;y<=i;y++){const A=r+y/i*o;p.x=d*Math.cos(A),p.y=d*Math.sin(A),c.push(p.x,p.y,p.z),l.push(0,0,1),m.x=(p.x/t+1)/2,m.y=(p.y/t+1)/2,h.push(m.x,m.y)}d+=f}for(let g=0;g<s;g++){const y=g*(i+1);for(let A=0;A<i;A++){const v=A+y,b=v,_=v+i+1,T=v+i+2,E=v+1;a.push(b,_,E),a.push(_,T,E)}}this.setIndex(a),this.setAttribute("position",new ot(c,3)),this.setAttribute("normal",new ot(l,3)),this.setAttribute("uv",new ot(h,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new fd(e.innerRadius,e.outerRadius,e.thetaSegments,e.phiSegments,e.thetaStart,e.thetaLength)}}class V_ extends gt{constructor(e=new Yu([new ie(0,.5),new ie(-.5,-.5),new ie(.5,-.5)]),t=12){super(),this.type="ShapeGeometry",this.parameters={shapes:e,curveSegments:t};const i=[],s=[],r=[],o=[];let a=0,c=0;if(Array.isArray(e)===!1)l(e);else for(let h=0;h<e.length;h++)l(e[h]),this.addGroup(a,c,h),a+=c,c=0;this.setIndex(i),this.setAttribute("position",new ot(s,3)),this.setAttribute("normal",new ot(r,3)),this.setAttribute("uv",new ot(o,2));function l(h){const d=s.length/3,f=h.extractPoints(t);let p=f.shape;const m=f.holes;hc.isClockWise(p)===!1&&(p=p.reverse());for(let y=0,A=m.length;y<A;y++){const v=m[y];hc.isClockWise(v)===!0&&(m[y]=v.reverse())}const g=hc.triangulateShape(p,m);for(let y=0,A=m.length;y<A;y++){const v=m[y];p=p.concat(v)}for(let y=0,A=p.length;y<A;y++){const v=p[y];s.push(v.x,v.y,0),r.push(0,0,1),o.push(v.x,v.y)}for(let y=0,A=g.length;y<A;y++){const v=g[y],b=v[0]+d,_=v[1]+d,T=v[2]+d;i.push(b,_,T),c+=3}}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON(),t=this.parameters.shapes;return iW(t,e)}static fromJSON(e,t){const i=[];for(let s=0,r=e.shapes.length;s<r;s++){const o=t[e.shapes[s]];i.push(o)}return new V_(i,e.curveSegments)}}function iW(n,e){if(e.shapes=[],Array.isArray(n))for(let t=0,i=n.length;t<i;t++){const s=n[t];e.shapes.push(s.uuid)}else e.shapes.push(n.uuid);return e}class Aa extends gt{constructor(e=1,t=32,i=16,s=0,r=Math.PI*2,o=0,a=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:i,phiStart:s,phiLength:r,thetaStart:o,thetaLength:a},t=Math.max(3,Math.floor(t)),i=Math.max(2,Math.floor(i));const c=Math.min(o+a,Math.PI);let l=0;const h=[],d=new w,f=new w,p=[],m=[],g=[],y=[];for(let A=0;A<=i;A++){const v=[],b=A/i;let _=0;A===0&&o===0?_=.5/t:A===i&&c===Math.PI&&(_=-.5/t);for(let T=0;T<=t;T++){const E=T/t;d.x=-e*Math.cos(s+E*r)*Math.sin(o+b*a),d.y=e*Math.cos(o+b*a),d.z=e*Math.sin(s+E*r)*Math.sin(o+b*a),m.push(d.x,d.y,d.z),f.copy(d).normalize(),g.push(f.x,f.y,f.z),y.push(E+_,1-b),v.push(l++)}h.push(v)}for(let A=0;A<i;A++)for(let v=0;v<t;v++){const b=h[A][v+1],_=h[A][v],T=h[A+1][v],E=h[A+1][v+1];(A!==0||o>0)&&p.push(b,_,E),(A!==i-1||c<Math.PI)&&p.push(_,T,E)}this.setIndex(p),this.setAttribute("position",new ot(m,3)),this.setAttribute("normal",new ot(g,3)),this.setAttribute("uv",new ot(y,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Aa(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}}class H_ extends Yh{constructor(e=1,t=0){const i=[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],s=[2,1,0,0,3,2,1,3,0,2,3,1];super(i,s,e,t),this.type="TetrahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new H_(e.radius,e.detail)}}class el extends gt{constructor(e=1,t=.4,i=12,s=48,r=Math.PI*2){super(),this.type="TorusGeometry",this.parameters={radius:e,tube:t,radialSegments:i,tubularSegments:s,arc:r},i=Math.floor(i),s=Math.floor(s);const o=[],a=[],c=[],l=[],h=new w,d=new w,f=new w;for(let p=0;p<=i;p++)for(let m=0;m<=s;m++){const g=m/s*r,y=p/i*Math.PI*2;d.x=(e+t*Math.cos(y))*Math.cos(g),d.y=(e+t*Math.cos(y))*Math.sin(g),d.z=t*Math.sin(y),a.push(d.x,d.y,d.z),h.x=e*Math.cos(g),h.y=e*Math.sin(g),f.subVectors(d,h).normalize(),c.push(f.x,f.y,f.z),l.push(m/s),l.push(p/i)}for(let p=1;p<=i;p++)for(let m=1;m<=s;m++){const g=(s+1)*p+m-1,y=(s+1)*(p-1)+m-1,A=(s+1)*(p-1)+m,v=(s+1)*p+m;o.push(g,y,v),o.push(y,A,v)}this.setIndex(o),this.setAttribute("position",new ot(a,3)),this.setAttribute("normal",new ot(c,3)),this.setAttribute("uv",new ot(l,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new el(e.radius,e.tube,e.radialSegments,e.tubularSegments,e.arc)}}class Q_ extends gt{constructor(e=1,t=.4,i=64,s=8,r=2,o=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:e,tube:t,tubularSegments:i,radialSegments:s,p:r,q:o},i=Math.floor(i),s=Math.floor(s);const a=[],c=[],l=[],h=[],d=new w,f=new w,p=new w,m=new w,g=new w,y=new w,A=new w;for(let b=0;b<=i;++b){const _=b/i*r*Math.PI*2;v(_,r,o,e,p),v(_+.01,r,o,e,m),y.subVectors(m,p),A.addVectors(m,p),g.crossVectors(y,A),A.crossVectors(g,y),g.normalize(),A.normalize();for(let T=0;T<=s;++T){const E=T/s*Math.PI*2,M=-t*Math.cos(E),I=t*Math.sin(E);d.x=p.x+(M*A.x+I*g.x),d.y=p.y+(M*A.y+I*g.y),d.z=p.z+(M*A.z+I*g.z),c.push(d.x,d.y,d.z),f.subVectors(d,p).normalize(),l.push(f.x,f.y,f.z),h.push(b/i),h.push(T/s)}}for(let b=1;b<=i;b++)for(let _=1;_<=s;_++){const T=(s+1)*(b-1)+(_-1),E=(s+1)*b+(_-1),M=(s+1)*b+_,I=(s+1)*(b-1)+_;a.push(T,E,I),a.push(E,M,I)}this.setIndex(a),this.setAttribute("position",new ot(c,3)),this.setAttribute("normal",new ot(l,3)),this.setAttribute("uv",new ot(h,2));function v(b,_,T,E,M){const I=Math.cos(b),S=Math.sin(b),C=T/_*b,D=Math.cos(C);M.x=E*(2+D)*.5*I,M.y=E*(2+D)*S*.5,M.z=E*Math.sin(C)*.5}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Q_(e.radius,e.tube,e.tubularSegments,e.radialSegments,e.p,e.q)}}class j_ extends gt{constructor(e=new kM(new w(-1,-1,0),new w(-1,1,0),new w(1,1,0)),t=64,i=1,s=8,r=!1){super(),this.type="TubeGeometry",this.parameters={path:e,tubularSegments:t,radius:i,radialSegments:s,closed:r};const o=e.computeFrenetFrames(t,r);this.tangents=o.tangents,this.normals=o.normals,this.binormals=o.binormals;const a=new w,c=new w,l=new ie;let h=new w;const d=[],f=[],p=[],m=[];g(),this.setIndex(m),this.setAttribute("position",new ot(d,3)),this.setAttribute("normal",new ot(f,3)),this.setAttribute("uv",new ot(p,2));function g(){for(let b=0;b<t;b++)y(b);y(r===!1?t:0),v(),A()}function y(b){h=e.getPointAt(b/t,h);const _=o.normals[b],T=o.binormals[b];for(let E=0;E<=s;E++){const M=E/s*Math.PI*2,I=Math.sin(M),S=-Math.cos(M);c.x=S*_.x+I*T.x,c.y=S*_.y+I*T.y,c.z=S*_.z+I*T.z,c.normalize(),f.push(c.x,c.y,c.z),a.x=h.x+i*c.x,a.y=h.y+i*c.y,a.z=h.z+i*c.z,d.push(a.x,a.y,a.z)}}function A(){for(let b=1;b<=t;b++)for(let _=1;_<=s;_++){const T=(s+1)*(b-1)+(_-1),E=(s+1)*b+(_-1),M=(s+1)*b+_,I=(s+1)*(b-1)+_;m.push(T,E,I),m.push(E,M,I)}}function v(){for(let b=0;b<=t;b++)for(let _=0;_<=s;_++)l.x=b/t,l.y=_/s,p.push(l.x,l.y)}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON();return e.path=this.parameters.path.toJSON(),e}static fromJSON(e){return new j_(new hb[e.path.type]().fromJSON(e.path),e.tubularSegments,e.radius,e.radialSegments,e.closed)}}class UM extends gt{constructor(e=null){if(super(),this.type="WireframeGeometry",this.parameters={geometry:e},e!==null){const t=[],i=new Set,s=new w,r=new w;if(e.index!==null){const o=e.attributes.position,a=e.index;let c=e.groups;c.length===0&&(c=[{start:0,count:a.count,materialIndex:0}]);for(let l=0,h=c.length;l<h;++l){const d=c[l],f=d.start,p=d.count;for(let m=f,g=f+p;m<g;m+=3)for(let y=0;y<3;y++){const A=a.getX(m+y),v=a.getX(m+(y+1)%3);s.fromBufferAttribute(o,A),r.fromBufferAttribute(o,v),PP(s,r,i)===!0&&(t.push(s.x,s.y,s.z),t.push(r.x,r.y,r.z))}}}else{const o=e.attributes.position;for(let a=0,c=o.count/3;a<c;a++)for(let l=0;l<3;l++){const h=3*a+l,d=3*a+(l+1)%3;s.fromBufferAttribute(o,h),r.fromBufferAttribute(o,d),PP(s,r,i)===!0&&(t.push(s.x,s.y,s.z),t.push(r.x,r.y,r.z))}}this.setAttribute("position",new ot(t,3))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}}function PP(n,e,t){const i=`${n.x},${n.y},${n.z}-${e.x},${e.y},${e.z}`,s=`${e.x},${e.y},${e.z}-${n.x},${n.y},${n.z}`;return t.has(i)===!0||t.has(s)===!0?!1:(t.add(i),t.add(s),!0)}var BP=Object.freeze({__proto__:null,BoxGeometry:Ni,CapsuleGeometry:k_,CircleGeometry:L_,ConeGeometry:F_,CylinderGeometry:xn,DodecahedronGeometry:U_,EdgesGeometry:FM,ExtrudeGeometry:z_,IcosahedronGeometry:G_,LatheGeometry:VA,OctahedronGeometry:sl,PlaneGeometry:Wn,PolyhedronGeometry:Yh,RingGeometry:fd,ShapeGeometry:V_,SphereGeometry:Aa,TetrahedronGeometry:H_,TorusGeometry:el,TorusKnotGeometry:Q_,TubeGeometry:j_,WireframeGeometry:UM});class W_ extends Ot{constructor(e){super(),this.isShadowMaterial=!0,this.type="ShadowMaterial",this.color=new ye(0),this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.fog=e.fog,this}}class HA extends Et{constructor(e){super(e),this.isRawShaderMaterial=!0,this.type="RawShaderMaterial"}}class Ur extends Ot{constructor(e){super(),this.isMeshStandardMaterial=!0,this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new ye(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new ye(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Xh,this.normalScale=new ie(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.occlusion=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapIntensity=e.envMapIntensity,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this.occlusion=e.occlusion,this}}class so extends Ur{constructor(e){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.anisotropyRotation=0,this.anisotropyMap=null,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new ie(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return pn(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(t){this.ior=(1+.4*t)/(1-.4*t)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new ye(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new ye(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new ye(1,1,1),this.specularColorMap=null,this._anisotropy=0,this._clearcoat=0,this._iridescence=0,this._sheen=0,this._transmission=0,this.setValues(e)}get anisotropy(){return this._anisotropy}set anisotropy(e){this._anisotropy>0!=e>0&&this.version++,this._anisotropy=e}get clearcoat(){return this._clearcoat}set clearcoat(e){this._clearcoat>0!=e>0&&this.version++,this._clearcoat=e}get iridescence(){return this._iridescence}set iridescence(e){this._iridescence>0!=e>0&&this.version++,this._iridescence=e}get sheen(){return this._sheen}set sheen(e){this._sheen>0!=e>0&&this.version++,this._sheen=e}get transmission(){return this._transmission}set transmission(e){this._transmission>0!=e>0&&this.version++,this._transmission=e}copy(e){return super.copy(e),this.defines={STANDARD:"",PHYSICAL:""},this.anisotropy=e.anisotropy,this.anisotropyRotation=e.anisotropyRotation,this.anisotropyMap=e.anisotropyMap,this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.ior=e.ior,this.iridescence=e.iridescence,this.iridescenceMap=e.iridescenceMap,this.iridescenceIOR=e.iridescenceIOR,this.iridescenceThicknessRange=[...e.iridescenceThicknessRange],this.iridescenceThicknessMap=e.iridescenceThicknessMap,this.sheen=e.sheen,this.sheenColor.copy(e.sheenColor),this.sheenColorMap=e.sheenColorMap,this.sheenRoughness=e.sheenRoughness,this.sheenRoughnessMap=e.sheenRoughnessMap,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this.thickness=e.thickness,this.thicknessMap=e.thicknessMap,this.attenuationDistance=e.attenuationDistance,this.attenuationColor.copy(e.attenuationColor),this.specularIntensity=e.specularIntensity,this.specularIntensityMap=e.specularIntensityMap,this.specularColor.copy(e.specularColor),this.specularColorMap=e.specularColorMap,this}}class F2 extends Ot{constructor(e){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new ye(16777215),this.specular=new ye(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new ye(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Xh,this.normalScale=new ie(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=DA,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.occlusion=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this.occlusion=e.occlusion,this}}class U2 extends Ot{constructor(e){super(),this.isMeshToonMaterial=!0,this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new ye(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new ye(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Xh,this.normalScale=new ie(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.occlusion=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.gradientMap=e.gradientMap,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this.occlusion=e.occlusion,this}}class q_ extends Ot{constructor(e){super(),this.isMeshNormalMaterial=!0,this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Xh,this.normalScale=new ie(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.flatShading=e.flatShading,this}}class N2 extends Ot{constructor(e){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new ye(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new ye(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Xh,this.normalScale=new ie(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=DA,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.occlusion=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this.occlusion=e.occlusion,this}}class z2 extends Ot{constructor(e){super(),this.isMeshMatcapMaterial=!0,this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new ye(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Xh,this.normalScale=new ie(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.fog=!0,this.occlusion=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.flatShading=e.flatShading,this.fog=e.fog,this.occlusion=e.occlusion,this}}class G2 extends Ln{constructor(e){super(),this.isLineDashedMaterial=!0,this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}copy(e){return super.copy(e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this}}function Nu(n,e,t){return!n||!t&&n.constructor===e?n:typeof e.BYTES_PER_ELEMENT=="number"?new e(n):Array.prototype.slice.call(n)}function V2(n){return ArrayBuffer.isView(n)&&!(n instanceof DataView)}function H2(n){function e(s,r){return n[s]-n[r]}const t=n.length,i=new Array(t);for(let s=0;s!==t;++s)i[s]=s;return i.sort(e),i}function yE(n,e,t){const i=n.length,s=new n.constructor(i);for(let r=0,o=0;o!==i;++r){const a=t[r]*e;for(let c=0;c!==e;++c)s[o++]=n[a+c]}return s}function NM(n,e,t,i){let s=1,r=n[0];for(;r!==void 0&&r[i]===void 0;)r=n[s++];if(r===void 0)return;let o=r[i];if(o!==void 0)if(Array.isArray(o))do o=r[i],o!==void 0&&(e.push(r.time),t.push.apply(t,o)),r=n[s++];while(r!==void 0);else if(o.toArray!==void 0)do o=r[i],o!==void 0&&(e.push(r.time),o.toArray(t,t.length)),r=n[s++];while(r!==void 0);else do o=r[i],o!==void 0&&(e.push(r.time),t.push(o)),r=n[s++];while(r!==void 0)}function nW(n,e,t,i,s=30){const r=n.clone();r.name=e;const o=[];for(let c=0;c<r.tracks.length;++c){const l=r.tracks[c],h=l.getValueSize(),d=[],f=[];for(let p=0;p<l.times.length;++p){const m=l.times[p]*s;if(!(m<t||m>=i)){d.push(l.times[p]);for(let g=0;g<h;++g)f.push(l.values[p*h+g])}}d.length!==0&&(l.times=Nu(d,l.times.constructor),l.values=Nu(f,l.values.constructor),o.push(l))}r.tracks=o;let a=1/0;for(let c=0;c<r.tracks.length;++c)a>r.tracks[c].times[0]&&(a=r.tracks[c].times[0]);for(let c=0;c<r.tracks.length;++c)r.tracks[c].shift(-1*a);return r.resetDuration(),r}function sW(n,e=0,t=n,i=30){i<=0&&(i=30);const s=t.tracks.length,r=e/i;for(let o=0;o<s;++o){const a=t.tracks[o],c=a.ValueTypeName;if(c==="bool"||c==="string")continue;const l=n.tracks.find(function(A){return A.name===a.name&&A.ValueTypeName===c});if(l===void 0)continue;let h=0;const d=a.getValueSize();a.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(h=d/3);let f=0;const p=l.getValueSize();l.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(f=p/3);const m=a.times.length-1;let g;if(r<=a.times[0]){const A=h,v=d-h;g=a.values.slice(A,v)}else if(r>=a.times[m]){const A=m*d+h,v=A+d-h;g=a.values.slice(A,v)}else{const A=a.createInterpolant(),v=h,b=d-h;A.evaluate(r),g=A.resultBuffer.slice(v,b)}c==="quaternion"&&new Me().fromArray(g).normalize().conjugate().toArray(g);const y=l.times.length;for(let A=0;A<y;++A){const v=A*p+f;if(c==="quaternion")Me.multiplyQuaternionsFlat(l.values,v,g,0,l.values,v);else{const b=p-f*2;for(let _=0;_<b;++_)l.values[v+_]-=g[_]}}}return n.blendMode=pM,n}const rW={convertArray:Nu,isTypedArray:V2,getKeyframeOrder:H2,sortedArray:yE,flattenJSON:NM,subclip:nW,makeClipAdditive:sW};class Rp{constructor(e,t,i,s){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=s!==void 0?s:new t.constructor(i),this.sampleValues=t,this.valueSize=i,this.settings=null,this.DefaultSettings_={}}evaluate(e){const t=this.parameterPositions;let i=this._cachedIndex,s=t[i],r=t[i-1];e:{t:{let o;i:{n:if(!(e<s)){for(let a=i+2;;){if(s===void 0){if(e<r)break n;return i=t.length,this._cachedIndex=i,this.copySampleValue_(i-1)}if(i===a)break;if(r=s,s=t[++i],e<s)break t}o=t.length;break i}if(!(e>=r)){const a=t[1];e<a&&(i=2,r=a);for(let c=i-2;;){if(r===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(i===c)break;if(s=r,r=t[--i-1],e>=r)break t}o=i,i=0;break i}break e}for(;i<o;){const a=i+o>>>1;e<t[a]?o=a:i=a+1}if(s=t[i],r=t[i-1],r===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(s===void 0)return i=t.length,this._cachedIndex=i,this.copySampleValue_(i-1)}this._cachedIndex=i,this.intervalChanged_(i,r,s)}return this.interpolate_(i,r,e,s)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){const t=this.resultBuffer,i=this.sampleValues,s=this.valueSize,r=e*s;for(let o=0;o!==s;++o)t[o]=i[r+o];return t}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class Q2 extends Rp{constructor(e,t,i,s){super(e,t,i,s),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:Lu,endingEnd:Lu}}intervalChanged_(e,t,i){const s=this.parameterPositions;let r=e-2,o=e+1,a=s[r],c=s[o];if(a===void 0)switch(this.getSettings_().endingStart){case Fu:r=e,a=2*t-i;break;case Wg:r=s.length-2,a=t+s[r]-s[r+1];break;default:r=e,a=i}if(c===void 0)switch(this.getSettings_().endingEnd){case Fu:o=e,c=2*i-t;break;case Wg:o=1,c=i+s[1]-s[0];break;default:o=e-1,c=t}const l=(i-t)*.5,h=this.valueSize;this._weightPrev=l/(t-a),this._weightNext=l/(c-i),this._offsetPrev=r*h,this._offsetNext=o*h}interpolate_(e,t,i,s){const r=this.resultBuffer,o=this.sampleValues,a=this.valueSize,c=e*a,l=c-a,h=this._offsetPrev,d=this._offsetNext,f=this._weightPrev,p=this._weightNext,m=(i-t)/(s-t),g=m*m,y=g*m,A=-f*y+2*f*g-f*m,v=(1+f)*y+(-1.5-2*f)*g+(-.5+f)*m+1,b=(-1-p)*y+(1.5+p)*g+.5*m,_=p*y-p*g;for(let T=0;T!==a;++T)r[T]=A*o[h+T]+v*o[l+T]+b*o[c+T]+_*o[d+T];return r}}class zM extends Rp{constructor(e,t,i,s){super(e,t,i,s)}interpolate_(e,t,i,s){const r=this.resultBuffer,o=this.sampleValues,a=this.valueSize,c=e*a,l=c-a,h=(i-t)/(s-t),d=1-h;for(let f=0;f!==a;++f)r[f]=o[l+f]*d+o[c+f]*h;return r}}class j2 extends Rp{constructor(e,t,i,s){super(e,t,i,s)}interpolate_(e){return this.copySampleValue_(e-1)}}class va{constructor(e,t,i,s){if(e===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(t===void 0||t.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=Nu(t,this.TimeBufferType),this.values=Nu(i,this.ValueBufferType),this.setInterpolation(s||this.DefaultInterpolation)}static toJSON(e){const t=e.constructor;let i;if(t.toJSON!==this.toJSON)i=t.toJSON(e);else{i={name:e.name,times:Nu(e.times,Array),values:Nu(e.values,Array)};const s=e.getInterpolation();s!==e.DefaultInterpolation&&(i.interpolation=s)}return i.type=e.ValueTypeName,i}InterpolantFactoryMethodDiscrete(e){return new j2(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new zM(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new Q2(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let t;switch(e){case ud:t=this.InterpolantFactoryMethodDiscrete;break;case Gh:t=this.InterpolantFactoryMethodLinear;break;case _0:t=this.InterpolantFactoryMethodSmooth;break}if(t===void 0){const i="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0)if(e!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw new Error(i);return console.warn("THREE.KeyframeTrack:",i),this}return this.createInterpolant=t,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return ud;case this.InterpolantFactoryMethodLinear:return Gh;case this.InterpolantFactoryMethodSmooth:return _0}}getValueSize(){return this.values.length/this.times.length}shift(e){if(e!==0){const t=this.times;for(let i=0,s=t.length;i!==s;++i)t[i]+=e}return this}scale(e){if(e!==1){const t=this.times;for(let i=0,s=t.length;i!==s;++i)t[i]*=e}return this}trim(e,t){const i=this.times,s=i.length;let r=0,o=s-1;for(;r!==s&&i[r]<e;)++r;for(;o!==-1&&i[o]>t;)--o;if(++o,r!==0||o!==s){r>=o&&(o=Math.max(o,1),r=o-1);const a=this.getValueSize();this.times=i.slice(r,o),this.values=this.values.slice(r*a,o*a)}return this}validate(){let e=!0;const t=this.getValueSize();t-Math.floor(t)!==0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);const i=this.times,s=this.values,r=i.length;r===0&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);let o=null;for(let a=0;a!==r;a++){const c=i[a];if(typeof c=="number"&&isNaN(c)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,a,c),e=!1;break}if(o!==null&&o>c){console.error("THREE.KeyframeTrack: Out of order keys.",this,a,c,o),e=!1;break}o=c}if(s!==void 0&&V2(s))for(let a=0,c=s.length;a!==c;++a){const l=s[a];if(isNaN(l)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,a,l),e=!1;break}}return e}optimize(){const e=this.times.slice(),t=this.values.slice(),i=this.getValueSize(),s=this.getInterpolation()===_0,r=e.length-1;let o=1;for(let a=1;a<r;++a){let c=!1;const l=e[a],h=e[a+1];if(l!==h&&(a!==1||l!==e[0]))if(s)c=!0;else{const d=a*i,f=d-i,p=d+i;for(let m=0;m!==i;++m){const g=t[d+m];if(g!==t[f+m]||g!==t[p+m]){c=!0;break}}}if(c){if(a!==o){e[o]=e[a];const d=a*i,f=o*i;for(let p=0;p!==i;++p)t[f+p]=t[d+p]}++o}}if(r>0){e[o]=e[r];for(let a=r*i,c=o*i,l=0;l!==i;++l)t[c+l]=t[a+l];++o}return o!==e.length?(this.times=e.slice(0,o),this.values=t.slice(0,o*i)):(this.times=e,this.values=t),this}clone(){const e=this.times.slice(),t=this.values.slice(),i=this.constructor,s=new i(this.name,e,t);return s.createInterpolant=this.createInterpolant,s}}va.prototype.TimeBufferType=Float32Array;va.prototype.ValueBufferType=Float32Array;va.prototype.DefaultInterpolation=Gh;class bd extends va{}bd.prototype.ValueTypeName="bool";bd.prototype.ValueBufferType=Array;bd.prototype.DefaultInterpolation=ud;bd.prototype.InterpolantFactoryMethodLinear=void 0;bd.prototype.InterpolantFactoryMethodSmooth=void 0;class GM extends va{}GM.prototype.ValueTypeName="color";class pd extends va{}pd.prototype.ValueTypeName="number";class W2 extends Rp{constructor(e,t,i,s){super(e,t,i,s)}interpolate_(e,t,i,s){const r=this.resultBuffer,o=this.sampleValues,a=this.valueSize,c=(i-t)/(s-t);let l=e*a;for(let h=l+a;l!==h;l+=4)Me.slerpFlat(r,0,o,l-a,o,l,c);return r}}class xl extends va{InterpolantFactoryMethodLinear(e){return new W2(this.times,this.values,this.getValueSize(),e)}}xl.prototype.ValueTypeName="quaternion";xl.prototype.DefaultInterpolation=Gh;xl.prototype.InterpolantFactoryMethodSmooth=void 0;class _d extends va{}_d.prototype.ValueTypeName="string";_d.prototype.ValueBufferType=Array;_d.prototype.DefaultInterpolation=ud;_d.prototype.InterpolantFactoryMethodLinear=void 0;_d.prototype.InterpolantFactoryMethodSmooth=void 0;class Vh extends va{}Vh.prototype.ValueTypeName="vector";class Nr{constructor(e,t=-1,i,s=E_){this.name=e,this.tracks=i,this.duration=t,this.blendMode=s,this.uuid=to(),this.duration<0&&this.resetDuration()}static parse(e){const t=[],i=e.tracks,s=1/(e.fps||1);for(let o=0,a=i.length;o!==a;++o)t.push(aW(i[o]).scale(s));const r=new this(e.name,e.duration,t,e.blendMode);return r.uuid=e.uuid,r}static toJSON(e){const t=[],i=e.tracks,s={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid,blendMode:e.blendMode};for(let r=0,o=i.length;r!==o;++r)t.push(va.toJSON(i[r]));return s}static CreateFromMorphTargetSequence(e,t,i,s){const r=t.length,o=[];for(let a=0;a<r;a++){let c=[],l=[];c.push((a+r-1)%r,a,(a+1)%r),l.push(0,1,0);const h=H2(c);c=yE(c,1,h),l=yE(l,1,h),!s&&c[0]===0&&(c.push(r),l.push(l[0])),o.push(new pd(".morphTargetInfluences["+t[a].name+"]",c,l).scale(1/i))}return new this(e,-1,o)}static findByName(e,t){let i=e;if(!Array.isArray(e)){const s=e;i=s.geometry&&s.geometry.animations||s.animations}for(let s=0;s<i.length;s++)if(i[s].name===t)return i[s];return null}static CreateClipsFromMorphTargetSequences(e,t,i){const s={},r=/^([\w-]*?)([\d]+)$/;for(let a=0,c=e.length;a<c;a++){const l=e[a],h=l.name.match(r);if(h&&h.length>1){const d=h[1];let f=s[d];f||(s[d]=f=[]),f.push(l)}}const o=[];for(const a in s)o.push(this.CreateFromMorphTargetSequence(a,s[a],t,i));return o}static parseAnimation(e,t){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const i=function(d,f,p,m,g){if(p.length!==0){const y=[],A=[];NM(p,y,A,m),y.length!==0&&g.push(new d(f,y,A))}},s=[],r=e.name||"default",o=e.fps||30,a=e.blendMode;let c=e.length||-1;const l=e.hierarchy||[];for(let d=0;d<l.length;d++){const f=l[d].keys;if(!(!f||f.length===0))if(f[0].morphTargets){const p={};let m;for(m=0;m<f.length;m++)if(f[m].morphTargets)for(let g=0;g<f[m].morphTargets.length;g++)p[f[m].morphTargets[g]]=-1;for(const g in p){const y=[],A=[];for(let v=0;v!==f[m].morphTargets.length;++v){const b=f[m];y.push(b.time),A.push(b.morphTarget===g?1:0)}s.push(new pd(".morphTargetInfluence["+g+"]",y,A))}c=p.length*o}else{const p=".bones["+t[d].name+"]";i(Vh,p+".position",f,"pos",s),i(xl,p+".quaternion",f,"rot",s),i(Vh,p+".scale",f,"scl",s)}}return s.length===0?null:new this(r,c,s,a)}resetDuration(){const e=this.tracks;let t=0;for(let i=0,s=e.length;i!==s;++i){const r=this.tracks[i];t=Math.max(t,r.times[r.times.length-1])}return this.duration=t,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let e=!0;for(let t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){const e=[];for(let t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());return new this.constructor(this.name,this.duration,e,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function oW(n){switch(n.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return pd;case"vector":case"vector2":case"vector3":case"vector4":return Vh;case"color":return GM;case"quaternion":return xl;case"bool":case"boolean":return bd;case"string":return _d}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+n)}function aW(n){if(n.type===void 0)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const e=oW(n.type);if(n.times===void 0){const t=[],i=[];NM(n.keys,t,i,"value"),n.times=t,n.values=i}return e.parse!==void 0?e.parse(n):new e(n.name,n.times,n.values,n.interpolation)}const rl={enabled:!1,files:{},add:function(n,e){this.enabled!==!1&&(this.files[n]=e)},get:function(n){if(this.enabled!==!1)return this.files[n]},remove:function(n){delete this.files[n]},clear:function(){this.files={}}};class X_{constructor(e,t,i){const s=this;let r=!1,o=0,a=0,c;const l=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=i,this.itemStart=function(h){a++,r===!1&&s.onStart!==void 0&&s.onStart(h,o,a),r=!0},this.itemEnd=function(h){o++,s.onProgress!==void 0&&s.onProgress(h,o,a),o===a&&(r=!1,s.onLoad!==void 0&&s.onLoad())},this.itemError=function(h){s.onError!==void 0&&s.onError(h)},this.resolveURL=function(h){return c?c(h):h},this.setURLModifier=function(h){return c=h,this},this.addHandler=function(h,d){return l.push(h,d),this},this.removeHandler=function(h){const d=l.indexOf(h);return d!==-1&&l.splice(d,2),this},this.getHandler=function(h){for(let d=0,f=l.length;d<f;d+=2){const p=l[d],m=l[d+1];if(p.global&&(p.lastIndex=0),p.test(h))return m}return null}}}const q2=new X_;class Ms{constructor(e){this.manager=e!==void 0?e:q2,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,t){const i=this;return new Promise(function(s,r){i.load(e,s,t,r)})}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}}Ms.DEFAULT_MATERIAL_NAME="__DEFAULT";const Oc={};class cW extends Error{constructor(e,t){super(e),this.response=t}}class Hn extends Ms{constructor(e){super(e)}load(e,t,i,s){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const r=rl.get(e);if(r!==void 0)return this.manager.itemStart(e),setTimeout(()=>{t&&t(r),this.manager.itemEnd(e)},0),r;if(Oc[e]!==void 0){Oc[e].push({onLoad:t,onProgress:i,onError:s});return}Oc[e]=[],Oc[e].push({onLoad:t,onProgress:i,onError:s});const o=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),a=this.mimeType,c=this.responseType;fetch(o).then(l=>{if(l.status===200||l.status===0){if(l.status===0&&console.warn("THREE.FileLoader: HTTP Status 0 received."),typeof ReadableStream>"u"||l.body===void 0||l.body.getReader===void 0)return l;const h=Oc[e],d=l.body.getReader(),f=l.headers.get("Content-Length")||l.headers.get("X-File-Size"),p=f?parseInt(f):0,m=p!==0;let g=0;const y=new ReadableStream({start(A){v();function v(){d.read().then(({done:b,value:_})=>{if(b)A.close();else{g+=_.byteLength;const T=new ProgressEvent("progress",{lengthComputable:m,loaded:g,total:p});for(let E=0,M=h.length;E<M;E++){const I=h[E];I.onProgress&&I.onProgress(T)}A.enqueue(_),v()}})}}});return new Response(y)}else throw new cW(`fetch for "${l.url}" responded with ${l.status}: ${l.statusText}`,l)}).then(l=>{switch(c){case"arraybuffer":return l.arrayBuffer();case"blob":return l.blob();case"document":return l.text().then(h=>new DOMParser().parseFromString(h,a));case"json":return l.json();default:if(a===void 0)return l.text();{const d=/charset="?([^;"\s]*)"?/i.exec(a),f=d&&d[1]?d[1].toLowerCase():void 0,p=new TextDecoder(f);return l.arrayBuffer().then(m=>p.decode(m))}}}).then(l=>{rl.add(e,l);const h=Oc[e];delete Oc[e];for(let d=0,f=h.length;d<f;d++){const p=h[d];p.onLoad&&p.onLoad(l)}}).catch(l=>{const h=Oc[e];if(h===void 0)throw this.manager.itemError(e),l;delete Oc[e];for(let d=0,f=h.length;d<f;d++){const p=h[d];p.onError&&p.onError(l)}this.manager.itemError(e)}).finally(()=>{this.manager.itemEnd(e)}),this.manager.itemStart(e)}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}}class lW extends Ms{constructor(e){super(e)}load(e,t,i,s){const r=this,o=new Hn(this.manager);o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,function(a){try{t(r.parse(JSON.parse(a)))}catch(c){s?s(c):console.error(c),r.manager.itemError(e)}},i,s)}parse(e){const t=[];for(let i=0;i<e.length;i++){const s=Nr.parse(e[i]);t.push(s)}return t}}class hW extends Ms{constructor(e){super(e)}load(e,t,i,s){const r=this,o=[],a=new lc,c=new Hn(this.manager);c.setPath(this.path),c.setResponseType("arraybuffer"),c.setRequestHeader(this.requestHeader),c.setWithCredentials(r.withCredentials);let l=0;function h(d){c.load(e[d],function(f){const p=r.parse(f,!0);o[d]={width:p.width,height:p.height,format:p.format,mipmaps:p.mipmaps},l+=1,l===6&&(p.mipmapCount===1&&(a.minFilter=St),a.image=o,a.format=p.format,a.needsUpdate=!0,t&&t(a))},i,s)}if(Array.isArray(e))for(let d=0,f=e.length;d<f;++d)h(d);else c.load(e,function(d){const f=r.parse(d,!0);if(f.isCubemap){const p=f.mipmaps.length/f.mipmapCount;for(let m=0;m<p;m++){o[m]={mipmaps:[]};for(let g=0;g<f.mipmapCount;g++)o[m].mipmaps.push(f.mipmaps[m*f.mipmapCount+g]),o[m].format=f.format,o[m].width=f.width,o[m].height=f.height}a.image=o}else a.image.width=f.width,a.image.height=f.height,a.mipmaps=f.mipmaps;f.mipmapCount===1&&(a.minFilter=St),a.format=f.format,a.needsUpdate=!0,t&&t(a)},i,s);return a}}class nA extends Ms{constructor(e){super(e)}load(e,t,i,s){this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const r=this,o=rl.get(e);if(o!==void 0)return r.manager.itemStart(e),setTimeout(function(){t&&t(o),r.manager.itemEnd(e)},0),o;const a=Zg("img");function c(){h(),rl.add(e,this),t&&t(this),r.manager.itemEnd(e)}function l(d){h(),s&&s(d),r.manager.itemError(e),r.manager.itemEnd(e)}function h(){a.removeEventListener("load",c,!1),a.removeEventListener("error",l,!1)}return a.addEventListener("load",c,!1),a.addEventListener("error",l,!1),e.slice(0,5)!=="data:"&&this.crossOrigin!==void 0&&(a.crossOrigin=this.crossOrigin),r.manager.itemStart(e),a.src=e,a}}class uW extends Ms{constructor(e){super(e)}load(e,t,i,s){const r=new FA;r.colorSpace=zt;const o=new nA(this.manager);o.setCrossOrigin(this.crossOrigin),o.setPath(this.path);let a=0;function c(l){o.load(e[l],function(h){r.images[l]=h,a++,a===6&&(r.needsUpdate=!0,t&&t(r))},void 0,s)}for(let l=0;l<e.length;++l)c(l);return r}}class VM extends Ms{constructor(e){super(e)}load(e,t,i,s){const r=this,o=new io,a=new Hn(this.manager);return a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setPath(this.path),a.setWithCredentials(r.withCredentials),a.load(e,function(c){let l;try{l=r.parse(c)}catch(h){if(s!==void 0)s(h);else{console.error(h);return}}l.image!==void 0?o.image=l.image:l.data!==void 0&&(o.image.width=l.width,o.image.height=l.height,o.image.data=l.data),o.wrapS=l.wrapS!==void 0?l.wrapS:ts,o.wrapT=l.wrapT!==void 0?l.wrapT:ts,o.magFilter=l.magFilter!==void 0?l.magFilter:St,o.minFilter=l.minFilter!==void 0?l.minFilter:St,o.anisotropy=l.anisotropy!==void 0?l.anisotropy:1,l.colorSpace!==void 0?o.colorSpace=l.colorSpace:l.encoding!==void 0&&(o.encoding=l.encoding),l.flipY!==void 0&&(o.flipY=l.flipY),l.format!==void 0&&(o.format=l.format),l.type!==void 0&&(o.type=l.type),l.mipmaps!==void 0&&(o.mipmaps=l.mipmaps,o.minFilter=kr),l.mipmapCount===1&&(o.minFilter=St),l.generateMipmaps!==void 0&&(o.generateMipmaps=l.generateMipmaps),o.needsUpdate=!0,t&&t(o,l)},i,s),o}}class dl extends Ms{constructor(e){super(e)}load(e,t,i,s){const r=new Ft,o=new nA(this.manager);return o.setCrossOrigin(this.crossOrigin),o.setPath(this.path),o.load(e,function(a){r.image=a,r.needsUpdate=!0,t!==void 0&&t(r)},i,s),r}}let Jh=class extends ge{constructor(e,t=1){super(),this.isLight=!0,this.type="Light",this.color=new ye(e),this.intensity=t}dispose(){}copy(e,t){return super.copy(e,t),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){const t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,this.groundColor!==void 0&&(t.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(t.object.distance=this.distance),this.angle!==void 0&&(t.object.angle=this.angle),this.decay!==void 0&&(t.object.decay=this.decay),this.penumbra!==void 0&&(t.object.penumbra=this.penumbra),this.shadow!==void 0&&(t.object.shadow=this.shadow.toJSON()),t}};class HM extends Jh{constructor(e,t,i){super(e,i),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(ge.DEFAULT_UP),this.updateMatrix(),this.groundColor=new ye(t)}copy(e,t){return super.copy(e,t),this.groundColor.copy(e.groundColor),this}}const sS=new Ce,DP=new w,OP=new w;class QM{constructor(e){this.camera=e,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new ie(512,512),this.map=null,this.mapPass=null,this.matrix=new Ce,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new UA,this._frameExtents=new ie(1,1),this._viewportCount=1,this._viewports=[new tt(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){const t=this.camera,i=this.matrix;DP.setFromMatrixPosition(e.matrixWorld),t.position.copy(DP),OP.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(OP),t.updateMatrixWorld(),sS.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(sS),i.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),i.multiply(sS)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){const e={};return this.bias!==0&&(e.bias=this.bias),this.normalBias!==0&&(e.normalBias=this.normalBias),this.radius!==1&&(e.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}class dW extends QM{constructor(){super(new Wt(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(e){const t=this.camera,i=fp*2*e.angle*this.focus,s=this.mapSize.width/this.mapSize.height,r=e.distance||t.far;(i!==t.fov||s!==t.aspect||r!==t.far)&&(t.fov=i,t.aspect=s,t.far=r,t.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}}class Y_ extends Jh{constructor(e,t,i=0,s=Math.PI/3,r=0,o=2){super(e,t),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(ge.DEFAULT_UP),this.updateMatrix(),this.target=new ge,this.distance=i,this.angle=s,this.penumbra=r,this.decay=o,this.map=null,this.shadow=new dW}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}const kP=new Ce,vm=new w,rS=new w;class fW extends QM{constructor(){super(new Wt(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new ie(4,2),this._viewportCount=6,this._viewports=[new tt(2,1,1,1),new tt(0,1,1,1),new tt(3,1,1,1),new tt(1,1,1,1),new tt(3,0,1,1),new tt(1,0,1,1)],this._cubeDirections=[new w(1,0,0),new w(-1,0,0),new w(0,0,1),new w(0,0,-1),new w(0,1,0),new w(0,-1,0)],this._cubeUps=[new w(0,1,0),new w(0,1,0),new w(0,1,0),new w(0,1,0),new w(0,0,1),new w(0,0,-1)]}updateMatrices(e,t=0){const i=this.camera,s=this.matrix,r=e.distance||i.far;r!==i.far&&(i.far=r,i.updateProjectionMatrix()),vm.setFromMatrixPosition(e.matrixWorld),i.position.copy(vm),rS.copy(i.position),rS.add(this._cubeDirections[t]),i.up.copy(this._cubeUps[t]),i.lookAt(rS),i.updateMatrixWorld(),s.makeTranslation(-vm.x,-vm.y,-vm.z),kP.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),this._frustum.setFromProjectionMatrix(kP)}}class J_ extends Jh{constructor(e,t,i=0,s=2){super(e,t),this.isPointLight=!0,this.type="PointLight",this.distance=i,this.decay=s,this.shadow=new fW}get power(){return this.intensity*4*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}class pW extends QM{constructor(){super(new vc(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class mp extends Jh{constructor(e,t){super(e,t),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(ge.DEFAULT_UP),this.updateMatrix(),this.target=new ge,this.shadow=new pW}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}class jM extends Jh{constructor(e,t){super(e,t),this.isAmbientLight=!0,this.type="AmbientLight"}}class X2 extends Jh{constructor(e,t,i=10,s=10){super(e,t),this.isRectAreaLight=!0,this.type="RectAreaLight",this.width=i,this.height=s}get power(){return this.intensity*this.width*this.height*Math.PI}set power(e){this.intensity=e/(this.width*this.height*Math.PI)}copy(e){return super.copy(e),this.width=e.width,this.height=e.height,this}toJSON(e){const t=super.toJSON(e);return t.object.width=this.width,t.object.height=this.height,t}}class Y2{constructor(){this.isSphericalHarmonics3=!0,this.coefficients=[];for(let e=0;e<9;e++)this.coefficients.push(new w)}set(e){for(let t=0;t<9;t++)this.coefficients[t].copy(e[t]);return this}zero(){for(let e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this}getAt(e,t){const i=e.x,s=e.y,r=e.z,o=this.coefficients;return t.copy(o[0]).multiplyScalar(.282095),t.addScaledVector(o[1],.488603*s),t.addScaledVector(o[2],.488603*r),t.addScaledVector(o[3],.488603*i),t.addScaledVector(o[4],1.092548*(i*s)),t.addScaledVector(o[5],1.092548*(s*r)),t.addScaledVector(o[6],.315392*(3*r*r-1)),t.addScaledVector(o[7],1.092548*(i*r)),t.addScaledVector(o[8],.546274*(i*i-s*s)),t}getIrradianceAt(e,t){const i=e.x,s=e.y,r=e.z,o=this.coefficients;return t.copy(o[0]).multiplyScalar(.886227),t.addScaledVector(o[1],2*.511664*s),t.addScaledVector(o[2],2*.511664*r),t.addScaledVector(o[3],2*.511664*i),t.addScaledVector(o[4],2*.429043*i*s),t.addScaledVector(o[5],2*.429043*s*r),t.addScaledVector(o[6],.743125*r*r-.247708),t.addScaledVector(o[7],2*.429043*i*r),t.addScaledVector(o[8],.429043*(i*i-s*s)),t}add(e){for(let t=0;t<9;t++)this.coefficients[t].add(e.coefficients[t]);return this}addScaledSH(e,t){for(let i=0;i<9;i++)this.coefficients[i].addScaledVector(e.coefficients[i],t);return this}scale(e){for(let t=0;t<9;t++)this.coefficients[t].multiplyScalar(e);return this}lerp(e,t){for(let i=0;i<9;i++)this.coefficients[i].lerp(e.coefficients[i],t);return this}equals(e){for(let t=0;t<9;t++)if(!this.coefficients[t].equals(e.coefficients[t]))return!1;return!0}copy(e){return this.set(e.coefficients)}clone(){return new this.constructor().copy(this)}fromArray(e,t=0){const i=this.coefficients;for(let s=0;s<9;s++)i[s].fromArray(e,t+s*3);return this}toArray(e=[],t=0){const i=this.coefficients;for(let s=0;s<9;s++)i[s].toArray(e,t+s*3);return e}static getBasisAt(e,t){const i=e.x,s=e.y,r=e.z;t[0]=.282095,t[1]=.488603*s,t[2]=.488603*r,t[3]=.488603*i,t[4]=1.092548*i*s,t[5]=1.092548*s*r,t[6]=.315392*(3*r*r-1),t[7]=1.092548*i*r,t[8]=.546274*(i*i-s*s)}}class J2 extends Jh{constructor(e=new Y2,t=1){super(void 0,t),this.isLightProbe=!0,this.sh=e}copy(e){return super.copy(e),this.sh.copy(e.sh),this}fromJSON(e){return this.intensity=e.intensity,this.sh.fromArray(e.sh),this}toJSON(e){const t=super.toJSON(e);return t.object.sh=this.sh.toArray(),t}}class K_ extends Ms{constructor(e){super(e),this.textures={}}load(e,t,i,s){const r=this,o=new Hn(r.manager);o.setPath(r.path),o.setRequestHeader(r.requestHeader),o.setWithCredentials(r.withCredentials),o.load(e,function(a){try{t(r.parse(JSON.parse(a)))}catch(c){s?s(c):console.error(c),r.manager.itemError(e)}},i,s)}parse(e){const t=this.textures;function i(r){return t[r]===void 0&&console.warn("THREE.MaterialLoader: Undefined texture",r),t[r]}const s=K_.createMaterialFromType(e.type);if(e.uuid!==void 0&&(s.uuid=e.uuid),e.name!==void 0&&(s.name=e.name),e.color!==void 0&&s.color!==void 0&&s.color.setHex(e.color),e.roughness!==void 0&&(s.roughness=e.roughness),e.metalness!==void 0&&(s.metalness=e.metalness),e.sheen!==void 0&&(s.sheen=e.sheen),e.sheenColor!==void 0&&(s.sheenColor=new ye().setHex(e.sheenColor)),e.sheenRoughness!==void 0&&(s.sheenRoughness=e.sheenRoughness),e.emissive!==void 0&&s.emissive!==void 0&&s.emissive.setHex(e.emissive),e.specular!==void 0&&s.specular!==void 0&&s.specular.setHex(e.specular),e.specularIntensity!==void 0&&(s.specularIntensity=e.specularIntensity),e.specularColor!==void 0&&s.specularColor!==void 0&&s.specularColor.setHex(e.specularColor),e.shininess!==void 0&&(s.shininess=e.shininess),e.clearcoat!==void 0&&(s.clearcoat=e.clearcoat),e.clearcoatRoughness!==void 0&&(s.clearcoatRoughness=e.clearcoatRoughness),e.iridescence!==void 0&&(s.iridescence=e.iridescence),e.iridescenceIOR!==void 0&&(s.iridescenceIOR=e.iridescenceIOR),e.iridescenceThicknessRange!==void 0&&(s.iridescenceThicknessRange=e.iridescenceThicknessRange),e.transmission!==void 0&&(s.transmission=e.transmission),e.thickness!==void 0&&(s.thickness=e.thickness),e.attenuationDistance!==void 0&&(s.attenuationDistance=e.attenuationDistance),e.attenuationColor!==void 0&&s.attenuationColor!==void 0&&s.attenuationColor.setHex(e.attenuationColor),e.anisotropy!==void 0&&(s.anisotropy=e.anisotropy),e.anisotropyRotation!==void 0&&(s.anisotropyRotation=e.anisotropyRotation),e.fog!==void 0&&(s.fog=e.fog),e.flatShading!==void 0&&(s.flatShading=e.flatShading),e.blending!==void 0&&(s.blending=e.blending),e.combine!==void 0&&(s.combine=e.combine),e.side!==void 0&&(s.side=e.side),e.shadowSide!==void 0&&(s.shadowSide=e.shadowSide),e.opacity!==void 0&&(s.opacity=e.opacity),e.transparent!==void 0&&(s.transparent=e.transparent),e.alphaTest!==void 0&&(s.alphaTest=e.alphaTest),e.alphaHash!==void 0&&(s.alphaHash=e.alphaHash),e.depthFunc!==void 0&&(s.depthFunc=e.depthFunc),e.depthTest!==void 0&&(s.depthTest=e.depthTest),e.depthWrite!==void 0&&(s.depthWrite=e.depthWrite),e.colorWrite!==void 0&&(s.colorWrite=e.colorWrite),e.blendSrc!==void 0&&(s.blendSrc=e.blendSrc),e.blendDst!==void 0&&(s.blendDst=e.blendDst),e.blendEquation!==void 0&&(s.blendEquation=e.blendEquation),e.blendSrcAlpha!==void 0&&(s.blendSrcAlpha=e.blendSrcAlpha),e.blendDstAlpha!==void 0&&(s.blendDstAlpha=e.blendDstAlpha),e.blendEquationAlpha!==void 0&&(s.blendEquationAlpha=e.blendEquationAlpha),e.blendColor!==void 0&&s.blendColor!==void 0&&s.blendColor.setHex(e.blendColor),e.blendAlpha!==void 0&&(s.blendAlpha=e.blendAlpha),e.stencilWriteMask!==void 0&&(s.stencilWriteMask=e.stencilWriteMask),e.stencilFunc!==void 0&&(s.stencilFunc=e.stencilFunc),e.stencilRef!==void 0&&(s.stencilRef=e.stencilRef),e.stencilFuncMask!==void 0&&(s.stencilFuncMask=e.stencilFuncMask),e.stencilFail!==void 0&&(s.stencilFail=e.stencilFail),e.stencilZFail!==void 0&&(s.stencilZFail=e.stencilZFail),e.stencilZPass!==void 0&&(s.stencilZPass=e.stencilZPass),e.stencilWrite!==void 0&&(s.stencilWrite=e.stencilWrite),e.wireframe!==void 0&&(s.wireframe=e.wireframe),e.wireframeLinewidth!==void 0&&(s.wireframeLinewidth=e.wireframeLinewidth),e.wireframeLinecap!==void 0&&(s.wireframeLinecap=e.wireframeLinecap),e.wireframeLinejoin!==void 0&&(s.wireframeLinejoin=e.wireframeLinejoin),e.rotation!==void 0&&(s.rotation=e.rotation),e.linewidth!==void 0&&(s.linewidth=e.linewidth),e.dashSize!==void 0&&(s.dashSize=e.dashSize),e.gapSize!==void 0&&(s.gapSize=e.gapSize),e.scale!==void 0&&(s.scale=e.scale),e.polygonOffset!==void 0&&(s.polygonOffset=e.polygonOffset),e.polygonOffsetFactor!==void 0&&(s.polygonOffsetFactor=e.polygonOffsetFactor),e.polygonOffsetUnits!==void 0&&(s.polygonOffsetUnits=e.polygonOffsetUnits),e.dithering!==void 0&&(s.dithering=e.dithering),e.alphaToCoverage!==void 0&&(s.alphaToCoverage=e.alphaToCoverage),e.premultipliedAlpha!==void 0&&(s.premultipliedAlpha=e.premultipliedAlpha),e.forceSinglePass!==void 0&&(s.forceSinglePass=e.forceSinglePass),e.visible!==void 0&&(s.visible=e.visible),e.toneMapped!==void 0&&(s.toneMapped=e.toneMapped),e.userData!==void 0&&(s.userData=e.userData),e.vertexColors!==void 0&&(typeof e.vertexColors=="number"?s.vertexColors=e.vertexColors>0:s.vertexColors=e.vertexColors),e.uniforms!==void 0)for(const r in e.uniforms){const o=e.uniforms[r];switch(s.uniforms[r]={},o.type){case"t":s.uniforms[r].value=i(o.value);break;case"c":s.uniforms[r].value=new ye().setHex(o.value);break;case"v2":s.uniforms[r].value=new ie().fromArray(o.value);break;case"v3":s.uniforms[r].value=new w().fromArray(o.value);break;case"v4":s.uniforms[r].value=new tt().fromArray(o.value);break;case"m3":s.uniforms[r].value=new Dt().fromArray(o.value);break;case"m4":s.uniforms[r].value=new Ce().fromArray(o.value);break;default:s.uniforms[r].value=o.value}}if(e.defines!==void 0&&(s.defines=e.defines),e.vertexShader!==void 0&&(s.vertexShader=e.vertexShader),e.fragmentShader!==void 0&&(s.fragmentShader=e.fragmentShader),e.glslVersion!==void 0&&(s.glslVersion=e.glslVersion),e.extensions!==void 0)for(const r in e.extensions)s.extensions[r]=e.extensions[r];if(e.lights!==void 0&&(s.lights=e.lights),e.clipping!==void 0&&(s.clipping=e.clipping),e.size!==void 0&&(s.size=e.size),e.sizeAttenuation!==void 0&&(s.sizeAttenuation=e.sizeAttenuation),e.map!==void 0&&(s.map=i(e.map)),e.matcap!==void 0&&(s.matcap=i(e.matcap)),e.alphaMap!==void 0&&(s.alphaMap=i(e.alphaMap)),e.bumpMap!==void 0&&(s.bumpMap=i(e.bumpMap)),e.bumpScale!==void 0&&(s.bumpScale=e.bumpScale),e.normalMap!==void 0&&(s.normalMap=i(e.normalMap)),e.normalMapType!==void 0&&(s.normalMapType=e.normalMapType),e.normalScale!==void 0){let r=e.normalScale;Array.isArray(r)===!1&&(r=[r,r]),s.normalScale=new ie().fromArray(r)}return e.displacementMap!==void 0&&(s.displacementMap=i(e.displacementMap)),e.displacementScale!==void 0&&(s.displacementScale=e.displacementScale),e.displacementBias!==void 0&&(s.displacementBias=e.displacementBias),e.roughnessMap!==void 0&&(s.roughnessMap=i(e.roughnessMap)),e.metalnessMap!==void 0&&(s.metalnessMap=i(e.metalnessMap)),e.emissiveMap!==void 0&&(s.emissiveMap=i(e.emissiveMap)),e.emissiveIntensity!==void 0&&(s.emissiveIntensity=e.emissiveIntensity),e.specularMap!==void 0&&(s.specularMap=i(e.specularMap)),e.specularIntensityMap!==void 0&&(s.specularIntensityMap=i(e.specularIntensityMap)),e.specularColorMap!==void 0&&(s.specularColorMap=i(e.specularColorMap)),e.envMap!==void 0&&(s.envMap=i(e.envMap)),e.envMapIntensity!==void 0&&(s.envMapIntensity=e.envMapIntensity),e.reflectivity!==void 0&&(s.reflectivity=e.reflectivity),e.refractionRatio!==void 0&&(s.refractionRatio=e.refractionRatio),e.lightMap!==void 0&&(s.lightMap=i(e.lightMap)),e.lightMapIntensity!==void 0&&(s.lightMapIntensity=e.lightMapIntensity),e.aoMap!==void 0&&(s.aoMap=i(e.aoMap)),e.aoMapIntensity!==void 0&&(s.aoMapIntensity=e.aoMapIntensity),e.gradientMap!==void 0&&(s.gradientMap=i(e.gradientMap)),e.clearcoatMap!==void 0&&(s.clearcoatMap=i(e.clearcoatMap)),e.clearcoatRoughnessMap!==void 0&&(s.clearcoatRoughnessMap=i(e.clearcoatRoughnessMap)),e.clearcoatNormalMap!==void 0&&(s.clearcoatNormalMap=i(e.clearcoatNormalMap)),e.clearcoatNormalScale!==void 0&&(s.clearcoatNormalScale=new ie().fromArray(e.clearcoatNormalScale)),e.iridescenceMap!==void 0&&(s.iridescenceMap=i(e.iridescenceMap)),e.iridescenceThicknessMap!==void 0&&(s.iridescenceThicknessMap=i(e.iridescenceThicknessMap)),e.transmissionMap!==void 0&&(s.transmissionMap=i(e.transmissionMap)),e.thicknessMap!==void 0&&(s.thicknessMap=i(e.thicknessMap)),e.anisotropyMap!==void 0&&(s.anisotropyMap=i(e.anisotropyMap)),e.sheenColorMap!==void 0&&(s.sheenColorMap=i(e.sheenColorMap)),e.sheenRoughnessMap!==void 0&&(s.sheenRoughnessMap=i(e.sheenRoughnessMap)),s}setTextures(e){return this.textures=e,this}static createMaterialFromType(e){const t={ShadowMaterial:W_,SpriteMaterial:EM,RawShaderMaterial:HA,ShaderMaterial:Et,PointsMaterial:D_,MeshPhysicalMaterial:so,MeshStandardMaterial:Ur,MeshPhongMaterial:F2,MeshToonMaterial:U2,MeshNormalMaterial:q_,MeshLambertMaterial:N2,MeshDepthMaterial:NA,MeshDistanceMaterial:SM,MeshBasicMaterial:ri,MeshMatcapMaterial:z2,LineDashedMaterial:G2,LineBasicMaterial:Ln,Material:Ot};return new t[e]}}class Ih{static decodeText(e){if(typeof TextDecoder<"u")return new TextDecoder().decode(e);let t="";for(let i=0,s=e.length;i<s;i++)t+=String.fromCharCode(e[i]);try{return decodeURIComponent(escape(t))}catch{return t}}static extractUrlBase(e){const t=e.lastIndexOf("/");return t===-1?"./":e.slice(0,t+1)}static resolveURL(e,t){return typeof e!="string"||e===""?"":(/^https?:\/\//i.test(t)&&/^\//.test(e)&&(t=t.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:t+e)}}class Z_ extends gt{constructor(){super(),this.isInstancedBufferGeometry=!0,this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(e){return super.copy(e),this.instanceCount=e.instanceCount,this}toJSON(){const e=super.toJSON();return e.instanceCount=this.instanceCount,e.isInstancedBufferGeometry=!0,e}}class K2 extends Ms{constructor(e){super(e)}load(e,t,i,s){const r=this,o=new Hn(r.manager);o.setPath(r.path),o.setRequestHeader(r.requestHeader),o.setWithCredentials(r.withCredentials),o.load(e,function(a){try{t(r.parse(JSON.parse(a)))}catch(c){s?s(c):console.error(c),r.manager.itemError(e)}},i,s)}parse(e){const t={},i={};function s(p,m){if(t[m]!==void 0)return t[m];const y=p.interleavedBuffers[m],A=r(p,y.buffer),v=Tf(y.type,A),b=new zA(v,y.stride);return b.uuid=y.uuid,t[m]=b,b}function r(p,m){if(i[m]!==void 0)return i[m];const y=p.arrayBuffers[m],A=new Uint32Array(y).buffer;return i[m]=A,A}const o=e.isInstancedBufferGeometry?new Z_:new gt,a=e.data.index;if(a!==void 0){const p=Tf(a.type,a.array);o.setIndex(new it(p,1))}const c=e.data.attributes;for(const p in c){const m=c[p];let g;if(m.isInterleavedBufferAttribute){const y=s(e.data,m.data);g=new pr(y,m.itemSize,m.offset,m.normalized)}else{const y=Tf(m.type,m.array),A=m.isInstancedBufferAttribute?Or:it;g=new A(y,m.itemSize,m.normalized)}m.name!==void 0&&(g.name=m.name),m.usage!==void 0&&g.setUsage(m.usage),o.setAttribute(p,g)}const l=e.data.morphAttributes;if(l)for(const p in l){const m=l[p],g=[];for(let y=0,A=m.length;y<A;y++){const v=m[y];let b;if(v.isInterleavedBufferAttribute){const _=s(e.data,v.data);b=new pr(_,v.itemSize,v.offset,v.normalized)}else{const _=Tf(v.type,v.array);b=new it(_,v.itemSize,v.normalized)}v.name!==void 0&&(b.name=v.name),g.push(b)}o.morphAttributes[p]=g}e.data.morphTargetsRelative&&(o.morphTargetsRelative=!0);const d=e.data.groups||e.data.drawcalls||e.data.offsets;if(d!==void 0)for(let p=0,m=d.length;p!==m;++p){const g=d[p];o.addGroup(g.start,g.count,g.materialIndex)}const f=e.data.boundingSphere;if(f!==void 0){const p=new w;f.center!==void 0&&p.fromArray(f.center),o.boundingSphere=new Mn(p,f.radius)}return e.name&&(o.name=e.name),e.userData&&(o.userData=e.userData),o}}class mW extends Ms{constructor(e){super(e)}load(e,t,i,s){const r=this,o=this.path===""?Ih.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||o;const a=new Hn(this.manager);a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,function(c){let l=null;try{l=JSON.parse(c)}catch(d){s!==void 0&&s(d),console.error("THREE:ObjectLoader: Can't parse "+e+".",d.message);return}const h=l.metadata;if(h===void 0||h.type===void 0||h.type.toLowerCase()==="geometry"){s!==void 0&&s(new Error("THREE.ObjectLoader: Can't load "+e)),console.error("THREE.ObjectLoader: Can't load "+e);return}r.parse(l,t)},i,s)}async loadAsync(e,t){const i=this,s=this.path===""?Ih.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||s;const r=new Hn(this.manager);r.setPath(this.path),r.setRequestHeader(this.requestHeader),r.setWithCredentials(this.withCredentials);const o=await r.loadAsync(e,t),a=JSON.parse(o),c=a.metadata;if(c===void 0||c.type===void 0||c.type.toLowerCase()==="geometry")throw new Error("THREE.ObjectLoader: Can't load "+e);return await i.parseAsync(a)}parse(e,t){const i=this.parseAnimations(e.animations),s=this.parseShapes(e.shapes),r=this.parseGeometries(e.geometries,s),o=this.parseImages(e.images,function(){t!==void 0&&t(l)}),a=this.parseTextures(e.textures,o),c=this.parseMaterials(e.materials,a),l=this.parseObject(e.object,r,c,a,i),h=this.parseSkeletons(e.skeletons,l);if(this.bindSkeletons(l,h),t!==void 0){let d=!1;for(const f in o)if(o[f].data instanceof HTMLImageElement){d=!0;break}d===!1&&t(l)}return l}async parseAsync(e){const t=this.parseAnimations(e.animations),i=this.parseShapes(e.shapes),s=this.parseGeometries(e.geometries,i),r=await this.parseImagesAsync(e.images),o=this.parseTextures(e.textures,r),a=this.parseMaterials(e.materials,o),c=this.parseObject(e.object,s,a,o,t),l=this.parseSkeletons(e.skeletons,c);return this.bindSkeletons(c,l),c}parseShapes(e){const t={};if(e!==void 0)for(let i=0,s=e.length;i<s;i++){const r=new Yu().fromJSON(e[i]);t[r.uuid]=r}return t}parseSkeletons(e,t){const i={},s={};if(t.traverse(function(r){r.isBone&&(s[r.uuid]=r)}),e!==void 0)for(let r=0,o=e.length;r<o;r++){const a=new Ip().fromJSON(e[r],s);i[a.uuid]=a}return i}parseGeometries(e,t){const i={};if(e!==void 0){const s=new K2;for(let r=0,o=e.length;r<o;r++){let a;const c=e[r];switch(c.type){case"BufferGeometry":case"InstancedBufferGeometry":a=s.parse(c);break;default:c.type in BP?a=BP[c.type].fromJSON(c,t):console.warn(`THREE.ObjectLoader: Unsupported geometry type "${c.type}"`)}a.uuid=c.uuid,c.name!==void 0&&(a.name=c.name),c.userData!==void 0&&(a.userData=c.userData),i[c.uuid]=a}}return i}parseMaterials(e,t){const i={},s={};if(e!==void 0){const r=new K_;r.setTextures(t);for(let o=0,a=e.length;o<a;o++){const c=e[o];i[c.uuid]===void 0&&(i[c.uuid]=r.parse(c)),s[c.uuid]=i[c.uuid]}}return s}parseAnimations(e){const t={};if(e!==void 0)for(let i=0;i<e.length;i++){const s=e[i],r=Nr.parse(s);t[r.uuid]=r}return t}parseImages(e,t){const i=this,s={};let r;function o(c){return i.manager.itemStart(c),r.load(c,function(){i.manager.itemEnd(c)},void 0,function(){i.manager.itemError(c),i.manager.itemEnd(c)})}function a(c){if(typeof c=="string"){const l=c,h=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(l)?l:i.resourcePath+l;return o(h)}else return c.data?{data:Tf(c.type,c.data),width:c.width,height:c.height}:null}if(e!==void 0&&e.length>0){const c=new X_(t);r=new nA(c),r.setCrossOrigin(this.crossOrigin);for(let l=0,h=e.length;l<h;l++){const d=e[l],f=d.url;if(Array.isArray(f)){const p=[];for(let m=0,g=f.length;m<g;m++){const y=f[m],A=a(y);A!==null&&(A instanceof HTMLImageElement?p.push(A):p.push(new io(A.data,A.width,A.height)))}s[d.uuid]=new nl(p)}else{const p=a(d.url);s[d.uuid]=new nl(p)}}}return s}async parseImagesAsync(e){const t=this,i={};let s;async function r(o){if(typeof o=="string"){const a=o,c=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(a)?a:t.resourcePath+a;return await s.loadAsync(c)}else return o.data?{data:Tf(o.type,o.data),width:o.width,height:o.height}:null}if(e!==void 0&&e.length>0){s=new nA(this.manager),s.setCrossOrigin(this.crossOrigin);for(let o=0,a=e.length;o<a;o++){const c=e[o],l=c.url;if(Array.isArray(l)){const h=[];for(let d=0,f=l.length;d<f;d++){const p=l[d],m=await r(p);m!==null&&(m instanceof HTMLImageElement?h.push(m):h.push(new io(m.data,m.width,m.height)))}i[c.uuid]=new nl(h)}else{const h=await r(c.url);i[c.uuid]=new nl(h)}}}return i}parseTextures(e,t){function i(r,o){return typeof r=="number"?r:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",r),o[r])}const s={};if(e!==void 0)for(let r=0,o=e.length;r<o;r++){const a=e[r];a.image===void 0&&console.warn('THREE.ObjectLoader: No "image" specified for',a.uuid),t[a.image]===void 0&&console.warn("THREE.ObjectLoader: Undefined image",a.image);const c=t[a.image],l=c.data;let h;Array.isArray(l)?(h=new FA,l.length===6&&(h.needsUpdate=!0)):(l&&l.data?h=new io:h=new Ft,l&&(h.needsUpdate=!0)),h.source=c,h.uuid=a.uuid,a.name!==void 0&&(h.name=a.name),a.mapping!==void 0&&(h.mapping=i(a.mapping,gW)),a.channel!==void 0&&(h.channel=a.channel),a.offset!==void 0&&h.offset.fromArray(a.offset),a.repeat!==void 0&&h.repeat.fromArray(a.repeat),a.center!==void 0&&h.center.fromArray(a.center),a.rotation!==void 0&&(h.rotation=a.rotation),a.wrap!==void 0&&(h.wrapS=i(a.wrap[0],LP),h.wrapT=i(a.wrap[1],LP)),a.format!==void 0&&(h.format=a.format),a.internalFormat!==void 0&&(h.internalFormat=a.internalFormat),a.type!==void 0&&(h.type=a.type),a.colorSpace!==void 0&&(h.colorSpace=a.colorSpace),a.encoding!==void 0&&(h.encoding=a.encoding),a.minFilter!==void 0&&(h.minFilter=i(a.minFilter,FP)),a.magFilter!==void 0&&(h.magFilter=i(a.magFilter,FP)),a.anisotropy!==void 0&&(h.anisotropy=a.anisotropy),a.flipY!==void 0&&(h.flipY=a.flipY),a.generateMipmaps!==void 0&&(h.generateMipmaps=a.generateMipmaps),a.premultiplyAlpha!==void 0&&(h.premultiplyAlpha=a.premultiplyAlpha),a.unpackAlignment!==void 0&&(h.unpackAlignment=a.unpackAlignment),a.compareFunction!==void 0&&(h.compareFunction=a.compareFunction),a.userData!==void 0&&(h.userData=a.userData),s[a.uuid]=h}return s}parseObject(e,t,i,s,r){let o;function a(f){return t[f]===void 0&&console.warn("THREE.ObjectLoader: Undefined geometry",f),t[f]}function c(f){if(f!==void 0){if(Array.isArray(f)){const p=[];for(let m=0,g=f.length;m<g;m++){const y=f[m];i[y]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",y),p.push(i[y])}return p}return i[f]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",f),i[f]}}function l(f){return s[f]===void 0&&console.warn("THREE.ObjectLoader: Undefined texture",f),s[f]}let h,d;switch(e.type){case"Scene":o=new Ws,e.background!==void 0&&(Number.isInteger(e.background)?o.background=new ye(e.background):o.background=l(e.background)),e.environment!==void 0&&(o.environment=l(e.environment)),e.fog!==void 0&&(e.fog.type==="Fog"?o.fog=new CM(e.fog.color,e.fog.near,e.fog.far):e.fog.type==="FogExp2"&&(o.fog=new P_(e.fog.color,e.fog.density)),e.fog.name!==""&&(o.fog.name=e.fog.name)),e.backgroundBlurriness!==void 0&&(o.backgroundBlurriness=e.backgroundBlurriness),e.backgroundIntensity!==void 0&&(o.backgroundIntensity=e.backgroundIntensity);break;case"PerspectiveCamera":o=new Wt(e.fov,e.aspect,e.near,e.far),e.focus!==void 0&&(o.focus=e.focus),e.zoom!==void 0&&(o.zoom=e.zoom),e.filmGauge!==void 0&&(o.filmGauge=e.filmGauge),e.filmOffset!==void 0&&(o.filmOffset=e.filmOffset),e.view!==void 0&&(o.view=Object.assign({},e.view));break;case"OrthographicCamera":o=new vc(e.left,e.right,e.top,e.bottom,e.near,e.far),e.zoom!==void 0&&(o.zoom=e.zoom),e.view!==void 0&&(o.view=Object.assign({},e.view));break;case"AmbientLight":o=new jM(e.color,e.intensity);break;case"DirectionalLight":o=new mp(e.color,e.intensity);break;case"PointLight":o=new J_(e.color,e.intensity,e.distance,e.decay);break;case"RectAreaLight":o=new X2(e.color,e.intensity,e.width,e.height);break;case"SpotLight":o=new Y_(e.color,e.intensity,e.distance,e.angle,e.penumbra,e.decay);break;case"HemisphereLight":o=new HM(e.color,e.groundColor,e.intensity);break;case"LightProbe":o=new J2().fromJSON(e);break;case"SkinnedMesh":h=a(e.geometry),d=c(e.material),o=new cc(h,d),e.bindMode!==void 0&&(o.bindMode=e.bindMode),e.bindMatrix!==void 0&&o.bindMatrix.fromArray(e.bindMatrix),e.skeleton!==void 0&&(o.skeleton=e.skeleton);break;case"Mesh":h=a(e.geometry),d=c(e.material),o=new me(h,d);break;case"InstancedMesh":h=a(e.geometry),d=c(e.material);const f=e.count,p=e.instanceMatrix,m=e.instanceColor;o=new B_(h,d,f),o.instanceMatrix=new Or(new Float32Array(p.array),16),m!==void 0&&(o.instanceColor=new Or(new Float32Array(m.array),m.itemSize));break;case"BatchedMesh":h=a(e.geometry),d=c(e.material),o=new C2(e.maxGeometryCount,e.maxVertexCount,e.maxIndexCount,d),o.geometry=h,o.perObjectFrustumCulled=e.perObjectFrustumCulled,o.sortObjects=e.sortObjects,o._drawRanges=e.drawRanges,o._reservedRanges=e.reservedRanges,o._visibility=e.visibility,o._active=e.active,o._bounds=e.bounds.map(g=>{const y=new Mi;y.min.fromArray(g.boxMin),y.max.fromArray(g.boxMax);const A=new Mn;return A.radius=g.sphereRadius,A.center.fromArray(g.sphereCenter),{boxInitialized:g.boxInitialized,box:y,sphereInitialized:g.sphereInitialized,sphere:A}}),o._maxGeometryCount=e.maxGeometryCount,o._maxVertexCount=e.maxVertexCount,o._maxIndexCount=e.maxIndexCount,o._geometryInitialized=e.geometryInitialized,o._geometryCount=e.geometryCount,o._matricesTexture=l(e.matricesTexture.uuid);break;case"LOD":o=new TM;break;case"Line":o=new Sn(a(e.geometry),c(e.material));break;case"LineLoop":o=new MM(a(e.geometry),c(e.material));break;case"LineSegments":o=new Go(a(e.geometry),c(e.material));break;case"PointCloud":case"Points":o=new IM(a(e.geometry),c(e.material));break;case"Sprite":o=new S2(c(e.material));break;case"Group":o=new fr;break;case"Bone":o=new GA;break;default:o=new ge}if(o.uuid=e.uuid,e.name!==void 0&&(o.name=e.name),e.matrix!==void 0?(o.matrix.fromArray(e.matrix),e.matrixAutoUpdate!==void 0&&(o.matrixAutoUpdate=e.matrixAutoUpdate),o.matrixAutoUpdate&&o.matrix.decompose(o.position,o.quaternion,o.scale)):(e.position!==void 0&&o.position.fromArray(e.position),e.rotation!==void 0&&o.rotation.fromArray(e.rotation),e.quaternion!==void 0&&o.quaternion.fromArray(e.quaternion),e.scale!==void 0&&o.scale.fromArray(e.scale)),e.up!==void 0&&o.up.fromArray(e.up),e.castShadow!==void 0&&(o.castShadow=e.castShadow),e.receiveShadow!==void 0&&(o.receiveShadow=e.receiveShadow),e.shadow&&(e.shadow.bias!==void 0&&(o.shadow.bias=e.shadow.bias),e.shadow.normalBias!==void 0&&(o.shadow.normalBias=e.shadow.normalBias),e.shadow.radius!==void 0&&(o.shadow.radius=e.shadow.radius),e.shadow.mapSize!==void 0&&o.shadow.mapSize.fromArray(e.shadow.mapSize),e.shadow.camera!==void 0&&(o.shadow.camera=this.parseObject(e.shadow.camera))),e.visible!==void 0&&(o.visible=e.visible),e.frustumCulled!==void 0&&(o.frustumCulled=e.frustumCulled),e.renderOrder!==void 0&&(o.renderOrder=e.renderOrder),e.userData!==void 0&&(o.userData=e.userData),e.layers!==void 0&&(o.layers.mask=e.layers),e.children!==void 0){const f=e.children;for(let p=0;p<f.length;p++)o.add(this.parseObject(f[p],t,i,s,r))}if(e.animations!==void 0){const f=e.animations;for(let p=0;p<f.length;p++){const m=f[p];o.animations.push(r[m])}}if(e.type==="LOD"){e.autoUpdate!==void 0&&(o.autoUpdate=e.autoUpdate);const f=e.levels;for(let p=0;p<f.length;p++){const m=f[p],g=o.getObjectByProperty("uuid",m.object);g!==void 0&&o.addLevel(g,m.distance,m.hysteresis)}}return o}bindSkeletons(e,t){Object.keys(t).length!==0&&e.traverse(function(i){if(i.isSkinnedMesh===!0&&i.skeleton!==void 0){const s=t[i.skeleton];s===void 0?console.warn("THREE.ObjectLoader: No skeleton found with UUID:",i.skeleton):i.bind(s,i.bindMatrix)}})}}const gW={UVMapping:x_,CubeReflectionMapping:_l,CubeRefractionMapping:Nh,EquirectangularReflectionMapping:Oo,EquirectangularRefractionMapping:up,CubeUVReflectionMapping:Sp},LP={RepeatWrapping:Lo,ClampToEdgeWrapping:ts,MirroredRepeatWrapping:hd},FP={NearestFilter:Nt,NearestMipmapNearestFilter:dp,NearestMipmapLinearFilter:Zc,LinearFilter:St,LinearMipmapNearestFilter:Wu,LinearMipmapLinearFilter:kr};class Z2 extends Ms{constructor(e){super(e),this.isImageBitmapLoader=!0,typeof createImageBitmap>"u"&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),typeof fetch>"u"&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(e){return this.options=e,this}load(e,t,i,s){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const r=this,o=rl.get(e);if(o!==void 0){if(r.manager.itemStart(e),o.then){o.then(l=>{t&&t(l),r.manager.itemEnd(e)}).catch(l=>{s&&s(l)});return}return setTimeout(function(){t&&t(o),r.manager.itemEnd(e)},0),o}const a={};a.credentials=this.crossOrigin==="anonymous"?"same-origin":"include",a.headers=this.requestHeader;const c=fetch(e,a).then(function(l){return l.blob()}).then(function(l){return createImageBitmap(l,Object.assign(r.options,{colorSpaceConversion:"none"}))}).then(function(l){return rl.add(e,l),t&&t(l),r.manager.itemEnd(e),l}).catch(function(l){s&&s(l),rl.remove(e),r.manager.itemError(e),r.manager.itemEnd(e)});rl.add(e,c),r.manager.itemStart(e)}}let yy;class WM{static getContext(){return yy===void 0&&(yy=new(window.AudioContext||window.webkitAudioContext)),yy}static setContext(e){yy=e}}class ub extends Ms{constructor(e){super(e)}load(e,t,i,s){const r=this,o=new Hn(this.manager);o.setResponseType("arraybuffer"),o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,function(c){try{const l=c.slice(0);WM.getContext().decodeAudioData(l,function(d){t(d)}).catch(a)}catch(l){a(l)}},i,s);function a(c){s?s(c):console.error(c),r.manager.itemError(e)}}}const UP=new Ce,NP=new Ce,uu=new Ce;class AW{constructor(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new Wt,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new Wt,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}update(e){const t=this._cache;if(t.focus!==e.focus||t.fov!==e.fov||t.aspect!==e.aspect*this.aspect||t.near!==e.near||t.far!==e.far||t.zoom!==e.zoom||t.eyeSep!==this.eyeSep){t.focus=e.focus,t.fov=e.fov,t.aspect=e.aspect*this.aspect,t.near=e.near,t.far=e.far,t.zoom=e.zoom,t.eyeSep=this.eyeSep,uu.copy(e.projectionMatrix);const s=t.eyeSep/2,r=s*t.near/t.focus,o=t.near*Math.tan(qu*t.fov*.5)/t.zoom;let a,c;NP.elements[12]=-s,UP.elements[12]=s,a=-o*t.aspect+r,c=o*t.aspect+r,uu.elements[0]=2*t.near/(c-a),uu.elements[8]=(c+a)/(c-a),this.cameraL.projectionMatrix.copy(uu),a=-o*t.aspect-r,c=o*t.aspect-r,uu.elements[0]=2*t.near/(c-a),uu.elements[8]=(c+a)/(c-a),this.cameraR.projectionMatrix.copy(uu)}this.cameraL.matrixWorld.copy(e.matrixWorld).multiply(NP),this.cameraR.matrixWorld.copy(e.matrixWorld).multiply(UP)}}class qM{constructor(e=!0){this.autoStart=e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=zP(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const t=zP();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}}function zP(){return(typeof performance>"u"?Date:performance).now()}const Ea=new w,GP=new Me,vW=new w,du=new w;let $2=class extends ge{constructor(){super(),this.type="AudioListener",this.context=WM.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new qM}getInput(){return this.gain}removeFilter(){return this.filter!==null&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}getFilter(){return this.filter}setFilter(e){return this.filter!==null?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=e,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}getMasterVolume(){return this.gain.gain.value}setMasterVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}updateMatrixWorld(e){super.updateMatrixWorld(e);const t=this.context.listener,i=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(Ea,GP,vW),!(!Number.isFinite(Ea.x)||!Number.isFinite(Ea.y)||!Number.isFinite(Ea.z)))if(du.set(0,0,-1).applyQuaternion(GP),t.positionX){const s=this.context.currentTime+this.timeDelta;t.positionX.linearRampToValueAtTime(Ea.x,s),t.positionY.linearRampToValueAtTime(Ea.y,s),t.positionZ.linearRampToValueAtTime(Ea.z,s),t.forwardX.linearRampToValueAtTime(du.x,s),t.forwardY.linearRampToValueAtTime(du.y,s),t.forwardZ.linearRampToValueAtTime(du.z,s),t.upX.linearRampToValueAtTime(i.x,s),t.upY.linearRampToValueAtTime(i.y,s),t.upZ.linearRampToValueAtTime(i.z,s)}else t.setPosition(Ea.x,Ea.y,Ea.z),t.setOrientation(du.x,du.y,du.z,i.x,i.y,i.z)}},XM=class extends ge{constructor(e){super(),this.type="Audio",this.listener=e,this.context=e.context,this.gain=this.context.createGain(),this.gain.connect(e.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this}setMediaElementSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(e),this.connect(),this}setMediaStreamSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(e),this.connect(),this}setBuffer(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this}play(e=0){if(this.isPlaying===!0){console.warn("THREE.Audio: Audio is already playing.");return}if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}this._startedAt=this.context.currentTime+e;const t=this.context.createBufferSource();return t.buffer=this.buffer,t.loop=this.loop,t.loopStart=this.loopStart,t.loopEnd=this.loopEnd,t.onended=this.onEnded.bind(this),t.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=t,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.isPlaying===!0&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,this.loop===!0&&(this._progress=this._progress%(this.duration||(this.buffer?this.buffer.duration:Number.MAX_VALUE))),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this}stop(){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this._progress=0,this.source!==null&&(this.source.stop(),this.source.onended=null),this.isPlaying=!1,this}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this._connected!==!1){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}}getFilters(){return this.filters}setFilters(e){return e||(e=[]),this._connected===!0?(this.disconnect(),this.filters=e.slice(),this.connect()):this.filters=e.slice(),this}setDetune(e){return this.detune=e,this.isPlaying===!0&&this.source.detune!==void 0&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(e){return this.setFilters(e?[e]:[])}setPlaybackRate(e){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.playbackRate=e,this.isPlaying===!0&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1}getLoop(){return this.hasPlaybackControl===!1?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(e){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.loop=e,this.isPlaying===!0&&(this.source.loop=this.loop),this}setLoopStart(e){return this.loopStart=e,this}setLoopEnd(e){return this.loopEnd=e,this}getVolume(){return this.gain.gain.value}setVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}};const fu=new w,VP=new Me,yW=new w,pu=new w;class eF extends XM{constructor(e){super(e),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}connect(){super.connect(),this.panner.connect(this.gain)}disconnect(){super.disconnect(),this.panner.disconnect(this.gain)}getOutput(){return this.panner}getRefDistance(){return this.panner.refDistance}setRefDistance(e){return this.panner.refDistance=e,this}getRolloffFactor(){return this.panner.rolloffFactor}setRolloffFactor(e){return this.panner.rolloffFactor=e,this}getDistanceModel(){return this.panner.distanceModel}setDistanceModel(e){return this.panner.distanceModel=e,this}getMaxDistance(){return this.panner.maxDistance}setMaxDistance(e){return this.panner.maxDistance=e,this}setDirectionalCone(e,t,i){return this.panner.coneInnerAngle=e,this.panner.coneOuterAngle=t,this.panner.coneOuterGain=i,this}updateMatrixWorld(e){if(super.updateMatrixWorld(e),this.hasPlaybackControl===!0&&this.isPlaying===!1)return;this.matrixWorld.decompose(fu,VP,yW),pu.set(0,0,1).applyQuaternion(VP);const t=this.panner;if(t.positionX){const i=this.context.currentTime+this.listener.timeDelta;t.positionX.linearRampToValueAtTime(fu.x,i),t.positionY.linearRampToValueAtTime(fu.y,i),t.positionZ.linearRampToValueAtTime(fu.z,i),t.orientationX.linearRampToValueAtTime(pu.x,i),t.orientationY.linearRampToValueAtTime(pu.y,i),t.orientationZ.linearRampToValueAtTime(pu.z,i)}else t.setPosition(fu.x,fu.y,fu.z),t.setOrientation(pu.x,pu.y,pu.z)}}class bW{constructor(e,t=2048){this.analyser=e.context.createAnalyser(),this.analyser.fftSize=t,this.data=new Uint8Array(this.analyser.frequencyBinCount),e.getOutput().connect(this.analyser)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data}getAverageFrequency(){let e=0;const t=this.getFrequencyData();for(let i=0;i<t.length;i++)e+=t[i];return e/t.length}}class tF{constructor(e,t,i){this.binding=e,this.valueSize=i;let s,r,o;switch(t){case"quaternion":s=this._slerp,r=this._slerpAdditive,o=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(i*6),this._workIndex=5;break;case"string":case"bool":s=this._select,r=this._select,o=this._setAdditiveIdentityOther,this.buffer=new Array(i*5);break;default:s=this._lerp,r=this._lerpAdditive,o=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(i*5)}this._mixBufferRegion=s,this._mixBufferRegionAdditive=r,this._setIdentity=o,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(e,t){const i=this.buffer,s=this.valueSize,r=e*s+s;let o=this.cumulativeWeight;if(o===0){for(let a=0;a!==s;++a)i[r+a]=i[a];o=t}else{o+=t;const a=t/o;this._mixBufferRegion(i,r,0,a,s)}this.cumulativeWeight=o}accumulateAdditive(e){const t=this.buffer,i=this.valueSize,s=i*this._addIndex;this.cumulativeWeightAdditive===0&&this._setIdentity(),this._mixBufferRegionAdditive(t,s,0,e,i),this.cumulativeWeightAdditive+=e}apply(e){const t=this.valueSize,i=this.buffer,s=e*t+t,r=this.cumulativeWeight,o=this.cumulativeWeightAdditive,a=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,r<1){const c=t*this._origIndex;this._mixBufferRegion(i,s,c,1-r,t)}o>0&&this._mixBufferRegionAdditive(i,s,this._addIndex*t,1,t);for(let c=t,l=t+t;c!==l;++c)if(i[c]!==i[c+t]){a.setValue(i,s);break}}saveOriginalState(){const e=this.binding,t=this.buffer,i=this.valueSize,s=i*this._origIndex;e.getValue(t,s);for(let r=i,o=s;r!==o;++r)t[r]=t[s+r%i];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const e=this.valueSize*3;this.binding.setValue(this.buffer,e)}_setAdditiveIdentityNumeric(){const e=this._addIndex*this.valueSize,t=e+this.valueSize;for(let i=e;i<t;i++)this.buffer[i]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const e=this._origIndex*this.valueSize,t=this._addIndex*this.valueSize;for(let i=0;i<this.valueSize;i++)this.buffer[t+i]=this.buffer[e+i]}_select(e,t,i,s,r){if(s>=.5)for(let o=0;o!==r;++o)e[t+o]=e[i+o]}_slerp(e,t,i,s){Me.slerpFlat(e,t,e,t,e,i,s)}_slerpAdditive(e,t,i,s,r){const o=this._workIndex*r;Me.multiplyQuaternionsFlat(e,o,e,t,e,i),Me.slerpFlat(e,t,e,t,e,o,s)}_lerp(e,t,i,s,r){const o=1-s;for(let a=0;a!==r;++a){const c=t+a;e[c]=e[c]*o+e[i+a]*s}}_lerpAdditive(e,t,i,s,r){for(let o=0;o!==r;++o){const a=t+o;e[a]=e[a]+e[i+o]*s}}}const YM="\\[\\]\\.:\\/",_W=new RegExp("["+YM+"]","g"),JM="[^"+YM+"]",xW="[^"+YM.replace("\\.","")+"]",wW=/((?:WC+[\/:])*)/.source.replace("WC",JM),SW=/(WCOD+)?/.source.replace("WCOD",xW),CW=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",JM),EW=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",JM),TW=new RegExp("^"+wW+SW+CW+EW+"$"),MW=["material","materials","bones","map"];class IW{constructor(e,t,i){const s=i||qt.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,s)}getValue(e,t){this.bind();const i=this._targetGroup.nCachedObjects_,s=this._bindings[i];s!==void 0&&s.getValue(e,t)}setValue(e,t){const i=this._bindings;for(let s=this._targetGroup.nCachedObjects_,r=i.length;s!==r;++s)i[s].setValue(e,t)}bind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,i=e.length;t!==i;++t)e[t].bind()}unbind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,i=e.length;t!==i;++t)e[t].unbind()}}class qt{constructor(e,t,i){this.path=t,this.parsedPath=i||qt.parseTrackName(t),this.node=qt.findNode(e,this.parsedPath.nodeName),this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,t,i){return e&&e.isAnimationObjectGroup?new qt.Composite(e,t,i):new qt(e,t,i)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(_W,"")}static parseTrackName(e){const t=TW.exec(e);if(t===null)throw new Error("PropertyBinding: Cannot parse trackName: "+e);const i={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},s=i.nodeName&&i.nodeName.lastIndexOf(".");if(s!==void 0&&s!==-1){const r=i.nodeName.substring(s+1);MW.indexOf(r)!==-1&&(i.nodeName=i.nodeName.substring(0,s),i.objectName=r)}if(i.propertyName===null||i.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return i}static findNode(e,t){if(t===void 0||t===""||t==="."||t===-1||t===e.name||t===e.uuid)return e;if(e.skeleton){const i=e.skeleton.getBoneByName(t);if(i!==void 0)return i}if(e.children){const i=function(r){for(let o=0;o<r.length;o++){const a=r[o];if(a.name===t||a.uuid===t)return a;const c=i(a.children);if(c)return c}return null},s=i(e.children);if(s)return s}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,t){e[t]=this.targetObject[this.propertyName]}_getValue_array(e,t){const i=this.resolvedProperty;for(let s=0,r=i.length;s!==r;++s)e[t++]=i[s]}_getValue_arrayElement(e,t){e[t]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,t){this.resolvedProperty.toArray(e,t)}_setValue_direct(e,t){this.targetObject[this.propertyName]=e[t]}_setValue_direct_setNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(e,t){const i=this.resolvedProperty;for(let s=0,r=i.length;s!==r;++s)i[s]=e[t++]}_setValue_array_setNeedsUpdate(e,t){const i=this.resolvedProperty;for(let s=0,r=i.length;s!==r;++s)i[s]=e[t++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(e,t){const i=this.resolvedProperty;for(let s=0,r=i.length;s!==r;++s)i[s]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(e,t){this.resolvedProperty[this.propertyIndex]=e[t]}_setValue_arrayElement_setNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,t){this.resolvedProperty.fromArray(e,t)}_setValue_fromArray_setNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,t){this.bind(),this.getValue(e,t)}_setValue_unbound(e,t){this.bind(),this.setValue(e,t)}bind(){let e=this.node;const t=this.parsedPath,i=t.objectName,s=t.propertyName;let r=t.propertyIndex;if(e||(e=qt.findNode(this.rootNode,t.nodeName),this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e){console.warn("THREE.PropertyBinding: No target node found for track: "+this.path+".");return}if(i){let l=t.objectIndex;switch(i){case"materials":if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.materials){console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);return}e=e.material.materials;break;case"bones":if(!e.skeleton){console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);return}e=e.skeleton.bones;for(let h=0;h<e.length;h++)if(e[h].name===l){l=h;break}break;case"map":if("map"in e){e=e.map;break}if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.map){console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);return}e=e.material.map;break;default:if(e[i]===void 0){console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);return}e=e[i]}if(l!==void 0){if(e[l]===void 0){console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);return}e=e[l]}}const o=e[s];if(o===void 0){const l=t.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+l+"."+s+" but it wasn't found.",e);return}let a=this.Versioning.None;this.targetObject=e,e.needsUpdate!==void 0?a=this.Versioning.NeedsUpdate:e.matrixWorldNeedsUpdate!==void 0&&(a=this.Versioning.MatrixWorldNeedsUpdate);let c=this.BindingType.Direct;if(r!==void 0){if(s==="morphTargetInfluences"){if(!e.geometry){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);return}if(!e.geometry.morphAttributes){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);return}e.morphTargetDictionary[r]!==void 0&&(r=e.morphTargetDictionary[r])}c=this.BindingType.ArrayElement,this.resolvedProperty=o,this.propertyIndex=r}else o.fromArray!==void 0&&o.toArray!==void 0?(c=this.BindingType.HasFromToArray,this.resolvedProperty=o):Array.isArray(o)?(c=this.BindingType.EntireArray,this.resolvedProperty=o):this.propertyName=s;this.getValue=this.GetterByBindingType[c],this.setValue=this.SetterByBindingTypeAndVersioning[c][a]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}qt.Composite=IW;qt.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3};qt.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2};qt.prototype.GetterByBindingType=[qt.prototype._getValue_direct,qt.prototype._getValue_array,qt.prototype._getValue_arrayElement,qt.prototype._getValue_toArray];qt.prototype.SetterByBindingTypeAndVersioning=[[qt.prototype._setValue_direct,qt.prototype._setValue_direct_setNeedsUpdate,qt.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[qt.prototype._setValue_array,qt.prototype._setValue_array_setNeedsUpdate,qt.prototype._setValue_array_setMatrixWorldNeedsUpdate],[qt.prototype._setValue_arrayElement,qt.prototype._setValue_arrayElement_setNeedsUpdate,qt.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[qt.prototype._setValue_fromArray,qt.prototype._setValue_fromArray_setNeedsUpdate,qt.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class RW{constructor(){this.isAnimationObjectGroup=!0,this.uuid=to(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;const e={};this._indicesByUUID=e;for(let i=0,s=arguments.length;i!==s;++i)e[arguments[i].uuid]=i;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};const t=this;this.stats={objects:{get total(){return t._objects.length},get inUse(){return this.total-t.nCachedObjects_}},get bindingsPerObject(){return t._bindings.length}}}add(){const e=this._objects,t=this._indicesByUUID,i=this._paths,s=this._parsedPaths,r=this._bindings,o=r.length;let a,c=e.length,l=this.nCachedObjects_;for(let h=0,d=arguments.length;h!==d;++h){const f=arguments[h],p=f.uuid;let m=t[p];if(m===void 0){m=c++,t[p]=m,e.push(f);for(let g=0,y=o;g!==y;++g)r[g].push(new qt(f,i[g],s[g]))}else if(m<l){a=e[m];const g=--l,y=e[g];t[y.uuid]=m,e[m]=y,t[p]=g,e[g]=f;for(let A=0,v=o;A!==v;++A){const b=r[A],_=b[g];let T=b[m];b[m]=_,T===void 0&&(T=new qt(f,i[A],s[A])),b[g]=T}}else e[m]!==a&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=l}remove(){const e=this._objects,t=this._indicesByUUID,i=this._bindings,s=i.length;let r=this.nCachedObjects_;for(let o=0,a=arguments.length;o!==a;++o){const c=arguments[o],l=c.uuid,h=t[l];if(h!==void 0&&h>=r){const d=r++,f=e[d];t[f.uuid]=h,e[h]=f,t[l]=d,e[d]=c;for(let p=0,m=s;p!==m;++p){const g=i[p],y=g[d],A=g[h];g[h]=y,g[d]=A}}}this.nCachedObjects_=r}uncache(){const e=this._objects,t=this._indicesByUUID,i=this._bindings,s=i.length;let r=this.nCachedObjects_,o=e.length;for(let a=0,c=arguments.length;a!==c;++a){const l=arguments[a],h=l.uuid,d=t[h];if(d!==void 0)if(delete t[h],d<r){const f=--r,p=e[f],m=--o,g=e[m];t[p.uuid]=d,e[d]=p,t[g.uuid]=f,e[f]=g,e.pop();for(let y=0,A=s;y!==A;++y){const v=i[y],b=v[f],_=v[m];v[d]=b,v[f]=_,v.pop()}}else{const f=--o,p=e[f];f>0&&(t[p.uuid]=d),e[d]=p,e.pop();for(let m=0,g=s;m!==g;++m){const y=i[m];y[d]=y[f],y.pop()}}}this.nCachedObjects_=r}subscribe_(e,t){const i=this._bindingsIndicesByPath;let s=i[e];const r=this._bindings;if(s!==void 0)return r[s];const o=this._paths,a=this._parsedPaths,c=this._objects,l=c.length,h=this.nCachedObjects_,d=new Array(l);s=r.length,i[e]=s,o.push(e),a.push(t),r.push(d);for(let f=h,p=c.length;f!==p;++f){const m=c[f];d[f]=new qt(m,e,t)}return d}unsubscribe_(e){const t=this._bindingsIndicesByPath,i=t[e];if(i!==void 0){const s=this._paths,r=this._parsedPaths,o=this._bindings,a=o.length-1,c=o[a],l=e[a];t[l]=i,o[i]=c,o.pop(),r[i]=r[a],r.pop(),s[i]=s[a],s.pop()}}}class iF{constructor(e,t,i=null,s=t.blendMode){this._mixer=e,this._clip=t,this._localRoot=i,this.blendMode=s;const r=t.tracks,o=r.length,a=new Array(o),c={endingStart:Lu,endingEnd:Lu};for(let l=0;l!==o;++l){const h=r[l].createInterpolant(null);a[l]=h,h.settings=c}this._interpolantSettings=c,this._interpolants=a,this._propertyBindings=new Array(o),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=fM,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&this.timeScale!==0&&this._startTime===null&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(e){return this._startTime=e,this}setLoop(e,t){return this.loop=e,this.repetitions=t,this}setEffectiveWeight(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(e){return this._scheduleFading(e,0,1)}fadeOut(e){return this._scheduleFading(e,1,0)}crossFadeFrom(e,t,i){if(e.fadeOut(t),this.fadeIn(t),i){const s=this._clip.duration,r=e._clip.duration,o=r/s,a=s/r;e.warp(1,o,t),this.warp(a,1,t)}return this}crossFadeTo(e,t,i){return e.crossFadeFrom(this,t,i)}stopFading(){const e=this._weightInterpolant;return e!==null&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}setEffectiveTimeScale(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(e){return this.timeScale=this._clip.duration/e,this.stopWarping()}syncWith(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()}halt(e){return this.warp(this._effectiveTimeScale,0,e)}warp(e,t,i){const s=this._mixer,r=s.time,o=this.timeScale;let a=this._timeScaleInterpolant;a===null&&(a=s._lendControlInterpolant(),this._timeScaleInterpolant=a);const c=a.parameterPositions,l=a.sampleValues;return c[0]=r,c[1]=r+i,l[0]=e/o,l[1]=t/o,this}stopWarping(){const e=this._timeScaleInterpolant;return e!==null&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(e,t,i,s){if(!this.enabled){this._updateWeight(e);return}const r=this._startTime;if(r!==null){const c=(e-r)*i;c<0||i===0?t=0:(this._startTime=null,t=i*c)}t*=this._updateTimeScale(e);const o=this._updateTime(t),a=this._updateWeight(e);if(a>0){const c=this._interpolants,l=this._propertyBindings;switch(this.blendMode){case pM:for(let h=0,d=c.length;h!==d;++h)c[h].evaluate(o),l[h].accumulateAdditive(a);break;case E_:default:for(let h=0,d=c.length;h!==d;++h)c[h].evaluate(o),l[h].accumulate(s,a)}}}_updateWeight(e){let t=0;if(this.enabled){t=this.weight;const i=this._weightInterpolant;if(i!==null){const s=i.evaluate(e)[0];t*=s,e>i.parameterPositions[1]&&(this.stopFading(),s===0&&(this.enabled=!1))}}return this._effectiveWeight=t,t}_updateTimeScale(e){let t=0;if(!this.paused){t=this.timeScale;const i=this._timeScaleInterpolant;if(i!==null){const s=i.evaluate(e)[0];t*=s,e>i.parameterPositions[1]&&(this.stopWarping(),t===0?this.paused=!0:this.timeScale=t)}}return this._effectiveTimeScale=t,t}_updateTime(e){const t=this._clip.duration,i=this.loop;let s=this.time+e,r=this._loopCount;const o=i===UL;if(e===0)return r===-1?s:o&&(r&1)===1?t-s:s;if(i===jg){r===-1&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(s>=t)s=t;else if(s<0)s=0;else{this.time=s;break e}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=s,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(r===-1&&(e>=0?(r=0,this._setEndings(!0,this.repetitions===0,o)):this._setEndings(this.repetitions===0,!0,o)),s>=t||s<0){const a=Math.floor(s/t);s-=t*a,r+=Math.abs(a);const c=this.repetitions-r;if(c<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,s=e>0?t:0,this.time=s,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(c===1){const l=e<0;this._setEndings(l,!l,o)}else this._setEndings(!1,!1,o);this._loopCount=r,this.time=s,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:a})}}else this.time=s;if(o&&(r&1)===1)return t-s}return s}_setEndings(e,t,i){const s=this._interpolantSettings;i?(s.endingStart=Fu,s.endingEnd=Fu):(e?s.endingStart=this.zeroSlopeAtStart?Fu:Lu:s.endingStart=Wg,t?s.endingEnd=this.zeroSlopeAtEnd?Fu:Lu:s.endingEnd=Wg)}_scheduleFading(e,t,i){const s=this._mixer,r=s.time;let o=this._weightInterpolant;o===null&&(o=s._lendControlInterpolant(),this._weightInterpolant=o);const a=o.parameterPositions,c=o.sampleValues;return a[0]=r,c[0]=t,a[1]=r+e,c[1]=i,this}}const PW=new Float32Array(1);class $_ extends ls{constructor(e){super(),this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(e,t){const i=e._localRoot||this._root,s=e._clip.tracks,r=s.length,o=e._propertyBindings,a=e._interpolants,c=i.uuid,l=this._bindingsByRootAndName;let h=l[c];h===void 0&&(h={},l[c]=h);for(let d=0;d!==r;++d){const f=s[d],p=f.name;let m=h[p];if(m!==void 0)++m.referenceCount,o[d]=m;else{if(m=o[d],m!==void 0){m._cacheIndex===null&&(++m.referenceCount,this._addInactiveBinding(m,c,p));continue}const g=t&&t._propertyBindings[d].binding.parsedPath;m=new tF(qt.create(i,p,g),f.ValueTypeName,f.getValueSize()),++m.referenceCount,this._addInactiveBinding(m,c,p),o[d]=m}a[d].resultBuffer=m.buffer}}_activateAction(e){if(!this._isActiveAction(e)){if(e._cacheIndex===null){const i=(e._localRoot||this._root).uuid,s=e._clip.uuid,r=this._actionsByClip[s];this._bindAction(e,r&&r.knownActions[0]),this._addInactiveAction(e,s,i)}const t=e._propertyBindings;for(let i=0,s=t.length;i!==s;++i){const r=t[i];r.useCount++===0&&(this._lendBinding(r),r.saveOriginalState())}this._lendAction(e)}}_deactivateAction(e){if(this._isActiveAction(e)){const t=e._propertyBindings;for(let i=0,s=t.length;i!==s;++i){const r=t[i];--r.useCount===0&&(r.restoreOriginalState(),this._takeBackBinding(r))}this._takeBackAction(e)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}}_isActiveAction(e){const t=e._cacheIndex;return t!==null&&t<this._nActiveActions}_addInactiveAction(e,t,i){const s=this._actions,r=this._actionsByClip;let o=r[t];if(o===void 0)o={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,r[t]=o;else{const a=o.knownActions;e._byClipCacheIndex=a.length,a.push(e)}e._cacheIndex=s.length,s.push(e),o.actionByRoot[i]=e}_removeInactiveAction(e){const t=this._actions,i=t[t.length-1],s=e._cacheIndex;i._cacheIndex=s,t[s]=i,t.pop(),e._cacheIndex=null;const r=e._clip.uuid,o=this._actionsByClip,a=o[r],c=a.knownActions,l=c[c.length-1],h=e._byClipCacheIndex;l._byClipCacheIndex=h,c[h]=l,c.pop(),e._byClipCacheIndex=null;const d=a.actionByRoot,f=(e._localRoot||this._root).uuid;delete d[f],c.length===0&&delete o[r],this._removeInactiveBindingsForAction(e)}_removeInactiveBindingsForAction(e){const t=e._propertyBindings;for(let i=0,s=t.length;i!==s;++i){const r=t[i];--r.referenceCount===0&&this._removeInactiveBinding(r)}}_lendAction(e){const t=this._actions,i=e._cacheIndex,s=this._nActiveActions++,r=t[s];e._cacheIndex=s,t[s]=e,r._cacheIndex=i,t[i]=r}_takeBackAction(e){const t=this._actions,i=e._cacheIndex,s=--this._nActiveActions,r=t[s];e._cacheIndex=s,t[s]=e,r._cacheIndex=i,t[i]=r}_addInactiveBinding(e,t,i){const s=this._bindingsByRootAndName,r=this._bindings;let o=s[t];o===void 0&&(o={},s[t]=o),o[i]=e,e._cacheIndex=r.length,r.push(e)}_removeInactiveBinding(e){const t=this._bindings,i=e.binding,s=i.rootNode.uuid,r=i.path,o=this._bindingsByRootAndName,a=o[s],c=t[t.length-1],l=e._cacheIndex;c._cacheIndex=l,t[l]=c,t.pop(),delete a[r],Object.keys(a).length===0&&delete o[s]}_lendBinding(e){const t=this._bindings,i=e._cacheIndex,s=this._nActiveBindings++,r=t[s];e._cacheIndex=s,t[s]=e,r._cacheIndex=i,t[i]=r}_takeBackBinding(e){const t=this._bindings,i=e._cacheIndex,s=--this._nActiveBindings,r=t[s];e._cacheIndex=s,t[s]=e,r._cacheIndex=i,t[i]=r}_lendControlInterpolant(){const e=this._controlInterpolants,t=this._nActiveControlInterpolants++;let i=e[t];return i===void 0&&(i=new zM(new Float32Array(2),new Float32Array(2),1,PW),i.__cacheIndex=t,e[t]=i),i}_takeBackControlInterpolant(e){const t=this._controlInterpolants,i=e.__cacheIndex,s=--this._nActiveControlInterpolants,r=t[s];e.__cacheIndex=s,t[s]=e,r.__cacheIndex=i,t[i]=r}clipAction(e,t,i){const s=t||this._root,r=s.uuid;let o=typeof e=="string"?Nr.findByName(s,e):e;const a=o!==null?o.uuid:e,c=this._actionsByClip[a];let l=null;if(i===void 0&&(o!==null?i=o.blendMode:i=E_),c!==void 0){const d=c.actionByRoot[r];if(d!==void 0&&d.blendMode===i)return d;l=c.knownActions[0],o===null&&(o=l._clip)}if(o===null)return null;const h=new iF(this,o,t,i);return this._bindAction(h,l),this._addInactiveAction(h,a,r),h}existingAction(e,t){const i=t||this._root,s=i.uuid,r=typeof e=="string"?Nr.findByName(i,e):e,o=r?r.uuid:e,a=this._actionsByClip[o];return a!==void 0&&a.actionByRoot[s]||null}stopAllAction(){const e=this._actions,t=this._nActiveActions;for(let i=t-1;i>=0;--i)e[i].stop();return this}update(e){e*=this.timeScale;const t=this._actions,i=this._nActiveActions,s=this.time+=e,r=Math.sign(e),o=this._accuIndex^=1;for(let l=0;l!==i;++l)t[l]._update(s,e,r,o);const a=this._bindings,c=this._nActiveBindings;for(let l=0;l!==c;++l)a[l].apply(o);return this}setTime(e){this.time=0;for(let t=0;t<this._actions.length;t++)this._actions[t].time=0;return this.update(e)}getRoot(){return this._root}uncacheClip(e){const t=this._actions,i=e.uuid,s=this._actionsByClip,r=s[i];if(r!==void 0){const o=r.knownActions;for(let a=0,c=o.length;a!==c;++a){const l=o[a];this._deactivateAction(l);const h=l._cacheIndex,d=t[t.length-1];l._cacheIndex=null,l._byClipCacheIndex=null,d._cacheIndex=h,t[h]=d,t.pop(),this._removeInactiveBindingsForAction(l)}delete s[i]}}uncacheRoot(e){const t=e.uuid,i=this._actionsByClip;for(const o in i){const a=i[o].actionByRoot,c=a[t];c!==void 0&&(this._deactivateAction(c),this._removeInactiveAction(c))}const s=this._bindingsByRootAndName,r=s[t];if(r!==void 0)for(const o in r){const a=r[o];a.restoreOriginalState(),this._removeInactiveBinding(a)}}uncacheAction(e,t){const i=this.existingAction(e,t);i!==null&&(this._deactivateAction(i),this._removeInactiveAction(i))}}class we{constructor(e){this.value=e}clone(){return new we(this.value.clone===void 0?this.value:this.value.clone())}}let BW=0;class DW extends ls{constructor(){super(),this.isUniformsGroup=!0,Object.defineProperty(this,"id",{value:BW++}),this.name="",this.usage=Jg,this.uniforms=[]}add(e){return this.uniforms.push(e),this}remove(e){const t=this.uniforms.indexOf(e);return t!==-1&&this.uniforms.splice(t,1),this}setName(e){return this.name=e,this}setUsage(e){return this.usage=e,this}dispose(){return this.dispatchEvent({type:"dispose"}),this}copy(e){this.name=e.name,this.usage=e.usage;const t=e.uniforms;this.uniforms.length=0;for(let i=0,s=t.length;i<s;i++){const r=Array.isArray(t[i])?t[i]:[t[i]];for(let o=0;o<r.length;o++)this.uniforms.push(r[o].clone())}return this}clone(){return new this.constructor().copy(this)}}class db extends zA{constructor(e,t,i=1){super(e,t),this.isInstancedInterleavedBuffer=!0,this.meshPerAttribute=i}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}clone(e){const t=super.clone(e);return t.meshPerAttribute=this.meshPerAttribute,t}toJSON(e){const t=super.toJSON(e);return t.isInstancedInterleavedBuffer=!0,t.meshPerAttribute=this.meshPerAttribute,t}}class OW{constructor(e,t,i,s,r){this.isGLBufferAttribute=!0,this.name="",this.buffer=e,this.type=t,this.itemSize=i,this.elementSize=s,this.count=r,this.version=0}set needsUpdate(e){e===!0&&this.version++}setBuffer(e){return this.buffer=e,this}setType(e,t){return this.type=e,this.elementSize=t,this}setItemSize(e){return this.itemSize=e,this}setCount(e){return this.count=e,this}}let Pp=class{constructor(e,t,i=0,s=1/0){this.ray=new ro(e,t),this.near=i,this.far=s,this.camera=null,this.layers=new Ar,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(e,t){this.ray.set(e,t)}setFromCamera(e,t){t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):console.error("THREE.Raycaster: Unsupported camera type: "+t.type)}intersectObject(e,t=!0,i=[]){return bE(e,this,i,t),i.sort(HP),i}intersectObjects(e,t=!0,i=[]){for(let s=0,r=e.length;s<r;s++)bE(e[s],this,i,t);return i.sort(HP),i}};function HP(n,e){return n.distance-e.distance}function bE(n,e,t,i){if(n.layers.test(e.layers)&&n.raycast(e,t),i===!0){const s=n.children;for(let r=0,o=s.length;r<o;r++)bE(s[r],e,t,!0)}}class _E{constructor(e=1,t=0,i=0){return this.radius=e,this.phi=t,this.theta=i,this}set(e,t,i){return this.radius=e,this.phi=t,this.theta=i,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,i){return this.radius=Math.sqrt(e*e+t*t+i*i),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,i),this.phi=Math.acos(pn(t/this.radius,-1,1))),this}clone(){return new this.constructor().copy(this)}}class kW{constructor(e=1,t=0,i=0){return this.radius=e,this.theta=t,this.y=i,this}set(e,t,i){return this.radius=e,this.theta=t,this.y=i,this}copy(e){return this.radius=e.radius,this.theta=e.theta,this.y=e.y,this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,i){return this.radius=Math.sqrt(e*e+i*i),this.theta=Math.atan2(e,i),this.y=t,this}clone(){return new this.constructor().copy(this)}}const QP=new ie;class LW{constructor(e=new ie(1/0,1/0),t=new ie(-1/0,-1/0)){this.isBox2=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromPoints(e){this.makeEmpty();for(let t=0,i=e.length;t<i;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const i=QP.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(i),this.max.copy(e).add(i),this}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(e){return this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y)}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,QP).distanceTo(e)}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const jP=new w,by=new w;class KM{constructor(e=new w,t=new w){this.start=e,this.end=t}set(e,t){return this.start.copy(e),this.end.copy(t),this}copy(e){return this.start.copy(e.start),this.end.copy(e.end),this}getCenter(e){return e.addVectors(this.start,this.end).multiplyScalar(.5)}delta(e){return e.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(e,t){return this.delta(t).multiplyScalar(e).add(this.start)}closestPointToPointParameter(e,t){jP.subVectors(e,this.start),by.subVectors(this.end,this.start);const i=by.dot(by);let r=by.dot(jP)/i;return t&&(r=pn(r,0,1)),r}closestPointToPoint(e,t,i){const s=this.closestPointToPointParameter(e,t);return this.delta(i).multiplyScalar(s).add(this.start)}applyMatrix4(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this}equals(e){return e.start.equals(this.start)&&e.end.equals(this.end)}clone(){return new this.constructor().copy(this)}}const WP=new w;class FW extends ge{constructor(e,t){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=t,this.type="SpotLightHelper";const i=new gt,s=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let o=0,a=1,c=32;o<c;o++,a++){const l=o/c*Math.PI*2,h=a/c*Math.PI*2;s.push(Math.cos(l),Math.sin(l),1,Math.cos(h),Math.sin(h),1)}i.setAttribute("position",new ot(s,3));const r=new Ln({fog:!1,toneMapped:!1});this.cone=new Go(i,r),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1);const e=this.light.distance?this.light.distance:1e3,t=e*Math.tan(this.light.angle);this.cone.scale.set(t,t,e),WP.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(WP),this.color!==void 0?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}const Kl=new w,_y=new Ce,oS=new Ce;class UW extends Go{constructor(e){const t=nF(e),i=new gt,s=[],r=[],o=new ye(0,0,1),a=new ye(0,1,0);for(let l=0;l<t.length;l++){const h=t[l];h.parent&&h.parent.isBone&&(s.push(0,0,0),s.push(0,0,0),r.push(o.r,o.g,o.b),r.push(a.r,a.g,a.b))}i.setAttribute("position",new ot(s,3)),i.setAttribute("color",new ot(r,3));const c=new Ln({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0});super(i,c),this.isSkeletonHelper=!0,this.type="SkeletonHelper",this.root=e,this.bones=t,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(e){const t=this.bones,i=this.geometry,s=i.getAttribute("position");oS.copy(this.root.matrixWorld).invert();for(let r=0,o=0;r<t.length;r++){const a=t[r];a.parent&&a.parent.isBone&&(_y.multiplyMatrices(oS,a.matrixWorld),Kl.setFromMatrixPosition(_y),s.setXYZ(o,Kl.x,Kl.y,Kl.z),_y.multiplyMatrices(oS,a.parent.matrixWorld),Kl.setFromMatrixPosition(_y),s.setXYZ(o+1,Kl.x,Kl.y,Kl.z),o+=2)}i.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(e)}dispose(){this.geometry.dispose(),this.material.dispose()}}function nF(n){const e=[];n.isBone===!0&&e.push(n);for(let t=0;t<n.children.length;t++)e.push.apply(e,nF(n.children[t]));return e}class NW extends me{constructor(e,t,i){const s=new Aa(t,4,2),r=new ri({wireframe:!0,fog:!1,toneMapped:!1});super(s,r),this.light=e,this.color=i,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.color!==void 0?this.material.color.set(this.color):this.material.color.copy(this.light.color)}}const zW=new w,qP=new ye,XP=new ye;class GW extends ge{constructor(e,t,i){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=i,this.type="HemisphereLightHelper";const s=new sl(t);s.rotateY(Math.PI*.5),this.material=new ri({wireframe:!0,fog:!1,toneMapped:!1}),this.color===void 0&&(this.material.vertexColors=!0);const r=s.getAttribute("position"),o=new Float32Array(r.count*3);s.setAttribute("color",new it(o,3)),this.add(new me(s,this.material)),this.update()}dispose(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}update(){const e=this.children[0];if(this.color!==void 0)this.material.color.set(this.color);else{const t=e.geometry.getAttribute("color");qP.copy(this.light.color),XP.copy(this.light.groundColor);for(let i=0,s=t.count;i<s;i++){const r=i<s/2?qP:XP;t.setXYZ(i,r.r,r.g,r.b)}t.needsUpdate=!0}this.light.updateWorldMatrix(!0,!1),e.lookAt(zW.setFromMatrixPosition(this.light.matrixWorld).negate())}}let ex=class extends Go{constructor(e=10,t=10,i=4473924,s=8947848){i=new ye(i),s=new ye(s);const r=t/2,o=e/t,a=e/2,c=[],l=[];for(let f=0,p=0,m=-a;f<=t;f++,m+=o){c.push(-a,0,m,a,0,m),c.push(m,0,-a,m,0,a);const g=f===r?i:s;g.toArray(l,p),p+=3,g.toArray(l,p),p+=3,g.toArray(l,p),p+=3,g.toArray(l,p),p+=3}const h=new gt;h.setAttribute("position",new ot(c,3)),h.setAttribute("color",new ot(l,3));const d=new Ln({vertexColors:!0,toneMapped:!1});super(h,d),this.type="GridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}};class VW extends Go{constructor(e=10,t=16,i=8,s=64,r=4473924,o=8947848){r=new ye(r),o=new ye(o);const a=[],c=[];if(t>1)for(let d=0;d<t;d++){const f=d/t*(Math.PI*2),p=Math.sin(f)*e,m=Math.cos(f)*e;a.push(0,0,0),a.push(p,0,m);const g=d&1?r:o;c.push(g.r,g.g,g.b),c.push(g.r,g.g,g.b)}for(let d=0;d<i;d++){const f=d&1?r:o,p=e-e/i*d;for(let m=0;m<s;m++){let g=m/s*(Math.PI*2),y=Math.sin(g)*p,A=Math.cos(g)*p;a.push(y,0,A),c.push(f.r,f.g,f.b),g=(m+1)/s*(Math.PI*2),y=Math.sin(g)*p,A=Math.cos(g)*p,a.push(y,0,A),c.push(f.r,f.g,f.b)}}const l=new gt;l.setAttribute("position",new ot(a,3)),l.setAttribute("color",new ot(c,3));const h=new Ln({vertexColors:!0,toneMapped:!1});super(l,h),this.type="PolarGridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}const YP=new w,xy=new w,JP=new w;class sF extends ge{constructor(e,t,i){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=i,this.type="DirectionalLightHelper",t===void 0&&(t=1);let s=new gt;s.setAttribute("position",new ot([-t,t,0,t,t,0,t,-t,0,-t,-t,0,-t,t,0],3));const r=new Ln({fog:!1,toneMapped:!1});this.lightPlane=new Sn(s,r),this.add(this.lightPlane),s=new gt,s.setAttribute("position",new ot([0,0,0,0,0,1],3)),this.targetLine=new Sn(s,r),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),YP.setFromMatrixPosition(this.light.matrixWorld),xy.setFromMatrixPosition(this.light.target.matrixWorld),JP.subVectors(xy,YP),this.lightPlane.lookAt(xy),this.color!==void 0?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(xy),this.targetLine.scale.z=JP.length()}}const wy=new w,un=new LA;class rF extends Go{constructor(e){const t=new gt,i=new Ln({color:16777215,vertexColors:!0,toneMapped:!1}),s=[],r=[],o={};a("n1","n2"),a("n2","n4"),a("n4","n3"),a("n3","n1"),a("f1","f2"),a("f2","f4"),a("f4","f3"),a("f3","f1"),a("n1","f1"),a("n2","f2"),a("n3","f3"),a("n4","f4"),a("p","n1"),a("p","n2"),a("p","n3"),a("p","n4"),a("u1","u2"),a("u2","u3"),a("u3","u1"),a("c","t"),a("p","c"),a("cn1","cn2"),a("cn3","cn4"),a("cf1","cf2"),a("cf3","cf4");function a(m,g){c(m),c(g)}function c(m){s.push(0,0,0),r.push(0,0,0),o[m]===void 0&&(o[m]=[]),o[m].push(s.length/3-1)}t.setAttribute("position",new ot(s,3)),t.setAttribute("color",new ot(r,3)),super(t,i),this.type="CameraHelper",this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=o,this.update();const l=new ye(16755200),h=new ye(16711680),d=new ye(43775),f=new ye(16777215),p=new ye(3355443);this.setColors(l,h,d,f,p)}setColors(e,t,i,s,r){const a=this.geometry.getAttribute("color");a.setXYZ(0,e.r,e.g,e.b),a.setXYZ(1,e.r,e.g,e.b),a.setXYZ(2,e.r,e.g,e.b),a.setXYZ(3,e.r,e.g,e.b),a.setXYZ(4,e.r,e.g,e.b),a.setXYZ(5,e.r,e.g,e.b),a.setXYZ(6,e.r,e.g,e.b),a.setXYZ(7,e.r,e.g,e.b),a.setXYZ(8,e.r,e.g,e.b),a.setXYZ(9,e.r,e.g,e.b),a.setXYZ(10,e.r,e.g,e.b),a.setXYZ(11,e.r,e.g,e.b),a.setXYZ(12,e.r,e.g,e.b),a.setXYZ(13,e.r,e.g,e.b),a.setXYZ(14,e.r,e.g,e.b),a.setXYZ(15,e.r,e.g,e.b),a.setXYZ(16,e.r,e.g,e.b),a.setXYZ(17,e.r,e.g,e.b),a.setXYZ(18,e.r,e.g,e.b),a.setXYZ(19,e.r,e.g,e.b),a.setXYZ(20,e.r,e.g,e.b),a.setXYZ(21,e.r,e.g,e.b),a.setXYZ(22,e.r,e.g,e.b),a.setXYZ(23,e.r,e.g,e.b),a.setXYZ(24,t.r,t.g,t.b),a.setXYZ(25,t.r,t.g,t.b),a.setXYZ(26,t.r,t.g,t.b),a.setXYZ(27,t.r,t.g,t.b),a.setXYZ(28,t.r,t.g,t.b),a.setXYZ(29,t.r,t.g,t.b),a.setXYZ(30,t.r,t.g,t.b),a.setXYZ(31,t.r,t.g,t.b),a.setXYZ(32,i.r,i.g,i.b),a.setXYZ(33,i.r,i.g,i.b),a.setXYZ(34,i.r,i.g,i.b),a.setXYZ(35,i.r,i.g,i.b),a.setXYZ(36,i.r,i.g,i.b),a.setXYZ(37,i.r,i.g,i.b),a.setXYZ(38,s.r,s.g,s.b),a.setXYZ(39,s.r,s.g,s.b),a.setXYZ(40,r.r,r.g,r.b),a.setXYZ(41,r.r,r.g,r.b),a.setXYZ(42,r.r,r.g,r.b),a.setXYZ(43,r.r,r.g,r.b),a.setXYZ(44,r.r,r.g,r.b),a.setXYZ(45,r.r,r.g,r.b),a.setXYZ(46,r.r,r.g,r.b),a.setXYZ(47,r.r,r.g,r.b),a.setXYZ(48,r.r,r.g,r.b),a.setXYZ(49,r.r,r.g,r.b),a.needsUpdate=!0}update(){const e=this.geometry,t=this.pointMap,i=1,s=1;un.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),bn("c",t,e,un,0,0,-1),bn("t",t,e,un,0,0,1),bn("n1",t,e,un,-i,-s,-1),bn("n2",t,e,un,i,-s,-1),bn("n3",t,e,un,-i,s,-1),bn("n4",t,e,un,i,s,-1),bn("f1",t,e,un,-i,-s,1),bn("f2",t,e,un,i,-s,1),bn("f3",t,e,un,-i,s,1),bn("f4",t,e,un,i,s,1),bn("u1",t,e,un,i*.7,s*1.1,-1),bn("u2",t,e,un,-i*.7,s*1.1,-1),bn("u3",t,e,un,0,s*2,-1),bn("cf1",t,e,un,-i,0,1),bn("cf2",t,e,un,i,0,1),bn("cf3",t,e,un,0,-s,1),bn("cf4",t,e,un,0,s,1),bn("cn1",t,e,un,-i,0,-1),bn("cn2",t,e,un,i,0,-1),bn("cn3",t,e,un,0,-s,-1),bn("cn4",t,e,un,0,s,-1),e.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}}function bn(n,e,t,i,s,r,o){wy.set(s,r,o).unproject(i);const a=e[n];if(a!==void 0){const c=t.getAttribute("position");for(let l=0,h=a.length;l<h;l++)c.setXYZ(a[l],wy.x,wy.y,wy.z)}}const Sy=new Mi;class ZM extends Go{constructor(e,t=16776960){const i=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),s=new Float32Array(8*3),r=new gt;r.setIndex(new it(i,1)),r.setAttribute("position",new it(s,3)),super(r,new Ln({color:t,toneMapped:!1})),this.object=e,this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}update(e){if(e!==void 0&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),this.object!==void 0&&Sy.setFromObject(this.object),Sy.isEmpty())return;const t=Sy.min,i=Sy.max,s=this.geometry.attributes.position,r=s.array;r[0]=i.x,r[1]=i.y,r[2]=i.z,r[3]=t.x,r[4]=i.y,r[5]=i.z,r[6]=t.x,r[7]=t.y,r[8]=i.z,r[9]=i.x,r[10]=t.y,r[11]=i.z,r[12]=i.x,r[13]=i.y,r[14]=t.z,r[15]=t.x,r[16]=i.y,r[17]=t.z,r[18]=t.x,r[19]=t.y,r[20]=t.z,r[21]=i.x,r[22]=t.y,r[23]=t.z,s.needsUpdate=!0,this.geometry.computeBoundingSphere()}setFromObject(e){return this.object=e,this.update(),this}copy(e,t){return super.copy(e,t),this.object=e.object,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class xE extends Go{constructor(e,t=16776960){const i=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),s=[1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],r=new gt;r.setIndex(new it(i,1)),r.setAttribute("position",new ot(s,3)),super(r,new Ln({color:t,toneMapped:!1})),this.box=e,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(e){const t=this.box;t.isEmpty()||(t.getCenter(this.position),t.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(e))}dispose(){this.geometry.dispose(),this.material.dispose()}}class HW extends Sn{constructor(e,t=1,i=16776960){const s=i,r=[1,-1,0,-1,1,0,-1,-1,0,1,1,0,-1,1,0,-1,-1,0,1,-1,0,1,1,0],o=new gt;o.setAttribute("position",new ot(r,3)),o.computeBoundingSphere(),super(o,new Ln({color:s,toneMapped:!1})),this.type="PlaneHelper",this.plane=e,this.size=t;const a=[1,1,0,-1,1,0,-1,-1,0,1,1,0,-1,-1,0,1,-1,0],c=new gt;c.setAttribute("position",new ot(a,3)),c.computeBoundingSphere(),this.add(new me(c,new ri({color:s,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}updateMatrixWorld(e){this.position.set(0,0,0),this.scale.set(.5*this.size,.5*this.size,1),this.lookAt(this.plane.normal),this.translateZ(-this.plane.constant),super.updateMatrixWorld(e)}dispose(){this.geometry.dispose(),this.material.dispose(),this.children[0].geometry.dispose(),this.children[0].material.dispose()}}const KP=new w;let Cy,aS;class QW extends ge{constructor(e=new w(0,0,1),t=new w(0,0,0),i=1,s=16776960,r=i*.2,o=r*.2){super(),this.type="ArrowHelper",Cy===void 0&&(Cy=new gt,Cy.setAttribute("position",new ot([0,0,0,0,1,0],3)),aS=new xn(0,.5,1,5,1),aS.translate(0,-.5,0)),this.position.copy(t),this.line=new Sn(Cy,new Ln({color:s,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new me(aS,new ri({color:s,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(e),this.setLength(i,r,o)}setDirection(e){if(e.y>.99999)this.quaternion.set(0,0,0,1);else if(e.y<-.99999)this.quaternion.set(1,0,0,0);else{KP.set(e.z,0,-e.x).normalize();const t=Math.acos(e.y);this.quaternion.setFromAxisAngle(KP,t)}}setLength(e,t=e*.2,i=t*.2){this.line.scale.set(1,Math.max(1e-4,e-t),1),this.line.updateMatrix(),this.cone.scale.set(i,t,i),this.cone.position.y=e,this.cone.updateMatrix()}setColor(e){this.line.material.color.set(e),this.cone.material.color.set(e)}copy(e){return super.copy(e,!1),this.line.copy(e.line),this.cone.copy(e.cone),this}dispose(){this.line.geometry.dispose(),this.line.material.dispose(),this.cone.geometry.dispose(),this.cone.material.dispose()}}let Fo=class extends Go{constructor(e=1){const t=[0,0,0,e,0,0,0,0,0,0,e,0,0,0,0,0,0,e],i=[1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],s=new gt;s.setAttribute("position",new ot(t,3)),s.setAttribute("color",new ot(i,3));const r=new Ln({vertexColors:!0,toneMapped:!1});super(s,r),this.type="AxesHelper"}setColors(e,t,i){const s=new ye,r=this.geometry.attributes.color.array;return s.set(e),s.toArray(r,0),s.toArray(r,3),s.set(t),s.toArray(r,6),s.toArray(r,9),s.set(i),s.toArray(r,12),s.toArray(r,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}};class jW{constructor(){this.type="ShapePath",this.color=new ye,this.subPaths=[],this.currentPath=null}moveTo(e,t){return this.currentPath=new $g,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,t),this}lineTo(e,t){return this.currentPath.lineTo(e,t),this}quadraticCurveTo(e,t,i,s){return this.currentPath.quadraticCurveTo(e,t,i,s),this}bezierCurveTo(e,t,i,s,r,o){return this.currentPath.bezierCurveTo(e,t,i,s,r,o),this}splineThru(e){return this.currentPath.splineThru(e),this}toShapes(e){function t(A){const v=[];for(let b=0,_=A.length;b<_;b++){const T=A[b],E=new Yu;E.curves=T.curves,v.push(E)}return v}function i(A,v){const b=v.length;let _=!1;for(let T=b-1,E=0;E<b;T=E++){let M=v[T],I=v[E],S=I.x-M.x,C=I.y-M.y;if(Math.abs(C)>Number.EPSILON){if(C<0&&(M=v[E],S=-S,I=v[T],C=-C),A.y<M.y||A.y>I.y)continue;if(A.y===M.y){if(A.x===M.x)return!0}else{const D=C*(A.x-M.x)-S*(A.y-M.y);if(D===0)return!0;if(D<0)continue;_=!_}}else{if(A.y!==M.y)continue;if(I.x<=A.x&&A.x<=M.x||M.x<=A.x&&A.x<=I.x)return!0}}return _}const s=hc.isClockWise,r=this.subPaths;if(r.length===0)return[];let o,a,c;const l=[];if(r.length===1)return a=r[0],c=new Yu,c.curves=a.curves,l.push(c),l;let h=!s(r[0].getPoints());h=e?!h:h;const d=[],f=[];let p=[],m=0,g;f[m]=void 0,p[m]=[];for(let A=0,v=r.length;A<v;A++)a=r[A],g=a.getPoints(),o=s(g),o=e?!o:o,o?(!h&&f[m]&&m++,f[m]={s:new Yu,p:g},f[m].s.curves=a.curves,h&&m++,p[m]=[]):p[m].push({h:a,p:g[0]});if(!f[0])return t(r);if(f.length>1){let A=!1,v=0;for(let b=0,_=f.length;b<_;b++)d[b]=[];for(let b=0,_=f.length;b<_;b++){const T=p[b];for(let E=0;E<T.length;E++){const M=T[E];let I=!0;for(let S=0;S<f.length;S++)i(M.p,f[S].p)&&(b!==S&&v++,I?(I=!1,d[S].push(M)):A=!0);I&&d[b].push(M)}}v>0&&A===!1&&(p=d)}let y;for(let A=0,v=f.length;A<v;A++){c=f[A].s,l.push(c),y=p[A];for(let b=0,_=y.length;b<_;b++)c.holes.push(y[b].h)}return l}}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:qh}}));typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=qh);const WW=Object.freeze(Object.defineProperty({__proto__:null,ACESFilmicToneMapping:oM,AddEquation:Ah,AddOperation:ML,AdditiveAnimationBlendMode:pM,AdditiveBlending:cd,AgXToneMapping:PL,AlphaFormat:kL,AlwaysCompare:o2,AlwaysDepth:y_,AlwaysStencilFunc:ob,AmbientLight:jM,AnimationAction:iF,AnimationClip:Nr,AnimationLoader:lW,AnimationMixer:$_,AnimationObjectGroup:RW,AnimationUtils:rW,ArcCurve:I2,ArrayCamera:b2,ArrowHelper:QW,AttachedBindMode:WC,Audio:XM,AudioAnalyser:bW,AudioContext:WM,AudioListener:$2,AudioLoader:ub,AxesHelper:Fo,BackSide:mn,BasicDepthPacking:Ts,BasicShadowMap:GG,BatchedMesh:C2,Bone:GA,BooleanKeyframeTrack:bd,Box2:LW,Box3:Mi,Box3Helper:xE,BoxGeometry:Ni,BoxHelper:ZM,BufferAttribute:it,BufferGeometry:gt,BufferGeometryLoader:K2,ByteType:DL,Cache:rl,Camera:LA,CameraHelper:rF,CanvasTexture:RM,CapsuleGeometry:k_,CatmullRomCurve3:R2,CineonToneMapping:IL,CircleGeometry:L_,ClampToEdgeWrapping:ts,Clock:qM,Color:ye,ColorKeyframeTrack:GM,ColorManagement:_i,CompressedArrayTexture:T2,CompressedCubeTexture:M2,CompressedTexture:lc,CompressedTextureLoader:hW,ConeGeometry:F_,ConstantAlphaFactor:CL,ConstantColorFactor:wL,CubeCamera:_M,CubeReflectionMapping:_l,CubeRefractionMapping:Nh,CubeTexture:FA,CubeTextureLoader:uW,CubeUVReflectionMapping:Sp,CubicBezierCurve:BM,CubicBezierCurve3:P2,CubicInterpolant:Q2,CullFaceBack:VC,CullFaceFront:uL,CullFaceFrontBack:zG,CullFaceNone:hL,Curve:ga,CurvePath:D2,CustomBlending:nM,CustomToneMapping:RL,CylinderGeometry:xn,Cylindrical:kW,Data3DTexture:I_,DataArrayTexture:M_,DataTexture:io,DataTextureLoader:VM,DataUtils:Uu,DecrementStencilOp:QL,DecrementWrapStencilOp:WL,DefaultLoadingManager:q2,DepthFormat:Mh,DepthStencilFormat:zh,DepthTexture:Tp,DetachedBindMode:BL,DirectionalLight:mp,DirectionalLightHelper:sF,DiscreteInterpolant:j2,DisplayP3ColorSpace:kA,DodecahedronGeometry:U_,DoubleSide:Ai,DstAlphaFactor:vL,DstColorFactor:bL,DynamicCopyUsage:KG,DynamicDrawUsage:Vs,DynamicReadUsage:XG,EdgesGeometry:FM,EllipseCurve:O_,EqualCompare:i2,EqualDepth:hp,EqualStencilFunc:YL,EquirectangularReflectionMapping:Oo,EquirectangularRefractionMapping:up,Euler:ws,EventDispatcher:ls,ExtrudeGeometry:z_,FileLoader:Hn,Float16BufferAttribute:kV,Float32BufferAttribute:ot,Float64BufferAttribute:LV,FloatType:Ji,Fog:CM,FogExp2:P_,FramebufferTexture:I5,FrontSide:Es,Frustum:UA,GLBufferAttribute:OW,GLSL1:$G,GLSL3:ab,GreaterCompare:n2,GreaterDepth:__,GreaterEqualCompare:r2,GreaterEqualDepth:b_,GreaterEqualStencilFunc:$L,GreaterStencilFunc:KL,GridHelper:ex,Group:fr,HalfFloatType:sn,HemisphereLight:HM,HemisphereLightHelper:GW,IcosahedronGeometry:G_,ImageBitmapLoader:Z2,ImageLoader:nA,ImageUtils:vM,IncrementStencilOp:HL,IncrementWrapStencilOp:jL,InstancedBufferAttribute:Or,InstancedBufferGeometry:Z_,InstancedInterleavedBuffer:db,InstancedMesh:B_,Int16BufferAttribute:DV,Int32BufferAttribute:OV,Int8BufferAttribute:RV,IntType:aM,InterleavedBuffer:zA,InterleavedBufferAttribute:pr,Interpolant:Rp,InterpolateDiscrete:ud,InterpolateLinear:Gh,InterpolateSmooth:_0,InvertStencilOp:qL,KeepStencilOp:hh,KeyframeTrack:va,LOD:TM,LatheGeometry:VA,Layers:Ar,LessCompare:t2,LessDepth:Vg,LessEqualCompare:gM,LessEqualDepth:ld,LessEqualStencilFunc:JL,LessStencilFunc:XL,Light:Jh,LightProbe:J2,Line:Sn,Line3:KM,LineBasicMaterial:Ln,LineCurve:DM,LineCurve3:B2,LineDashedMaterial:G2,LineLoop:MM,LineSegments:Go,LinearDisplayP3ColorSpace:Cp,LinearEncoding:OA,LinearFilter:St,LinearInterpolant:zM,LinearMipMapLinearFilter:jG,LinearMipMapNearestFilter:QG,LinearMipmapLinearFilter:kr,LinearMipmapNearestFilter:Wu,LinearSRGBColorSpace:Ri,LinearToneMapping:Hg,LinearTransfer:qg,Loader:Ms,LoaderUtils:Ih,LoadingManager:X_,LoopOnce:jg,LoopPingPong:UL,LoopRepeat:fM,LuminanceAlphaFormat:LL,LuminanceFormat:S_,MOUSE:Eu,Material:Ot,MaterialLoader:K_,MathUtils:Vn,Matrix3:Dt,Matrix4:Ce,MaxEquation:K0,Mesh:me,MeshBasicMaterial:ri,MeshDepthMaterial:NA,MeshDistanceMaterial:SM,MeshLambertMaterial:N2,MeshMatcapMaterial:z2,MeshNormalMaterial:q_,MeshPhongMaterial:F2,MeshPhysicalMaterial:so,MeshStandardMaterial:Ur,MeshToonMaterial:U2,MinEquation:jC,MirroredRepeatWrapping:hd,MixOperation:TL,MultiplyBlending:QC,MultiplyOperation:DA,NearestFilter:Nt,NearestMipMapLinearFilter:HG,NearestMipMapNearestFilter:VG,NearestMipmapLinearFilter:Zc,NearestMipmapNearestFilter:dp,NeverCompare:e2,NeverDepth:sM,NeverStencilFunc:dE,NoBlending:rn,NoColorSpace:is,NoToneMapping:Fr,NormalAnimationBlendMode:E_,NormalBlending:Th,NotEqualCompare:s2,NotEqualDepth:BA,NotEqualStencilFunc:ZL,NumberKeyframeTrack:pd,Object3D:ge,ObjectLoader:mW,ObjectSpaceNormalMap:zL,OctahedronGeometry:sl,OneFactor:mL,OneMinusConstantAlphaFactor:EL,OneMinusConstantColorFactor:SL,OneMinusDstAlphaFactor:yL,OneMinusDstColorFactor:_L,OneMinusSrcAlphaFactor:$0,OneMinusSrcColorFactor:AL,OrthographicCamera:vc,P3Primaries:Yg,PCFShadowMap:tM,PCFSoftShadowMap:iM,PMREMGenerator:pE,Path:$g,PerspectiveCamera:Wt,Plane:hr,PlaneGeometry:Wn,PlaneHelper:HW,PointLight:J_,PointLightHelper:NW,Points:IM,PointsMaterial:D_,PolarGridHelper:VW,PolyhedronGeometry:Yh,PositionalAudio:eF,PropertyBinding:qt,PropertyMixer:tF,QuadraticBezierCurve:OM,QuadraticBezierCurve3:kM,Quaternion:Me,QuaternionKeyframeTrack:xl,QuaternionLinearInterpolant:W2,RED_GREEN_RGTC2_Format:hE,RED_RGTC1_Format:FL,REVISION:qh,RGBADepthPacking:T_,RGBAFormat:xi,RGBAIntegerFormat:dM,RGBA_ASTC_10x10_Format:sE,RGBA_ASTC_10x5_Format:tE,RGBA_ASTC_10x6_Format:iE,RGBA_ASTC_10x8_Format:nE,RGBA_ASTC_12x10_Format:rE,RGBA_ASTC_12x12_Format:oE,RGBA_ASTC_4x4_Format:sb,RGBA_ASTC_5x4_Format:YC,RGBA_ASTC_5x5_Format:JC,RGBA_ASTC_6x5_Format:KC,RGBA_ASTC_6x6_Format:Qg,RGBA_ASTC_8x5_Format:ZC,RGBA_ASTC_8x6_Format:$C,RGBA_ASTC_8x8_Format:eE,RGBA_BPTC_Format:ig,RGBA_ETC2_EAC_Format:nb,RGBA_PVRTC_2BPPV1_Format:XC,RGBA_PVRTC_4BPPV1_Format:tb,RGBA_S3TC_DXT1_Format:y0,RGBA_S3TC_DXT3_Format:b0,RGBA_S3TC_DXT5_Format:tg,RGB_BPTC_SIGNED_Format:aE,RGB_BPTC_UNSIGNED_Format:cE,RGB_ETC1_Format:C_,RGB_ETC2_Format:ib,RGB_PVRTC_2BPPV1_Format:qC,RGB_PVRTC_4BPPV1_Format:eb,RGB_S3TC_DXT1_Format:eg,RGFormat:Sh,RGIntegerFormat:uM,RawShaderMaterial:HA,Ray:ro,Raycaster:Pp,Rec709Primaries:Xg,RectAreaLight:X2,RedFormat:tc,RedIntegerFormat:hM,ReinhardToneMapping:rM,RenderTarget:l2,RepeatWrapping:Lo,ReplaceStencilOp:VL,ReverseSubtractEquation:fL,RingGeometry:fd,SIGNED_RED_GREEN_RGTC2_Format:uE,SIGNED_RED_RGTC1_Format:lE,SRGBColorSpace:zt,SRGBTransfer:Ui,Scene:Ws,ShaderChunk:Bt,ShaderLib:ys,ShaderMaterial:Et,ShadowMaterial:W_,Shape:Yu,ShapeGeometry:V_,ShapePath:jW,ShapeUtils:hc,ShortType:OL,Skeleton:Ip,SkeletonHelper:UW,SkinnedMesh:cc,Source:nl,Sphere:Mn,SphereGeometry:Aa,Spherical:_E,SphericalHarmonics3:Y2,SplineCurve:LM,SpotLight:Y_,SpotLightHelper:FW,Sprite:S2,SpriteMaterial:EM,SrcAlphaFactor:Z0,SrcAlphaSaturateFactor:xL,SrcColorFactor:gL,StaticCopyUsage:JG,StaticDrawUsage:Jg,StaticReadUsage:qG,StereoCamera:AW,StreamCopyUsage:ZG,StreamDrawUsage:WG,StreamReadUsage:YG,StringKeyframeTrack:_d,SubtractEquation:dL,SubtractiveBlending:HC,TOUCH:Tu,TangentSpaceNormalMap:Xh,TetrahedronGeometry:H_,Texture:Ft,TextureLoader:dl,TorusGeometry:el,TorusKnotGeometry:Q_,Triangle:dr,TriangleFanDrawMode:rb,TriangleStripDrawMode:mM,TrianglesDrawMode:NL,TubeGeometry:j_,UVMapping:x_,Uint16BufferAttribute:yM,Uint32BufferAttribute:bM,Uint8BufferAttribute:PV,Uint8ClampedBufferAttribute:BV,Uniform:we,UniformsGroup:DW,UniformsLib:De,UniformsUtils:Ep,UnsignedByteType:gi,UnsignedInt248Type:ul,UnsignedIntType:ca,UnsignedShort4444Type:cM,UnsignedShort5551Type:lM,UnsignedShortType:w_,VSMShadowMap:Oa,Vector2:ie,Vector3:w,Vector4:tt,VectorKeyframeTrack:Vh,VideoTexture:E2,WebGL1Renderer:_2,WebGL3DRenderTarget:yV,WebGLArrayRenderTarget:vV,WebGLCoordinateSystem:ic,WebGLCubeRenderTarget:xM,WebGLMultipleRenderTargets:h2,WebGLRenderTarget:Zt,WebGLRenderer:Rl,WebGLUtils:y2,WebGPUCoordinateSystem:Kg,WireframeGeometry:UM,WrapAroundEnding:Wg,ZeroCurvatureEnding:Lu,ZeroFactor:pL,ZeroSlopeEnding:Fu,ZeroStencilOp:GL,_SRGBAFormat:cb,createCanvasElement:c2,sRGBEncoding:ac},Symbol.toStringTag,{value:"Module"})),cS=new Map;function zr(n=(e=>(e=globalThis.location)==null?void 0:e.hostname)()){if(cS.has(n))return cS.get(n);const t=/(\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3})|localhost/.test(n);return cS.set(n,t),t===!0}function qW(){return window.location.hostname.includes("glitch.me")}var Cn;(function(n){n.ContextRegistered="ContextRegistered",n.ContextCreationStart="ContextCreationStart",n.ContextCreated="ContextCreated",n.ContextFirstFrameRendered="ContextFirstFrameRendered",n.ContextDestroyed="ContextDestroyed",n.MissingCamera="MissingCamera",n.ContextClearing="ContextClearing",n.ContextCleared="ContextCleared"})(Cn||(Cn={}));class zi{static get Current(){return globalThis["NeedleEngine.Context.Current"]}static set Current(e){globalThis["NeedleEngine.Context.Current"]=e}static get All(){return this.Registered}static register(e){this.Registered.push(e),this.dispatchCallback(Cn.ContextRegistered,e)}static unregister(e){const t=this.Registered.indexOf(e);t!==-1&&this.Registered.splice(t,1)}static registerCallback(e,t){this._callbacks[e]||(this._callbacks[e]=[]),this._callbacks[e].push(t)}static unregisterCallback(e,t){if(!this._callbacks[e])return;const i=this._callbacks[e].indexOf(t);i!==-1&&this._callbacks[e].splice(i,1)}static dispatchCallback(e,t,i){if(!this._callbacks[e])return!0;const s={event:e,context:t};if(i)for(const o in i)s[o]=i[o];const r=new Array;return this._callbacks[e].forEach(o=>{const a=o(s);a instanceof Promise&&r.push(a)}),Promise.all(r)}static addContextCreatedCallback(e){this.registerCallback(Cn.ContextCreated,e)}static addContextDestroyedCallback(e){this.registerCallback(Cn.ContextDestroyed,e)}}u(zi,"Registered",[]),u(zi,"_callbacks",{});class wl{constructor(e,t){u(this,"_factory");u(this,"_cache",[]);u(this,"_maxSize");u(this,"_index",0);this._factory=e,this._maxSize=t}get(){const e=this._index%this._maxSize;return this._index++,this._cache.length<=e&&(this._cache[e]=this._factory()),this._cache[e]}}let $M=!1;const wE=[];setTimeout(()=>{$M&&console.log(wE.sort())},100);function e1(){var n;return new URLSearchParams((n=globalThis.location)==null?void 0:n.search)}function re(n){$M&&!wE.includes(n)&&wE.push(n);const e=e1();if(e.has(n)){const t=e.get(n);if(t){const i=Number(t);return isNaN(i)?t:i}else return!0}return!1}$M=re("help")===!0;function XW(n,e,t=!0){const i=e1();i.has(n)?e===null?i.delete(n):i.set(n,e):e!==null&&i.append(n,e),t?YW(n,i):oF(n,i)}function ZP(n,e,t){n.has(e)?n.set(e,t.toString()):n.append(e,t.toString())}function YW(n,e,t){window.history.pushState(t,n,"?"+e.toString())}function oF(n,e,t){window.history.replaceState(t,n,"?"+e.toString())}function JW(n,e){return Math.floor(Math.random()*(e-n+1))+n}const $P=["smol","tiny","giant","interesting","smart","bright","dull","extreme","beautiful","pretty","dark","epic","salty","silly","funny","lame","lazy","loud","lucky","mad","mean","mighty","mysterious","nasty","odd","old","powerful","quiet","rapid","scary","shiny","shy","silly","smooth","sour","spicy","stupid","sweet","tasty","terrible","ugly","unusual","vast","wet","wild","witty","wrong","zany","zealous","zippy","zombie","zorro"],eB=["cat","dog","mouse","pig","cow","horse","sheep","chicken","duck","goat","panda","tiger","lion","elephant","monkey","bird","fish","snake","frog","turtle","hamster","penguin","kangaroo","whale","dolphin","crocodile","snail","ant","bee","beetle","butterfly","dragon","eagle","fish","giraffe","lizard","panda","penguin","rabbit","snake","spider","tiger","zebra"];function KW(){const n=$P[Math.floor(Math.random()*$P.length)],e=eB[Math.floor(Math.random()*eB.length)];return n+"_"+e}function ZW(n){return n=n.replace(/[^a-z0-9 \.,_-]/gim,""),n.trim()}function sA(n,e,t=!0,i=!1){var s;if(e==null)return null;if(e.userData&&e.userData.guid===n)return e;if(e.guid==n)return e;if(i&&(s=e.userData)!=null&&s.components){for(const r of e.userData.components)if(r.guid===n)return r}if(t){if(e.scenes)for(const r in e.scenes){const o=e.scenes[r],a=sA(n,o,t,i);if(a)return a}if(e.children)for(const r in e.children){const o=e.children[r],a=sA(n,o,t,i);if(a)return a}}}function tx(n,e){if(n!=null&&typeof n=="object"){let t;Array.isArray(n)?t=[]:(t=Object.create(n),Object.assign(t,n));for(const i of Object.keys(n)){const s=n[i];e&&!e(n,i,s)?t[i]=s:(s==null?void 0:s.clone)!==void 0&&typeof s.clone=="function"?t[i]=s.clone():t[i]=tx(s,e)}return t}return n}function ha(n){return new Promise((e,t)=>{setTimeout(e,n)})}function $W(n,e){if(n<=0)return Promise.resolve();if(e||(e=zi.Current),!e)return Promise.reject("No context");const t=e.time.frameCount+n;return new Promise((i,s)=>{if(!e)return s("No context");const r=()=>{e.time.frameCount>=t&&(e.pre_update_callbacks.splice(e.pre_update_callbacks.indexOf(r),1),i())};e.pre_update_callbacks.push(r)})}const Ey=re("debugresolveurl"),e8="rel:";function Bp(n,e){if(e===void 0)return Ey&&console.warn("getPath: uri is undefined, returning uri",e),e;if(e.startsWith("./"))return e;if(e.startsWith("http"))return Ey&&console.warn("getPath: uri is absolute, returning uri",e),e;if(n===void 0)return Ey&&console.warn("getPath: source is undefined, returning uri",e),e;e.startsWith(e8)&&(e=e.substring(4));const t=n.lastIndexOf("/");if(t>=0){const i=n.substring(0,t+1),s=i+e;return Ey&&console.log("source:",n,`- changed uri 
from`,e,`
 `,s,`
`+i),s}return e}class t8{constructor(e,t){u(this,"writeCallbacks",[]);u(this,"_applied",!1);u(this,"_object");u(this,"_prop");u(this,"_wrapperProp");this._object=e,this._prop=t,this._wrapperProp=Symbol("$"+t),this.apply()}subscribeWrite(e){this.writeCallbacks.push(e)}unsubscribeWrite(e){const t=this.writeCallbacks.indexOf(e);t!==-1&&this.writeCallbacks.splice(t,1)}apply(){if(this._applied||!this._object)return;const e=this._object,t=this._prop;if(e[t]===void 0)return;this._applied=!0,e[this._wrapperProp]!==void 0&&console.warn("Watcher is being applied to an object that already has a wrapper property. This is not (yet) supported");const i=e[t];e[this._wrapperProp]=i,Object.defineProperty(e,t,{get:()=>e[this._wrapperProp],set:o=>{e[this._wrapperProp]=o;for(const a of this.writeCallbacks)a(o,this._prop)}})}revoke(){if(!this._applied||!this._object)return;this._applied=!1;const e=this._object,t=this._prop;Reflect.deleteProperty(e,t);const i=e[this._wrapperProp];e[t]=i,Reflect.deleteProperty(e,this._wrapperProp)}dispose(){this.revoke(),this.writeCallbacks.length=0,this._object=null}}class Rh{constructor(e,t){u(this,"_watches",[]);if(Array.isArray(t))for(const i of t)this._watches.push(new Rh(e,i));else this._watches.push(new t8(e,t))}subscribeWrite(e){for(const t of this._watches)t.subscribeWrite(e)}unsubscribeWrite(e){for(const t of this._watches)t.unsubscribeWrite(e)}apply(){for(const e of this._watches)e.apply()}revoke(){for(const e of this._watches)e.revoke()}dispose(){for(const e of this._watches)e.dispose();this._watches.length=0}}const Af=Symbol("needle:watches");function t1(n,e){if(!n[Af])if(n instanceof ie)n[Af]=new Rh(n,["x","y"]);else if(n instanceof w)n[Af]=new Rh(n,["x","y","z"]);else if(n instanceof tt||n instanceof Me)n[Af]=new Rh(n,["x","y","z","w"]);else return!1;return n[Af].subscribeWrite(e),!0}function aF(n,e){if(!n)return;const t=n[Af];t&&t.unsubscribeWrite(e)}function fb(){const n=window.navigator.userAgent,e=/Windows|MacOS|Mac OS/.test(n),t=/Windows NT/.test(n)&&/Edg/.test(n)&&!/Win64/.test(n);return e&&!t&&!QA()}function Pl(){return typeof window.orientation<"u"||navigator.userAgent.indexOf("IEMobile")!==-1}function $f(){return/WebXRViewer\//i.test(navigator.userAgent)}const i8=["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"];function QA(){return i8.includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document}function og(){return/^((?!chrome|android).)*safari/i.test(navigator.userAgent)}function i1(){return navigator.userAgent.includes("OculusBrowser")}async function tB(){try{return(await navigator.permissions.query({name:"microphone"})).state!=="denied"}catch(n){return console.error("Error querying `microphone` permissions.",n),!1}}const Ch=new WeakMap;function n8(n,e,t){if(!Ch.get(n)){const s=new MutationObserver(r=>{r8(n,r)});Ch.set(n,{observer:s,attributeChangedListeners:new Map}),s.observe(n,{attributes:!0})}const i=Ch.get(n).attributeChangedListeners;i.has(e)||i.set(e,[]),i.get(e).push(t)}function s8(n,e,t){if(!Ch.get(n))return;const i=Ch.get(n).attributeChangedListeners;if(!i.has(e))return;const s=i.get(e),r=s.indexOf(t);if(r!==-1&&(s.splice(r,1),s.length<=0)){i.delete(e);const o=Ch.get(n);o==null||o.observer.disconnect(),Ch.delete(n)}}function r8(n,e){const t=Ch.get(n).attributeChangedListeners;for(const i of e)if(i.type==="attributes"){const s=i.attributeName,r=n.getAttribute(s);if(t.has(s))for(const o of t.get(s))o(r)}}class iB{constructor(e){u(this,"reason");this.reason=e}}async function ix(n){const e=await Promise.allSettled(n).catch(s=>[new iB(s.message)]);let t=!1;const i=e.map(s=>"value"in s?s.value:(t=!0,new iB(s.reason)));return{anyFailed:t,results:i}}async function o8(n){if(!globalThis.QRCode){const i="https://cdn.rawgit.com/davidshimjs/qrcodejs/gh-pages/qrcode.min.js";let s=document.head.querySelector(`script[src="${i}"]`);s||(s=document.createElement("script"),s.src=i,document.head.appendChild(s)),await new Promise((r,o)=>{s.addEventListener("load",()=>{r(!0)})})}const e=globalThis.QRCode,t=n.domElement??document.createElement("div");return new e(t,{width:n.width??256,height:n.height??256,colorDark:"#000000",colorLight:"#ffffff",correctLevel:e.CorrectLevel.M,...n}),t}const nB=re("debugdebug");let ag=!1;(re("noerrors")||re("nooverlaymessages"))&&(ag=!0);const lS="needle_engine_global_error_container";var rs;(function(n){n[n.Log=0]="Log",n[n.Warn=1]="Warn",n[n.Error=2]="Error"})(rs||(rs={}));function n1(){return cF}const a8=console.error,c8=function(...n){a8.apply(console,n),h8(n),Ph(rs.Error,n),SE()};function l8(){if(ag)return;const n=zr();nB&&console.log("Is this a local network?",n),n&&(nB&&console.warn("Patch console",window.location.hostname),console.error=c8,window.addEventListener("error",e=>{if(ag||!e)return;const t=e.error;if(t===void 0){zr()&&console.warn("Received unknown error",e,e.target);return}Ph(rs.Error,t,e.filename,e.lineno),SE()},!0),window.addEventListener("unhandledrejection",e=>{ag||e&&(e.reason?Ph(rs.Error,e.reason.message,e.reason.stack):Ph(rs.Error,"unhandled rejection"),SE())}))}let cF=0;function SE(){cF+=1}function h8(n){if(Array.isArray(n))for(let e=0;e<n.length;e++){const t=n[e];typeof t=="string"&&t.startsWith("THREE.PropertyBinding: Trying to update node for track:")&&(n[e]="Some animated objects couldn't be found: see console for details")}}function Ph(n,e,t,i){if(ag)return;const s=zi.Current,r=(s==null?void 0:s.domElement)??document.querySelector("needle-engine");if(r){if(Array.isArray(e)){let o="";for(let a=0;a<e.length;a++){let c=e[a];c instanceof Error&&(c=c.message),typeof c!="object"&&(a>0&&(o+=" "),o+=c)}e=o}!e||e.length<=0||u8(n,r,e)}}const hS=new Set;function u8(n,e,t){if(t==null)return;const i=f8(e);if(i.childElementCount>=20){const o=i.lastElementChild;sB(o)}if(t.length>400&&(t=t.substring(0,400)+"..."),hS.has(t))return;hS.add(t);const s=p8(n,t);i.prepend(s);const r=t;setTimeout(()=>{hS.delete(r),sB(s)},1e4)}const d8=`

@import url('https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap');

div[data-needle_engine_debug_overlay] {
    font-family: 'Roboto', sans-serif;
    font-weight: 400;
}

div[data-needle_engine_debug_overlay] strong {
    font-weight: 700;
}

div[data-needle_engine_debug_overlay] a {
    color: white;
    text-decoration: none;
    border-bottom: 1px solid rgba(255, 255, 255, 0.3);
}

div[data-needle_engine_debug_overlay] a:hover {
    text-decoration: none;
    border: none;
}

div[data-needle_engine_debug_overlay] .log strong {
    color: rgba(200,200,200,.9);
}

div[data-needle_engine_debug_overlay] .warn strong {
    color: rgba(255,255,230, 1);
}

div[data-needle_engine_debug_overlay] .error strong {
    color: rgba(255,100,120, 1);
}
`;function f8(n){globalThis[lS]||(globalThis[lS]=new Map);const e=globalThis[lS];if(e.has(n))return e.get(n);{const t=document.createElement("div");e.set(n,t),t.setAttribute("data-needle_engine_debug_overlay",""),t.classList.add("debug-container"),t.style.cssText=`
            position: absolute;
            top: 0;
            right: 5px;
            padding-top: 0px;
            max-width: 70%;
            max-height: calc(100% - 5px);
            z-index: 9999999999;
            pointer-events: scroll;
            display: flex;
            align-items: end;
            flex-direction: column;
            color: white;
            overflow: auto;
        `,n.shadowRoot?n.shadowRoot.appendChild(t):n.appendChild(t);const i=document.createElement("style");return i.innerHTML=d8,t.appendChild(i),t}}const lF=Symbol("logtype"),pb=new Map;function sB(n){n.remove();const e=n[lF],t=pb.get(e)??[];t.push(n),pb.set(e,t)}function p8(n,e){if(pb.has(n)){const i=pb.get(n);if(i.length>0){const s=i.pop();return s.innerHTML=e,s}}const t=document.createElement("div");switch(t.setAttribute("data-id","__needle_engine_debug_overlay"),t.style.marginRight="5px",t.style.padding=".5em",t.style.backgroundColor="rgba(0,0,0,.9)",t.style.marginTop="5px",t.style.marginBottom="3px",t.style.borderRadius="8px",t.style.pointerEvents="all",t.style.userSelect="text",t.style.maxWidth="250px",t.style.whiteSpace="pre-wrap",t.style["backdrop-filter"]="blur(10px)",t.style.backgroundColor="rgba(20,20,20,.8)",t.style.boxShadow="inset 0 0 80px rgba(0,0,0,.2), 0 0 5px rgba(0,0,0,.2)",t.style.border="1px solid rgba(160,160,160,.2)",t[lF]=n,n){case rs.Log:t.classList.add("log"),t.style.color="rgba(200,200,200,.7)",t.style.backgroundColor="rgba(40,40,40,.7)";break;case rs.Warn:t.classList.add("warn"),t.style.color="rgb(255, 255, 150)",t.style.backgroundColor="rgba(50,50,20,.8)";break;case rs.Error:t.classList.add("error"),t.style.color="rgb(255, 50, 50",t.style.backgroundColor="rgba(50,20,20,.8)";break}return t.title="Open the browser console (F12) for more information",t.innerHTML=e,t}let fl=null,Yr=null,nc=null,uS=!1,rB=null;const hF="",CE=re("console"),m8=re("noerrors")||re("noconsole");CE&&uF();if(!m8&&(CE||zr())){if(zr()){const e=new URL(window.location.href);e.searchParams.set("console","1"),console.log(' Tip: You can add the "?console" query parameter to the url to show the debug console (on mobile it will automatically open in the bottom right corner when your get errors during development)',`
Open this page console: `+e.toString())}const n=Pl()||i1()&&Tt();if(n&&(l8(),dF(),fF(!0),n)){const e=document.querySelector("needle-engine");e==null||e.addEventListener("enter-ar",()=>{(CE||fl||n1()>0)&&re("noerrors")}),e==null||e.addEventListener("exit-ar",()=>{b8()})}}const EE=Symbol("consoleParent");function uF(){if(fl!==null){fl.showSwitch();return}fF()}function g8(){fl!==null&&(fl.hide(),fl.hideSwitch())}function dF(){rB||(rB=setInterval(A8,500))}let oB=0;function A8(){const n=n1(),e=n!==oB;oB=n,e&&v8()}function v8(){uF(),nc&&(nc.setAttribute("error","true"),nc.innerText="")}function y8(){nc&&(nc.removeAttribute("error"),nc.innerText=hF)}function b8(){Yr&&Yr[EE]&&Yr[EE].appendChild(Yr)}function fF(n=!1){if(fl||uS)return;uS=!0;const e=document.createElement("script");e.onload=()=>{if(uS=!1,dF(),fl=new window.VConsole,Yr=x8(),Yr&&(Yr[EE]=Yr.parentElement,Yr.style.position="absolute",Yr.style.zIndex=Number.MAX_SAFE_INTEGER.toString()),fl.setSwitchPosition(20,10),nc=_8(),nc){nc.innerText=hF,nc.addEventListener("click",y8);const t=document.createElement("style"),i=40;t.innerHTML=`
                #__vconsole .vc-switch {
                    border: 1px solid rgba(255,255,255,.2);
                    border-radius: 50%;
                    width: ${i}px;
                    height: ${i}px;
                    padding: 0;
                    line-height: ${i}px;
                    font-size: ${i*.4}px;
                    text-align: center;
                    background: rgba(200,200,200,.2);
                    backdrop-filter: blur(10px);
                    user-select: none;
                    pointer-events: auto;
                    transition: transform .2s ease-in-out;
                }
                #__vconsole .vc-switch:hover {
                    cursor: pointer;
                    transform: scale(1.1);
                    transition: transform .1s ease-in-out;
                }
                #__vconsole .vc-switch[error] {
                    background: rgba(255,0,0,.2);
                    animation: vconsole-notify 1s ease-in-out;
                }
                @keyframes vconsole-notify {
                    from {
                        transform: scale(1, 1);
                    }
                    10% {
                        transform: scale(1.3, 1.3);
                    }
                    70% {
                        transform: scale(1.4, 1.4);
                    }
                    to {
                        transform: scale(1, 1);
                    }
                }
            `,Yr==null||Yr.prepend(t),n===!0&&n1()<=0&&g8(),console.log(" Debug console has loaded")}},e.src="https://unpkg.com/vconsole@latest/dist/vconsole.min.js",document.body.appendChild(e)}function _8(){const n=document.querySelector("#__vconsole .vc-switch");return n||null}function x8(){const n=document.querySelector("#__vconsole");return n||null}const w8=re("nodevlogs");function Tn(n,e=rs.Log){Ph(e,n)}function gn(n){Tn(n,rs.Warn)}function S8(n){Tn(n,rs.Error)}function Tt(){return w8?!1:zr()}const mu=new Pp,Ns=new w,Zl=new w,Yi=new Me,aB={X:new w(1,0,0),Y:new w(0,1,0),Z:new w(0,0,1)},dS={type:"change"},cB={type:"mouseDown"},lB={type:"mouseUp",mode:null},hB={type:"objectChange"};class C8 extends ge{constructor(e,t){super(),t===void 0&&(console.warn('THREE.TransformControls: The second parameter "domElement" is now mandatory.'),t=document),this.isTransformControls=!0,this.visible=!1,this.domElement=t,this.domElement.style.touchAction="none";const i=new s1;this._gizmo=i,this.add(i);const s=new P8;this._plane=s,this.add(s);const r=this;function o(v,b){let _=b;Object.defineProperty(r,v,{get:function(){return _!==void 0?_:b},set:function(T){_!==T&&(_=T,s[v]=T,i[v]=T,r.dispatchEvent({type:v+"-changed",value:T}),r.dispatchEvent(dS))}}),r[v]=b,s[v]=b,i[v]=b}o("camera",e),o("object",void 0),o("enabled",!0),o("axis",null),o("mode","translate"),o("translationSnap",null),o("rotationSnap",null),o("scaleSnap",null),o("space","world"),o("size",1),o("dragging",!1),o("showX",!0),o("showY",!0),o("showZ",!0);const a=new w,c=new w,l=new Me,h=new Me,d=new w,f=new Me,p=new w,m=new w,g=new w,y=0,A=new w;o("worldPosition",a),o("worldPositionStart",c),o("worldQuaternion",l),o("worldQuaternionStart",h),o("cameraPosition",d),o("cameraQuaternion",f),o("pointStart",p),o("pointEnd",m),o("rotationAxis",g),o("rotationAngle",y),o("eye",A),this._offset=new w,this._startNorm=new w,this._endNorm=new w,this._cameraScale=new w,this._parentPosition=new w,this._parentQuaternion=new Me,this._parentQuaternionInv=new Me,this._parentScale=new w,this._worldScaleStart=new w,this._worldQuaternionInv=new Me,this._worldScale=new w,this._positionStart=new w,this._quaternionStart=new Me,this._scaleStart=new w,this._getPointer=E8.bind(this),this._onPointerDown=M8.bind(this),this._onPointerHover=T8.bind(this),this._onPointerMove=I8.bind(this),this._onPointerUp=R8.bind(this),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointermove",this._onPointerHover),this.domElement.addEventListener("pointerup",this._onPointerUp)}updateMatrixWorld(){this.object!==void 0&&(this.object.updateMatrixWorld(),this.object.parent===null?console.error("TransformControls: The attached 3D object must be a part of the scene graph."):this.object.parent.matrixWorld.decompose(this._parentPosition,this._parentQuaternion,this._parentScale),this.object.matrixWorld.decompose(this.worldPosition,this.worldQuaternion,this._worldScale),this._parentQuaternionInv.copy(this._parentQuaternion).invert(),this._worldQuaternionInv.copy(this.worldQuaternion).invert()),this.camera.updateMatrixWorld(),this.camera.matrixWorld.decompose(this.cameraPosition,this.cameraQuaternion,this._cameraScale),this.camera.isOrthographicCamera?this.camera.getWorldDirection(this.eye).negate():this.eye.copy(this.cameraPosition).sub(this.worldPosition).normalize(),super.updateMatrixWorld(this)}pointerHover(e){if(this.object===void 0||this.dragging===!0)return;mu.setFromCamera(e,this.camera);const t=fS(this._gizmo.picker[this.mode],mu);t?this.axis=t.object.name:this.axis=null}pointerDown(e){if(!(this.object===void 0||this.dragging===!0||e.button!==0)&&this.axis!==null){mu.setFromCamera(e,this.camera);const t=fS(this._plane,mu,!0);t&&(this.object.updateMatrixWorld(),this.object.parent.updateMatrixWorld(),this._positionStart.copy(this.object.position),this._quaternionStart.copy(this.object.quaternion),this._scaleStart.copy(this.object.scale),this.object.matrixWorld.decompose(this.worldPositionStart,this.worldQuaternionStart,this._worldScaleStart),this.pointStart.copy(t.point).sub(this.worldPositionStart)),this.dragging=!0,cB.mode=this.mode,this.dispatchEvent(cB)}}pointerMove(e){const t=this.axis,i=this.mode,s=this.object;let r=this.space;if(i==="scale"?r="local":(t==="E"||t==="XYZE"||t==="XYZ")&&(r="world"),s===void 0||t===null||this.dragging===!1||e.button!==-1)return;mu.setFromCamera(e,this.camera);const o=fS(this._plane,mu,!0);if(o){if(this.pointEnd.copy(o.point).sub(this.worldPositionStart),i==="translate")this._offset.copy(this.pointEnd).sub(this.pointStart),r==="local"&&t!=="XYZ"&&this._offset.applyQuaternion(this._worldQuaternionInv),t.indexOf("X")===-1&&(this._offset.x=0),t.indexOf("Y")===-1&&(this._offset.y=0),t.indexOf("Z")===-1&&(this._offset.z=0),r==="local"&&t!=="XYZ"?this._offset.applyQuaternion(this._quaternionStart).divide(this._parentScale):this._offset.applyQuaternion(this._parentQuaternionInv).divide(this._parentScale),s.position.copy(this._offset).add(this._positionStart),this.translationSnap&&(r==="local"&&(s.position.applyQuaternion(Yi.copy(this._quaternionStart).invert()),t.search("X")!==-1&&(s.position.x=Math.round(s.position.x/this.translationSnap)*this.translationSnap),t.search("Y")!==-1&&(s.position.y=Math.round(s.position.y/this.translationSnap)*this.translationSnap),t.search("Z")!==-1&&(s.position.z=Math.round(s.position.z/this.translationSnap)*this.translationSnap),s.position.applyQuaternion(this._quaternionStart)),r==="world"&&(s.parent&&s.position.add(Ns.setFromMatrixPosition(s.parent.matrixWorld)),t.search("X")!==-1&&(s.position.x=Math.round(s.position.x/this.translationSnap)*this.translationSnap),t.search("Y")!==-1&&(s.position.y=Math.round(s.position.y/this.translationSnap)*this.translationSnap),t.search("Z")!==-1&&(s.position.z=Math.round(s.position.z/this.translationSnap)*this.translationSnap),s.parent&&s.position.sub(Ns.setFromMatrixPosition(s.parent.matrixWorld))));else if(i==="scale"){if(t.search("XYZ")!==-1){let a=this.pointEnd.length()/this.pointStart.length();this.pointEnd.dot(this.pointStart)<0&&(a*=-1),Zl.set(a,a,a)}else Ns.copy(this.pointStart),Zl.copy(this.pointEnd),Ns.applyQuaternion(this._worldQuaternionInv),Zl.applyQuaternion(this._worldQuaternionInv),Zl.divide(Ns),t.search("X")===-1&&(Zl.x=1),t.search("Y")===-1&&(Zl.y=1),t.search("Z")===-1&&(Zl.z=1);s.scale.copy(this._scaleStart).multiply(Zl),this.scaleSnap&&(t.search("X")!==-1&&(s.scale.x=Math.round(s.scale.x/this.scaleSnap)*this.scaleSnap||this.scaleSnap),t.search("Y")!==-1&&(s.scale.y=Math.round(s.scale.y/this.scaleSnap)*this.scaleSnap||this.scaleSnap),t.search("Z")!==-1&&(s.scale.z=Math.round(s.scale.z/this.scaleSnap)*this.scaleSnap||this.scaleSnap))}else if(i==="rotate"){this._offset.copy(this.pointEnd).sub(this.pointStart);const a=20/this.worldPosition.distanceTo(Ns.setFromMatrixPosition(this.camera.matrixWorld));let c=!1;t==="XYZE"?(this.rotationAxis.copy(this._offset).cross(this.eye).normalize(),this.rotationAngle=this._offset.dot(Ns.copy(this.rotationAxis).cross(this.eye))*a):(t==="X"||t==="Y"||t==="Z")&&(this.rotationAxis.copy(aB[t]),Ns.copy(aB[t]),r==="local"&&Ns.applyQuaternion(this.worldQuaternion),Ns.cross(this.eye),Ns.length()===0?c=!0:this.rotationAngle=this._offset.dot(Ns.normalize())*a),(t==="E"||c)&&(this.rotationAxis.copy(this.eye),this.rotationAngle=this.pointEnd.angleTo(this.pointStart),this._startNorm.copy(this.pointStart).normalize(),this._endNorm.copy(this.pointEnd).normalize(),this.rotationAngle*=this._endNorm.cross(this._startNorm).dot(this.eye)<0?1:-1),this.rotationSnap&&(this.rotationAngle=Math.round(this.rotationAngle/this.rotationSnap)*this.rotationSnap),r==="local"&&t!=="E"&&t!=="XYZE"?(s.quaternion.copy(this._quaternionStart),s.quaternion.multiply(Yi.setFromAxisAngle(this.rotationAxis,this.rotationAngle)).normalize()):(this.rotationAxis.applyQuaternion(this._parentQuaternionInv),s.quaternion.copy(Yi.setFromAxisAngle(this.rotationAxis,this.rotationAngle)),s.quaternion.multiply(this._quaternionStart).normalize())}this.dispatchEvent(dS),this.dispatchEvent(hB)}}pointerUp(e){e.button===0&&(this.dragging&&this.axis!==null&&(lB.mode=this.mode,this.dispatchEvent(lB)),this.dragging=!1,this.axis=null)}dispose(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerHover),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.traverse(function(e){e.geometry&&e.geometry.dispose(),e.material&&e.material.dispose()})}attach(e){return this.object=e,this.visible=!0,this}detach(){return this.object=void 0,this.visible=!1,this.axis=null,this}reset(){this.enabled&&this.dragging&&(this.object.position.copy(this._positionStart),this.object.quaternion.copy(this._quaternionStart),this.object.scale.copy(this._scaleStart),this.dispatchEvent(dS),this.dispatchEvent(hB),this.pointStart.copy(this.pointEnd))}getRaycaster(){return mu}getMode(){return this.mode}setMode(e){this.mode=e}setTranslationSnap(e){this.translationSnap=e}setRotationSnap(e){this.rotationSnap=e}setScaleSnap(e){this.scaleSnap=e}setSize(e){this.size=e}setSpace(e){this.space=e}}function E8(n){if(this.domElement.ownerDocument.pointerLockElement)return{x:0,y:0,button:n.button};{const e=this.domElement.getBoundingClientRect();return{x:(n.clientX-e.left)/e.width*2-1,y:-(n.clientY-e.top)/e.height*2+1,button:n.button}}}function T8(n){if(this.enabled)switch(n.pointerType){case"mouse":case"pen":this.pointerHover(this._getPointer(n));break}}function M8(n){this.enabled&&(document.pointerLockElement||this.domElement.setPointerCapture(n.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.pointerHover(this._getPointer(n)),this.pointerDown(this._getPointer(n)))}function I8(n){this.enabled&&this.pointerMove(this._getPointer(n))}function R8(n){this.enabled&&(this.domElement.releasePointerCapture(n.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.pointerUp(this._getPointer(n)))}function fS(n,e,t){const i=e.intersectObject(n,!0);for(let s=0;s<i.length;s++)if(i[s].object.visible||t)return i[s];return!1}const Ty=new ws,Oi=new w(0,1,0),uB=new w(0,0,0),dB=new Ce,My=new Me,w0=new Me,Ta=new w,fB=new Ce,jm=new w(1,0,0),Iu=new w(0,1,0),Wm=new w(0,0,1),Iy=new w,ym=new w,bm=new w;class s1 extends ge{constructor(){super(),this.isTransformControlsGizmo=!0,this.type="TransformControlsGizmo";const e=new ri({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),t=new Ln({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),i=e.clone();i.opacity=.15;const s=t.clone();s.opacity=.5;const r=e.clone();r.color.setHex(16711680);const o=e.clone();o.color.setHex(65280);const a=e.clone();a.color.setHex(255);const c=e.clone();c.color.setHex(16711680),c.opacity=.5;const l=e.clone();l.color.setHex(65280),l.opacity=.5;const h=e.clone();h.color.setHex(255),h.opacity=.5;const d=e.clone();d.opacity=.25;const f=e.clone();f.color.setHex(16776960),f.opacity=.25,e.clone().color.setHex(16776960);const m=e.clone();m.color.setHex(7895160);const g=new xn(0,.04,.1,12);g.translate(0,.05,0);const y=new Ni(.08,.08,.08);y.translate(0,.04,0);const A=new gt;A.setAttribute("position",new ot([0,0,0,1,0,0],3));const v=new xn(.0075,.0075,.5,3);v.translate(0,.25,0);function b(V,O){const U=new el(V,.0075,3,64,O*Math.PI*2);return U.rotateY(Math.PI/2),U.rotateX(Math.PI/2),U}function _(){const V=new gt;return V.setAttribute("position",new ot([0,0,0,1,1,1],3)),V}const T={X:[[new me(g,r),[.5,0,0],[0,0,-Math.PI/2]],[new me(g,r),[-.5,0,0],[0,0,Math.PI/2]],[new me(v,r),[0,0,0],[0,0,-Math.PI/2]]],Y:[[new me(g,o),[0,.5,0]],[new me(g,o),[0,-.5,0],[Math.PI,0,0]],[new me(v,o)]],Z:[[new me(g,a),[0,0,.5],[Math.PI/2,0,0]],[new me(g,a),[0,0,-.5],[-Math.PI/2,0,0]],[new me(v,a),null,[Math.PI/2,0,0]]],XYZ:[[new me(new sl(.1,0),d.clone()),[0,0,0]]],XY:[[new me(new Ni(.15,.15,.01),h.clone()),[.15,.15,0]]],YZ:[[new me(new Ni(.15,.15,.01),c.clone()),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new me(new Ni(.15,.15,.01),l.clone()),[.15,0,.15],[-Math.PI/2,0,0]]]},E={X:[[new me(new xn(.2,0,.6,4),i),[.3,0,0],[0,0,-Math.PI/2]],[new me(new xn(.2,0,.6,4),i),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new me(new xn(.2,0,.6,4),i),[0,.3,0]],[new me(new xn(.2,0,.6,4),i),[0,-.3,0],[0,0,Math.PI]]],Z:[[new me(new xn(.2,0,.6,4),i),[0,0,.3],[Math.PI/2,0,0]],[new me(new xn(.2,0,.6,4),i),[0,0,-.3],[-Math.PI/2,0,0]]],XYZ:[[new me(new sl(.2,0),i)]],XY:[[new me(new Ni(.2,.2,.01),i),[.15,.15,0]]],YZ:[[new me(new Ni(.2,.2,.01),i),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new me(new Ni(.2,.2,.01),i),[.15,0,.15],[-Math.PI/2,0,0]]]},M={START:[[new me(new sl(.01,2),s),null,null,null,"helper"]],END:[[new me(new sl(.01,2),s),null,null,null,"helper"]],DELTA:[[new Sn(_(),s),null,null,null,"helper"]],X:[[new Sn(A,s.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new Sn(A,s.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new Sn(A,s.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},I={XYZE:[[new me(b(.5,1),m),null,[0,Math.PI/2,0]]],X:[[new me(b(.5,.5),r)]],Y:[[new me(b(.5,.5),o),null,[0,0,-Math.PI/2]]],Z:[[new me(b(.5,.5),a),null,[0,Math.PI/2,0]]],E:[[new me(b(.75,1),f),null,[0,Math.PI/2,0]]]},S={AXIS:[[new Sn(A,s.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]]},C={XYZE:[[new me(new Aa(.25,10,8),i)]],X:[[new me(new el(.5,.1,4,24),i),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],Y:[[new me(new el(.5,.1,4,24),i),[0,0,0],[Math.PI/2,0,0]]],Z:[[new me(new el(.5,.1,4,24),i),[0,0,0],[0,0,-Math.PI/2]]],E:[[new me(new el(.75,.1,2,24),i)]]},D={X:[[new me(y,r),[.5,0,0],[0,0,-Math.PI/2]],[new me(v,r),[0,0,0],[0,0,-Math.PI/2]],[new me(y,r),[-.5,0,0],[0,0,Math.PI/2]]],Y:[[new me(y,o),[0,.5,0]],[new me(v,o)],[new me(y,o),[0,-.5,0],[0,0,Math.PI]]],Z:[[new me(y,a),[0,0,.5],[Math.PI/2,0,0]],[new me(v,a),[0,0,0],[Math.PI/2,0,0]],[new me(y,a),[0,0,-.5],[-Math.PI/2,0,0]]],XY:[[new me(new Ni(.15,.15,.01),h),[.15,.15,0]]],YZ:[[new me(new Ni(.15,.15,.01),c),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new me(new Ni(.15,.15,.01),l),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new me(new Ni(.1,.1,.1),d.clone())]]},G={X:[[new me(new xn(.2,0,.6,4),i),[.3,0,0],[0,0,-Math.PI/2]],[new me(new xn(.2,0,.6,4),i),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new me(new xn(.2,0,.6,4),i),[0,.3,0]],[new me(new xn(.2,0,.6,4),i),[0,-.3,0],[0,0,Math.PI]]],Z:[[new me(new xn(.2,0,.6,4),i),[0,0,.3],[Math.PI/2,0,0]],[new me(new xn(.2,0,.6,4),i),[0,0,-.3],[-Math.PI/2,0,0]]],XY:[[new me(new Ni(.2,.2,.01),i),[.15,.15,0]]],YZ:[[new me(new Ni(.2,.2,.01),i),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new me(new Ni(.2,.2,.01),i),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new me(new Ni(.2,.2,.2),i),[0,0,0]]]},Q={X:[[new Sn(A,s.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new Sn(A,s.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new Sn(A,s.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]};function L(V){const O=new ge;for(const U in V)for(let H=V[U].length;H--;){const Y=V[U][H][0].clone(),J=V[U][H][1],se=V[U][H][2],fe=V[U][H][3],_e=V[U][H][4];Y.name=U,Y.tag=_e,J&&Y.position.set(J[0],J[1],J[2]),se&&Y.rotation.set(se[0],se[1],se[2]),fe&&Y.scale.set(fe[0],fe[1],fe[2]),Y.updateMatrix();const Oe=Y.geometry.clone();Oe.applyMatrix4(Y.matrix),Y.geometry=Oe,Y.renderOrder=1/0,Y.position.set(0,0,0),Y.rotation.set(0,0,0),Y.scale.set(1,1,1),O.add(Y)}return O}this.gizmo={},this.picker={},this.helper={},this.add(this.gizmo.translate=L(T)),this.add(this.gizmo.rotate=L(I)),this.add(this.gizmo.scale=L(D)),this.add(this.picker.translate=L(E)),this.add(this.picker.rotate=L(C)),this.add(this.picker.scale=L(G)),this.add(this.helper.translate=L(M)),this.add(this.helper.rotate=L(S)),this.add(this.helper.scale=L(Q)),this.picker.translate.visible=!1,this.picker.rotate.visible=!1,this.picker.scale.visible=!1}updateMatrixWorld(e){const i=(this.mode==="scale"?"local":this.space)==="local"?this.worldQuaternion:w0;this.gizmo.translate.visible=this.mode==="translate",this.gizmo.rotate.visible=this.mode==="rotate",this.gizmo.scale.visible=this.mode==="scale",this.helper.translate.visible=this.mode==="translate",this.helper.rotate.visible=this.mode==="rotate",this.helper.scale.visible=this.mode==="scale";let s=[];s=s.concat(this.picker[this.mode].children),s=s.concat(this.gizmo[this.mode].children),s=s.concat(this.helper[this.mode].children);for(let r=0;r<s.length;r++){const o=s[r];o.visible=!0,o.rotation.set(0,0,0),o.position.copy(this.worldPosition);let a;if(this.camera.isOrthographicCamera?a=(this.camera.top-this.camera.bottom)/this.camera.zoom:a=this.worldPosition.distanceTo(this.cameraPosition)*Math.min(1.9*Math.tan(Math.PI*this.camera.fov/360)/this.camera.zoom,7),o.scale.set(1,1,1).multiplyScalar(a*this.size/4),o.tag==="helper"){o.visible=!1,o.name==="AXIS"?(o.visible=!!this.axis,this.axis==="X"&&(Yi.setFromEuler(Ty.set(0,0,0)),o.quaternion.copy(i).multiply(Yi),Math.abs(Oi.copy(jm).applyQuaternion(i).dot(this.eye))>.9&&(o.visible=!1)),this.axis==="Y"&&(Yi.setFromEuler(Ty.set(0,0,Math.PI/2)),o.quaternion.copy(i).multiply(Yi),Math.abs(Oi.copy(Iu).applyQuaternion(i).dot(this.eye))>.9&&(o.visible=!1)),this.axis==="Z"&&(Yi.setFromEuler(Ty.set(0,Math.PI/2,0)),o.quaternion.copy(i).multiply(Yi),Math.abs(Oi.copy(Wm).applyQuaternion(i).dot(this.eye))>.9&&(o.visible=!1)),this.axis==="XYZE"&&(Yi.setFromEuler(Ty.set(0,Math.PI/2,0)),Oi.copy(this.rotationAxis),o.quaternion.setFromRotationMatrix(dB.lookAt(uB,Oi,Iu)),o.quaternion.multiply(Yi),o.visible=this.dragging),this.axis==="E"&&(o.visible=!1)):o.name==="START"?(o.position.copy(this.worldPositionStart),o.visible=this.dragging):o.name==="END"?(o.position.copy(this.worldPosition),o.visible=this.dragging):o.name==="DELTA"?(o.position.copy(this.worldPositionStart),o.quaternion.copy(this.worldQuaternionStart),Ns.set(1e-10,1e-10,1e-10).add(this.worldPositionStart).sub(this.worldPosition).multiplyScalar(-1),Ns.applyQuaternion(this.worldQuaternionStart.clone().invert()),o.scale.copy(Ns),o.visible=this.dragging):(o.quaternion.copy(i),this.dragging?o.position.copy(this.worldPositionStart):o.position.copy(this.worldPosition),this.axis&&(o.visible=this.axis.search(o.name)!==-1));continue}o.quaternion.copy(i),this.mode==="translate"||this.mode==="scale"?(o.name==="X"&&Math.abs(Oi.copy(jm).applyQuaternion(i).dot(this.eye))>.99&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1),o.name==="Y"&&Math.abs(Oi.copy(Iu).applyQuaternion(i).dot(this.eye))>.99&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1),o.name==="Z"&&Math.abs(Oi.copy(Wm).applyQuaternion(i).dot(this.eye))>.99&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1),o.name==="XY"&&Math.abs(Oi.copy(Wm).applyQuaternion(i).dot(this.eye))<.2&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1),o.name==="YZ"&&Math.abs(Oi.copy(jm).applyQuaternion(i).dot(this.eye))<.2&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1),o.name==="XZ"&&Math.abs(Oi.copy(Iu).applyQuaternion(i).dot(this.eye))<.2&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1)):this.mode==="rotate"&&(My.copy(i),Oi.copy(this.eye).applyQuaternion(Yi.copy(i).invert()),o.name.search("E")!==-1&&o.quaternion.setFromRotationMatrix(dB.lookAt(this.eye,uB,Iu)),o.name==="X"&&(Yi.setFromAxisAngle(jm,Math.atan2(-Oi.y,Oi.z)),Yi.multiplyQuaternions(My,Yi),o.quaternion.copy(Yi)),o.name==="Y"&&(Yi.setFromAxisAngle(Iu,Math.atan2(Oi.x,Oi.z)),Yi.multiplyQuaternions(My,Yi),o.quaternion.copy(Yi)),o.name==="Z"&&(Yi.setFromAxisAngle(Wm,Math.atan2(Oi.y,Oi.x)),Yi.multiplyQuaternions(My,Yi),o.quaternion.copy(Yi))),o.visible=o.visible&&(o.name.indexOf("X")===-1||this.showX),o.visible=o.visible&&(o.name.indexOf("Y")===-1||this.showY),o.visible=o.visible&&(o.name.indexOf("Z")===-1||this.showZ),o.visible=o.visible&&(o.name.indexOf("E")===-1||this.showX&&this.showY&&this.showZ),o.material._color=o.material._color||o.material.color.clone(),o.material._opacity=o.material._opacity||o.material.opacity,o.material.color.copy(o.material._color),o.material.opacity=o.material._opacity,this.enabled&&this.axis&&(o.name===this.axis||this.axis.split("").some(function(c){return o.name===c}))&&(o.material.color.setHex(16776960),o.material.opacity=1)}super.updateMatrixWorld(e)}}class P8 extends me{constructor(){super(new Wn(1e5,1e5,2,2),new ri({visible:!1,wireframe:!0,side:Ai,transparent:!0,opacity:.1,toneMapped:!1})),this.isTransformControlsPlane=!0,this.type="TransformControlsPlane"}updateMatrixWorld(e){let t=this.space;switch(this.position.copy(this.worldPosition),this.mode==="scale"&&(t="local"),Iy.copy(jm).applyQuaternion(t==="local"?this.worldQuaternion:w0),ym.copy(Iu).applyQuaternion(t==="local"?this.worldQuaternion:w0),bm.copy(Wm).applyQuaternion(t==="local"?this.worldQuaternion:w0),Oi.copy(ym),this.mode){case"translate":case"scale":switch(this.axis){case"X":Oi.copy(this.eye).cross(Iy),Ta.copy(Iy).cross(Oi);break;case"Y":Oi.copy(this.eye).cross(ym),Ta.copy(ym).cross(Oi);break;case"Z":Oi.copy(this.eye).cross(bm),Ta.copy(bm).cross(Oi);break;case"XY":Ta.copy(bm);break;case"YZ":Ta.copy(Iy);break;case"XZ":Oi.copy(bm),Ta.copy(ym);break;case"XYZ":case"E":Ta.set(0,0,0);break}break;case"rotate":default:Ta.set(0,0,0)}Ta.length()===0?this.quaternion.copy(this.cameraQuaternion):(fB.lookAt(Ns.set(0,0,0),Ta,Oi),this.quaternion.setFromRotationMatrix(fB)),super.updateMatrixWorld(e)}}const B8=re("debugpatch");function r1(n,e,t,i){const s=B8===e;if(!t&&!i)return;const r=e+"___needle";D8(n,e,t,i);const o=Object.getOwnPropertyDescriptor(n,e),a=n[e];s&&console.log("Patch",n.constructor.name,e,o,a),o?(s&&console.log("Apply patch with existing descriptor",n.constructor.name,e,o),typeof o.value=="function"&&(n[e]=mB(o.value,n,e))):(s&&console.log("Create patch with new property",n.constructor.name,e,o),Object.defineProperty(n,e,{set:function(c){if(typeof c=="function")this[r]=mB(c,n,e);else{const l=this[r];mF(n,e,this,l,c),this[r]=c,gF(n,e,this,l,c)}},get:function(){const c=this[r];return typeof c=="function"&&c[r]?c[r]:c}}))}const pB=Symbol("Needle:Patches:WrappedFunction");function mB(n,e,t){if(n[pB])return n;const i=function(...s){mF(e,t,this,...s);const r=n.apply(this,s);return gF(e,t,this,r,...s),r};return i[pB]=!0,i}const pS="Needle:Patches";function TE(){return globalThis[pS]||(globalThis[pS]=new WeakMap),globalThis[pS]}function pF(n,e){const t=TE().get(n);return t?t.get(e):null}function D8(n,e,t,i){let s=TE().get(n);s||(s=new Map,TE().set(n,s));let r=s.get(e);r||(r=[],s.set(e,r)),r.push({prefix:t,postfix:i})}function mF(n,e,t,...i){var r;if(!t)return;const s=pF(n,e);if(s)for(const o of s)(r=o.prefix)==null||r.call(t,...i)}function gF(n,e,t,i,...s){var o;if(!t)return;const r=pF(n,e);if(r)for(const a of r)(o=a.postfix)==null||o.call(t,i,...s)}const gB=Symbol("gltf-loader-internal-usage-tracker"),O8=re("debugusers"),Lg=class{constructor(e){u(this,"parser");u(this,"_getDependency");u(this,"_loadingId");u(this,"_loadedObjects",new Set);this.parser=e,this._getDependency=this.parser.getDependency,this._loadingId=Date.now().toString()}get name(){return"NEEDLE_internal_usage_tracker"}static isLoading(e){return Lg._loadingProcesses>0}beforeRoot(){Lg._loadingProcesses++;const e=this,t=this._getDependency;return this.parser.getDependency=function(i,s){const r=t.call(this,i,s);return r.then(o=>(o&&(e._loadedObjects.add(o),o[gB]=e._loadingId),o)),r},null}afterRoot(e){Lg._loadingProcesses--,this.parser.getDependency=this._getDependency;for(const t of this._loadedObjects)delete t[gB],t instanceof ge&&(t.parent||t instanceof me&&(O8&&console.warn("> GLTF LOADER: Mesh not used in scene!",t),t.material=null,t.geometry=null));return null}};let cg=Lg;u(cg,"_loadingProcesses",0);class k8{constructor(){window.addEventListener("unhandledrejection",e=>{var i;if(e.defaultPrevented)return;const t=(i=e==null?void 0:e.reason)==null?void 0:i.path;if(t){const s=t[0];s&&s.tagName==="IMG"&&(console.warn(`Could not load image:
`+s.src),e.preventDefault())}})}}const nx=re("trackresources");function AF(){return nx==="dispose"}let Dp=!0;nx===0&&(Dp=!1);function L8(){return Dp}const vF=Symbol("disposable");function yF(n,e){n&&(n[vF]=e,Ju&&console.warn("Set disposable",e,n))}const F8=Symbol("disposed");function Qi(n){var e;if(n){if(n[vF]===!1){Ju&&console.warn("Object is marked as not disposable",n);return}if(n[F8]=!0,n instanceof Ws)Qi(n.environment),Qi(n.background),Qi(n.customDepthMaterial),Qi(n.customDistanceMaterial);else if(n instanceof cc)Qi(n.geometry),Qi(n.material),Qi(n.skeleton),Qi(n.bindMatrix),Qi(n.bindMatrixInverse),Qi(n.customDepthMaterial),Qi(n.customDistanceMaterial),n.geometry=null,n.material=null;else if(n instanceof me)Qi(n.geometry),Qi(n.material),Qi(n.customDepthMaterial),Qi(n.customDistanceMaterial),n.geometry=null,n.material=null;else if(n instanceof gt){af(n);for(const t of Object.keys(n.attributes)){const i=n.attributes[t];Qi(i)}}else if(n instanceof it||n instanceof pr)Ju&&console.warn("BufferAttribute dispose not supported",n.count);else if(n instanceof Array)for(const t of n)t instanceof Ot&&Qi(t);else if(n instanceof Ot){af(n);for(const i of Object.keys(n)){const s=n[i];s instanceof Ft&&(Qi(s),n[i]=null)}const t=n.uniforms;if(t)for(const i of Object.keys(t)){const s=t[i];s instanceof Ft?(Qi(s),t[i]=null):s instanceof we&&(Qi(s.value),s.value=null)}}else n instanceof Ft?(af(n),af(n.source),((e=n.source)==null?void 0:e.data)instanceof ImageBitmap&&af(n.source.data)):n instanceof Ip?(af(n.boneTexture),n.boneTexture=null):n instanceof GA||!(n instanceof ge)&&Ju&&console.warn("Unknown object type",n)}}function af(n){n&&((Ju||AF()||nx)&&console.warn(" FREE",n),n instanceof ImageBitmap?n.close():n instanceof nl?n.data=null:n.dispose())}function U8(n){(n instanceof me||n instanceof cc)&&(n.material=null,n.geometry=null)}const N8=new Set;function bF(n,e,t=null,i){if(i||(i=N8,i.clear()),!n)return i;const s=n[rA];if(s)for(const r of s)i.has(r)||(t==null?void 0:t.call(null,r))!==!1&&(i.add(r),e&&bF(r,!0,t,i));return i}const Ju=re("debugresourceusers")||re("debugmemory"),rA=Symbol("needle-resource-users"),Ry=Symbol("needle-resource-users-count");function ir(n,e){r1(n,e,function(t,i){Dp&&(mb(rA,this,t,!1),mb(rA,this,i,!0))})}Dp&&(ir(me.prototype,"material"),ir(me.prototype,"geometry"),ir(Ot.prototype,"map"),ir(Ot.prototype,"bumpMap"),ir(Ot.prototype,"alphaMap"),ir(Ot.prototype,"normalMap"),ir(Ot.prototype,"displacementMap"),ir(Ot.prototype,"roughnessMap"),ir(Ot.prototype,"metalnessMap"),ir(Ot.prototype,"emissiveMap"),ir(Ot.prototype,"specularMap"),ir(Ot.prototype,"envMap"),ir(Ot.prototype,"lightMap"),ir(Ot.prototype,"aoMap"),ir(Ot.prototype,"gradientMap"));function z8(n){if(Dp===!1)return;const e=n[rA];if(e)for(const t of e)mb(rA,t,n,!1)}Dp&&r1(Ot.prototype,"dispose",function(){z8(this)});let ME=0;function mb(n,e,t,i){if(ME>0)return;if(Array.isArray(t)){for(const r of t)mb(n,e,r,i);return}if(!t)return;let s=t[n];if(s||(s=new Set),i){if(e&&!s.has(e)){s.add(e);let r=t[Ry]||0;r+=1,t[Ry]=r,Ju&&console.warn(` Added user of "${t.type}"`,e,t,r,"users:",s)}}else if(e&&s.has(e)){s.delete(e);let r=t[Ry]||0;r>0&&(r-=1,t[Ry]=r),Ju&&console.warn(` Removed user of "${t.type}"`,e,t,r,"users:",s),r<=0&&(cg.isLoading(t)||(nx&&console.warn(` Removed all user of "${t.type}"`,t),AF()&&Qi(t)))}t[n]=s}try{r1(Rl.prototype,"render",function(){ME++},function(){ME--})}catch(n){console.warn("Could not wrap WebGLRenderer.render",n)}var oA;(function(n){n.Added="component-added",n.Removing="removing-component"})(oA||(oA={}));const AB=re("debugcomponentevents");class sx{static addComponentLifecylceEventListener(e,t){this.eventListeners.has(e)&&this.eventListeners.set(e,[]);let i=this.eventListeners.get(e);i||(i=[]),i.push(t),this.eventListeners.set(e,i),AB&&console.log("Added event listener for "+e,this.eventListeners)}static removeComponentLifecylceEventListener(e,t){const i=this.eventListeners.get(e);if(!i)return;const s=i.indexOf(t);s<0||i.splice(s,1)}static dispatchComponentLifecycleEvent(e,t){const i=this.eventListeners.get(e);if(AB&&console.log("Dispatching event "+e,i),!!i)for(const s of i)s(t)}}u(sx,"eventListeners",new Map);const _F=re("debugdefines");Op('if(!globalThis[""3.32.21-alpha""]) globalThis[""3.32.21-alpha""] = "0.0.0";');Op('if(!globalThis[""Unity 2022.3.16f1, Needle Engine Integration @3.32.21-exp""]) globalThis[""Unity 2022.3.16f1, Needle Engine Integration @3.32.21-exp""] = "unknown";');Op('if(!globalThis[""Fri Feb 16 2024 14:26:48 GMT+0100 (Central European Standard Time)""]) globalThis[""Fri Feb 16 2024 14:26:48 GMT+0100 (Central European Standard Time)""] = "unknown";');Op('globalThis["__NEEDLE_ENGINE_VERSION__"] = "3.32.21-alpha";');Op('globalThis["__NEEDLE_ENGINE_GENERATOR__"] = "Unity 2022.3.16f1, Needle Engine Integration @3.32.21-exp";');Op('globalThis["__NEEDLE_PROJECT_BUILD_TIME__"] = "Fri Feb 16 2024 14:26:48 GMT+0100 (Central European Standard Time)";');const ol="3.32.21-alpha",o1="Unity 2022.3.16f1, Needle Engine Integration @3.32.21-exp",G8="Fri Feb 16 2024 14:26:48 GMT+0100 (Central European Standard Time)";_F&&console.log(`Engine version: ${ol} (generator: ${o1})
Project built at ${G8}`);const Bh="needle_isActiveInHierarchy",vf="builtin_components",S0="needle_editor_guid";function Op(n){try{(0,eval)(n)}catch(e){_F&&console.error(e)}}const aA=Symbol("NEEDLE_NEED_UPDATE_INSTANCE"),xF=Symbol("isUsingInstancing"),wF=Symbol("instancingRenderer"),IE=Symbol("instancingAutoUpdateBounds");class uc{static isUsingInstancing(e){return e[xF]===!0}static getRenderer(e){return e[wF]||null}setAutoUpdateBounds(e,t){const i=uc.getRenderer(e);i&&(i[IE]=t)}static markDirty(e,t=!0){if(e&&(this.isUsingInstancing(e)&&(e[aA]=!0,e.matrixWorldNeedsUpdate=!0),t))for(const i of e.children)uc.markDirty(i,!0)}}function Ku(n,e){try{e?n(e):n()}catch(t){return console.error(t),!1}return!0}const RE=re("debugnewscripts"),V8=re("debughierarchy"),Wi=[];function H8(){return Wi.length>0}function gb(n){if(!(n.new_scripts.length<=0)){if(RE&&console.log("Register new components",n.new_scripts.length,[...n.new_scripts],n.alias?"element: "+n.alias:n.hash,n),n.new_scripts_pre_setup_callbacks.length>0){for(const e of n.new_scripts_pre_setup_callbacks)e&&e();n.new_scripts_pre_setup_callbacks.length=0}Wi.length=0,n.new_scripts.length>0&&Wi.push(...n.new_scripts),n.new_scripts.length=0;for(let e=0;e<Wi.length;e++)try{const t=Wi[e];if(t.isComponent!==!0){(Tt()||RE)&&console.error(`Registered script is not a Needle Engine component. 
The script will be ignored. Please make sure your component extends "Behaviour" imported from "@needle-tools/engine"
`,t),Wi.splice(e,1),e--;continue}if(t.destroyed)continue;if(!t.gameObject){console.error("MISSING GAMEOBJECT - will ignore",t),Wi.splice(e,1),e--;continue}t.context=n,lg(t.gameObject),CF(t,n)}catch(t){console.error(t),vh(Wi[e],n),Wi.splice(e,1),e--}for(let e=0;e<Wi.length;e++)try{const t=Wi[e];if(t.destroyed){vh(Wi[e],n),Wi.splice(e,1),e--;continue}if(t.registering)try{t.registering()}catch(i){console.error(i)}t.__internalAwake!==void 0&&(t.gameObject||console.error("MISSING GAMEOBJECT",t,t.gameObject),lg(t.gameObject),t.activeAndEnabled&&Ku(t.__internalAwake.bind(t)))}catch(t){console.error(t),vh(Wi[e],n),Wi.splice(e,1),e--}for(let e=0;e<Wi.length;e++)try{const t=Wi[e];if(t.destroyed||t.enabled===!1||(lg(t.gameObject),t.activeAndEnabled===!1))continue;t.__internalEnable!==void 0&&(t.enabled=!0,Ku(t.__internalEnable.bind(t)))}catch(t){console.error(t),vh(Wi[e],n),Wi.splice(e,1),e--}for(let e=0;e<Wi.length;e++)try{const t=Wi[e];if(t.destroyed||!t.gameObject)continue;n.new_script_start.push(t)}catch(t){console.error(t),vh(Wi[e],n),Wi.splice(e,1),e--}Wi.length=0;for(const e of n.new_scripts_post_setup_callbacks)e&&e();n.new_scripts_post_setup_callbacks.length=0}}function Q8(n){n&&(n.__internalDisable(!0),vh(n,n.context))}function SF(n,e){for(let t=0;t<n.new_script_start.length;t++)try{const i=n.new_script_start[t];if(e!==void 0&&i.gameObject!==e||i.destroyed||i.activeAndEnabled===!1)continue;Ku(i.__internalAwake.bind(i)),i.enabled&&(Ku(i.__internalEnable.bind(i)),Ku(i.__internalStart.bind(i)),n.new_script_start.splice(t,1),t--)}catch(i){console.error(i),vh(n.new_script_start[t],n),n.new_script_start.splice(t,1),t--}}function CF(n,e){e.scripts.indexOf(n)===-1&&(e.scripts.push(n),n.earlyUpdate&&e.scripts_earlyUpdate.push(n),n.update&&e.scripts_update.push(n),n.lateUpdate&&e.scripts_lateUpdate.push(n),n.onBeforeRender&&e.scripts_onBeforeRender.push(n),n.onAfterRender&&e.scripts_onAfterRender.push(n),n.onPausedChanged&&e.scripts_pausedChanged.push(n),mS(n,null)&&e.new_scripts_xr.push(n),mS(n,"immersive-vr")&&e.scripts_immersive_vr.push(n),mS(n,"immersive-ar")&&e.scripts_immersive_ar.push(n))}function vh(n,e){mo(n,e.new_scripts),mo(n,e.new_script_start),mo(n,e.scripts),mo(n,e.scripts_earlyUpdate),mo(n,e.scripts_update),mo(n,e.scripts_lateUpdate),mo(n,e.scripts_onBeforeRender),mo(n,e.scripts_onAfterRender),mo(n,e.scripts_pausedChanged),mo(n,e.new_scripts_xr),mo(n,e.scripts_immersive_vr),mo(n,e.scripts_immersive_ar),e.stopAllCoroutinesFrom(n)}function mo(n,e){const t=e.indexOf(n);t>=0&&e.splice(t,1)}function mS(n,e){var t;if(n){const i=n;if(i.onBeforeXR||i.onEnterXR||i.onUpdateXR||i.onLeaveXR||i.onXRControllerAdded||i.onXRControllerRemoved)return!(e!=null&&((t=i.supportsXR)==null?void 0:t.call(i,e))===!1)}return!1}function C0(n){if(n||(n=zi.Current.scene),!n){console.trace("Invalid call - no current context.");return}const e=ev(n);EF(n,e,!0)||(RE||Tt()?console.error(`Error updating hierarchy
Do you have circular references in your project? <a target="_blank" href="https://docs.needle.tools/circular-reference"> Click here for more information.`,n):console.error('Failed to update active state in hierarchy of "'+n.name+'"',n),console.warn("  this error might be caused by circular references. Please make sure you don't have files with circular references (e.g. one GLB 1 is loading GLB 2 which is then loading GLB 1 again)."))}function EF(n,e,t,i=0){if(i>1e3)return console.warn("Hierarchy is too deep (> 1000 level) - will abort updating active state"),!1;const s=ev(n);if(e&&(e=s,e&&n.parent)){const c=n.parent;e=c[Bh],e===void 0&&(c instanceof Ws||(e=!0))}const o=n[Bh]!==e;n[Bh]=e,o&&(V8&&console.warn("ACTIVE CHANGE",n.name,s,n.visible,e,"changed?"+o,n),t&&j8(n,c=>{e?c.enabled&&(Ku(c.__internalAwake.bind(c)),c.enabled&&(c.__didEnable=!0,c.onEnable())):c.__didAwake&&c.enabled&&(c.__didEnable=!1,c.onDisable())}));let a=!0;if(n.children){const c=i+1;for(const l of n.children)EF(l,e,t,c)===!1&&(a=!1)}return a}function lg(n){let e=!0,t=n,i=!1;for(;t&&t;){if(t.type==="Scene"&&(i=!0),!ev(t)){e=!1;break}t=t.parent}if(!n){console.error("GO is null");return}n[Bh]=e&&i}function j8(n,e){var t;if((t=n.userData)!=null&&t.components)for(const i of n.userData.components)e(i)}const E0=new Map,TF=Symbol("prewarmFlag"),PE=Symbol("waitingForPrewarm"),BE=re("debugprewarm");function MF(n,e){if(!n||n[TF]===!0||n[PE]===!0)return;E0.has(e)||E0.set(e,[]),n[PE]=!0,E0.get(e).push(n),BE&&console.debug("register prewarm",n.name)}let vB=null,yB=null;function W8(n){if(!n)return;const e=E0.get(n);if(!(e!=null&&e.length))return;const t=n.mainCamera;if(t){BE&&console.log("prewarm",e.length,"objects",[...e]);const i=n.renderer;if(i.compile){const s=n.scene;i.compile(s,t),vB??(vB=new xM(64)),yB??(yB=new _M(.001,9999999,vB)),yB.update(i,s);for(const r of e)r[TF]=!0,r[PE]=!1;e.length=0,BE&&console.log("prewarm done")}}}const q8=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function X8(n){return typeof n=="string"&&q8.test(n)}const ms=[];for(let n=0;n<256;++n)ms.push((n+256).toString(16).slice(1));function Y8(n,e=0){return ms[n[e+0]]+ms[n[e+1]]+ms[n[e+2]]+ms[n[e+3]]+"-"+ms[n[e+4]]+ms[n[e+5]]+"-"+ms[n[e+6]]+ms[n[e+7]]+"-"+ms[n[e+8]]+ms[n[e+9]]+"-"+ms[n[e+10]]+ms[n[e+11]]+ms[n[e+12]]+ms[n[e+13]]+ms[n[e+14]]+ms[n[e+15]]}function J8(n){if(!X8(n))throw TypeError("Invalid UUID");let e;const t=new Uint8Array(16);return t[0]=(e=parseInt(n.slice(0,8),16))>>>24,t[1]=e>>>16&255,t[2]=e>>>8&255,t[3]=e&255,t[4]=(e=parseInt(n.slice(9,13),16))>>>8,t[5]=e&255,t[6]=(e=parseInt(n.slice(14,18),16))>>>8,t[7]=e&255,t[8]=(e=parseInt(n.slice(19,23),16))>>>8,t[9]=e&255,t[10]=(e=parseInt(n.slice(24,36),16))/1099511627776&255,t[11]=e/4294967296&255,t[12]=e>>>24&255,t[13]=e>>>16&255,t[14]=e>>>8&255,t[15]=e&255,t}function K8(n){n=unescape(encodeURIComponent(n));const e=[];for(let t=0;t<n.length;++t)e.push(n.charCodeAt(t));return e}const Z8="6ba7b810-9dad-11d1-80b4-00c04fd430c8",$8="6ba7b811-9dad-11d1-80b4-00c04fd430c8";function e9(n,e,t){function i(s,r,o,a){var c;if(typeof s=="string"&&(s=K8(s)),typeof r=="string"&&(r=J8(r)),((c=r)===null||c===void 0?void 0:c.length)!==16)throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");let l=new Uint8Array(16+s.length);if(l.set(r),l.set(s,r.length),l=t(l),l[6]=l[6]&15|e,l[8]=l[8]&63|128,o){a=a||0;for(let h=0;h<16;++h)o[a+h]=l[h];return o}return Y8(l)}try{i.name=n}catch{}return i.DNS=Z8,i.URL=$8,i}function t9(n,e,t,i){switch(n){case 0:return e&t^~e&i;case 1:return e^t^i;case 2:return e&t^e&i^t&i;case 3:return e^t^i}}function gS(n,e){return n<<e|n>>>32-e}function i9(n){const e=[1518500249,1859775393,2400959708,3395469782],t=[1732584193,4023233417,2562383102,271733878,3285377520];if(typeof n=="string"){const o=unescape(encodeURIComponent(n));n=[];for(let a=0;a<o.length;++a)n.push(o.charCodeAt(a))}else Array.isArray(n)||(n=Array.prototype.slice.call(n));n.push(128);const i=n.length/4+2,s=Math.ceil(i/16),r=new Array(s);for(let o=0;o<s;++o){const a=new Uint32Array(16);for(let c=0;c<16;++c)a[c]=n[o*64+c*4]<<24|n[o*64+c*4+1]<<16|n[o*64+c*4+2]<<8|n[o*64+c*4+3];r[o]=a}r[s-1][14]=(n.length-1)*8/Math.pow(2,32),r[s-1][14]=Math.floor(r[s-1][14]),r[s-1][15]=(n.length-1)*8&4294967295;for(let o=0;o<s;++o){const a=new Uint32Array(80);for(let p=0;p<16;++p)a[p]=r[o][p];for(let p=16;p<80;++p)a[p]=gS(a[p-3]^a[p-8]^a[p-14]^a[p-16],1);let c=t[0],l=t[1],h=t[2],d=t[3],f=t[4];for(let p=0;p<80;++p){const m=Math.floor(p/20),g=gS(c,5)+t9(m,l,h,d)+f+e[m]+a[p]>>>0;f=d,d=h,h=gS(l,30)>>>0,l=c,c=g}t[0]=t[0]+c>>>0,t[1]=t[1]+l>>>0,t[2]=t[2]+h>>>0,t[3]=t[3]+d>>>0,t[4]=t[4]+f>>>0}return[t[0]>>24&255,t[0]>>16&255,t[0]>>8&255,t[0]&255,t[1]>>24&255,t[1]>>16&255,t[1]>>8&255,t[1]&255,t[2]>>24&255,t[2]>>16&255,t[2]>>8&255,t[2]&255,t[3]>>24&255,t[3]>>16&255,t[3]>>8&255,t[3]&255,t[4]>>24&255,t[4]>>16&255,t[4]>>8&255,t[4]&255]}const n9=e9("v5",80,i9),bB=n9;var ia;(function(n){n[n.OnConnection=0]="OnConnection",n[n.OnRoomJoin=1]="OnRoomJoin",n[n.Queued=2]="Queued",n[n.Immediate=3]="Immediate"})(ia||(ia={}));/**
 * postprocessing v6.33.4 build Sat Dec 02 2023
 * https://github.com/pmndrs/postprocessing
 * Copyright 2015-2023 Raoul van Rschen
 * @license Zlib
 */var kp="varying vec2 vUv;void main(){vUv=position.xy*0.5+0.5;gl_Position=vec4(position.xy,1.0,1.0);}",s9=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#if PASS == 1
uniform vec4 kernel64[32];
#else
uniform vec4 kernel16[8];
#endif
uniform lowp sampler2D cocBuffer;uniform vec2 texelSize;uniform float scale;varying vec2 vUv;void main(){
#ifdef FOREGROUND
vec2 cocNearFar=texture2D(cocBuffer,vUv).rg*scale;float coc=cocNearFar.x;
#else
float coc=texture2D(cocBuffer,vUv).g*scale;
#endif
if(coc==0.0){gl_FragColor=texture2D(inputBuffer,vUv);}else{
#ifdef FOREGROUND
vec2 step=texelSize*max(cocNearFar.x,cocNearFar.y);
#else
vec2 step=texelSize*coc;
#endif
#if PASS == 1
vec4 acc=vec4(0.0);for(int i=0;i<32;++i){vec4 kernel=kernel64[i];vec2 uv=step*kernel.xy+vUv;acc+=texture2D(inputBuffer,uv);uv=step*kernel.zw+vUv;acc+=texture2D(inputBuffer,uv);}gl_FragColor=acc/64.0;
#else
vec4 maxValue=texture2D(inputBuffer,vUv);for(int i=0;i<8;++i){vec4 kernel=kernel16[i];vec2 uv=step*kernel.xy+vUv;maxValue=max(texture2D(inputBuffer,uv),maxValue);uv=step*kernel.zw+vUv;maxValue=max(texture2D(inputBuffer,uv),maxValue);}gl_FragColor=maxValue;
#endif
}}`,Py=class extends Et{constructor(n=!1,e=!1){super({name:"BokehMaterial",defines:{PASS:n?"2":"1"},uniforms:{inputBuffer:new we(null),cocBuffer:new we(null),texelSize:new we(new ie),kernel64:new we(null),kernel16:new we(null),scale:new we(1)},blending:rn,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:s9,vertexShader:kp}),e&&(this.defines.FOREGROUND="1"),this.generateKernel()}set inputBuffer(n){this.uniforms.inputBuffer.value=n}setInputBuffer(n){this.uniforms.inputBuffer.value=n}set cocBuffer(n){this.uniforms.cocBuffer.value=n}setCoCBuffer(n){this.uniforms.cocBuffer.value=n}get scale(){return this.uniforms.scale.value}set scale(n){this.uniforms.scale.value=n}getScale(n){return this.scale}setScale(n){this.scale=n}generateKernel(){const n=2.39996323,e=new Float64Array(128),t=new Float64Array(32);let i=0,s=0;for(let r=0,o=Math.sqrt(80);r<80;++r){const a=r*n,c=Math.sqrt(r)/o,l=c*Math.cos(a),h=c*Math.sin(a);r%5===0?(t[s++]=l,t[s++]=h):(e[i++]=l,e[i++]=h)}this.uniforms.kernel64.value=e,this.uniforms.kernel16.value=t}setTexelSize(n,e){this.uniforms.texelSize.value.set(n,e)}setSize(n,e){this.uniforms.texelSize.value.set(1/n,1/e)}},Gt={SKIP:9,SET:30,ADD:0,ALPHA:1,AVERAGE:2,COLOR:3,COLOR_BURN:4,COLOR_DODGE:5,DARKEN:6,DIFFERENCE:7,DIVIDE:8,DST:9,EXCLUSION:10,HARD_LIGHT:11,HARD_MIX:12,HUE:13,INVERT:14,INVERT_RGB:15,LIGHTEN:16,LINEAR_BURN:17,LINEAR_DODGE:18,LINEAR_LIGHT:19,LUMINOSITY:20,MULTIPLY:21,NEGATION:22,NORMAL:23,OVERLAY:24,PIN_LIGHT:25,REFLECT:26,SATURATION:27,SCREEN:28,SOFT_LIGHT:29,SRC:30,SUBTRACT:31,VIVID_LIGHT:32},IF={RED:0,GREEN:1,BLUE:2,ALPHA:3},RF="",Bi="srgb",rx="srgb-linear",hg={DEFAULT:0,KEEP_MAX_DEPTH:1,DISCARD_MAX_DEPTH:2},a1={DEPTH:0,LUMA:1,COLOR:2},no={NONE:0,DEPTH:1,CONVOLUTION:2},mi={FRAGMENT_HEAD:"FRAGMENT_HEAD",FRAGMENT_MAIN_UV:"FRAGMENT_MAIN_UV",FRAGMENT_MAIN_IMAGE:"FRAGMENT_MAIN_IMAGE",VERTEX_HEAD:"VERTEX_HEAD",VERTEX_MAIN_SUPPORT:"VERTEX_MAIN_SUPPORT"},Sl={VERY_SMALL:0,SMALL:1,MEDIUM:2,LARGE:3,VERY_LARGE:4,HUGE:5},PF={DISCARD:0,MULTIPLY:1,MULTIPLY_RGB_SET_ALPHA:2,MULTIPLY_RGB:3},r9={DISABLED:0,DEPTH:1,CUSTOM:2},yf={LOW:0,MEDIUM:1,HIGH:2,ULTRA:3},By={DEFAULT:0,ESKIL:1},BF=Number(qh.replace(/\D+/g,"")),DF=BF>=152,o9=new Map([[OA,rx],[ac,Bi]]),a9=new Map([[rx,OA],[Bi,ac]]);function Cl(n){return n===null?null:DF?n.outputColorSpace:o9.get(n.outputEncoding)}function Lr(n,e){n!==null&&(DF?n.colorSpace=e:n.encoding=a9.get(e))}function Lp(n){return BF<154?n.replace("colorspace_fragment","encodings_fragment"):n}function Pf(n,e,t){return n*(e-t)-e}function zu(n,e,t){return Math.min(Math.max((n+e)/(e-t),0),1)}var c9=`#include <common>
#include <packing>
#ifdef GL_FRAGMENT_PRECISION_HIGH
uniform highp sampler2D depthBuffer;
#else
uniform mediump sampler2D depthBuffer;
#endif
uniform float focusDistance;uniform float focusRange;uniform float cameraNear;uniform float cameraFar;varying vec2 vUv;float readDepth(const in vec2 uv){
#if DEPTH_PACKING == 3201
float depth=unpackRGBAToDepth(texture2D(depthBuffer,uv));
#else
float depth=texture2D(depthBuffer,uv).r;
#endif
#ifdef LOG_DEPTH
float d=pow(2.0,depth*log2(cameraFar+1.0))-1.0;float a=cameraFar/(cameraFar-cameraNear);float b=cameraFar*cameraNear/(cameraNear-cameraFar);depth=a+b/d;
#endif
return depth;}void main(){float depth=readDepth(vUv);
#ifdef PERSPECTIVE_CAMERA
float viewZ=perspectiveDepthToViewZ(depth,cameraNear,cameraFar);float linearDepth=viewZToOrthographicDepth(viewZ,cameraNear,cameraFar);
#else
float linearDepth=depth;
#endif
float signedDistance=linearDepth-focusDistance;float magnitude=smoothstep(0.0,focusRange,abs(signedDistance));gl_FragColor.rg=magnitude*vec2(step(signedDistance,0.0),step(0.0,signedDistance));}`,l9=class extends Et{constructor(n){super({name:"CircleOfConfusionMaterial",defines:{DEPTH_PACKING:"0"},uniforms:{depthBuffer:new we(null),focusDistance:new we(0),focusRange:new we(0),cameraNear:new we(.3),cameraFar:new we(1e3)},blending:rn,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:c9,vertexShader:kp}),this.uniforms.focalLength=this.uniforms.focusRange,this.copyCameraSettings(n)}get near(){return this.uniforms.cameraNear.value}get far(){return this.uniforms.cameraFar.value}set depthBuffer(n){this.uniforms.depthBuffer.value=n}set depthPacking(n){this.defines.DEPTH_PACKING=n.toFixed(0),this.needsUpdate=!0}setDepthBuffer(n,e=Ts){this.depthBuffer=n,this.depthPacking=e}get focusDistance(){return this.uniforms.focusDistance.value}set focusDistance(n){this.uniforms.focusDistance.value=n}get worldFocusDistance(){return-Pf(this.focusDistance,this.near,this.far)}set worldFocusDistance(n){this.focusDistance=zu(-n,this.near,this.far)}getFocusDistance(n){this.uniforms.focusDistance.value=n}setFocusDistance(n){this.uniforms.focusDistance.value=n}get focalLength(){return this.focusRange}set focalLength(n){this.focusRange=n}get focusRange(){return this.uniforms.focusRange.value}set focusRange(n){this.uniforms.focusRange.value=n}get worldFocusRange(){return-Pf(this.focusRange,this.near,this.far)}set worldFocusRange(n){this.focusRange=zu(-n,this.near,this.far)}getFocalLength(n){return this.focusRange}setFocalLength(n){this.focusRange=n}adoptCameraSettings(n){this.copyCameraSettings(n)}copyCameraSettings(n){n&&(this.uniforms.cameraNear.value=n.near,this.uniforms.cameraFar.value=n.far,n instanceof Wt?this.defines.PERSPECTIVE_CAMERA="1":delete this.defines.PERSPECTIVE_CAMERA,this.needsUpdate=!0)}},h9=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec4 sum=texture2D(inputBuffer,vUv0);sum+=texture2D(inputBuffer,vUv1);sum+=texture2D(inputBuffer,vUv2);sum+=texture2D(inputBuffer,vUv3);gl_FragColor=sum*0.25;
#include <colorspace_fragment>
}`,u9="uniform vec4 texelSize;uniform float kernel;uniform float scale;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec2 uv=position.xy*0.5+0.5;vec2 dUv=(texelSize.xy*vec2(kernel)+texelSize.zw)*scale;vUv0=vec2(uv.x-dUv.x,uv.y+dUv.y);vUv1=vec2(uv.x+dUv.x,uv.y+dUv.y);vUv2=vec2(uv.x+dUv.x,uv.y-dUv.y);vUv3=vec2(uv.x-dUv.x,uv.y-dUv.y);gl_Position=vec4(position.xy,1.0,1.0);}",d9=[new Float32Array([0,0]),new Float32Array([0,1,1]),new Float32Array([0,1,1,2]),new Float32Array([0,1,2,2,3]),new Float32Array([0,1,2,3,4,4,5]),new Float32Array([0,1,2,3,4,5,7,8,9,10])],OF=class extends Et{constructor(n=new tt){super({name:"KawaseBlurMaterial",uniforms:{inputBuffer:new we(null),texelSize:new we(new tt),scale:new we(1),kernel:new we(0)},blending:rn,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:h9,vertexShader:u9}),this.fragmentShader=Lp(this.fragmentShader),this.setTexelSize(n.x,n.y),this.kernelSize=Sl.MEDIUM}set inputBuffer(n){this.uniforms.inputBuffer.value=n}setInputBuffer(n){this.inputBuffer=n}get kernelSequence(){return d9[this.kernelSize]}get scale(){return this.uniforms.scale.value}set scale(n){this.uniforms.scale.value=n}getScale(){return this.uniforms.scale.value}setScale(n){this.uniforms.scale.value=n}getKernel(){return null}get kernel(){return this.uniforms.kernel.value}set kernel(n){this.uniforms.kernel.value=n}setKernel(n){this.kernel=n}setTexelSize(n,e){this.uniforms.texelSize.value.set(n,e,n*.5,e*.5)}setSize(n,e){const t=1/n,i=1/e;this.uniforms.texelSize.value.set(t,i,t*.5,i*.5)}},f9=`#include <common>
#include <dithering_pars_fragment>
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
uniform float opacity;varying vec2 vUv;void main(){vec4 texel=texture2D(inputBuffer,vUv);gl_FragColor=opacity*texel;
#include <colorspace_fragment>
#include <dithering_fragment>
}`,kF=class extends Et{constructor(){super({name:"CopyMaterial",uniforms:{inputBuffer:new we(null),opacity:new we(1)},blending:rn,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:f9,vertexShader:kp}),this.fragmentShader=Lp(this.fragmentShader)}set inputBuffer(n){this.uniforms.inputBuffer.value=n}setInputBuffer(n){this.uniforms.inputBuffer.value=n}getOpacity(n){return this.uniforms.opacity.value}setOpacity(n){this.uniforms.opacity.value=n}},p9=`#include <packing>
#ifdef GL_FRAGMENT_PRECISION_HIGH
uniform highp sampler2D depthBuffer;
#else
uniform mediump sampler2D depthBuffer;
#endif
#ifdef DOWNSAMPLE_NORMALS
uniform lowp sampler2D normalBuffer;
#endif
varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;float readDepth(const in vec2 uv){
#if DEPTH_PACKING == 3201
return unpackRGBAToDepth(texture2D(depthBuffer,uv));
#else
return texture2D(depthBuffer,uv).r;
#endif
}int findBestDepth(const in float samples[4]){float c=(samples[0]+samples[1]+samples[2]+samples[3])*0.25;float distances[4];distances[0]=abs(c-samples[0]);distances[1]=abs(c-samples[1]);distances[2]=abs(c-samples[2]);distances[3]=abs(c-samples[3]);float maxDistance=max(max(distances[0],distances[1]),max(distances[2],distances[3]));int remaining[3];int rejected[3];int i,j,k;for(i=0,j=0,k=0;i<4;++i){if(distances[i]<maxDistance){remaining[j++]=i;}else{rejected[k++]=i;}}for(;j<3;++j){remaining[j]=rejected[--k];}vec3 s=vec3(samples[remaining[0]],samples[remaining[1]],samples[remaining[2]]);c=(s.x+s.y+s.z)/3.0;distances[0]=abs(c-s.x);distances[1]=abs(c-s.y);distances[2]=abs(c-s.z);float minDistance=min(distances[0],min(distances[1],distances[2]));for(i=0;i<3;++i){if(distances[i]==minDistance){break;}}return remaining[i];}void main(){float d[4];d[0]=readDepth(vUv0);d[1]=readDepth(vUv1);d[2]=readDepth(vUv2);d[3]=readDepth(vUv3);int index=findBestDepth(d);
#ifdef DOWNSAMPLE_NORMALS
vec3 n[4];n[0]=texture2D(normalBuffer,vUv0).rgb;n[1]=texture2D(normalBuffer,vUv1).rgb;n[2]=texture2D(normalBuffer,vUv2).rgb;n[3]=texture2D(normalBuffer,vUv3).rgb;
#else
vec3 n[4];n[0]=vec3(0.0);n[1]=vec3(0.0);n[2]=vec3(0.0);n[3]=vec3(0.0);
#endif
gl_FragColor=vec4(n[index],d[index]);}`,m9="uniform vec2 texelSize;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec2 uv=position.xy*0.5+0.5;vUv0=uv;vUv1=vec2(uv.x,uv.y+texelSize.y);vUv2=vec2(uv.x+texelSize.x,uv.y);vUv3=uv+texelSize;gl_Position=vec4(position.xy,1.0,1.0);}",g9=class extends Et{constructor(){super({name:"DepthDownsamplingMaterial",defines:{DEPTH_PACKING:"0"},uniforms:{depthBuffer:new we(null),normalBuffer:new we(null),texelSize:new we(new ie)},blending:rn,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:p9,vertexShader:m9})}set depthBuffer(n){this.uniforms.depthBuffer.value=n}set depthPacking(n){this.defines.DEPTH_PACKING=n.toFixed(0),this.needsUpdate=!0}setDepthBuffer(n,e=Ts){this.depthBuffer=n,this.depthPacking=e}set normalBuffer(n){this.uniforms.normalBuffer.value=n,n!==null?this.defines.DOWNSAMPLE_NORMALS="1":delete this.defines.DOWNSAMPLE_NORMALS,this.needsUpdate=!0}setNormalBuffer(n){this.normalBuffer=n}setTexelSize(n,e){this.uniforms.texelSize.value.set(n,e)}setSize(n,e){this.uniforms.texelSize.value.set(1/n,1/e)}},A9=`#include <common>
#include <packing>
#ifdef GL_FRAGMENT_PRECISION_HIGH
uniform highp sampler2D depthBuffer0;uniform highp sampler2D depthBuffer1;
#else
uniform mediump sampler2D depthBuffer0;uniform mediump sampler2D depthBuffer1;
#endif
uniform sampler2D inputBuffer;uniform vec2 cameraNearFar;float getViewZ(const in float depth){
#ifdef PERSPECTIVE_CAMERA
return perspectiveDepthToViewZ(depth,cameraNearFar.x,cameraNearFar.y);
#else
return orthographicDepthToViewZ(depth,cameraNearFar.x,cameraNearFar.y);
#endif
}varying vec2 vUv;void main(){vec2 depth;
#if DEPTH_PACKING_0 == 3201
depth.x=unpackRGBAToDepth(texture2D(depthBuffer0,vUv));
#else
depth.x=texture2D(depthBuffer0,vUv).r;
#ifdef LOG_DEPTH
float d=pow(2.0,depth.x*log2(cameraNearFar.y+1.0))-1.0;float a=cameraNearFar.y/(cameraNearFar.y-cameraNearFar.x);float b=cameraNearFar.y*cameraNearFar.x/(cameraNearFar.x-cameraNearFar.y);depth.x=a+b/d;
#endif
#endif
#if DEPTH_PACKING_1 == 3201
depth.y=unpackRGBAToDepth(texture2D(depthBuffer1,vUv));
#else
depth.y=texture2D(depthBuffer1,vUv).r;
#ifdef LOG_DEPTH
float d=pow(2.0,depth.y*log2(cameraNearFar.y+1.0))-1.0;float a=cameraNearFar.y/(cameraNearFar.y-cameraNearFar.x);float b=cameraNearFar.y*cameraNearFar.x/(cameraNearFar.x-cameraNearFar.y);depth.y=a+b/d;
#endif
#endif
bool isMaxDepth=(depth.x==1.0);
#ifdef PERSPECTIVE_CAMERA
depth.x=viewZToOrthographicDepth(getViewZ(depth.x),cameraNearFar.x,cameraNearFar.y);depth.y=viewZToOrthographicDepth(getViewZ(depth.y),cameraNearFar.x,cameraNearFar.y);
#endif
#if DEPTH_TEST_STRATEGY == 0
bool keep=depthTest(depth.x,depth.y);
#elif DEPTH_TEST_STRATEGY == 1
bool keep=isMaxDepth||depthTest(depth.x,depth.y);
#else
bool keep=!isMaxDepth&&depthTest(depth.x,depth.y);
#endif
if(keep){gl_FragColor=texture2D(inputBuffer,vUv);}else{discard;}}`,v9=class extends Et{constructor(){super({name:"DepthMaskMaterial",defines:{DEPTH_EPSILON:"0.0001",DEPTH_PACKING_0:"0",DEPTH_PACKING_1:"0",DEPTH_TEST_STRATEGY:hg.KEEP_MAX_DEPTH},uniforms:{inputBuffer:new we(null),depthBuffer0:new we(null),depthBuffer1:new we(null),cameraNearFar:new we(new ie(1,1))},blending:rn,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:A9,vertexShader:kp}),this.depthMode=Vg}set depthBuffer0(n){this.uniforms.depthBuffer0.value=n}set depthPacking0(n){this.defines.DEPTH_PACKING_0=n.toFixed(0),this.needsUpdate=!0}setDepthBuffer0(n,e=Ts){this.depthBuffer0=n,this.depthPacking0=e}set depthBuffer1(n){this.uniforms.depthBuffer1.value=n}set depthPacking1(n){this.defines.DEPTH_PACKING_1=n.toFixed(0),this.needsUpdate=!0}setDepthBuffer1(n,e=Ts){this.depthBuffer1=n,this.depthPacking1=e}get maxDepthStrategy(){return Number(this.defines.DEPTH_TEST_STRATEGY)}set maxDepthStrategy(n){this.defines.DEPTH_TEST_STRATEGY=n.toFixed(0),this.needsUpdate=!0}get keepFar(){return this.maxDepthStrategy}set keepFar(n){this.maxDepthStrategy=n?hg.KEEP_MAX_DEPTH:hg.DISCARD_MAX_DEPTH}getMaxDepthStrategy(){return this.maxDepthStrategy}setMaxDepthStrategy(n){this.maxDepthStrategy=n}get epsilon(){return Number(this.defines.DEPTH_EPSILON)}set epsilon(n){this.defines.DEPTH_EPSILON=n.toFixed(16),this.needsUpdate=!0}getEpsilon(){return this.epsilon}setEpsilon(n){this.epsilon=n}get depthMode(){return Number(this.defines.DEPTH_MODE)}set depthMode(n){let e;switch(n){case sM:e="false";break;case y_:e="true";break;case hp:e="abs(d1 - d0) <= DEPTH_EPSILON";break;case BA:e="abs(d1 - d0) > DEPTH_EPSILON";break;case Vg:e="d0 > d1";break;case ld:e="d0 >= d1";break;case b_:e="d0 <= d1";break;case __:default:e="d0 < d1";break}this.defines.DEPTH_MODE=n.toFixed(0),this.defines["depthTest(d0, d1)"]=e,this.needsUpdate=!0}getDepthMode(){return this.depthMode}setDepthMode(n){this.depthMode=n}adoptCameraSettings(n){this.copyCameraSettings(n)}copyCameraSettings(n){n&&(this.uniforms.cameraNearFar.value.set(n.near,n.far),n instanceof Wt?this.defines.PERSPECTIVE_CAMERA="1":delete this.defines.PERSPECTIVE_CAMERA,this.needsUpdate=!0)}},y9=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#define WEIGHT_INNER 0.125
#define WEIGHT_OUTER 0.0555555
varying vec2 vUv;varying vec2 vUv00;varying vec2 vUv01;varying vec2 vUv02;varying vec2 vUv03;varying vec2 vUv04;varying vec2 vUv05;varying vec2 vUv06;varying vec2 vUv07;varying vec2 vUv08;varying vec2 vUv09;varying vec2 vUv10;varying vec2 vUv11;float clampToBorder(const in vec2 uv){return float(uv.s>=0.0&&uv.s<=1.0&&uv.t>=0.0&&uv.t<=1.0);}void main(){vec4 c=vec4(0.0);vec4 w=WEIGHT_INNER*vec4(clampToBorder(vUv00),clampToBorder(vUv01),clampToBorder(vUv02),clampToBorder(vUv03));c+=w.x*texture2D(inputBuffer,vUv00);c+=w.y*texture2D(inputBuffer,vUv01);c+=w.z*texture2D(inputBuffer,vUv02);c+=w.w*texture2D(inputBuffer,vUv03);w=WEIGHT_OUTER*vec4(clampToBorder(vUv04),clampToBorder(vUv05),clampToBorder(vUv06),clampToBorder(vUv07));c+=w.x*texture2D(inputBuffer,vUv04);c+=w.y*texture2D(inputBuffer,vUv05);c+=w.z*texture2D(inputBuffer,vUv06);c+=w.w*texture2D(inputBuffer,vUv07);w=WEIGHT_OUTER*vec4(clampToBorder(vUv08),clampToBorder(vUv09),clampToBorder(vUv10),clampToBorder(vUv11));c+=w.x*texture2D(inputBuffer,vUv08);c+=w.y*texture2D(inputBuffer,vUv09);c+=w.z*texture2D(inputBuffer,vUv10);c+=w.w*texture2D(inputBuffer,vUv11);c+=WEIGHT_OUTER*texture2D(inputBuffer,vUv);gl_FragColor=c;
#include <colorspace_fragment>
}`,b9="uniform vec2 texelSize;varying vec2 vUv;varying vec2 vUv00;varying vec2 vUv01;varying vec2 vUv02;varying vec2 vUv03;varying vec2 vUv04;varying vec2 vUv05;varying vec2 vUv06;varying vec2 vUv07;varying vec2 vUv08;varying vec2 vUv09;varying vec2 vUv10;varying vec2 vUv11;void main(){vUv=position.xy*0.5+0.5;vUv00=vUv+texelSize*vec2(-1.0,1.0);vUv01=vUv+texelSize*vec2(1.0,1.0);vUv02=vUv+texelSize*vec2(-1.0,-1.0);vUv03=vUv+texelSize*vec2(1.0,-1.0);vUv04=vUv+texelSize*vec2(-2.0,2.0);vUv05=vUv+texelSize*vec2(0.0,2.0);vUv06=vUv+texelSize*vec2(2.0,2.0);vUv07=vUv+texelSize*vec2(-2.0,0.0);vUv08=vUv+texelSize*vec2(2.0,0.0);vUv09=vUv+texelSize*vec2(-2.0,-2.0);vUv10=vUv+texelSize*vec2(0.0,-2.0);vUv11=vUv+texelSize*vec2(2.0,-2.0);gl_Position=vec4(position.xy,1.0,1.0);}",_9=class extends Et{constructor(){super({name:"DownsamplingMaterial",uniforms:{inputBuffer:new we(null),texelSize:new we(new ie)},blending:rn,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:y9,vertexShader:b9}),this.fragmentShader=Lp(this.fragmentShader)}set inputBuffer(n){this.uniforms.inputBuffer.value=n}setSize(n,e){this.uniforms.texelSize.value.set(1/n,1/e)}},x9=`varying vec2 vUv;varying vec2 vUv0;varying vec2 vUv1;
#if THREE_REVISION < 143
#define luminance(v) linearToRelativeLuminance(v)
#endif
#if EDGE_DETECTION_MODE != 0
varying vec2 vUv2;varying vec2 vUv3;varying vec2 vUv4;varying vec2 vUv5;
#endif
#if EDGE_DETECTION_MODE == 1
#include <common>
#endif
#if EDGE_DETECTION_MODE == 0 || PREDICATION_MODE == 1
#ifdef GL_FRAGMENT_PRECISION_HIGH
uniform highp sampler2D depthBuffer;
#else
uniform mediump sampler2D depthBuffer;
#endif
float readDepth(const in vec2 uv){
#if DEPTH_PACKING == 3201
return unpackRGBAToDepth(texture2D(depthBuffer,uv));
#else
return texture2D(depthBuffer,uv).r;
#endif
}vec3 gatherNeighbors(){float p=readDepth(vUv);float pLeft=readDepth(vUv0);float pTop=readDepth(vUv1);return vec3(p,pLeft,pTop);}
#elif PREDICATION_MODE == 2
uniform sampler2D predicationBuffer;vec3 gatherNeighbors(){float p=texture2D(predicationBuffer,vUv).r;float pLeft=texture2D(predicationBuffer,vUv0).r;float pTop=texture2D(predicationBuffer,vUv1).r;return vec3(p,pLeft,pTop);}
#endif
#if PREDICATION_MODE != 0
vec2 calculatePredicatedThreshold(){vec3 neighbours=gatherNeighbors();vec2 delta=abs(neighbours.xx-neighbours.yz);vec2 edges=step(PREDICATION_THRESHOLD,delta);return PREDICATION_SCALE*EDGE_THRESHOLD*(1.0-PREDICATION_STRENGTH*edges);}
#endif
#if EDGE_DETECTION_MODE != 0
uniform sampler2D inputBuffer;
#endif
void main(){
#if EDGE_DETECTION_MODE == 0
const vec2 threshold=vec2(DEPTH_THRESHOLD);
#elif PREDICATION_MODE != 0
vec2 threshold=calculatePredicatedThreshold();
#else
const vec2 threshold=vec2(EDGE_THRESHOLD);
#endif
#if EDGE_DETECTION_MODE == 0
vec3 neighbors=gatherNeighbors();vec2 delta=abs(neighbors.xx-vec2(neighbors.y,neighbors.z));vec2 edges=step(threshold,delta);if(dot(edges,vec2(1.0))==0.0){discard;}gl_FragColor=vec4(edges,0.0,1.0);
#elif EDGE_DETECTION_MODE == 1
float l=luminance(texture2D(inputBuffer,vUv).rgb);float lLeft=luminance(texture2D(inputBuffer,vUv0).rgb);float lTop=luminance(texture2D(inputBuffer,vUv1).rgb);vec4 delta;delta.xy=abs(l-vec2(lLeft,lTop));vec2 edges=step(threshold,delta.xy);if(dot(edges,vec2(1.0))==0.0){discard;}float lRight=luminance(texture2D(inputBuffer,vUv2).rgb);float lBottom=luminance(texture2D(inputBuffer,vUv3).rgb);delta.zw=abs(l-vec2(lRight,lBottom));vec2 maxDelta=max(delta.xy,delta.zw);float lLeftLeft=luminance(texture2D(inputBuffer,vUv4).rgb);float lTopTop=luminance(texture2D(inputBuffer,vUv5).rgb);delta.zw=abs(vec2(lLeft,lTop)-vec2(lLeftLeft,lTopTop));maxDelta=max(maxDelta.xy,delta.zw);float finalDelta=max(maxDelta.x,maxDelta.y);edges.xy*=step(finalDelta,LOCAL_CONTRAST_ADAPTATION_FACTOR*delta.xy);gl_FragColor=vec4(edges,0.0,1.0);
#elif EDGE_DETECTION_MODE == 2
vec4 delta;vec3 c=texture2D(inputBuffer,vUv).rgb;vec3 cLeft=texture2D(inputBuffer,vUv0).rgb;vec3 t=abs(c-cLeft);delta.x=max(max(t.r,t.g),t.b);vec3 cTop=texture2D(inputBuffer,vUv1).rgb;t=abs(c-cTop);delta.y=max(max(t.r,t.g),t.b);vec2 edges=step(threshold,delta.xy);if(dot(edges,vec2(1.0))==0.0){discard;}vec3 cRight=texture2D(inputBuffer,vUv2).rgb;t=abs(c-cRight);delta.z=max(max(t.r,t.g),t.b);vec3 cBottom=texture2D(inputBuffer,vUv3).rgb;t=abs(c-cBottom);delta.w=max(max(t.r,t.g),t.b);vec2 maxDelta=max(delta.xy,delta.zw);vec3 cLeftLeft=texture2D(inputBuffer,vUv4).rgb;t=abs(c-cLeftLeft);delta.z=max(max(t.r,t.g),t.b);vec3 cTopTop=texture2D(inputBuffer,vUv5).rgb;t=abs(c-cTopTop);delta.w=max(max(t.r,t.g),t.b);maxDelta=max(maxDelta.xy,delta.zw);float finalDelta=max(maxDelta.x,maxDelta.y);edges*=step(finalDelta,LOCAL_CONTRAST_ADAPTATION_FACTOR*delta.xy);gl_FragColor=vec4(edges,0.0,1.0);
#endif
}`,w9=`uniform vec2 texelSize;varying vec2 vUv;varying vec2 vUv0;varying vec2 vUv1;
#if EDGE_DETECTION_MODE != 0
varying vec2 vUv2;varying vec2 vUv3;varying vec2 vUv4;varying vec2 vUv5;
#endif
void main(){vUv=position.xy*0.5+0.5;vUv0=vUv+texelSize*vec2(-1.0,0.0);vUv1=vUv+texelSize*vec2(0.0,-1.0);
#if EDGE_DETECTION_MODE != 0
vUv2=vUv+texelSize*vec2(1.0,0.0);vUv3=vUv+texelSize*vec2(0.0,1.0);vUv4=vUv+texelSize*vec2(-2.0,0.0);vUv5=vUv+texelSize*vec2(0.0,-2.0);
#endif
gl_Position=vec4(position.xy,1.0,1.0);}`,S9=class extends Et{constructor(n=new ie,e=a1.COLOR){super({name:"EdgeDetectionMaterial",defines:{THREE_REVISION:qh.replace(/\D+/g,""),LOCAL_CONTRAST_ADAPTATION_FACTOR:"2.0",EDGE_THRESHOLD:"0.1",DEPTH_THRESHOLD:"0.01",PREDICATION_MODE:"0",PREDICATION_THRESHOLD:"0.01",PREDICATION_SCALE:"2.0",PREDICATION_STRENGTH:"1.0",DEPTH_PACKING:"0"},uniforms:{inputBuffer:new we(null),depthBuffer:new we(null),predicationBuffer:new we(null),texelSize:new we(n)},blending:rn,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:x9,vertexShader:w9}),this.edgeDetectionMode=e}set depthBuffer(n){this.uniforms.depthBuffer.value=n}set depthPacking(n){this.defines.DEPTH_PACKING=n.toFixed(0),this.needsUpdate=!0}setDepthBuffer(n,e=Ts){this.depthBuffer=n,this.depthPacking=e}get edgeDetectionMode(){return Number(this.defines.EDGE_DETECTION_MODE)}set edgeDetectionMode(n){this.defines.EDGE_DETECTION_MODE=n.toFixed(0),this.needsUpdate=!0}getEdgeDetectionMode(){return this.edgeDetectionMode}setEdgeDetectionMode(n){this.edgeDetectionMode=n}get localContrastAdaptationFactor(){return Number(this.defines.LOCAL_CONTRAST_ADAPTATION_FACTOR)}set localContrastAdaptationFactor(n){this.defines.LOCAL_CONTRAST_ADAPTATION_FACTOR=n.toFixed("6"),this.needsUpdate=!0}getLocalContrastAdaptationFactor(){return this.localContrastAdaptationFactor}setLocalContrastAdaptationFactor(n){this.localContrastAdaptationFactor=n}get edgeDetectionThreshold(){return Number(this.defines.EDGE_THRESHOLD)}set edgeDetectionThreshold(n){this.defines.EDGE_THRESHOLD=n.toFixed("6"),this.defines.DEPTH_THRESHOLD=(n*.1).toFixed("6"),this.needsUpdate=!0}getEdgeDetectionThreshold(){return this.edgeDetectionThreshold}setEdgeDetectionThreshold(n){this.edgeDetectionThreshold=n}get predicationMode(){return Number(this.defines.PREDICATION_MODE)}set predicationMode(n){this.defines.PREDICATION_MODE=n.toFixed(0),this.needsUpdate=!0}getPredicationMode(){return this.predicationMode}setPredicationMode(n){this.predicationMode=n}set predicationBuffer(n){this.uniforms.predicationBuffer.value=n}setPredicationBuffer(n){this.uniforms.predicationBuffer.value=n}get predicationThreshold(){return Number(this.defines.PREDICATION_THRESHOLD)}set predicationThreshold(n){this.defines.PREDICATION_THRESHOLD=n.toFixed("6"),this.needsUpdate=!0}getPredicationThreshold(){return this.predicationThreshold}setPredicationThreshold(n){this.predicationThreshold=n}get predicationScale(){return Number(this.defines.PREDICATION_SCALE)}set predicationScale(n){this.defines.PREDICATION_SCALE=n.toFixed("6"),this.needsUpdate=!0}getPredicationScale(){return this.predicationScale}setPredicationScale(n){this.predicationScale=n}get predicationStrength(){return Number(this.defines.PREDICATION_STRENGTH)}set predicationStrength(n){this.defines.PREDICATION_STRENGTH=n.toFixed("6"),this.needsUpdate=!0}getPredicationStrength(){return this.predicationStrength}setPredicationStrength(n){this.predicationStrength=n}setSize(n,e){this.uniforms.texelSize.value.set(1/n,1/e)}},C9=`#include <common>
#include <packing>
#include <dithering_pars_fragment>
#define packFloatToRGBA(v) packDepthToRGBA(v)
#define unpackRGBAToFloat(v) unpackRGBAToDepth(v)
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#if DEPTH_PACKING == 3201
uniform lowp sampler2D depthBuffer;
#elif defined(GL_FRAGMENT_PRECISION_HIGH)
uniform highp sampler2D depthBuffer;
#else
uniform mediump sampler2D depthBuffer;
#endif
uniform vec2 resolution;uniform vec2 texelSize;uniform float cameraNear;uniform float cameraFar;uniform float aspect;uniform float time;varying vec2 vUv;
#if THREE_REVISION < 143
#define luminance(v) linearToRelativeLuminance(v)
#endif
#if THREE_REVISION >= 137
vec4 sRGBToLinear(const in vec4 value){return vec4(mix(pow(value.rgb*0.9478672986+vec3(0.0521327014),vec3(2.4)),value.rgb*0.0773993808,vec3(lessThanEqual(value.rgb,vec3(0.04045)))),value.a);}
#endif
float readDepth(const in vec2 uv){
#if DEPTH_PACKING == 3201
return unpackRGBAToDepth(texture2D(depthBuffer,uv));
#else
return texture2D(depthBuffer,uv).r;
#endif
}float getViewZ(const in float depth){
#ifdef PERSPECTIVE_CAMERA
return perspectiveDepthToViewZ(depth,cameraNear,cameraFar);
#else
return orthographicDepthToViewZ(depth,cameraNear,cameraFar);
#endif
}vec3 RGBToHCV(const in vec3 RGB){vec4 P=mix(vec4(RGB.bg,-1.0,2.0/3.0),vec4(RGB.gb,0.0,-1.0/3.0),step(RGB.b,RGB.g));vec4 Q=mix(vec4(P.xyw,RGB.r),vec4(RGB.r,P.yzx),step(P.x,RGB.r));float C=Q.x-min(Q.w,Q.y);float H=abs((Q.w-Q.y)/(6.0*C+EPSILON)+Q.z);return vec3(H,C,Q.x);}vec3 RGBToHSL(const in vec3 RGB){vec3 HCV=RGBToHCV(RGB);float L=HCV.z-HCV.y*0.5;float S=HCV.y/(1.0-abs(L*2.0-1.0)+EPSILON);return vec3(HCV.x,S,L);}vec3 HueToRGB(const in float H){float R=abs(H*6.0-3.0)-1.0;float G=2.0-abs(H*6.0-2.0);float B=2.0-abs(H*6.0-4.0);return clamp(vec3(R,G,B),0.0,1.0);}vec3 HSLToRGB(const in vec3 HSL){vec3 RGB=HueToRGB(HSL.x);float C=(1.0-abs(2.0*HSL.z-1.0))*HSL.y;return(RGB-0.5)*C+HSL.z;}FRAGMENT_HEAD void main(){FRAGMENT_MAIN_UV vec4 color0=texture2D(inputBuffer,UV);vec4 color1=vec4(0.0);FRAGMENT_MAIN_IMAGE color0.a=clamp(color0.a,0.0,1.0);gl_FragColor=color0;
#ifdef ENCODE_OUTPUT
#include <colorspace_fragment>
#endif
#include <dithering_fragment>
}`,E9="uniform vec2 resolution;uniform vec2 texelSize;uniform float cameraNear;uniform float cameraFar;uniform float aspect;uniform float time;varying vec2 vUv;VERTEX_HEAD void main(){vUv=position.xy*0.5+0.5;VERTEX_MAIN_SUPPORT gl_Position=vec4(position.xy,1.0,1.0);}",T9=class extends Et{constructor(n,e,t,i,s=!1){super({name:"EffectMaterial",defines:{THREE_REVISION:qh.replace(/\D+/g,""),DEPTH_PACKING:"0",ENCODE_OUTPUT:"1"},uniforms:{inputBuffer:new we(null),depthBuffer:new we(null),resolution:new we(new ie),texelSize:new we(new ie),cameraNear:new we(.3),cameraFar:new we(1e3),aspect:new we(1),time:new we(0)},blending:rn,toneMapped:!1,depthWrite:!1,depthTest:!1,dithering:s}),n&&this.setShaderParts(n),e&&this.setDefines(e),t&&this.setUniforms(t),this.copyCameraSettings(i)}set inputBuffer(n){this.uniforms.inputBuffer.value=n}setInputBuffer(n){this.uniforms.inputBuffer.value=n}get depthBuffer(){return this.uniforms.depthBuffer.value}set depthBuffer(n){this.uniforms.depthBuffer.value=n}get depthPacking(){return Number(this.defines.DEPTH_PACKING)}set depthPacking(n){this.defines.DEPTH_PACKING=n.toFixed(0),this.needsUpdate=!0}setDepthBuffer(n,e=Ts){this.depthBuffer=n,this.depthPacking=e}setShaderData(n){this.setShaderParts(n.shaderParts),this.setDefines(n.defines),this.setUniforms(n.uniforms),this.setExtensions(n.extensions)}setShaderParts(n){return this.fragmentShader=C9.replace(mi.FRAGMENT_HEAD,n.get(mi.FRAGMENT_HEAD)||"").replace(mi.FRAGMENT_MAIN_UV,n.get(mi.FRAGMENT_MAIN_UV)||"").replace(mi.FRAGMENT_MAIN_IMAGE,n.get(mi.FRAGMENT_MAIN_IMAGE)||""),this.vertexShader=E9.replace(mi.VERTEX_HEAD,n.get(mi.VERTEX_HEAD)||"").replace(mi.VERTEX_MAIN_SUPPORT,n.get(mi.VERTEX_MAIN_SUPPORT)||""),this.fragmentShader=Lp(this.fragmentShader),this.needsUpdate=!0,this}setDefines(n){for(const e of n.entries())this.defines[e[0]]=e[1];return this.needsUpdate=!0,this}setUniforms(n){for(const e of n.entries())this.uniforms[e[0]]=e[1];return this}setExtensions(n){this.extensions={};for(const e of n)this.extensions[e]=!0;return this}get encodeOutput(){return this.defines.ENCODE_OUTPUT!==void 0}set encodeOutput(n){this.encodeOutput!==n&&(n?this.defines.ENCODE_OUTPUT="1":delete this.defines.ENCODE_OUTPUT,this.needsUpdate=!0)}isOutputEncodingEnabled(n){return this.encodeOutput}setOutputEncodingEnabled(n){this.encodeOutput=n}get time(){return this.uniforms.time.value}set time(n){this.uniforms.time.value=n}setDeltaTime(n){this.uniforms.time.value+=n}adoptCameraSettings(n){this.copyCameraSettings(n)}copyCameraSettings(n){n&&(this.uniforms.cameraNear.value=n.near,this.uniforms.cameraFar.value=n.far,n instanceof Wt?this.defines.PERSPECTIVE_CAMERA="1":delete this.defines.PERSPECTIVE_CAMERA,this.needsUpdate=!0)}setSize(n,e){const t=this.uniforms;t.resolution.value.set(n,e),t.texelSize.value.set(1/n,1/e),t.aspect.value=n/e}static get Section(){return mi}},M9=`#include <common>
#if THREE_REVISION < 143
#define luminance(v) linearToRelativeLuminance(v)
#endif
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#ifdef RANGE
uniform vec2 range;
#elif defined(THRESHOLD)
uniform float threshold;uniform float smoothing;
#endif
varying vec2 vUv;void main(){vec4 texel=texture2D(inputBuffer,vUv);float l=luminance(texel.rgb);
#ifdef RANGE
float low=step(range.x,l);float high=step(l,range.y);l*=low*high;
#elif defined(THRESHOLD)
l=smoothstep(threshold,threshold+smoothing,l);
#endif
#ifdef COLOR
gl_FragColor=vec4(texel.rgb*l,l);
#else
gl_FragColor=vec4(l);
#endif
}`,I9=class extends Et{constructor(n=!1,e=null){super({name:"LuminanceMaterial",defines:{THREE_REVISION:qh.replace(/\D+/g,"")},uniforms:{inputBuffer:new we(null),threshold:new we(0),smoothing:new we(1),range:new we(null)},blending:rn,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:M9,vertexShader:kp}),this.colorOutput=n,this.luminanceRange=e}set inputBuffer(n){this.uniforms.inputBuffer.value=n}setInputBuffer(n){this.uniforms.inputBuffer.value=n}get threshold(){return this.uniforms.threshold.value}set threshold(n){this.smoothing>0||n>0?this.defines.THRESHOLD="1":delete this.defines.THRESHOLD,this.uniforms.threshold.value=n}getThreshold(){return this.threshold}setThreshold(n){this.threshold=n}get smoothing(){return this.uniforms.smoothing.value}set smoothing(n){this.threshold>0||n>0?this.defines.THRESHOLD="1":delete this.defines.THRESHOLD,this.uniforms.smoothing.value=n}getSmoothingFactor(){return this.smoothing}setSmoothingFactor(n){this.smoothing=n}get useThreshold(){return this.threshold>0||this.smoothing>0}set useThreshold(n){}get colorOutput(){return this.defines.COLOR!==void 0}set colorOutput(n){n?this.defines.COLOR="1":delete this.defines.COLOR,this.needsUpdate=!0}isColorOutputEnabled(n){return this.colorOutput}setColorOutputEnabled(n){this.colorOutput=n}get useRange(){return this.luminanceRange!==null}set useRange(n){this.luminanceRange=null}get luminanceRange(){return this.uniforms.range.value}set luminanceRange(n){n!==null?this.defines.RANGE="1":delete this.defines.RANGE,this.uniforms.range.value=n,this.needsUpdate=!0}getLuminanceRange(){return this.luminanceRange}setLuminanceRange(n){this.luminanceRange=n}},R9=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#ifdef MASK_PRECISION_HIGH
uniform mediump sampler2D maskTexture;
#else
uniform lowp sampler2D maskTexture;
#endif
#if MASK_FUNCTION != 0
uniform float strength;
#endif
varying vec2 vUv;void main(){
#if COLOR_CHANNEL == 0
float mask=texture2D(maskTexture,vUv).r;
#elif COLOR_CHANNEL == 1
float mask=texture2D(maskTexture,vUv).g;
#elif COLOR_CHANNEL == 2
float mask=texture2D(maskTexture,vUv).b;
#else
float mask=texture2D(maskTexture,vUv).a;
#endif
#if MASK_FUNCTION == 0
#ifdef INVERTED
mask=step(mask,0.0);
#else
mask=1.0-step(mask,0.0);
#endif
#else
mask=clamp(mask*strength,0.0,1.0);
#ifdef INVERTED
mask=1.0-mask;
#endif
#endif
#if MASK_FUNCTION == 3
vec4 texel=texture2D(inputBuffer,vUv);gl_FragColor=vec4(mask*texel.rgb,texel.a);
#elif MASK_FUNCTION == 2
gl_FragColor=vec4(mask*texture2D(inputBuffer,vUv).rgb,mask);
#else
gl_FragColor=mask*texture2D(inputBuffer,vUv);
#endif
}`,P9=class extends Et{constructor(n=null){super({name:"MaskMaterial",uniforms:{maskTexture:new we(n),inputBuffer:new we(null),strength:new we(1)},blending:rn,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:R9,vertexShader:kp}),this.colorChannel=IF.RED,this.maskFunction=PF.DISCARD}set inputBuffer(n){this.uniforms.inputBuffer.value=n}setInputBuffer(n){this.uniforms.inputBuffer.value=n}set maskTexture(n){this.uniforms.maskTexture.value=n,delete this.defines.MASK_PRECISION_HIGH,n.type!==gi&&(this.defines.MASK_PRECISION_HIGH="1"),this.needsUpdate=!0}setMaskTexture(n){this.maskTexture=n}set colorChannel(n){this.defines.COLOR_CHANNEL=n.toFixed(0),this.needsUpdate=!0}setColorChannel(n){this.colorChannel=n}set maskFunction(n){this.defines.MASK_FUNCTION=n.toFixed(0),this.needsUpdate=!0}setMaskFunction(n){this.maskFunction=n}get inverted(){return this.defines.INVERTED!==void 0}set inverted(n){this.inverted&&!n?delete this.defines.INVERTED:n&&(this.defines.INVERTED="1"),this.needsUpdate=!0}isInverted(){return this.inverted}setInverted(n){this.inverted=n}get strength(){return this.uniforms.strength.value}set strength(n){this.uniforms.strength.value=n}getStrength(){return this.strength}setStrength(n){this.strength=n}},B9=`#define sampleLevelZeroOffset(t, coord, offset) texture2D(t, coord + offset * texelSize)
#if __VERSION__ < 300
#define round(v) floor(v + 0.5)
#endif
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
uniform lowp sampler2D areaTexture;uniform lowp sampler2D searchTexture;uniform vec2 texelSize;uniform vec2 resolution;varying vec2 vUv;varying vec4 vOffset[3];varying vec2 vPixCoord;void movec(const in bvec2 c,inout vec2 variable,const in vec2 value){if(c.x){variable.x=value.x;}if(c.y){variable.y=value.y;}}void movec(const in bvec4 c,inout vec4 variable,const in vec4 value){movec(c.xy,variable.xy,value.xy);movec(c.zw,variable.zw,value.zw);}vec2 decodeDiagBilinearAccess(in vec2 e){e.r=e.r*abs(5.0*e.r-5.0*0.75);return round(e);}vec4 decodeDiagBilinearAccess(in vec4 e){e.rb=e.rb*abs(5.0*e.rb-5.0*0.75);return round(e);}vec2 searchDiag1(const in vec2 texCoord,const in vec2 dir,out vec2 e){vec4 coord=vec4(texCoord,-1.0,1.0);vec3 t=vec3(texelSize,1.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(coord.z<float(MAX_SEARCH_STEPS_DIAG_INT-1)&&coord.w>0.9)){break;}coord.xyz=t*vec3(dir,1.0)+coord.xyz;e=texture2D(inputBuffer,coord.xy).rg;coord.w=dot(e,vec2(0.5));}return coord.zw;}vec2 searchDiag2(const in vec2 texCoord,const in vec2 dir,out vec2 e){vec4 coord=vec4(texCoord,-1.0,1.0);coord.x+=0.25*texelSize.x;vec3 t=vec3(texelSize,1.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(coord.z<float(MAX_SEARCH_STEPS_DIAG_INT-1)&&coord.w>0.9)){break;}coord.xyz=t*vec3(dir,1.0)+coord.xyz;e=texture2D(inputBuffer,coord.xy).rg;e=decodeDiagBilinearAccess(e);coord.w=dot(e,vec2(0.5));}return coord.zw;}vec2 areaDiag(const in vec2 dist,const in vec2 e,const in float offset){vec2 texCoord=vec2(AREATEX_MAX_DISTANCE_DIAG,AREATEX_MAX_DISTANCE_DIAG)*e+dist;texCoord=AREATEX_PIXEL_SIZE*texCoord+0.5*AREATEX_PIXEL_SIZE;texCoord.x+=0.5;texCoord.y+=AREATEX_SUBTEX_SIZE*offset;return texture2D(areaTexture,texCoord).rg;}vec2 calculateDiagWeights(const in vec2 texCoord,const in vec2 e,const in vec4 subsampleIndices){vec2 weights=vec2(0.0);vec4 d;vec2 end;if(e.r>0.0){d.xz=searchDiag1(texCoord,vec2(-1.0,1.0),end);d.x+=float(end.y>0.9);}else{d.xz=vec2(0.0);}d.yw=searchDiag1(texCoord,vec2(1.0,-1.0),end);if(d.x+d.y>2.0){vec4 coords=vec4(-d.x+0.25,d.x,d.y,-d.y-0.25)*texelSize.xyxy+texCoord.xyxy;vec4 c;c.xy=sampleLevelZeroOffset(inputBuffer,coords.xy,vec2(-1,0)).rg;c.zw=sampleLevelZeroOffset(inputBuffer,coords.zw,vec2(1,0)).rg;c.yxwz=decodeDiagBilinearAccess(c.xyzw);vec2 cc=vec2(2.0)*c.xz+c.yw;movec(bvec2(step(0.9,d.zw)),cc,vec2(0.0));weights+=areaDiag(d.xy,cc,subsampleIndices.z);}d.xz=searchDiag2(texCoord,vec2(-1.0,-1.0),end);if(sampleLevelZeroOffset(inputBuffer,texCoord,vec2(1,0)).r>0.0){d.yw=searchDiag2(texCoord,vec2(1.0),end);d.y+=float(end.y>0.9);}else{d.yw=vec2(0.0);}if(d.x+d.y>2.0){vec4 coords=vec4(-d.x,-d.x,d.y,d.y)*texelSize.xyxy+texCoord.xyxy;vec4 c;c.x=sampleLevelZeroOffset(inputBuffer,coords.xy,vec2(-1,0)).g;c.y=sampleLevelZeroOffset(inputBuffer,coords.xy,vec2(0,-1)).r;c.zw=sampleLevelZeroOffset(inputBuffer,coords.zw,vec2(1,0)).gr;vec2 cc=vec2(2.0)*c.xz+c.yw;movec(bvec2(step(0.9,d.zw)),cc,vec2(0.0));weights+=areaDiag(d.xy,cc,subsampleIndices.w).gr;}return weights;}float searchLength(const in vec2 e,const in float offset){vec2 scale=SEARCHTEX_SIZE*vec2(0.5,-1.0);vec2 bias=SEARCHTEX_SIZE*vec2(offset,1.0);scale+=vec2(-1.0,1.0);bias+=vec2(0.5,-0.5);scale*=1.0/SEARCHTEX_PACKED_SIZE;bias*=1.0/SEARCHTEX_PACKED_SIZE;return texture2D(searchTexture,scale*e+bias).r;}float searchXLeft(in vec2 texCoord,const in float end){vec2 e=vec2(0.0,1.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(texCoord.x>end&&e.g>0.8281&&e.r==0.0)){break;}e=texture2D(inputBuffer,texCoord).rg;texCoord=vec2(-2.0,0.0)*texelSize+texCoord;}float offset=-(255.0/127.0)*searchLength(e,0.0)+3.25;return texelSize.x*offset+texCoord.x;}float searchXRight(vec2 texCoord,const in float end){vec2 e=vec2(0.0,1.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(texCoord.x<end&&e.g>0.8281&&e.r==0.0)){break;}e=texture2D(inputBuffer,texCoord).rg;texCoord=vec2(2.0,0.0)*texelSize.xy+texCoord;}float offset=-(255.0/127.0)*searchLength(e,0.5)+3.25;return-texelSize.x*offset+texCoord.x;}float searchYUp(vec2 texCoord,const in float end){vec2 e=vec2(1.0,0.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(texCoord.y>end&&e.r>0.8281&&e.g==0.0)){break;}e=texture2D(inputBuffer,texCoord).rg;texCoord=-vec2(0.0,2.0)*texelSize.xy+texCoord;}float offset=-(255.0/127.0)*searchLength(e.gr,0.0)+3.25;return texelSize.y*offset+texCoord.y;}float searchYDown(vec2 texCoord,const in float end){vec2 e=vec2(1.0,0.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;i++){if(!(texCoord.y<end&&e.r>0.8281&&e.g==0.0)){break;}e=texture2D(inputBuffer,texCoord).rg;texCoord=vec2(0.0,2.0)*texelSize.xy+texCoord;}float offset=-(255.0/127.0)*searchLength(e.gr,0.5)+3.25;return-texelSize.y*offset+texCoord.y;}vec2 area(const in vec2 dist,const in float e1,const in float e2,const in float offset){vec2 texCoord=vec2(AREATEX_MAX_DISTANCE)*round(4.0*vec2(e1,e2))+dist;texCoord=AREATEX_PIXEL_SIZE*texCoord+0.5*AREATEX_PIXEL_SIZE;texCoord.y=AREATEX_SUBTEX_SIZE*offset+texCoord.y;return texture2D(areaTexture,texCoord).rg;}void detectHorizontalCornerPattern(inout vec2 weights,const in vec4 texCoord,const in vec2 d){
#if !defined(DISABLE_CORNER_DETECTION)
vec2 leftRight=step(d.xy,d.yx);vec2 rounding=(1.0-CORNER_ROUNDING_NORM)*leftRight;rounding/=leftRight.x+leftRight.y;vec2 factor=vec2(1.0);factor.x-=rounding.x*sampleLevelZeroOffset(inputBuffer,texCoord.xy,vec2(0,1)).r;factor.x-=rounding.y*sampleLevelZeroOffset(inputBuffer,texCoord.zw,vec2(1,1)).r;factor.y-=rounding.x*sampleLevelZeroOffset(inputBuffer,texCoord.xy,vec2(0,-2)).r;factor.y-=rounding.y*sampleLevelZeroOffset(inputBuffer,texCoord.zw,vec2(1,-2)).r;weights*=clamp(factor,0.0,1.0);
#endif
}void detectVerticalCornerPattern(inout vec2 weights,const in vec4 texCoord,const in vec2 d){
#if !defined(DISABLE_CORNER_DETECTION)
vec2 leftRight=step(d.xy,d.yx);vec2 rounding=(1.0-CORNER_ROUNDING_NORM)*leftRight;rounding/=leftRight.x+leftRight.y;vec2 factor=vec2(1.0);factor.x-=rounding.x*sampleLevelZeroOffset(inputBuffer,texCoord.xy,vec2(1,0)).g;factor.x-=rounding.y*sampleLevelZeroOffset(inputBuffer,texCoord.zw,vec2(1,1)).g;factor.y-=rounding.x*sampleLevelZeroOffset(inputBuffer,texCoord.xy,vec2(-2,0)).g;factor.y-=rounding.y*sampleLevelZeroOffset(inputBuffer,texCoord.zw,vec2(-2,1)).g;weights*=clamp(factor,0.0,1.0);
#endif
}void main(){vec4 weights=vec4(0.0);vec4 subsampleIndices=vec4(0.0);vec2 e=texture2D(inputBuffer,vUv).rg;if(e.g>0.0){
#if !defined(DISABLE_DIAG_DETECTION)
weights.rg=calculateDiagWeights(vUv,e,subsampleIndices);if(weights.r==-weights.g){
#endif
vec2 d;vec3 coords;coords.x=searchXLeft(vOffset[0].xy,vOffset[2].x);coords.y=vOffset[1].y;d.x=coords.x;float e1=texture2D(inputBuffer,coords.xy).r;coords.z=searchXRight(vOffset[0].zw,vOffset[2].y);d.y=coords.z;d=round(resolution.xx*d+-vPixCoord.xx);vec2 sqrtD=sqrt(abs(d));float e2=sampleLevelZeroOffset(inputBuffer,coords.zy,vec2(1,0)).r;weights.rg=area(sqrtD,e1,e2,subsampleIndices.y);coords.y=vUv.y;detectHorizontalCornerPattern(weights.rg,coords.xyzy,d);
#if !defined(DISABLE_DIAG_DETECTION)
}else{e.r=0.0;}
#endif
}if(e.r>0.0){vec2 d;vec3 coords;coords.y=searchYUp(vOffset[1].xy,vOffset[2].z);coords.x=vOffset[0].x;d.x=coords.y;float e1=texture2D(inputBuffer,coords.xy).g;coords.z=searchYDown(vOffset[1].zw,vOffset[2].w);d.y=coords.z;d=round(resolution.yy*d-vPixCoord.yy);vec2 sqrtD=sqrt(abs(d));float e2=sampleLevelZeroOffset(inputBuffer,coords.xz,vec2(0,1)).g;weights.ba=area(sqrtD,e1,e2,subsampleIndices.x);coords.x=vUv.x;detectVerticalCornerPattern(weights.ba,coords.xyxz,d);}gl_FragColor=weights;}`,D9="uniform vec2 texelSize;uniform vec2 resolution;varying vec2 vUv;varying vec4 vOffset[3];varying vec2 vPixCoord;void main(){vUv=position.xy*0.5+0.5;vPixCoord=vUv*resolution;vOffset[0]=vUv.xyxy+texelSize.xyxy*vec4(-0.25,-0.125,1.25,-0.125);vOffset[1]=vUv.xyxy+texelSize.xyxy*vec4(-0.125,-0.25,-0.125,1.25);vOffset[2]=vec4(vOffset[0].xz,vOffset[1].yw)+vec4(-2.0,2.0,-2.0,2.0)*texelSize.xxyy*MAX_SEARCH_STEPS_FLOAT;gl_Position=vec4(position.xy,1.0,1.0);}",O9=class extends Et{constructor(n=new ie,e=new ie){super({name:"SMAAWeightsMaterial",defines:{MAX_SEARCH_STEPS_INT:"16",MAX_SEARCH_STEPS_FLOAT:"16.0",MAX_SEARCH_STEPS_DIAG_INT:"8",MAX_SEARCH_STEPS_DIAG_FLOAT:"8.0",CORNER_ROUNDING:"25",CORNER_ROUNDING_NORM:"0.25",AREATEX_MAX_DISTANCE:"16.0",AREATEX_MAX_DISTANCE_DIAG:"20.0",AREATEX_PIXEL_SIZE:"(1.0 / vec2(160.0, 560.0))",AREATEX_SUBTEX_SIZE:"(1.0 / 7.0)",SEARCHTEX_SIZE:"vec2(66.0, 33.0)",SEARCHTEX_PACKED_SIZE:"vec2(64.0, 16.0)"},uniforms:{inputBuffer:new we(null),searchTexture:new we(null),areaTexture:new we(null),resolution:new we(e),texelSize:new we(n)},blending:rn,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:B9,vertexShader:D9})}set inputBuffer(n){this.uniforms.inputBuffer.value=n}setInputBuffer(n){this.uniforms.inputBuffer.value=n}get searchTexture(){return this.uniforms.searchTexture.value}set searchTexture(n){this.uniforms.searchTexture.value=n}get areaTexture(){return this.uniforms.areaTexture.value}set areaTexture(n){this.uniforms.areaTexture.value=n}setLookupTextures(n,e){this.searchTexture=n,this.areaTexture=e}get orthogonalSearchSteps(){return Number(this.defines.MAX_SEARCH_STEPS_INT)}set orthogonalSearchSteps(n){const e=Math.min(Math.max(n,0),112);this.defines.MAX_SEARCH_STEPS_INT=e.toFixed("0"),this.defines.MAX_SEARCH_STEPS_FLOAT=e.toFixed("1"),this.needsUpdate=!0}setOrthogonalSearchSteps(n){this.orthogonalSearchSteps=n}get diagonalSearchSteps(){return Number(this.defines.MAX_SEARCH_STEPS_DIAG_INT)}set diagonalSearchSteps(n){const e=Math.min(Math.max(n,0),20);this.defines.MAX_SEARCH_STEPS_DIAG_INT=e.toFixed("0"),this.defines.MAX_SEARCH_STEPS_DIAG_FLOAT=e.toFixed("1"),this.needsUpdate=!0}setDiagonalSearchSteps(n){this.diagonalSearchSteps=n}get diagonalDetection(){return this.defines.DISABLE_DIAG_DETECTION===void 0}set diagonalDetection(n){n?delete this.defines.DISABLE_DIAG_DETECTION:this.defines.DISABLE_DIAG_DETECTION="1",this.needsUpdate=!0}isDiagonalDetectionEnabled(){return this.diagonalDetection}setDiagonalDetectionEnabled(n){this.diagonalDetection=n}get cornerRounding(){return Number(this.defines.CORNER_ROUNDING)}set cornerRounding(n){const e=Math.min(Math.max(n,0),100);this.defines.CORNER_ROUNDING=e.toFixed("4"),this.defines.CORNER_ROUNDING_NORM=(e/100).toFixed("4"),this.needsUpdate=!0}setCornerRounding(n){this.cornerRounding=n}get cornerDetection(){return this.defines.DISABLE_CORNER_DETECTION===void 0}set cornerDetection(n){n?delete this.defines.DISABLE_CORNER_DETECTION:this.defines.DISABLE_CORNER_DETECTION="1",this.needsUpdate=!0}isCornerRoundingEnabled(){return this.cornerDetection}setCornerRoundingEnabled(n){this.cornerDetection=n}setSize(n,e){const t=this.uniforms;t.texelSize.value.set(1/n,1/e),t.resolution.value.set(n,e)}},k9=`#include <common>
#include <packing>
#ifdef NORMAL_DEPTH
#ifdef GL_FRAGMENT_PRECISION_HIGH
uniform highp sampler2D normalDepthBuffer;
#else
uniform mediump sampler2D normalDepthBuffer;
#endif
float readDepth(const in vec2 uv){return texture2D(normalDepthBuffer,uv).a;}
#else
uniform lowp sampler2D normalBuffer;
#if DEPTH_PACKING == 3201
uniform lowp sampler2D depthBuffer;
#elif defined(GL_FRAGMENT_PRECISION_HIGH)
uniform highp sampler2D depthBuffer;
#else
uniform mediump sampler2D depthBuffer;
#endif
float readDepth(const in vec2 uv){
#if DEPTH_PACKING == 3201
return unpackRGBAToDepth(texture2D(depthBuffer,uv));
#else
return texture2D(depthBuffer,uv).r;
#endif
}
#endif
uniform lowp sampler2D noiseTexture;uniform mat4 inverseProjectionMatrix;uniform mat4 projectionMatrix;uniform vec2 texelSize;uniform vec2 cameraNearFar;uniform float intensity;uniform float minRadiusScale;uniform float fade;uniform float bias;uniform vec2 distanceCutoff;uniform vec2 proximityCutoff;varying vec2 vUv;varying vec2 vUv2;float getViewZ(const in float depth){
#ifdef PERSPECTIVE_CAMERA
return perspectiveDepthToViewZ(depth,cameraNearFar.x,cameraNearFar.y);
#else
return orthographicDepthToViewZ(depth,cameraNearFar.x,cameraNearFar.y);
#endif
}vec3 getViewPosition(const in vec2 screenPosition,const in float depth,const in float viewZ){vec4 clipPosition=vec4(vec3(screenPosition,depth)*2.0-1.0,1.0);float clipW=projectionMatrix[2][3]*viewZ+projectionMatrix[3][3];clipPosition*=clipW;return(inverseProjectionMatrix*clipPosition).xyz;}float getAmbientOcclusion(const in vec3 p,const in vec3 n,const in float depth,const in vec2 uv){float radiusScale=1.0-smoothstep(0.0,distanceCutoff.y,depth);radiusScale=radiusScale*(1.0-minRadiusScale)+minRadiusScale;float radius=RADIUS*radiusScale;float noise=texture2D(noiseTexture,vUv2).r;float baseAngle=noise*PI2;float rings=SPIRAL_TURNS*PI2;float occlusion=0.0;int taps=0;for(int i=0;i<SAMPLES_INT;++i){float alpha=(float(i)+0.5)*INV_SAMPLES_FLOAT;float angle=alpha*rings+baseAngle;vec2 rotation=vec2(cos(angle),sin(angle));vec2 coords=alpha*radius*rotation*texelSize+uv;if(coords.s<0.0||coords.s>1.0||coords.t<0.0||coords.t>1.0){continue;}float sampleDepth=readDepth(coords);float viewZ=getViewZ(sampleDepth);
#ifdef PERSPECTIVE_CAMERA
float linearSampleDepth=viewZToOrthographicDepth(viewZ,cameraNearFar.x,cameraNearFar.y);
#else
float linearSampleDepth=sampleDepth;
#endif
float proximity=abs(depth-linearSampleDepth);if(proximity<proximityCutoff.y){float falloff=1.0-smoothstep(proximityCutoff.x,proximityCutoff.y,proximity);vec3 Q=getViewPosition(coords,sampleDepth,viewZ);vec3 v=Q-p;float vv=dot(v,v);float vn=dot(v,n)-bias;float f=max(RADIUS_SQ-vv,0.0)/RADIUS_SQ;occlusion+=(f*f*f*max(vn/(fade+vv),0.0))*falloff;}++taps;}return occlusion/(4.0*max(float(taps),1.0));}void main(){
#ifdef NORMAL_DEPTH
vec4 normalDepth=texture2D(normalDepthBuffer,vUv);
#else
vec4 normalDepth=vec4(texture2D(normalBuffer,vUv).xyz,readDepth(vUv));
#endif
float ao=0.0;float depth=normalDepth.a;float viewZ=getViewZ(depth);
#ifdef PERSPECTIVE_CAMERA
float linearDepth=viewZToOrthographicDepth(viewZ,cameraNearFar.x,cameraNearFar.y);
#else
float linearDepth=depth;
#endif
if(linearDepth<distanceCutoff.y){vec3 viewPosition=getViewPosition(vUv,depth,viewZ);vec3 viewNormal=unpackRGBToNormal(normalDepth.rgb);ao+=getAmbientOcclusion(viewPosition,viewNormal,linearDepth,vUv);float d=smoothstep(distanceCutoff.x,distanceCutoff.y,linearDepth);ao=mix(ao,0.0,d);
#ifdef LEGACY_INTENSITY
ao=clamp(1.0-pow(1.0-ao,abs(intensity)),0.0,1.0);
#endif
}gl_FragColor.r=ao;}`,L9="uniform vec2 noiseScale;varying vec2 vUv;varying vec2 vUv2;void main(){vUv=position.xy*0.5+0.5;vUv2=vUv*noiseScale;gl_Position=vec4(position.xy,1.0,1.0);}",F9=class extends Et{constructor(n){super({name:"SSAOMaterial",defines:{SAMPLES_INT:"0",INV_SAMPLES_FLOAT:"0.0",SPIRAL_TURNS:"0.0",RADIUS:"1.0",RADIUS_SQ:"1.0",DISTANCE_SCALING:"1",DEPTH_PACKING:"0"},uniforms:{depthBuffer:new we(null),normalBuffer:new we(null),normalDepthBuffer:new we(null),noiseTexture:new we(null),inverseProjectionMatrix:new we(new Ce),projectionMatrix:new we(new Ce),texelSize:new we(new ie),cameraNearFar:new we(new ie),distanceCutoff:new we(new ie),proximityCutoff:new we(new ie),noiseScale:new we(new ie),minRadiusScale:new we(.33),intensity:new we(1),fade:new we(.01),bias:new we(0)},blending:rn,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:k9,vertexShader:L9}),this.copyCameraSettings(n),this.resolution=new ie,this.r=1}get near(){return this.uniforms.cameraNearFar.value.x}get far(){return this.uniforms.cameraNearFar.value.y}set normalDepthBuffer(n){this.uniforms.normalDepthBuffer.value=n,n!==null?this.defines.NORMAL_DEPTH="1":delete this.defines.NORMAL_DEPTH,this.needsUpdate=!0}setNormalDepthBuffer(n){this.normalDepthBuffer=n}set normalBuffer(n){this.uniforms.normalBuffer.value=n}setNormalBuffer(n){this.uniforms.normalBuffer.value=n}set depthBuffer(n){this.uniforms.depthBuffer.value=n}set depthPacking(n){this.defines.DEPTH_PACKING=n.toFixed(0),this.needsUpdate=!0}setDepthBuffer(n,e=Ts){this.depthBuffer=n,this.depthPacking=e}set noiseTexture(n){this.uniforms.noiseTexture.value=n}setNoiseTexture(n){this.uniforms.noiseTexture.value=n}get samples(){return Number(this.defines.SAMPLES_INT)}set samples(n){this.defines.SAMPLES_INT=n.toFixed(0),this.defines.INV_SAMPLES_FLOAT=(1/n).toFixed(9),this.needsUpdate=!0}getSamples(){return this.samples}setSamples(n){this.samples=n}get rings(){return Number(this.defines.SPIRAL_TURNS)}set rings(n){this.defines.SPIRAL_TURNS=n.toFixed(1),this.needsUpdate=!0}getRings(){return this.rings}setRings(n){this.rings=n}get intensity(){return this.uniforms.intensity.value}set intensity(n){this.uniforms.intensity.value=n,this.defines.LEGACY_INTENSITY===void 0&&(this.defines.LEGACY_INTENSITY="1",this.needsUpdate=!0)}getIntensity(){return this.uniforms.intensity.value}setIntensity(n){this.uniforms.intensity.value=n}get fade(){return this.uniforms.fade.value}set fade(n){this.uniforms.fade.value=n}getFade(){return this.uniforms.fade.value}setFade(n){this.uniforms.fade.value=n}get bias(){return this.uniforms.bias.value}set bias(n){this.uniforms.bias.value=n}getBias(){return this.uniforms.bias.value}setBias(n){this.uniforms.bias.value=n}get minRadiusScale(){return this.uniforms.minRadiusScale.value}set minRadiusScale(n){this.uniforms.minRadiusScale.value=n}getMinRadiusScale(){return this.uniforms.minRadiusScale.value}setMinRadiusScale(n){this.uniforms.minRadiusScale.value=n}updateRadius(){const n=this.r*this.resolution.height;this.defines.RADIUS=n.toFixed(11),this.defines.RADIUS_SQ=(n*n).toFixed(11),this.needsUpdate=!0}get radius(){return this.r}set radius(n){this.r=Math.min(Math.max(n,1e-6),1),this.updateRadius()}getRadius(){return this.radius}setRadius(n){this.radius=n}get distanceScaling(){return!0}set distanceScaling(n){}isDistanceScalingEnabled(){return this.distanceScaling}setDistanceScalingEnabled(n){this.distanceScaling=n}get distanceThreshold(){return this.uniforms.distanceCutoff.value.x}set distanceThreshold(n){this.uniforms.distanceCutoff.value.set(Math.min(Math.max(n,0),1),Math.min(Math.max(n+this.distanceFalloff,0),1))}get worldDistanceThreshold(){return-Pf(this.distanceThreshold,this.near,this.far)}set worldDistanceThreshold(n){this.distanceThreshold=zu(-n,this.near,this.far)}get distanceFalloff(){return this.uniforms.distanceCutoff.value.y-this.distanceThreshold}set distanceFalloff(n){this.uniforms.distanceCutoff.value.y=Math.min(Math.max(this.distanceThreshold+n,0),1)}get worldDistanceFalloff(){return-Pf(this.distanceFalloff,this.near,this.far)}set worldDistanceFalloff(n){this.distanceFalloff=zu(-n,this.near,this.far)}setDistanceCutoff(n,e){this.uniforms.distanceCutoff.value.set(Math.min(Math.max(n,0),1),Math.min(Math.max(n+e,0),1))}get proximityThreshold(){return this.uniforms.proximityCutoff.value.x}set proximityThreshold(n){this.uniforms.proximityCutoff.value.set(Math.min(Math.max(n,0),1),Math.min(Math.max(n+this.proximityFalloff,0),1))}get worldProximityThreshold(){return-Pf(this.proximityThreshold,this.near,this.far)}set worldProximityThreshold(n){this.proximityThreshold=zu(-n,this.near,this.far)}get proximityFalloff(){return this.uniforms.proximityCutoff.value.y-this.proximityThreshold}set proximityFalloff(n){this.uniforms.proximityCutoff.value.y=Math.min(Math.max(this.proximityThreshold+n,0),1)}get worldProximityFalloff(){return-Pf(this.proximityFalloff,this.near,this.far)}set worldProximityFalloff(n){this.proximityFalloff=zu(-n,this.near,this.far)}setProximityCutoff(n,e){this.uniforms.proximityCutoff.value.set(Math.min(Math.max(n,0),1),Math.min(Math.max(n+e,0),1))}setTexelSize(n,e){this.uniforms.texelSize.value.set(n,e)}adoptCameraSettings(n){this.copyCameraSettings(n)}copyCameraSettings(n){n&&(this.uniforms.cameraNearFar.value.set(n.near,n.far),this.uniforms.projectionMatrix.value.copy(n.projectionMatrix),this.uniforms.inverseProjectionMatrix.value.copy(n.projectionMatrix).invert(),n instanceof Wt?this.defines.PERSPECTIVE_CAMERA="1":delete this.defines.PERSPECTIVE_CAMERA,this.needsUpdate=!0)}setSize(n,e){const t=this.uniforms,i=t.noiseTexture.value;i!==null&&t.noiseScale.value.set(n/i.image.width,e/i.image.height),t.texelSize.value.set(1/n,1/e),this.resolution.set(n,e),this.updateRadius()}},U9=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
uniform vec4 maskParams;varying vec2 vUv;varying vec2 vUv2;varying vec2 vOffset;float linearGradientMask(const in float x){return smoothstep(maskParams.x,maskParams.y,x)-smoothstep(maskParams.w,maskParams.z,x);}void main(){vec2 dUv=vOffset*(1.0-linearGradientMask(vUv2.y));vec4 sum=texture2D(inputBuffer,vec2(vUv.x-dUv.x,vUv.y+dUv.y));sum+=texture2D(inputBuffer,vec2(vUv.x+dUv.x,vUv.y+dUv.y));sum+=texture2D(inputBuffer,vec2(vUv.x+dUv.x,vUv.y-dUv.y));sum+=texture2D(inputBuffer,vec2(vUv.x-dUv.x,vUv.y-dUv.y));gl_FragColor=sum*0.25;
#include <colorspace_fragment>
}`,N9="uniform vec4 texelSize;uniform float kernel;uniform float scale;uniform float aspect;uniform vec2 rotation;varying vec2 vUv;varying vec2 vUv2;varying vec2 vOffset;void main(){vec2 uv=position.xy*0.5+0.5;vUv=uv;vUv2=(uv-0.5)*2.0*vec2(aspect,1.0);vUv2=vec2(dot(rotation,vUv2),dot(rotation,vec2(vUv2.y,-vUv2.x)));vOffset=(texelSize.xy*vec2(kernel)+texelSize.zw)*scale;gl_Position=vec4(position.xy,1.0,1.0);}",z9=class extends OF{constructor({kernelSize:n=Sl.MEDIUM,offset:e=0,rotation:t=0,focusArea:i=.4,feather:s=.3}={}){super(),this.fragmentShader=U9,this.vertexShader=N9,this.kernelSize=n,this.fragmentShader=Lp(this.fragmentShader),this.uniforms.aspect=new we(1),this.uniforms.rotation=new we(new ie),this.uniforms.maskParams=new we(new tt),this._offset=e,this._focusArea=i,this._feather=s,this.rotation=t,this.updateParams()}updateParams(){const n=this.uniforms.maskParams.value,e=Math.max(this.focusArea,0),t=Math.max(e-this.feather,0);n.set(this.offset-e,this.offset-t,this.offset+e,this.offset+t)}get rotation(){return Math.acos(this.uniforms.rotation.value.x)}set rotation(n){this.uniforms.rotation.value.set(Math.cos(n),Math.sin(n))}get offset(){return this._offset}set offset(n){this._offset=n,this.updateParams()}get focusArea(){return this._focusArea}set focusArea(n){this._focusArea=n,this.updateParams()}get feather(){return this._feather}set feather(n){this._feather=n,this.updateParams()}setSize(n,e){super.setSize(n,e),this.uniforms.aspect.value=n/e}},G9=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;uniform mediump sampler2D supportBuffer;
#else
uniform lowp sampler2D inputBuffer;uniform lowp sampler2D supportBuffer;
#endif
uniform float radius;varying vec2 vUv;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;varying vec2 vUv4;varying vec2 vUv5;varying vec2 vUv6;varying vec2 vUv7;void main(){vec4 c=vec4(0.0);c+=texture2D(inputBuffer,vUv0)*0.0625;c+=texture2D(inputBuffer,vUv1)*0.125;c+=texture2D(inputBuffer,vUv2)*0.0625;c+=texture2D(inputBuffer,vUv3)*0.125;c+=texture2D(inputBuffer,vUv)*0.25;c+=texture2D(inputBuffer,vUv4)*0.125;c+=texture2D(inputBuffer,vUv5)*0.0625;c+=texture2D(inputBuffer,vUv6)*0.125;c+=texture2D(inputBuffer,vUv7)*0.0625;vec4 baseColor=texture2D(supportBuffer,vUv);gl_FragColor=mix(baseColor,c,radius);
#include <colorspace_fragment>
}`,V9="uniform vec2 texelSize;varying vec2 vUv;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;varying vec2 vUv4;varying vec2 vUv5;varying vec2 vUv6;varying vec2 vUv7;void main(){vUv=position.xy*0.5+0.5;vUv0=vUv+texelSize*vec2(-1.0,1.0);vUv1=vUv+texelSize*vec2(0.0,1.0);vUv2=vUv+texelSize*vec2(1.0,1.0);vUv3=vUv+texelSize*vec2(-1.0,0.0);vUv4=vUv+texelSize*vec2(1.0,0.0);vUv5=vUv+texelSize*vec2(-1.0,-1.0);vUv6=vUv+texelSize*vec2(0.0,-1.0);vUv7=vUv+texelSize*vec2(1.0,-1.0);gl_Position=vec4(position.xy,1.0,1.0);}",H9=class extends Et{constructor(){super({name:"UpsamplingMaterial",uniforms:{inputBuffer:new we(null),supportBuffer:new we(null),texelSize:new we(new ie),radius:new we(.85)},blending:rn,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:G9,vertexShader:V9}),this.fragmentShader=Lp(this.fragmentShader)}set inputBuffer(n){this.uniforms.inputBuffer.value=n}set supportBuffer(n){this.uniforms.supportBuffer.value=n}get radius(){return this.uniforms.radius.value}set radius(n){this.uniforms.radius.value=n}setSize(n,e){this.uniforms.texelSize.value.set(1/n,1/e)}},Q9=new LA,$l=null;function j9(){if($l===null){const n=new Float32Array([-1,-1,0,3,-1,0,-1,3,0]),e=new Float32Array([0,0,2,0,0,2]);$l=new gt,$l.setAttribute!==void 0?($l.setAttribute("position",new it(n,3)),$l.setAttribute("uv",new it(e,2))):($l.addAttribute("position",new it(n,3)),$l.addAttribute("uv",new it(e,2)))}return $l}var Js=class LF{constructor(e="Pass",t=new Ws,i=Q9){this.name=e,this.renderer=null,this.scene=t,this.camera=i,this.screen=null,this.rtt=!0,this.needsSwap=!0,this.needsDepthTexture=!1,this.enabled=!0}get renderToScreen(){return!this.rtt}set renderToScreen(e){if(this.rtt===e){const t=this.fullscreenMaterial;t!==null&&(t.needsUpdate=!0),this.rtt=!e}}set mainScene(e){}set mainCamera(e){}setRenderer(e){this.renderer=e}isEnabled(){return this.enabled}setEnabled(e){this.enabled=e}get fullscreenMaterial(){return this.screen!==null?this.screen.material:null}set fullscreenMaterial(e){let t=this.screen;t!==null?t.material=e:(t=new me(j9(),e),t.frustumCulled=!1,this.scene===null&&(this.scene=new Ws),this.scene.add(t),this.screen=t)}getFullscreenMaterial(){return this.fullscreenMaterial}setFullscreenMaterial(e){this.fullscreenMaterial=e}getDepthTexture(){return null}setDepthTexture(e,t=Ts){}render(e,t,i,s,r){throw new Error("Render method not implemented!")}setSize(e,t){}initialize(e,t,i){}dispose(){for(const e of Object.keys(this)){const t=this[e];(t instanceof Zt||t instanceof Ot||t instanceof Ft||t instanceof LF)&&this[e].dispose()}}},W9=class extends Js{constructor(n,e=!0){super("CopyPass"),this.fullscreenMaterial=new kF,this.needsSwap=!1,this.renderTarget=n,n===void 0&&(this.renderTarget=new Zt(1,1,{minFilter:St,magFilter:St,stencilBuffer:!1,depthBuffer:!1}),this.renderTarget.texture.name="CopyPass.Target"),this.autoResize=e}get resize(){return this.autoResize}set resize(n){this.autoResize=n}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}setAutoResizeEnabled(n){this.autoResize=n}render(n,e,t,i,s){this.fullscreenMaterial.inputBuffer=e.texture,n.setRenderTarget(this.renderToScreen?null:this.renderTarget),n.render(this.scene,this.camera)}setSize(n,e){this.autoResize&&this.renderTarget.setSize(n,e)}initialize(n,e,t){t!==void 0&&(this.renderTarget.texture.type=t,t!==gi?this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1":Cl(n)===Bi&&Lr(this.renderTarget.texture,Bi))}},q9=class extends Js{constructor(){super("ClearMaskPass",null,null),this.needsSwap=!1}render(n,e,t,i,s){const r=n.state.buffers.stencil;r.setLocked(!1),r.setTest(!1)}},_B=new ye,ox=class extends Js{constructor(n=!0,e=!0,t=!1){super("ClearPass",null,null),this.needsSwap=!1,this.color=n,this.depth=e,this.stencil=t,this.overrideClearColor=null,this.overrideClearAlpha=-1}setClearFlags(n,e,t){this.color=n,this.depth=e,this.stencil=t}getOverrideClearColor(){return this.overrideClearColor}setOverrideClearColor(n){this.overrideClearColor=n}getOverrideClearAlpha(){return this.overrideClearAlpha}setOverrideClearAlpha(n){this.overrideClearAlpha=n}render(n,e,t,i,s){const r=this.overrideClearColor,o=this.overrideClearAlpha,a=n.getClearAlpha(),c=r!==null,l=o>=0;c?(n.getClearColor(_B),n.setClearColor(r,l?o:a)):l&&n.setClearAlpha(o),n.setRenderTarget(this.renderToScreen?null:e),n.clear(this.color,this.depth,this.stencil),c?n.setClearColor(_B,a):l&&n.setClearAlpha(a)}},ax=class extends Js{constructor(n,e,t=null){super("RenderPass",n,e),this.needsSwap=!1,this.clearPass=new ox,this.overrideMaterialManager=t===null?null:new SB(t),this.ignoreBackground=!1,this.skipShadowMapUpdate=!1,this.selection=null}set mainScene(n){this.scene=n}set mainCamera(n){this.camera=n}get renderToScreen(){return super.renderToScreen}set renderToScreen(n){super.renderToScreen=n,this.clearPass.renderToScreen=n}get overrideMaterial(){const n=this.overrideMaterialManager;return n!==null?n.material:null}set overrideMaterial(n){const e=this.overrideMaterialManager;n!==null?e!==null?e.setMaterial(n):this.overrideMaterialManager=new SB(n):e!==null&&(e.dispose(),this.overrideMaterialManager=null)}getOverrideMaterial(){return this.overrideMaterial}setOverrideMaterial(n){this.overrideMaterial=n}get clear(){return this.clearPass.enabled}set clear(n){this.clearPass.enabled=n}getSelection(){return this.selection}setSelection(n){this.selection=n}isBackgroundDisabled(){return this.ignoreBackground}setBackgroundDisabled(n){this.ignoreBackground=n}isShadowMapDisabled(){return this.skipShadowMapUpdate}setShadowMapDisabled(n){this.skipShadowMapUpdate=n}getClearPass(){return this.clearPass}render(n,e,t,i,s){const r=this.scene,o=this.camera,a=this.selection,c=o.layers.mask,l=r.background,h=n.shadowMap.autoUpdate,d=this.renderToScreen?null:e;a!==null&&o.layers.set(a.getLayer()),this.skipShadowMapUpdate&&(n.shadowMap.autoUpdate=!1),(this.ignoreBackground||this.clearPass.overrideClearColor!==null)&&(r.background=null),this.clearPass.enabled&&this.clearPass.render(n,e),n.setRenderTarget(d),this.overrideMaterialManager!==null?this.overrideMaterialManager.render(n,r,o):n.render(r,o),o.layers.mask=c,r.background=l,n.shadowMap.autoUpdate=h}},X9=class extends Js{constructor(n,e,{renderTarget:t,resolutionScale:i=1,width:s=Si.AUTO_SIZE,height:r=Si.AUTO_SIZE,resolutionX:o=s,resolutionY:a=r}={}){super("DepthPass"),this.needsSwap=!1,this.renderPass=new ax(n,e,new NA({depthPacking:T_}));const c=this.renderPass;c.skipShadowMapUpdate=!0,c.ignoreBackground=!0;const l=c.clearPass;l.overrideClearColor=new ye(16777215),l.overrideClearAlpha=1,this.renderTarget=t,this.renderTarget===void 0&&(this.renderTarget=new Zt(1,1,{minFilter:Nt,magFilter:Nt}),this.renderTarget.texture.name="DepthPass.Target");const h=this.resolution=new Si(this,o,a,i);h.addEventListener("change",d=>this.setSize(h.baseWidth,h.baseHeight))}set mainScene(n){this.renderPass.mainScene=n}set mainCamera(n){this.renderPass.mainCamera=n}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}getResolution(){return this.resolution}getResolutionScale(){return this.resolution.scale}setResolutionScale(n){this.resolution.scale=n}render(n,e,t,i,s){const r=this.renderToScreen?null:this.renderTarget;this.renderPass.render(n,r)}setSize(n,e){const t=this.resolution;t.setBaseSize(n,e),this.renderTarget.setSize(t.width,t.height)}},c1=class extends Js{constructor({normalBuffer:n=null,resolutionScale:e=.5,width:t=Si.AUTO_SIZE,height:i=Si.AUTO_SIZE,resolutionX:s=t,resolutionY:r=i}={}){super("DepthDownsamplingPass");const o=new g9;o.normalBuffer=n,this.fullscreenMaterial=o,this.needsDepthTexture=!0,this.needsSwap=!1,this.renderTarget=new Zt(1,1,{minFilter:Nt,magFilter:Nt,depthBuffer:!1,type:Ji}),this.renderTarget.texture.name="DepthDownsamplingPass.Target",this.renderTarget.texture.generateMipmaps=!1;const a=this.resolution=new Si(this,s,r,e);a.addEventListener("change",c=>this.setSize(a.baseWidth,a.baseHeight))}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}getResolution(){return this.resolution}setDepthTexture(n,e=Ts){this.fullscreenMaterial.depthBuffer=n,this.fullscreenMaterial.depthPacking=e}render(n,e,t,i,s){n.setRenderTarget(this.renderToScreen?null:this.renderTarget),n.render(this.scene,this.camera)}setSize(n,e){const t=this.resolution;t.setBaseSize(n,e),this.renderTarget.setSize(t.width,t.height),this.fullscreenMaterial.setSize(n,e)}initialize(n,e,t){const i=n.getContext();if(!(i.getExtension("EXT_color_buffer_float")||i.getExtension("EXT_color_buffer_half_float")))throw new Error("Rendering to float texture is not supported.")}};function xB(n,e,t){for(const i of e){const s="$1"+n+i.charAt(0).toUpperCase()+i.slice(1),r=new RegExp("([^\\.])(\\b"+i+"\\b)","g");for(const o of t.entries())o[1]!==null&&t.set(o[0],o[1].replace(r,s))}}function Y9(n,e,t){let i=e.getFragmentShader(),s=e.getVertexShader();const r=i!==void 0&&/mainImage/.test(i),o=i!==void 0&&/mainUv/.test(i);if(t.attributes|=e.getAttributes(),i===void 0)throw new Error(`Missing fragment shader (${e.name})`);if(o&&t.attributes&no.CONVOLUTION)throw new Error(`Effects that transform UVs are incompatible with convolution effects (${e.name})`);if(!r&&!o)throw new Error(`Could not find mainImage or mainUv function (${e.name})`);{const a=/\w+\s+(\w+)\([\w\s,]*\)\s*{/g,c=t.shaderParts;let l=c.get(mi.FRAGMENT_HEAD)||"",h=c.get(mi.FRAGMENT_MAIN_UV)||"",d=c.get(mi.FRAGMENT_MAIN_IMAGE)||"",f=c.get(mi.VERTEX_HEAD)||"",p=c.get(mi.VERTEX_MAIN_SUPPORT)||"";const m=new Set,g=new Set;if(o&&(h+=`	${n}MainUv(UV);
`,t.uvTransformation=!0),s!==null&&/mainSupport/.test(s)){const v=/mainSupport *\([\w\s]*?uv\s*?\)/.test(s);p+=`	${n}MainSupport(`,p+=v?`vUv);
`:`);
`;for(const b of s.matchAll(/(?:varying\s+\w+\s+([\S\s]*?);)/g))for(const _ of b[1].split(/\s*,\s*/))t.varyings.add(_),m.add(_),g.add(_);for(const b of s.matchAll(a))g.add(b[1])}for(const v of i.matchAll(a))g.add(v[1]);for(const v of e.defines.keys())g.add(v.replace(/\([\w\s,]*\)/g,""));for(const v of e.uniforms.keys())g.add(v);g.delete("while"),g.delete("for"),g.delete("if"),e.uniforms.forEach((v,b)=>t.uniforms.set(n+b.charAt(0).toUpperCase()+b.slice(1),v)),e.defines.forEach((v,b)=>t.defines.set(n+b.charAt(0).toUpperCase()+b.slice(1),v));const y=new Map([["fragment",i],["vertex",s]]);xB(n,g,t.defines),xB(n,g,y),i=y.get("fragment"),s=y.get("vertex");const A=e.blendMode;if(t.blendModes.set(A.blendFunction,A),r){e.inputColorSpace!==null&&e.inputColorSpace!==t.colorSpace&&(d+=e.inputColorSpace===Bi?`color0 = LinearTosRGB(color0);
	`:`color0 = sRGBToLinear(color0);
	`),e.outputColorSpace!==RF?t.colorSpace=e.outputColorSpace:e.inputColorSpace!==null&&(t.colorSpace=e.inputColorSpace);const v=/MainImage *\([\w\s,]*?depth[\w\s,]*?\)/;d+=`${n}MainImage(color0, UV, `,t.attributes&no.DEPTH&&v.test(i)&&(d+="depth, ",t.readDepth=!0),d+=`color1);
	`;const b=n+"BlendOpacity";t.uniforms.set(b,A.opacity),d+=`color0 = blend${A.blendFunction}(color0, color1, ${b});

	`,l+=`uniform float ${b};

`}if(l+=i+`
`,s!==null&&(f+=s+`
`),c.set(mi.FRAGMENT_HEAD,l),c.set(mi.FRAGMENT_MAIN_UV,h),c.set(mi.FRAGMENT_MAIN_IMAGE,d),c.set(mi.VERTEX_HEAD,f),c.set(mi.VERTEX_MAIN_SUPPORT,p),e.extensions!==null)for(const v of e.extensions)t.extensions.add(v)}}var wB=class extends Js{constructor(n,...e){super("EffectPass"),this.fullscreenMaterial=new T9(null,null,null,n),this.listener=t=>this.handleEvent(t),this.effects=[],this.setEffects(e),this.skipRendering=!1,this.minTime=1,this.maxTime=Number.POSITIVE_INFINITY,this.timeScale=1}set mainScene(n){for(const e of this.effects)e.mainScene=n}set mainCamera(n){this.fullscreenMaterial.copyCameraSettings(n);for(const e of this.effects)e.mainCamera=n}get encodeOutput(){return this.fullscreenMaterial.encodeOutput}set encodeOutput(n){this.fullscreenMaterial.encodeOutput=n}get dithering(){return this.fullscreenMaterial.dithering}set dithering(n){const e=this.fullscreenMaterial;e.dithering=n,e.needsUpdate=!0}setEffects(n){for(const e of this.effects)e.removeEventListener("change",this.listener);this.effects=n.sort((e,t)=>t.attributes-e.attributes);for(const e of this.effects)e.addEventListener("change",this.listener)}updateMaterial(){const n=new i6;let e=0;for(const o of this.effects)if(o.blendMode.blendFunction===Gt.DST)n.attributes|=o.getAttributes()&no.DEPTH;else{if(n.attributes&o.getAttributes()&no.CONVOLUTION)throw new Error(`Convolution effects cannot be merged (${o.name})`);Y9("e"+e++,o,n)}let t=n.shaderParts.get(mi.FRAGMENT_HEAD),i=n.shaderParts.get(mi.FRAGMENT_MAIN_IMAGE),s=n.shaderParts.get(mi.FRAGMENT_MAIN_UV);const r=/\bblend\b/g;for(const o of n.blendModes.values())t+=o.getShaderCode().replace(r,`blend${o.blendFunction}`)+`
`;n.attributes&no.DEPTH?(n.readDepth&&(i=`float depth = readDepth(UV);

	`+i),this.needsDepthTexture=this.getDepthTexture()===null):this.needsDepthTexture=!1,n.colorSpace===Bi&&(i+=`color0 = sRGBToLinear(color0);
	`),n.uvTransformation?(s=`vec2 transformedUv = vUv;
`+s,n.defines.set("UV","transformedUv")):n.defines.set("UV","vUv"),n.shaderParts.set(mi.FRAGMENT_HEAD,t),n.shaderParts.set(mi.FRAGMENT_MAIN_IMAGE,i),n.shaderParts.set(mi.FRAGMENT_MAIN_UV,s);for(const[o,a]of n.shaderParts)a!==null&&n.shaderParts.set(o,a.trim().replace(/^#/,`
#`));this.skipRendering=e===0,this.needsSwap=!this.skipRendering,this.fullscreenMaterial.setShaderData(n)}recompile(){this.updateMaterial()}getDepthTexture(){return this.fullscreenMaterial.depthBuffer}setDepthTexture(n,e=Ts){this.fullscreenMaterial.depthBuffer=n,this.fullscreenMaterial.depthPacking=e;for(const t of this.effects)t.setDepthTexture(n,e)}render(n,e,t,i,s){for(const r of this.effects)r.update(n,e,i);if(!this.skipRendering||this.renderToScreen){const r=this.fullscreenMaterial;r.inputBuffer=e.texture,r.time+=i*this.timeScale,n.setRenderTarget(this.renderToScreen?null:t),n.render(this.scene,this.camera)}}setSize(n,e){this.fullscreenMaterial.setSize(n,e);for(const t of this.effects)t.setSize(n,e)}initialize(n,e,t){this.renderer=n;for(const i of this.effects)i.initialize(n,e,t);this.updateMaterial(),t!==void 0&&t!==gi&&(this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}dispose(){super.dispose();for(const n of this.effects)n.removeEventListener("change",this.listener),n.dispose()}handleEvent(n){switch(n.type){case"change":this.recompile();break}}},l1=class extends Js{constructor({kernelSize:n=Sl.MEDIUM,resolutionScale:e=.5,width:t=Si.AUTO_SIZE,height:i=Si.AUTO_SIZE,resolutionX:s=t,resolutionY:r=i}={}){super("KawaseBlurPass"),this.renderTargetA=new Zt(1,1,{depthBuffer:!1}),this.renderTargetA.texture.name="Blur.Target.A",this.renderTargetB=this.renderTargetA.clone(),this.renderTargetB.texture.name="Blur.Target.B";const o=this.resolution=new Si(this,s,r,e);o.addEventListener("change",a=>this.setSize(o.baseWidth,o.baseHeight)),this._blurMaterial=new OF,this._blurMaterial.kernelSize=n,this.copyMaterial=new kF}getResolution(){return this.resolution}get blurMaterial(){return this._blurMaterial}set blurMaterial(n){this._blurMaterial=n}get dithering(){return this.copyMaterial.dithering}set dithering(n){this.copyMaterial.dithering=n}get kernelSize(){return this.blurMaterial.kernelSize}set kernelSize(n){this.blurMaterial.kernelSize=n}get width(){return this.resolution.width}set width(n){this.resolution.preferredWidth=n}get height(){return this.resolution.height}set height(n){this.resolution.preferredHeight=n}get scale(){return this.blurMaterial.scale}set scale(n){this.blurMaterial.scale=n}getScale(){return this.blurMaterial.scale}setScale(n){this.blurMaterial.scale=n}getKernelSize(){return this.kernelSize}setKernelSize(n){this.kernelSize=n}getResolutionScale(){return this.resolution.scale}setResolutionScale(n){this.resolution.scale=n}render(n,e,t,i,s){const r=this.scene,o=this.camera,a=this.renderTargetA,c=this.renderTargetB,l=this.blurMaterial,h=l.kernelSequence;let d=e;this.fullscreenMaterial=l;for(let f=0,p=h.length;f<p;++f){const m=f&1?c:a;l.kernel=h[f],l.inputBuffer=d.texture,n.setRenderTarget(m),n.render(r,o),d=m}this.fullscreenMaterial=this.copyMaterial,this.copyMaterial.inputBuffer=d.texture,n.setRenderTarget(this.renderToScreen?null:t),n.render(r,o)}setSize(n,e){const t=this.resolution;t.setBaseSize(n,e);const i=t.width,s=t.height;this.renderTargetA.setSize(i,s),this.renderTargetB.setSize(i,s),this.blurMaterial.setSize(n,e)}initialize(n,e,t){t!==void 0&&(this.renderTargetA.texture.type=t,this.renderTargetB.texture.type=t,t!==gi?(this.blurMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1",this.copyMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1"):Cl(n)===Bi&&(Lr(this.renderTargetA.texture,Bi),Lr(this.renderTargetB.texture,Bi)))}static get AUTO_SIZE(){return Si.AUTO_SIZE}},J9=class extends Js{constructor({renderTarget:n,luminanceRange:e,colorOutput:t,resolutionScale:i=1,width:s=Si.AUTO_SIZE,height:r=Si.AUTO_SIZE,resolutionX:o=s,resolutionY:a=r}={}){super("LuminancePass"),this.fullscreenMaterial=new I9(t,e),this.needsSwap=!1,this.renderTarget=n,this.renderTarget===void 0&&(this.renderTarget=new Zt(1,1,{depthBuffer:!1}),this.renderTarget.texture.name="LuminancePass.Target");const c=this.resolution=new Si(this,o,a,i);c.addEventListener("change",l=>this.setSize(c.baseWidth,c.baseHeight))}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}getResolution(){return this.resolution}render(n,e,t,i,s){const r=this.fullscreenMaterial;r.inputBuffer=e.texture,n.setRenderTarget(this.renderToScreen?null:this.renderTarget),n.render(this.scene,this.camera)}setSize(n,e){const t=this.resolution;t.setBaseSize(n,e),this.renderTarget.setSize(t.width,t.height)}initialize(n,e,t){t!==void 0&&t!==gi&&(this.renderTarget.texture.type=t,this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}},K9=class extends Js{constructor(n,e){super("MaskPass",n,e),this.needsSwap=!1,this.clearPass=new ox(!1,!1,!0),this.inverse=!1}set mainScene(n){this.scene=n}set mainCamera(n){this.camera=n}get inverted(){return this.inverse}set inverted(n){this.inverse=n}get clear(){return this.clearPass.enabled}set clear(n){this.clearPass.enabled=n}getClearPass(){return this.clearPass}isInverted(){return this.inverted}setInverted(n){this.inverted=n}render(n,e,t,i,s){const r=n.getContext(),o=n.state.buffers,a=this.scene,c=this.camera,l=this.clearPass,h=this.inverted?0:1,d=1-h;o.color.setMask(!1),o.depth.setMask(!1),o.color.setLocked(!0),o.depth.setLocked(!0),o.stencil.setTest(!0),o.stencil.setOp(r.REPLACE,r.REPLACE,r.REPLACE),o.stencil.setFunc(r.ALWAYS,h,4294967295),o.stencil.setClear(d),o.stencil.setLocked(!0),this.clearPass.enabled&&(this.renderToScreen?l.render(n,null):(l.render(n,e),l.render(n,t))),this.renderToScreen?(n.setRenderTarget(null),n.render(a,c)):(n.setRenderTarget(e),n.render(a,c),n.setRenderTarget(t),n.render(a,c)),o.color.setLocked(!1),o.depth.setLocked(!1),o.stencil.setLocked(!1),o.stencil.setFunc(r.EQUAL,1,4294967295),o.stencil.setOp(r.KEEP,r.KEEP,r.KEEP),o.stencil.setLocked(!0)}},Z9=class extends Js{constructor(){super("MipmapBlurPass"),this.needsSwap=!1,this.renderTarget=new Zt(1,1,{depthBuffer:!1}),this.renderTarget.texture.name="Upsampling.Mipmap0",this.downsamplingMipmaps=[],this.upsamplingMipmaps=[],this.downsamplingMaterial=new _9,this.upsamplingMaterial=new H9,this.resolution=new ie}get texture(){return this.renderTarget.texture}get levels(){return this.downsamplingMipmaps.length}set levels(n){if(this.levels!==n){const e=this.renderTarget;this.dispose(),this.downsamplingMipmaps=[],this.upsamplingMipmaps=[];for(let t=0;t<n;++t){const i=e.clone();i.texture.name="Downsampling.Mipmap"+t,this.downsamplingMipmaps.push(i)}this.upsamplingMipmaps.push(e);for(let t=1,i=n-1;t<i;++t){const s=e.clone();s.texture.name="Upsampling.Mipmap"+t,this.upsamplingMipmaps.push(s)}this.setSize(this.resolution.x,this.resolution.y)}}get radius(){return this.upsamplingMaterial.radius}set radius(n){this.upsamplingMaterial.radius=n}render(n,e,t,i,s){const{scene:r,camera:o}=this,{downsamplingMaterial:a,upsamplingMaterial:c}=this,{downsamplingMipmaps:l,upsamplingMipmaps:h}=this;let d=e;this.fullscreenMaterial=a;for(let f=0,p=l.length;f<p;++f){const m=l[f];a.setSize(d.width,d.height),a.inputBuffer=d.texture,n.setRenderTarget(m),n.render(r,o),d=m}this.fullscreenMaterial=c;for(let f=h.length-1;f>=0;--f){const p=h[f];c.setSize(d.width,d.height),c.inputBuffer=d.texture,c.supportBuffer=l[f].texture,n.setRenderTarget(p),n.render(r,o),d=p}}setSize(n,e){const t=this.resolution;t.set(n,e);let i=t.width,s=t.height;for(let r=0,o=this.downsamplingMipmaps.length;r<o;++r)i=Math.round(i*.5),s=Math.round(s*.5),this.downsamplingMipmaps[r].setSize(i,s),r<this.upsamplingMipmaps.length&&this.upsamplingMipmaps[r].setSize(i,s)}initialize(n,e,t){if(t!==void 0){const i=this.downsamplingMipmaps.concat(this.upsamplingMipmaps);for(const s of i)s.texture.type=t;if(t!==gi)this.downsamplingMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1",this.upsamplingMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1";else if(Cl(n)===Bi)for(const s of i)Lr(s.texture,Bi)}}dispose(){super.dispose();for(const n of this.downsamplingMipmaps.concat(this.upsamplingMipmaps))n.dispose()}},FF=class extends Js{constructor(n,e,{renderTarget:t,resolutionScale:i=1,width:s=Si.AUTO_SIZE,height:r=Si.AUTO_SIZE,resolutionX:o=s,resolutionY:a=r}={}){super("NormalPass"),this.needsSwap=!1,this.renderPass=new ax(n,e,new q_);const c=this.renderPass;c.ignoreBackground=!0,c.skipShadowMapUpdate=!0;const l=c.getClearPass();l.overrideClearColor=new ye(7829503),l.overrideClearAlpha=1,this.renderTarget=t,this.renderTarget===void 0&&(this.renderTarget=new Zt(1,1,{minFilter:Nt,magFilter:Nt}),this.renderTarget.texture.name="NormalPass.Target");const h=this.resolution=new Si(this,o,a,i);h.addEventListener("change",d=>this.setSize(h.baseWidth,h.baseHeight))}set mainScene(n){this.renderPass.mainScene=n}set mainCamera(n){this.renderPass.mainCamera=n}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}getResolution(){return this.resolution}getResolutionScale(){return this.resolution.scale}setResolutionScale(n){this.resolution.scale=n}render(n,e,t,i,s){const r=this.renderToScreen?null:this.renderTarget;this.renderPass.render(n,r,r)}setSize(n,e){const t=this.resolution;t.setBaseSize(n,e),this.renderTarget.setSize(t.width,t.height)}},ja=class extends Js{constructor(n,e="inputBuffer"){super("ShaderPass"),this.fullscreenMaterial=n,this.input=e}setInput(n){this.input=n}render(n,e,t,i,s){const r=this.fullscreenMaterial.uniforms;e!==null&&r!==void 0&&r[this.input]!==void 0&&(r[this.input].value=e.texture),n.setRenderTarget(this.renderToScreen?null:t),n.render(this.scene,this.camera)}initialize(n,e,t){t!==void 0&&t!==gi&&(this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}},$9=class extends l1{constructor({offset:n=0,rotation:e=0,focusArea:t=.4,feather:i=.3,kernelSize:s=Sl.MEDIUM,resolutionScale:r=.5,resolutionX:o=Si.AUTO_SIZE,resolutionY:a=Si.AUTO_SIZE}={}){super({kernelSize:s,resolutionScale:r,resolutionX:o,resolutionY:a}),this.blurMaterial=new z9({kernelSize:s,offset:n,rotation:e,focusArea:t,feather:i})}},AS=1/1e3,e6=1e3,t6=class{constructor(){this.startTime=performance.now(),this.previousTime=0,this.currentTime=0,this._delta=0,this._elapsed=0,this._fixedDelta=1e3/60,this.timescale=1,this.useFixedDelta=!1,this._autoReset=!1}get autoReset(){return this._autoReset}set autoReset(n){typeof document<"u"&&document.hidden!==void 0&&(n?document.addEventListener("visibilitychange",this):document.removeEventListener("visibilitychange",this),this._autoReset=n)}get delta(){return this._delta*AS}get fixedDelta(){return this._fixedDelta*AS}set fixedDelta(n){this._fixedDelta=n*e6}get elapsed(){return this._elapsed*AS}update(n){this.useFixedDelta?this._delta=this.fixedDelta:(this.previousTime=this.currentTime,this.currentTime=(n!==void 0?n:performance.now())-this.startTime,this._delta=this.currentTime-this.previousTime),this._delta*=this.timescale,this._elapsed+=this._delta}reset(){this._delta=0,this._elapsed=0,this.currentTime=performance.now()-this.startTime}handleEvent(n){document.hidden||(this.currentTime=performance.now()-this.startTime)}dispose(){this.autoReset=!1}},h1=class{constructor(n=null,{depthBuffer:e=!0,stencilBuffer:t=!1,multisampling:i=0,frameBufferType:s}={}){this.renderer=null,this.inputBuffer=this.createBuffer(e,t,s,i),this.outputBuffer=this.inputBuffer.clone(),this.copyPass=new W9,this.depthTexture=null,this.passes=[],this.timer=new t6,this.autoRenderToScreen=!0,this.setRenderer(n)}get multisampling(){return this.inputBuffer.samples||0}set multisampling(n){const e=this.inputBuffer,t=this.multisampling;t>0&&n>0?(this.inputBuffer.samples=n,this.outputBuffer.samples=n,this.inputBuffer.dispose(),this.outputBuffer.dispose()):t!==n&&(this.inputBuffer.dispose(),this.outputBuffer.dispose(),this.inputBuffer=this.createBuffer(e.depthBuffer,e.stencilBuffer,e.texture.type,n),this.inputBuffer.depthTexture=this.depthTexture,this.outputBuffer=this.inputBuffer.clone())}getTimer(){return this.timer}getRenderer(){return this.renderer}setRenderer(n){if(this.renderer=n,n!==null){const e=n.getSize(new ie),t=n.getContext().getContextAttributes().alpha,i=this.inputBuffer.texture.type;i===gi&&Cl(n)===Bi&&(Lr(this.inputBuffer.texture,Bi),Lr(this.outputBuffer.texture,Bi),this.inputBuffer.dispose(),this.outputBuffer.dispose()),n.autoClear=!1,this.setSize(e.width,e.height);for(const s of this.passes)s.initialize(n,t,i)}}replaceRenderer(n,e=!0){const t=this.renderer,i=t.domElement.parentNode;return this.setRenderer(n),e&&i!==null&&(i.removeChild(t.domElement),i.appendChild(n.domElement)),t}createDepthTexture(){const n=this.depthTexture=new Tp;return this.inputBuffer.depthTexture=n,this.inputBuffer.dispose(),this.inputBuffer.stencilBuffer?(n.format=zh,n.type=ul):n.type=ca,n}deleteDepthTexture(){if(this.depthTexture!==null){this.depthTexture.dispose(),this.depthTexture=null,this.inputBuffer.depthTexture=null,this.inputBuffer.dispose();for(const n of this.passes)n.setDepthTexture(null)}}createBuffer(n,e,t,i){const s=this.renderer,r=s===null?new ie:s.getDrawingBufferSize(new ie),o={minFilter:St,magFilter:St,stencilBuffer:e,depthBuffer:n,type:t},a=new Zt(r.width,r.height,o);return i>0&&(a.ignoreDepthForMultisampleCopy=!1,a.samples=i),t===gi&&Cl(s)===Bi&&Lr(a.texture,Bi),a.texture.name="EffectComposer.Buffer",a.texture.generateMipmaps=!1,a}setMainScene(n){for(const e of this.passes)e.mainScene=n}setMainCamera(n){for(const e of this.passes)e.mainCamera=n}addPass(n,e){const t=this.passes,i=this.renderer,s=i.getDrawingBufferSize(new ie),r=i.getContext().getContextAttributes().alpha,o=this.inputBuffer.texture.type;if(n.setRenderer(i),n.setSize(s.width,s.height),n.initialize(i,r,o),this.autoRenderToScreen&&(t.length>0&&(t[t.length-1].renderToScreen=!1),n.renderToScreen&&(this.autoRenderToScreen=!1)),e!==void 0?t.splice(e,0,n):t.push(n),this.autoRenderToScreen&&(t[t.length-1].renderToScreen=!0),n.needsDepthTexture||this.depthTexture!==null)if(this.depthTexture===null){const a=this.createDepthTexture();for(n of t)n.setDepthTexture(a)}else n.setDepthTexture(this.depthTexture)}removePass(n){const e=this.passes,t=e.indexOf(n);if(t!==-1&&e.splice(t,1).length>0){if(this.depthTexture!==null){const r=(a,c)=>a||c.needsDepthTexture;e.reduce(r,!1)||(n.getDepthTexture()===this.depthTexture&&n.setDepthTexture(null),this.deleteDepthTexture())}this.autoRenderToScreen&&t===e.length&&(n.renderToScreen=!1,e.length>0&&(e[e.length-1].renderToScreen=!0))}}removeAllPasses(){const n=this.passes;this.deleteDepthTexture(),n.length>0&&(this.autoRenderToScreen&&(n[n.length-1].renderToScreen=!1),this.passes=[])}render(n){const e=this.renderer,t=this.copyPass;let i=this.inputBuffer,s=this.outputBuffer,r=!1,o,a,c;n===void 0&&(this.timer.update(),n=this.timer.delta);for(const l of this.passes)l.enabled&&(l.render(e,i,s,n,r),l.needsSwap&&(r&&(t.renderToScreen=l.renderToScreen,o=e.getContext(),a=e.state.buffers.stencil,a.setFunc(o.NOTEQUAL,1,4294967295),t.render(e,i,s,n,r),a.setFunc(o.EQUAL,1,4294967295)),c=i,i=s,s=c),l instanceof K9?r=!0:l instanceof q9&&(r=!1))}setSize(n,e,t){const i=this.renderer,s=i.getSize(new ie);(n===void 0||e===void 0)&&(n=s.width,e=s.height),(s.width!==n||s.height!==e)&&i.setSize(n,e,t);const r=i.getDrawingBufferSize(new ie);this.inputBuffer.setSize(r.width,r.height),this.outputBuffer.setSize(r.width,r.height);for(const o of this.passes)o.setSize(r.width,r.height)}reset(){const n=this.timer.autoReset;this.dispose(),this.autoRenderToScreen=!0,this.timer.autoReset=n}dispose(){for(const n of this.passes)n.dispose();this.passes=[],this.inputBuffer!==null&&this.inputBuffer.dispose(),this.outputBuffer!==null&&this.outputBuffer.dispose(),this.deleteDepthTexture(),this.copyPass.dispose(),this.timer.dispose()}},i6=class{constructor(){this.shaderParts=new Map([[mi.FRAGMENT_HEAD,null],[mi.FRAGMENT_MAIN_UV,null],[mi.FRAGMENT_MAIN_IMAGE,null],[mi.VERTEX_HEAD,null],[mi.VERTEX_MAIN_SUPPORT,null]]),this.defines=new Map,this.uniforms=new Map,this.blendModes=new Map,this.extensions=new Set,this.attributes=no.NONE,this.varyings=new Set,this.uvTransformation=!1,this.readDepth=!1,this.colorSpace=rx}},vS=!1,SB=class{constructor(n=null){this.originalMaterials=new Map,this.material=null,this.materials=null,this.materialsBackSide=null,this.materialsDoubleSide=null,this.materialsFlatShaded=null,this.materialsFlatShadedBackSide=null,this.materialsFlatShadedDoubleSide=null,this.setMaterial(n),this.meshCount=0,this.replaceMaterial=e=>{if(e.isMesh){let t;if(e.material.flatShading)switch(e.material.side){case Ai:t=this.materialsFlatShadedDoubleSide;break;case mn:t=this.materialsFlatShadedBackSide;break;default:t=this.materialsFlatShaded;break}else switch(e.material.side){case Ai:t=this.materialsDoubleSide;break;case mn:t=this.materialsBackSide;break;default:t=this.materials;break}this.originalMaterials.set(e,e.material),e.isSkinnedMesh?e.material=t[2]:e.isInstancedMesh?e.material=t[1]:e.material=t[0],++this.meshCount}}}cloneMaterial(n){if(!(n instanceof Et))return n.clone();const e=n.uniforms,t=new Map;for(const s in e){const r=e[s].value;r.isRenderTargetTexture&&(e[s].value=null,t.set(s,r))}const i=n.clone();for(const s of t)e[s[0]].value=s[1],i.uniforms[s[0]].value=s[1];return i}setMaterial(n){if(this.disposeMaterials(),this.material=n,n!==null){const e=this.materials=[this.cloneMaterial(n),this.cloneMaterial(n),this.cloneMaterial(n)];for(const t of e)t.uniforms=Object.assign({},n.uniforms),t.side=Es;e[2].skinning=!0,this.materialsBackSide=e.map(t=>{const i=this.cloneMaterial(t);return i.uniforms=Object.assign({},n.uniforms),i.side=mn,i}),this.materialsDoubleSide=e.map(t=>{const i=this.cloneMaterial(t);return i.uniforms=Object.assign({},n.uniforms),i.side=Ai,i}),this.materialsFlatShaded=e.map(t=>{const i=this.cloneMaterial(t);return i.uniforms=Object.assign({},n.uniforms),i.flatShading=!0,i}),this.materialsFlatShadedBackSide=e.map(t=>{const i=this.cloneMaterial(t);return i.uniforms=Object.assign({},n.uniforms),i.flatShading=!0,i.side=mn,i}),this.materialsFlatShadedDoubleSide=e.map(t=>{const i=this.cloneMaterial(t);return i.uniforms=Object.assign({},n.uniforms),i.flatShading=!0,i.side=Ai,i})}}render(n,e,t){const i=n.shadowMap.enabled;if(n.shadowMap.enabled=!1,vS){const s=this.originalMaterials;this.meshCount=0,e.traverse(this.replaceMaterial),n.render(e,t);for(const r of s)r[0].material=r[1];this.meshCount!==s.size&&s.clear()}else{const s=e.overrideMaterial;e.overrideMaterial=this.material,n.render(e,t),e.overrideMaterial=s}n.shadowMap.enabled=i}disposeMaterials(){if(this.material!==null){const n=this.materials.concat(this.materialsBackSide).concat(this.materialsDoubleSide).concat(this.materialsFlatShaded).concat(this.materialsFlatShadedBackSide).concat(this.materialsFlatShadedDoubleSide);for(const e of n)e.dispose()}}dispose(){this.originalMaterials.clear(),this.disposeMaterials()}static get workaroundEnabled(){return vS}static set workaroundEnabled(n){vS=n}},eh=-1,Si=class extends ls{constructor(n,e=eh,t=eh,i=1){super(),this.resizable=n,this.baseSize=new ie(1,1),this.preferredSize=new ie(e,t),this.target=this.preferredSize,this.s=i,this.effectiveSize=new ie,this.addEventListener("change",()=>this.updateEffectiveSize()),this.updateEffectiveSize()}updateEffectiveSize(){const n=this.baseSize,e=this.preferredSize,t=this.effectiveSize,i=this.scale;e.width!==eh?t.width=e.width:e.height!==eh?t.width=Math.round(e.height*(n.width/Math.max(n.height,1))):t.width=Math.round(n.width*i),e.height!==eh?t.height=e.height:e.width!==eh?t.height=Math.round(e.width/Math.max(n.width/Math.max(n.height,1),1)):t.height=Math.round(n.height*i)}get width(){return this.effectiveSize.width}set width(n){this.preferredWidth=n}get height(){return this.effectiveSize.height}set height(n){this.preferredHeight=n}getWidth(){return this.width}getHeight(){return this.height}get scale(){return this.s}set scale(n){this.s!==n&&(this.s=n,this.preferredSize.setScalar(eh),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getScale(){return this.scale}setScale(n){this.scale=n}get baseWidth(){return this.baseSize.width}set baseWidth(n){this.baseSize.width!==n&&(this.baseSize.width=n,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getBaseWidth(){return this.baseWidth}setBaseWidth(n){this.baseWidth=n}get baseHeight(){return this.baseSize.height}set baseHeight(n){this.baseSize.height!==n&&(this.baseSize.height=n,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getBaseHeight(){return this.baseHeight}setBaseHeight(n){this.baseHeight=n}setBaseSize(n,e){(this.baseSize.width!==n||this.baseSize.height!==e)&&(this.baseSize.set(n,e),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}get preferredWidth(){return this.preferredSize.width}set preferredWidth(n){this.preferredSize.width!==n&&(this.preferredSize.width=n,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getPreferredWidth(){return this.preferredWidth}setPreferredWidth(n){this.preferredWidth=n}get preferredHeight(){return this.preferredSize.height}set preferredHeight(n){this.preferredSize.height!==n&&(this.preferredSize.height=n,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getPreferredHeight(){return this.preferredHeight}setPreferredHeight(n){this.preferredHeight=n}setPreferredSize(n,e){(this.preferredSize.width!==n||this.preferredSize.height!==e)&&(this.preferredSize.set(n,e),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}copy(n){this.s=n.scale,this.baseSize.set(n.baseWidth,n.baseHeight),this.preferredSize.set(n.preferredWidth,n.preferredHeight),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height)}static get AUTO_SIZE(){return eh}},n6=class extends Set{constructor(n,e=10){super(),this.l=e,this.exclusive=!1,n!==void 0&&this.set(n)}get layer(){return this.l}set layer(n){const e=this.l;for(const t of this)t.layers.disable(e),t.layers.enable(n);this.l=n}getLayer(){return this.layer}setLayer(n){this.layer=n}isExclusive(){return this.exclusive}setExclusive(n){this.exclusive=n}clear(){const n=this.layer;for(const e of this)e.layers.disable(n);return super.clear()}set(n){this.clear();for(const e of n)this.add(e);return this}indexOf(n){return this.has(n)?0:-1}add(n){return this.exclusive?n.layers.set(this.layer):n.layers.enable(this.layer),super.add(n)}delete(n){return this.has(n)&&n.layers.disable(this.layer),super.delete(n)}toggle(n){let e;return this.has(n)?(this.delete(n),e=!1):(this.add(n),e=!0),e}setVisible(n){for(const e of this)n?e.layers.enable(0):e.layers.disable(0);return this}},s6="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,x+y,opacity);}",r6="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,y,min(y.a,opacity));}",o6="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,(x+y)*0.5,opacity);}",a6="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 xHSL=RGBToHSL(x.rgb);vec3 yHSL=RGBToHSL(y.rgb);vec3 z=HSLToRGB(vec3(yHSL.rg,xHSL.b));return vec4(mix(x.rgb,z,opacity),y.a);}",c6="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=mix(step(0.0,y)*(1.0-min(vec4(1.0),(1.0-x)/y)),vec4(1.0),step(1.0,x));return mix(x,z,opacity);}",l6="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=step(0.0,x)*mix(min(vec4(1.0),x/max(1.0-y,1e-9)),vec4(1.0),step(1.0,y));return mix(x,z,opacity);}",h6="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,min(x,y),opacity);}",u6="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,abs(x-y),opacity);}",d6="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,x/max(y,1e-12),opacity);}",f6="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,(x+y-2.0*x*y),opacity);}",p6="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 a=min(x,1.0),b=min(y,1.0);vec4 z=mix(2.0*a*b,1.0-2.0*(1.0-a)*(1.0-b),step(0.5,y));return mix(x,z,opacity);}",m6="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,step(1.0,x+y),opacity);}",g6="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 xHSL=RGBToHSL(x.rgb);vec3 yHSL=RGBToHSL(y.rgb);vec3 z=HSLToRGB(vec3(yHSL.r,xHSL.gb));return vec4(mix(x.rgb,z,opacity),y.a);}",A6="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,1.0-y,opacity);}",v6="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,y*(1.0-x),opacity);}",y6="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,max(x,y),opacity);}",b6="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,clamp(y+x-1.0,0.0,1.0),opacity);}",_6="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,min(x+y,1.0),opacity);}",x6="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,clamp(2.0*y+x-1.0,0.0,1.0),opacity);}",w6="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 xHSL=RGBToHSL(x.rgb);vec3 yHSL=RGBToHSL(y.rgb);vec3 z=HSLToRGB(vec3(xHSL.rg,yHSL.b));return vec4(mix(x.rgb,z,opacity),y.a);}",S6="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,x*y,opacity);}",C6="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,1.0-abs(1.0-x-y),opacity);}",E6="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,y,opacity);}",T6="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=mix(2.0*y*x,1.0-2.0*(1.0-y)*(1.0-x),step(0.5,x));return mix(x,z,opacity);}",M6="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 y2=2.0*y;vec4 z=mix(mix(y2,x,step(0.5*x,y)),max(vec4(0.0),y2-1.0),step(x,(y2-1.0)));return mix(x,z,opacity);}",I6="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=mix(min(x*x/max(1.0-y,1e-12),1.0),y,step(1.0,y));return mix(x,z,opacity);}",R6="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 xHSL=RGBToHSL(x.rgb);vec3 yHSL=RGBToHSL(y.rgb);vec3 z=HSLToRGB(vec3(xHSL.r,yHSL.g,xHSL.b));return vec4(mix(x.rgb,z,opacity),y.a);}",P6="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,x+y-min(x*y,1.0),opacity);}",B6="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 y2=2.0*y;vec4 w=step(0.5,y);vec4 z=mix(x-(1.0-y2)*x*(1.0-x),mix(x+(y2-1.0)*(sqrt(x)-x),x+(y2-1.0)*x*((16.0*x-12.0)*x+3.0),w*(1.0-step(0.25,x))),w);return mix(x,z,opacity);}",D6="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return y;}",O6="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,max(x+y-1.0,0.0),opacity);}",k6="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=mix(max(1.0-min((1.0-x)/(2.0*y),1.0),0.0),min(x/(2.0*(1.0-y)),1.0),step(0.5,y));return mix(x,z,opacity);}",L6=new Map([[Gt.ADD,s6],[Gt.ALPHA,r6],[Gt.AVERAGE,o6],[Gt.COLOR,a6],[Gt.COLOR_BURN,c6],[Gt.COLOR_DODGE,l6],[Gt.DARKEN,h6],[Gt.DIFFERENCE,u6],[Gt.DIVIDE,d6],[Gt.DST,null],[Gt.EXCLUSION,f6],[Gt.HARD_LIGHT,p6],[Gt.HARD_MIX,m6],[Gt.HUE,g6],[Gt.INVERT,A6],[Gt.INVERT_RGB,v6],[Gt.LIGHTEN,y6],[Gt.LINEAR_BURN,b6],[Gt.LINEAR_DODGE,_6],[Gt.LINEAR_LIGHT,x6],[Gt.LUMINOSITY,w6],[Gt.MULTIPLY,S6],[Gt.NEGATION,C6],[Gt.NORMAL,E6],[Gt.OVERLAY,T6],[Gt.PIN_LIGHT,M6],[Gt.REFLECT,I6],[Gt.SATURATION,R6],[Gt.SCREEN,P6],[Gt.SOFT_LIGHT,B6],[Gt.SRC,D6],[Gt.SUBTRACT,O6],[Gt.VIVID_LIGHT,k6]]),F6=class extends ls{constructor(n,e=1){super(),this._blendFunction=n,this.opacity=new we(e)}getOpacity(){return this.opacity.value}setOpacity(n){this.opacity.value=n}get blendFunction(){return this._blendFunction}set blendFunction(n){this._blendFunction=n,this.dispatchEvent({type:"change"})}getBlendFunction(){return this.blendFunction}setBlendFunction(n){this.blendFunction=n}getShaderCode(){return L6.get(this.blendFunction)}},ya=class extends ls{constructor(n,e,{attributes:t=no.NONE,blendFunction:i=Gt.NORMAL,defines:s=new Map,uniforms:r=new Map,extensions:o=null,vertexShader:a=null}={}){super(),this.name=n,this.renderer=null,this.attributes=t,this.fragmentShader=e,this.vertexShader=a,this.defines=s,this.uniforms=r,this.extensions=o,this.blendMode=new F6(i),this.blendMode.addEventListener("change",c=>this.setChanged()),this._inputColorSpace=rx,this._outputColorSpace=RF}get inputColorSpace(){return this._inputColorSpace}set inputColorSpace(n){this._inputColorSpace=n,this.setChanged()}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(n){this._outputColorSpace=n,this.setChanged()}set mainScene(n){}set mainCamera(n){}getName(){return this.name}setRenderer(n){this.renderer=n}getDefines(){return this.defines}getUniforms(){return this.uniforms}getExtensions(){return this.extensions}getBlendMode(){return this.blendMode}getAttributes(){return this.attributes}setAttributes(n){this.attributes=n,this.setChanged()}getFragmentShader(){return this.fragmentShader}setFragmentShader(n){this.fragmentShader=n,this.setChanged()}getVertexShader(){return this.vertexShader}setVertexShader(n){this.vertexShader=n,this.setChanged()}setChanged(){this.dispatchEvent({type:"change"})}setDepthTexture(n,e=Ts){}update(n,e,t){}setSize(n,e){}initialize(n,e,t){}dispose(){for(const n of Object.keys(this)){const e=this[n];(e instanceof Zt||e instanceof Ot||e instanceof Ft||e instanceof Js)&&this[n].dispose()}}},U6=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D map;
#else
uniform lowp sampler2D map;
#endif
uniform float intensity;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec4 texel=texture2D(map,uv);outputColor=vec4(texel.rgb*intensity,texel.a);}`,u1=class extends ya{constructor({blendFunction:n=Gt.SCREEN,luminanceThreshold:e=.9,luminanceSmoothing:t=.025,mipmapBlur:i=!1,intensity:s=1,radius:r=.85,levels:o=8,kernelSize:a=Sl.LARGE,resolutionScale:c=.5,width:l=Si.AUTO_SIZE,height:h=Si.AUTO_SIZE,resolutionX:d=l,resolutionY:f=h}={}){super("BloomEffect",U6,{blendFunction:n,uniforms:new Map([["map",new we(null)],["intensity",new we(s)]])}),this.renderTarget=new Zt(1,1,{depthBuffer:!1}),this.renderTarget.texture.name="Bloom.Target",this.blurPass=new l1({kernelSize:a}),this.luminancePass=new J9({colorOutput:!0}),this.luminanceMaterial.threshold=e,this.luminanceMaterial.smoothing=t,this.mipmapBlurPass=new Z9,this.mipmapBlurPass.enabled=i,this.mipmapBlurPass.radius=r,this.mipmapBlurPass.levels=o,this.uniforms.get("map").value=i?this.mipmapBlurPass.texture:this.renderTarget.texture;const p=this.resolution=new Si(this,d,f,c);p.addEventListener("change",m=>this.setSize(p.baseWidth,p.baseHeight))}get texture(){return this.mipmapBlurPass.enabled?this.mipmapBlurPass.texture:this.renderTarget.texture}getTexture(){return this.texture}getResolution(){return this.resolution}getBlurPass(){return this.blurPass}getLuminancePass(){return this.luminancePass}get luminanceMaterial(){return this.luminancePass.fullscreenMaterial}getLuminanceMaterial(){return this.luminancePass.fullscreenMaterial}get width(){return this.resolution.width}set width(n){this.resolution.preferredWidth=n}get height(){return this.resolution.height}set height(n){this.resolution.preferredHeight=n}get dithering(){return this.blurPass.dithering}set dithering(n){this.blurPass.dithering=n}get kernelSize(){return this.blurPass.kernelSize}set kernelSize(n){this.blurPass.kernelSize=n}get distinction(){return console.warn(this.name,"distinction was removed"),1}set distinction(n){console.warn(this.name,"distinction was removed")}get intensity(){return this.uniforms.get("intensity").value}set intensity(n){this.uniforms.get("intensity").value=n}getIntensity(){return this.intensity}setIntensity(n){this.intensity=n}getResolutionScale(){return this.resolution.scale}setResolutionScale(n){this.resolution.scale=n}update(n,e,t){const i=this.renderTarget,s=this.luminancePass;s.enabled?(s.render(n,e),this.mipmapBlurPass.enabled?this.mipmapBlurPass.render(n,s.renderTarget):this.blurPass.render(n,s.renderTarget,i)):this.mipmapBlurPass.enabled?this.mipmapBlurPass.render(n,e):this.blurPass.render(n,e,i)}setSize(n,e){const t=this.resolution;t.setBaseSize(n,e),this.renderTarget.setSize(t.width,t.height),this.blurPass.resolution.copy(t),this.luminancePass.setSize(n,e),this.mipmapBlurPass.setSize(n,e)}initialize(n,e,t){this.blurPass.initialize(n,e,t),this.luminancePass.initialize(n,e,t),this.mipmapBlurPass.initialize(n,e,t),t!==void 0&&(this.renderTarget.texture.type=t,Cl(n)===Bi&&Lr(this.renderTarget.texture,Bi))}},N6="uniform float brightness;uniform float contrast;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec3 color=inputColor.rgb+vec3(brightness-0.5);if(contrast>0.0){color/=vec3(1.0-contrast);}else{color*=vec3(1.0+contrast);}outputColor=vec4(color+vec3(0.5),inputColor.a);}",UF=class extends ya{constructor({blendFunction:n=Gt.SRC,brightness:e=0,contrast:t=0}={}){super("BrightnessContrastEffect",N6,{blendFunction:n,uniforms:new Map([["brightness",new we(e)],["contrast",new we(t)]])}),this.inputColorSpace=Bi}get brightness(){return this.uniforms.get("brightness").value}set brightness(n){this.uniforms.get("brightness").value=n}getBrightness(){return this.brightness}setBrightness(n){this.brightness=n}get contrast(){return this.uniforms.get("contrast").value}set contrast(n){this.uniforms.get("contrast").value=n}getContrast(){return this.contrast}setContrast(n){this.contrast=n}},z6=`#ifdef RADIAL_MODULATION
uniform float modulationOffset;
#endif
varying float vActive;varying vec2 vUvR;varying vec2 vUvB;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec2 ra=inputColor.ra;vec2 ba=inputColor.ba;
#ifdef RADIAL_MODULATION
const vec2 center=vec2(0.5);float d=distance(uv,center)*2.0;d=max(d-modulationOffset,0.0);if(vActive>0.0&&d>0.0){ra=texture2D(inputBuffer,mix(uv,vUvR,d)).ra;ba=texture2D(inputBuffer,mix(uv,vUvB,d)).ba;}
#else
if(vActive>0.0){ra=texture2D(inputBuffer,vUvR).ra;ba=texture2D(inputBuffer,vUvB).ba;}
#endif
outputColor=vec4(ra.x,inputColor.g,ba.x,max(max(ra.y,ba.y),inputColor.a));}`,G6="uniform vec2 offset;varying float vActive;varying vec2 vUvR;varying vec2 vUvB;void mainSupport(const in vec2 uv){vec2 shift=offset*vec2(1.0,aspect);vActive=(shift.x!=0.0||shift.y!=0.0)?1.0:0.0;vUvR=uv+shift;vUvB=uv-shift;}",NF=class extends ya{constructor({offset:n=new ie(.001,5e-4),radialModulation:e=!1,modulationOffset:t=.15}={}){super("ChromaticAberrationEffect",z6,{vertexShader:G6,attributes:no.CONVOLUTION,uniforms:new Map([["offset",new we(n)],["modulationOffset",new we(t)]])}),this.radialModulation=e}get offset(){return this.uniforms.get("offset").value}set offset(n){this.uniforms.get("offset").value=n}get radialModulation(){return this.defines.has("RADIAL_MODULATION")}set radialModulation(n){n?this.defines.set("RADIAL_MODULATION","1"):this.defines.delete("RADIAL_MODULATION"),this.setChanged()}get modulationOffset(){return this.uniforms.get("modulationOffset").value}set modulationOffset(n){this.uniforms.get("modulationOffset").value=n}getOffset(){return this.offset}setOffset(n){this.offset=n}},V6=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D nearColorBuffer;uniform mediump sampler2D farColorBuffer;
#else
uniform lowp sampler2D nearColorBuffer;uniform lowp sampler2D farColorBuffer;
#endif
uniform lowp sampler2D nearCoCBuffer;uniform lowp sampler2D farCoCBuffer;uniform float scale;void mainImage(const in vec4 inputColor,const in vec2 uv,const in float depth,out vec4 outputColor){vec4 colorNear=texture2D(nearColorBuffer,uv);vec4 colorFar=texture2D(farColorBuffer,uv);
#if MASK_FUNCTION == 1
vec2 cocNearFar=vec2(texture2D(nearCoCBuffer,uv).r,colorFar.a);cocNearFar.x=min(cocNearFar.x*scale,1.0);
#else
vec2 cocNearFar=vec2(texture2D(nearCoCBuffer,uv).r,texture2D(farCoCBuffer,uv).g);cocNearFar=min(cocNearFar*scale,1.0);
#endif
vec4 result=inputColor*(1.0-cocNearFar.y)+colorFar;result=mix(result,colorNear,cocNearFar.x);outputColor=result;}`,zF=class extends ya{constructor(n,{blendFunction:e,worldFocusDistance:t,worldFocusRange:i,focusDistance:s=0,focalLength:r=.1,focusRange:o=r,bokehScale:a=1,resolutionScale:c=1,width:l=Si.AUTO_SIZE,height:h=Si.AUTO_SIZE,resolutionX:d=l,resolutionY:f=h}={}){super("DepthOfFieldEffect",V6,{blendFunction:e,attributes:no.DEPTH,uniforms:new Map([["nearColorBuffer",new we(null)],["farColorBuffer",new we(null)],["nearCoCBuffer",new we(null)],["farCoCBuffer",new we(null)],["scale",new we(1)]])}),this.camera=n,this.renderTarget=new Zt(1,1,{depthBuffer:!1}),this.renderTarget.texture.name="DoF.Intermediate",this.renderTargetMasked=this.renderTarget.clone(),this.renderTargetMasked.texture.name="DoF.Masked.Far",this.renderTargetNear=this.renderTarget.clone(),this.renderTargetNear.texture.name="DoF.Bokeh.Near",this.uniforms.get("nearColorBuffer").value=this.renderTargetNear.texture,this.renderTargetFar=this.renderTarget.clone(),this.renderTargetFar.texture.name="DoF.Bokeh.Far",this.uniforms.get("farColorBuffer").value=this.renderTargetFar.texture,this.renderTargetCoC=this.renderTarget.clone(),this.renderTargetCoC.texture.name="DoF.CoC",this.uniforms.get("farCoCBuffer").value=this.renderTargetCoC.texture,this.renderTargetCoCBlurred=this.renderTargetCoC.clone(),this.renderTargetCoCBlurred.texture.name="DoF.CoC.Blurred",this.uniforms.get("nearCoCBuffer").value=this.renderTargetCoCBlurred.texture,this.cocPass=new ja(new l9(n));const p=this.cocMaterial;p.focusDistance=s,p.focusRange=o,t!==void 0&&(p.worldFocusDistance=t),i!==void 0&&(p.worldFocusRange=i),this.blurPass=new l1({resolutionScale:c,resolutionX:d,resolutionY:f,kernelSize:Sl.MEDIUM}),this.maskPass=new ja(new P9(this.renderTargetCoC.texture));const m=this.maskPass.fullscreenMaterial;m.colorChannel=IF.GREEN,this.maskFunction=PF.MULTIPLY_RGB,this.bokehNearBasePass=new ja(new Py(!1,!0)),this.bokehNearBasePass.fullscreenMaterial.cocBuffer=this.renderTargetCoCBlurred.texture,this.bokehNearFillPass=new ja(new Py(!0,!0)),this.bokehNearFillPass.fullscreenMaterial.cocBuffer=this.renderTargetCoCBlurred.texture,this.bokehFarBasePass=new ja(new Py(!1,!1)),this.bokehFarBasePass.fullscreenMaterial.cocBuffer=this.renderTargetCoC.texture,this.bokehFarFillPass=new ja(new Py(!0,!1)),this.bokehFarFillPass.fullscreenMaterial.cocBuffer=this.renderTargetCoC.texture,this.target=null;const g=this.resolution=new Si(this,d,f,c);g.addEventListener("change",y=>this.setSize(g.baseWidth,g.baseHeight)),this.bokehScale=a}set mainCamera(n){this.camera=n,this.cocMaterial.copyCameraSettings(n)}get cocTexture(){return this.renderTargetCoC.texture}get maskFunction(){return this.maskPass.fullscreenMaterial.maskFunction}set maskFunction(n){this.maskFunction!==n&&(this.defines.set("MASK_FUNCTION",n.toFixed(0)),this.maskPass.fullscreenMaterial.maskFunction=n,this.setChanged())}get cocMaterial(){return this.cocPass.fullscreenMaterial}get circleOfConfusionMaterial(){return this.cocMaterial}getCircleOfConfusionMaterial(){return this.cocMaterial}getBlurPass(){return this.blurPass}getResolution(){return this.resolution}get bokehScale(){return this.uniforms.get("scale").value}set bokehScale(n){this.bokehNearBasePass.fullscreenMaterial.scale=n,this.bokehNearFillPass.fullscreenMaterial.scale=n,this.bokehFarBasePass.fullscreenMaterial.scale=n,this.bokehFarFillPass.fullscreenMaterial.scale=n,this.maskPass.fullscreenMaterial.strength=n,this.uniforms.get("scale").value=n}getBokehScale(){return this.bokehScale}setBokehScale(n){this.bokehScale=n}getTarget(){return this.target}setTarget(n){this.target=n}calculateFocusDistance(n){const e=this.camera,t=e.position.distanceTo(n);return zu(-t,e.near,e.far)}setDepthTexture(n,e=Ts){this.cocMaterial.depthBuffer=n,this.cocMaterial.depthPacking=e}update(n,e,t){const i=this.renderTarget,s=this.renderTargetCoC,r=this.renderTargetCoCBlurred,o=this.renderTargetMasked;if(this.target!==null){const a=this.calculateFocusDistance(this.target);this.cocMaterial.focusDistance=a}this.cocPass.render(n,null,s),this.blurPass.render(n,s,r),this.maskPass.render(n,e,o),this.bokehFarBasePass.render(n,o,i),this.bokehFarFillPass.render(n,i,this.renderTargetFar),this.bokehNearBasePass.render(n,e,i),this.bokehNearFillPass.render(n,i,this.renderTargetNear)}setSize(n,e){const t=this.resolution;t.setBaseSize(n,e);const i=t.width,s=t.height;this.cocPass.setSize(n,e),this.blurPass.setSize(n,e),this.maskPass.setSize(n,e),this.renderTargetFar.setSize(n,e),this.renderTargetCoC.setSize(n,e),this.renderTargetMasked.setSize(n,e),this.renderTarget.setSize(i,s),this.renderTargetNear.setSize(i,s),this.renderTargetCoCBlurred.setSize(i,s),this.bokehNearBasePass.fullscreenMaterial.setSize(n,e),this.bokehNearFillPass.fullscreenMaterial.setSize(n,e),this.bokehFarBasePass.fullscreenMaterial.setSize(n,e),this.bokehFarFillPass.fullscreenMaterial.setSize(n,e)}initialize(n,e,t){this.cocPass.initialize(n,e,t),this.maskPass.initialize(n,e,t),this.bokehNearBasePass.initialize(n,e,t),this.bokehNearFillPass.initialize(n,e,t),this.bokehFarBasePass.initialize(n,e,t),this.bokehFarFillPass.initialize(n,e,t),this.blurPass.initialize(n,e,gi),n.capabilities.logarithmicDepthBuffer&&(this.cocPass.fullscreenMaterial.defines.LOG_DEPTH="1"),t!==void 0&&(this.renderTarget.texture.type=t,this.renderTargetNear.texture.type=t,this.renderTargetFar.texture.type=t,this.renderTargetMasked.texture.type=t,Cl(n)===Bi&&(Lr(this.renderTarget.texture,Bi),Lr(this.renderTargetNear.texture,Bi),Lr(this.renderTargetFar.texture,Bi),Lr(this.renderTargetMasked.texture,Bi)))}};function H6(n,e,t){const i=new Map([[S_,1],[tc,1],[Sh,2],[xi,4]]);let s;if(i.has(e)||console.error("Invalid noise texture format"),t===gi){s=new Uint8Array(n*i.get(e));for(let r=0,o=s.length;r<o;++r)s[r]=Math.random()*255+.5}else{s=new Float32Array(n*i.get(e));for(let r=0,o=s.length;r<o;++r)s[r]=Math.random()}return s}var Q6=class extends io{constructor(n,e,t=S_,i=gi){super(H6(n*e,t,i),n,e,t,i),this.needsUpdate=!0}},j6="uniform vec3 hue;uniform float saturation;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec3 color=vec3(dot(inputColor.rgb,hue.xyz),dot(inputColor.rgb,hue.zxy),dot(inputColor.rgb,hue.yzx));float average=(color.r+color.g+color.b)/3.0;vec3 diff=average-color;if(saturation>0.0){color+=diff*(1.0-1.0/(1.001-saturation));}else{color+=diff*-saturation;}outputColor=vec4(min(color,1.0),inputColor.a);}",GF=class extends ya{constructor({blendFunction:n=Gt.SRC,hue:e=0,saturation:t=0}={}){super("HueSaturationEffect",j6,{blendFunction:n,uniforms:new Map([["hue",new we(new w)],["saturation",new we(t)]])}),this.hue=e}get saturation(){return this.uniforms.get("saturation").value}set saturation(n){this.uniforms.get("saturation").value=n}getSaturation(){return this.saturation}setSaturation(n){this.saturation=n}get hue(){const n=this.uniforms.get("hue").value;return Math.acos((n.x*3-1)/2)}set hue(n){const e=Math.sin(n),t=Math.cos(n);this.uniforms.get("hue").value.set((2*t+1)/3,(-Math.sqrt(3)*e-t+1)/3,(Math.sqrt(3)*e-t+1)/3)}getHue(){return this.hue}setHue(n){this.hue=n}},W6="uniform bool active;uniform vec4 d;void mainUv(inout vec2 uv){if(active){uv=d.xy*(floor(uv*d.zw)+0.5);}}",VF=class extends ya{constructor(e=30){super("PixelationEffect",W6,{uniforms:new Map([["active",new we(!1)],["d",new we(new tt)]])}),this.resolution=new ie,this._granularity=0,this.granularity=e}get granularity(){return this._granularity}set granularity(e){let t=Math.floor(e);t%2>0&&(t+=1),this._granularity=t,this.uniforms.get("active").value=t>0,this.setSize(this.resolution.width,this.resolution.height)}getGranularity(){return this.granularity}setGranularity(e){this.granularity=e}setSize(e,t){const i=this.resolution;i.set(e,t);const s=this.granularity,r=s/i.x,o=s/i.y;this.uniforms.get("d").value.set(r,o,1/r,1/o)}},HF=class extends u1{constructor(n,e,t){super(t),this.setAttributes(this.getAttributes()|no.DEPTH),this.camera=e,this.depthPass=new X9(n,e),this.clearPass=new ox(!0,!1,!1),this.clearPass.overrideClearColor=new ye(0),this.depthMaskPass=new ja(new v9);const i=this.depthMaskMaterial;i.copyCameraSettings(e),i.depthBuffer1=this.depthPass.texture,i.depthPacking1=T_,i.depthMode=hp,this.renderTargetMasked=new Zt(1,1,{depthBuffer:!1}),this.renderTargetMasked.texture.name="Bloom.Masked",this.selection=new n6,this.selection.layer=11,this._inverted=!1,this._ignoreBackground=!1}set mainScene(n){this.depthPass.mainScene=n}set mainCamera(n){this.camera=n,this.depthPass.mainCamera=n,this.depthMaskMaterial.copyCameraSettings(n)}getSelection(){return this.selection}get depthMaskMaterial(){return this.depthMaskPass.fullscreenMaterial}get inverted(){return this._inverted}set inverted(n){this._inverted=n,this.depthMaskMaterial.depthMode=n?BA:hp}isInverted(){return this.inverted}setInverted(n){this.inverted=n}get ignoreBackground(){return this._ignoreBackground}set ignoreBackground(n){this._ignoreBackground=n,this.depthMaskMaterial.maxDepthStrategy=n?hg.DISCARD_MAX_DEPTH:hg.KEEP_MAX_DEPTH}isBackgroundDisabled(){return this.ignoreBackground}setBackgroundDisabled(n){this.ignoreBackground=n}setDepthTexture(n,e=Ts){this.depthMaskMaterial.depthBuffer0=n,this.depthMaskMaterial.depthPacking0=e}update(n,e,t){const i=this.camera,s=this.selection,r=this.inverted;let o=e;if(this.ignoreBackground||!r||s.size>0){const a=i.layers.mask;i.layers.set(s.layer),this.depthPass.render(n),i.layers.mask=a,o=this.renderTargetMasked,this.clearPass.render(n,o),this.depthMaskPass.render(n,e,o)}super.update(n,o,t)}setSize(n,e){super.setSize(n,e),this.renderTargetMasked.setSize(n,e),this.depthPass.setSize(n,e)}initialize(n,e,t){super.initialize(n,e,t),this.clearPass.initialize(n,e,t),this.depthPass.initialize(n,e,t),this.depthMaskPass.initialize(n,e,t),n.capabilities.logarithmicDepthBuffer&&(this.depthMaskPass.fullscreenMaterial.defines.LOG_DEPTH="1"),t!==void 0&&(this.renderTargetMasked.texture.type=t,Cl(n)===Bi&&Lr(this.renderTargetMasked.texture,Bi))}},CB="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAAAQCAYAAACm53kpAAAAeElEQVRYR+2XSwqAMAxEJ168ePEqwRSKhIIiuHjJqiU0gWE+1CQdApcVAMUAuARaMGCX1MIL/Ow13++9lW2s3mW9MWvsnWc/2fvGygwPAN4E8QzAA4CXAB6AHjG4JTHYI1ey3pcx6FHnEfhLDOIBKAmUBK6/ANUDTlROXAHd9EC1AAAAAElFTkSuQmCC",EB="data:image/png;base64,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",q6="uniform sampler2D weightMap;varying vec2 vOffset0;varying vec2 vOffset1;void movec(const in bvec2 c,inout vec2 variable,const in vec2 value){if(c.x){variable.x=value.x;}if(c.y){variable.y=value.y;}}void movec(const in bvec4 c,inout vec4 variable,const in vec4 value){movec(c.xy,variable.xy,value.xy);movec(c.zw,variable.zw,value.zw);}void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec4 a;a.x=texture2D(weightMap,vOffset0).a;a.y=texture2D(weightMap,vOffset1).g;a.wz=texture2D(weightMap,uv).rb;vec4 color=inputColor;if(dot(a,vec4(1.0))>=1e-5){bool h=max(a.x,a.z)>max(a.y,a.w);vec4 blendingOffset=vec4(0.0,a.y,0.0,a.w);vec2 blendingWeight=a.yw;movec(bvec4(h),blendingOffset,vec4(a.x,0.0,a.z,0.0));movec(bvec2(h),blendingWeight,a.xz);blendingWeight/=dot(blendingWeight,vec2(1.0));vec4 blendingCoord=blendingOffset*vec4(texelSize,-texelSize)+uv.xyxy;color=blendingWeight.x*texture2D(inputBuffer,blendingCoord.xy);color+=blendingWeight.y*texture2D(inputBuffer,blendingCoord.zw);}outputColor=color;}",X6="varying vec2 vOffset0;varying vec2 vOffset1;void mainSupport(const in vec2 uv){vOffset0=uv+texelSize*vec2(1.0,0.0);vOffset1=uv+texelSize*vec2(0.0,1.0);}",Y6=class extends ya{constructor({blendFunction:n=Gt.SRC,preset:e=yf.MEDIUM,edgeDetectionMode:t=a1.COLOR,predicationMode:i=r9.DISABLED}={}){super("SMAAEffect",q6,{vertexShader:X6,blendFunction:n,attributes:no.CONVOLUTION|no.DEPTH,uniforms:new Map([["weightMap",new we(null)]])});let s,r;arguments.length>1&&(s=arguments[0],r=arguments[1],arguments.length>2&&(e=arguments[2]),arguments.length>3&&(t=arguments[3])),this.renderTargetEdges=new Zt(1,1,{depthBuffer:!1}),this.renderTargetEdges.texture.name="SMAA.Edges",this.renderTargetWeights=this.renderTargetEdges.clone(),this.renderTargetWeights.texture.name="SMAA.Weights",this.uniforms.get("weightMap").value=this.renderTargetWeights.texture,this.clearPass=new ox(!0,!1,!1),this.clearPass.overrideClearColor=new ye(0),this.clearPass.overrideClearAlpha=1,this.edgeDetectionPass=new ja(new S9),this.edgeDetectionMaterial.edgeDetectionMode=t,this.edgeDetectionMaterial.predicationMode=i,this.weightsPass=new ja(new O9);const o=new X_;o.onLoad=()=>{const a=new Ft(s);a.name="SMAA.Search",a.magFilter=Nt,a.minFilter=Nt,a.generateMipmaps=!1,a.needsUpdate=!0,a.flipY=!0,this.weightsMaterial.searchTexture=a;const c=new Ft(r);c.name="SMAA.Area",c.magFilter=St,c.minFilter=St,c.generateMipmaps=!1,c.needsUpdate=!0,c.flipY=!1,this.weightsMaterial.areaTexture=c,this.dispatchEvent({type:"load"})},o.itemStart("search"),o.itemStart("area"),s!==void 0&&r!==void 0?(o.itemEnd("search"),o.itemEnd("area")):typeof Image<"u"&&(s=new Image,r=new Image,s.addEventListener("load",()=>o.itemEnd("search")),r.addEventListener("load",()=>o.itemEnd("area")),s.src=CB,r.src=EB),this.applyPreset(e)}get edgesTexture(){return this.renderTargetEdges.texture}getEdgesTexture(){return this.edgesTexture}get weightsTexture(){return this.renderTargetWeights.texture}getWeightsTexture(){return this.weightsTexture}get edgeDetectionMaterial(){return this.edgeDetectionPass.fullscreenMaterial}get colorEdgesMaterial(){return this.edgeDetectionMaterial}getEdgeDetectionMaterial(){return this.edgeDetectionMaterial}get weightsMaterial(){return this.weightsPass.fullscreenMaterial}getWeightsMaterial(){return this.weightsMaterial}setEdgeDetectionThreshold(n){this.edgeDetectionMaterial.edgeDetectionThreshold=n}setOrthogonalSearchSteps(n){this.weightsMaterial.orthogonalSearchSteps=n}applyPreset(n){const e=this.edgeDetectionMaterial,t=this.weightsMaterial;switch(n){case yf.LOW:e.edgeDetectionThreshold=.15,t.orthogonalSearchSteps=4,t.diagonalDetection=!1,t.cornerDetection=!1;break;case yf.MEDIUM:e.edgeDetectionThreshold=.1,t.orthogonalSearchSteps=8,t.diagonalDetection=!1,t.cornerDetection=!1;break;case yf.HIGH:e.edgeDetectionThreshold=.1,t.orthogonalSearchSteps=16,t.diagonalSearchSteps=8,t.cornerRounding=25,t.diagonalDetection=!0,t.cornerDetection=!0;break;case yf.ULTRA:e.edgeDetectionThreshold=.05,t.orthogonalSearchSteps=32,t.diagonalSearchSteps=16,t.cornerRounding=25,t.diagonalDetection=!0,t.cornerDetection=!0;break}}setDepthTexture(n,e=Ts){this.edgeDetectionMaterial.depthBuffer=n,this.edgeDetectionMaterial.depthPacking=e}update(n,e,t){this.clearPass.render(n,this.renderTargetEdges),this.edgeDetectionPass.render(n,e,this.renderTargetEdges),this.weightsPass.render(n,this.renderTargetEdges,this.renderTargetWeights)}setSize(n,e){this.edgeDetectionMaterial.setSize(n,e),this.weightsMaterial.setSize(n,e),this.renderTargetEdges.setSize(n,e),this.renderTargetWeights.setSize(n,e)}dispose(){const{searchTexture:n,areaTexture:e}=this.weightsMaterial;n!==null&&e!==null&&(n.dispose(),e.dispose()),super.dispose()}static get searchImageDataURL(){return CB}static get areaImageDataURL(){return EB}},J6=`uniform lowp sampler2D aoBuffer;uniform float luminanceInfluence;uniform float intensity;
#if THREE_REVISION < 143
#define luminance(v) linearToRelativeLuminance(v)
#endif
#if defined(DEPTH_AWARE_UPSAMPLING) && defined(NORMAL_DEPTH)
#ifdef GL_FRAGMENT_PRECISION_HIGH
uniform highp sampler2D normalDepthBuffer;
#else
uniform mediump sampler2D normalDepthBuffer;
#endif
#endif
#ifdef COLORIZE
uniform vec3 color;
#endif
void mainImage(const in vec4 inputColor,const in vec2 uv,const in float depth,out vec4 outputColor){float aoLinear=texture2D(aoBuffer,uv).r;
#if defined(DEPTH_AWARE_UPSAMPLING) && defined(NORMAL_DEPTH) && __VERSION__ == 300
vec4 normalDepth[4];normalDepth[0]=textureOffset(normalDepthBuffer,uv,ivec2(0,0));normalDepth[1]=textureOffset(normalDepthBuffer,uv,ivec2(0,1));normalDepth[2]=textureOffset(normalDepthBuffer,uv,ivec2(1,0));normalDepth[3]=textureOffset(normalDepthBuffer,uv,ivec2(1,1));float dot01=dot(normalDepth[0].rgb,normalDepth[1].rgb);float dot02=dot(normalDepth[0].rgb,normalDepth[2].rgb);float dot03=dot(normalDepth[0].rgb,normalDepth[3].rgb);float minDot=min(dot01,min(dot02,dot03));float s=step(THRESHOLD,minDot);float smallestDistance=1.0;int index;for(int i=0;i<4;++i){float distance=abs(depth-normalDepth[i].a);if(distance<smallestDistance){smallestDistance=distance;index=i;}}ivec2 offsets[4];offsets[0]=ivec2(0,0);offsets[1]=ivec2(0,1);offsets[2]=ivec2(1,0);offsets[3]=ivec2(1,1);ivec2 coord=ivec2(uv*vec2(textureSize(aoBuffer,0)))+offsets[index];float aoNearest=texelFetch(aoBuffer,coord,0).r;float ao=mix(aoNearest,aoLinear,s);
#else
float ao=aoLinear;
#endif
float l=luminance(inputColor.rgb);ao=mix(ao,0.0,l*luminanceInfluence);ao=clamp(ao*intensity,0.0,1.0);
#ifdef COLORIZE
outputColor=vec4(1.0-ao*(1.0-color),inputColor.a);
#else
outputColor=vec4(vec3(1.0-ao),inputColor.a);
#endif
}`,TB=64,QF=class extends ya{constructor(n,e,{blendFunction:t=Gt.MULTIPLY,samples:i=9,rings:s=7,normalDepthBuffer:r=null,depthAwareUpsampling:o=!0,worldDistanceThreshold:a,worldDistanceFalloff:c,worldProximityThreshold:l,worldProximityFalloff:h,distanceThreshold:d=.97,distanceFalloff:f=.03,rangeThreshold:p=5e-4,rangeFalloff:m=.001,minRadiusScale:g=.1,luminanceInfluence:y=.7,radius:A=.1825,intensity:v=1,bias:b=.025,fade:_=.01,color:T=null,resolutionScale:E=1,width:M=Si.AUTO_SIZE,height:I=Si.AUTO_SIZE,resolutionX:S=M,resolutionY:C=I}={}){super("SSAOEffect",J6,{blendFunction:t,attributes:no.DEPTH,defines:new Map([["THRESHOLD","0.997"]]),uniforms:new Map([["aoBuffer",new we(null)],["normalDepthBuffer",new we(r)],["luminanceInfluence",new we(y)],["color",new we(null)],["intensity",new we(v)],["scale",new we(0)]])}),this.renderTarget=new Zt(1,1,{depthBuffer:!1}),this.renderTarget.texture.name="AO.Target",this.uniforms.get("aoBuffer").value=this.renderTarget.texture;const D=this.resolution=new Si(this,S,C,E);D.addEventListener("change",L=>this.setSize(D.baseWidth,D.baseHeight)),this.camera=n,this.depthDownsamplingPass=new c1({normalBuffer:e,resolutionScale:E}),this.depthDownsamplingPass.enabled=r===null,this.ssaoPass=new ja(new F9(n));const G=new Q6(TB,TB,xi);G.wrapS=G.wrapT=Lo;const Q=this.ssaoMaterial;Q.normalBuffer=e,Q.noiseTexture=G,Q.minRadiusScale=g,Q.samples=i,Q.radius=A,Q.rings=s,Q.fade=_,Q.bias=b,Q.distanceThreshold=d,Q.distanceFalloff=f,Q.proximityThreshold=p,Q.proximityFalloff=m,a!==void 0&&(Q.worldDistanceThreshold=a),c!==void 0&&(Q.worldDistanceFalloff=c),l!==void 0&&(Q.worldProximityThreshold=l),h!==void 0&&(Q.worldProximityFalloff=h),r!==null&&(this.ssaoMaterial.normalDepthBuffer=r,this.defines.set("NORMAL_DEPTH","1")),this.depthAwareUpsampling=o,this.color=T}set mainCamera(n){this.camera=n,this.ssaoMaterial.copyCameraSettings(n)}get normalBuffer(){return this.ssaoMaterial.normalBuffer}set normalBuffer(n){this.ssaoMaterial.normalBuffer=n,this.depthDownsamplingPass.fullscreenMaterial.normalBuffer=n}getResolution(){return this.resolution}get ssaoMaterial(){return this.ssaoPass.fullscreenMaterial}getSSAOMaterial(){return this.ssaoMaterial}get samples(){return this.ssaoMaterial.samples}set samples(n){this.ssaoMaterial.samples=n}get rings(){return this.ssaoMaterial.rings}set rings(n){this.ssaoMaterial.rings=n}get radius(){return this.ssaoMaterial.radius}set radius(n){this.ssaoMaterial.radius=n}get depthAwareUpsampling(){return this.defines.has("DEPTH_AWARE_UPSAMPLING")}set depthAwareUpsampling(n){this.depthAwareUpsampling!==n&&(n?this.defines.set("DEPTH_AWARE_UPSAMPLING","1"):this.defines.delete("DEPTH_AWARE_UPSAMPLING"),this.setChanged())}isDepthAwareUpsamplingEnabled(){return this.depthAwareUpsampling}setDepthAwareUpsamplingEnabled(n){this.depthAwareUpsampling=n}get distanceScaling(){return!0}set distanceScaling(n){}get color(){return this.uniforms.get("color").value}set color(n){const e=this.uniforms,t=this.defines;n!==null?t.has("COLORIZE")?e.get("color").value.set(n):(t.set("COLORIZE","1"),e.get("color").value=new ye(n),this.setChanged()):t.has("COLORIZE")&&(t.delete("COLORIZE"),e.get("color").value=null,this.setChanged())}get luminanceInfluence(){return this.uniforms.get("luminanceInfluence").value}set luminanceInfluence(n){this.uniforms.get("luminanceInfluence").value=n}get intensity(){return this.uniforms.get("intensity").value}set intensity(n){this.uniforms.get("intensity").value=n}getColor(){return this.color}setColor(n){this.color=n}setDistanceCutoff(n,e){this.ssaoMaterial.distanceThreshold=n,this.ssaoMaterial.distanceFalloff=e}setProximityCutoff(n,e){this.ssaoMaterial.proximityThreshold=n,this.ssaoMaterial.proximityFalloff=e}setDepthTexture(n,e=Ts){this.depthDownsamplingPass.setDepthTexture(n,e),this.ssaoMaterial.depthBuffer=n,this.ssaoMaterial.depthPacking=e}update(n,e,t){const i=this.renderTarget;this.depthDownsamplingPass.enabled&&this.depthDownsamplingPass.render(n),this.ssaoPass.render(n,null,i)}setSize(n,e){const t=this.resolution;t.setBaseSize(n,e);const i=t.width,s=t.height;this.ssaoMaterial.copyCameraSettings(this.camera),this.ssaoMaterial.setSize(i,s),this.renderTarget.setSize(i,s),this.depthDownsamplingPass.resolution.scale=t.scale,this.depthDownsamplingPass.setSize(n,e)}initialize(n,e,t){try{let i=this.uniforms.get("normalDepthBuffer").value;i===null&&(this.depthDownsamplingPass.initialize(n,e,t),i=this.depthDownsamplingPass.texture,this.uniforms.get("normalDepthBuffer").value=i,this.ssaoMaterial.normalDepthBuffer=i,this.defines.set("NORMAL_DEPTH","1"))}catch{this.depthDownsamplingPass.enabled=!1}}},K6=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D map;
#else
uniform lowp sampler2D map;
#endif
uniform vec2 maskParams;varying vec2 vUv2;float linearGradientMask(const in float x){return step(maskParams.x,x)-step(maskParams.y,x);}void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){float mask=linearGradientMask(vUv2.y);vec4 texel=texture2D(map,uv);outputColor=mix(texel,inputColor,mask);}`,Z6="uniform vec2 rotation;varying vec2 vUv2;void mainSupport(const in vec2 uv){vUv2=(uv-0.5)*2.0*vec2(aspect,1.0);vUv2=vec2(dot(rotation,vUv2),dot(rotation,vec2(vUv2.y,-vUv2.x)));}",$6=class extends ya{constructor({blendFunction:e,offset:t=0,rotation:i=0,focusArea:s=.4,feather:r=.3,kernelSize:o=Sl.MEDIUM,resolutionScale:a=.5,resolutionX:c=Si.AUTO_SIZE,resolutionY:l=Si.AUTO_SIZE}={}){super("TiltShiftEffect",K6,{vertexShader:Z6,blendFunction:e,uniforms:new Map([["rotation",new we(new ie)],["maskParams",new we(new ie)],["map",new we(null)]])}),this._offset=t,this._focusArea=s,this._feather=r,this.renderTarget=new Zt(1,1,{depthBuffer:!1}),this.renderTarget.texture.name="TiltShift.Target",this.uniforms.get("map").value=this.renderTarget.texture,this.blurPass=new $9({kernelSize:o,resolutionScale:a,resolutionX:c,resolutionY:l,offset:t,rotation:i,focusArea:s,feather:r});const h=this.resolution=new Si(this,c,l,a);h.addEventListener("change",d=>this.setSize(h.baseWidth,h.baseHeight)),this.rotation=i,this.updateParams()}updateParams(){const e=this.uniforms.get("maskParams").value,t=Math.max(this.focusArea-this.feather,0);e.set(this.offset-t,this.offset+t)}get rotation(){return Math.acos(this.uniforms.get("rotation").value.x)}set rotation(e){this.uniforms.get("rotation").value.set(Math.cos(e),Math.sin(e)),this.blurPass.blurMaterial.rotation=e}get offset(){return this._offset}set offset(e){this._offset=e,this.blurPass.blurMaterial.offset=e,this.updateParams()}get focusArea(){return this._focusArea}set focusArea(e){this._focusArea=e,this.blurPass.blurMaterial.focusArea=e,this.updateParams()}get feather(){return this._feather}set feather(e){this._feather=e,this.blurPass.blurMaterial.feather=e,this.updateParams()}get bias(){return 0}set bias(e){}update(e,t,i){this.blurPass.render(e,t,this.renderTarget)}setSize(e,t){const i=this.resolution;i.setBaseSize(e,t),this.renderTarget.setSize(i.width,i.height),this.blurPass.resolution.copy(i)}initialize(e,t,i){this.blurPass.initialize(e,t,i),i!==void 0&&(this.renderTarget.texture.type=i,Cl(e)===Bi&&Lr(this.renderTarget.texture,Bi))}},eq=`uniform float offset;uniform float darkness;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){const vec2 center=vec2(0.5);vec3 color=inputColor.rgb;
#if VIGNETTE_TECHNIQUE == 0
float d=distance(uv,center);color*=smoothstep(0.8,offset*0.799,d*(darkness+offset));
#else
vec2 coord=(uv-center)*vec2(offset);color=mix(color,vec3(1.0-darkness),dot(coord,coord));
#endif
outputColor=vec4(color,inputColor.a);}`,jF=class extends ya{constructor({blendFunction:n,technique:e=By.DEFAULT,eskil:t=!1,offset:i=.5,darkness:s=.5}={}){super("VignetteEffect",eq,{blendFunction:n,defines:new Map([["VIGNETTE_TECHNIQUE",e.toFixed(0)]]),uniforms:new Map([["offset",new we(i)],["darkness",new we(s)]])})}get technique(){return Number(this.defines.get("VIGNETTE_TECHNIQUE"))}set technique(n){this.technique!==n&&(this.defines.set("VIGNETTE_TECHNIQUE",n.toFixed(0)),this.setChanged())}get eskil(){return this.technique===By.ESKIL}set eskil(n){this.technique=n?By.ESKIL:By.DEFAULT}getTechnique(){return this.technique}setTechnique(n){this.technique=n}get offset(){return this.uniforms.get("offset").value}set offset(n){this.uniforms.get("offset").value=n}getOffset(){return this.offset}setOffset(n){this.offset=n}get darkness(){return this.uniforms.get("darkness").value}set darkness(n){this.uniforms.get("darkness").value=n}getDarkness(){return this.darkness}setDarkness(n){this.darkness=n}},ug=function(){var n=0,e=document.createElement("div");e.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",e.addEventListener("click",function(h){h.preventDefault(),i(++n%e.children.length)},!1);function t(h){return e.appendChild(h.dom),h}function i(h){for(var d=0;d<e.children.length;d++)e.children[d].style.display=d===h?"block":"none";n=h}var s=(performance||Date).now(),r=s,o=0,a=t(new ug.Panel("FPS","#0ff","#002")),c=t(new ug.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var l=t(new ug.Panel("MB","#f08","#201"));return i(0),{REVISION:16,dom:e,addPanel:t,showPanel:i,begin:function(){s=(performance||Date).now()},end:function(){o++;var h=(performance||Date).now();if(c.update(h-s,200),h>=r+1e3&&(a.update(o*1e3/(h-r),100),r=h,o=0,l)){var d=performance.memory;l.update(d.usedJSHeapSize/1048576,d.jsHeapSizeLimit/1048576)}return h},update:function(){s=this.end()},domElement:e,setMode:i}};ug.Panel=function(n,e,t){var i=1/0,s=0,r=Math.round,o=r(window.devicePixelRatio||1),a=80*o,c=48*o,l=3*o,h=2*o,d=3*o,f=15*o,p=74*o,m=30*o,g=document.createElement("canvas");g.width=a,g.height=c,g.style.cssText="width:80px;height:48px";var y=g.getContext("2d");return y.font="bold "+9*o+"px Helvetica,Arial,sans-serif",y.textBaseline="top",y.fillStyle=t,y.fillRect(0,0,a,c),y.fillStyle=e,y.fillText(n,l,h),y.fillRect(d,f,p,m),y.fillStyle=t,y.globalAlpha=.9,y.fillRect(d,f,p,m),{dom:g,update:function(A,v){i=Math.min(i,A),s=Math.max(s,A),y.fillStyle=t,y.globalAlpha=1,y.fillRect(0,0,a,f),y.fillStyle=e,y.fillText(r(A)+" "+n+" ("+r(i)+"-"+r(s)+")",l,h),y.drawImage(g,d+o,f,p-o,m,d,f,p-o,m),y.fillRect(d+p-o,f,o,m),y.fillStyle=t,y.globalAlpha=.9,y.fillRect(d+p-o,f,o,r((1-A/v)*m))}}};const jA=re("gizmos"),_s=re("debugextension"),yS=re("debugtypes");class tq{constructor(){u(this,"_types",{});yS&&console.warn("TypeStore: Created",this)}add(e,t){yS&&console.warn("ADD TYPE",e);const i=this._types[e];i===void 0?this._types[e]=t:yS&&i!==t&&console.warn("Type name exists multiple times in your project and may lead to runtime errors:",e)}get(e){return this._types[e]}}const iq=Symbol("BuiltInType"),ee=new tq,Ab=re("debugresolvedependencies"),nq=["/extensions/","extensions/"],sq=[{prefix:"/nodes/",dependencyName:"node"},{prefix:"/meshes/",dependencyName:"mesh"},{prefix:"/materials/",dependencyName:"material"},{prefix:"/textures/",dependencyName:"texture"},{prefix:"/animations/",dependencyName:"animation"},{prefix:"nodes/",dependencyName:"node"},{prefix:"meshes/",dependencyName:"mesh"},{prefix:"materials/",dependencyName:"material"},{prefix:"textures/",dependencyName:"texture"},{prefix:"animations/",dependencyName:"animation"}];async function d1(n,e){Ab&&console.log(n,e);const t=[];DE(sq,n,e,t);const i=await Promise.all(t);return typeof e=="string"&&i.length===1?i[0]:i}function DE(n,e,t,i){if(typeof t=="object"&&t!==void 0&&t!==null)for(const s of Object.keys(t)){const r=t[s];if(typeof r=="string"){const o=MB(e,r);if(o!=null)typeof o.then=="function"?i.push(o.then(a=>t[s]=a)):t[s]=o;else for(const a of n){const c=OE(a.prefix,r);if(c>=0){Ab&&console.log(a,c,a.dependencyName),i.push(e==null?void 0:e.getDependency(a.dependencyName,c).then(l=>(t[s]=l,l)));break}}}else if(Array.isArray(r))for(let o=0;o<r.length;o++){const a=r[o],c=MB(e,a);if(c!==null){typeof c.then=="function"?i.push(c.then(l=>r[o]=l)):r[o]=c;continue}for(const l of n){const h=OE(l.prefix,a);if(h>=0){Ab&&console.log(l,h,l.dependencyName),i.push(e==null?void 0:e.getDependency(l.dependencyName,h).then(d=>r[o]=d));break}}typeof a=="object"&&DE(n,e,a,i)}else typeof r=="object"&&DE(n,e,r,i)}else typeof t=="string"&&rq(n,e,t,i)}function MB(n,e){if(n&&n.plugins&&typeof e=="string"){for(const t of nq)if(e.startsWith(t)){let i=e.substring(t.length);const s=i.indexOf("/");s>=0&&(i=i.substring(0,s));const r=n.plugins[i];if(_s&&console.log(i,r),typeof(r==null?void 0:r.resolve)=="function"){const o=e.substring(t.length+i.length+1);return r.resolve(n,o)}break}}return null}function rq(n,e,t,i){for(const s of n){const r=OE(s.prefix,t);if(r>=0)return Ab&&console.log(s,r,s.dependencyName),i.push(e==null?void 0:e.getDependency(s.dependencyName,r).then(o=>o)),!0}return!1}function OE(n,e){if(typeof e=="string"&&e.startsWith(n)){const t=e.substring(n.length),i=Number.parseInt(t);if(i>=0)return i}return-1}const bS="NEEDLE_persistent_assets";function oq(n){return(n==null?void 0:n.___persistentAsset)===!0}class aq{constructor(e){u(this,"parser");this.parser=e}get name(){return bS}async afterRoot(e){var s,r;if(!((r=(s=this.parser)==null?void 0:s.json)!=null&&r.extensions))return;const t=this.parser.json.extensions[bS];if(!t)return;_s&&console.log(t);const i=new Array;for(const o of t==null?void 0:t.assets){const a=d1(this.parser,o);a&&i.push(a)}await Promise.all(i)}resolve(e,t){const i=Number.parseInt(t);if(i>=0){_s&&console.log(t);const s=e.json.extensions[bS];if(s){const r=s==null?void 0:s.assets[i];if(r&&typeof r=="object"){r.___persistentAsset=!0;const o=r.__type;o&&ee.get(o)}return r}}return null}}const Kc=re("debugserializer");class cq{constructor(){u(this,"typeMap",{})}register(e,t){if(this.typeMap[e]!==void 0){if(this.typeMap[e]===t)return;console.warn("Type "+e+" is already registered",t,this.typeMap[e])}Kc&&console.log("Register type serializer for "+e,t),this.typeMap[e]=t}getSerializer(e){if(e)return this.typeMap[e]}getSerializerForConstructor(e,t=0){var c;if(t>20)return;if(!e||!e.constructor){Kc&&console.log("invalid type");return}const i=e.name??((c=e.constructor)==null?void 0:c.name);if(!i){Kc&&console.log("invalid name",i);return}const s=this.getSerializer(i);if(s!==void 0)return Kc&&console.log("FOUND "+i,e.name,e.constructor.name,s,this.typeMap),s;const r=Object.getPrototypeOf(e);if(!(r.prototype||r.constructor)){Kc&&console.warn("No prototype for "+i,e,e.name,e.prototype,e.constructor.name);return}const a=r.prototype??r.constructor;if(a!==e){const l=this.getSerializerForConstructor(a,++t);if(l){Kc&&console.log("FOUND "+a.constructor.name,a.name,a,l);const h=a.name??a.constructor.name;h==="Function"?console.error("Registering Function is not allowed, something went wrong",e,a,l):this.register(h,l)}return l}}}const vb=new cq;class Bl{constructor(e){if(Array.isArray(e))for(const t of e)vb.register(t.name,this);else vb.register(e.name,this)}}class lq{constructor(){u(this,"isDevMode",zr());u(this,"cache",{})}registerDefinedKeys(e,t){this.isDevMode&&this.cache[e]===void 0&&(this.cache[e]=Object.keys(t))}getDefinedKey(e,t){return this.cache[e]===void 0?!1:this.cache[e].includes(t)}}class WF{constructor(e){u(this,"root");u(this,"gltf");u(this,"gltfId");u(this,"object");u(this,"target");u(this,"nodeId");u(this,"nodeToObject");u(this,"objectToNode");u(this,"context");u(this,"path");u(this,"type");u(this,"serializable");u(this,"implementationInformation");this.root=e}}function hq(n,e){const t=n.$serializedTypes;if(t===void 0)return null;const i={};for(const s in t){const r=n[s];if(r!=null&&typeof r=="object"){const o=vb.getSerializerForConstructor(r);if(o){i[s]=o.onSerialize(r,e);continue}}i[s]=r}return i.name=n.constructor.name,typeof n.guid=="string"&&(i.guid=n.guid),i}const T0=[];function qF(n,e){if(!n)return e;typeof n.$serializedTypes=="object"&&(e||(e={}),Object.assign(e,n.$serializedTypes));const t=Object.getPrototypeOf(n);return qF(t,e)}function kE(n,e,t){if(!n)return!1;if(t.target=n,n.onBeforeDeserialize!==void 0){const s=n.onBeforeDeserialize(e,t);if(typeof s=="boolean")return s}const i=qF(n);if(e){if(typeof e.guid=="string"&&(n.guid=e.guid),i)for(const s in i){let a=function(c){const h=c.type;return h?LE(o,h,t,void 0,n[s]):LE(o,c,t,void 0,n[s])};const r=i[s],o=e[s];if(Kc&&console.log(s,o,n,r),!(n[s]!==void 0&&o===void 0)&&(t.type=void 0,t.path=s,t.serializable=r,!(n.onBeforeDeserializeMember!==void 0&&n.onBeforeDeserializeMember(s,o,t)===!0))){if(r===null)n[s]=o;else{if(Array.isArray(r))for(let c=0;c<r.length;c++){const l=r[c],h=a(l);if(h!==void 0||c===r.length-1){n[s]=h;break}}else n[s]=a(r);T0.length=0}n.onAfterDeserializeMember!==void 0&&n.onAfterDeserializeMember(s,o,t)}}fq(n,e)}return dq(n,e,t.implementationInformation),n.onAfterDeserialize!==void 0&&n.onAfterDeserialize(e,t),!0}const uq=re("noerrors");function dq(n,e,t){var r;if(uq||!e||zr()===!1||!n||n.constructor&&n.constructor[iq]===!0)return;const i=(r=n.constructor)==null?void 0:r.name,s=Object.getOwnPropertyNames(e);for(const o of s){if(o==="sourceId")continue;const a=n[o];if(a==null)continue;const c=e[o];if((t==null?void 0:t.getDefinedKey(i,o))===!1){const l=o.charAt(0).toUpperCase()+o.slice(1);t.getDefinedKey(i,l)&&(Ph(rs.Warn,'<strong>Please rename</strong> "'+l+'" to "'+o+'" in '+i),console.warn('Please use lowercase for field: "'+l+'" in '+i,c,n));continue}if(c!=null){if(typeof c=="object"&&(a===void 0||!a.isObject3D)&&(typeof c.node=="number"||typeof c.guid=="string")){if(c.could_not_resolve)continue;if(!(a!==void 0&&Object.keys(a).length>1)){Ph(rs.Warn,`<strong>Missing serialization for object reference!</strong>

Please change to: 
@serializable(Object3D)
${o}? : Object3D;

in script ${i}.ts
<a href="https://docs.needle.tools/serializable" target="_blank">documentation</a>`),console.warn(i,o,n[o],n);continue}}if(typeof a=="string"&&(c.endsWith(".gltf")||c.endsWith(".glb"))){Ph(rs.Warn,`<strong>Missing serialization for object reference!</strong>

Please change to: 
@serializable(AssetReference)
${o}? : AssetReference;

in script ${i}.ts
<a href="https://docs.needle.tools/serializable" target="_blank">documentation</a>`),console.warn(i,o,n[o],n);continue}}}}function fq(n,e){for(const t of Object.keys(e)){const i=e[t];if(typeof i=="object"&&i!==null&&i!==void 0){const s=n[t];if(!s){Kc&&console.log(t,"is undefined on",n);continue}for(const r of Object.keys(i))if(s[r]===void 0&&IB(i[r])&&!IB(s)){const a=pq(s,r);if(a&&((a==null?void 0:a.writable)===void 0||(a==null?void 0:a.writable)===!1)&&a.set===void 0){Kc&&console.warn('Property is not writable "'+r+'"',s,a,i[r],s[r]);continue}s[r]=i[r]}}}}function pq(n,e){for(;n;){const t=Object.getOwnPropertyDescriptor(n,e);if(t)return t;n=Object.getPrototypeOf(n)}}function IB(n){switch(typeof n){case"number":case"string":case"boolean":return!0}return!1}function LE(n,e,t,i,s){let r=typeof e=="function"&&e.prototype===void 0,o=e;if(r)try{if(o=e==null?void 0:e.call(e,s),r=!1,o==null)return}catch(h){console.error("Error in callback",h,n)}if(t.type=o,!r&&s instanceof o)return s;if(i||(i={serializer:vb.getSerializerForConstructor(o)}),s&&typeof s=="object"&&oq(s)){if(s.__concreteInstance)return s.__concreteInstance;const h=s;if(!h.$serializedTypes&&o.prototype.$serializedTypes&&(h.$serializedTypes=o.prototype.$serializedTypes),h.$serializedTypes&&kE(h,n,t),s&&o!==void 0)try{let d=null;i.serializer&&(d=i.serializer.onDeserialize(n,t)),d||(d=new o,_s&&console.log("Create concrete instance for persistent asset",s,"instance:",d),gp(d,s)),s.__concreteInstance=d,s=d}catch(d){console.error("Error creating instance or creating values on instance",d,s,o)}return s}if(Array.isArray(n)){const h=[];for(let d=0;d<n.length;d++){const f=n[d],p=LE(f,e,t,i,f);h.push(p)}return h}const a=i==null?void 0:i.serializer;if(a)return a.onDeserialize(n,t);let c;if(n&&(n.isMaterial||n.isTexture||n.isObject3D))c=n;else{if(n===void 0)return;if(n===null&&(o===Ot||o===Ft||o===me||o===Nr))return null;try{c=new o(...mq(n))}catch(h){console.error("Error creating "+t.path,t.target,h);return}}const l=c;return l.$serializedTypes&&kE(l,n,t),c}function mq(n){if(T0.length=0,typeof n=="object"&&n!==null&&n!==void 0)for(const e of Object.keys(n))T0.push(n[e]);return T0}const FE=Symbol("assigned component properties");function gp(n,e,t){var s;if(e==null||n==null)return;n[FE]=!0;const i=((s=n.constructor)==null?void 0:s.name)??"unknown";t==null||t.registerDefinedKeys(i,n);for(const r of Object.keys(e)){const o=gq(n,r);typeof(o==null?void 0:o.value)!="function"&&(!o||o.writable===!0||(o==null?void 0:o.set)!==void 0)&&(n[r]=e[r])}delete n[FE]}function gq(n,e){let t;do t=Object.getOwnPropertyDescriptor(n,e);while(!t&&(n=Object.getPrototypeOf(n)));return t}function cx(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var XF={exports:{}},YF={exports:{}};(function(){var n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",e={rotl:function(t,i){return t<<i|t>>>32-i},rotr:function(t,i){return t<<32-i|t>>>i},endian:function(t){if(t.constructor==Number)return e.rotl(t,8)&16711935|e.rotl(t,24)&4278255360;for(var i=0;i<t.length;i++)t[i]=e.endian(t[i]);return t},randomBytes:function(t){for(var i=[];t>0;t--)i.push(Math.floor(Math.random()*256));return i},bytesToWords:function(t){for(var i=[],s=0,r=0;s<t.length;s++,r+=8)i[r>>>5]|=t[s]<<24-r%32;return i},wordsToBytes:function(t){for(var i=[],s=0;s<t.length*32;s+=8)i.push(t[s>>>5]>>>24-s%32&255);return i},bytesToHex:function(t){for(var i=[],s=0;s<t.length;s++)i.push((t[s]>>>4).toString(16)),i.push((t[s]&15).toString(16));return i.join("")},hexToBytes:function(t){for(var i=[],s=0;s<t.length;s+=2)i.push(parseInt(t.substr(s,2),16));return i},bytesToBase64:function(t){for(var i=[],s=0;s<t.length;s+=3)for(var r=t[s]<<16|t[s+1]<<8|t[s+2],o=0;o<4;o++)s*8+o*6<=t.length*8?i.push(n.charAt(r>>>6*(3-o)&63)):i.push("=");return i.join("")},base64ToBytes:function(t){t=t.replace(/[^A-Z0-9+\/]/ig,"");for(var i=[],s=0,r=0;s<t.length;r=++s%4)r!=0&&i.push((n.indexOf(t.charAt(s-1))&Math.pow(2,-2*r+8)-1)<<r*2|n.indexOf(t.charAt(s))>>>6-r*2);return i}};YF.exports=e})();var Aq=YF.exports,UE={utf8:{stringToBytes:function(n){return UE.bin.stringToBytes(unescape(encodeURIComponent(n)))},bytesToString:function(n){return decodeURIComponent(escape(UE.bin.bytesToString(n)))}},bin:{stringToBytes:function(n){for(var e=[],t=0;t<n.length;t++)e.push(n.charCodeAt(t)&255);return e},bytesToString:function(n){for(var e=[],t=0;t<n.length;t++)e.push(String.fromCharCode(n[t]));return e.join("")}}},RB=UE;/*!
 * Determine if an object is a Buffer
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */var vq=function(n){return n!=null&&(JF(n)||yq(n)||!!n._isBuffer)};function JF(n){return!!n.constructor&&typeof n.constructor.isBuffer=="function"&&n.constructor.isBuffer(n)}function yq(n){return typeof n.readFloatLE=="function"&&typeof n.slice=="function"&&JF(n.slice(0,0))}(function(){var n=Aq,e=RB.utf8,t=vq,i=RB.bin,s=function(r,o){r.constructor==String?o&&o.encoding==="binary"?r=i.stringToBytes(r):r=e.stringToBytes(r):t(r)?r=Array.prototype.slice.call(r,0):!Array.isArray(r)&&r.constructor!==Uint8Array&&(r=r.toString());for(var a=n.bytesToWords(r),c=r.length*8,l=1732584193,h=-271733879,d=-1732584194,f=271733878,p=0;p<a.length;p++)a[p]=(a[p]<<8|a[p]>>>24)&16711935|(a[p]<<24|a[p]>>>8)&4278255360;a[c>>>5]|=128<<c%32,a[(c+64>>>9<<4)+14]=c;for(var m=s._ff,g=s._gg,y=s._hh,A=s._ii,p=0;p<a.length;p+=16){var v=l,b=h,_=d,T=f;l=m(l,h,d,f,a[p+0],7,-680876936),f=m(f,l,h,d,a[p+1],12,-389564586),d=m(d,f,l,h,a[p+2],17,606105819),h=m(h,d,f,l,a[p+3],22,-1044525330),l=m(l,h,d,f,a[p+4],7,-176418897),f=m(f,l,h,d,a[p+5],12,1200080426),d=m(d,f,l,h,a[p+6],17,-1473231341),h=m(h,d,f,l,a[p+7],22,-45705983),l=m(l,h,d,f,a[p+8],7,1770035416),f=m(f,l,h,d,a[p+9],12,-1958414417),d=m(d,f,l,h,a[p+10],17,-42063),h=m(h,d,f,l,a[p+11],22,-1990404162),l=m(l,h,d,f,a[p+12],7,1804603682),f=m(f,l,h,d,a[p+13],12,-40341101),d=m(d,f,l,h,a[p+14],17,-1502002290),h=m(h,d,f,l,a[p+15],22,1236535329),l=g(l,h,d,f,a[p+1],5,-165796510),f=g(f,l,h,d,a[p+6],9,-1069501632),d=g(d,f,l,h,a[p+11],14,643717713),h=g(h,d,f,l,a[p+0],20,-373897302),l=g(l,h,d,f,a[p+5],5,-701558691),f=g(f,l,h,d,a[p+10],9,38016083),d=g(d,f,l,h,a[p+15],14,-660478335),h=g(h,d,f,l,a[p+4],20,-405537848),l=g(l,h,d,f,a[p+9],5,568446438),f=g(f,l,h,d,a[p+14],9,-1019803690),d=g(d,f,l,h,a[p+3],14,-187363961),h=g(h,d,f,l,a[p+8],20,1163531501),l=g(l,h,d,f,a[p+13],5,-1444681467),f=g(f,l,h,d,a[p+2],9,-51403784),d=g(d,f,l,h,a[p+7],14,1735328473),h=g(h,d,f,l,a[p+12],20,-1926607734),l=y(l,h,d,f,a[p+5],4,-378558),f=y(f,l,h,d,a[p+8],11,-2022574463),d=y(d,f,l,h,a[p+11],16,1839030562),h=y(h,d,f,l,a[p+14],23,-35309556),l=y(l,h,d,f,a[p+1],4,-1530992060),f=y(f,l,h,d,a[p+4],11,1272893353),d=y(d,f,l,h,a[p+7],16,-155497632),h=y(h,d,f,l,a[p+10],23,-1094730640),l=y(l,h,d,f,a[p+13],4,681279174),f=y(f,l,h,d,a[p+0],11,-358537222),d=y(d,f,l,h,a[p+3],16,-722521979),h=y(h,d,f,l,a[p+6],23,76029189),l=y(l,h,d,f,a[p+9],4,-640364487),f=y(f,l,h,d,a[p+12],11,-421815835),d=y(d,f,l,h,a[p+15],16,530742520),h=y(h,d,f,l,a[p+2],23,-995338651),l=A(l,h,d,f,a[p+0],6,-198630844),f=A(f,l,h,d,a[p+7],10,1126891415),d=A(d,f,l,h,a[p+14],15,-1416354905),h=A(h,d,f,l,a[p+5],21,-57434055),l=A(l,h,d,f,a[p+12],6,1700485571),f=A(f,l,h,d,a[p+3],10,-1894986606),d=A(d,f,l,h,a[p+10],15,-1051523),h=A(h,d,f,l,a[p+1],21,-2054922799),l=A(l,h,d,f,a[p+8],6,1873313359),f=A(f,l,h,d,a[p+15],10,-30611744),d=A(d,f,l,h,a[p+6],15,-1560198380),h=A(h,d,f,l,a[p+13],21,1309151649),l=A(l,h,d,f,a[p+4],6,-145523070),f=A(f,l,h,d,a[p+11],10,-1120210379),d=A(d,f,l,h,a[p+2],15,718787259),h=A(h,d,f,l,a[p+9],21,-343485551),l=l+v>>>0,h=h+b>>>0,d=d+_>>>0,f=f+T>>>0}return n.endian([l,h,d,f])};s._ff=function(r,o,a,c,l,h,d){var f=r+(o&a|~o&c)+(l>>>0)+d;return(f<<h|f>>>32-h)+o},s._gg=function(r,o,a,c,l,h,d){var f=r+(o&c|a&~c)+(l>>>0)+d;return(f<<h|f>>>32-h)+o},s._hh=function(r,o,a,c,l,h,d){var f=r+(o^a^c)+(l>>>0)+d;return(f<<h|f>>>32-h)+o},s._ii=function(r,o,a,c,l,h,d){var f=r+(a^(o|~c))+(l>>>0)+d;return(f<<h|f>>>32-h)+o},s._blocksize=16,s._digestsize=16,XF.exports=function(r,o){if(r==null)throw new Error("Illegal argument "+r);var a=n.wordsToBytes(s(r,o));return o&&o.asBytes?a:o&&o.asString?i.bytesToString(a):n.bytesToHex(a)}})();var bq=XF.exports;const _q=cx(bq);class PB{constructor(e,t,i,s){u(this,"success");u(this,"filename");u(this,"hash");u(this,"size");u(this,"url");this.success=e,this.filename=t,this.hash=i,this.size=s}}async function xq(n,e){const t=await n.arrayBuffer(),i=KF(t),s=n.name.split(".").pop(),r=i+"."+s,o=n.name.split(".").shift();console.assert(o!==void 0);const a={alias:o,filename:r},l=await(await fetch(e+"/exists",{method:"POST",body:JSON.stringify(a)})).json();if(l.success||console.warn("exists check did fail"),l.exists)return console.log("file already exists",i),new PB(!0,r,i,n.size);console.log("begin uploading file",o,n.size);const h=new FormData;h.append("file",n);const d={};d.filesize=n.size,o&&(d.alias=o);const p=await(await fetch(e+"/upload/file",{method:"POST",body:h,headers:d})).json();if((p==null?void 0:p.success)===!1)return p.message!==void 0?console.error("Upload failed:",p.message):console.error("Upload failed"),null;console.assert(p.hash_sum===i,"hash sum did not match","received:",p.hash_sum,"expected:",i),p.success&&console.log("successfully uploaded",i,p.id);const m=new PB(p.success,r,i,n.size);return m.url=e,m}function KF(n){return _q(new Uint8Array(n))}async function ZF(n,e,t,i,s=!1){try{const r=await fetch(i+"/download/file",{method:"POST",body:n});if(r.status!==200)return console.error("download failed",r),null;const o=await r.blob(),a=await o.arrayBuffer();s||console.assert(o.size===t,"size mismatch","expected:",t,"got:",o.size);const c=KF(a);return s||console.assert(c===e,"hash mismatch, downloaded file is invalid"),o.arrayBuffer()}catch(r){console.error(r)}return null}async function wq(n,e){var h;const t=await fetch(n),i=(h=t.body)==null?void 0:h.getReader(),s=t.headers.get("Content-Length"),r=s?parseInt(s):0;if(!i)return null;let o=0;const a=[];for(;;){const{done:d,value:f}=await i.read();if(f&&(a.push(f),o+=f.length,e.call(null,new ProgressEvent("progress",{loaded:o,total:r}))),d)break}const c=new Uint8Array(o);let l=0;for(const d of a)c.set(d,l),l+=d.length;return c}const th=re("debugaddressables");class Sq{constructor(e){u(this,"_context");u(this,"_assetReferences",{});this._context=e,this._context.pre_update_callbacks.push(this.preUpdate.bind(this))}preUpdate(){}findAssetReference(e){return this._assetReferences[e]||null}registerAssetReference(e){return e.uri&&(this._assetReferences[e.uri]?console.warn("Asset reference already registered",e):this._assetReferences[e.uri]=e),e}dispose(){for(const e in this._assetReferences){const t=this._assetReferences[e];t==null||t.unload()}this._assetReferences={}}unregisterAssetReference(e){e.uri&&delete this._assetReferences[e.uri]}}const _S=Symbol("assetReference"),jf=class{constructor(e,t,i=null){u(this,"_loading");u(this,"_asset");u(this,"_glbRoot");u(this,"_url");u(this,"_progressListeners",[]);u(this,"_hash");u(this,"_hashedUri");u(this,"_isLoadingRawBinary",!1);u(this,"_rawBinary");this._url=e,this._hash=t,e.includes("?v=")?this._hashedUri=e:this._hashedUri=t?e+"?v="+t:e,i!==null&&(this.asset=i),YZ(this._url,this.onResolvePrefab.bind(this))}static getOrCreate(e,t,i){if(typeof e=="string"){if(!i&&(i=Lt.Current,!i))throw new Error('Context is required when sourceId is a string. When you call this method from a component you can call it with "getOrCreate(this, url)" where "this" is the component.')}else i=e.context,e=e.sourceId;const s=Bp(e,t);th&&console.log("GetOrCreate Addressable from",e,t,"FinalPath=",s);const r=i.addressables,o=r.findAssetReference(s);if(o)return o;const a=new jf(s,i.hash);return r.registerAssetReference(a),a}get asset(){return this._glbRoot??this._asset}set asset(e){this._asset=e}get uri(){return this._url}get rawAsset(){return this._asset}async onResolvePrefab(e){return e===this.uri&&(this.mustLoad&&await this.loadAssetAsync(),this.asset)?this.asset:null}get mustLoad(){return!this.asset||this.asset.__destroyed===!0||_p(this.asset)===!0}isLoaded(){return this._rawBinary||this.asset!==void 0}unload(){this.asset&&(th&&console.log("Unload",this.asset),this.asset.scene&&gc(this.asset.scene,!0,!0),gc(this.asset,!0,!0)),this.asset=null,this._rawBinary=void 0,this._glbRoot=null,this._loading=void 0,Lt.Current&&Lt.Current.addressables.unregisterAssetReference(this)}async preload(){if(!this.mustLoad||this._isLoadingRawBinary)return null;if(this._rawBinary!==void 0)return this._rawBinary;this._isLoadingRawBinary=!0,th&&console.log("Preload",this._hashedUri);const e=await wq(this._hashedUri,t=>{this.raiseProgressEvent(t)});return this._rawBinary=(e==null?void 0:e.buffer)??null,this._isLoadingRawBinary=!1,this._rawBinary}async loadAssetAsync(e){if(th&&console.log("loadAssetAsync",this.uri),!this.mustLoad)return this.asset;if(e&&this._progressListeners.push(e),this._loading!==void 0)return this._loading.then(s=>this.asset);const t=Lt.Current;this._rawBinary?(this._loading=mc().parseSync(t,this._rawBinary,this.uri,null),this.raiseProgressEvent(new ProgressEvent("progress",{loaded:this._rawBinary.byteLength,total:this._rawBinary.byteLength}))):(th&&console.log("Load async",this.uri),this._loading=mc().loadSync(t,this._hashedUri,this.uri,null,s=>{this.raiseProgressEvent(s)}));const i=await this._loading;if(this._progressListeners.length=0,this._glbRoot=this.tryGetActualGameObjectRoot(i),this._loading=void 0,i)return i[_S]=this,this._glbRoot&&(this._glbRoot[_S]=this),this.asset&&(this.asset[_S]=this),gb(t),i.scene!==void 0&&(this.asset=i),this.asset}async instantiate(e){return this.onInstantiate(e,!1)}async instantiateSynced(e,t=!0){return this.onInstantiate(e,!0,t)}beginListenDownload(e){this._progressListeners.indexOf(e)<0&&this._progressListeners.push(e)}endListenDownload(e){const t=this._progressListeners.indexOf(e);t>=0&&this._progressListeners.splice(t,1)}raiseProgressEvent(e){for(const t of this._progressListeners)t(this,e)}async onInstantiate(e,t=!1,i){const s=Lt.Current,r=new _c;if(e instanceof ge?r.parent=e:e&&r.cloneAssign(e),r.parent||(r.parent=s.scene),this.mustLoad&&await this.loadAssetAsync(),th&&console.log("Instantiate",this.uri,"parent:",e),this.asset){th&&console.log("Add to scene",this.asset);let o=jf.currentlyInstantiating.get(this.uri);if(o!==void 0&&o>=1e4)return console.error("Recursive or too many instantiations of "+this.uri+" in the same frame ("+o+")"),null;try{if(o===void 0&&(o=0),o+=1,jf.currentlyInstantiating.set(this.uri,o),t){r.context=s;const a=this.asset;a.guid=this.uri;const c=R3(a,r,void 0,i);if(c)return c}else{const a=tv(this.asset,r);if(a)return a}}finally{s.post_render_callbacks.push(()=>{o===void 0||o<0?o=0:o-=1,jf.currentlyInstantiating.set(this.uri,o)})}}else th&&console.warn("Failed to load asset",this.uri);return null}tryGetActualGameObjectRoot(e){if(e&&e.scene){const t=e.scene;return t.isGroup&&t.children.length===1&&t.children[0].name+"glb"===t.name?t.children[0]:t}return null}};let ii=jf;u(ii,"currentlyInstantiating",new Map);class Cq extends Bl{constructor(){super([ii])}onSerialize(e,t){if(e&&e.uri!==void 0&&typeof e.uri=="string")return e.uri}onDeserialize(e,t){if(typeof e=="string")return t.context?t.gltfId?ii.getOrCreate(t.gltfId,e,t.context):(console.error("Missing source id"),null):(console.error("Missing context"),null);if(e instanceof ge){if(!t.context)return console.error("Missing context"),null;if(!t.gltfId)return console.error("Missing source id"),null;const i=e,s=t.context,r=i.guid??i.uuid,o=s.addressables.findAssetReference(r);if(o)return o;const a=new ii(r,void 0,i);return s.addressables.registerAssetReference(a),a}return null}}new Cq;const Eq=Promise.resolve(null),Fg=class{constructor(e){u(this,"url");u(this,"_bitmap");u(this,"_bitmapObject");u(this,"loader",null);this.url=e}static getOrCreate(e){let t=Fg.imageReferences.get(e);return t||(t=new Fg(e),Fg.imageReferences.set(e,t)),t}dispose(){this._bitmapObject&&this._bitmapObject.close(),this._bitmap=void 0}createHTMLImage(){const e=new Image;return e.src=this.url,e}createTexture(){return this.url?(this.loader||(this.loader=new dl),this.loader.setCrossOrigin("anonymous"),this.loader.loadAsync(this.url)):Eq}getBitmap(){return this._bitmap?this._bitmap:(this._bitmap=new Promise((e,t)=>{const i=document.createElement("img");i.addEventListener("load",()=>{this._bitmap=createImageBitmap(i).then(s=>(this._bitmapObject=s,e(s),s))}),i.addEventListener("error",s=>{console.error("Failed to load image:"+this.url,s),e(null)}),i.src=this.url}),this._bitmap)}};let dg=Fg;u(dg,"imageReferences",new Map);class Tq extends Bl{constructor(){super([dg])}onSerialize(e,t){return null}onDeserialize(e,t){if(typeof e=="string"){const i=Bp(t.gltfId,e);return dg.getOrCreate(i)}}}new Tq;var Zu;(function(n){n.Visible="application-visible",n.Hidden="application-hidden",n.MuteChanged="application-mutechanged"})(Zu||(Zu={}));class Mq extends EventTarget{constructor(t){super();u(this,"_mute",!1);u(this,"context");u(this,"_isVisible",!0);this.context=t,window.addEventListener("visibilitychange",this.onVisiblityChanged.bind(this),!1)}get muted(){return this._mute}set muted(t){t!==this._mute&&(this._mute=t,this.dispatchEvent(new Event(Zu.MuteChanged)))}get hasFocus(){return document.hasFocus()}get isVisible(){return this._isVisible}onVisiblityChanged(t){switch(t.target.visibilityState){case"hidden":this._isVisible=!1,this.dispatchEvent(new Event(Zu.Hidden));break;case"visible":this._isVisible=!0,this.dispatchEvent(new Event(Zu.Visible));break}}}function*$F(n,e=null){const t=e?e.time:Lt.Current.time,i=t.time;for(;t.time-i<n;)yield}function*Iq(n){let e=!0;for(n.then(()=>e=!1),n.catch(()=>e=!1);e;)yield}const ks=re("debuginput");var zs;(function(n){n.Mouse="mouse",n.Touch="touch",n.Controller="controller",n.Hand="hand"})(zs||(zs={}));var BB;(function(n){n.PointerDown="pointerdown",n.PointerUp="pointerup",n.PointerMove="pointermove"})(BB||(BB={}));var DB;(function(n){n.KeyDown="keydown",n.KeyUp="keyup",n.KeyPressed="keypress"})(DB||(DB={}));var li;(function(n){n.PointerDown="pointerdown",n.PointerUp="pointerup",n.PointerMove="pointermove",n.KeyDown="keydown",n.KeyUp="keyup",n.KeyPressed="keypress"})(li||(li={}));class lh extends PointerEvent{constructor(t,i,s){super(t,s);u(this,"deviceIndex");u(this,"origin");u(this,"source");u(this,"mode");u(this,"ray");u(this,"space");u(this,"isClick",!1);u(this,"isDoubleClick",!1);u(this,"_pointerid");u(this,"_pointerType");u(this,"_type");u(this,"_immediatePropagationStopped",!1);u(this,"_propagationStopped",!1);this._pointerid=s.pointerId,this._pointerType=s.pointerType,this._type=t,this.deviceIndex=s.deviceIndex,this.origin=s.origin,this.source=i,this.mode=s.mode,this.ray=s.ray,this.space=s.device}get pointerId(){return this._pointerid}get pointerType(){return this._pointerType}get type(){return this._type}get immediatePropagationStopped(){return this._immediatePropagationStopped}get propagationStopped(){return this._immediatePropagationStopped||this._propagationStopped}stopImmediatePropagation(){var t;this._immediatePropagationStopped=!0,super.stopImmediatePropagation(),(t=this.source)==null||t.stopImmediatePropagation()}stopPropagation(){var t;this._propagationStopped=!0,super.stopPropagation(),(t=this.source)==null||t.stopPropagation()}}class Dy extends KeyboardEvent{constructor(t,i,s){super(t,s);u(this,"source");this.source=i}stopImmediatePropagation(){var t;super.stopImmediatePropagation(),(t=this.source)==null||t.stopImmediatePropagation()}}class Rq{constructor(e){u(this,"_eventListeners",{});u(this,"_doubleClickTimeThreshold",.2);u(this,"_longPressTimeThreshold",1);u(this,"_specialCursorTrigger",0);u(this,"context");u(this,"_pointerDown",[!1]);u(this,"_pointerUp",[!1]);u(this,"_pointerClick",[!1]);u(this,"_pointerDoubleClick",[!1]);u(this,"_pointerPressed",[!1]);u(this,"_pointerPositions",[new ie]);u(this,"_pointerPositionsLastFrame",[new ie]);u(this,"_pointerPositionsDelta",[new ie]);u(this,"_pointerPositionsRC",[new ie]);u(this,"_pointerPositionDown",[new ie]);u(this,"_pointerDownTime",[]);u(this,"_pointerUpTime",[]);u(this,"_pointerUpTimestamp",[]);u(this,"_pointerIds",[]);u(this,"_pointerTypes",[""]);u(this,"_mouseWheelChanged",[!1]);u(this,"_mouseWheelDeltaY",[0]);u(this,"_pointerEvent",[]);u(this,"_pointerUsed",[]);u(this,"_pointerSpace",[]);u(this,"_pressedStack",new Map);u(this,"_htmlEventSource");u(this,"onLostFocus",()=>{for(const e in this.keysPressed)this.keysPressed[e].pressed=!1});u(this,"onEndOfFrame",()=>{for(let e=0;e<this._pointerUp.length;e++)this._pointerUp[e]=!1;for(let e=0;e<this._pointerDown.length;e++)this._pointerDown[e]=!1;for(let e=0;e<this._pointerClick.length;e++)this._pointerClick[e]=!1;for(let e=0;e<this._pointerDoubleClick.length;e++)this._pointerDoubleClick[e]=!1;for(const e of this._pointerPositionsDelta)e.set(0,0);for(let e=0;e<this._mouseWheelChanged.length;e++)this._mouseWheelChanged[e]=!1;for(let e=0;e<this._mouseWheelDeltaY.length;e++)this._mouseWheelDeltaY[e]=0});u(this,"onContextMenu",e=>{this.canReceiveInput(e)!==!1&&e instanceof PointerEvent&&e.pointerType});u(this,"keysPressed",{});u(this,"onKeyDown",e=>{if(ks&&console.log(`key down ${e.code}, ${this.context.application.hasFocus}`,e),!this.context.application.hasFocus)return;const t=this.keysPressed[e.code];if(t&&t.pressed)return;this.keysPressed[e.code]={pressed:!0,frame:this.context.time.frameCount+1,startFrame:this.context.time.frameCount+1,key:e.key,code:e.code};const i=new Dy(li.KeyDown,e,e);this.onDispatchEvent(i)});u(this,"onKeyPressed",e=>{if(!this.context.application.hasFocus)return;const t=this.keysPressed[e.code];if(!t)return;t.pressed=!0,t.frame=this.context.time.frameCount+1;const i=new Dy(li.KeyPressed,e,e);this.onDispatchEvent(i)});u(this,"onKeyUp",e=>{if(!this.context.application.hasFocus)return;const t=this.keysPressed[e.code];if(!t)return;t.pressed=!1,t.frame=this.context.time.frameCount+1;const i=new Dy(li.KeyUp,e,e);this.onDispatchEvent(i)});u(this,"onMouseWheel",e=>{if(this.canReceiveInput(e)===!1)return;this._mouseWheelDeltaY.length<=0&&this._mouseWheelDeltaY.push(0),this._mouseWheelChanged.length<=0&&this._mouseWheelChanged.push(!1),this._mouseWheelChanged[0]=!0;const t=this._mouseWheelDeltaY[0];this._mouseWheelDeltaY[0]=t+e.deltaY});u(this,"onTouchStartWindow",e=>{this.context.isInAR&&this.onTouchStart(e)});u(this,"onTouchStart",e=>{if(!(e.changedTouches.length<=0)&&this.canReceiveInput(e)!==!1)for(let t=0;t<e.changedTouches.length;t++){const i=e.changedTouches[t],s=this.getPointerIndex(i.identifier);ks&&Tn(`touch start #${s}, identifier:${i.identifier}`);const r=this.getAndUpdateSpatialObjectForScreenPosition(s,i.clientX,i.clientY),o=new lh(li.PointerDown,e,{origin:this,mode:"screen",deviceIndex:0,pointerId:s,button:0,clientX:i.clientX,clientY:i.clientY,pointerType:zs.Touch,buttonName:"unknown",device:r,pressure:i.force});this.onDown(o)}});u(this,"onTouchMove",e=>{if(!(e.changedTouches.length<=0))for(let t=0;t<e.changedTouches.length;t++){const i=e.changedTouches[t],s=this.getPointerIndex(i.identifier),r=this.getAndUpdateSpatialObjectForScreenPosition(s,i.clientX,i.clientY),o=new lh(li.PointerMove,e,{origin:this,mode:"screen",deviceIndex:0,pointerId:s,button:0,clientX:i.clientX,clientY:i.clientY,pointerType:zs.Touch,buttonName:"unknown",device:r,pressure:i.force});this.onMove(o)}});u(this,"onTouchUp",e=>{if(!(e.changedTouches.length<=0))for(let t=0;t<e.changedTouches.length;t++){const i=e.changedTouches[t],s=this.getPointerIndex(i.identifier);if(!this.isNewEvent(e.timeStamp,s,this._pointerUpTimestamp))continue;const r=this.createPointerEventFromTouch("pointerup",i.identifier,i.clientX,i.clientY,i.force,e);this.onUp(r),this._pointerIds.splice(this._pointerIds.indexOf(s),1)}});u(this,"onTouchCancel",e=>{});u(this,"onMouseDown",e=>{if(this.onDownButton(0,e.button),this.context.isInVR||e.defaultPrevented||this.canReceiveInput(e)===!1)return;const t=e.button;let i="none";switch(t){case 0:i="left";break;case 1:i="middle";break;case 2:i="right";break}const s=0+t,r=this.getAndUpdateSpatialObjectForScreenPosition(s,e.clientX,e.clientY),o=new lh(li.PointerDown,e,{origin:this,mode:"screen",deviceIndex:0,pointerId:s,button:t,clientX:e.clientX,clientY:e.clientY,pointerType:zs.Mouse,buttonName:i,device:r,pressure:1});this.onDown(o)});u(this,"onMouseMove",e=>{if(this.context.isInVR||e.defaultPrevented)return;const t=this.getFirstPressedButtonForPointer(0),i=t??0,s=0+i,r=this.getAndUpdateSpatialObjectForScreenPosition(s,e.clientX,e.clientY),o=t!==void 0?1:0,a=new lh(li.PointerMove,e,{origin:this,mode:"screen",deviceIndex:0,pointerId:s,button:i,clientX:e.clientX,clientY:e.clientY,pointerType:zs.Mouse,buttonName:"none",device:r,pressure:o});this.onMove(a)});u(this,"onMouseUp",e=>{if(this.onReleaseButton(0,e.button),this.context.isInVR)return;const t=e.button;if(!this.isNewEvent(e.timeStamp,t,this._pointerUpTimestamp))return;let i="none";switch(t){case 0:i="left";break;case 1:i="middle";break;case 2:i="right";break}const s=0+t;if(e.defaultPrevented)return;const r=this.getAndUpdateSpatialObjectForScreenPosition(s,e.clientX,e.clientY),o=new lh(li.PointerUp,e,{origin:this,mode:"screen",deviceIndex:0,pointerId:s,button:t,clientX:e.clientX,clientY:e.clientY,pointerType:zs.Mouse,buttonName:i,device:r,pressure:0});this.onUp(o)});u(this,"tempNearPlaneVector",new w);u(this,"tempFarPlaneVector",new w);u(this,"tempLookMatrix",new Ce);this.context=e,this.context.post_render_callbacks.push(this.onEndOfFrame)}addEventListener(e,t){this._eventListeners[e]||(this._eventListeners[e]=[]),this._eventListeners[e].push(t)}removeEventListener(e,t){if(!this._eventListeners[e])return;const i=this._eventListeners[e].indexOf(t);i>=0&&this._eventListeners[e].splice(i,1)}dispatchEvent(e){if(e instanceof Dy){const t=this._eventListeners[e.type];if(t)for(const i of t)i(e)}else if(e instanceof lh){const t=this._eventListeners[e.type];if(t)for(const i of t){if(e.immediatePropagationStopped){ks&&console.log("immediatePropagationStopped",e.type);break}i(e)}}}get mousePosition(){return this._pointerPositions[0]}get mousePositionRC(){return this._pointerPositionsRC[0]}get mouseDown(){return this._pointerDown[0]}get mouseUp(){return this._pointerUp[0]}get mouseClick(){return this._pointerClick[0]}get mouseDoubleClick(){return this._pointerDoubleClick[0]}get mousePressed(){return this._pointerPressed[0]}get mouseWheelChanged(){return this.getMouseWheelChanged(0)}setCursorPointer(){this._specialCursorTrigger+=1,this.context.domElement.style.cursor="pointer"}setCursorNormal(){this._specialCursorTrigger-=1,this._specialCursorTrigger=Math.max(0,this._specialCursorTrigger),this._specialCursorTrigger===0&&(this.context.domElement.style.cursor="default")}setPointerUsed(e,t=!0){if(e>=this._pointerUsed.length){if(e>=this._pointerIds.length)return;for(;this._pointerUsed.length<=e;)this._pointerUsed.push(!1)}this._pointerUsed[e]=t}getPointerUsed(e){return e>=this._pointerUsed.length?!1:this._pointerUsed[e]}getPointerPressedCount(){let e=0;for(let t=0;t<this._pointerPressed.length;t++)this._pointerPressed[t]&&e++;return e}getPointerPosition(e){return e>=this._pointerPositions.length?null:this._pointerPositions[e]}getPointerPositionLastFrame(e){return e>=this._pointerPositionsLastFrame.length?null:this._pointerPositionsLastFrame[e]}getPointerPositionDelta(e){return e>=this._pointerPositionsDelta.length?null:this._pointerPositionsDelta[e]}getPointerPositionRC(e){return e>=this._pointerPositionsRC.length?null:this._pointerPositionsRC[e]}getPointerDown(e){return e>=this._pointerDown.length?!1:this._pointerDown[e]}getPointerUp(e){return e>=this._pointerUp.length?!1:this._pointerUp[e]}getPointerPressed(e){return e>=this._pointerPressed.length?!1:this._pointerPressed[e]}getPointerClicked(e){return e>=this._pointerClick.length?!1:this._pointerClick[e]}getPointerDoubleClicked(e){return e>=this._pointerDoubleClick.length?!1:this._pointerDoubleClick[e]}getPointerDownTime(e){return e>=this._pointerDownTime.length?-1:this._pointerDownTime[e]}getPointerUpTime(e){return e>=this._pointerUpTime.length?-1:this._pointerUpTime[e]}getPointerLongPress(e){return e>=this._pointerDownTime.length?!1:this.getPointerPressed(e)&&this.context.time.time-this._pointerDownTime[e]>this._longPressTimeThreshold}getIsMouse(e){return e<0||e>=this._pointerTypes.length?!1:this._pointerTypes[e]===zs.Mouse}getIsTouch(e){return e<0||e>=this._pointerTypes.length?!1:this._pointerTypes[e]===zs.Touch}getTouchesPressedCount(){let e=0;for(let t=0;t<this._pointerPressed.length;t++)this._pointerPressed[t]&&this.getIsTouch(t)&&e++;return e}getMouseWheelChanged(e=0){return e>=this._mouseWheelChanged.length?!1:this._mouseWheelChanged[e]}getMouseWheelDeltaY(e=0){return e>=this._mouseWheelDeltaY.length?0:this._mouseWheelDeltaY[e]}getPointerEvent(e){if(!(e>=this._pointerEvent.length))return this._pointerEvent[e]??void 0}*foreachPointerId(e){for(let t=0;t<this._pointerTypes.length;t++)if(this._pointerIsActive(t)){if(e!==void 0){const i=this._pointerTypes[t];if(Array.isArray(e)){let s=!1;for(const r of e)if(i===r){s=!0;break}if(!s)continue}else if(e!==i)continue}yield t}}*foreachTouchId(){for(let e=0;e<this._pointerTypes.length;e++)this._pointerTypes[e]===zs.Touch&&this._pointerIsActive[e]&&(yield e)}_pointerIsActive(e){return e<0?!1:this._pointerPressed[e]||this._pointerDown[e]||this._pointerUp[e]}onDownButton(e,t){let i=this._pressedStack.get(e);i||(i=[],this._pressedStack.set(e,i)),i.push(t)}onReleaseButton(e,t){const i=this._pressedStack.get(e);if(!i)return;const s=i.indexOf(t);s>=0&&i.splice(s,1)}getFirstPressedButtonForPointer(e){const t=this._pressedStack.get(e);if(t)return t[0]}getLatestPressedButtonForPointer(e){const t=this._pressedStack.get(e);if(t)return t[t.length-1]}getKeyDown(){for(const e in this.keysPressed){const t=this.keysPressed[e];if(t.startFrame===this.context.time.frameCount)return t.key}return null}getKeyPressed(){for(const e in this.keysPressed){const t=this.keysPressed[e];if(t.pressed)return t.key}return null}isKeyDown(e){var i;if(!this.context.application.isVisible||!this.context.application.hasFocus)return!1;const t=this.getCodeForCommonKeyName(e);if(t!==null){for(const s of t)if(this.isKeyDown(s))return!0;return!1}return((i=this.keysPressed[e])==null?void 0:i.startFrame)===this.context.time.frameCount&&this.keysPressed[e].pressed}isKeyUp(e){var i;if(!this.context.application.isVisible||!this.context.application.hasFocus)return!1;const t=this.getCodeForCommonKeyName(e);if(t!==null){for(const s of t)if(this.isKeyUp(s))return!0;return!1}return((i=this.keysPressed[e])==null?void 0:i.frame)===this.context.time.frameCount&&!this.keysPressed[e].pressed}isKeyPressed(e){var i;if(!this.context.application.isVisible||!this.context.application.hasFocus)return!1;const t=this.getCodeForCommonKeyName(e);if(t!==null){for(const s of t)if(this.isKeyPressed(s))return!0;return!1}return(i=this.keysPressed[e])==null?void 0:i.pressed}getCodeForCommonKeyName(e){if(e.length===1){if(e>="0"&&e<="9")return["Digit"+e];if(e>="a"&&e<="z")return["Key"+e.toUpperCase()];if(e==" ")return["Space"]}switch(e){case"shift":case"Shift":return["ShiftLeft","ShiftRight"];case"control":case"Control":return["ControlLeft","ControlRight"];case"alt":case"Alt":return["AltLeft","AltRight"]}return null}createInputEvent(e){switch(e.type){case li.PointerDown:ks&&Tn("Create Pointer down"),this.onDownButton(e.deviceIndex,e.button),this.onDown(e);break;case li.PointerMove:ks&&Tn("Create Pointer move"),this.onMove(e);break;case li.PointerUp:ks&&Tn("Create Pointer up"),this.onUp(e),this.onReleaseButton(e.deviceIndex,e.button);break}}convertScreenspaceToRaycastSpace(e){e.x=(e.x-this.context.domX)/this.context.domWidth*2-1,e.y=-((e.y-this.context.domY)/this.context.domHeight)*2+1}bindEvents(){this.unbindEvents(),this._htmlEventSource=this.context.renderer.domElement,window.addEventListener("contextmenu",this.onContextMenu),this._htmlEventSource.addEventListener("touchstart",this.onTouchStart,!1),window.addEventListener("touchstart",this.onTouchStartWindow),window.addEventListener("touchmove",this.onTouchMove,{passive:!0}),window.addEventListener("touchend",this.onTouchUp,!1),window.addEventListener("touchcancel",this.onTouchCancel,!1),this._htmlEventSource.addEventListener("mousedown",this.onMouseDown),window.addEventListener("mousemove",this.onMouseMove,!1),window.addEventListener("mouseup",this.onMouseUp,!1),this._htmlEventSource.addEventListener("wheel",this.onMouseWheel,{passive:!0}),window.addEventListener("keydown",this.onKeyDown,!1),window.addEventListener("keypress",this.onKeyPressed,!1),window.addEventListener("keyup",this.onKeyUp,!1),window.addEventListener("blur",this.onLostFocus)}unbindEvents(){var e,t,i;window.removeEventListener("contextmenu",this.onContextMenu),(e=this._htmlEventSource)==null||e.removeEventListener("touchstart",this.onTouchStart,!1),window.removeEventListener("touchstart",this.onTouchStartWindow),window.removeEventListener("touchmove",this.onTouchMove,!1),window.removeEventListener("touchend",this.onTouchUp,!1),window.removeEventListener("touchcancel",this.onTouchCancel,!1),(t=this._htmlEventSource)==null||t.removeEventListener("mousedown",this.onMouseDown,!1),window.removeEventListener("mousemove",this.onMouseMove,!1),window.removeEventListener("mouseup",this.onMouseUp,!1),(i=this._htmlEventSource)==null||i.removeEventListener("wheel",this.onMouseWheel,!1),window.removeEventListener("keydown",this.onKeyDown,!1),window.removeEventListener("keypress",this.onKeyPressed,!1),window.removeEventListener("keyup",this.onKeyUp,!1),window.removeEventListener("blur",this.onLostFocus)}dispose(){const e=this.context.post_render_callbacks.indexOf(this.onEndOfFrame);e>=0&&this.context.post_render_callbacks.splice(e,1),this.unbindEvents()}canReceiveInput(e){var t;return!!(e.target===((t=this.context.renderer)==null?void 0:t.domElement)||e.target===this.context.domElement||this.context.isInAR&&e.target===document.body&&$f())}createPointerEventFromTouch(e,t,i,s,r,o){const a=this.getPointerIndex(t);ks&&Tn(`touch up #${a}, identifier:${t}`);const c=this.getAndUpdateSpatialObjectForScreenPosition(a,i,s);return new lh(e,o,{origin:this,mode:"screen",deviceIndex:0,pointerId:a,button:0,clientX:i,clientY:s,pointerType:zs.Touch,buttonName:"unknown",device:c,pressure:r})}getAndUpdateSpatialObjectForScreenPosition(e,t,i){let s=this._pointerSpace[e];s||(s=new ge,this._pointerSpace[e]=s),this._pointerSpace[e]=s;const r=this.context.mainCamera;if(r){const o=this.tempNearPlaneVector.set(t,i,-1);this.convertScreenspaceToRaycastSpace(o);const a=this.tempFarPlaneVector.set(o.x,o.y,1);o.unproject(r),a.unproject(r),this.tempLookMatrix.lookAt(a,o,r.worldUp),s.position.set(o.x,o.y,o.z),s.quaternion.setFromRotationMatrix(this.tempLookMatrix)}return s}isNewEvent(e,t,i){for(;i.length<=t;)i.push(-1);return e===i[t]?!1:(i[t]=e,!0)}isInRect(e){if(this.context.isInXR)return!0;const t=this.context.domElement.getBoundingClientRect(),i=e.clientX,s=e.clientY,r=i>=t.x&&i<=t.right&&s>=t.y&&s<=t.bottom;return ks&&!r&&console.log("Not in rect",t,i,s),r}onDown(e){const t=e.pointerId;if(this.getPointerPressed(t)&&console.warn(`pointerId is already pressed: ${t}`,ks?e:""),ks&&console.log(e.pointerType,"DOWN",t),!!this.isInRect(e)&&!this.isMouseEventEmmitedFromTouch(e)){for(this.setPointerState(t,this._pointerPressed,!0),this.setPointerState(t,this._pointerDown,!0),this.setPointerStateT(t,this._pointerEvent,e.source);t>=this._pointerTypes.length;)this._pointerTypes.push(e.pointerType);for(this._pointerTypes[t]=e.pointerType;t>=this._pointerPositionDown.length;)this._pointerPositionDown.push(new ie);for(this._pointerPositionDown[t].set(e.clientX,e.clientY);t>=this._pointerPositions.length;)this._pointerPositions.push(new ie);this._pointerPositions[t].set(e.clientX,e.clientY),t>=this._pointerDownTime.length&&this._pointerDownTime.push(0),this._pointerDownTime[t]=this.context.time.time,this.updatePointerPosition(e),this.onDispatchEvent(e)}}onMove(e){const t=e.pointerId,i=this.getPointerPressed(t);i===!1&&!this.isInRect(e)||e.pointerType===zs.Touch&&!i||this.isMouseEventEmmitedFromTouch(e)||(ks&&console.log(e.pointerType,"MOVE",t,"hasSpace="+e.space!=null),this.updatePointerPosition(e),this.setPointerStateT(t,this._pointerEvent,e.source),this.onDispatchEvent(e))}onUp(e){const t=e.pointerId;if(!this.getPointerPressed(t)){ks&&console.log(e.pointerType,"UP",t,"was not down");return}if(this.isMouseEventEmmitedFromTouch(e))return;for(ks&&console.log(e.pointerType,"UP",t),this.setPointerState(t,this._pointerPressed,!1),this.setPointerStateT(t,this._pointerEvent,e.source),this.setPointerState(t,this._pointerUp,!0);t>=this._pointerUsed.length;)this._pointerUsed.push(!1);if(this.setPointerState(t,this._pointerUsed,!1),this.updatePointerPosition(e),!this._pointerPositionDown[t]){ks&&gn("Received pointer up event without matching down event for button: "+t),console.warn("Received pointer up event without matching down event for button: "+t);return}const s=e.clientX-this._pointerPositionDown[t].x,r=e.clientY-this._pointerPositionDown[t].y;if(t>=this._pointerUpTime.length&&this._pointerUpTime.push(-99),Math.abs(s)<5&&Math.abs(r)<5){ks&&console.log("CLICK",t),this.setPointerState(t,this._pointerClick,!0),e.isClick=!0;const o=this._pointerUpTime[t],a=this.context.time.time-o;a<this._doubleClickTimeThreshold&&a>0&&(this.setPointerState(t,this._pointerDoubleClick,!0),e.isDoubleClick=!0)}this._pointerUpTime[t]=this.context.time.time,this.onDispatchEvent(e)}isMouseEventEmmitedFromTouch(e){var t;if(e.pointerType===zs.Mouse){const i=this._pointerUpTimestamp.map((s,r)=>({timestamp:s,index:r})).sort((s,r)=>s.timestamp-r.timestamp).at(-1);if(i&&this._pointerTypes[i.index]===zs.Touch&&i.timestamp>0&&((t=e.source)==null?void 0:t.timeStamp)!==void 0){const s=e.source.timeStamp-i.timestamp;if(s<320&&s>=0)return ks&&console.log("Ignoring mouse.down for touch.up"),!0}}return!1}updatePointerPosition(e){const t=e.pointerId;for(;t>=this._pointerPositions.length;)this._pointerPositions.push(new ie);for(;t>=this._pointerPositionsLastFrame.length;)this._pointerPositionsLastFrame.push(new ie);for(;t>=this._pointerPositionsDelta.length;)this._pointerPositionsDelta.push(new ie);const i=this._pointerPositionsLastFrame[t];i.copy(this._pointerPositions[t]);const s=this._pointerPositionsDelta[t];let r=e.clientX-i.x,o=e.clientY-i.y;if(e.source instanceof MouseEvent||e.source instanceof TouchEvent){const h=e.source;r===0&&h.movementX!==0&&(r=h.movementX||0),o===0&&h.movementY!==0&&(o=h.movementY||0)}s.x+=r,s.y+=o,this._pointerPositions[t].x=e.clientX,this._pointerPositions[t].y=e.clientY;const a=e.clientX,c=e.clientY;for(;t>=this._pointerPositionsRC.length;)this._pointerPositionsRC.push(new ie);const l=this._pointerPositionsRC[t];l.set(a,c),this.convertScreenspaceToRaycastSpace(l)}getPointerIndex(e){const t=this._pointerIds;let i=-1;for(let s=0;s<t.length;s++){if(t[s]===e)return s;i===-1&&t[s]===-1&&(i=s)}return i!==-1?(t[i]=e,i):(t.push(e),t.length-1)}setPointerState(e,t,i){t[e]=i}setPointerStateT(e,t,i){return t[e]=i,i}onDispatchEvent(e){const t=Lt.Current;try{Lt.Current=this.context,this.dispatchEvent(e)}finally{Lt.Current=t}}}const fg=new Map;function eU(n,e){fg.has(e)||fg.set(e,new Array),fg.get(e).push(n)}function Pq(n,e){const t=fg.get(e);if(t){const i=t.indexOf(n);i>=0&&t.splice(i,1)}}function gu(n,e){const t=fg.get(e);if(t&&t.length>0){let i=t;e===jt.Start&&(i=[...t],t.length=0),Bq(n,i)}}function Bq(n,e){for(let t=e.length-1;t>=0;t--){const i=e[t];Ku(i,n)}}/*!
fflate - fast JavaScript compression/decompression
<https://101arrowz.github.io/fflate>
Licensed under MIT. https://github.com/101arrowz/fflate/blob/master/LICENSE
version 0.6.9
*/var OB=function(n){return URL.createObjectURL(new Blob([n],{type:"text/javascript"}))};try{URL.revokeObjectURL(OB(""))}catch{OB=function(e){return"data:application/javascript;charset=UTF-8,"+encodeURI(e)}}var On=Uint8Array,mr=Uint16Array,Ap=Uint32Array,lx=new On([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),hx=new On([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),NE=new On([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),tU=function(n,e){for(var t=new mr(31),i=0;i<31;++i)t[i]=e+=1<<n[i-1];for(var s=new Ap(t[30]),i=1;i<30;++i)for(var r=t[i];r<t[i+1];++r)s[r]=r-t[i]<<5|i;return[t,s]},iU=tU(lx,2),nU=iU[0],zE=iU[1];nU[28]=258,zE[258]=28;var sU=tU(hx,0),Dq=sU[0],kB=sU[1],GE=new mr(32768);for(var ji=0;ji<32768;++ji){var ih=(ji&43690)>>>1|(ji&21845)<<1;ih=(ih&52428)>>>2|(ih&13107)<<2,ih=(ih&61680)>>>4|(ih&3855)<<4,GE[ji]=((ih&65280)>>>8|(ih&255)<<8)>>>1}var dc=function(n,e,t){for(var i=n.length,s=0,r=new mr(e);s<i;++s)++r[n[s]-1];var o=new mr(e);for(s=0;s<e;++s)o[s]=o[s-1]+r[s-1]<<1;var a;if(t){a=new mr(1<<e);var c=15-e;for(s=0;s<i;++s)if(n[s])for(var l=s<<4|n[s],h=e-n[s],d=o[n[s]-1]++<<h,f=d|(1<<h)-1;d<=f;++d)a[GE[d]>>>c]=l}else for(a=new mr(i),s=0;s<i;++s)n[s]&&(a[s]=GE[o[n[s]-1]++]>>>15-n[s]);return a},Hh=new On(288);for(var ji=0;ji<144;++ji)Hh[ji]=8;for(var ji=144;ji<256;++ji)Hh[ji]=9;for(var ji=256;ji<280;++ji)Hh[ji]=7;for(var ji=280;ji<288;++ji)Hh[ji]=8;var cA=new On(32);for(var ji=0;ji<32;++ji)cA[ji]=5;var Oq=dc(Hh,9,0),kq=dc(Hh,9,1),Lq=dc(cA,5,0),Fq=dc(cA,5,1),xS=function(n){for(var e=n[0],t=1;t<n.length;++t)n[t]>e&&(e=n[t]);return e},Xo=function(n,e,t){var i=e/8|0;return(n[i]|n[i+1]<<8)>>(e&7)&t},wS=function(n,e){var t=e/8|0;return(n[t]|n[t+1]<<8|n[t+2]<<16)>>(e&7)},f1=function(n){return(n/8|0)+(n&7&&1)},p1=function(n,e,t){(e==null||e<0)&&(e=0),(t==null||t>n.length)&&(t=n.length);var i=new(n instanceof mr?mr:n instanceof Ap?Ap:On)(t-e);return i.set(n.subarray(e,t)),i},Uq=function(n,e,t){var i=n.length;if(!i||t&&!t.l&&i<5)return e||new On(0);var s=!e||t,r=!t||t.i;t||(t={}),e||(e=new On(i*3));var o=function(ae){var ve=e.length;if(ae>ve){var Ue=new On(Math.max(ve*2,ae));Ue.set(e),e=Ue}},a=t.f||0,c=t.p||0,l=t.b||0,h=t.l,d=t.d,f=t.m,p=t.n,m=i*8;do{if(!h){t.f=a=Xo(n,c,1);var g=Xo(n,c+1,3);if(c+=3,g)if(g==1)h=kq,d=Fq,f=9,p=5;else if(g==2){var b=Xo(n,c,31)+257,_=Xo(n,c+10,15)+4,T=b+Xo(n,c+5,31)+1;c+=14;for(var E=new On(T),M=new On(19),I=0;I<_;++I)M[NE[I]]=Xo(n,c+I*3,7);c+=_*3;for(var S=xS(M),C=(1<<S)-1,D=dc(M,S,1),I=0;I<T;){var G=D[Xo(n,c,C)];c+=G&15;var y=G>>>4;if(y<16)E[I++]=y;else{var Q=0,L=0;for(y==16?(L=3+Xo(n,c,3),c+=2,Q=E[I-1]):y==17?(L=3+Xo(n,c,7),c+=3):y==18&&(L=11+Xo(n,c,127),c+=7);L--;)E[I++]=Q}}var V=E.subarray(0,b),O=E.subarray(b);f=xS(V),p=xS(O),h=dc(V,f,1),d=dc(O,p,1)}else throw"invalid block type";else{var y=f1(c)+4,A=n[y-4]|n[y-3]<<8,v=y+A;if(v>i){if(r)throw"unexpected EOF";break}s&&o(l+A),e.set(n.subarray(y,v),l),t.b=l+=A,t.p=c=v*8;continue}if(c>m){if(r)throw"unexpected EOF";break}}s&&o(l+131072);for(var U=(1<<f)-1,H=(1<<p)-1,Y=c;;Y=c){var Q=h[wS(n,c)&U],J=Q>>>4;if(c+=Q&15,c>m){if(r)throw"unexpected EOF";break}if(!Q)throw"invalid length/literal";if(J<256)e[l++]=J;else if(J==256){Y=c,h=null;break}else{var se=J-254;if(J>264){var I=J-257,fe=lx[I];se=Xo(n,c,(1<<fe)-1)+nU[I],c+=fe}var _e=d[wS(n,c)&H],Oe=_e>>>4;if(!_e)throw"invalid distance";c+=_e&15;var O=Dq[Oe];if(Oe>3){var fe=hx[Oe];O+=wS(n,c)&(1<<fe)-1,c+=fe}if(c>m){if(r)throw"unexpected EOF";break}s&&o(l+131072);for(var qe=l+se;l<qe;l+=4)e[l]=e[l-O],e[l+1]=e[l+1-O],e[l+2]=e[l+2-O],e[l+3]=e[l+3-O];l=qe}}t.l=h,t.p=Y,t.b=l,h&&(a=1,t.m=f,t.d=d,t.n=p)}while(!a);return l==e.length?e:p1(e,0,l)},kc=function(n,e,t){t<<=e&7;var i=e/8|0;n[i]|=t,n[i+1]|=t>>>8},_m=function(n,e,t){t<<=e&7;var i=e/8|0;n[i]|=t,n[i+1]|=t>>>8,n[i+2]|=t>>>16},SS=function(n,e){for(var t=[],i=0;i<n.length;++i)n[i]&&t.push({s:i,f:n[i]});var s=t.length,r=t.slice();if(!s)return[m1,0];if(s==1){var o=new On(t[0].s+1);return o[t[0].s]=1,[o,1]}t.sort(function(T,E){return T.f-E.f}),t.push({s:-1,f:25001});var a=t[0],c=t[1],l=0,h=1,d=2;for(t[0]={s:-1,f:a.f+c.f,l:a,r:c};h!=s-1;)a=t[t[l].f<t[d].f?l++:d++],c=t[l!=h&&t[l].f<t[d].f?l++:d++],t[h++]={s:-1,f:a.f+c.f,l:a,r:c};for(var f=r[0].s,i=1;i<s;++i)r[i].s>f&&(f=r[i].s);var p=new mr(f+1),m=VE(t[h-1],p,0);if(m>e){var i=0,g=0,y=m-e,A=1<<y;for(r.sort(function(E,M){return p[M.s]-p[E.s]||E.f-M.f});i<s;++i){var v=r[i].s;if(p[v]>e)g+=A-(1<<m-p[v]),p[v]=e;else break}for(g>>>=y;g>0;){var b=r[i].s;p[b]<e?g-=1<<e-p[b]++-1:++i}for(;i>=0&&g;--i){var _=r[i].s;p[_]==e&&(--p[_],++g)}m=e}return[new On(p),m]},VE=function(n,e,t){return n.s==-1?Math.max(VE(n.l,e,t+1),VE(n.r,e,t+1)):e[n.s]=t},LB=function(n){for(var e=n.length;e&&!n[--e];);for(var t=new mr(++e),i=0,s=n[0],r=1,o=function(c){t[i++]=c},a=1;a<=e;++a)if(n[a]==s&&a!=e)++r;else{if(!s&&r>2){for(;r>138;r-=138)o(32754);r>2&&(o(r>10?r-11<<5|28690:r-3<<5|12305),r=0)}else if(r>3){for(o(s),--r;r>6;r-=6)o(8304);r>2&&(o(r-3<<5|8208),r=0)}for(;r--;)o(s);r=1,s=n[a]}return[t.subarray(0,i),e]},xm=function(n,e){for(var t=0,i=0;i<e.length;++i)t+=n[i]*e[i];return t},M0=function(n,e,t){var i=t.length,s=f1(e+2);n[s]=i&255,n[s+1]=i>>>8,n[s+2]=n[s]^255,n[s+3]=n[s+1]^255;for(var r=0;r<i;++r)n[s+r+4]=t[r];return(s+4+i)*8},FB=function(n,e,t,i,s,r,o,a,c,l,h){kc(e,h++,t),++s[256];for(var d=SS(s,15),f=d[0],p=d[1],m=SS(r,15),g=m[0],y=m[1],A=LB(f),v=A[0],b=A[1],_=LB(g),T=_[0],E=_[1],M=new mr(19),I=0;I<v.length;++I)M[v[I]&31]++;for(var I=0;I<T.length;++I)M[T[I]&31]++;for(var S=SS(M,7),C=S[0],D=S[1],G=19;G>4&&!C[NE[G-1]];--G);var Q=l+5<<3,L=xm(s,Hh)+xm(r,cA)+o,V=xm(s,f)+xm(r,g)+o+14+3*G+xm(M,C)+(2*M[16]+3*M[17]+7*M[18]);if(Q<=L&&Q<=V)return M0(e,h,n.subarray(c,c+l));var O,U,H,Y;if(kc(e,h,1+(V<L)),h+=2,V<L){O=dc(f,p,0),U=f,H=dc(g,y,0),Y=g;var J=dc(C,D,0);kc(e,h,b-257),kc(e,h+5,E-1),kc(e,h+10,G-4),h+=14;for(var I=0;I<G;++I)kc(e,h+3*I,C[NE[I]]);h+=3*G;for(var se=[v,T],fe=0;fe<2;++fe)for(var _e=se[fe],I=0;I<_e.length;++I){var Oe=_e[I]&31;kc(e,h,J[Oe]),h+=C[Oe],Oe>15&&(kc(e,h,_e[I]>>>5&127),h+=_e[I]>>>12)}}else O=Oq,U=Hh,H=Lq,Y=cA;for(var I=0;I<a;++I)if(i[I]>255){var Oe=i[I]>>>18&31;_m(e,h,O[Oe+257]),h+=U[Oe+257],Oe>7&&(kc(e,h,i[I]>>>23&31),h+=lx[Oe]);var qe=i[I]&31;_m(e,h,H[qe]),h+=Y[qe],qe>3&&(_m(e,h,i[I]>>>5&8191),h+=hx[qe])}else _m(e,h,O[i[I]]),h+=U[i[I]];return _m(e,h,O[256]),h+U[256]},Nq=new Ap([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),m1=new On(0),zq=function(n,e,t,i,s,r){var o=n.length,a=new On(i+o+5*(1+Math.ceil(o/7e3))+s),c=a.subarray(i,a.length-s),l=0;if(!e||o<8)for(var h=0;h<=o;h+=65535){var d=h+65535;d<o?l=M0(c,l,n.subarray(h,d)):(c[h]=r,l=M0(c,l,n.subarray(h,o)))}else{for(var f=Nq[e-1],p=f>>>13,m=f&8191,g=(1<<t)-1,y=new mr(32768),A=new mr(g+1),v=Math.ceil(t/3),b=2*v,_=function(Ae){return(n[Ae]^n[Ae+1]<<v^n[Ae+2]<<b)&g},T=new Ap(25e3),E=new mr(288),M=new mr(32),I=0,S=0,h=0,C=0,D=0,G=0;h<o;++h){var Q=_(h),L=h&32767,V=A[Q];if(y[L]=V,A[Q]=L,D<=h){var O=o-h;if((I>7e3||C>24576)&&O>423){l=FB(n,c,0,T,E,M,S,C,G,h-G,l),C=I=S=0,G=h;for(var U=0;U<286;++U)E[U]=0;for(var U=0;U<30;++U)M[U]=0}var H=2,Y=0,J=m,se=L-V&32767;if(O>2&&Q==_(h-se))for(var fe=Math.min(p,O)-1,_e=Math.min(32767,h),Oe=Math.min(258,O);se<=_e&&--J&&L!=V;){if(n[h+H]==n[h+H-se]){for(var qe=0;qe<Oe&&n[h+qe]==n[h+qe-se];++qe);if(qe>H){if(H=qe,Y=se,qe>fe)break;for(var ae=Math.min(se,qe-2),ve=0,U=0;U<ae;++U){var Ue=h-se+U+32768&32767,Ge=y[Ue],Xe=Ue-Ge+32768&32767;Xe>ve&&(ve=Xe,V=Ue)}}}L=V,V=y[L],se+=L-V+32768&32767}if(Y){T[C++]=268435456|zE[H]<<18|kB[Y];var ze=zE[H]&31,Pe=kB[Y]&31;S+=lx[ze]+hx[Pe],++E[257+ze],++M[Pe],D=h+H,++I}else T[C++]=n[h],++E[n[h]]}}l=FB(n,c,r,T,E,M,S,C,G,h-G,l),!r&&l&7&&(l=M0(c,l+1,m1))}return p1(a,0,i+f1(l)+s)},Gq=function(){for(var n=new Ap(256),e=0;e<256;++e){for(var t=e,i=9;--i;)t=(t&1&&3988292384)^t>>>1;n[e]=t}return n}(),Vq=function(){var n=-1;return{p:function(e){for(var t=n,i=0;i<e.length;++i)t=Gq[t&255^e[i]]^t>>>8;n=t},d:function(){return~n}}},Hq=function(n,e,t,i,s){return zq(n,e.level==null?6:e.level,e.mem==null?Math.ceil(Math.max(8,Math.min(13,Math.log(n.length)))*1.5):12+e.mem,t,i,!s)},rU=function(n,e){var t={};for(var i in n)t[i]=n[i];for(var i in e)t[i]=e[i];return t},gs=function(n,e,t){for(;t;++e)n[e]=t,t>>>=8},Qq=function(n){if((n[0]&15)!=8||n[0]>>>4>7||(n[0]<<8|n[1])%31)throw"invalid zlib data";if(n[1]&32)throw"invalid zlib data: preset dictionaries not supported"};function jq(n,e){return Hq(n,e||{},0,0)}function Oy(n,e){return Uq((Qq(n),n.subarray(2,-4)),e)}var oU=function(n,e,t,i){for(var s in n){var r=n[s],o=e+s;r instanceof On?t[o]=[r,i]:Array.isArray(r)?t[o]=[r[0],rU(i,r[1])]:oU(r,o+"/",t,i)}},UB=typeof TextEncoder<"u"&&new TextEncoder,Wq=typeof TextDecoder<"u"&&new TextDecoder,qq=0;try{Wq.decode(m1,{stream:!0}),qq=1}catch{}function yb(n,e){if(e){for(var t=new On(n.length),i=0;i<n.length;++i)t[i]=n.charCodeAt(i);return t}if(UB)return UB.encode(n);for(var s=n.length,r=new On(n.length+(n.length>>1)),o=0,a=function(h){r[o++]=h},i=0;i<s;++i){if(o+5>r.length){var c=new On(o+8+(s-i<<1));c.set(r),r=c}var l=n.charCodeAt(i);l<128||e?a(l):l<2048?(a(192|l>>6),a(128|l&63)):l>55295&&l<57344?(l=65536+(l&1047552)|n.charCodeAt(++i)&1023,a(240|l>>18),a(128|l>>12&63),a(128|l>>6&63),a(128|l&63)):(a(224|l>>12),a(128|l>>6&63),a(128|l&63))}return p1(r,0,o)}var HE=function(n){var e=0;if(n)for(var t in n){var i=n[t].length;if(i>65535)throw"extra field too long";e+=i+4}return e},NB=function(n,e,t,i,s,r,o,a){var c=i.length,l=t.extra,h=a&&a.length,d=HE(l);gs(n,e,o!=null?33639248:67324752),e+=4,o!=null&&(n[e++]=20,n[e++]=t.os),n[e]=20,e+=2,n[e++]=t.flag<<1|(r==null&&8),n[e++]=s&&8,n[e++]=t.compression&255,n[e++]=t.compression>>8;var f=new Date(t.mtime==null?Date.now():t.mtime),p=f.getFullYear()-1980;if(p<0||p>119)throw"date not in range 1980-2099";if(gs(n,e,p<<25|f.getMonth()+1<<21|f.getDate()<<16|f.getHours()<<11|f.getMinutes()<<5|f.getSeconds()>>>1),e+=4,r!=null&&(gs(n,e,t.crc),gs(n,e+4,r),gs(n,e+8,t.size)),gs(n,e+12,c),gs(n,e+14,d),e+=16,o!=null&&(gs(n,e,h),gs(n,e+6,t.attrs),gs(n,e+10,o),e+=14),n.set(i,e),e+=c,d)for(var m in l){var g=l[m],y=g.length;gs(n,e,+m),gs(n,e+2,y),n.set(g,e+4),e+=4+y}return h&&(n.set(a,e),e+=h),e},Xq=function(n,e,t,i,s){gs(n,e,101010256),gs(n,e+8,t),gs(n,e+10,t),gs(n,e+12,i),gs(n,e+16,s)};function Yq(n,e){e||(e={});var t={},i=[];oU(n,"",t,e);var s=0,r=0;for(var o in t){var a=t[o],c=a[0],l=a[1],h=l.level==0?0:8,d=yb(o),f=d.length,p=l.comment,m=p&&yb(p),g=m&&m.length,y=HE(l.extra);if(f>65535)throw"filename too long";var A=h?jq(c,l):c,v=A.length,b=Vq();b.p(c),i.push(rU(l,{size:c.length,crc:b.d(),c:A,f:d,m,u:f!=o.length||m&&p.length!=g,o:s,compression:h})),s+=30+f+y+v,r+=76+2*(f+y)+(g||0)+v}for(var _=new On(r+22),T=s,E=r-s,M=0;M<i.length;++M){var d=i[M];NB(_,d.o,d,d.f,d.u,d.c.length);var I=30+d.f.length+HE(d.extra);_.set(d.c,d.o+I),NB(_,s,d,d.f,d.u,d.c.length,d.o,d.m),s+=16+I+(d.m?d.m.length:0)}return Xq(_,s,i.length,E,T),_}class bb extends VM{constructor(e){super(e),this.type=sn}parse(e){const S=Math.pow(2.7182818,2.2);function C(R,N){let K=0;for(let P=0;P<65536;++P)(P==0||R[P>>3]&1<<(P&7))&&(N[K++]=P);const ue=K-1;for(;K<65536;)N[K++]=0;return ue}function D(R){for(let N=0;N<16384;N++)R[N]={},R[N].len=0,R[N].lit=0,R[N].p=null}const G={l:0,c:0,lc:0};function Q(R,N,K,ue,P){for(;K<R;)N=N<<8|Ve(ue,P),K+=8;K-=R,G.l=N>>K&(1<<R)-1,G.c=N,G.lc=K}const L=new Array(59);function V(R){for(let K=0;K<=58;++K)L[K]=0;for(let K=0;K<65537;++K)L[R[K]]+=1;let N=0;for(let K=58;K>0;--K){const ue=N+L[K]>>1;L[K]=N,N=ue}for(let K=0;K<65537;++K){const ue=R[K];ue>0&&(R[K]=ue|L[ue]++<<6)}}function O(R,N,K,ue,P,z){const W=N;let $=0,Z=0;for(;ue<=P;ue++){if(W.value-N.value>K)return!1;Q(6,$,Z,R,W);const he=G.l;if($=G.c,Z=G.lc,z[ue]=he,he==63){if(W.value-N.value>K)throw new Error("Something wrong with hufUnpackEncTable");Q(8,$,Z,R,W);let pe=G.l+6;if($=G.c,Z=G.lc,ue+pe>P+1)throw new Error("Something wrong with hufUnpackEncTable");for(;pe--;)z[ue++]=0;ue--}else if(he>=59){let pe=he-59+2;if(ue+pe>P+1)throw new Error("Something wrong with hufUnpackEncTable");for(;pe--;)z[ue++]=0;ue--}}V(z)}function U(R){return R&63}function H(R){return R>>6}function Y(R,N,K,ue){for(;N<=K;N++){const P=H(R[N]),z=U(R[N]);if(P>>z)throw new Error("Invalid table entry");if(z>14){const W=ue[P>>z-14];if(W.len)throw new Error("Invalid table entry");if(W.lit++,W.p){const $=W.p;W.p=new Array(W.lit);for(let Z=0;Z<W.lit-1;++Z)W.p[Z]=$[Z]}else W.p=new Array(1);W.p[W.lit-1]=N}else if(z){let W=0;for(let $=1<<14-z;$>0;$--){const Z=ue[(P<<14-z)+W];if(Z.len||Z.p)throw new Error("Invalid table entry");Z.len=z,Z.lit=N,W++}}}return!0}const J={c:0,lc:0};function se(R,N,K,ue){R=R<<8|Ve(K,ue),N+=8,J.c=R,J.lc=N}const fe={c:0,lc:0};function _e(R,N,K,ue,P,z,W,$,Z){if(R==N){ue<8&&(se(K,ue,P,z),K=J.c,ue=J.lc),ue-=8;let he=K>>ue;if(he=new Uint8Array([he])[0],$.value+he>Z)return!1;const pe=W[$.value-1];for(;he-- >0;)W[$.value++]=pe}else if($.value<Z)W[$.value++]=R;else return!1;fe.c=K,fe.lc=ue}function Oe(R){return R&65535}function qe(R){const N=Oe(R);return N>32767?N-65536:N}const ae={a:0,b:0};function ve(R,N){const K=qe(R),P=qe(N),z=K+(P&1)+(P>>1),W=z,$=z-P;ae.a=W,ae.b=$}function Ue(R,N){const K=Oe(R),ue=Oe(N),P=K-(ue>>1)&65535,z=ue+P-32768&65535;ae.a=z,ae.b=P}function Ge(R,N,K,ue,P,z,W){const $=W<16384,Z=K>P?P:K;let he=1,pe,Re;for(;he<=Z;)he<<=1;for(he>>=1,pe=he,he>>=1;he>=1;){Re=0;const Be=Re+z*(P-pe),Qe=z*he,Je=z*pe,Le=ue*he,$e=ue*pe;let wt,Qt,yi,$t;for(;Re<=Be;Re+=Je){let ut=Re;const ei=Re+ue*(K-pe);for(;ut<=ei;ut+=$e){const Ut=ut+Le,Rn=ut+Qe,yn=Rn+Le;$?(ve(R[ut+N],R[Rn+N]),wt=ae.a,yi=ae.b,ve(R[Ut+N],R[yn+N]),Qt=ae.a,$t=ae.b,ve(wt,Qt),R[ut+N]=ae.a,R[Ut+N]=ae.b,ve(yi,$t),R[Rn+N]=ae.a,R[yn+N]=ae.b):(Ue(R[ut+N],R[Rn+N]),wt=ae.a,yi=ae.b,Ue(R[Ut+N],R[yn+N]),Qt=ae.a,$t=ae.b,Ue(wt,Qt),R[ut+N]=ae.a,R[Ut+N]=ae.b,Ue(yi,$t),R[Rn+N]=ae.a,R[yn+N]=ae.b)}if(K&he){const Ut=ut+Qe;$?ve(R[ut+N],R[Ut+N]):Ue(R[ut+N],R[Ut+N]),wt=ae.a,R[Ut+N]=ae.b,R[ut+N]=wt}}if(P&he){let ut=Re;const ei=Re+ue*(K-pe);for(;ut<=ei;ut+=$e){const Ut=ut+Le;$?ve(R[ut+N],R[Ut+N]):Ue(R[ut+N],R[Ut+N]),wt=ae.a,R[Ut+N]=ae.b,R[ut+N]=wt}}pe=he,he>>=1}return Re}function Xe(R,N,K,ue,P,z,W,$,Z){let he=0,pe=0;const Re=W,Be=Math.trunc(ue.value+(P+7)/8);for(;ue.value<Be;)for(se(he,pe,K,ue),he=J.c,pe=J.lc;pe>=14;){const Je=he>>pe-14&16383,Le=N[Je];if(Le.len)pe-=Le.len,_e(Le.lit,z,he,pe,K,ue,$,Z,Re),he=fe.c,pe=fe.lc;else{if(!Le.p)throw new Error("hufDecode issues");let $e;for($e=0;$e<Le.lit;$e++){const wt=U(R[Le.p[$e]]);for(;pe<wt&&ue.value<Be;)se(he,pe,K,ue),he=J.c,pe=J.lc;if(pe>=wt&&H(R[Le.p[$e]])==(he>>pe-wt&(1<<wt)-1)){pe-=wt,_e(Le.p[$e],z,he,pe,K,ue,$,Z,Re),he=fe.c,pe=fe.lc;break}}if($e==Le.lit)throw new Error("hufDecode issues")}}const Qe=8-P&7;for(he>>=Qe,pe-=Qe;pe>0;){const Je=N[he<<14-pe&16383];if(Je.len)pe-=Je.len,_e(Je.lit,z,he,pe,K,ue,$,Z,Re),he=fe.c,pe=fe.lc;else throw new Error("hufDecode issues")}return!0}function ze(R,N,K,ue,P,z){const W={value:0},$=K.value,Z=Ze(N,K),he=Ze(N,K);K.value+=4;const pe=Ze(N,K);if(K.value+=4,Z<0||Z>=65537||he<0||he>=65537)throw new Error("Something wrong with HUF_ENCSIZE");const Re=new Array(65537),Be=new Array(16384);D(Be);const Qe=ue-(K.value-$);if(O(R,K,Qe,Z,he,Re),pe>8*(ue-(K.value-$)))throw new Error("Something wrong with hufUncompress");Y(Re,Z,he,Be),Xe(Re,Be,R,K,pe,he,z,P,W)}function Pe(R,N,K){for(let ue=0;ue<K;++ue)N[ue]=R[N[ue]]}function X(R){for(let N=1;N<R.length;N++){const K=R[N-1]+R[N]-128;R[N]=K}}function Ae(R,N){let K=0,ue=Math.floor((R.length+1)/2),P=0;const z=R.length-1;for(;!(P>z||(N[P++]=R[K++],P>z));)N[P++]=R[ue++]}function ke(R){let N=R.byteLength;const K=new Array;let ue=0;const P=new DataView(R);for(;N>0;){const z=P.getInt8(ue++);if(z<0){const W=-z;N-=W+1;for(let $=0;$<W;$++)K.push(P.getUint8(ue++))}else{const W=z;N-=2;const $=P.getUint8(ue++);for(let Z=0;Z<W+1;Z++)K.push($)}}return K}function be(R,N,K,ue,P,z){let W=new DataView(z.buffer);const $=K[R.idx[0]].width,Z=K[R.idx[0]].height,he=3,pe=Math.floor($/8),Re=Math.ceil($/8),Be=Math.ceil(Z/8),Qe=$-(Re-1)*8,Je=Z-(Be-1)*8,Le={value:0},$e=new Array(he),wt=new Array(he),Qt=new Array(he),yi=new Array(he),$t=new Array(he);for(let ei=0;ei<he;++ei)$t[ei]=N[R.idx[ei]],$e[ei]=ei<1?0:$e[ei-1]+Re*Be,wt[ei]=new Float32Array(64),Qt[ei]=new Uint16Array(64),yi[ei]=new Uint16Array(Re*64);for(let ei=0;ei<Be;++ei){let Ut=8;ei==Be-1&&(Ut=Je);let Rn=8;for(let ai=0;ai<Re;++ai){ai==Re-1&&(Rn=Qe);for(let wi=0;wi<he;++wi)Qt[wi].fill(0),Qt[wi][0]=P[$e[wi]++],je(Le,ue,Qt[wi]),ct(Qt[wi],wt[wi]),F(wt[wi]);B(wt);for(let wi=0;wi<he;++wi)ce(wt[wi],yi[wi],ai*64)}let yn=0;for(let ai=0;ai<he;++ai){const wi=K[R.idx[ai]].type;for(let Fi=8*ei;Fi<8*ei+Ut;++Fi){yn=$t[ai][Fi];for(let Er=0;Er<pe;++Er){const Tr=Er*64+(Fi&7)*8;W.setUint16(yn+0*2*wi,yi[ai][Tr+0],!0),W.setUint16(yn+1*2*wi,yi[ai][Tr+1],!0),W.setUint16(yn+2*2*wi,yi[ai][Tr+2],!0),W.setUint16(yn+3*2*wi,yi[ai][Tr+3],!0),W.setUint16(yn+4*2*wi,yi[ai][Tr+4],!0),W.setUint16(yn+5*2*wi,yi[ai][Tr+5],!0),W.setUint16(yn+6*2*wi,yi[ai][Tr+6],!0),W.setUint16(yn+7*2*wi,yi[ai][Tr+7],!0),yn+=8*2*wi}}if(pe!=Re)for(let Fi=8*ei;Fi<8*ei+Ut;++Fi){const Er=$t[ai][Fi]+8*pe*2*wi,Tr=pe*64+(Fi&7)*8;for(let hs=0;hs<Rn;++hs)W.setUint16(Er+hs*2*wi,yi[ai][Tr+hs],!0)}}}const ut=new Uint16Array($);W=new DataView(z.buffer);for(let ei=0;ei<he;++ei){K[R.idx[ei]].decoded=!0;const Ut=K[R.idx[ei]].type;if(K[ei].type==2)for(let Rn=0;Rn<Z;++Rn){const yn=$t[ei][Rn];for(let ai=0;ai<$;++ai)ut[ai]=W.getUint16(yn+ai*2*Ut,!0);for(let ai=0;ai<$;++ai)W.setFloat32(yn+ai*2*Ut,ne(ut[ai]),!0)}}}function je(R,N,K){let ue,P=1;for(;P<64;)ue=N[R.value],ue==65280?P=64:ue>>8==255?P+=ue&255:(K[P]=ue,P++),R.value++}function ct(R,N){N[0]=ne(R[0]),N[1]=ne(R[1]),N[2]=ne(R[5]),N[3]=ne(R[6]),N[4]=ne(R[14]),N[5]=ne(R[15]),N[6]=ne(R[27]),N[7]=ne(R[28]),N[8]=ne(R[2]),N[9]=ne(R[4]),N[10]=ne(R[7]),N[11]=ne(R[13]),N[12]=ne(R[16]),N[13]=ne(R[26]),N[14]=ne(R[29]),N[15]=ne(R[42]),N[16]=ne(R[3]),N[17]=ne(R[8]),N[18]=ne(R[12]),N[19]=ne(R[17]),N[20]=ne(R[25]),N[21]=ne(R[30]),N[22]=ne(R[41]),N[23]=ne(R[43]),N[24]=ne(R[9]),N[25]=ne(R[11]),N[26]=ne(R[18]),N[27]=ne(R[24]),N[28]=ne(R[31]),N[29]=ne(R[40]),N[30]=ne(R[44]),N[31]=ne(R[53]),N[32]=ne(R[10]),N[33]=ne(R[19]),N[34]=ne(R[23]),N[35]=ne(R[32]),N[36]=ne(R[39]),N[37]=ne(R[45]),N[38]=ne(R[52]),N[39]=ne(R[54]),N[40]=ne(R[20]),N[41]=ne(R[22]),N[42]=ne(R[33]),N[43]=ne(R[38]),N[44]=ne(R[46]),N[45]=ne(R[51]),N[46]=ne(R[55]),N[47]=ne(R[60]),N[48]=ne(R[21]),N[49]=ne(R[34]),N[50]=ne(R[37]),N[51]=ne(R[47]),N[52]=ne(R[50]),N[53]=ne(R[56]),N[54]=ne(R[59]),N[55]=ne(R[61]),N[56]=ne(R[35]),N[57]=ne(R[36]),N[58]=ne(R[48]),N[59]=ne(R[49]),N[60]=ne(R[57]),N[61]=ne(R[58]),N[62]=ne(R[62]),N[63]=ne(R[63])}function F(R){const N=.5*Math.cos(.7853975),K=.5*Math.cos(3.14159/16),ue=.5*Math.cos(3.14159/8),P=.5*Math.cos(3*3.14159/16),z=.5*Math.cos(5*3.14159/16),W=.5*Math.cos(3*3.14159/8),$=.5*Math.cos(7*3.14159/16),Z=new Array(4),he=new Array(4),pe=new Array(4),Re=new Array(4);for(let Be=0;Be<8;++Be){const Qe=Be*8;Z[0]=ue*R[Qe+2],Z[1]=W*R[Qe+2],Z[2]=ue*R[Qe+6],Z[3]=W*R[Qe+6],he[0]=K*R[Qe+1]+P*R[Qe+3]+z*R[Qe+5]+$*R[Qe+7],he[1]=P*R[Qe+1]-$*R[Qe+3]-K*R[Qe+5]-z*R[Qe+7],he[2]=z*R[Qe+1]-K*R[Qe+3]+$*R[Qe+5]+P*R[Qe+7],he[3]=$*R[Qe+1]-z*R[Qe+3]+P*R[Qe+5]-K*R[Qe+7],pe[0]=N*(R[Qe+0]+R[Qe+4]),pe[3]=N*(R[Qe+0]-R[Qe+4]),pe[1]=Z[0]+Z[3],pe[2]=Z[1]-Z[2],Re[0]=pe[0]+pe[1],Re[1]=pe[3]+pe[2],Re[2]=pe[3]-pe[2],Re[3]=pe[0]-pe[1],R[Qe+0]=Re[0]+he[0],R[Qe+1]=Re[1]+he[1],R[Qe+2]=Re[2]+he[2],R[Qe+3]=Re[3]+he[3],R[Qe+4]=Re[3]-he[3],R[Qe+5]=Re[2]-he[2],R[Qe+6]=Re[1]-he[1],R[Qe+7]=Re[0]-he[0]}for(let Be=0;Be<8;++Be)Z[0]=ue*R[16+Be],Z[1]=W*R[16+Be],Z[2]=ue*R[48+Be],Z[3]=W*R[48+Be],he[0]=K*R[8+Be]+P*R[24+Be]+z*R[40+Be]+$*R[56+Be],he[1]=P*R[8+Be]-$*R[24+Be]-K*R[40+Be]-z*R[56+Be],he[2]=z*R[8+Be]-K*R[24+Be]+$*R[40+Be]+P*R[56+Be],he[3]=$*R[8+Be]-z*R[24+Be]+P*R[40+Be]-K*R[56+Be],pe[0]=N*(R[Be]+R[32+Be]),pe[3]=N*(R[Be]-R[32+Be]),pe[1]=Z[0]+Z[3],pe[2]=Z[1]-Z[2],Re[0]=pe[0]+pe[1],Re[1]=pe[3]+pe[2],Re[2]=pe[3]-pe[2],Re[3]=pe[0]-pe[1],R[0+Be]=Re[0]+he[0],R[8+Be]=Re[1]+he[1],R[16+Be]=Re[2]+he[2],R[24+Be]=Re[3]+he[3],R[32+Be]=Re[3]-he[3],R[40+Be]=Re[2]-he[2],R[48+Be]=Re[1]-he[1],R[56+Be]=Re[0]-he[0]}function B(R){for(let N=0;N<64;++N){const K=R[0][N],ue=R[1][N],P=R[2][N];R[0][N]=K+1.5747*P,R[1][N]=K-.1873*ue-.4682*P,R[2][N]=K+1.8556*ue}}function ce(R,N,K){for(let ue=0;ue<64;++ue)N[K+ue]=Uu.toHalfFloat(Se(R[ue]))}function Se(R){return R<=1?Math.sign(R)*Math.pow(Math.abs(R),2.2):Math.sign(R)*Math.pow(S,Math.abs(R)-1)}function xe(R){return new DataView(R.array.buffer,R.offset.value,R.size)}function Ie(R){const N=R.viewer.buffer.slice(R.offset.value,R.offset.value+R.size),K=new Uint8Array(ke(N)),ue=new Uint8Array(K.length);return X(K),Ae(K,ue),new DataView(ue.buffer)}function et(R){const N=R.array.slice(R.offset.value,R.offset.value+R.size),K=Oy(N),ue=new Uint8Array(K.length);return X(K),Ae(K,ue),new DataView(ue.buffer)}function Fe(R){const N=R.viewer,K={value:R.offset.value},ue=new Uint16Array(R.width*R.scanlineBlockSize*(R.channels*R.type)),P=new Uint8Array(8192);let z=0;const W=new Array(R.channels);for(let Je=0;Je<R.channels;Je++)W[Je]={},W[Je].start=z,W[Je].end=W[Je].start,W[Je].nx=R.width,W[Je].ny=R.lines,W[Je].size=R.type,z+=W[Je].nx*W[Je].ny*W[Je].size;const $=q(N,K),Z=q(N,K);if(Z>=8192)throw new Error("Something is wrong with PIZ_COMPRESSION BITMAP_SIZE");if($<=Z)for(let Je=0;Je<Z-$+1;Je++)P[Je+$]=pt(N,K);const he=new Uint16Array(65536),pe=C(P,he),Re=Ze(N,K);ze(R.array,N,K,Re,ue,z);for(let Je=0;Je<R.channels;++Je){const Le=W[Je];for(let $e=0;$e<W[Je].size;++$e)Ge(ue,Le.start+$e,Le.nx,Le.size,Le.ny,Le.nx*Le.size,pe)}Pe(he,ue,z);let Be=0;const Qe=new Uint8Array(ue.buffer.byteLength);for(let Je=0;Je<R.lines;Je++)for(let Le=0;Le<R.channels;Le++){const $e=W[Le],wt=$e.nx*$e.size,Qt=new Uint8Array(ue.buffer,$e.end*2,wt*2);Qe.set(Qt,Be),Be+=wt*2,$e.end+=wt}return new DataView(Qe.buffer)}function Ke(R){const N=R.array.slice(R.offset.value,R.offset.value+R.size),K=Oy(N),ue=R.lines*R.channels*R.width,P=R.type==1?new Uint16Array(ue):new Uint32Array(ue);let z=0,W=0;const $=new Array(4);for(let Z=0;Z<R.lines;Z++)for(let he=0;he<R.channels;he++){let pe=0;switch(R.type){case 1:$[0]=z,$[1]=$[0]+R.width,z=$[1]+R.width;for(let Re=0;Re<R.width;++Re){const Be=K[$[0]++]<<8|K[$[1]++];pe+=Be,P[W]=pe,W++}break;case 2:$[0]=z,$[1]=$[0]+R.width,$[2]=$[1]+R.width,z=$[2]+R.width;for(let Re=0;Re<R.width;++Re){const Be=K[$[0]++]<<24|K[$[1]++]<<16|K[$[2]++]<<8;pe+=Be,P[W]=pe,W++}break}}return new DataView(P.buffer)}function rt(R){const N=R.viewer,K={value:R.offset.value},ue=new Uint8Array(R.width*R.lines*(R.channels*R.type*2)),P={version:Pt(N,K),unknownUncompressedSize:Pt(N,K),unknownCompressedSize:Pt(N,K),acCompressedSize:Pt(N,K),dcCompressedSize:Pt(N,K),rleCompressedSize:Pt(N,K),rleUncompressedSize:Pt(N,K),rleRawSize:Pt(N,K),totalAcUncompressedCount:Pt(N,K),totalDcUncompressedCount:Pt(N,K),acCompression:Pt(N,K)};if(P.version<2)throw new Error("EXRLoader.parse: "+Ca.compression+" version "+P.version+" is unsupported");const z=new Array;let W=q(N,K)-2;for(;W>0;){const Le=At(N.buffer,K),$e=pt(N,K),wt=$e>>2&3,Qt=($e>>4)-1,yi=new Int8Array([Qt])[0],$t=pt(N,K);z.push({name:Le,index:yi,type:$t,compression:wt}),W-=Le.length+3}const $=Ca.channels,Z=new Array(R.channels);for(let Le=0;Le<R.channels;++Le){const $e=Z[Le]={},wt=$[Le];$e.name=wt.name,$e.compression=0,$e.decoded=!1,$e.type=wt.pixelType,$e.pLinear=wt.pLinear,$e.width=R.width,$e.height=R.lines}const he={idx:new Array(3)};for(let Le=0;Le<R.channels;++Le){const $e=Z[Le];for(let wt=0;wt<z.length;++wt){const Qt=z[wt];$e.name==Qt.name&&($e.compression=Qt.compression,Qt.index>=0&&(he.idx[Qt.index]=Le),$e.offset=Le)}}let pe,Re,Be;if(P.acCompressedSize>0)switch(P.acCompression){case 0:pe=new Uint16Array(P.totalAcUncompressedCount),ze(R.array,N,K,P.acCompressedSize,pe,P.totalAcUncompressedCount);break;case 1:const Le=R.array.slice(K.value,K.value+P.totalAcUncompressedCount),$e=Oy(Le);pe=new Uint16Array($e.buffer),K.value+=P.totalAcUncompressedCount;break}if(P.dcCompressedSize>0){const Le={array:R.array,offset:K,size:P.dcCompressedSize};Re=new Uint16Array(et(Le).buffer),K.value+=P.dcCompressedSize}if(P.rleRawSize>0){const Le=R.array.slice(K.value,K.value+P.rleCompressedSize),$e=Oy(Le);Be=ke($e.buffer),K.value+=P.rleCompressedSize}let Qe=0;const Je=new Array(Z.length);for(let Le=0;Le<Je.length;++Le)Je[Le]=new Array;for(let Le=0;Le<R.lines;++Le)for(let $e=0;$e<Z.length;++$e)Je[$e].push(Qe),Qe+=Z[$e].width*R.type*2;be(he,Je,Z,pe,Re,ue);for(let Le=0;Le<Z.length;++Le){const $e=Z[Le];if(!$e.decoded)switch($e.compression){case 2:let wt=0,Qt=0;for(let yi=0;yi<R.lines;++yi){let $t=Je[Le][wt];for(let ut=0;ut<$e.width;++ut){for(let ei=0;ei<2*$e.type;++ei)ue[$t++]=Be[Qt+ei*$e.width*$e.height];Qt++}wt++}break;case 1:default:throw new Error("EXRLoader.parse: unsupported channel compression")}}return new DataView(ue.buffer)}function At(R,N){const K=new Uint8Array(R);let ue=0;for(;K[N.value+ue]!=0;)ue+=1;const P=new TextDecoder().decode(K.slice(N.value,N.value+ue));return N.value=N.value+ue+1,P}function Ee(R,N,K){const ue=new TextDecoder().decode(new Uint8Array(R).slice(N.value,N.value+K));return N.value=N.value+K,ue}function Rt(R,N){const K=ft(R,N),ue=Ze(R,N);return[K,ue]}function dt(R,N){const K=Ze(R,N),ue=Ze(R,N);return[K,ue]}function ft(R,N){const K=R.getInt32(N.value,!0);return N.value=N.value+4,K}function Ze(R,N){const K=R.getUint32(N.value,!0);return N.value=N.value+4,K}function Ve(R,N){const K=R[N.value];return N.value=N.value+1,K}function pt(R,N){const K=R.getUint8(N.value);return N.value=N.value+1,K}const Pt=function(R,N){let K;return"getBigInt64"in DataView.prototype?K=Number(R.getBigInt64(N.value,!0)):K=R.getUint32(N.value+4,!0)+Number(R.getUint32(N.value,!0)<<32),N.value+=8,K};function j(R,N){const K=R.getFloat32(N.value,!0);return N.value+=4,K}function Ne(R,N){return Uu.toHalfFloat(j(R,N))}function ne(R){const N=(R&31744)>>10,K=R&1023;return(R>>15?-1:1)*(N?N===31?K?NaN:1/0:Math.pow(2,N-15)*(1+K/1024):6103515625e-14*(K/1024))}function q(R,N){const K=R.getUint16(N.value,!0);return N.value+=2,K}function He(R,N){return ne(q(R,N))}function Ye(R,N,K,ue){const P=K.value,z=[];for(;K.value<P+ue-1;){const W=At(N,K),$=ft(R,K),Z=pt(R,K);K.value+=3;const he=ft(R,K),pe=ft(R,K);z.push({name:W,pixelType:$,pLinear:Z,xSampling:he,ySampling:pe})}return K.value+=1,z}function at(R,N){const K=j(R,N),ue=j(R,N),P=j(R,N),z=j(R,N),W=j(R,N),$=j(R,N),Z=j(R,N),he=j(R,N);return{redX:K,redY:ue,greenX:P,greenY:z,blueX:W,blueY:$,whiteX:Z,whiteY:he}}function xt(R,N){const K=["NO_COMPRESSION","RLE_COMPRESSION","ZIPS_COMPRESSION","ZIP_COMPRESSION","PIZ_COMPRESSION","PXR24_COMPRESSION","B44_COMPRESSION","B44A_COMPRESSION","DWAA_COMPRESSION","DWAB_COMPRESSION"],ue=pt(R,N);return K[ue]}function Ei(R,N){const K=Ze(R,N),ue=Ze(R,N),P=Ze(R,N),z=Ze(R,N);return{xMin:K,yMin:ue,xMax:P,yMax:z}}function vi(R,N){const K=["INCREASING_Y"],ue=pt(R,N);return K[ue]}function fi(R,N){const K=j(R,N),ue=j(R,N);return[K,ue]}function Li(R,N){const K=j(R,N),ue=j(R,N),P=j(R,N);return[K,ue,P]}function ui(R,N,K,ue,P){if(ue==="string"||ue==="stringvector"||ue==="iccProfile")return Ee(N,K,P);if(ue==="chlist")return Ye(R,N,K,P);if(ue==="chromaticities")return at(R,K);if(ue==="compression")return xt(R,K);if(ue==="box2i")return Ei(R,K);if(ue==="lineOrder")return vi(R,K);if(ue==="float")return j(R,K);if(ue==="v2f")return fi(R,K);if(ue==="v3f")return Li(R,K);if(ue==="int")return ft(R,K);if(ue==="rational")return Rt(R,K);if(ue==="timecode")return dt(R,K);if(ue==="preview")return K.value+=P,"skipped";K.value+=P}function vn(R,N,K){const ue={};if(R.getUint32(0,!0)!=20000630)throw new Error("THREE.EXRLoader: Provided file doesn't appear to be in OpenEXR format.");ue.version=R.getUint8(4);const P=R.getUint8(5);ue.spec={singleTile:!!(P&2),longName:!!(P&4),deepFormat:!!(P&8),multiPart:!!(P&16)},K.value=8;let z=!0;for(;z;){const W=At(N,K);if(W==0)z=!1;else{const $=At(N,K),Z=Ze(R,K),he=ui(R,N,K,$,Z);he===void 0?console.warn(`THREE.EXRLoader: Skipped unknown header attribute type '${$}'.`):ue[W]=he}}if(P&-5)throw console.error("THREE.EXRHeader:",ue),new Error("THREE.EXRLoader: Provided file is currently unsupported.");return ue}function en(R,N,K,ue,P){const z={size:0,viewer:N,array:K,offset:ue,width:R.dataWindow.xMax-R.dataWindow.xMin+1,height:R.dataWindow.yMax-R.dataWindow.yMin+1,channels:R.channels.length,bytesPerLine:null,lines:null,inputSize:null,type:R.channels[0].pixelType,uncompress:null,getter:null,format:null,colorSpace:Ri};switch(R.compression){case"NO_COMPRESSION":z.lines=1,z.uncompress=xe;break;case"RLE_COMPRESSION":z.lines=1,z.uncompress=Ie;break;case"ZIPS_COMPRESSION":z.lines=1,z.uncompress=et;break;case"ZIP_COMPRESSION":z.lines=16,z.uncompress=et;break;case"PIZ_COMPRESSION":z.lines=32,z.uncompress=Fe;break;case"PXR24_COMPRESSION":z.lines=16,z.uncompress=Ke;break;case"DWAA_COMPRESSION":z.lines=32,z.uncompress=rt;break;case"DWAB_COMPRESSION":z.lines=256,z.uncompress=rt;break;default:throw new Error("EXRLoader.parse: "+R.compression+" is unsupported")}if(z.scanlineBlockSize=z.lines,z.type==1)switch(P){case Ji:z.getter=He,z.inputSize=2;break;case sn:z.getter=q,z.inputSize=2;break}else if(z.type==2)switch(P){case Ji:z.getter=j,z.inputSize=4;break;case sn:z.getter=Ne,z.inputSize=4}else throw new Error("EXRLoader.parse: unsupported pixelType "+z.type+" for "+R.compression+".");z.blockCount=(R.dataWindow.yMax+1)/z.scanlineBlockSize;for(let $=0;$<z.blockCount;$++)Pt(N,ue);z.outputChannels=z.channels==3?4:z.channels;const W=z.width*z.height*z.outputChannels;switch(P){case Ji:z.byteArray=new Float32Array(W),z.channels<z.outputChannels&&z.byteArray.fill(1,0,W);break;case sn:z.byteArray=new Uint16Array(W),z.channels<z.outputChannels&&z.byteArray.fill(15360,0,W);break;default:console.error("THREE.EXRLoader: unsupported type: ",P);break}return z.bytesPerLine=z.width*z.inputSize*z.channels,z.outputChannels==4?(z.format=xi,z.colorSpace=Ri):(z.format=tc,z.colorSpace=is),z}const fo=new DataView(e),Dv=new Uint8Array(e),su={value:0},Ca=vn(fo,e,su),Kt=en(Ca,fo,Dv,su,this.type),ru={value:0},Ov={R:0,G:1,B:2,A:3,Y:0};for(let R=0;R<Kt.height/Kt.scanlineBlockSize;R++){const N=Ze(fo,su);Kt.size=Ze(fo,su),Kt.lines=N+Kt.scanlineBlockSize>Kt.height?Kt.height-N:Kt.scanlineBlockSize;const ue=Kt.size<Kt.lines*Kt.bytesPerLine?Kt.uncompress(Kt):xe(Kt);su.value+=Kt.size;for(let P=0;P<Kt.scanlineBlockSize;P++){const z=P+R*Kt.scanlineBlockSize;if(z>=Kt.height)break;for(let W=0;W<Kt.channels;W++){const $=Ov[Ca.channels[W].name];for(let Z=0;Z<Kt.width;Z++){ru.value=(P*(Kt.channels*Kt.width)+W*Kt.width+Z)*Kt.inputSize;const he=(Kt.height-1-z)*(Kt.width*Kt.outputChannels)+Z*Kt.outputChannels+$;Kt.byteArray[he]=Kt.getter(ue,ru)}}}}return{header:Ca,width:Kt.width,height:Kt.height,data:Kt.byteArray,format:Kt.format,colorSpace:Kt.colorSpace,type:this.type}}setDataType(e){return this.type=e,this}load(e,t,i,s){function r(o,a){o.colorSpace=a.colorSpace,o.minFilter=St,o.magFilter=St,o.generateMipmaps=!1,o.flipY=!1,t&&t(o,a)}return super.load(e,r,i,s)}}class QE extends VM{constructor(e){super(e),this.type=sn}parse(e){const o=function(I,S){switch(I){case 1:throw new Error("THREE.RGBELoader: Read Error: "+(S||""));case 2:throw new Error("THREE.RGBELoader: Write Error: "+(S||""));case 3:throw new Error("THREE.RGBELoader: Bad File Format: "+(S||""));default:case 4:throw new Error("THREE.RGBELoader: Memory Error: "+(S||""))}},h=`
`,d=function(I,S,C){S=S||1024;let G=I.pos,Q=-1,L=0,V="",O=String.fromCharCode.apply(null,new Uint16Array(I.subarray(G,G+128)));for(;0>(Q=O.indexOf(h))&&L<S&&G<I.byteLength;)V+=O,L+=O.length,G+=128,O+=String.fromCharCode.apply(null,new Uint16Array(I.subarray(G,G+128)));return-1<Q?(C!==!1&&(I.pos+=L+Q+1),V+O.slice(0,Q)):!1},f=function(I){const S=/^#\?(\S+)/,C=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,D=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,G=/^\s*FORMAT=(\S+)\s*$/,Q=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,L={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};let V,O;for((I.pos>=I.byteLength||!(V=d(I)))&&o(1,"no header found"),(O=V.match(S))||o(3,"bad initial token"),L.valid|=1,L.programtype=O[1],L.string+=V+`
`;V=d(I),V!==!1;){if(L.string+=V+`
`,V.charAt(0)==="#"){L.comments+=V+`
`;continue}if((O=V.match(C))&&(L.gamma=parseFloat(O[1])),(O=V.match(D))&&(L.exposure=parseFloat(O[1])),(O=V.match(G))&&(L.valid|=2,L.format=O[1]),(O=V.match(Q))&&(L.valid|=4,L.height=parseInt(O[1],10),L.width=parseInt(O[2],10)),L.valid&2&&L.valid&4)break}return L.valid&2||o(3,"missing format specifier"),L.valid&4||o(3,"missing image size specifier"),L},p=function(I,S,C){const D=S;if(D<8||D>32767||I[0]!==2||I[1]!==2||I[2]&128)return new Uint8Array(I);D!==(I[2]<<8|I[3])&&o(3,"wrong scanline width");const G=new Uint8Array(4*S*C);G.length||o(4,"unable to allocate buffer space");let Q=0,L=0;const V=4*D,O=new Uint8Array(4),U=new Uint8Array(V);let H=C;for(;H>0&&L<I.byteLength;){L+4>I.byteLength&&o(1),O[0]=I[L++],O[1]=I[L++],O[2]=I[L++],O[3]=I[L++],(O[0]!=2||O[1]!=2||(O[2]<<8|O[3])!=D)&&o(3,"bad rgbe scanline format");let Y=0,J;for(;Y<V&&L<I.byteLength;){J=I[L++];const fe=J>128;if(fe&&(J-=128),(J===0||Y+J>V)&&o(3,"bad scanline data"),fe){const _e=I[L++];for(let Oe=0;Oe<J;Oe++)U[Y++]=_e}else U.set(I.subarray(L,L+J),Y),Y+=J,L+=J}const se=D;for(let fe=0;fe<se;fe++){let _e=0;G[Q]=U[fe+_e],_e+=D,G[Q+1]=U[fe+_e],_e+=D,G[Q+2]=U[fe+_e],_e+=D,G[Q+3]=U[fe+_e],Q+=4}H--}return G},m=function(I,S,C,D){const G=I[S+3],Q=Math.pow(2,G-128)/255;C[D+0]=I[S+0]*Q,C[D+1]=I[S+1]*Q,C[D+2]=I[S+2]*Q,C[D+3]=1},g=function(I,S,C,D){const G=I[S+3],Q=Math.pow(2,G-128)/255;C[D+0]=Uu.toHalfFloat(Math.min(I[S+0]*Q,65504)),C[D+1]=Uu.toHalfFloat(Math.min(I[S+1]*Q,65504)),C[D+2]=Uu.toHalfFloat(Math.min(I[S+2]*Q,65504)),C[D+3]=Uu.toHalfFloat(1)},y=new Uint8Array(e);y.pos=0;const A=f(y),v=A.width,b=A.height,_=p(y.subarray(y.pos),v,b);let T,E,M;switch(this.type){case Ji:M=_.length/4;const I=new Float32Array(M*4);for(let C=0;C<M;C++)m(_,C*4,I,C*4);T=I,E=Ji;break;case sn:M=_.length/4;const S=new Uint16Array(M*4);for(let C=0;C<M;C++)g(_,C*4,S,C*4);T=S,E=sn;break;default:throw new Error("THREE.RGBELoader: Unsupported type: "+this.type)}return{width:v,height:b,data:T,header:A.string,gamma:A.gamma,exposure:A.exposure,type:E}}setDataType(e){return this.type=e,this}load(e,t,i,s){function r(o,a){switch(o.type){case Ji:case sn:o.colorSpace=Ri,o.minFilter=St,o.magFilter=St,o.generateMipmaps=!1,o.flipY=!0;break}t&&t(o,a)}return super.load(e,r,i,s)}}const zB="NEEDLE_lightmaps",wm=re("debuglightmapsextension")||re("debuglightmaps");var sc;(function(n){n[n.Lightmap=0]="Lightmap",n[n.Skybox=1]="Skybox",n[n.Reflection=2]="Reflection"})(sc||(sc={}));class Jq{constructor(e,t,i){u(this,"parser");u(this,"registry");u(this,"source");this.parser=e,this.registry=t,this.source=i}get name(){return zB}afterRoot(e){const t=this.parser.json.extensions;if(t){const i=t[zB];if(i){const s=i.textures;return s!=null&&s.length?(wm&&console.log(i),new Promise(async(r,o)=>{const a=[];for(const l of s)if(l.pointer){wm&&console.log(l);let h=null;if(l.pointer.startsWith("/textures/"))wm&&console.log("Load texture from gltf",l.pointer),h=d1(this.parser,l.pointer).then(d=>this.resolveTexture(l,d));else if(typeof l.pointer=="string"){wm&&console.log("Load texture from path",l.pointer);const d=Bp(this.source,l.pointer);let f;d.endsWith(".exr")?f=new bb(this.parser.options.manager):d.endsWith(".hdr")?f=new QE(this.parser.options.manager):f=new dl(this.parser.options.manager),h=f.loadAsync(d,void 0).then(p=>this.resolveTexture(l,p))}else l.pointer;h&&a.push(h)}const c=await ix(a);c!=null&&c.anyFailed&&Tt()&&console.error("Failed to load lightmap extension",c),r()})):null}}return null}resolveTexture(e,t){const i=t;wm&&console.log("Lightmap loaded:",i),i!=null&&i.isTexture&&(this.registry?(e.type!==sc.Lightmap?i.colorSpace=zt:i.colorSpace=Ri,this.registry.registerTexture(this.source,e.type,i,e.index)):console.log(sc[e.type],e.pointer,i))}}const GB=!!re("debuglightmaps");class Kq{constructor(e){u(this,"_context");u(this,"_lightmaps",new Map);this._context=e}clear(){this._lightmaps.clear()}registerTexture(e,t,i,s){GB&&console.log("Registering ",sc[t]+' "'+e+'"',i),this._lightmaps.has(e)||this._lightmaps.set(e,new Map);const r=this._lightmaps.get(e),o=(r==null?void 0:r.get(t))??[];o.length<s&&(o.length=s+1),o[s]=i,r==null||r.set(t,o)}tryGetLightmap(e,t=0){return this.tryGet(e,sc.Lightmap,t)}tryGetSkybox(e){return this.tryGet(e,sc.Skybox,0)}tryGetReflection(e){return this.tryGet(e,sc.Reflection,0)}tryGet(e,t,i){var r;if(!e)return GB&&console.warn("Missing source id"),null;const s=((r=this._lightmaps.get(e))==null?void 0:r.get(t))??null;return!(s!=null&&s.length)||s.length<=i?null:s[i]}}Bt.lights_fragment_maps=Bt.lights_fragment_maps.replace("vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );",`
    vec2 lUv = vLightMapUv.xy * lightmapScaleOffset.xy + vec2(lightmapScaleOffset.z, (1. - (lightmapScaleOffset.y + lightmapScaleOffset.w)));
    vec4 lightMapTexel = texture2D( lightMap, lUv);
    // The range of RGBM lightmaps goes from 0 to 34.49 (5^2.2) in linear space, and from 0 to 5 in gamma space.
    lightMapTexel.rgb *= lightMapTexel.a * 8.; // no idea where that "8" comes from... heuristically derived
    lightMapTexel.a = 1.;
    lightMapTexel = conv_sRGBToLinear(lightMapTexel);
    `);Bt.lightmap_pars_fragment=`
    #ifdef USE_LIGHTMAP
        uniform sampler2D lightMap;
        uniform float lightMapIntensity;
        uniform vec4 lightmapScaleOffset;
        
        // took from threejs 05fc79cd52b79e8c3e8dec1e7dca72c5c39983a4
        vec4 conv_sRGBToLinear( in vec4 value ) {
            return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );
        }
    #endif
    `;Bt.lights_fragment_begin=Bt.lights_fragment_begin.replace("irradiance += getLightProbeIrradiance( lightProbe, geometry.normal );",`
#if defined(USE_LIGHTMAP)
irradiance += 0.;
#else
irradiance += getLightProbeIrradiance( lightProbe, geometry.normal );
#endif`);De.lightmap.lightmapScaleOffset={value:new tt(1,1,0,0)};const Zq="modulepreload",$q=function(n,e){return new URL(n,e).href},VB={},ux=function(e,t,i){if(!t||t.length===0)return e();const s=document.getElementsByTagName("link");return Promise.all(t.map(r=>{if(r=$q(r,i),r in VB)return;VB[r]=!0;const o=r.endsWith(".css"),a=o?'[rel="stylesheet"]':"";if(!!i)for(let h=s.length-1;h>=0;h--){const d=s[h];if(d.href===r&&(!o||d.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${r}"]${a}`))return;const l=document.createElement("link");if(l.rel=o?"stylesheet":Zq,o||(l.as="script",l.crossOrigin=""),l.href=r,document.head.appendChild(l),o)return new Promise((h,d)=>{l.addEventListener("load",h),l.addEventListener("error",()=>d(new Error(`Unable to preload CSS for ${r}`)))})})).then(()=>e())},CS=2,Ya=4,tl=4,g1=4,uh=new Int32Array(2),HB=new Float32Array(uh.buffer),QB=new Float64Array(uh.buffer),ky=new Uint16Array(new Uint8Array([1,0]).buffer)[0]===1;class pl{constructor(e,t){this.low=e|0,this.high=t|0}static create(e,t){return e==0&&t==0?pl.ZERO:new pl(e,t)}toFloat64(){return(this.low>>>0)+this.high*4294967296}equals(e){return this.low==e.low&&this.high==e.high}}pl.ZERO=new pl(0,0);var jE;(function(n){n[n.UTF8_BYTES=1]="UTF8_BYTES",n[n.UTF16_STRING=2]="UTF16_STRING"})(jE||(jE={}));class lA{constructor(e){this.bytes_=e,this.position_=0}static allocate(e){return new lA(new Uint8Array(e))}clear(){this.position_=0}bytes(){return this.bytes_}position(){return this.position_}setPosition(e){this.position_=e}capacity(){return this.bytes_.length}readInt8(e){return this.readUint8(e)<<24>>24}readUint8(e){return this.bytes_[e]}readInt16(e){return this.readUint16(e)<<16>>16}readUint16(e){return this.bytes_[e]|this.bytes_[e+1]<<8}readInt32(e){return this.bytes_[e]|this.bytes_[e+1]<<8|this.bytes_[e+2]<<16|this.bytes_[e+3]<<24}readUint32(e){return this.readInt32(e)>>>0}readInt64(e){return new pl(this.readInt32(e),this.readInt32(e+4))}readUint64(e){return new pl(this.readUint32(e),this.readUint32(e+4))}readFloat32(e){return uh[0]=this.readInt32(e),HB[0]}readFloat64(e){return uh[ky?0:1]=this.readInt32(e),uh[ky?1:0]=this.readInt32(e+4),QB[0]}writeInt8(e,t){this.bytes_[e]=t}writeUint8(e,t){this.bytes_[e]=t}writeInt16(e,t){this.bytes_[e]=t,this.bytes_[e+1]=t>>8}writeUint16(e,t){this.bytes_[e]=t,this.bytes_[e+1]=t>>8}writeInt32(e,t){this.bytes_[e]=t,this.bytes_[e+1]=t>>8,this.bytes_[e+2]=t>>16,this.bytes_[e+3]=t>>24}writeUint32(e,t){this.bytes_[e]=t,this.bytes_[e+1]=t>>8,this.bytes_[e+2]=t>>16,this.bytes_[e+3]=t>>24}writeInt64(e,t){this.writeInt32(e,t.low),this.writeInt32(e+4,t.high)}writeUint64(e,t){this.writeUint32(e,t.low),this.writeUint32(e+4,t.high)}writeFloat32(e,t){HB[0]=t,this.writeInt32(e,uh[0])}writeFloat64(e,t){QB[0]=t,this.writeInt32(e,uh[ky?0:1]),this.writeInt32(e+4,uh[ky?1:0])}getBufferIdentifier(){if(this.bytes_.length<this.position_+Ya+tl)throw new Error("FlatBuffers: ByteBuffer is too short to contain an identifier.");let e="";for(let t=0;t<tl;t++)e+=String.fromCharCode(this.readInt8(this.position_+Ya+t));return e}__offset(e,t){const i=e-this.readInt32(e);return t<this.readInt16(i)?this.readInt16(i+t):0}__union(e,t){return e.bb_pos=t+this.readInt32(t),e.bb=this,e}__string(e,t){e+=this.readInt32(e);const i=this.readInt32(e);let s="",r=0;if(e+=Ya,t===jE.UTF8_BYTES)return this.bytes_.subarray(e,e+i);for(;r<i;){let o;const a=this.readUint8(e+r++);if(a<192)o=a;else{const c=this.readUint8(e+r++);if(a<224)o=(a&31)<<6|c&63;else{const l=this.readUint8(e+r++);if(a<240)o=(a&15)<<12|(c&63)<<6|l&63;else{const h=this.readUint8(e+r++);o=(a&7)<<18|(c&63)<<12|(l&63)<<6|h&63}}}o<65536?s+=String.fromCharCode(o):(o-=65536,s+=String.fromCharCode((o>>10)+55296,(o&1024-1)+56320))}return s}__union_with_string(e,t){return typeof e=="string"?this.__string(t):this.__union(e,t)}__indirect(e){return e+this.readInt32(e)}__vector(e){return e+this.readInt32(e)+Ya}__vector_len(e){return this.readInt32(e+this.readInt32(e))}__has_identifier(e){if(e.length!=tl)throw new Error("FlatBuffers: file identifier must be length "+tl);for(let t=0;t<tl;t++)if(e.charCodeAt(t)!=this.readInt8(this.position()+Ya+t))return!1;return!0}createLong(e,t){return pl.create(e,t)}createScalarList(e,t){const i=[];for(let s=0;s<t;++s)e(s)!==null&&i.push(e(s));return i}createObjList(e,t){const i=[];for(let s=0;s<t;++s){const r=e(s);r!==null&&i.push(r.unpack())}return i}}class WA{constructor(e){this.minalign=1,this.vtable=null,this.vtable_in_use=0,this.isNested=!1,this.object_start=0,this.vtables=[],this.vector_num_elems=0,this.force_defaults=!1,this.string_maps=null;let t;e?t=e:t=1024,this.bb=lA.allocate(t),this.space=t}clear(){this.bb.clear(),this.space=this.bb.capacity(),this.minalign=1,this.vtable=null,this.vtable_in_use=0,this.isNested=!1,this.object_start=0,this.vtables=[],this.vector_num_elems=0,this.force_defaults=!1,this.string_maps=null}forceDefaults(e){this.force_defaults=e}dataBuffer(){return this.bb}asUint8Array(){return this.bb.bytes().subarray(this.bb.position(),this.bb.position()+this.offset())}prep(e,t){e>this.minalign&&(this.minalign=e);const i=~(this.bb.capacity()-this.space+t)+1&e-1;for(;this.space<i+e+t;){const s=this.bb.capacity();this.bb=WA.growByteBuffer(this.bb),this.space+=this.bb.capacity()-s}this.pad(i)}pad(e){for(let t=0;t<e;t++)this.bb.writeInt8(--this.space,0)}writeInt8(e){this.bb.writeInt8(this.space-=1,e)}writeInt16(e){this.bb.writeInt16(this.space-=2,e)}writeInt32(e){this.bb.writeInt32(this.space-=4,e)}writeInt64(e){this.bb.writeInt64(this.space-=8,e)}writeFloat32(e){this.bb.writeFloat32(this.space-=4,e)}writeFloat64(e){this.bb.writeFloat64(this.space-=8,e)}addInt8(e){this.prep(1,0),this.writeInt8(e)}addInt16(e){this.prep(2,0),this.writeInt16(e)}addInt32(e){this.prep(4,0),this.writeInt32(e)}addInt64(e){this.prep(8,0),this.writeInt64(e)}addFloat32(e){this.prep(4,0),this.writeFloat32(e)}addFloat64(e){this.prep(8,0),this.writeFloat64(e)}addFieldInt8(e,t,i){(this.force_defaults||t!=i)&&(this.addInt8(t),this.slot(e))}addFieldInt16(e,t,i){(this.force_defaults||t!=i)&&(this.addInt16(t),this.slot(e))}addFieldInt32(e,t,i){(this.force_defaults||t!=i)&&(this.addInt32(t),this.slot(e))}addFieldInt64(e,t,i){(this.force_defaults||!t.equals(i))&&(this.addInt64(t),this.slot(e))}addFieldFloat32(e,t,i){(this.force_defaults||t!=i)&&(this.addFloat32(t),this.slot(e))}addFieldFloat64(e,t,i){(this.force_defaults||t!=i)&&(this.addFloat64(t),this.slot(e))}addFieldOffset(e,t,i){(this.force_defaults||t!=i)&&(this.addOffset(t),this.slot(e))}addFieldStruct(e,t,i){t!=i&&(this.nested(t),this.slot(e))}nested(e){if(e!=this.offset())throw new Error("FlatBuffers: struct must be serialized inline.")}notNested(){if(this.isNested)throw new Error("FlatBuffers: object serialization must not be nested.")}slot(e){this.vtable!==null&&(this.vtable[e]=this.offset())}offset(){return this.bb.capacity()-this.space}static growByteBuffer(e){const t=e.capacity();if(t&3221225472)throw new Error("FlatBuffers: cannot grow buffer beyond 2 gigabytes.");const i=t<<1,s=lA.allocate(i);return s.setPosition(i-t),s.bytes().set(e.bytes(),i-t),s}addOffset(e){this.prep(Ya,0),this.writeInt32(this.offset()-e+Ya)}startObject(e){this.notNested(),this.vtable==null&&(this.vtable=[]),this.vtable_in_use=e;for(let t=0;t<e;t++)this.vtable[t]=0;this.isNested=!0,this.object_start=this.offset()}endObject(){if(this.vtable==null||!this.isNested)throw new Error("FlatBuffers: endObject called without startObject");this.addInt32(0);const e=this.offset();let t=this.vtable_in_use-1;for(;t>=0&&this.vtable[t]==0;t--);const i=t+1;for(;t>=0;t--)this.addInt16(this.vtable[t]!=0?e-this.vtable[t]:0);const s=2;this.addInt16(e-this.object_start);const r=(i+s)*CS;this.addInt16(r);let o=0;const a=this.space;e:for(t=0;t<this.vtables.length;t++){const c=this.bb.capacity()-this.vtables[t];if(r==this.bb.readInt16(c)){for(let l=CS;l<r;l+=CS)if(this.bb.readInt16(a+l)!=this.bb.readInt16(c+l))continue e;o=this.vtables[t];break}}return o?(this.space=this.bb.capacity()-e,this.bb.writeInt32(this.space,o-e)):(this.vtables.push(this.offset()),this.bb.writeInt32(this.bb.capacity()-e,this.offset()-e)),this.isNested=!1,e}finish(e,t,i){const s=i?g1:0;if(t){const r=t;if(this.prep(this.minalign,Ya+tl+s),r.length!=tl)throw new Error("FlatBuffers: file identifier must be length "+tl);for(let o=tl-1;o>=0;o--)this.writeInt8(r.charCodeAt(o))}this.prep(this.minalign,Ya+s),this.addOffset(e),s&&this.addInt32(this.bb.capacity()-this.space),this.bb.setPosition(this.space)}finishSizePrefixed(e,t){this.finish(e,t,!0)}requiredField(e,t){const i=this.bb.capacity()-e,s=i-this.bb.readInt32(i);if(!(this.bb.readInt16(s+t)!=0))throw new Error("FlatBuffers: field "+t+" must be set")}startVector(e,t,i){this.notNested(),this.vector_num_elems=t,this.prep(Ya,e*t),this.prep(i,e*t)}endVector(){return this.writeInt32(this.vector_num_elems),this.offset()}createSharedString(e){if(!e)return 0;if(this.string_maps||(this.string_maps=new Map),this.string_maps.has(e))return this.string_maps.get(e);const t=this.createString(e);return this.string_maps.set(e,t),t}createString(e){if(!e)return 0;let t;if(e instanceof Uint8Array)t=e;else{t=[];let i=0;for(;i<e.length;){let s;const r=e.charCodeAt(i++);if(r<55296||r>=56320)s=r;else{const o=e.charCodeAt(i++);s=(r<<10)+o+(65536-56623104-56320)}s<128?t.push(s):(s<2048?t.push(s>>6&31|192):(s<65536?t.push(s>>12&15|224):t.push(s>>18&7|240,s>>12&63|128),t.push(s>>6&63|128)),t.push(s&63|128))}}this.addInt8(0),this.startVector(1,t.length,1),this.bb.setPosition(this.space-=t.length);for(let i=0,s=this.space,r=this.bb.bytes();i<t.length;i++)r[s++]=t[i];return this.endVector()}createLong(e,t){return pl.create(e,t)}createObjectOffset(e){return e===null?0:typeof e=="string"?this.createString(e):e.pack(this)}createObjectOffsetList(e){const t=[];for(let i=0;i<e.length;++i){const s=e[i];if(s!==null)t.push(this.createObjectOffset(s));else throw new Error("FlatBuffers: Argument for createObjectOffsetList cannot contain null.")}return t}createStructOffsetList(e,t){return t(this,e.length),this.createObjectOffsetList(e),this.endVector()}}const aU={};function cU(n,e){aU[n]=e}function eX(n){const e=n.getBufferIdentifier(),t=aU[e];return t(n)}function tX(n){return typeof n.guid=="function"?n.guid():null}var lU={exports:{}};(function(n){var e={};e.useBlobBuilder=function(){try{return new Blob([]),!1}catch{return!0}}(),e.useArrayBufferView=!e.useBlobBuilder&&function(){try{return new Blob([new Uint8Array([])]).size===0}catch{return!0}}(),n.exports.binaryFeatures=e;var t=n.exports.BlobBuilder;typeof window<"u"&&(t=n.exports.BlobBuilder=window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder||window.BlobBuilder);function i(){this._pieces=[],this._parts=[]}i.prototype.append=function(s){typeof s=="number"?this._pieces.push(s):(this.flush(),this._parts.push(s))},i.prototype.flush=function(){if(this._pieces.length>0){var s=new Uint8Array(this._pieces);e.useArrayBufferView||(s=s.buffer),this._parts.push(s),this._pieces=[]}},i.prototype.getBuffer=function(){if(this.flush(),e.useBlobBuilder){for(var s=new t,r=0,o=this._parts.length;r<o;r++)s.append(this._parts[r]);return s.getBlob()}else return new Blob(this._parts)},n.exports.BufferBuilder=i})(lU);var hU=lU.exports,iX=hU.BufferBuilder,jB=hU.binaryFeatures,nX={unpack:function(n){var e=new Is(n);return e.unpack()},pack:function(n){var e=new Rs;e.pack(n);var t=e.getBuffer();return t}},sX=nX;function Is(n){this.index=0,this.dataBuffer=n,this.dataView=new Uint8Array(this.dataBuffer),this.length=this.dataBuffer.byteLength}Is.prototype.unpack=function(){var n=this.unpack_uint8();if(n<128)return n;if((n^224)<32)return(n^224)-32;var e;if((e=n^160)<=15)return this.unpack_raw(e);if((e=n^176)<=15)return this.unpack_string(e);if((e=n^144)<=15)return this.unpack_array(e);if((e=n^128)<=15)return this.unpack_map(e);switch(n){case 192:return null;case 193:return;case 194:return!1;case 195:return!0;case 202:return this.unpack_float();case 203:return this.unpack_double();case 204:return this.unpack_uint8();case 205:return this.unpack_uint16();case 206:return this.unpack_uint32();case 207:return this.unpack_uint64();case 208:return this.unpack_int8();case 209:return this.unpack_int16();case 210:return this.unpack_int32();case 211:return this.unpack_int64();case 212:return;case 213:return;case 214:return;case 215:return;case 216:return e=this.unpack_uint16(),this.unpack_string(e);case 217:return e=this.unpack_uint32(),this.unpack_string(e);case 218:return e=this.unpack_uint16(),this.unpack_raw(e);case 219:return e=this.unpack_uint32(),this.unpack_raw(e);case 220:return e=this.unpack_uint16(),this.unpack_array(e);case 221:return e=this.unpack_uint32(),this.unpack_array(e);case 222:return e=this.unpack_uint16(),this.unpack_map(e);case 223:return e=this.unpack_uint32(),this.unpack_map(e)}};Is.prototype.unpack_uint8=function(){var n=this.dataView[this.index]&255;return this.index++,n};Is.prototype.unpack_uint16=function(){var n=this.read(2),e=(n[0]&255)*256+(n[1]&255);return this.index+=2,e};Is.prototype.unpack_uint32=function(){var n=this.read(4),e=((n[0]*256+n[1])*256+n[2])*256+n[3];return this.index+=4,e};Is.prototype.unpack_uint64=function(){var n=this.read(8),e=((((((n[0]*256+n[1])*256+n[2])*256+n[3])*256+n[4])*256+n[5])*256+n[6])*256+n[7];return this.index+=8,e};Is.prototype.unpack_int8=function(){var n=this.unpack_uint8();return n<128?n:n-256};Is.prototype.unpack_int16=function(){var n=this.unpack_uint16();return n<32768?n:n-65536};Is.prototype.unpack_int32=function(){var n=this.unpack_uint32();return n<Math.pow(2,31)?n:n-Math.pow(2,32)};Is.prototype.unpack_int64=function(){var n=this.unpack_uint64();return n<Math.pow(2,63)?n:n-Math.pow(2,64)};Is.prototype.unpack_raw=function(n){if(this.length<this.index+n)throw new Error("BinaryPackFailure: index is out of range "+this.index+" "+n+" "+this.length);var e=this.dataBuffer.slice(this.index,this.index+n);return this.index+=n,e};Is.prototype.unpack_string=function(n){for(var e=this.read(n),t=0,i="",s,r;t<n;)s=e[t],s<128?(i+=String.fromCharCode(s),t++):(s^192)<32?(r=(s^192)<<6|e[t+1]&63,i+=String.fromCharCode(r),t+=2):(r=(s&15)<<12|(e[t+1]&63)<<6|e[t+2]&63,i+=String.fromCharCode(r),t+=3);return this.index+=n,i};Is.prototype.unpack_array=function(n){for(var e=new Array(n),t=0;t<n;t++)e[t]=this.unpack();return e};Is.prototype.unpack_map=function(n){for(var e={},t=0;t<n;t++){var i=this.unpack(),s=this.unpack();e[i]=s}return e};Is.prototype.unpack_float=function(){var n=this.unpack_uint32(),e=n>>31,t=(n>>23&255)-127,i=n&8388607|8388608;return(e===0?1:-1)*i*Math.pow(2,t-23)};Is.prototype.unpack_double=function(){var n=this.unpack_uint32(),e=this.unpack_uint32(),t=n>>31,i=(n>>20&2047)-1023,s=n&1048575|1048576,r=s*Math.pow(2,i-20)+e*Math.pow(2,i-52);return(t===0?1:-1)*r};Is.prototype.read=function(n){var e=this.index;if(e+n<=this.length)return this.dataView.subarray(e,e+n);throw new Error("BinaryPackFailure: read index out of range")};function Rs(){this.bufferBuilder=new iX}Rs.prototype.getBuffer=function(){return this.bufferBuilder.getBuffer()};Rs.prototype.pack=function(n){var e=typeof n;if(e==="string")this.pack_string(n);else if(e==="number")Math.floor(n)===n?this.pack_integer(n):this.pack_double(n);else if(e==="boolean")n===!0?this.bufferBuilder.append(195):n===!1&&this.bufferBuilder.append(194);else if(e==="undefined")this.bufferBuilder.append(192);else if(e==="object")if(n===null)this.bufferBuilder.append(192);else{var t=n.constructor;if(t==Array)this.pack_array(n);else if(t==Blob||t==File||n instanceof Blob||n instanceof File)this.pack_bin(n);else if(t==ArrayBuffer)jB.useArrayBufferView?this.pack_bin(new Uint8Array(n)):this.pack_bin(n);else if("BYTES_PER_ELEMENT"in n)jB.useArrayBufferView?this.pack_bin(new Uint8Array(n.buffer)):this.pack_bin(n.buffer);else if(t==Object||t.toString().startsWith("class"))this.pack_object(n);else if(t==Date)this.pack_string(n.toString());else if(typeof n.toBinaryPack=="function")this.bufferBuilder.append(n.toBinaryPack());else throw new Error('Type "'+t.toString()+'" not yet supported')}else throw new Error('Type "'+e+'" not yet supported');this.bufferBuilder.flush()};Rs.prototype.pack_bin=function(n){var e=n.length||n.byteLength||n.size;if(e<=15)this.pack_uint8(160+e);else if(e<=65535)this.bufferBuilder.append(218),this.pack_uint16(e);else if(e<=4294967295)this.bufferBuilder.append(219),this.pack_uint32(e);else throw new Error("Invalid length");this.bufferBuilder.append(n)};Rs.prototype.pack_string=function(n){var e=oX(n);if(e<=15)this.pack_uint8(176+e);else if(e<=65535)this.bufferBuilder.append(216),this.pack_uint16(e);else if(e<=4294967295)this.bufferBuilder.append(217),this.pack_uint32(e);else throw new Error("Invalid length");this.bufferBuilder.append(n)};Rs.prototype.pack_array=function(n){var e=n.length;if(e<=15)this.pack_uint8(144+e);else if(e<=65535)this.bufferBuilder.append(220),this.pack_uint16(e);else if(e<=4294967295)this.bufferBuilder.append(221),this.pack_uint32(e);else throw new Error("Invalid length");for(var t=0;t<e;t++)this.pack(n[t])};Rs.prototype.pack_integer=function(n){if(n>=-32&&n<=127)this.bufferBuilder.append(n&255);else if(n>=0&&n<=255)this.bufferBuilder.append(204),this.pack_uint8(n);else if(n>=-128&&n<=127)this.bufferBuilder.append(208),this.pack_int8(n);else if(n>=0&&n<=65535)this.bufferBuilder.append(205),this.pack_uint16(n);else if(n>=-32768&&n<=32767)this.bufferBuilder.append(209),this.pack_int16(n);else if(n>=0&&n<=4294967295)this.bufferBuilder.append(206),this.pack_uint32(n);else if(n>=-2147483648&&n<=2147483647)this.bufferBuilder.append(210),this.pack_int32(n);else if(n>=-9223372036854776e3&&n<=9223372036854776e3)this.bufferBuilder.append(211),this.pack_int64(n);else if(n>=0&&n<=18446744073709552e3)this.bufferBuilder.append(207),this.pack_uint64(n);else throw new Error("Invalid integer")};Rs.prototype.pack_double=function(n){var e=0;n<0&&(e=1,n=-n);var t=Math.floor(Math.log(n)/Math.LN2),i=n/Math.pow(2,t)-1,s=Math.floor(i*Math.pow(2,52)),r=Math.pow(2,32),o=e<<31|t+1023<<20|s/r&1048575,a=s%r;this.bufferBuilder.append(203),this.pack_int32(o),this.pack_int32(a)};Rs.prototype.pack_object=function(n){var e=Object.keys(n),t=e.length;if(t<=15)this.pack_uint8(128+t);else if(t<=65535)this.bufferBuilder.append(222),this.pack_uint16(t);else if(t<=4294967295)this.bufferBuilder.append(223),this.pack_uint32(t);else throw new Error("Invalid length");for(var i in n)n.hasOwnProperty(i)&&(this.pack(i),this.pack(n[i]))};Rs.prototype.pack_uint8=function(n){this.bufferBuilder.append(n)};Rs.prototype.pack_uint16=function(n){this.bufferBuilder.append(n>>8),this.bufferBuilder.append(n&255)};Rs.prototype.pack_uint32=function(n){var e=n&4294967295;this.bufferBuilder.append((e&4278190080)>>>24),this.bufferBuilder.append((e&16711680)>>>16),this.bufferBuilder.append((e&65280)>>>8),this.bufferBuilder.append(e&255)};Rs.prototype.pack_uint64=function(n){var e=n/Math.pow(2,32),t=n%Math.pow(2,32);this.bufferBuilder.append((e&4278190080)>>>24),this.bufferBuilder.append((e&16711680)>>>16),this.bufferBuilder.append((e&65280)>>>8),this.bufferBuilder.append(e&255),this.bufferBuilder.append((t&4278190080)>>>24),this.bufferBuilder.append((t&16711680)>>>16),this.bufferBuilder.append((t&65280)>>>8),this.bufferBuilder.append(t&255)};Rs.prototype.pack_int8=function(n){this.bufferBuilder.append(n&255)};Rs.prototype.pack_int16=function(n){this.bufferBuilder.append((n&65280)>>8),this.bufferBuilder.append(n&255)};Rs.prototype.pack_int32=function(n){this.bufferBuilder.append(n>>>24&255),this.bufferBuilder.append((n&16711680)>>>16),this.bufferBuilder.append((n&65280)>>>8),this.bufferBuilder.append(n&255)};Rs.prototype.pack_int64=function(n){var e=Math.floor(n/Math.pow(2,32)),t=n%Math.pow(2,32);this.bufferBuilder.append((e&4278190080)>>>24),this.bufferBuilder.append((e&16711680)>>>16),this.bufferBuilder.append((e&65280)>>>8),this.bufferBuilder.append(e&255),this.bufferBuilder.append((t&4278190080)>>>24),this.bufferBuilder.append((t&16711680)>>>16),this.bufferBuilder.append((t&65280)>>>8),this.bufferBuilder.append(t&255)};function rX(n){var e=n.charCodeAt(0);return e<=2047?"00":e<=65535?"000":e<=2097151?"0000":e<=67108863?"00000":"000000"}function oX(n){return n.length>600?new Blob([n]).size:n.replace(/[^\u0000-\u007F]/g,rX).length}const WB=cx(sX);let uU=!0,dU=!0;function qm(n,e,t){const i=n.match(e);return i&&i.length>=t&&parseInt(i[t],10)}function Fp(n,e,t){if(!n.RTCPeerConnection)return;const i=n.RTCPeerConnection.prototype,s=i.addEventListener;i.addEventListener=function(o,a){if(o!==e)return s.apply(this,arguments);const c=l=>{const h=t(l);h&&(a.handleEvent?a.handleEvent(h):a(h))};return this._eventMap=this._eventMap||{},this._eventMap[e]||(this._eventMap[e]=new Map),this._eventMap[e].set(a,c),s.apply(this,[o,c])};const r=i.removeEventListener;i.removeEventListener=function(o,a){if(o!==e||!this._eventMap||!this._eventMap[e])return r.apply(this,arguments);if(!this._eventMap[e].has(a))return r.apply(this,arguments);const c=this._eventMap[e].get(a);return this._eventMap[e].delete(a),this._eventMap[e].size===0&&delete this._eventMap[e],Object.keys(this._eventMap).length===0&&delete this._eventMap,r.apply(this,[o,c])},Object.defineProperty(i,"on"+e,{get(){return this["_on"+e]},set(o){this["_on"+e]&&(this.removeEventListener(e,this["_on"+e]),delete this["_on"+e]),o&&this.addEventListener(e,this["_on"+e]=o)},enumerable:!0,configurable:!0})}function aX(n){return typeof n!="boolean"?new Error("Argument type: "+typeof n+". Please use a boolean."):(uU=n,n?"adapter.js logging disabled":"adapter.js logging enabled")}function cX(n){return typeof n!="boolean"?new Error("Argument type: "+typeof n+". Please use a boolean."):(dU=!n,"adapter.js deprecation warnings "+(n?"disabled":"enabled"))}function A1(){if(typeof window=="object"){if(uU)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function dx(n,e){dU&&console.warn(n+" is deprecated, please use "+e+" instead.")}function lX(n){const e={browser:null,version:null};if(typeof n>"u"||!n.navigator)return e.browser="Not a browser.",e;const{navigator:t}=n;if(t.mozGetUserMedia)e.browser="firefox",e.version=qm(t.userAgent,/Firefox\/(\d+)\./,1);else if(t.webkitGetUserMedia||n.isSecureContext===!1&&n.webkitRTCPeerConnection&&!n.RTCIceGatherer)e.browser="chrome",e.version=qm(t.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else if(t.mediaDevices&&t.userAgent.match(/Edge\/(\d+).(\d+)$/))e.browser="edge",e.version=qm(t.userAgent,/Edge\/(\d+).(\d+)$/,2);else if(n.RTCPeerConnection&&t.userAgent.match(/AppleWebKit\/(\d+)\./))e.browser="safari",e.version=qm(t.userAgent,/AppleWebKit\/(\d+)\./,1),e.supportsUnifiedPlan=n.RTCRtpTransceiver&&"currentDirection"in n.RTCRtpTransceiver.prototype;else return e.browser="Not a supported browser.",e;return e}function qB(n){return Object.prototype.toString.call(n)==="[object Object]"}function fU(n){return qB(n)?Object.keys(n).reduce(function(e,t){const i=qB(n[t]),s=i?fU(n[t]):n[t],r=i&&!Object.keys(s).length;return s===void 0||r?e:Object.assign(e,{[t]:s})},{}):n}function WE(n,e,t){!e||t.has(e.id)||(t.set(e.id,e),Object.keys(e).forEach(i=>{i.endsWith("Id")?WE(n,n.get(e[i]),t):i.endsWith("Ids")&&e[i].forEach(s=>{WE(n,n.get(s),t)})}))}function XB(n,e,t){const i=t?"outbound-rtp":"inbound-rtp",s=new Map;if(e===null)return s;const r=[];return n.forEach(o=>{o.type==="track"&&o.trackIdentifier===e.id&&r.push(o)}),r.forEach(o=>{n.forEach(a=>{a.type===i&&a.trackId===o.id&&WE(n,a,s)})}),s}const YB=A1;function pU(n,e){const t=n&&n.navigator;if(!t.mediaDevices)return;const i=function(a){if(typeof a!="object"||a.mandatory||a.optional)return a;const c={};return Object.keys(a).forEach(l=>{if(l==="require"||l==="advanced"||l==="mediaSource")return;const h=typeof a[l]=="object"?a[l]:{ideal:a[l]};h.exact!==void 0&&typeof h.exact=="number"&&(h.min=h.max=h.exact);const d=function(f,p){return f?f+p.charAt(0).toUpperCase()+p.slice(1):p==="deviceId"?"sourceId":p};if(h.ideal!==void 0){c.optional=c.optional||[];let f={};typeof h.ideal=="number"?(f[d("min",l)]=h.ideal,c.optional.push(f),f={},f[d("max",l)]=h.ideal,c.optional.push(f)):(f[d("",l)]=h.ideal,c.optional.push(f))}h.exact!==void 0&&typeof h.exact!="number"?(c.mandatory=c.mandatory||{},c.mandatory[d("",l)]=h.exact):["min","max"].forEach(f=>{h[f]!==void 0&&(c.mandatory=c.mandatory||{},c.mandatory[d(f,l)]=h[f])})}),a.advanced&&(c.optional=(c.optional||[]).concat(a.advanced)),c},s=function(a,c){if(e.version>=61)return c(a);if(a=JSON.parse(JSON.stringify(a)),a&&typeof a.audio=="object"){const l=function(h,d,f){d in h&&!(f in h)&&(h[f]=h[d],delete h[d])};a=JSON.parse(JSON.stringify(a)),l(a.audio,"autoGainControl","googAutoGainControl"),l(a.audio,"noiseSuppression","googNoiseSuppression"),a.audio=i(a.audio)}if(a&&typeof a.video=="object"){let l=a.video.facingMode;l=l&&(typeof l=="object"?l:{ideal:l});const h=e.version<66;if(l&&(l.exact==="user"||l.exact==="environment"||l.ideal==="user"||l.ideal==="environment")&&!(t.mediaDevices.getSupportedConstraints&&t.mediaDevices.getSupportedConstraints().facingMode&&!h)){delete a.video.facingMode;let d;if(l.exact==="environment"||l.ideal==="environment"?d=["back","rear"]:(l.exact==="user"||l.ideal==="user")&&(d=["front"]),d)return t.mediaDevices.enumerateDevices().then(f=>{f=f.filter(m=>m.kind==="videoinput");let p=f.find(m=>d.some(g=>m.label.toLowerCase().includes(g)));return!p&&f.length&&d.includes("back")&&(p=f[f.length-1]),p&&(a.video.deviceId=l.exact?{exact:p.deviceId}:{ideal:p.deviceId}),a.video=i(a.video),YB("chrome: "+JSON.stringify(a)),c(a)})}a.video=i(a.video)}return YB("chrome: "+JSON.stringify(a)),c(a)},r=function(a){return e.version>=64?a:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[a.name]||a.name,message:a.message,constraint:a.constraint||a.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}},o=function(a,c,l){s(a,h=>{t.webkitGetUserMedia(h,c,d=>{l&&l(r(d))})})};if(t.getUserMedia=o.bind(t),t.mediaDevices.getUserMedia){const a=t.mediaDevices.getUserMedia.bind(t.mediaDevices);t.mediaDevices.getUserMedia=function(c){return s(c,l=>a(l).then(h=>{if(l.audio&&!h.getAudioTracks().length||l.video&&!h.getVideoTracks().length)throw h.getTracks().forEach(d=>{d.stop()}),new DOMException("","NotFoundError");return h},h=>Promise.reject(r(h))))}}}function hX(n,e){if(!(n.navigator.mediaDevices&&"getDisplayMedia"in n.navigator.mediaDevices)&&n.navigator.mediaDevices){if(typeof e!="function"){console.error("shimGetDisplayMedia: getSourceId argument is not a function");return}n.navigator.mediaDevices.getDisplayMedia=function(i){return e(i).then(s=>{const r=i.video&&i.video.width,o=i.video&&i.video.height,a=i.video&&i.video.frameRate;return i.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:s,maxFrameRate:a||3}},r&&(i.video.mandatory.maxWidth=r),o&&(i.video.mandatory.maxHeight=o),n.navigator.mediaDevices.getUserMedia(i)})}}}function mU(n){n.MediaStream=n.MediaStream||n.webkitMediaStream}function gU(n){if(typeof n=="object"&&n.RTCPeerConnection&&!("ontrack"in n.RTCPeerConnection.prototype)){Object.defineProperty(n.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(t){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=t)},enumerable:!0,configurable:!0});const e=n.RTCPeerConnection.prototype.setRemoteDescription;n.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=i=>{i.stream.addEventListener("addtrack",s=>{let r;n.RTCPeerConnection.prototype.getReceivers?r=this.getReceivers().find(a=>a.track&&a.track.id===s.track.id):r={track:s.track};const o=new Event("track");o.track=s.track,o.receiver=r,o.transceiver={receiver:r},o.streams=[i.stream],this.dispatchEvent(o)}),i.stream.getTracks().forEach(s=>{let r;n.RTCPeerConnection.prototype.getReceivers?r=this.getReceivers().find(a=>a.track&&a.track.id===s.id):r={track:s};const o=new Event("track");o.track=s,o.receiver=r,o.transceiver={receiver:r},o.streams=[i.stream],this.dispatchEvent(o)})},this.addEventListener("addstream",this._ontrackpoly)),e.apply(this,arguments)}}else Fp(n,"track",e=>(e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e))}function AU(n){if(typeof n=="object"&&n.RTCPeerConnection&&!("getSenders"in n.RTCPeerConnection.prototype)&&"createDTMFSender"in n.RTCPeerConnection.prototype){const e=function(s,r){return{track:r,get dtmf(){return this._dtmf===void 0&&(r.kind==="audio"?this._dtmf=s.createDTMFSender(r):this._dtmf=null),this._dtmf},_pc:s}};if(!n.RTCPeerConnection.prototype.getSenders){n.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const s=n.RTCPeerConnection.prototype.addTrack;n.RTCPeerConnection.prototype.addTrack=function(a,c){let l=s.apply(this,arguments);return l||(l=e(this,a),this._senders.push(l)),l};const r=n.RTCPeerConnection.prototype.removeTrack;n.RTCPeerConnection.prototype.removeTrack=function(a){r.apply(this,arguments);const c=this._senders.indexOf(a);c!==-1&&this._senders.splice(c,1)}}const t=n.RTCPeerConnection.prototype.addStream;n.RTCPeerConnection.prototype.addStream=function(r){this._senders=this._senders||[],t.apply(this,[r]),r.getTracks().forEach(o=>{this._senders.push(e(this,o))})};const i=n.RTCPeerConnection.prototype.removeStream;n.RTCPeerConnection.prototype.removeStream=function(r){this._senders=this._senders||[],i.apply(this,[r]),r.getTracks().forEach(o=>{const a=this._senders.find(c=>c.track===o);a&&this._senders.splice(this._senders.indexOf(a),1)})}}else if(typeof n=="object"&&n.RTCPeerConnection&&"getSenders"in n.RTCPeerConnection.prototype&&"createDTMFSender"in n.RTCPeerConnection.prototype&&n.RTCRtpSender&&!("dtmf"in n.RTCRtpSender.prototype)){const e=n.RTCPeerConnection.prototype.getSenders;n.RTCPeerConnection.prototype.getSenders=function(){const i=e.apply(this,[]);return i.forEach(s=>s._pc=this),i},Object.defineProperty(n.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function vU(n){if(!n.RTCPeerConnection)return;const e=n.RTCPeerConnection.prototype.getStats;n.RTCPeerConnection.prototype.getStats=function(){const[i,s,r]=arguments;if(arguments.length>0&&typeof i=="function")return e.apply(this,arguments);if(e.length===0&&(arguments.length===0||typeof i!="function"))return e.apply(this,[]);const o=function(c){const l={};return c.result().forEach(d=>{const f={id:d.id,timestamp:d.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[d.type]||d.type};d.names().forEach(p=>{f[p]=d.stat(p)}),l[f.id]=f}),l},a=function(c){return new Map(Object.keys(c).map(l=>[l,c[l]]))};if(arguments.length>=2){const c=function(l){s(a(o(l)))};return e.apply(this,[c,i])}return new Promise((c,l)=>{e.apply(this,[function(h){c(a(o(h)))},l])}).then(s,r)}}function yU(n){if(!(typeof n=="object"&&n.RTCPeerConnection&&n.RTCRtpSender&&n.RTCRtpReceiver))return;if(!("getStats"in n.RTCRtpSender.prototype)){const t=n.RTCPeerConnection.prototype.getSenders;t&&(n.RTCPeerConnection.prototype.getSenders=function(){const r=t.apply(this,[]);return r.forEach(o=>o._pc=this),r});const i=n.RTCPeerConnection.prototype.addTrack;i&&(n.RTCPeerConnection.prototype.addTrack=function(){const r=i.apply(this,arguments);return r._pc=this,r}),n.RTCRtpSender.prototype.getStats=function(){const r=this;return this._pc.getStats().then(o=>XB(o,r.track,!0))}}if(!("getStats"in n.RTCRtpReceiver.prototype)){const t=n.RTCPeerConnection.prototype.getReceivers;t&&(n.RTCPeerConnection.prototype.getReceivers=function(){const s=t.apply(this,[]);return s.forEach(r=>r._pc=this),s}),Fp(n,"track",i=>(i.receiver._pc=i.srcElement,i)),n.RTCRtpReceiver.prototype.getStats=function(){const s=this;return this._pc.getStats().then(r=>XB(r,s.track,!1))}}if(!("getStats"in n.RTCRtpSender.prototype&&"getStats"in n.RTCRtpReceiver.prototype))return;const e=n.RTCPeerConnection.prototype.getStats;n.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof n.MediaStreamTrack){const i=arguments[0];let s,r,o;return this.getSenders().forEach(a=>{a.track===i&&(s?o=!0:s=a)}),this.getReceivers().forEach(a=>(a.track===i&&(r?o=!0:r=a),a.track===i)),o||s&&r?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):s?s.getStats():r?r.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return e.apply(this,arguments)}}function bU(n){n.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(o=>this._shimmedLocalStreams[o][0])};const e=n.RTCPeerConnection.prototype.addTrack;n.RTCPeerConnection.prototype.addTrack=function(o,a){if(!a)return e.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const c=e.apply(this,arguments);return this._shimmedLocalStreams[a.id]?this._shimmedLocalStreams[a.id].indexOf(c)===-1&&this._shimmedLocalStreams[a.id].push(c):this._shimmedLocalStreams[a.id]=[a,c],c};const t=n.RTCPeerConnection.prototype.addStream;n.RTCPeerConnection.prototype.addStream=function(o){this._shimmedLocalStreams=this._shimmedLocalStreams||{},o.getTracks().forEach(l=>{if(this.getSenders().find(d=>d.track===l))throw new DOMException("Track already exists.","InvalidAccessError")});const a=this.getSenders();t.apply(this,arguments);const c=this.getSenders().filter(l=>a.indexOf(l)===-1);this._shimmedLocalStreams[o.id]=[o].concat(c)};const i=n.RTCPeerConnection.prototype.removeStream;n.RTCPeerConnection.prototype.removeStream=function(o){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[o.id],i.apply(this,arguments)};const s=n.RTCPeerConnection.prototype.removeTrack;n.RTCPeerConnection.prototype.removeTrack=function(o){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},o&&Object.keys(this._shimmedLocalStreams).forEach(a=>{const c=this._shimmedLocalStreams[a].indexOf(o);c!==-1&&this._shimmedLocalStreams[a].splice(c,1),this._shimmedLocalStreams[a].length===1&&delete this._shimmedLocalStreams[a]}),s.apply(this,arguments)}}function _U(n,e){if(!n.RTCPeerConnection)return;if(n.RTCPeerConnection.prototype.addTrack&&e.version>=65)return bU(n);const t=n.RTCPeerConnection.prototype.getLocalStreams;n.RTCPeerConnection.prototype.getLocalStreams=function(){const h=t.apply(this);return this._reverseStreams=this._reverseStreams||{},h.map(d=>this._reverseStreams[d.id])};const i=n.RTCPeerConnection.prototype.addStream;n.RTCPeerConnection.prototype.addStream=function(h){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},h.getTracks().forEach(d=>{if(this.getSenders().find(p=>p.track===d))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[h.id]){const d=new n.MediaStream(h.getTracks());this._streams[h.id]=d,this._reverseStreams[d.id]=h,h=d}i.apply(this,[h])};const s=n.RTCPeerConnection.prototype.removeStream;n.RTCPeerConnection.prototype.removeStream=function(h){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},s.apply(this,[this._streams[h.id]||h]),delete this._reverseStreams[this._streams[h.id]?this._streams[h.id].id:h.id],delete this._streams[h.id]},n.RTCPeerConnection.prototype.addTrack=function(h,d){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const f=[].slice.call(arguments,1);if(f.length!==1||!f[0].getTracks().find(g=>g===h))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(g=>g.track===h))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const m=this._streams[d.id];if(m)m.addTrack(h),Promise.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const g=new n.MediaStream([h]);this._streams[d.id]=g,this._reverseStreams[g.id]=d,this.addStream(g)}return this.getSenders().find(g=>g.track===h)};function r(l,h){let d=h.sdp;return Object.keys(l._reverseStreams||[]).forEach(f=>{const p=l._reverseStreams[f],m=l._streams[p.id];d=d.replace(new RegExp(m.id,"g"),p.id)}),new RTCSessionDescription({type:h.type,sdp:d})}function o(l,h){let d=h.sdp;return Object.keys(l._reverseStreams||[]).forEach(f=>{const p=l._reverseStreams[f],m=l._streams[p.id];d=d.replace(new RegExp(p.id,"g"),m.id)}),new RTCSessionDescription({type:h.type,sdp:d})}["createOffer","createAnswer"].forEach(function(l){const h=n.RTCPeerConnection.prototype[l],d={[l](){const f=arguments;return arguments.length&&typeof arguments[0]=="function"?h.apply(this,[m=>{const g=r(this,m);f[0].apply(null,[g])},m=>{f[1]&&f[1].apply(null,m)},arguments[2]]):h.apply(this,arguments).then(m=>r(this,m))}};n.RTCPeerConnection.prototype[l]=d[l]});const a=n.RTCPeerConnection.prototype.setLocalDescription;n.RTCPeerConnection.prototype.setLocalDescription=function(){return!arguments.length||!arguments[0].type?a.apply(this,arguments):(arguments[0]=o(this,arguments[0]),a.apply(this,arguments))};const c=Object.getOwnPropertyDescriptor(n.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(n.RTCPeerConnection.prototype,"localDescription",{get(){const l=c.get.apply(this);return l.type===""?l:r(this,l)}}),n.RTCPeerConnection.prototype.removeTrack=function(h){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!h._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(h._pc===this))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{};let f;Object.keys(this._streams).forEach(p=>{this._streams[p].getTracks().find(g=>h.track===g)&&(f=this._streams[p])}),f&&(f.getTracks().length===1?this.removeStream(this._reverseStreams[f.id]):f.removeTrack(h.track),this.dispatchEvent(new Event("negotiationneeded")))}}function qE(n,e){!n.RTCPeerConnection&&n.webkitRTCPeerConnection&&(n.RTCPeerConnection=n.webkitRTCPeerConnection),n.RTCPeerConnection&&e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){const i=n.RTCPeerConnection.prototype[t],s={[t](){return arguments[0]=new(t==="addIceCandidate"?n.RTCIceCandidate:n.RTCSessionDescription)(arguments[0]),i.apply(this,arguments)}};n.RTCPeerConnection.prototype[t]=s[t]})}function xU(n,e){Fp(n,"negotiationneeded",t=>{const i=t.target;if(!((e.version<72||i.getConfiguration&&i.getConfiguration().sdpSemantics==="plan-b")&&i.signalingState!=="stable"))return t})}const JB=Object.freeze(Object.defineProperty({__proto__:null,fixNegotiationNeeded:xU,shimAddTrackRemoveTrack:_U,shimAddTrackRemoveTrackWithNative:bU,shimGetDisplayMedia:hX,shimGetSendersWithDtmf:AU,shimGetStats:vU,shimGetUserMedia:pU,shimMediaStream:mU,shimOnTrack:gU,shimPeerConnection:qE,shimSenderReceiverGetStats:yU},Symbol.toStringTag,{value:"Module"}));function uX(n,e){let t=!1;return n=JSON.parse(JSON.stringify(n)),n.filter(i=>{if(i&&(i.urls||i.url)){let s=i.urls||i.url;i.url&&!i.urls&&dx("RTCIceServer.url","RTCIceServer.urls");const r=typeof s=="string";return r&&(s=[s]),s=s.filter(o=>{if(o.indexOf("stun:")===0)return!1;const a=o.startsWith("turn")&&!o.startsWith("turn:[")&&o.includes("transport=udp");return a&&!t?(t=!0,!0):a&&!t}),delete i.url,i.urls=r?s[0]:s,!!s.length}})}var wU={exports:{}};(function(n){var e={};e.generateIdentifier=function(){return Math.random().toString(36).substr(2,10)},e.localCName=e.generateIdentifier(),e.splitLines=function(t){return t.trim().split(`
`).map(function(i){return i.trim()})},e.splitSections=function(t){var i=t.split(`
m=`);return i.map(function(s,r){return(r>0?"m="+s:s).trim()+`\r
`})},e.getDescription=function(t){var i=e.splitSections(t);return i&&i[0]},e.getMediaSections=function(t){var i=e.splitSections(t);return i.shift(),i},e.matchPrefix=function(t,i){return e.splitLines(t).filter(function(s){return s.indexOf(i)===0})},e.parseCandidate=function(t){var i;t.indexOf("a=candidate:")===0?i=t.substring(12).split(" "):i=t.substring(10).split(" ");for(var s={foundation:i[0],component:parseInt(i[1],10),protocol:i[2].toLowerCase(),priority:parseInt(i[3],10),ip:i[4],address:i[4],port:parseInt(i[5],10),type:i[7]},r=8;r<i.length;r+=2)switch(i[r]){case"raddr":s.relatedAddress=i[r+1];break;case"rport":s.relatedPort=parseInt(i[r+1],10);break;case"tcptype":s.tcpType=i[r+1];break;case"ufrag":s.ufrag=i[r+1],s.usernameFragment=i[r+1];break;default:s[i[r]]=i[r+1];break}return s},e.writeCandidate=function(t){var i=[];i.push(t.foundation),i.push(t.component),i.push(t.protocol.toUpperCase()),i.push(t.priority),i.push(t.address||t.ip),i.push(t.port);var s=t.type;return i.push("typ"),i.push(s),s!=="host"&&t.relatedAddress&&t.relatedPort&&(i.push("raddr"),i.push(t.relatedAddress),i.push("rport"),i.push(t.relatedPort)),t.tcpType&&t.protocol.toLowerCase()==="tcp"&&(i.push("tcptype"),i.push(t.tcpType)),(t.usernameFragment||t.ufrag)&&(i.push("ufrag"),i.push(t.usernameFragment||t.ufrag)),"candidate:"+i.join(" ")},e.parseIceOptions=function(t){return t.substr(14).split(" ")},e.parseRtpMap=function(t){var i=t.substr(9).split(" "),s={payloadType:parseInt(i.shift(),10)};return i=i[0].split("/"),s.name=i[0],s.clockRate=parseInt(i[1],10),s.channels=i.length===3?parseInt(i[2],10):1,s.numChannels=s.channels,s},e.writeRtpMap=function(t){var i=t.payloadType;t.preferredPayloadType!==void 0&&(i=t.preferredPayloadType);var s=t.channels||t.numChannels||1;return"a=rtpmap:"+i+" "+t.name+"/"+t.clockRate+(s!==1?"/"+s:"")+`\r
`},e.parseExtmap=function(t){var i=t.substr(9).split(" ");return{id:parseInt(i[0],10),direction:i[0].indexOf("/")>0?i[0].split("/")[1]:"sendrecv",uri:i[1]}},e.writeExtmap=function(t){return"a=extmap:"+(t.id||t.preferredId)+(t.direction&&t.direction!=="sendrecv"?"/"+t.direction:"")+" "+t.uri+`\r
`},e.parseFmtp=function(t){for(var i={},s,r=t.substr(t.indexOf(" ")+1).split(";"),o=0;o<r.length;o++)s=r[o].trim().split("="),i[s[0].trim()]=s[1];return i},e.writeFmtp=function(t){var i="",s=t.payloadType;if(t.preferredPayloadType!==void 0&&(s=t.preferredPayloadType),t.parameters&&Object.keys(t.parameters).length){var r=[];Object.keys(t.parameters).forEach(function(o){t.parameters[o]?r.push(o+"="+t.parameters[o]):r.push(o)}),i+="a=fmtp:"+s+" "+r.join(";")+`\r
`}return i},e.parseRtcpFb=function(t){var i=t.substr(t.indexOf(" ")+1).split(" ");return{type:i.shift(),parameter:i.join(" ")}},e.writeRtcpFb=function(t){var i="",s=t.payloadType;return t.preferredPayloadType!==void 0&&(s=t.preferredPayloadType),t.rtcpFeedback&&t.rtcpFeedback.length&&t.rtcpFeedback.forEach(function(r){i+="a=rtcp-fb:"+s+" "+r.type+(r.parameter&&r.parameter.length?" "+r.parameter:"")+`\r
`}),i},e.parseSsrcMedia=function(t){var i=t.indexOf(" "),s={ssrc:parseInt(t.substr(7,i-7),10)},r=t.indexOf(":",i);return r>-1?(s.attribute=t.substr(i+1,r-i-1),s.value=t.substr(r+1)):s.attribute=t.substr(i+1),s},e.parseSsrcGroup=function(t){var i=t.substr(13).split(" ");return{semantics:i.shift(),ssrcs:i.map(function(s){return parseInt(s,10)})}},e.getMid=function(t){var i=e.matchPrefix(t,"a=mid:")[0];if(i)return i.substr(6)},e.parseFingerprint=function(t){var i=t.substr(14).split(" ");return{algorithm:i[0].toLowerCase(),value:i[1]}},e.getDtlsParameters=function(t,i){var s=e.matchPrefix(t+i,"a=fingerprint:");return{role:"auto",fingerprints:s.map(e.parseFingerprint)}},e.writeDtlsParameters=function(t,i){var s="a=setup:"+i+`\r
`;return t.fingerprints.forEach(function(r){s+="a=fingerprint:"+r.algorithm+" "+r.value+`\r
`}),s},e.parseCryptoLine=function(t){var i=t.substr(9).split(" ");return{tag:parseInt(i[0],10),cryptoSuite:i[1],keyParams:i[2],sessionParams:i.slice(3)}},e.writeCryptoLine=function(t){return"a=crypto:"+t.tag+" "+t.cryptoSuite+" "+(typeof t.keyParams=="object"?e.writeCryptoKeyParams(t.keyParams):t.keyParams)+(t.sessionParams?" "+t.sessionParams.join(" "):"")+`\r
`},e.parseCryptoKeyParams=function(t){if(t.indexOf("inline:")!==0)return null;var i=t.substr(7).split("|");return{keyMethod:"inline",keySalt:i[0],lifeTime:i[1],mkiValue:i[2]?i[2].split(":")[0]:void 0,mkiLength:i[2]?i[2].split(":")[1]:void 0}},e.writeCryptoKeyParams=function(t){return t.keyMethod+":"+t.keySalt+(t.lifeTime?"|"+t.lifeTime:"")+(t.mkiValue&&t.mkiLength?"|"+t.mkiValue+":"+t.mkiLength:"")},e.getCryptoParameters=function(t,i){var s=e.matchPrefix(t+i,"a=crypto:");return s.map(e.parseCryptoLine)},e.getIceParameters=function(t,i){var s=e.matchPrefix(t+i,"a=ice-ufrag:")[0],r=e.matchPrefix(t+i,"a=ice-pwd:")[0];return s&&r?{usernameFragment:s.substr(12),password:r.substr(10)}:null},e.writeIceParameters=function(t){return"a=ice-ufrag:"+t.usernameFragment+`\r
a=ice-pwd:`+t.password+`\r
`},e.parseRtpParameters=function(t){for(var i={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},s=e.splitLines(t),r=s[0].split(" "),o=3;o<r.length;o++){var a=r[o],c=e.matchPrefix(t,"a=rtpmap:"+a+" ")[0];if(c){var l=e.parseRtpMap(c),h=e.matchPrefix(t,"a=fmtp:"+a+" ");switch(l.parameters=h.length?e.parseFmtp(h[0]):{},l.rtcpFeedback=e.matchPrefix(t,"a=rtcp-fb:"+a+" ").map(e.parseRtcpFb),i.codecs.push(l),l.name.toUpperCase()){case"RED":case"ULPFEC":i.fecMechanisms.push(l.name.toUpperCase());break}}}return e.matchPrefix(t,"a=extmap:").forEach(function(d){i.headerExtensions.push(e.parseExtmap(d))}),i},e.writeRtpDescription=function(t,i){var s="";s+="m="+t+" ",s+=i.codecs.length>0?"9":"0",s+=" UDP/TLS/RTP/SAVPF ",s+=i.codecs.map(function(o){return o.preferredPayloadType!==void 0?o.preferredPayloadType:o.payloadType}).join(" ")+`\r
`,s+=`c=IN IP4 0.0.0.0\r
`,s+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,i.codecs.forEach(function(o){s+=e.writeRtpMap(o),s+=e.writeFmtp(o),s+=e.writeRtcpFb(o)});var r=0;return i.codecs.forEach(function(o){o.maxptime>r&&(r=o.maxptime)}),r>0&&(s+="a=maxptime:"+r+`\r
`),s+=`a=rtcp-mux\r
`,i.headerExtensions&&i.headerExtensions.forEach(function(o){s+=e.writeExtmap(o)}),s},e.parseRtpEncodingParameters=function(t){var i=[],s=e.parseRtpParameters(t),r=s.fecMechanisms.indexOf("RED")!==-1,o=s.fecMechanisms.indexOf("ULPFEC")!==-1,a=e.matchPrefix(t,"a=ssrc:").map(function(f){return e.parseSsrcMedia(f)}).filter(function(f){return f.attribute==="cname"}),c=a.length>0&&a[0].ssrc,l,h=e.matchPrefix(t,"a=ssrc-group:FID").map(function(f){var p=f.substr(17).split(" ");return p.map(function(m){return parseInt(m,10)})});h.length>0&&h[0].length>1&&h[0][0]===c&&(l=h[0][1]),s.codecs.forEach(function(f){if(f.name.toUpperCase()==="RTX"&&f.parameters.apt){var p={ssrc:c,codecPayloadType:parseInt(f.parameters.apt,10)};c&&l&&(p.rtx={ssrc:l}),i.push(p),r&&(p=JSON.parse(JSON.stringify(p)),p.fec={ssrc:c,mechanism:o?"red+ulpfec":"red"},i.push(p))}}),i.length===0&&c&&i.push({ssrc:c});var d=e.matchPrefix(t,"b=");return d.length&&(d[0].indexOf("b=TIAS:")===0?d=parseInt(d[0].substr(7),10):d[0].indexOf("b=AS:")===0?d=parseInt(d[0].substr(5),10)*1e3*.95-50*40*8:d=void 0,i.forEach(function(f){f.maxBitrate=d})),i},e.parseRtcpParameters=function(t){var i={},s=e.matchPrefix(t,"a=ssrc:").map(function(a){return e.parseSsrcMedia(a)}).filter(function(a){return a.attribute==="cname"})[0];s&&(i.cname=s.value,i.ssrc=s.ssrc);var r=e.matchPrefix(t,"a=rtcp-rsize");i.reducedSize=r.length>0,i.compound=r.length===0;var o=e.matchPrefix(t,"a=rtcp-mux");return i.mux=o.length>0,i},e.parseMsid=function(t){var i,s=e.matchPrefix(t,"a=msid:");if(s.length===1)return i=s[0].substr(7).split(" "),{stream:i[0],track:i[1]};var r=e.matchPrefix(t,"a=ssrc:").map(function(o){return e.parseSsrcMedia(o)}).filter(function(o){return o.attribute==="msid"});if(r.length>0)return i=r[0].value.split(" "),{stream:i[0],track:i[1]}},e.parseSctpDescription=function(t){var i=e.parseMLine(t),s=e.matchPrefix(t,"a=max-message-size:"),r;s.length>0&&(r=parseInt(s[0].substr(19),10)),isNaN(r)&&(r=65536);var o=e.matchPrefix(t,"a=sctp-port:");if(o.length>0)return{port:parseInt(o[0].substr(12),10),protocol:i.fmt,maxMessageSize:r};var a=e.matchPrefix(t,"a=sctpmap:");if(a.length>0){var c=e.matchPrefix(t,"a=sctpmap:")[0].substr(10).split(" ");return{port:parseInt(c[0],10),protocol:c[1],maxMessageSize:r}}},e.writeSctpDescription=function(t,i){var s=[];return t.protocol!=="DTLS/SCTP"?s=["m="+t.kind+" 9 "+t.protocol+" "+i.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+i.port+`\r
`]:s=["m="+t.kind+" 9 "+t.protocol+" "+i.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+i.port+" "+i.protocol+` 65535\r
`],i.maxMessageSize!==void 0&&s.push("a=max-message-size:"+i.maxMessageSize+`\r
`),s.join("")},e.generateSessionId=function(){return Math.random().toString().substr(2,21)},e.writeSessionBoilerplate=function(t,i,s){var r,o=i!==void 0?i:2;t?r=t:r=e.generateSessionId();var a=s||"thisisadapterortc";return`v=0\r
o=`+a+" "+r+" "+o+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},e.writeMediaSection=function(t,i,s,r){var o=e.writeRtpDescription(t.kind,i);if(o+=e.writeIceParameters(t.iceGatherer.getLocalParameters()),o+=e.writeDtlsParameters(t.dtlsTransport.getLocalParameters(),s==="offer"?"actpass":"active"),o+="a=mid:"+t.mid+`\r
`,t.direction?o+="a="+t.direction+`\r
`:t.rtpSender&&t.rtpReceiver?o+=`a=sendrecv\r
`:t.rtpSender?o+=`a=sendonly\r
`:t.rtpReceiver?o+=`a=recvonly\r
`:o+=`a=inactive\r
`,t.rtpSender){var a="msid:"+r.id+" "+t.rtpSender.track.id+`\r
`;o+="a="+a,o+="a=ssrc:"+t.sendEncodingParameters[0].ssrc+" "+a,t.sendEncodingParameters[0].rtx&&(o+="a=ssrc:"+t.sendEncodingParameters[0].rtx.ssrc+" "+a,o+="a=ssrc-group:FID "+t.sendEncodingParameters[0].ssrc+" "+t.sendEncodingParameters[0].rtx.ssrc+`\r
`)}return o+="a=ssrc:"+t.sendEncodingParameters[0].ssrc+" cname:"+e.localCName+`\r
`,t.rtpSender&&t.sendEncodingParameters[0].rtx&&(o+="a=ssrc:"+t.sendEncodingParameters[0].rtx.ssrc+" cname:"+e.localCName+`\r
`),o},e.getDirection=function(t,i){for(var s=e.splitLines(t),r=0;r<s.length;r++)switch(s[r]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return s[r].substr(2)}return i?e.getDirection(i):"sendrecv"},e.getKind=function(t){var i=e.splitLines(t),s=i[0].split(" ");return s[0].substr(2)},e.isRejected=function(t){return t.split(" ",2)[1]==="0"},e.parseMLine=function(t){var i=e.splitLines(t),s=i[0].substr(2).split(" ");return{kind:s[0],port:parseInt(s[1],10),protocol:s[2],fmt:s.slice(3).join(" ")}},e.parseOLine=function(t){var i=e.matchPrefix(t,"o=")[0],s=i.substr(2).split(" ");return{username:s[0],sessionId:s[1],sessionVersion:parseInt(s[2],10),netType:s[3],addressType:s[4],address:s[5]}},e.isValidSDP=function(t){if(typeof t!="string"||t.length===0)return!1;for(var i=e.splitLines(t),s=0;s<i.length;s++)if(i[s].length<2||i[s].charAt(1)!=="=")return!1;return!0},n.exports=e})(wU);var SU=wU.exports;const I0=cx(SU);var Ct=SU;function dX(n){return{inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[n.type]||n.type}function KB(n,e,t,i,s){var r=Ct.writeRtpDescription(n.kind,e);if(r+=Ct.writeIceParameters(n.iceGatherer.getLocalParameters()),r+=Ct.writeDtlsParameters(n.dtlsTransport.getLocalParameters(),t==="offer"?"actpass":s||"active"),r+="a=mid:"+n.mid+`\r
`,n.rtpSender&&n.rtpReceiver?r+=`a=sendrecv\r
`:n.rtpSender?r+=`a=sendonly\r
`:n.rtpReceiver?r+=`a=recvonly\r
`:r+=`a=inactive\r
`,n.rtpSender){var o=n.rtpSender._initialTrackId||n.rtpSender.track.id;n.rtpSender._initialTrackId=o;var a="msid:"+(i?i.id:"-")+" "+o+`\r
`;r+="a="+a,r+="a=ssrc:"+n.sendEncodingParameters[0].ssrc+" "+a,n.sendEncodingParameters[0].rtx&&(r+="a=ssrc:"+n.sendEncodingParameters[0].rtx.ssrc+" "+a,r+="a=ssrc-group:FID "+n.sendEncodingParameters[0].ssrc+" "+n.sendEncodingParameters[0].rtx.ssrc+`\r
`)}return r+="a=ssrc:"+n.sendEncodingParameters[0].ssrc+" cname:"+Ct.localCName+`\r
`,n.rtpSender&&n.sendEncodingParameters[0].rtx&&(r+="a=ssrc:"+n.sendEncodingParameters[0].rtx.ssrc+" cname:"+Ct.localCName+`\r
`),r}function fX(n,e){var t=!1;return n=JSON.parse(JSON.stringify(n)),n.filter(function(i){if(i&&(i.urls||i.url)){var s=i.urls||i.url;i.url&&!i.urls&&console.warn("RTCIceServer.url is deprecated! Use urls instead.");var r=typeof s=="string";return r&&(s=[s]),s=s.filter(function(o){var a=o.indexOf("turn:")===0&&o.indexOf("transport=udp")!==-1&&o.indexOf("turn:[")===-1&&!t;return a?(t=!0,!0):o.indexOf("stun:")===0&&e>=14393&&o.indexOf("?transport=udp")===-1}),delete i.url,i.urls=r?s[0]:s,!!s.length}})}function Ly(n,e){var t={codecs:[],headerExtensions:[],fecMechanisms:[]},i=function(r,o){r=parseInt(r,10);for(var a=0;a<o.length;a++)if(o[a].payloadType===r||o[a].preferredPayloadType===r)return o[a]},s=function(r,o,a,c){var l=i(r.parameters.apt,a),h=i(o.parameters.apt,c);return l&&h&&l.name.toLowerCase()===h.name.toLowerCase()};return n.codecs.forEach(function(r){for(var o=0;o<e.codecs.length;o++){var a=e.codecs[o];if(r.name.toLowerCase()===a.name.toLowerCase()&&r.clockRate===a.clockRate){if(r.name.toLowerCase()==="rtx"&&r.parameters&&a.parameters.apt&&!s(r,a,n.codecs,e.codecs))continue;a=JSON.parse(JSON.stringify(a)),a.numChannels=Math.min(r.numChannels,a.numChannels),t.codecs.push(a),a.rtcpFeedback=a.rtcpFeedback.filter(function(c){for(var l=0;l<r.rtcpFeedback.length;l++)if(r.rtcpFeedback[l].type===c.type&&r.rtcpFeedback[l].parameter===c.parameter)return!0;return!1});break}}}),n.headerExtensions.forEach(function(r){for(var o=0;o<e.headerExtensions.length;o++){var a=e.headerExtensions[o];if(r.uri===a.uri){t.headerExtensions.push(a);break}}}),t}function ZB(n,e,t){return{offer:{setLocalDescription:["stable","have-local-offer"],setRemoteDescription:["stable","have-remote-offer"]},answer:{setLocalDescription:["have-remote-offer","have-local-pranswer"],setRemoteDescription:["have-local-offer","have-remote-pranswer"]}}[e][n].indexOf(t)!==-1}function ES(n,e){var t=n.getRemoteCandidates().find(function(i){return e.foundation===i.foundation&&e.ip===i.ip&&e.port===i.port&&e.priority===i.priority&&e.protocol===i.protocol&&e.type===i.type});return t||n.addRemoteCandidate(e),!t}function Ls(n,e){var t=new Error(e);return t.name=n,t.code={NotSupportedError:9,InvalidStateError:11,InvalidAccessError:15,TypeError:void 0,OperationError:void 0}[n],t}var pX=function(n,e){function t(c,l){l.addTrack(c),l.dispatchEvent(new n.MediaStreamTrackEvent("addtrack",{track:c}))}function i(c,l){l.removeTrack(c),l.dispatchEvent(new n.MediaStreamTrackEvent("removetrack",{track:c}))}function s(c,l,h,d){var f=new Event("track");f.track=l,f.receiver=h,f.transceiver={receiver:h},f.streams=d,n.setTimeout(function(){c._dispatchEvent("track",f)})}var r=function(c){var l=this,h=document.createDocumentFragment();if(["addEventListener","removeEventListener","dispatchEvent"].forEach(function(f){l[f]=h[f].bind(h)}),this.canTrickleIceCandidates=null,this.needNegotiation=!1,this.localStreams=[],this.remoteStreams=[],this._localDescription=null,this._remoteDescription=null,this.signalingState="stable",this.iceConnectionState="new",this.connectionState="new",this.iceGatheringState="new",c=JSON.parse(JSON.stringify(c||{})),this.usingBundle=c.bundlePolicy==="max-bundle",c.rtcpMuxPolicy==="negotiate")throw Ls("NotSupportedError","rtcpMuxPolicy 'negotiate' is not supported");switch(c.rtcpMuxPolicy||(c.rtcpMuxPolicy="require"),c.iceTransportPolicy){case"all":case"relay":break;default:c.iceTransportPolicy="all";break}switch(c.bundlePolicy){case"balanced":case"max-compat":case"max-bundle":break;default:c.bundlePolicy="balanced";break}if(c.iceServers=fX(c.iceServers||[],e),this._iceGatherers=[],c.iceCandidatePoolSize)for(var d=c.iceCandidatePoolSize;d>0;d--)this._iceGatherers.push(new n.RTCIceGatherer({iceServers:c.iceServers,gatherPolicy:c.iceTransportPolicy}));else c.iceCandidatePoolSize=0;this._config=c,this.transceivers=[],this._sdpSessionId=Ct.generateSessionId(),this._sdpSessionVersion=0,this._dtlsRole=void 0,this._isClosed=!1};Object.defineProperty(r.prototype,"localDescription",{configurable:!0,get:function(){return this._localDescription}}),Object.defineProperty(r.prototype,"remoteDescription",{configurable:!0,get:function(){return this._remoteDescription}}),r.prototype.onicecandidate=null,r.prototype.onaddstream=null,r.prototype.ontrack=null,r.prototype.onremovestream=null,r.prototype.onsignalingstatechange=null,r.prototype.oniceconnectionstatechange=null,r.prototype.onconnectionstatechange=null,r.prototype.onicegatheringstatechange=null,r.prototype.onnegotiationneeded=null,r.prototype.ondatachannel=null,r.prototype._dispatchEvent=function(c,l){this._isClosed||(this.dispatchEvent(l),typeof this["on"+c]=="function"&&this["on"+c](l))},r.prototype._emitGatheringStateChange=function(){var c=new Event("icegatheringstatechange");this._dispatchEvent("icegatheringstatechange",c)},r.prototype.getConfiguration=function(){return this._config},r.prototype.getLocalStreams=function(){return this.localStreams},r.prototype.getRemoteStreams=function(){return this.remoteStreams},r.prototype._createTransceiver=function(c,l){var h=this.transceivers.length>0,d={track:null,iceGatherer:null,iceTransport:null,dtlsTransport:null,localCapabilities:null,remoteCapabilities:null,rtpSender:null,rtpReceiver:null,kind:c,mid:null,sendEncodingParameters:null,recvEncodingParameters:null,stream:null,associatedRemoteMediaStreams:[],wantReceive:!0};if(this.usingBundle&&h)d.iceTransport=this.transceivers[0].iceTransport,d.dtlsTransport=this.transceivers[0].dtlsTransport;else{var f=this._createIceAndDtlsTransports();d.iceTransport=f.iceTransport,d.dtlsTransport=f.dtlsTransport}return l||this.transceivers.push(d),d},r.prototype.addTrack=function(c,l){if(this._isClosed)throw Ls("InvalidStateError","Attempted to call addTrack on a closed peerconnection.");var h=this.transceivers.find(function(p){return p.track===c});if(h)throw Ls("InvalidAccessError","Track already exists.");for(var d,f=0;f<this.transceivers.length;f++)!this.transceivers[f].track&&this.transceivers[f].kind===c.kind&&(d=this.transceivers[f]);return d||(d=this._createTransceiver(c.kind)),this._maybeFireNegotiationNeeded(),this.localStreams.indexOf(l)===-1&&this.localStreams.push(l),d.track=c,d.stream=l,d.rtpSender=new n.RTCRtpSender(c,d.dtlsTransport),d.rtpSender},r.prototype.addStream=function(c){var l=this;if(e>=15025)c.getTracks().forEach(function(d){l.addTrack(d,c)});else{var h=c.clone();c.getTracks().forEach(function(d,f){var p=h.getTracks()[f];d.addEventListener("enabled",function(m){p.enabled=m.enabled})}),h.getTracks().forEach(function(d){l.addTrack(d,h)})}},r.prototype.removeTrack=function(c){if(this._isClosed)throw Ls("InvalidStateError","Attempted to call removeTrack on a closed peerconnection.");if(!(c instanceof n.RTCRtpSender))throw new TypeError("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.");var l=this.transceivers.find(function(f){return f.rtpSender===c});if(!l)throw Ls("InvalidAccessError","Sender was not created by this connection.");var h=l.stream;l.rtpSender.stop(),l.rtpSender=null,l.track=null,l.stream=null;var d=this.transceivers.map(function(f){return f.stream});d.indexOf(h)===-1&&this.localStreams.indexOf(h)>-1&&this.localStreams.splice(this.localStreams.indexOf(h),1),this._maybeFireNegotiationNeeded()},r.prototype.removeStream=function(c){var l=this;c.getTracks().forEach(function(h){var d=l.getSenders().find(function(f){return f.track===h});d&&l.removeTrack(d)})},r.prototype.getSenders=function(){return this.transceivers.filter(function(c){return!!c.rtpSender}).map(function(c){return c.rtpSender})},r.prototype.getReceivers=function(){return this.transceivers.filter(function(c){return!!c.rtpReceiver}).map(function(c){return c.rtpReceiver})},r.prototype._createIceGatherer=function(c,l){var h=this;if(l&&c>0)return this.transceivers[0].iceGatherer;if(this._iceGatherers.length)return this._iceGatherers.shift();var d=new n.RTCIceGatherer({iceServers:this._config.iceServers,gatherPolicy:this._config.iceTransportPolicy});return Object.defineProperty(d,"state",{value:"new",writable:!0}),this.transceivers[c].bufferedCandidateEvents=[],this.transceivers[c].bufferCandidates=function(f){var p=!f.candidate||Object.keys(f.candidate).length===0;d.state=p?"completed":"gathering",h.transceivers[c].bufferedCandidateEvents!==null&&h.transceivers[c].bufferedCandidateEvents.push(f)},d.addEventListener("localcandidate",this.transceivers[c].bufferCandidates),d},r.prototype._gather=function(c,l){var h=this,d=this.transceivers[l].iceGatherer;if(!d.onlocalcandidate){var f=this.transceivers[l].bufferedCandidateEvents;this.transceivers[l].bufferedCandidateEvents=null,d.removeEventListener("localcandidate",this.transceivers[l].bufferCandidates),d.onlocalcandidate=function(p){if(!(h.usingBundle&&l>0)){var m=new Event("icecandidate");m.candidate={sdpMid:c,sdpMLineIndex:l};var g=p.candidate,y=!g||Object.keys(g).length===0;if(y)(d.state==="new"||d.state==="gathering")&&(d.state="completed");else{d.state==="new"&&(d.state="gathering"),g.component=1,g.ufrag=d.getLocalParameters().usernameFragment;var A=Ct.writeCandidate(g);m.candidate=Object.assign(m.candidate,Ct.parseCandidate(A)),m.candidate.candidate=A,m.candidate.toJSON=function(){return{candidate:m.candidate.candidate,sdpMid:m.candidate.sdpMid,sdpMLineIndex:m.candidate.sdpMLineIndex,usernameFragment:m.candidate.usernameFragment}}}var v=Ct.getMediaSections(h._localDescription.sdp);y?v[m.candidate.sdpMLineIndex]+=`a=end-of-candidates\r
`:v[m.candidate.sdpMLineIndex]+="a="+m.candidate.candidate+`\r
`,h._localDescription.sdp=Ct.getDescription(h._localDescription.sdp)+v.join("");var b=h.transceivers.every(function(_){return _.iceGatherer&&_.iceGatherer.state==="completed"});h.iceGatheringState!=="gathering"&&(h.iceGatheringState="gathering",h._emitGatheringStateChange()),y||h._dispatchEvent("icecandidate",m),b&&(h._dispatchEvent("icecandidate",new Event("icecandidate")),h.iceGatheringState="complete",h._emitGatheringStateChange())}},n.setTimeout(function(){f.forEach(function(p){d.onlocalcandidate(p)})},0)}},r.prototype._createIceAndDtlsTransports=function(){var c=this,l=new n.RTCIceTransport(null);l.onicestatechange=function(){c._updateIceConnectionState(),c._updateConnectionState()};var h=new n.RTCDtlsTransport(l);return h.ondtlsstatechange=function(){c._updateConnectionState()},h.onerror=function(){Object.defineProperty(h,"state",{value:"failed",writable:!0}),c._updateConnectionState()},{iceTransport:l,dtlsTransport:h}},r.prototype._disposeIceAndDtlsTransports=function(c){var l=this.transceivers[c].iceGatherer;l&&(delete l.onlocalcandidate,delete this.transceivers[c].iceGatherer);var h=this.transceivers[c].iceTransport;h&&(delete h.onicestatechange,delete this.transceivers[c].iceTransport);var d=this.transceivers[c].dtlsTransport;d&&(delete d.ondtlsstatechange,delete d.onerror,delete this.transceivers[c].dtlsTransport)},r.prototype._transceive=function(c,l,h){var d=Ly(c.localCapabilities,c.remoteCapabilities);l&&c.rtpSender&&(d.encodings=c.sendEncodingParameters,d.rtcp={cname:Ct.localCName,compound:c.rtcpParameters.compound},c.recvEncodingParameters.length&&(d.rtcp.ssrc=c.recvEncodingParameters[0].ssrc),c.rtpSender.send(d)),h&&c.rtpReceiver&&d.codecs.length>0&&(c.kind==="video"&&c.recvEncodingParameters&&e<15019&&c.recvEncodingParameters.forEach(function(f){delete f.rtx}),c.recvEncodingParameters.length?d.encodings=c.recvEncodingParameters:d.encodings=[{}],d.rtcp={compound:c.rtcpParameters.compound},c.rtcpParameters.cname&&(d.rtcp.cname=c.rtcpParameters.cname),c.sendEncodingParameters.length&&(d.rtcp.ssrc=c.sendEncodingParameters[0].ssrc),c.rtpReceiver.receive(d))},r.prototype.setLocalDescription=function(c){var l=this;if(["offer","answer"].indexOf(c.type)===-1)return Promise.reject(Ls("TypeError",'Unsupported type "'+c.type+'"'));if(!ZB("setLocalDescription",c.type,l.signalingState)||l._isClosed)return Promise.reject(Ls("InvalidStateError","Can not set local "+c.type+" in state "+l.signalingState));var h,d;if(c.type==="offer")h=Ct.splitSections(c.sdp),d=h.shift(),h.forEach(function(p,m){var g=Ct.parseRtpParameters(p);l.transceivers[m].localCapabilities=g}),l.transceivers.forEach(function(p,m){l._gather(p.mid,m)});else if(c.type==="answer"){h=Ct.splitSections(l._remoteDescription.sdp),d=h.shift();var f=Ct.matchPrefix(d,"a=ice-lite").length>0;h.forEach(function(p,m){var g=l.transceivers[m],y=g.iceGatherer,A=g.iceTransport,v=g.dtlsTransport,b=g.localCapabilities,_=g.remoteCapabilities,T=Ct.isRejected(p)&&Ct.matchPrefix(p,"a=bundle-only").length===0;if(!T&&!g.rejected){var E=Ct.getIceParameters(p,d),M=Ct.getDtlsParameters(p,d);f&&(M.role="server"),(!l.usingBundle||m===0)&&(l._gather(g.mid,m),A.state==="new"&&A.start(y,E,f?"controlling":"controlled"),v.state==="new"&&v.start(M));var I=Ly(b,_);l._transceive(g,I.codecs.length>0,!1)}})}return l._localDescription={type:c.type,sdp:c.sdp},c.type==="offer"?l._updateSignalingState("have-local-offer"):l._updateSignalingState("stable"),Promise.resolve()},r.prototype.setRemoteDescription=function(c){var l=this;if(["offer","answer"].indexOf(c.type)===-1)return Promise.reject(Ls("TypeError",'Unsupported type "'+c.type+'"'));if(!ZB("setRemoteDescription",c.type,l.signalingState)||l._isClosed)return Promise.reject(Ls("InvalidStateError","Can not set remote "+c.type+" in state "+l.signalingState));var h={};l.remoteStreams.forEach(function(A){h[A.id]=A});var d=[],f=Ct.splitSections(c.sdp),p=f.shift(),m=Ct.matchPrefix(p,"a=ice-lite").length>0,g=Ct.matchPrefix(p,"a=group:BUNDLE ").length>0;l.usingBundle=g;var y=Ct.matchPrefix(p,"a=ice-options:")[0];return y?l.canTrickleIceCandidates=y.substr(14).split(" ").indexOf("trickle")>=0:l.canTrickleIceCandidates=!1,f.forEach(function(A,v){var b=Ct.splitLines(A),_=Ct.getKind(A),T=Ct.isRejected(A)&&Ct.matchPrefix(A,"a=bundle-only").length===0,E=b[0].substr(2).split(" ")[2],M=Ct.getDirection(A,p),I=Ct.parseMsid(A),S=Ct.getMid(A)||Ct.generateIdentifier();if(T||_==="application"&&(E==="DTLS/SCTP"||E==="UDP/DTLS/SCTP")){l.transceivers[v]={mid:S,kind:_,protocol:E,rejected:!0};return}!T&&l.transceivers[v]&&l.transceivers[v].rejected&&(l.transceivers[v]=l._createTransceiver(_,!0));var C,D,G,Q,L,V,O,U,H,Y=Ct.parseRtpParameters(A),J,se;T||(J=Ct.getIceParameters(A,p),se=Ct.getDtlsParameters(A,p),se.role="client"),O=Ct.parseRtpEncodingParameters(A);var fe=Ct.parseRtcpParameters(A),_e=Ct.matchPrefix(A,"a=end-of-candidates",p).length>0,Oe=Ct.matchPrefix(A,"a=candidate:").map(function(Ge){return Ct.parseCandidate(Ge)}).filter(function(Ge){return Ge.component===1});if((c.type==="offer"||c.type==="answer")&&!T&&g&&v>0&&l.transceivers[v]&&(l._disposeIceAndDtlsTransports(v),l.transceivers[v].iceGatherer=l.transceivers[0].iceGatherer,l.transceivers[v].iceTransport=l.transceivers[0].iceTransport,l.transceivers[v].dtlsTransport=l.transceivers[0].dtlsTransport,l.transceivers[v].rtpSender&&l.transceivers[v].rtpSender.setTransport(l.transceivers[0].dtlsTransport),l.transceivers[v].rtpReceiver&&l.transceivers[v].rtpReceiver.setTransport(l.transceivers[0].dtlsTransport)),c.type==="offer"&&!T){C=l.transceivers[v]||l._createTransceiver(_),C.mid=S,C.iceGatherer||(C.iceGatherer=l._createIceGatherer(v,g)),Oe.length&&C.iceTransport.state==="new"&&(_e&&(!g||v===0)?C.iceTransport.setRemoteCandidates(Oe):Oe.forEach(function(Ge){ES(C.iceTransport,Ge)})),U=n.RTCRtpReceiver.getCapabilities(_),e<15019&&(U.codecs=U.codecs.filter(function(Ge){return Ge.name!=="rtx"})),V=C.sendEncodingParameters||[{ssrc:(2*v+2)*1001}];var qe=!1;if(M==="sendrecv"||M==="sendonly"){if(qe=!C.rtpReceiver,L=C.rtpReceiver||new n.RTCRtpReceiver(C.dtlsTransport,_),qe){var ae;H=L.track,I&&I.stream==="-"||(I?(h[I.stream]||(h[I.stream]=new n.MediaStream,Object.defineProperty(h[I.stream],"id",{get:function(){return I.stream}})),Object.defineProperty(H,"id",{get:function(){return I.track}}),ae=h[I.stream]):(h.default||(h.default=new n.MediaStream),ae=h.default)),ae&&(t(H,ae),C.associatedRemoteMediaStreams.push(ae)),d.push([H,L,ae])}}else C.rtpReceiver&&C.rtpReceiver.track&&(C.associatedRemoteMediaStreams.forEach(function(Ge){var Xe=Ge.getTracks().find(function(ze){return ze.id===C.rtpReceiver.track.id});Xe&&i(Xe,Ge)}),C.associatedRemoteMediaStreams=[]);C.localCapabilities=U,C.remoteCapabilities=Y,C.rtpReceiver=L,C.rtcpParameters=fe,C.sendEncodingParameters=V,C.recvEncodingParameters=O,l._transceive(l.transceivers[v],!1,qe)}else if(c.type==="answer"&&!T){C=l.transceivers[v],D=C.iceGatherer,G=C.iceTransport,Q=C.dtlsTransport,L=C.rtpReceiver,V=C.sendEncodingParameters,U=C.localCapabilities,l.transceivers[v].recvEncodingParameters=O,l.transceivers[v].remoteCapabilities=Y,l.transceivers[v].rtcpParameters=fe,Oe.length&&G.state==="new"&&((m||_e)&&(!g||v===0)?G.setRemoteCandidates(Oe):Oe.forEach(function(Ge){ES(C.iceTransport,Ge)})),(!g||v===0)&&(G.state==="new"&&G.start(D,J,"controlling"),Q.state==="new"&&Q.start(se));var ve=Ly(C.localCapabilities,C.remoteCapabilities),Ue=ve.codecs.filter(function(Ge){return Ge.name.toLowerCase()==="rtx"}).length;!Ue&&C.sendEncodingParameters[0].rtx&&delete C.sendEncodingParameters[0].rtx,l._transceive(C,M==="sendrecv"||M==="recvonly",M==="sendrecv"||M==="sendonly"),L&&(M==="sendrecv"||M==="sendonly")?(H=L.track,I?(h[I.stream]||(h[I.stream]=new n.MediaStream),t(H,h[I.stream]),d.push([H,L,h[I.stream]])):(h.default||(h.default=new n.MediaStream),t(H,h.default),d.push([H,L,h.default]))):delete C.rtpReceiver}}),l._dtlsRole===void 0&&(l._dtlsRole=c.type==="offer"?"active":"passive"),l._remoteDescription={type:c.type,sdp:c.sdp},c.type==="offer"?l._updateSignalingState("have-remote-offer"):l._updateSignalingState("stable"),Object.keys(h).forEach(function(A){var v=h[A];if(v.getTracks().length){if(l.remoteStreams.indexOf(v)===-1){l.remoteStreams.push(v);var b=new Event("addstream");b.stream=v,n.setTimeout(function(){l._dispatchEvent("addstream",b)})}d.forEach(function(_){var T=_[0],E=_[1];v.id===_[2].id&&s(l,T,E,[v])})}}),d.forEach(function(A){A[2]||s(l,A[0],A[1],[])}),n.setTimeout(function(){l&&l.transceivers&&l.transceivers.forEach(function(A){A.iceTransport&&A.iceTransport.state==="new"&&A.iceTransport.getRemoteCandidates().length>0&&(console.warn("Timeout for addRemoteCandidate. Consider sending an end-of-candidates notification"),A.iceTransport.addRemoteCandidate({}))})},4e3),Promise.resolve()},r.prototype.close=function(){this.transceivers.forEach(function(c){c.iceTransport&&c.iceTransport.stop(),c.dtlsTransport&&c.dtlsTransport.stop(),c.rtpSender&&c.rtpSender.stop(),c.rtpReceiver&&c.rtpReceiver.stop()}),this._isClosed=!0,this._updateSignalingState("closed")},r.prototype._updateSignalingState=function(c){this.signalingState=c;var l=new Event("signalingstatechange");this._dispatchEvent("signalingstatechange",l)},r.prototype._maybeFireNegotiationNeeded=function(){var c=this;this.signalingState!=="stable"||this.needNegotiation===!0||(this.needNegotiation=!0,n.setTimeout(function(){if(c.needNegotiation){c.needNegotiation=!1;var l=new Event("negotiationneeded");c._dispatchEvent("negotiationneeded",l)}},0))},r.prototype._updateIceConnectionState=function(){var c,l={new:0,closed:0,checking:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach(function(d){d.iceTransport&&!d.rejected&&l[d.iceTransport.state]++}),c="new",l.failed>0?c="failed":l.checking>0?c="checking":l.disconnected>0?c="disconnected":l.new>0?c="new":l.connected>0?c="connected":l.completed>0&&(c="completed"),c!==this.iceConnectionState){this.iceConnectionState=c;var h=new Event("iceconnectionstatechange");this._dispatchEvent("iceconnectionstatechange",h)}},r.prototype._updateConnectionState=function(){var c,l={new:0,closed:0,connecting:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach(function(d){d.iceTransport&&d.dtlsTransport&&!d.rejected&&(l[d.iceTransport.state]++,l[d.dtlsTransport.state]++)}),l.connected+=l.completed,c="new",l.failed>0?c="failed":l.connecting>0?c="connecting":l.disconnected>0?c="disconnected":l.new>0?c="new":l.connected>0&&(c="connected"),c!==this.connectionState){this.connectionState=c;var h=new Event("connectionstatechange");this._dispatchEvent("connectionstatechange",h)}},r.prototype.createOffer=function(){var c=this;if(c._isClosed)return Promise.reject(Ls("InvalidStateError","Can not call createOffer after close"));var l=c.transceivers.filter(function(m){return m.kind==="audio"}).length,h=c.transceivers.filter(function(m){return m.kind==="video"}).length,d=arguments[0];if(d){if(d.mandatory||d.optional)throw new TypeError("Legacy mandatory/optional constraints not supported.");d.offerToReceiveAudio!==void 0&&(d.offerToReceiveAudio===!0?l=1:d.offerToReceiveAudio===!1?l=0:l=d.offerToReceiveAudio),d.offerToReceiveVideo!==void 0&&(d.offerToReceiveVideo===!0?h=1:d.offerToReceiveVideo===!1?h=0:h=d.offerToReceiveVideo)}for(c.transceivers.forEach(function(m){m.kind==="audio"?(l--,l<0&&(m.wantReceive=!1)):m.kind==="video"&&(h--,h<0&&(m.wantReceive=!1))});l>0||h>0;)l>0&&(c._createTransceiver("audio"),l--),h>0&&(c._createTransceiver("video"),h--);var f=Ct.writeSessionBoilerplate(c._sdpSessionId,c._sdpSessionVersion++);c.transceivers.forEach(function(m,g){var y=m.track,A=m.kind,v=m.mid||Ct.generateIdentifier();m.mid=v,m.iceGatherer||(m.iceGatherer=c._createIceGatherer(g,c.usingBundle));var b=n.RTCRtpSender.getCapabilities(A);e<15019&&(b.codecs=b.codecs.filter(function(T){return T.name!=="rtx"})),b.codecs.forEach(function(T){T.name==="H264"&&T.parameters["level-asymmetry-allowed"]===void 0&&(T.parameters["level-asymmetry-allowed"]="1"),m.remoteCapabilities&&m.remoteCapabilities.codecs&&m.remoteCapabilities.codecs.forEach(function(E){T.name.toLowerCase()===E.name.toLowerCase()&&T.clockRate===E.clockRate&&(T.preferredPayloadType=E.payloadType)})}),b.headerExtensions.forEach(function(T){var E=m.remoteCapabilities&&m.remoteCapabilities.headerExtensions||[];E.forEach(function(M){T.uri===M.uri&&(T.id=M.id)})});var _=m.sendEncodingParameters||[{ssrc:(2*g+1)*1001}];y&&e>=15019&&A==="video"&&!_[0].rtx&&(_[0].rtx={ssrc:_[0].ssrc+1}),m.wantReceive&&(m.rtpReceiver=new n.RTCRtpReceiver(m.dtlsTransport,A)),m.localCapabilities=b,m.sendEncodingParameters=_}),c._config.bundlePolicy!=="max-compat"&&(f+="a=group:BUNDLE "+c.transceivers.map(function(m){return m.mid}).join(" ")+`\r
`),f+=`a=ice-options:trickle\r
`,c.transceivers.forEach(function(m,g){f+=KB(m,m.localCapabilities,"offer",m.stream,c._dtlsRole),f+=`a=rtcp-rsize\r
`,m.iceGatherer&&c.iceGatheringState!=="new"&&(g===0||!c.usingBundle)&&(m.iceGatherer.getLocalCandidates().forEach(function(y){y.component=1,f+="a="+Ct.writeCandidate(y)+`\r
`}),m.iceGatherer.state==="completed"&&(f+=`a=end-of-candidates\r
`))});var p=new n.RTCSessionDescription({type:"offer",sdp:f});return Promise.resolve(p)},r.prototype.createAnswer=function(){var c=this;if(c._isClosed)return Promise.reject(Ls("InvalidStateError","Can not call createAnswer after close"));if(!(c.signalingState==="have-remote-offer"||c.signalingState==="have-local-pranswer"))return Promise.reject(Ls("InvalidStateError","Can not call createAnswer in signalingState "+c.signalingState));var l=Ct.writeSessionBoilerplate(c._sdpSessionId,c._sdpSessionVersion++);c.usingBundle&&(l+="a=group:BUNDLE "+c.transceivers.map(function(f){return f.mid}).join(" ")+`\r
`),l+=`a=ice-options:trickle\r
`;var h=Ct.getMediaSections(c._remoteDescription.sdp).length;c.transceivers.forEach(function(f,p){if(!(p+1>h)){if(f.rejected){f.kind==="application"?f.protocol==="DTLS/SCTP"?l+=`m=application 0 DTLS/SCTP 5000\r
`:l+="m=application 0 "+f.protocol+` webrtc-datachannel\r
`:f.kind==="audio"?l+=`m=audio 0 UDP/TLS/RTP/SAVPF 0\r
a=rtpmap:0 PCMU/8000\r
`:f.kind==="video"&&(l+=`m=video 0 UDP/TLS/RTP/SAVPF 120\r
a=rtpmap:120 VP8/90000\r
`),l+=`c=IN IP4 0.0.0.0\r
a=inactive\r
a=mid:`+f.mid+`\r
`;return}if(f.stream){var m;f.kind==="audio"?m=f.stream.getAudioTracks()[0]:f.kind==="video"&&(m=f.stream.getVideoTracks()[0]),m&&e>=15019&&f.kind==="video"&&!f.sendEncodingParameters[0].rtx&&(f.sendEncodingParameters[0].rtx={ssrc:f.sendEncodingParameters[0].ssrc+1})}var g=Ly(f.localCapabilities,f.remoteCapabilities),y=g.codecs.filter(function(A){return A.name.toLowerCase()==="rtx"}).length;!y&&f.sendEncodingParameters[0].rtx&&delete f.sendEncodingParameters[0].rtx,l+=KB(f,g,"answer",f.stream,c._dtlsRole),f.rtcpParameters&&f.rtcpParameters.reducedSize&&(l+=`a=rtcp-rsize\r
`)}});var d=new n.RTCSessionDescription({type:"answer",sdp:l});return Promise.resolve(d)},r.prototype.addIceCandidate=function(c){var l=this,h;return c&&!(c.sdpMLineIndex!==void 0||c.sdpMid)?Promise.reject(new TypeError("sdpMLineIndex or sdpMid required")):new Promise(function(d,f){if(l._remoteDescription)if(!c||c.candidate==="")for(var p=0;p<l.transceivers.length&&!(!l.transceivers[p].rejected&&(l.transceivers[p].iceTransport.addRemoteCandidate({}),h=Ct.getMediaSections(l._remoteDescription.sdp),h[p]+=`a=end-of-candidates\r
`,l._remoteDescription.sdp=Ct.getDescription(l._remoteDescription.sdp)+h.join(""),l.usingBundle));p++);else{var m=c.sdpMLineIndex;if(c.sdpMid){for(var g=0;g<l.transceivers.length;g++)if(l.transceivers[g].mid===c.sdpMid){m=g;break}}var y=l.transceivers[m];if(y){if(y.rejected)return d();var A=Object.keys(c.candidate).length>0?Ct.parseCandidate(c.candidate):{};if(A.protocol==="tcp"&&(A.port===0||A.port===9)||A.component&&A.component!==1)return d();if((m===0||m>0&&y.iceTransport!==l.transceivers[0].iceTransport)&&!ES(y.iceTransport,A))return f(Ls("OperationError","Can not add ICE candidate"));var v=c.candidate.trim();v.indexOf("a=")===0&&(v=v.substr(2)),h=Ct.getMediaSections(l._remoteDescription.sdp),h[m]+="a="+(A.type?v:"end-of-candidates")+`\r
`,l._remoteDescription.sdp=Ct.getDescription(l._remoteDescription.sdp)+h.join("")}else return f(Ls("OperationError","Can not add ICE candidate"))}else return f(Ls("InvalidStateError","Can not add ICE candidate without a remote description"));d()})},r.prototype.getStats=function(c){if(c&&c instanceof n.MediaStreamTrack){var l=null;if(this.transceivers.forEach(function(d){d.rtpSender&&d.rtpSender.track===c?l=d.rtpSender:d.rtpReceiver&&d.rtpReceiver.track===c&&(l=d.rtpReceiver)}),!l)throw Ls("InvalidAccessError","Invalid selector.");return l.getStats()}var h=[];return this.transceivers.forEach(function(d){["rtpSender","rtpReceiver","iceGatherer","iceTransport","dtlsTransport"].forEach(function(f){d[f]&&h.push(d[f].getStats())})}),Promise.all(h).then(function(d){var f=new Map;return d.forEach(function(p){p.forEach(function(m){f.set(m.id,m)})}),f})};var o=["RTCRtpSender","RTCRtpReceiver","RTCIceGatherer","RTCIceTransport","RTCDtlsTransport"];o.forEach(function(c){var l=n[c];if(l&&l.prototype&&l.prototype.getStats){var h=l.prototype.getStats;l.prototype.getStats=function(){return h.apply(this).then(function(d){var f=new Map;return Object.keys(d).forEach(function(p){d[p].type=dX(d[p]),f.set(p,d[p])}),f})}}});var a=["createOffer","createAnswer"];return a.forEach(function(c){var l=r.prototype[c];r.prototype[c]=function(){var h=arguments;return typeof h[0]=="function"||typeof h[1]=="function"?l.apply(this,[arguments[2]]).then(function(d){typeof h[0]=="function"&&h[0].apply(null,[d])},function(d){typeof h[1]=="function"&&h[1].apply(null,[d])}):l.apply(this,arguments)}}),a=["setLocalDescription","setRemoteDescription","addIceCandidate"],a.forEach(function(c){var l=r.prototype[c];r.prototype[c]=function(){var h=arguments;return typeof h[1]=="function"||typeof h[2]=="function"?l.apply(this,arguments).then(function(){typeof h[1]=="function"&&h[1].apply(null)},function(d){typeof h[2]=="function"&&h[2].apply(null,[d])}):l.apply(this,arguments)}}),["getStats"].forEach(function(c){var l=r.prototype[c];r.prototype[c]=function(){var h=arguments;return typeof h[1]=="function"?l.apply(this,arguments).then(function(){typeof h[1]=="function"&&h[1].apply(null)}):l.apply(this,arguments)}}),r};const mX=cx(pX);function CU(n){const e=n&&n.navigator,t=function(s){return{name:{PermissionDeniedError:"NotAllowedError"}[s.name]||s.name,message:s.message,constraint:s.constraint,toString(){return this.name}}},i=e.mediaDevices.getUserMedia.bind(e.mediaDevices);e.mediaDevices.getUserMedia=function(s){return i(s).catch(r=>Promise.reject(t(r)))}}function EU(n){"getDisplayMedia"in n.navigator&&n.navigator.mediaDevices&&(n.navigator.mediaDevices&&"getDisplayMedia"in n.navigator.mediaDevices||(n.navigator.mediaDevices.getDisplayMedia=n.navigator.getDisplayMedia.bind(n.navigator)))}function XE(n,e){if(n.RTCIceGatherer&&(n.RTCIceCandidate||(n.RTCIceCandidate=function(s){return s}),n.RTCSessionDescription||(n.RTCSessionDescription=function(s){return s}),e.version<15025)){const i=Object.getOwnPropertyDescriptor(n.MediaStreamTrack.prototype,"enabled");Object.defineProperty(n.MediaStreamTrack.prototype,"enabled",{set(s){i.set.call(this,s);const r=new Event("enabled");r.enabled=s,this.dispatchEvent(r)}})}n.RTCRtpSender&&!("dtmf"in n.RTCRtpSender.prototype)&&Object.defineProperty(n.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=new n.RTCDtmfSender(this):this.track.kind==="video"&&(this._dtmf=null)),this._dtmf}}),n.RTCDtmfSender&&!n.RTCDTMFSender&&(n.RTCDTMFSender=n.RTCDtmfSender);const t=mX(n,e.version);n.RTCPeerConnection=function(s){return s&&s.iceServers&&(s.iceServers=uX(s.iceServers,e.version),A1("ICE servers after filtering:",s.iceServers)),new t(s)},n.RTCPeerConnection.prototype=t.prototype}function TU(n){n.RTCRtpSender&&!("replaceTrack"in n.RTCRtpSender.prototype)&&(n.RTCRtpSender.prototype.replaceTrack=n.RTCRtpSender.prototype.setTrack)}const $B=Object.freeze(Object.defineProperty({__proto__:null,shimGetDisplayMedia:EU,shimGetUserMedia:CU,shimPeerConnection:XE,shimReplaceTrack:TU},Symbol.toStringTag,{value:"Module"}));function MU(n,e){const t=n&&n.navigator,i=n&&n.MediaStreamTrack;if(t.getUserMedia=function(s,r,o){dx("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),t.mediaDevices.getUserMedia(s).then(r,o)},!(e.version>55&&"autoGainControl"in t.mediaDevices.getSupportedConstraints())){const s=function(o,a,c){a in o&&!(c in o)&&(o[c]=o[a],delete o[a])},r=t.mediaDevices.getUserMedia.bind(t.mediaDevices);if(t.mediaDevices.getUserMedia=function(o){return typeof o=="object"&&typeof o.audio=="object"&&(o=JSON.parse(JSON.stringify(o)),s(o.audio,"autoGainControl","mozAutoGainControl"),s(o.audio,"noiseSuppression","mozNoiseSuppression")),r(o)},i&&i.prototype.getSettings){const o=i.prototype.getSettings;i.prototype.getSettings=function(){const a=o.apply(this,arguments);return s(a,"mozAutoGainControl","autoGainControl"),s(a,"mozNoiseSuppression","noiseSuppression"),a}}if(i&&i.prototype.applyConstraints){const o=i.prototype.applyConstraints;i.prototype.applyConstraints=function(a){return this.kind==="audio"&&typeof a=="object"&&(a=JSON.parse(JSON.stringify(a)),s(a,"autoGainControl","mozAutoGainControl"),s(a,"noiseSuppression","mozNoiseSuppression")),o.apply(this,[a])}}}}function gX(n,e){n.navigator.mediaDevices&&"getDisplayMedia"in n.navigator.mediaDevices||n.navigator.mediaDevices&&(n.navigator.mediaDevices.getDisplayMedia=function(i){if(!(i&&i.video)){const s=new DOMException("getDisplayMedia without video constraints is undefined");return s.name="NotFoundError",s.code=8,Promise.reject(s)}return i.video===!0?i.video={mediaSource:e}:i.video.mediaSource=e,n.navigator.mediaDevices.getUserMedia(i)})}function IU(n){typeof n=="object"&&n.RTCTrackEvent&&"receiver"in n.RTCTrackEvent.prototype&&!("transceiver"in n.RTCTrackEvent.prototype)&&Object.defineProperty(n.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function YE(n,e){if(typeof n!="object"||!(n.RTCPeerConnection||n.mozRTCPeerConnection))return;!n.RTCPeerConnection&&n.mozRTCPeerConnection&&(n.RTCPeerConnection=n.mozRTCPeerConnection),e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(s){const r=n.RTCPeerConnection.prototype[s],o={[s](){return arguments[0]=new(s==="addIceCandidate"?n.RTCIceCandidate:n.RTCSessionDescription)(arguments[0]),r.apply(this,arguments)}};n.RTCPeerConnection.prototype[s]=o[s]});const t={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},i=n.RTCPeerConnection.prototype.getStats;n.RTCPeerConnection.prototype.getStats=function(){const[r,o,a]=arguments;return i.apply(this,[r||null]).then(c=>{if(e.version<53&&!o)try{c.forEach(l=>{l.type=t[l.type]||l.type})}catch(l){if(l.name!=="TypeError")throw l;c.forEach((h,d)=>{c.set(d,Object.assign({},h,{type:t[h.type]||h.type}))})}return c}).then(o,a)}}function RU(n){if(!(typeof n=="object"&&n.RTCPeerConnection&&n.RTCRtpSender)||n.RTCRtpSender&&"getStats"in n.RTCRtpSender.prototype)return;const e=n.RTCPeerConnection.prototype.getSenders;e&&(n.RTCPeerConnection.prototype.getSenders=function(){const s=e.apply(this,[]);return s.forEach(r=>r._pc=this),s});const t=n.RTCPeerConnection.prototype.addTrack;t&&(n.RTCPeerConnection.prototype.addTrack=function(){const s=t.apply(this,arguments);return s._pc=this,s}),n.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function PU(n){if(!(typeof n=="object"&&n.RTCPeerConnection&&n.RTCRtpSender)||n.RTCRtpSender&&"getStats"in n.RTCRtpReceiver.prototype)return;const e=n.RTCPeerConnection.prototype.getReceivers;e&&(n.RTCPeerConnection.prototype.getReceivers=function(){const i=e.apply(this,[]);return i.forEach(s=>s._pc=this),i}),Fp(n,"track",t=>(t.receiver._pc=t.srcElement,t)),n.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function BU(n){!n.RTCPeerConnection||"removeStream"in n.RTCPeerConnection.prototype||(n.RTCPeerConnection.prototype.removeStream=function(t){dx("removeStream","removeTrack"),this.getSenders().forEach(i=>{i.track&&t.getTracks().includes(i.track)&&this.removeTrack(i)})})}function DU(n){n.DataChannel&&!n.RTCDataChannel&&(n.RTCDataChannel=n.DataChannel)}function OU(n){if(!(typeof n=="object"&&n.RTCPeerConnection))return;const e=n.RTCPeerConnection.prototype.addTransceiver;e&&(n.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];const i=arguments[1],s=i&&"sendEncodings"in i;s&&i.sendEncodings.forEach(o=>{if("rid"in o&&!/^[a-z0-9]{0,16}$/i.test(o.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in o&&!(parseFloat(o.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in o&&!(parseFloat(o.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const r=e.apply(this,arguments);if(s){const{sender:o}=r,a=o.getParameters();(!("encodings"in a)||a.encodings.length===1&&Object.keys(a.encodings[0]).length===0)&&(a.encodings=i.sendEncodings,o.sendEncodings=i.sendEncodings,this.setParametersPromises.push(o.setParameters(a).then(()=>{delete o.sendEncodings}).catch(()=>{delete o.sendEncodings})))}return r})}function kU(n){if(!(typeof n=="object"&&n.RTCRtpSender))return;const e=n.RTCRtpSender.prototype.getParameters;e&&(n.RTCRtpSender.prototype.getParameters=function(){const i=e.apply(this,arguments);return"encodings"in i||(i.encodings=[].concat(this.sendEncodings||[{}])),i})}function LU(n){if(!(typeof n=="object"&&n.RTCPeerConnection))return;const e=n.RTCPeerConnection.prototype.createOffer;n.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}function FU(n){if(!(typeof n=="object"&&n.RTCPeerConnection))return;const e=n.RTCPeerConnection.prototype.createAnswer;n.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}const eD=Object.freeze(Object.defineProperty({__proto__:null,shimAddTransceiver:OU,shimCreateAnswer:FU,shimCreateOffer:LU,shimGetDisplayMedia:gX,shimGetParameters:kU,shimGetUserMedia:MU,shimOnTrack:IU,shimPeerConnection:YE,shimRTCDataChannel:DU,shimReceiverGetStats:PU,shimRemoveStream:BU,shimSenderGetStats:RU},Symbol.toStringTag,{value:"Module"}));function UU(n){if(!(typeof n!="object"||!n.RTCPeerConnection)){if("getLocalStreams"in n.RTCPeerConnection.prototype||(n.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in n.RTCPeerConnection.prototype)){const e=n.RTCPeerConnection.prototype.addTrack;n.RTCPeerConnection.prototype.addStream=function(i){this._localStreams||(this._localStreams=[]),this._localStreams.includes(i)||this._localStreams.push(i),i.getAudioTracks().forEach(s=>e.call(this,s,i)),i.getVideoTracks().forEach(s=>e.call(this,s,i))},n.RTCPeerConnection.prototype.addTrack=function(i,...s){return s&&s.forEach(r=>{this._localStreams?this._localStreams.includes(r)||this._localStreams.push(r):this._localStreams=[r]}),e.apply(this,arguments)}}"removeStream"in n.RTCPeerConnection.prototype||(n.RTCPeerConnection.prototype.removeStream=function(t){this._localStreams||(this._localStreams=[]);const i=this._localStreams.indexOf(t);if(i===-1)return;this._localStreams.splice(i,1);const s=t.getTracks();this.getSenders().forEach(r=>{s.includes(r.track)&&this.removeTrack(r)})})}}function NU(n){if(!(typeof n!="object"||!n.RTCPeerConnection)&&("getRemoteStreams"in n.RTCPeerConnection.prototype||(n.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in n.RTCPeerConnection.prototype))){Object.defineProperty(n.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(t){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=t),this.addEventListener("track",this._onaddstreampoly=i=>{i.streams.forEach(s=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(s))return;this._remoteStreams.push(s);const r=new Event("addstream");r.stream=s,this.dispatchEvent(r)})})}});const e=n.RTCPeerConnection.prototype.setRemoteDescription;n.RTCPeerConnection.prototype.setRemoteDescription=function(){const i=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(s){s.streams.forEach(r=>{if(i._remoteStreams||(i._remoteStreams=[]),i._remoteStreams.indexOf(r)>=0)return;i._remoteStreams.push(r);const o=new Event("addstream");o.stream=r,i.dispatchEvent(o)})}),e.apply(i,arguments)}}}function zU(n){if(typeof n!="object"||!n.RTCPeerConnection)return;const e=n.RTCPeerConnection.prototype,t=e.createOffer,i=e.createAnswer,s=e.setLocalDescription,r=e.setRemoteDescription,o=e.addIceCandidate;e.createOffer=function(l,h){const d=arguments.length>=2?arguments[2]:arguments[0],f=t.apply(this,[d]);return h?(f.then(l,h),Promise.resolve()):f},e.createAnswer=function(l,h){const d=arguments.length>=2?arguments[2]:arguments[0],f=i.apply(this,[d]);return h?(f.then(l,h),Promise.resolve()):f};let a=function(c,l,h){const d=s.apply(this,[c]);return h?(d.then(l,h),Promise.resolve()):d};e.setLocalDescription=a,a=function(c,l,h){const d=r.apply(this,[c]);return h?(d.then(l,h),Promise.resolve()):d},e.setRemoteDescription=a,a=function(c,l,h){const d=o.apply(this,[c]);return h?(d.then(l,h),Promise.resolve()):d},e.addIceCandidate=a}function GU(n){const e=n&&n.navigator;if(e.mediaDevices&&e.mediaDevices.getUserMedia){const t=e.mediaDevices,i=t.getUserMedia.bind(t);e.mediaDevices.getUserMedia=s=>i(VU(s))}!e.getUserMedia&&e.mediaDevices&&e.mediaDevices.getUserMedia&&(e.getUserMedia=function(i,s,r){e.mediaDevices.getUserMedia(i).then(s,r)}.bind(e))}function VU(n){return n&&n.video!==void 0?Object.assign({},n,{video:fU(n.video)}):n}function HU(n){if(!n.RTCPeerConnection)return;const e=n.RTCPeerConnection;n.RTCPeerConnection=function(i,s){if(i&&i.iceServers){const r=[];for(let o=0;o<i.iceServers.length;o++){let a=i.iceServers[o];!a.hasOwnProperty("urls")&&a.hasOwnProperty("url")?(dx("RTCIceServer.url","RTCIceServer.urls"),a=JSON.parse(JSON.stringify(a)),a.urls=a.url,delete a.url,r.push(a)):r.push(i.iceServers[o])}i.iceServers=r}return new e(i,s)},n.RTCPeerConnection.prototype=e.prototype,"generateCertificate"in e&&Object.defineProperty(n.RTCPeerConnection,"generateCertificate",{get(){return e.generateCertificate}})}function QU(n){typeof n=="object"&&n.RTCTrackEvent&&"receiver"in n.RTCTrackEvent.prototype&&!("transceiver"in n.RTCTrackEvent.prototype)&&Object.defineProperty(n.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function jU(n){const e=n.RTCPeerConnection.prototype.createOffer;n.RTCPeerConnection.prototype.createOffer=function(i){if(i){typeof i.offerToReceiveAudio<"u"&&(i.offerToReceiveAudio=!!i.offerToReceiveAudio);const s=this.getTransceivers().find(o=>o.receiver.track.kind==="audio");i.offerToReceiveAudio===!1&&s?s.direction==="sendrecv"?s.setDirection?s.setDirection("sendonly"):s.direction="sendonly":s.direction==="recvonly"&&(s.setDirection?s.setDirection("inactive"):s.direction="inactive"):i.offerToReceiveAudio===!0&&!s&&this.addTransceiver("audio"),typeof i.offerToReceiveVideo<"u"&&(i.offerToReceiveVideo=!!i.offerToReceiveVideo);const r=this.getTransceivers().find(o=>o.receiver.track.kind==="video");i.offerToReceiveVideo===!1&&r?r.direction==="sendrecv"?r.setDirection?r.setDirection("sendonly"):r.direction="sendonly":r.direction==="recvonly"&&(r.setDirection?r.setDirection("inactive"):r.direction="inactive"):i.offerToReceiveVideo===!0&&!r&&this.addTransceiver("video")}return e.apply(this,arguments)}}function WU(n){typeof n!="object"||n.AudioContext||(n.AudioContext=n.webkitAudioContext)}const tD=Object.freeze(Object.defineProperty({__proto__:null,shimAudioContext:WU,shimCallbacksAPI:zU,shimConstraints:VU,shimCreateOfferLegacy:jU,shimGetUserMedia:GU,shimLocalStreamsAPI:UU,shimRTCIceServerUrls:HU,shimRemoteStreamsAPI:NU,shimTrackEventTransceiver:QU},Symbol.toStringTag,{value:"Module"}));function R0(n){if(!n.RTCIceCandidate||n.RTCIceCandidate&&"foundation"in n.RTCIceCandidate.prototype)return;const e=n.RTCIceCandidate;n.RTCIceCandidate=function(i){if(typeof i=="object"&&i.candidate&&i.candidate.indexOf("a=")===0&&(i=JSON.parse(JSON.stringify(i)),i.candidate=i.candidate.substr(2)),i.candidate&&i.candidate.length){const s=new e(i),r=I0.parseCandidate(i.candidate),o=Object.assign(s,r);return o.toJSON=function(){return{candidate:o.candidate,sdpMid:o.sdpMid,sdpMLineIndex:o.sdpMLineIndex,usernameFragment:o.usernameFragment}},o}return new e(i)},n.RTCIceCandidate.prototype=e.prototype,Fp(n,"icecandidate",t=>(t.candidate&&Object.defineProperty(t,"candidate",{value:new n.RTCIceCandidate(t.candidate),writable:"false"}),t))}function Xm(n,e){if(!n.RTCPeerConnection)return;"sctp"in n.RTCPeerConnection.prototype||Object.defineProperty(n.RTCPeerConnection.prototype,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp}});const t=function(a){if(!a||!a.sdp)return!1;const c=I0.splitSections(a.sdp);return c.shift(),c.some(l=>{const h=I0.parseMLine(l);return h&&h.kind==="application"&&h.protocol.indexOf("SCTP")!==-1})},i=function(a){const c=a.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(c===null||c.length<2)return-1;const l=parseInt(c[1],10);return l!==l?-1:l},s=function(a){let c=65536;return e.browser==="firefox"&&(e.version<57?a===-1?c=16384:c=2147483637:e.version<60?c=e.version===57?65535:65536:c=2147483637),c},r=function(a,c){let l=65536;e.browser==="firefox"&&e.version===57&&(l=65535);const h=I0.matchPrefix(a.sdp,"a=max-message-size:");return h.length>0?l=parseInt(h[0].substr(19),10):e.browser==="firefox"&&c!==-1&&(l=2147483637),l},o=n.RTCPeerConnection.prototype.setRemoteDescription;n.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,e.browser==="chrome"&&e.version>=76){const{sdpSemantics:c}=this.getConfiguration();c==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp},enumerable:!0,configurable:!0})}if(t(arguments[0])){const c=i(arguments[0]),l=s(c),h=r(arguments[0],c);let d;l===0&&h===0?d=Number.POSITIVE_INFINITY:l===0||h===0?d=Math.max(l,h):d=Math.min(l,h);const f={};Object.defineProperty(f,"maxMessageSize",{get(){return d}}),this._sctp=f}return o.apply(this,arguments)}}function Ym(n){if(!(n.RTCPeerConnection&&"createDataChannel"in n.RTCPeerConnection.prototype))return;function e(i,s){const r=i.send;i.send=function(){const a=arguments[0],c=a.length||a.size||a.byteLength;if(i.readyState==="open"&&s.sctp&&c>s.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+s.sctp.maxMessageSize+" bytes)");return r.apply(i,arguments)}}const t=n.RTCPeerConnection.prototype.createDataChannel;n.RTCPeerConnection.prototype.createDataChannel=function(){const s=t.apply(this,arguments);return e(s,this),s},Fp(n,"datachannel",i=>(e(i.channel,i.target),i))}function JE(n){if(!n.RTCPeerConnection||"connectionState"in n.RTCPeerConnection.prototype)return;const e=n.RTCPeerConnection.prototype;Object.defineProperty(e,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(e,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(t){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),t&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=t)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(t=>{const i=e[t];e[t]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=s=>{const r=s.target;if(r._lastConnectionState!==r.connectionState){r._lastConnectionState=r.connectionState;const o=new Event("connectionstatechange",s);r.dispatchEvent(o)}return s},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),i.apply(this,arguments)}})}function KE(n,e){if(!n.RTCPeerConnection||e.browser==="chrome"&&e.version>=71||e.browser==="safari"&&e.version>=605)return;const t=n.RTCPeerConnection.prototype.setRemoteDescription;n.RTCPeerConnection.prototype.setRemoteDescription=function(s){if(s&&s.sdp&&s.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const r=s.sdp.split(`
`).filter(o=>o.trim()!=="a=extmap-allow-mixed").join(`
`);n.RTCSessionDescription&&s instanceof n.RTCSessionDescription?arguments[0]=new n.RTCSessionDescription({type:s.type,sdp:r}):s.sdp=r}return t.apply(this,arguments)}}function P0(n,e){if(!(n.RTCPeerConnection&&n.RTCPeerConnection.prototype))return;const t=n.RTCPeerConnection.prototype.addIceCandidate;!t||t.length===0||(n.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(e.browser==="chrome"&&e.version<78||e.browser==="firefox"&&e.version<68||e.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?Promise.resolve():t.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}const AX=Object.freeze(Object.defineProperty({__proto__:null,removeExtmapAllowMixed:KE,shimAddIceCandidateNullOrEmpty:P0,shimConnectionState:JE,shimMaxMessageSize:Xm,shimRTCIceCandidate:R0,shimSendThrowTypeError:Ym},Symbol.toStringTag,{value:"Module"}));function vX({window:n}={},e={shimChrome:!0,shimFirefox:!0,shimEdge:!0,shimSafari:!0}){const t=A1,i=lX(n),s={browserDetails:i,commonShim:AX,extractVersion:qm,disableLog:aX,disableWarnings:cX};switch(i.browser){case"chrome":if(!JB||!qE||!e.shimChrome)return t("Chrome shim is not included in this adapter release."),s;if(i.version===null)return t("Chrome shim can not determine version, not shimming."),s;t("adapter.js shimming chrome."),s.browserShim=JB,P0(n,i),pU(n,i),mU(n),qE(n,i),gU(n),_U(n,i),AU(n),vU(n),yU(n),xU(n,i),R0(n),JE(n),Xm(n,i),Ym(n),KE(n,i);break;case"firefox":if(!eD||!YE||!e.shimFirefox)return t("Firefox shim is not included in this adapter release."),s;t("adapter.js shimming firefox."),s.browserShim=eD,P0(n,i),MU(n,i),YE(n,i),IU(n),BU(n),RU(n),PU(n),DU(n),OU(n),kU(n),LU(n),FU(n),R0(n),JE(n),Xm(n,i),Ym(n);break;case"edge":if(!$B||!XE||!e.shimEdge)return t("MS edge shim is not included in this adapter release."),s;t("adapter.js shimming edge."),s.browserShim=$B,CU(n),EU(n),XE(n,i),TU(n),Xm(n,i),Ym(n);break;case"safari":if(!tD||!e.shimSafari)return t("Safari shim is not included in this adapter release."),s;t("adapter.js shimming safari."),s.browserShim=tD,P0(n,i),HU(n),jU(n),zU(n),UU(n),NU(n),QU(n),GU(n),WU(n),R0(n),Xm(n,i),Ym(n),KE(n,i);break;default:t("Unsupported browser!");break}return s}const iD=vX({window:typeof window>"u"?void 0:window});function yc(n,e,t,i){Object.defineProperty(n,e,{get:t,set:i,enumerable:!0,configurable:!0})}var TS=iD.default||iD,Sm=new(function(){function n(){this.isIOS=["iPad","iPhone","iPod"].includes(navigator.platform),this.supportedBrowsers=["firefox","chrome","safari"],this.minFirefoxVersion=59,this.minChromeVersion=72,this.minSafariVersion=605}return n.prototype.isWebRTCSupported=function(){return typeof RTCPeerConnection<"u"},n.prototype.isBrowserSupported=function(){var e=this.getBrowser(),t=this.getVersion(),i=this.supportedBrowsers.includes(e);return i?e==="chrome"?t>=this.minChromeVersion:e==="firefox"?t>=this.minFirefoxVersion:e==="safari"?!this.isIOS&&t>=this.minSafariVersion:!1:!1},n.prototype.getBrowser=function(){return TS.browserDetails.browser},n.prototype.getVersion=function(){return TS.browserDetails.version||0},n.prototype.isUnifiedPlanSupported=function(){var e=this.getBrowser(),t=TS.browserDetails.version||0;if(e==="chrome"&&t<this.minChromeVersion)return!1;if(e==="firefox"&&t>=this.minFirefoxVersion)return!0;if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;var i,s=!1;try{i=new RTCPeerConnection,i.addTransceiver("audio"),s=!0}catch{}finally{i&&i.close()}return s},n.prototype.toString=function(){return`Supports:
    browser:`.concat(this.getBrowser(),`
    version:`).concat(this.getVersion(),`
    isIOS:`).concat(this.isIOS,`
    isWebRTCSupported:`).concat(this.isWebRTCSupported(),`
    isBrowserSupported:`).concat(this.isBrowserSupported(),`
    isUnifiedPlanSupported:`).concat(this.isUnifiedPlanSupported())},n}()),nD={iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:["turn:eu-0.turn.peerjs.com:3478","turn:us-0.turn.peerjs.com:3478"],username:"peerjs",credential:"peerjsp"}],sdpSemantics:"unified-plan"},yX=function(){function n(){this.CLOUD_HOST="0.peerjs.com",this.CLOUD_PORT=443,this.chunkedBrowsers={Chrome:1,chrome:1},this.chunkedMTU=16300,this.defaultConfig=nD,this.browser=Sm.getBrowser(),this.browserVersion=Sm.getVersion(),this.supports=function(){var e={browser:Sm.isBrowserSupported(),webRTC:Sm.isWebRTCSupported(),audioVideo:!1,data:!1,binaryBlob:!1,reliable:!1};if(!e.webRTC)return e;var t;try{t=new RTCPeerConnection(nD),e.audioVideo=!0;var i=void 0;try{i=t.createDataChannel("_PEERJSTEST",{ordered:!0}),e.data=!0,e.reliable=!!i.ordered;try{i.binaryType="blob",e.binaryBlob=!Sm.isIOS}catch{}}catch{}finally{i&&i.close()}}catch{}finally{t&&t.close()}return e}(),this.pack=WB.pack,this.unpack=WB.unpack,this._dataCount=1}return n.prototype.noop=function(){},n.prototype.validateId=function(e){return!e||/^[A-Za-z0-9]+(?:[ _-][A-Za-z0-9]+)*$/.test(e)},n.prototype.chunk=function(e){for(var t=[],i=e.size,s=Math.ceil(i/bi.chunkedMTU),r=0,o=0;o<i;){var a=Math.min(i,o+bi.chunkedMTU),c=e.slice(o,a),l={__peerData:this._dataCount,n:r,data:c,total:s};t.push(l),o=a,r++}return this._dataCount++,t},n.prototype.blobToArrayBuffer=function(e,t){var i=new FileReader;return i.onload=function(s){s.target&&t(s.target.result)},i.readAsArrayBuffer(e),i},n.prototype.binaryStringToArrayBuffer=function(e){for(var t=new Uint8Array(e.length),i=0;i<e.length;i++)t[i]=e.charCodeAt(i)&255;return t.buffer},n.prototype.randomToken=function(){return Math.random().toString(36).slice(2)},n.prototype.isSecure=function(){return location.protocol==="https:"},n}(),bi=new yX,qU={};yc(qU,"Peer",()=>eT,n=>eT=n);var qA={},bX=Object.prototype.hasOwnProperty,yr="~";function hA(){}Object.create&&(hA.prototype=Object.create(null),new hA().__proto__||(yr=!1));function _X(n,e,t){this.fn=n,this.context=e,this.once=t||!1}function XU(n,e,t,i,s){if(typeof t!="function")throw new TypeError("The listener must be a function");var r=new _X(t,i||n,s),o=yr?yr+e:e;return n._events[o]?n._events[o].fn?n._events[o]=[n._events[o],r]:n._events[o].push(r):(n._events[o]=r,n._eventsCount++),n}function B0(n,e){--n._eventsCount===0?n._events=new hA:delete n._events[e]}function qs(){this._events=new hA,this._eventsCount=0}qs.prototype.eventNames=function(){var e=[],t,i;if(this._eventsCount===0)return e;for(i in t=this._events)bX.call(t,i)&&e.push(yr?i.slice(1):i);return Object.getOwnPropertySymbols?e.concat(Object.getOwnPropertySymbols(t)):e};qs.prototype.listeners=function(e){var t=yr?yr+e:e,i=this._events[t];if(!i)return[];if(i.fn)return[i.fn];for(var s=0,r=i.length,o=new Array(r);s<r;s++)o[s]=i[s].fn;return o};qs.prototype.listenerCount=function(e){var t=yr?yr+e:e,i=this._events[t];return i?i.fn?1:i.length:0};qs.prototype.emit=function(e,t,i,s,r,o){var a=yr?yr+e:e;if(!this._events[a])return!1;var c=this._events[a],l=arguments.length,h,d;if(c.fn){switch(c.once&&this.removeListener(e,c.fn,void 0,!0),l){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,t),!0;case 3:return c.fn.call(c.context,t,i),!0;case 4:return c.fn.call(c.context,t,i,s),!0;case 5:return c.fn.call(c.context,t,i,s,r),!0;case 6:return c.fn.call(c.context,t,i,s,r,o),!0}for(d=1,h=new Array(l-1);d<l;d++)h[d-1]=arguments[d];c.fn.apply(c.context,h)}else{var f=c.length,p;for(d=0;d<f;d++)switch(c[d].once&&this.removeListener(e,c[d].fn,void 0,!0),l){case 1:c[d].fn.call(c[d].context);break;case 2:c[d].fn.call(c[d].context,t);break;case 3:c[d].fn.call(c[d].context,t,i);break;case 4:c[d].fn.call(c[d].context,t,i,s);break;default:if(!h)for(p=1,h=new Array(l-1);p<l;p++)h[p-1]=arguments[p];c[d].fn.apply(c[d].context,h)}}return!0};qs.prototype.on=function(e,t,i){return XU(this,e,t,i,!1)};qs.prototype.once=function(e,t,i){return XU(this,e,t,i,!0)};qs.prototype.removeListener=function(e,t,i,s){var r=yr?yr+e:e;if(!this._events[r])return this;if(!t)return B0(this,r),this;var o=this._events[r];if(o.fn)o.fn===t&&(!s||o.once)&&(!i||o.context===i)&&B0(this,r);else{for(var a=0,c=[],l=o.length;a<l;a++)(o[a].fn!==t||s&&!o[a].once||i&&o[a].context!==i)&&c.push(o[a]);c.length?this._events[r]=c.length===1?c[0]:c:B0(this,r)}return this};qs.prototype.removeAllListeners=function(e){var t;return e?(t=yr?yr+e:e,this._events[t]&&B0(this,t)):(this._events=new hA,this._eventsCount=0),this};qs.prototype.off=qs.prototype.removeListener;qs.prototype.addListener=qs.prototype.on;qs.prefixed=yr;qs.EventEmitter=qs;qA=qs;var lt={};yc(lt,"LogLevel",()=>Dr,n=>Dr=n);yc(lt,"default",()=>sD,n=>sD=n);var Au=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var i=t.call(n),s,r=[],o;try{for(;(e===void 0||e-- >0)&&!(s=i.next()).done;)r.push(s.value)}catch(a){o={error:a}}finally{try{s&&!s.done&&(t=i.return)&&t.call(i)}finally{if(o)throw o.error}}return r},vu=function(n,e,t){if(t||arguments.length===2)for(var i=0,s=e.length,r;i<s;i++)(r||!(i in e))&&(r||(r=Array.prototype.slice.call(e,0,i)),r[i]=e[i]);return n.concat(r||Array.prototype.slice.call(e))},xX="PeerJS: ",Dr;(function(n){n[n.Disabled=0]="Disabled",n[n.Errors=1]="Errors",n[n.Warnings=2]="Warnings",n[n.All=3]="All"})(Dr||(Dr={}));var wX=function(){function n(){this._logLevel=Dr.Disabled}return Object.defineProperty(n.prototype,"logLevel",{get:function(){return this._logLevel},set:function(e){this._logLevel=e},enumerable:!1,configurable:!0}),n.prototype.log=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._logLevel>=Dr.All&&this._print.apply(this,vu([Dr.All],Au(e),!1))},n.prototype.warn=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._logLevel>=Dr.Warnings&&this._print.apply(this,vu([Dr.Warnings],Au(e),!1))},n.prototype.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._logLevel>=Dr.Errors&&this._print.apply(this,vu([Dr.Errors],Au(e),!1))},n.prototype.setLogFunction=function(e){this._print=e},n.prototype._print=function(e){for(var t=[],i=1;i<arguments.length;i++)t[i-1]=arguments[i];var s=vu([xX],Au(t),!1);for(var r in s)s[r]instanceof Error&&(s[r]="("+s[r].name+") "+s[r].message);e>=Dr.All?console.log.apply(console,vu([],Au(s),!1)):e>=Dr.Warnings?console.warn.apply(console,vu(["WARNING"],Au(s),!1)):e>=Dr.Errors&&console.error.apply(console,vu(["ERROR"],Au(s),!1))},n}(),sD=new wX,YU={};yc(YU,"Socket",()=>rD,n=>rD=n);var na;(function(n){n.Data="data",n.Media="media"})(na||(na={}));var wn;(function(n){n.BrowserIncompatible="browser-incompatible",n.Disconnected="disconnected",n.InvalidID="invalid-id",n.InvalidKey="invalid-key",n.Network="network",n.PeerUnavailable="peer-unavailable",n.SslUnavailable="ssl-unavailable",n.ServerError="server-error",n.SocketError="socket-error",n.SocketClosed="socket-closed",n.UnavailableID="unavailable-id",n.WebRTC="webrtc"})(wn||(wn={}));var Qc;(function(n){n.Binary="binary",n.BinaryUTF8="binary-utf8",n.JSON="json"})(Qc||(Qc={}));var al;(function(n){n.Message="message",n.Disconnected="disconnected",n.Error="error",n.Close="close"})(al||(al={}));var vs;(function(n){n.Heartbeat="HEARTBEAT",n.Candidate="CANDIDATE",n.Offer="OFFER",n.Answer="ANSWER",n.Open="OPEN",n.Error="ERROR",n.IdTaken="ID-TAKEN",n.InvalidKey="INVALID-KEY",n.Leave="LEAVE",n.Expire="EXPIRE"})(vs||(vs={}));var v1={};v1=JSON.parse('{"name":"peerjs","version":"1.4.7","keywords":["peerjs","webrtc","p2p","rtc"],"description":"PeerJS client","homepage":"https://peerjs.com","bugs":{"url":"https://github.com/peers/peerjs/issues"},"repository":{"type":"git","url":"https://github.com/peers/peerjs"},"license":"MIT","contributors":["Michelle Bu <michelle@michellebu.com>","afrokick <devbyru@gmail.com>","ericz <really.ez@gmail.com>","Jairo <kidandcat@gmail.com>","Jonas Gloning <34194370+jonasgloning@users.noreply.github.com>","Jairo Caro-Accino Viciana <jairo@galax.be>","Carlos Caballero <carlos.caballero.gonzalez@gmail.com>","hc <hheennrryy@gmail.com>","Muhammad Asif <capripio@gmail.com>","PrashoonB <prashoonbhattacharjee@gmail.com>","Harsh Bardhan Mishra <47351025+HarshCasper@users.noreply.github.com>","akotynski <aleksanderkotbury@gmail.com>","lmb <i@lmb.io>","Jairooo <jairocaro@msn.com>","Moritz Stckler <moritz.stueckler@gmail.com>","Simon <crydotsnakegithub@gmail.com>","Denis Lukov <denismassters@gmail.com>","Philipp Hancke <fippo@andyet.net>","Hans Oksendahl <hansoksendahl@gmail.com>","Jess <jessachandler@gmail.com>","khankuan <khankuan@gmail.com>","DUODVK <kurmanov.work@gmail.com>","XiZhao <kwang1imsa@gmail.com>","Matthias Lohr <matthias@lohr.me>","=frank tree <=frnktrb@googlemail.com>","Andre Eckardt <aeckardt@outlook.com>","Chris Cowan <agentme49@gmail.com>","Alex Chuev <alex@chuev.com>","alxnull <alxnull@e.mail.de>","Yemel Jardi <angel.jardi@gmail.com>","Ben Parnell <benjaminparnell.94@gmail.com>","Benny Lichtner <bennlich@gmail.com>","fresheneesz <bitetrudpublic@gmail.com>","bob.barstead@exaptive.com <bob.barstead@exaptive.com>","chandika <chandika@gmail.com>","emersion <contact@emersion.fr>","Christopher Van <cvan@users.noreply.github.com>","eddieherm <edhermoso@gmail.com>","Eduardo Pinho <enet4mikeenet@gmail.com>","Evandro Zanatta <ezanatta@tray.net.br>","Gardner Bickford <gardner@users.noreply.github.com>","Gian Luca <gianluca.cecchi@cynny.com>","PatrickJS <github@gdi2290.com>","jonnyf <github@jonathanfoss.co.uk>","Hizkia Felix <hizkifw@gmail.com>","Hristo Oskov <hristo.oskov@gmail.com>","Isaac Madwed <i.madwed@gmail.com>","Ilya Konanykhin <ilya.konanykhin@gmail.com>","jasonbarry <jasbarry@me.com>","Jonathan Burke <jonathan.burke.1311@googlemail.com>","Josh Hamit <josh.hamit@gmail.com>","Jordan Austin <jrax86@gmail.com>","Joel Wetzell <jwetzell@yahoo.com>","xizhao <kevin.wang@cloudera.com>","Alberto Torres <kungfoobar@gmail.com>","Jonathan Mayol <mayoljonathan@gmail.com>","Jefferson Felix <me@jsfelix.dev>","Rolf Erik Lekang <me@rolflekang.com>","Kevin Mai-Husan Chia <mhchia@users.noreply.github.com>","Pepijn de Vos <pepijndevos@gmail.com>","JooYoung <qkdlql@naver.com>","Tobias Speicher <rootcommander@gmail.com>","Steve Blaurock <sblaurock@gmail.com>","Kyrylo Shegeda <shegeda@ualberta.ca>","Diwank Singh Tomer <singh@diwank.name>","Soren Balko <Soeren.Balko@gmail.com>","Arpit Solanki <solankiarpit1997@gmail.com>","Yuki Ito <yuki@gnnk.net>","Artur Zayats <zag2art@gmail.com>"],"funding":{"type":"opencollective","url":"https://opencollective.com/peer"},"collective":{"type":"opencollective","url":"https://opencollective.com/peer"},"files":["dist/*"],"sideEffects":["lib/global.ts","lib/supports.ts"],"main":"dist/bundler.cjs","module":"dist/bundler.mjs","browser-minified":"dist/peerjs.min.js","browser-unminified":"dist/peerjs.js","types":"dist/types.d.ts","engines":{"node":">= 10"},"targets":{"types":{"source":"lib/exports.ts"},"main":{"source":"lib/exports.ts","sourceMap":{"inlineSources":true}},"module":{"source":"lib/exports.ts","includeNodeModules":["eventemitter3"],"sourceMap":{"inlineSources":true}},"browser-minified":{"context":"browser","outputFormat":"global","optimize":true,"engines":{"browsers":"cover 99%, not dead"},"source":"lib/global.ts"},"browser-unminified":{"context":"browser","outputFormat":"global","optimize":false,"engines":{"browsers":"cover 99%, not dead"},"source":"lib/global.ts"}},"scripts":{"contributors":"git-authors-cli --print=false && prettier --write package.json && git add package.json package-lock.json && git commit -m \\"chore(contributors): update and sort contributors list\\"","check":"tsc --noEmit","watch":"parcel watch","build":"rm -rf dist && parcel build","prepublishOnly":"npm run build","test":"mocha -r ts-node/register -r jsdom-global/register test/**/*.ts","format":"prettier --write .","semantic-release":"semantic-release"},"devDependencies":{"@parcel/config-default":"^2.5.0","@parcel/packager-ts":"^2.5.0","@parcel/transformer-typescript-tsc":"^2.5.0","@parcel/transformer-typescript-types":"^2.5.0","@semantic-release/changelog":"^6.0.1","@semantic-release/git":"^10.0.1","@types/chai":"^4.3.0","@types/mocha":"^9.1.0","@types/node":"^17.0.18","chai":"^4.3.6","git-authors-cli":"^1.0.40","jsdom":"^19.0.0","jsdom-global":"^3.0.2","mocha":"^9.2.0","mock-socket":"8.0.5","parcel":"^2.5.0","parcel-transformer-tsc-sourcemaps":"^1.0.2","prettier":"^2.6.2","semantic-release":"^19.0.2","standard":"^16.0.4","ts-node":"^10.5.0","typescript":"^4.5.5"},"dependencies":{"@swc/helpers":"^0.3.13","eventemitter3":"^4.0.7","peerjs-js-binarypack":"1.0.1","webrtc-adapter":"^7.7.1"}}');var SX=function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,s){i.__proto__=s}||function(i,s){for(var r in s)Object.prototype.hasOwnProperty.call(s,r)&&(i[r]=s[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function i(){this.constructor=e}e.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)}}(),CX=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var i=t.call(n),s,r=[],o;try{for(;(e===void 0||e-- >0)&&!(s=i.next()).done;)r.push(s.value)}catch(a){o={error:a}}finally{try{s&&!s.done&&(t=i.return)&&t.call(i)}finally{if(o)throw o.error}}return r},EX=function(n,e,t){if(t||arguments.length===2)for(var i=0,s=e.length,r;i<s;i++)(r||!(i in e))&&(r||(r=Array.prototype.slice.call(e,0,i)),r[i]=e[i]);return n.concat(r||Array.prototype.slice.call(e))},TX=function(n){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&n[e],i=0;if(t)return t.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&i>=n.length&&(n=void 0),{value:n&&n[i++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},rD=function(n){SX(e,n);function e(t,i,s,r,o,a){a===void 0&&(a=5e3);var c=n.call(this)||this;c.pingInterval=a,c._disconnected=!0,c._messagesQueue=[];var l=t?"wss://":"ws://";return c._baseUrl=l+i+":"+s+r+"peerjs?key="+o,c}return e.prototype.start=function(t,i){var s=this;this._id=t;var r="".concat(this._baseUrl,"&id=").concat(t,"&token=").concat(i);this._socket||!this._disconnected||(this._socket=new WebSocket(r+"&version="+v1.version),this._disconnected=!1,this._socket.onmessage=function(o){var a;try{a=JSON.parse(o.data),lt.default.log("Server message received:",a)}catch{lt.default.log("Invalid server message",o.data);return}s.emit(al.Message,a)},this._socket.onclose=function(o){s._disconnected||(lt.default.log("Socket closed.",o),s._cleanup(),s._disconnected=!0,s.emit(al.Disconnected))},this._socket.onopen=function(){s._disconnected||(s._sendQueuedMessages(),lt.default.log("Socket open"),s._scheduleHeartbeat())})},e.prototype._scheduleHeartbeat=function(){var t=this;this._wsPingTimer=setTimeout(function(){t._sendHeartbeat()},this.pingInterval)},e.prototype._sendHeartbeat=function(){if(!this._wsOpen()){lt.default.log("Cannot send heartbeat, because socket closed");return}var t=JSON.stringify({type:vs.Heartbeat});this._socket.send(t),this._scheduleHeartbeat()},e.prototype._wsOpen=function(){return!!this._socket&&this._socket.readyState===1},e.prototype._sendQueuedMessages=function(){var t,i,s=EX([],CX(this._messagesQueue),!1);this._messagesQueue=[];try{for(var r=TX(s),o=r.next();!o.done;o=r.next()){var a=o.value;this.send(a)}}catch(c){t={error:c}}finally{try{o&&!o.done&&(i=r.return)&&i.call(r)}finally{if(t)throw t.error}}},e.prototype.send=function(t){if(!this._disconnected){if(!this._id){this._messagesQueue.push(t);return}if(!t.type){this.emit(al.Error,"Invalid message");return}if(this._wsOpen()){var i=JSON.stringify(t);this._socket.send(i)}}},e.prototype.close=function(){this._disconnected||(this._cleanup(),this._disconnected=!0)},e.prototype._cleanup=function(){this._socket&&(this._socket.onopen=this._socket.onmessage=this._socket.onclose=null,this._socket.close(),this._socket=void 0),clearTimeout(this._wsPingTimer)},e}(qA.EventEmitter),ZE={};yc(ZE,"MediaConnection",()=>cD,n=>cD=n);var y1={};yc(y1,"Negotiator",()=>oD,n=>oD=n);var _b=function(){return _b=Object.assign||function(n){for(var e,t=1,i=arguments.length;t<i;t++){e=arguments[t];for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&(n[s]=e[s])}return n},_b.apply(this,arguments)},Fy=function(n,e,t,i){function s(r){return r instanceof t?r:new t(function(o){o(r)})}return new(t||(t=Promise))(function(r,o){function a(h){try{l(i.next(h))}catch(d){o(d)}}function c(h){try{l(i.throw(h))}catch(d){o(d)}}function l(h){h.done?r(h.value):s(h.value).then(a,c)}l((i=i.apply(n,e||[])).next())})},Uy=function(n,e){var t={label:0,sent:function(){if(r[0]&1)throw r[1];return r[1]},trys:[],ops:[]},i,s,r,o;return o={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(l){return function(h){return c([l,h])}}function c(l){if(i)throw new TypeError("Generator is already executing.");for(;t;)try{if(i=1,s&&(r=l[0]&2?s.return:l[0]?s.throw||((r=s.return)&&r.call(s),0):s.next)&&!(r=r.call(s,l[1])).done)return r;switch(s=0,r&&(l=[l[0]&2,r.value]),l[0]){case 0:case 1:r=l;break;case 4:return t.label++,{value:l[1],done:!1};case 5:t.label++,s=l[1],l=[0];continue;case 7:l=t.ops.pop(),t.trys.pop();continue;default:if(r=t.trys,!(r=r.length>0&&r[r.length-1])&&(l[0]===6||l[0]===2)){t=0;continue}if(l[0]===3&&(!r||l[1]>r[0]&&l[1]<r[3])){t.label=l[1];break}if(l[0]===6&&t.label<r[1]){t.label=r[1],r=l;break}if(r&&t.label<r[2]){t.label=r[2],t.ops.push(l);break}r[2]&&t.ops.pop(),t.trys.pop();continue}l=e.call(n,t)}catch(h){l=[6,h],s=0}finally{i=r=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}},oD=function(){function n(e){this.connection=e}return n.prototype.startConnection=function(e){var t=this._startPeerConnection();if(this.connection.peerConnection=t,this.connection.type===na.Media&&e._stream&&this._addTracksToConnection(e._stream,t),e.originator){if(this.connection.type===na.Data){var i=this.connection,s={ordered:!!e.reliable},r=t.createDataChannel(i.label,s);i.initialize(r)}this._makeOffer()}else this.handleSDP("OFFER",e.sdp)},n.prototype._startPeerConnection=function(){lt.default.log("Creating RTCPeerConnection.");var e=new RTCPeerConnection(this.connection.provider.options.config);return this._setupListeners(e),e},n.prototype._setupListeners=function(e){var t=this,i=this.connection.peer,s=this.connection.connectionId,r=this.connection.type,o=this.connection.provider;lt.default.log("Listening for ICE candidates."),e.onicecandidate=function(a){!a.candidate||!a.candidate.candidate||(lt.default.log("Received ICE candidates for ".concat(i,":"),a.candidate),o.socket.send({type:vs.Candidate,payload:{candidate:a.candidate,type:r,connectionId:s},dst:i}))},e.oniceconnectionstatechange=function(){switch(e.iceConnectionState){case"failed":lt.default.log("iceConnectionState is failed, closing connections to "+i),t.connection.emit("error",new Error("Negotiation of connection to "+i+" failed.")),t.connection.close();break;case"closed":lt.default.log("iceConnectionState is closed, closing connections to "+i),t.connection.emit("error",new Error("Connection to "+i+" closed.")),t.connection.close();break;case"disconnected":lt.default.log("iceConnectionState changed to disconnected on the connection with "+i);break;case"completed":e.onicecandidate=bi.noop;break}t.connection.emit("iceStateChanged",e.iceConnectionState)},lt.default.log("Listening for data channel"),e.ondatachannel=function(a){lt.default.log("Received data channel");var c=a.channel,l=o.getConnection(i,s);l.initialize(c)},lt.default.log("Listening for remote stream"),e.ontrack=function(a){lt.default.log("Received remote stream");var c=a.streams[0],l=o.getConnection(i,s);if(l.type===na.Media){var h=l;t._addStreamToMediaConnection(c,h)}}},n.prototype.cleanup=function(){lt.default.log("Cleaning up PeerConnection to "+this.connection.peer);var e=this.connection.peerConnection;if(e){this.connection.peerConnection=null,e.onicecandidate=e.oniceconnectionstatechange=e.ondatachannel=e.ontrack=function(){};var t=e.signalingState!=="closed",i=!1;if(this.connection.type===na.Data){var s=this.connection,r=s.dataChannel;r&&(i=!!r.readyState&&r.readyState!=="closed")}(t||i)&&e.close()}},n.prototype._makeOffer=function(){return Fy(this,void 0,Promise,function(){var e,t,i,s,r,o,a;return Uy(this,function(c){switch(c.label){case 0:e=this.connection.peerConnection,t=this.connection.provider,c.label=1;case 1:return c.trys.push([1,7,,8]),[4,e.createOffer(this.connection.options.constraints)];case 2:i=c.sent(),lt.default.log("Created offer."),this.connection.options.sdpTransform&&typeof this.connection.options.sdpTransform=="function"&&(i.sdp=this.connection.options.sdpTransform(i.sdp)||i.sdp),c.label=3;case 3:return c.trys.push([3,5,,6]),[4,e.setLocalDescription(i)];case 4:return c.sent(),lt.default.log("Set localDescription:",i,"for:".concat(this.connection.peer)),s={sdp:i,type:this.connection.type,connectionId:this.connection.connectionId,metadata:this.connection.metadata,browser:bi.browser},this.connection.type===na.Data&&(r=this.connection,s=_b(_b({},s),{label:r.label,reliable:r.reliable,serialization:r.serialization})),t.socket.send({type:vs.Offer,payload:s,dst:this.connection.peer}),[3,6];case 5:return o=c.sent(),o!="OperationError: Failed to set local offer sdp: Called in wrong state: kHaveRemoteOffer"&&(t.emitError(wn.WebRTC,o),lt.default.log("Failed to setLocalDescription, ",o)),[3,6];case 6:return[3,8];case 7:return a=c.sent(),t.emitError(wn.WebRTC,a),lt.default.log("Failed to createOffer, ",a),[3,8];case 8:return[2]}})})},n.prototype._makeAnswer=function(){return Fy(this,void 0,Promise,function(){var e,t,i,s,r;return Uy(this,function(o){switch(o.label){case 0:e=this.connection.peerConnection,t=this.connection.provider,o.label=1;case 1:return o.trys.push([1,7,,8]),[4,e.createAnswer()];case 2:i=o.sent(),lt.default.log("Created answer."),this.connection.options.sdpTransform&&typeof this.connection.options.sdpTransform=="function"&&(i.sdp=this.connection.options.sdpTransform(i.sdp)||i.sdp),o.label=3;case 3:return o.trys.push([3,5,,6]),[4,e.setLocalDescription(i)];case 4:return o.sent(),lt.default.log("Set localDescription:",i,"for:".concat(this.connection.peer)),t.socket.send({type:vs.Answer,payload:{sdp:i,type:this.connection.type,connectionId:this.connection.connectionId,browser:bi.browser},dst:this.connection.peer}),[3,6];case 5:return s=o.sent(),t.emitError(wn.WebRTC,s),lt.default.log("Failed to setLocalDescription, ",s),[3,6];case 6:return[3,8];case 7:return r=o.sent(),t.emitError(wn.WebRTC,r),lt.default.log("Failed to create answer, ",r),[3,8];case 8:return[2]}})})},n.prototype.handleSDP=function(e,t){return Fy(this,void 0,Promise,function(){var i,s,r,o;return Uy(this,function(a){switch(a.label){case 0:t=new RTCSessionDescription(t),i=this.connection.peerConnection,s=this.connection.provider,lt.default.log("Setting remote description",t),r=this,a.label=1;case 1:return a.trys.push([1,5,,6]),[4,i.setRemoteDescription(t)];case 2:return a.sent(),lt.default.log("Set remoteDescription:".concat(e," for:").concat(this.connection.peer)),e!=="OFFER"?[3,4]:[4,r._makeAnswer()];case 3:a.sent(),a.label=4;case 4:return[3,6];case 5:return o=a.sent(),s.emitError(wn.WebRTC,o),lt.default.log("Failed to setRemoteDescription, ",o),[3,6];case 6:return[2]}})})},n.prototype.handleCandidate=function(e){return Fy(this,void 0,Promise,function(){var t,i,s,r,o,a;return Uy(this,function(c){switch(c.label){case 0:lt.default.log("handleCandidate:",e),t=e.candidate,i=e.sdpMLineIndex,s=e.sdpMid,r=this.connection.peerConnection,o=this.connection.provider,c.label=1;case 1:return c.trys.push([1,3,,4]),[4,r.addIceCandidate(new RTCIceCandidate({sdpMid:s,sdpMLineIndex:i,candidate:t}))];case 2:return c.sent(),lt.default.log("Added ICE candidate for:".concat(this.connection.peer)),[3,4];case 3:return a=c.sent(),o.emitError(wn.WebRTC,a),lt.default.log("Failed to handleCandidate, ",a),[3,4];case 4:return[2]}})})},n.prototype._addTracksToConnection=function(e,t){if(lt.default.log("add tracks from stream ".concat(e.id," to peer connection")),!t.addTrack)return lt.default.error("Your browser does't support RTCPeerConnection#addTrack. Ignored.");e.getTracks().forEach(function(i){t.addTrack(i,e)})},n.prototype._addStreamToMediaConnection=function(e,t){lt.default.log("add stream ".concat(e.id," to media connection ").concat(t.connectionId)),t.addStream(e)},n}(),b1={};yc(b1,"BaseConnection",()=>aD,n=>aD=n);var MX=function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,s){i.__proto__=s}||function(i,s){for(var r in s)Object.prototype.hasOwnProperty.call(s,r)&&(i[r]=s[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function i(){this.constructor=e}e.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)}}(),aD=function(n){MX(e,n);function e(t,i,s){var r=n.call(this)||this;return r.peer=t,r.provider=i,r.options=s,r._open=!1,r.metadata=s.metadata,r}return Object.defineProperty(e.prototype,"open",{get:function(){return this._open},enumerable:!1,configurable:!0}),e}(qA.EventEmitter),IX=function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,s){i.__proto__=s}||function(i,s){for(var r in s)Object.prototype.hasOwnProperty.call(s,r)&&(i[r]=s[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function i(){this.constructor=e}e.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)}}(),xb=function(){return xb=Object.assign||function(n){for(var e,t=1,i=arguments.length;t<i;t++){e=arguments[t];for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&(n[s]=e[s])}return n},xb.apply(this,arguments)},RX=function(n){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&n[e],i=0;if(t)return t.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&i>=n.length&&(n=void 0),{value:n&&n[i++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},cD=function(n){IX(e,n);function e(t,i,s){var r=n.call(this,t,i,s)||this;return r._localStream=r.options._stream,r.connectionId=r.options.connectionId||e.ID_PREFIX+bi.randomToken(),r._negotiator=new y1.Negotiator(r),r._localStream&&r._negotiator.startConnection({_stream:r._localStream,originator:!0}),r}return Object.defineProperty(e.prototype,"type",{get:function(){return na.Media},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"localStream",{get:function(){return this._localStream},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"remoteStream",{get:function(){return this._remoteStream},enumerable:!1,configurable:!0}),e.prototype.addStream=function(t){lt.default.log("Receiving stream",t),this._remoteStream=t,n.prototype.emit.call(this,"stream",t)},e.prototype.handleMessage=function(t){var i=t.type,s=t.payload;switch(t.type){case vs.Answer:this._negotiator.handleSDP(i,s.sdp),this._open=!0;break;case vs.Candidate:this._negotiator.handleCandidate(s.candidate);break;default:lt.default.warn("Unrecognized message type:".concat(i," from peer:").concat(this.peer));break}},e.prototype.answer=function(t,i){var s,r;if(i===void 0&&(i={}),this._localStream){lt.default.warn("Local stream already exists on this MediaConnection. Are you answering a call twice?");return}this._localStream=t,i&&i.sdpTransform&&(this.options.sdpTransform=i.sdpTransform),this._negotiator.startConnection(xb(xb({},this.options._payload),{_stream:t}));var o=this.provider._getMessages(this.connectionId);try{for(var a=RX(o),c=a.next();!c.done;c=a.next()){var l=c.value;this.handleMessage(l)}}catch(h){s={error:h}}finally{try{c&&!c.done&&(r=a.return)&&r.call(a)}finally{if(s)throw s.error}}this._open=!0},e.prototype.close=function(){this._negotiator&&(this._negotiator.cleanup(),this._negotiator=null),this._localStream=null,this._remoteStream=null,this.provider&&(this.provider._removeConnection(this),this.provider=null),this.options&&this.options._stream&&(this.options._stream=null),this.open&&(this._open=!1,n.prototype.emit.call(this,"close"))},e.ID_PREFIX="mc_",e}(b1.BaseConnection),$E={};yc($E,"DataConnection",()=>hD,n=>hD=n);var JU={};yc(JU,"EncodingQueue",()=>lD,n=>lD=n);var PX=function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,s){i.__proto__=s}||function(i,s){for(var r in s)Object.prototype.hasOwnProperty.call(s,r)&&(i[r]=s[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function i(){this.constructor=e}e.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)}}(),lD=function(n){PX(e,n);function e(){var t=n.call(this)||this;return t.fileReader=new FileReader,t._queue=[],t._processing=!1,t.fileReader.onload=function(i){t._processing=!1,i.target&&t.emit("done",i.target.result),t.doNextTask()},t.fileReader.onerror=function(i){lt.default.error("EncodingQueue error:",i),t._processing=!1,t.destroy(),t.emit("error",i)},t}return Object.defineProperty(e.prototype,"queue",{get:function(){return this._queue},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"size",{get:function(){return this.queue.length},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"processing",{get:function(){return this._processing},enumerable:!1,configurable:!0}),e.prototype.enque=function(t){this.queue.push(t),!this.processing&&this.doNextTask()},e.prototype.destroy=function(){this.fileReader.abort(),this._queue=[]},e.prototype.doNextTask=function(){this.size!==0&&(this.processing||(this._processing=!0,this.fileReader.readAsArrayBuffer(this.queue.shift())))},e}(qA.EventEmitter),BX=function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,s){i.__proto__=s}||function(i,s){for(var r in s)Object.prototype.hasOwnProperty.call(s,r)&&(i[r]=s[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function i(){this.constructor=e}e.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)}}(),DX=function(n){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&n[e],i=0;if(t)return t.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&i>=n.length&&(n=void 0),{value:n&&n[i++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},hD=function(n){BX(e,n);function e(t,i,s){var r=n.call(this,t,i,s)||this;return r.stringify=JSON.stringify,r.parse=JSON.parse,r._buffer=[],r._bufferSize=0,r._buffering=!1,r._chunkedData={},r._encodingQueue=new JU.EncodingQueue,r.connectionId=r.options.connectionId||e.ID_PREFIX+bi.randomToken(),r.label=r.options.label||r.connectionId,r.serialization=r.options.serialization||Qc.Binary,r.reliable=!!r.options.reliable,r._encodingQueue.on("done",function(o){r._bufferedSend(o)}),r._encodingQueue.on("error",function(){lt.default.error("DC#".concat(r.connectionId,": Error occured in encoding from blob to arraybuffer, close DC")),r.close()}),r._negotiator=new y1.Negotiator(r),r._negotiator.startConnection(r.options._payload||{originator:!0}),r}return Object.defineProperty(e.prototype,"type",{get:function(){return na.Data},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"dataChannel",{get:function(){return this._dc},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"bufferSize",{get:function(){return this._bufferSize},enumerable:!1,configurable:!0}),e.prototype.initialize=function(t){this._dc=t,this._configureDataChannel()},e.prototype._configureDataChannel=function(){var t=this;(!bi.supports.binaryBlob||bi.supports.reliable)&&(this.dataChannel.binaryType="arraybuffer"),this.dataChannel.onopen=function(){lt.default.log("DC#".concat(t.connectionId," dc connection success")),t._open=!0,t.emit("open")},this.dataChannel.onmessage=function(i){lt.default.log("DC#".concat(t.connectionId," dc onmessage:"),i.data),t._handleDataMessage(i)},this.dataChannel.onclose=function(){lt.default.log("DC#".concat(t.connectionId," dc closed for:"),t.peer),t.close()}},e.prototype._handleDataMessage=function(t){var i=this,s=t.data,r=s.constructor,o=this.serialization===Qc.Binary||this.serialization===Qc.BinaryUTF8,a=s;if(o){if(r===Blob){bi.blobToArrayBuffer(s,function(l){var h=bi.unpack(l);i.emit("data",h)});return}else if(r===ArrayBuffer)a=bi.unpack(s);else if(r===String){var c=bi.binaryStringToArrayBuffer(s);a=bi.unpack(c)}}else this.serialization===Qc.JSON&&(a=this.parse(s));if(a.__peerData){this._handleChunk(a);return}n.prototype.emit.call(this,"data",a)},e.prototype._handleChunk=function(t){var i=t.__peerData,s=this._chunkedData[i]||{data:[],count:0,total:t.total};if(s.data[t.n]=t.data,s.count++,this._chunkedData[i]=s,s.total===s.count){delete this._chunkedData[i];var r=new Blob(s.data);this._handleDataMessage({data:r})}},e.prototype.close=function(){this._buffer=[],this._bufferSize=0,this._chunkedData={},this._negotiator&&(this._negotiator.cleanup(),this._negotiator=null),this.provider&&(this.provider._removeConnection(this),this.provider=null),this.dataChannel&&(this.dataChannel.onopen=null,this.dataChannel.onmessage=null,this.dataChannel.onclose=null,this._dc=null),this._encodingQueue&&(this._encodingQueue.destroy(),this._encodingQueue.removeAllListeners(),this._encodingQueue=null),this.open&&(this._open=!1,n.prototype.emit.call(this,"close"))},e.prototype.send=function(t,i){if(!this.open){n.prototype.emit.call(this,"error",new Error("Connection is not open. You should listen for the `open` event before sending messages."));return}if(this.serialization===Qc.JSON)this._bufferedSend(this.stringify(t));else if(this.serialization===Qc.Binary||this.serialization===Qc.BinaryUTF8){var s=bi.pack(t);if(!i&&s.size>bi.chunkedMTU){this._sendChunks(s);return}bi.supports.binaryBlob?this._bufferedSend(s):this._encodingQueue.enque(s)}else this._bufferedSend(t)},e.prototype._bufferedSend=function(t){(this._buffering||!this._trySend(t))&&(this._buffer.push(t),this._bufferSize=this._buffer.length)},e.prototype._trySend=function(t){var i=this;if(!this.open)return!1;if(this.dataChannel.bufferedAmount>e.MAX_BUFFERED_AMOUNT)return this._buffering=!0,setTimeout(function(){i._buffering=!1,i._tryBuffer()},50),!1;try{this.dataChannel.send(t)}catch(s){return lt.default.error("DC#:".concat(this.connectionId," Error when sending:"),s),this._buffering=!0,this.close(),!1}return!0},e.prototype._tryBuffer=function(){if(this.open&&this._buffer.length!==0){var t=this._buffer[0];this._trySend(t)&&(this._buffer.shift(),this._bufferSize=this._buffer.length,this._tryBuffer())}},e.prototype._sendChunks=function(t){var i,s,r=bi.chunk(t);lt.default.log("DC#".concat(this.connectionId," Try to send ").concat(r.length," chunks..."));try{for(var o=DX(r),a=o.next();!a.done;a=o.next()){var c=a.value;this.send(c,!0)}}catch(l){i={error:l}}finally{try{a&&!a.done&&(s=o.return)&&s.call(o)}finally{if(i)throw i.error}}},e.prototype.handleMessage=function(t){var i=t.payload;switch(t.type){case vs.Answer:this._negotiator.handleSDP(t.type,i.sdp);break;case vs.Candidate:this._negotiator.handleCandidate(i.candidate);break;default:lt.default.warn("Unrecognized message type:",t.type,"from peer:",this.peer);break}},e.ID_PREFIX="dc_",e.MAX_BUFFERED_AMOUNT=8388608,e}(b1.BaseConnection),KU={};yc(KU,"API",()=>fD,n=>fD=n);var uD=function(n,e,t,i){function s(r){return r instanceof t?r:new t(function(o){o(r)})}return new(t||(t=Promise))(function(r,o){function a(h){try{l(i.next(h))}catch(d){o(d)}}function c(h){try{l(i.throw(h))}catch(d){o(d)}}function l(h){h.done?r(h.value):s(h.value).then(a,c)}l((i=i.apply(n,e||[])).next())})},dD=function(n,e){var t={label:0,sent:function(){if(r[0]&1)throw r[1];return r[1]},trys:[],ops:[]},i,s,r,o;return o={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(l){return function(h){return c([l,h])}}function c(l){if(i)throw new TypeError("Generator is already executing.");for(;t;)try{if(i=1,s&&(r=l[0]&2?s.return:l[0]?s.throw||((r=s.return)&&r.call(s),0):s.next)&&!(r=r.call(s,l[1])).done)return r;switch(s=0,r&&(l=[l[0]&2,r.value]),l[0]){case 0:case 1:r=l;break;case 4:return t.label++,{value:l[1],done:!1};case 5:t.label++,s=l[1],l=[0];continue;case 7:l=t.ops.pop(),t.trys.pop();continue;default:if(r=t.trys,!(r=r.length>0&&r[r.length-1])&&(l[0]===6||l[0]===2)){t=0;continue}if(l[0]===3&&(!r||l[1]>r[0]&&l[1]<r[3])){t.label=l[1];break}if(l[0]===6&&t.label<r[1]){t.label=r[1],r=l;break}if(r&&t.label<r[2]){t.label=r[2],t.ops.push(l);break}r[2]&&t.ops.pop(),t.trys.pop();continue}l=e.call(n,t)}catch(h){l=[6,h],s=0}finally{i=r=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}},fD=function(){function n(e){this._options=e}return n.prototype._buildRequest=function(e){var t=this._options.secure?"https":"http",i=this._options,s=i.host,r=i.port,o=i.path,a=i.key,c=new URL("".concat(t,"://").concat(s,":").concat(r).concat(o).concat(a,"/").concat(e));return c.searchParams.set("ts","".concat(Date.now()).concat(Math.random())),c.searchParams.set("version",v1.version),fetch(c.href,{referrerPolicy:this._options.referrerPolicy})},n.prototype.retrieveId=function(){return uD(this,void 0,Promise,function(){var e,t,i;return dD(this,function(s){switch(s.label){case 0:return s.trys.push([0,2,,3]),[4,this._buildRequest("id")];case 1:if(e=s.sent(),e.status!==200)throw new Error("Error. Status:".concat(e.status));return[2,e.text()];case 2:throw t=s.sent(),lt.default.error("Error retrieving ID",t),i="",this._options.path==="/"&&this._options.host!==bi.CLOUD_HOST&&(i=" If you passed in a `path` to your self-hosted PeerServer, you'll also need to pass in that same path when creating a new Peer."),new Error("Could not get an ID from the server."+i);case 3:return[2]}})})},n.prototype.listAllPeers=function(){return uD(this,void 0,Promise,function(){var e,t,i;return dD(this,function(s){switch(s.label){case 0:return s.trys.push([0,2,,3]),[4,this._buildRequest("peers")];case 1:if(e=s.sent(),e.status!==200)throw e.status===401?(t="",this._options.host===bi.CLOUD_HOST?t="It looks like you're using the cloud server. You can email team@peerjs.com to enable peer listing for your API key.":t="You need to enable `allow_discovery` on your self-hosted PeerServer to use this feature.",new Error("It doesn't look like you have permission to list peers IDs. "+t)):new Error("Error. Status:".concat(e.status));return[2,e.json()];case 2:throw i=s.sent(),lt.default.error("Error retrieving list peers",i),new Error("Could not get list peers from the server."+i);case 3:return[2]}})})},n}(),OX=function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,s){i.__proto__=s}||function(i,s){for(var r in s)Object.prototype.hasOwnProperty.call(s,r)&&(i[r]=s[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function i(){this.constructor=e}e.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)}}(),pg=function(){return pg=Object.assign||function(n){for(var e,t=1,i=arguments.length;t<i;t++){e=arguments[t];for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&(n[s]=e[s])}return n},pg.apply(this,arguments)},Cm=function(n){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&n[e],i=0;if(t)return t.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&i>=n.length&&(n=void 0),{value:n&&n[i++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},kX=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var i=t.call(n),s,r=[],o;try{for(;(e===void 0||e-- >0)&&!(s=i.next()).done;)r.push(s.value)}catch(a){o={error:a}}finally{try{s&&!s.done&&(t=i.return)&&t.call(i)}finally{if(o)throw o.error}}return r},eT=function(n){OX(e,n);function e(t,i){var s=n.call(this)||this;s._id=null,s._lastServerId=null,s._destroyed=!1,s._disconnected=!1,s._open=!1,s._connections=new Map,s._lostMessages=new Map;var r;return t&&t.constructor==Object?i=t:t&&(r=t.toString()),i=pg({debug:0,host:bi.CLOUD_HOST,port:bi.CLOUD_PORT,path:"/",key:e.DEFAULT_KEY,token:bi.randomToken(),config:bi.defaultConfig,referrerPolicy:"strict-origin-when-cross-origin"},i),s._options=i,s._options.host==="/"&&(s._options.host=window.location.hostname),s._options.path&&(s._options.path[0]!=="/"&&(s._options.path="/"+s._options.path),s._options.path[s._options.path.length-1]!=="/"&&(s._options.path+="/")),s._options.secure===void 0&&s._options.host!==bi.CLOUD_HOST?s._options.secure=bi.isSecure():s._options.host==bi.CLOUD_HOST&&(s._options.secure=!0),s._options.logFunction&&lt.default.setLogFunction(s._options.logFunction),lt.default.logLevel=s._options.debug||0,s._api=new KU.API(i),s._socket=s._createServerConnection(),!bi.supports.audioVideo&&!bi.supports.data?(s._delayedAbort(wn.BrowserIncompatible,"The current browser does not support WebRTC"),s):r&&!bi.validateId(r)?(s._delayedAbort(wn.InvalidID,'ID "'.concat(r,'" is invalid')),s):(r?s._initialize(r):s._api.retrieveId().then(function(o){return s._initialize(o)}).catch(function(o){return s._abort(wn.ServerError,o)}),s)}return Object.defineProperty(e.prototype,"id",{get:function(){return this._id},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"options",{get:function(){return this._options},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"open",{get:function(){return this._open},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"socket",{get:function(){return this._socket},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"connections",{get:function(){var t,i,s=Object.create(null);try{for(var r=Cm(this._connections),o=r.next();!o.done;o=r.next()){var a=kX(o.value,2),c=a[0],l=a[1];s[c]=l}}catch(h){t={error:h}}finally{try{o&&!o.done&&(i=r.return)&&i.call(r)}finally{if(t)throw t.error}}return s},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"destroyed",{get:function(){return this._destroyed},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"disconnected",{get:function(){return this._disconnected},enumerable:!1,configurable:!0}),e.prototype._createServerConnection=function(){var t=this,i=new YU.Socket(this._options.secure,this._options.host,this._options.port,this._options.path,this._options.key,this._options.pingInterval);return i.on(al.Message,function(s){t._handleMessage(s)}),i.on(al.Error,function(s){t._abort(wn.SocketError,s)}),i.on(al.Disconnected,function(){t.disconnected||(t.emitError(wn.Network,"Lost connection to server."),t.disconnect())}),i.on(al.Close,function(){t.disconnected||t._abort(wn.SocketClosed,"Underlying socket is already closed.")}),i},e.prototype._initialize=function(t){this._id=t,this.socket.start(t,this._options.token)},e.prototype._handleMessage=function(t){var i,s,r=t.type,o=t.payload,a=t.src;switch(r){case vs.Open:this._lastServerId=this.id,this._open=!0,this.emit("open",this.id);break;case vs.Error:this._abort(wn.ServerError,o.msg);break;case vs.IdTaken:this._abort(wn.UnavailableID,'ID "'.concat(this.id,'" is taken'));break;case vs.InvalidKey:this._abort(wn.InvalidKey,'API KEY "'.concat(this._options.key,'" is invalid'));break;case vs.Leave:lt.default.log("Received leave message from ".concat(a)),this._cleanupPeer(a),this._connections.delete(a);break;case vs.Expire:this.emitError(wn.PeerUnavailable,"Could not connect to peer ".concat(a));break;case vs.Offer:var m=o.connectionId,g=this.getConnection(a,m);if(g&&(g.close(),lt.default.warn("Offer received for existing Connection ID:".concat(m))),o.type===na.Media){var c=new ZE.MediaConnection(a,this,{connectionId:m,_payload:o,metadata:o.metadata});g=c,this._addConnection(a,g),this.emit("call",c)}else if(o.type===na.Data){var l=new $E.DataConnection(a,this,{connectionId:m,_payload:o,metadata:o.metadata,label:o.label,serialization:o.serialization,reliable:o.reliable});g=l,this._addConnection(a,g),this.emit("connection",l)}else{lt.default.warn("Received malformed connection type:".concat(o.type));return}var h=this._getMessages(m);try{for(var d=Cm(h),f=d.next();!f.done;f=d.next()){var p=f.value;g.handleMessage(p)}}catch(y){i={error:y}}finally{try{f&&!f.done&&(s=d.return)&&s.call(d)}finally{if(i)throw i.error}}break;default:if(!o){lt.default.warn("You received a malformed message from ".concat(a," of type ").concat(r));return}var m=o.connectionId,g=this.getConnection(a,m);g&&g.peerConnection?g.handleMessage(t):m?this._storeMessage(m,t):lt.default.warn("You received an unrecognized message:",t);break}},e.prototype._storeMessage=function(t,i){this._lostMessages.has(t)||this._lostMessages.set(t,[]),this._lostMessages.get(t).push(i)},e.prototype._getMessages=function(t){var i=this._lostMessages.get(t);return i?(this._lostMessages.delete(t),i):[]},e.prototype.connect=function(t,i){if(i===void 0&&(i={}),this.disconnected){lt.default.warn("You cannot connect to a new Peer because you called .disconnect() on this Peer and ended your connection with the server. You can create a new Peer to reconnect, or call reconnect on this peer if you believe its ID to still be available."),this.emitError(wn.Disconnected,"Cannot connect to new Peer after disconnecting from server.");return}var s=new $E.DataConnection(t,this,i);return this._addConnection(t,s),s},e.prototype.call=function(t,i,s){if(s===void 0&&(s={}),this.disconnected){lt.default.warn("You cannot connect to a new Peer because you called .disconnect() on this Peer and ended your connection with the server. You can create a new Peer to reconnect."),this.emitError(wn.Disconnected,"Cannot connect to new Peer after disconnecting from server.");return}if(!i){lt.default.error("To call a peer, you must provide a stream from your browser's `getUserMedia`.");return}var r=new ZE.MediaConnection(t,this,pg(pg({},s),{_stream:i}));return this._addConnection(t,r),r},e.prototype._addConnection=function(t,i){lt.default.log("add connection ".concat(i.type,":").concat(i.connectionId," to peerId:").concat(t)),this._connections.has(t)||this._connections.set(t,[]),this._connections.get(t).push(i)},e.prototype._removeConnection=function(t){var i=this._connections.get(t.peer);if(i){var s=i.indexOf(t);s!==-1&&i.splice(s,1)}this._lostMessages.delete(t.connectionId)},e.prototype.getConnection=function(t,i){var s,r,o=this._connections.get(t);if(!o)return null;try{for(var a=Cm(o),c=a.next();!c.done;c=a.next()){var l=c.value;if(l.connectionId===i)return l}}catch(h){s={error:h}}finally{try{c&&!c.done&&(r=a.return)&&r.call(a)}finally{if(s)throw s.error}}return null},e.prototype._delayedAbort=function(t,i){var s=this;setTimeout(function(){s._abort(t,i)},0)},e.prototype._abort=function(t,i){lt.default.error("Aborting!"),this.emitError(t,i),this._lastServerId?this.disconnect():this.destroy()},e.prototype.emitError=function(t,i){lt.default.error("Error:",i);var s;typeof i=="string"?s=new Error(i):s=i,s.type=t,this.emit("error",s)},e.prototype.destroy=function(){this.destroyed||(lt.default.log("Destroy peer with ID:".concat(this.id)),this.disconnect(),this._cleanup(),this._destroyed=!0,this.emit("close"))},e.prototype._cleanup=function(){var t,i;try{for(var s=Cm(this._connections.keys()),r=s.next();!r.done;r=s.next()){var o=r.value;this._cleanupPeer(o),this._connections.delete(o)}}catch(a){t={error:a}}finally{try{r&&!r.done&&(i=s.return)&&i.call(s)}finally{if(t)throw t.error}}this.socket.removeAllListeners()},e.prototype._cleanupPeer=function(t){var i,s,r=this._connections.get(t);if(r)try{for(var o=Cm(r),a=o.next();!a.done;a=o.next()){var c=a.value;c.close()}}catch(l){i={error:l}}finally{try{a&&!a.done&&(s=o.return)&&s.call(o)}finally{if(i)throw i.error}}},e.prototype.disconnect=function(){if(!this.disconnected){var t=this.id;lt.default.log("Disconnect peer with ID:".concat(t)),this._disconnected=!0,this._open=!1,this.socket.close(),this._lastServerId=t,this._id=null,this.emit("disconnected",t)}},e.prototype.reconnect=function(){if(this.disconnected&&!this.destroyed)lt.default.log("Attempting reconnection to server with ID ".concat(this._lastServerId)),this._disconnected=!1,this._initialize(this._lastServerId);else{if(this.destroyed)throw new Error("This peer cannot reconnect to the server. It has already been destroyed.");if(!this.disconnected&&!this.open)lt.default.error("In a hurry? We're still trying to make the initial connection!");else throw new Error("Peer ".concat(this.id," cannot reconnect because it is not disconnected from the server!"))}},e.prototype.listAllPeers=function(t){var i=this;t===void 0&&(t=function(s){}),this._api.listAllPeers().then(function(s){return t(s)}).catch(function(s){return i._abort(wn.ServerError,s)})},e.DEFAULT_KEY="peerjs",e}(qA.EventEmitter),tT=qU.Peer;const LX=Object.freeze(Object.defineProperty({__proto__:null,get Peer(){return eT},default:tT,util:bi},Symbol.toStringTag,{value:"Module"}));let FX;function UX(n,e){return e||(e={}),e={...FX,...e},n?new tT(n,e):new tT(e)}async function pD(){const n=await ux(()=>Promise.resolve().then(()=>LX),void 0,import.meta.url);return console.log(n),n.default===void 0?n:n.default}var iT;(function(n){n.ConnectionList="connection-list"})(iT||(iT={}));class NX{constructor(){u(this,"_host");u(this,"_client");u(this,"_clientData");this.onEnable()}get isHost(){return this._host!==void 0}onEnable(){const e="HOST-5980e65c-8438-453e-8b35-f13c736dcd81";this.trySetupHost(e)}async trySetupHost(e){const t=await pD(),i=new t(e);i.on("error",s=>{console.error(s),this._host=void 0,this.trySetupClient(e)}),i.on("open",s=>{this._host=new GX(i)})}async trySetupClient(e){const t=await pD();this._client=new t,this._client.on("error",i=>{console.error("Client error",i)}),this._client.on("open",i=>{console.log("client connected",i),this._clientData=this._client.connect(e,{metadata:{id:i}}),this._clientData.on("open",()=>{console.log("Connected to host")}),this._clientData.on("data",s=>{console.log("<<",s)})})}}class zX{constructor(e){u(this,"_peer");this._peer=e}}class GX extends zX{constructor(t){var i;super(t);u(this,"_connections",[]);console.log("I AM THE HOST"),(i=this._peer)==null||i.on("connection",this.onConnection.bind(this)),this._peer.on("close",()=>{this.broadcast("BYE")}),setInterval(()=>{this.broadcast("HELLO")},2e3)}get isHost(){return!0}onConnection(t){console.log("host connection",t),t.on("open",()=>{this._connections.push(t),this.broadcastConnection(t)})}broadcastConnection(t){const i=this._connections.map(s=>{var r;return(r=s.metadata)==null?void 0:r.id}).filter(s=>s!==void 0);this.broadcast({type:iT.ConnectionList,connections:i})}broadcast(t){if(t!=null){console.log(">>",t);for(const i in this._peer.connections){const s=this._peer.connections[i];if(s)if(Array.isArray(s))for(const r of s)r&&r.send(t);else console.warn(s)}}}}const mD="https://urls.needle.tools/default-networking-backend/index";let nh="wss://needle-tiny-starter.glitch.me/socket";const Rr=!!re("debugnet"),Ny=!!(Rr||re("debugowner")),gD=re("debugnetbin");var nT;(function(n){n.ConnectionInfo="connection-start-info"})(nT||(nT={}));var Xt;(function(n){n.Join="join-room",n.Leave="leave-room",n.JoinedRoom="joined-room",n.LeftRoom="left-room",n.UserJoinedRoom="user-joined-room",n.UserLeftRoom="user-left-room",n.RoomStateSent="room-state-sent"})(Xt||(Xt={}));var Us;(function(n){n.RequestHasOwner="request-has-owner",n.ResponseHasOwner="response-has-owner",n.RequestIsOwner="request-is-owner",n.ResponseIsOwner="response-is-owner",n.RequestOwnership="request-ownership",n.GainedOwnership="gained-ownership",n.RemoveOwnership="remove-ownership",n.LostOwnership="lost-ownership",n.GainedOwnershipBroadcast="gained-ownership-broadcast",n.LostOwnershipBroadcast="lost-ownership-broadcast"})(Us||(Us={}));class ZU{constructor(e,t){u(this,"guid");u(this,"connection");u(this,"_hasOwnership",!1);u(this,"_isOwned");u(this,"_gainSubscription");u(this,"_lostSubscription");u(this,"_hasOwnerResponse");u(this,"_isWaitingForOwnershipResponseCallback",null);this.connection=e,this.guid=t,this._gainSubscription=this.onGainedOwnership.bind(this),this._lostSubscription=this.onLostOwnership.bind(this),e.beginListen(Us.LostOwnership,this._lostSubscription),e.beginListen(Us.GainedOwnershipBroadcast,this._gainSubscription),this._hasOwnerResponse=this.onHasOwnerResponse.bind(this),e.beginListen(Us.ResponseHasOwner,this._hasOwnerResponse)}get hasOwnership(){return this._hasOwnership}get isOwned(){return this._isOwned}get isConnected(){return this.connection.isConnected}updateIsOwned(){this.connection.send(Us.RequestHasOwner,{guid:this.guid})}onHasOwnerResponse(e){e.guid===this.guid&&(this._isOwned=e.value)}requestOwnershipIfNotOwned(){return this._isWaitingForOwnershipResponseCallback!==null?this:(this._isWaitingForOwnershipResponseCallback=this.waitForHasOwnershipRequestResponse.bind(this),this.connection.beginListen(Us.ResponseHasOwner,this._isWaitingForOwnershipResponseCallback),this.connection.send(Us.RequestHasOwner,{guid:this.guid}),this)}waitForHasOwnershipRequestResponse(e){e.guid===this.guid&&(this._isWaitingForOwnershipResponseCallback&&(this.connection.stopListen(Us.ResponseHasOwner,this._isWaitingForOwnershipResponseCallback),this._isWaitingForOwnershipResponseCallback=null),this._isOwned=e.value,e.value||(Ny&&console.log("request ownership",this.guid),this.requestOwnership()))}requestOwnershipAsync(){return new Promise((e,t)=>{this.requestOwnership();let i=0;const s=()=>{if(i++>10)return t("Timeout");setTimeout(()=>{this.hasOwnership?e(this):s()},100)};s()})}requestOwnership(){return Ny&&console.log("Request ownership",this.guid),this.connection.send(Us.RequestOwnership,{guid:this.guid}),this}freeOwnership(){return this.connection.send(Us.RemoveOwnership,{guid:this.guid}),this._isWaitingForOwnershipResponseCallback&&(this.connection.stopListen(Us.ResponseHasOwner,this._isWaitingForOwnershipResponseCallback),this._isWaitingForOwnershipResponseCallback=null),this}destroy(){this.connection.stopListen(Us.GainedOwnership,this._gainSubscription),this.connection.stopListen(Us.LostOwnership,this._lostSubscription),this.connection.stopListen(Us.ResponseHasOwner,this._hasOwnerResponse),this._isWaitingForOwnershipResponseCallback&&(this.connection.stopListen(Us.ResponseHasOwner,this._isWaitingForOwnershipResponseCallback),this._isWaitingForOwnershipResponseCallback=null)}onGainedOwnership(e){e.guid===this.guid&&(this._isOwned=!0,this.connection.connectionId===e.owner?(Ny&&console.log("GAINED OWNERSHIP",this.guid),this._hasOwnership=!0):this._hasOwnership=!1)}onLostOwnership(e){e===this.guid&&(Ny&&console.log("LOST OWNERSHIP",this.guid),this._hasOwnership=!1,this._isOwned=!1)}}class VX{constructor(e){u(this,"context");u(this,"_peer",null);u(this,"_usersInRoomCopy",[]);u(this,"_defaultMessagesBuffer",[]);u(this,"_defaultMessagesBufferArray",[]);u(this,"netWebSocketUrlProvider");u(this,"_listeners",{});u(this,"_listenersBinary",{});u(this,"connected",!1);u(this,"channelId");u(this,"_connectionId",null);u(this,"_ws");u(this,"_waitingForSocket",{});u(this,"_isInRoom",!1);u(this,"_currentRoomName",null);u(this,"_currentRoomViewId",null);u(this,"_currentRoomAllowEditing",!0);u(this,"_currentInRoom",[]);u(this,"_state",{});u(this,"_currentDelay",-1);u(this,"_connectingToWebsocketPromise",null);this.context=e}get peer(){return this._peer||(this._peer=new NX),this._peer}tryGetState(e){return e==="invalid"?null:this._state[e]}get connectionId(){return this._connectionId}get isDebugEnabled(){return Rr}get isConnected(){return this.connected}get currentRoomName(){return this._currentRoomName}get allowEditing(){return this._currentRoomAllowEditing}get currentRoomViewId(){return this._currentRoomViewId}get isInRoom(){return this._isInRoom}get currentLatency(){return this._currentDelay}get currentServerUrl(){var e;return((e=this._ws)==null?void 0:e.url)??null}sendPing(){this.send("ping",{time:this.context.time.time})}userIsInRoom(e){return this._currentInRoom.indexOf(e)!==-1}usersInRoom(e=null){e||(e=this._usersInRoomCopy),e.length=0;for(const t of this._currentInRoom)e.push(t);return e}joinRoom(e,t=!1){return e?e.length>1024?(console.error('Room name too long, can not join: "'+e+'". Max length is 1024 characters.'),!1):(this.connect(),Rr&&console.log("join: "+e),this.send(Xt.Join,{room:e,viewOnly:t},ia.OnConnection),!0):(console.error('Missing room name, can not join: "'+e+'"'),!1)}leaveRoom(e=null){return e||(e=this.currentRoomName),e?(this.send(Xt.Leave,{room:e}),!0):(console.error('Missing room name, can not join: "'+e+'"'),!1)}send(e,t=null,i=ia.Queued){if(t===null&&(t={}),i===ia.Queued){this._defaultMessagesBuffer.push({key:e,value:t});return}return this.sendWithWebsocket(e,t,i)}sendDeleteRemoteState(e){this.send("delete-state",{guid:e,dontSave:!0}),delete this._state[e]}sendDeleteRemoteStateAll(){this.send("delete-all-state"),this._state={}}sendBinary(e){var t;gD&&console.log("<< send binary",this.context.time.frame,e.length/1024+" KB"),(t=this._ws)==null||t.send(e)}sendBufferedMessagesNow(){var i;if(!this._ws)return;this._defaultMessagesBufferArray.length=0;const e=Object.keys(this._defaultMessagesBuffer).length;for(const s in this._defaultMessagesBuffer){const r=this._defaultMessagesBuffer[s];if(e<=1){this.sendWithWebsocket(r.key,r.value,ia.Immediate);break}const o=this.toMessage(r.key,r.value);this._defaultMessagesBufferArray.push(o)}if(this._defaultMessagesBuffer.length=0,this._defaultMessagesBufferArray.length>0&&Rr&&console.log("SEND BUFFERED",this._defaultMessagesBufferArray.length),this._defaultMessagesBufferArray.length<=0)return;const t=JSON.stringify(this._defaultMessagesBufferArray);(i=this._ws)==null||i.send(t)}beginListen(e,t){return this._listeners[e]||(this._listeners[e]=[]),this._listeners[e].push(t),t}stopListening(e,t){return this.stopListen(e,t)}stopListen(e,t){if(!t||!this._listeners[e])return;const i=this._listeners[e].indexOf(t);i>=0&&this._listeners[e].splice(i,1)}beginListenBinary(e,t){return this._listenersBinary[e]||(this._listenersBinary[e]=[]),this._listenersBinary[e].push(t),t}stopListenBinary(e,t){if(!this._listenersBinary[e])return;const i=this._listenersBinary[e].indexOf(t);i>=0&&this._listenersBinary[e].splice(i,1)}registerProvider(e){this.netWebSocketUrlProvider=e}async connect(){var t;if(this.connected)return Promise.resolve(!0);Rr&&console.log("connecting");const e=(t=this.netWebSocketUrlProvider)==null?void 0:t.getWebsocketUrl();return e?nh=e:qW()&&(nh="wss://"+window.location.host+"/socket"),this.connectWebsocket()}disconnect(){var e;(e=this._ws)==null||e.close(),this._ws=void 0}connectWebsocket(){return this._connectingToWebsocketPromise?this._connectingToWebsocketPromise:this._connectingToWebsocketPromise=new Promise(async(e,t)=>{var c;let i=!1;const s=l=>{i||(i=!0,e(l))};if(nh===void 0&&(console.log("Fetch default backend url: "+mD),nh=await(await fetch(mD)).text()),nh===void 0){s(!1);return}console.log(` Connecting to networking backend on
`+nh);const r=await ux(()=>import("./index-d7be2e3b.js"),[],import.meta.url),o=((c=r.default)==null?void 0:c.WebsocketBuilder)??r.WebsocketBuilder,a=new o(nh).onOpen(()=>{this._connectingToWebsocketPromise=null,this._ws=a,this.connected=!0,console.log(` Connected to networking backend
`+nh),s(!0),this.onSendQueued(ia.OnConnection)}).onClose(l=>{this._connectingToWebsocketPromise=null,this.connected=!1,this._isInRoom=!1,s(!1)}).onError((l,h)=>{console.error(" Websocket error",l,h),s(!1)}).onRetry(()=>{console.log("Retry connecting to networking websocket")}).build();a.addEventListener(r.WebsocketEvent.message,(l,h)=>{this.onMessage(l,h)})})}onMessage(e,t){const i=t.data;try{if(typeof i!="string"){i.size&&this.handleIncomingBinaryMessage(i);return}const s=JSON.parse(i);if(Array.isArray(s))for(const r of s)this.handleIncomingStringMessage(r);else this.handleIncomingStringMessage(s);return}catch(s){Rr&&i==="pong"?console.log("<<",i):Tt()&&console.error("Failed to parse message",s)}}async handleIncomingBinaryMessage(e){gD&&console.log("<< bin",this.context.time.frame);const t=await e.arrayBuffer();var i=new Uint8Array(t);const s=new lA(i),r=s.getBufferIdentifier(),o=this._listenersBinary[r],a=eX(s),c=tX(a);if(c&&typeof c=="string"&&(this._state[c]=a),!o)return;const l=a??s;for(const h of o)h(l)}handleIncomingStringMessage(e){var s,r;if(Rr&&console.log("<<",e.key??e),e.key)switch(e.key){case nT.ConnectionInfo:if(e.data){const c=e.data;c&&(console.assert(c.id!==void 0&&c.id!==null&&c.id.length>0,"server did not send connection id",c.id),console.log("Your id is: "+c.id,this.context.alias??""),this._connectionId=c.id)}else console.warn("Expected connection id in "+e.key);break;case Xt.JoinedRoom:if(Rr&&console.log(e),e){this._isInRoom=!0;const c=e;this._currentRoomName=c.room,this._currentRoomViewId=c.viewId,this._currentRoomAllowEditing=c.allowEditing??!0,this._currentInRoom.length=0,this._currentInRoom.push(...c.inRoom),Rr&&console.log("joined room with",this._currentInRoom,this.context.alias??"");const l=new URL(window.location.href);l.searchParams.has("room")&&l.searchParams.delete("room"),l.searchParams.set("view",this._currentRoomViewId),console.log("Room view id: "+this._currentRoomViewId+`
`+l.href)}this.onSendQueued(ia.OnRoomJoin);break;case Xt.LeftRoom:e.room===this.currentRoomName&&(this._isInRoom=!1,this._currentRoomName=null,this._currentInRoom.length=0);break;case Xt.UserJoinedRoom:if(e.data){const c=e.data;this._currentInRoom.push(c.userId),Rr&&console.log(c.userId+" joined","now in room:",this._currentInRoom)}break;case Xt.UserLeftRoom:if(e.data){const c=e.data,l=this._currentInRoom.indexOf(c.userId);l>=0&&(Rr&&console.log(c.userId+" left","now in room:",this._currentInRoom),this._currentInRoom.splice(l,1)),c.userId===this.connectionId&&console.log("you left the room")}break;case"all-room-state-deleted":Rr&&console.log("RECEIVED all-room-state-deleted"),this._state={};break;case"ping":case"pong":const a=(s=e.data)==null?void 0:s.time;a&&(this._currentDelay=this.context.time.time-a),Rr&&console.log("Current latency: "+this._currentDelay.toFixed(1)+" sec","Clients in room: "+((r=this._currentInRoom)==null?void 0:r.length));break}let t=this._listeners[e.key];if(t){t=[...t];for(const o of t)try{o(e.data)}catch(a){console.error('Error invoking callback for "'+e.key+'"',a)}}const i=e.data;i&&(this._state[i.guid]=i)}toMessage(e,t){return{key:e,data:t}}sendWithWebsocket(e,t,i=ia.OnRoomJoin){if(!this._ws){const r=this._waitingForSocket[i]||[];r.push(()=>this.sendWithWebsocket(e,t,i)),this._waitingForSocket[i]=r;return}const s=JSON.stringify(this.toMessage(e,t));Rr&&console.log(">>",e),this._ws.send(s)}onSendQueued(e){const t=this._waitingForSocket[e];if(t){for(const i of t)i();t.length=0}}}var ua={};ua.d=(n,e)=>{for(var t in e)ua.o(e,t)&&!ua.o(n,t)&&Object.defineProperty(n,t,{enumerable:!0,get:e[t]})};ua.o=(n,e)=>Object.prototype.hasOwnProperty.call(n,e);ua.r=n=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(n,"__esModule",{value:!0})};var Fn={};ua.d(Fn,{w8:()=>Ci,cg:()=>g3,gO:()=>mA,wb:()=>_1,zV:()=>md,HS:()=>XA,Ec:()=>xd,gF:()=>bp,ol:()=>AA,pz:()=>uN,tx:()=>Co,hj:()=>x1,FV:()=>ZA,sV:()=>ZN,xv:()=>gA,mx:()=>cN,gE:()=>lN,ZP:()=>OK,Vx:()=>A3});var _1={};ua.r(_1);ua.d(_1,{get:()=>$U,set:()=>HX});var x1={};ua.r(x1);ua.d(x1,{alphaTestTransformer:()=>px,asPreprocessorValueTransformer:()=>dN,toPreprocessorTriggerTransformer:()=>D1,toUserDataTransformer:()=>e7,uniformOrUserDataTransformer:()=>xo});const sT={fontFamily:null,fontSize:.05,fontKerning:"auto",fontStyle:"normal",fontWeight:"normal",offset:.005,lineHeight:1.2,lineBreak:`- ,.:?!
`,whiteSpace:"pre-line",flexDirection:"column",justifyContent:"start",alignItems:"start",backgroundImage:null,textAlign:"left",boxSizing:"content-box",position:"static",color:16777215,fontColor:16777215,fontOpacity:1,opacity:1,fontPXRange:4,fontSupersampling:!0,fontSmooth:"antialiased",borderRadius:0,borderWidth:0,borderColor:"black",borderOpacity:1,backgroundSize:"cover",backgroundColor:0,backgroundOpacity:0,overflow:"visible",letterSpacing:0,invertAlpha:!1,segments:1},HX=function(n){for(const e in n)sT[e]=n[e]},$U=function(n){return Object.prototype.hasOwnProperty.call(sT,n)||console.warn(`ThreeMeshUI::DefaultValues is trying to retrieve non-existing property '${n}'`),sT[n]};class Ci{constructor(e,t=null,i=!0){this._id=e,this._value=t,this._needsUpdate=!0,this._needsProcess=!1,this._needsRender=!1,this._isPrimitive=i}get id(){return this._id}get value(){return this._value}set value(e){this.isValid(e)&&this._value!==e&&(this._value=e,this._needsUpdate=!0)}update(e,t){this.output(t)}output(e){}_outputValue(e){e[this._id]=this._value}process(e){}render(e){}getInheritedInput(e){if(this._value!=="inherit")return this._value;const t=e._parent._value;return t&&t[`_${this._id}`]?t[`_${this._id}`].getInheritedInput(t):this.getDefaultValue()}getDefaultValue(){return $U(this._id)}isValid(e){return!0}emptyStrategyLogic(){throw new Error(`ThreeMeshUI::${this.constructor.name} has empty strategy. Update has not been processed.`)}requestUpdate(){this._needsUpdate=!0}requestProcess(){this._needsProcess=!1}requestRender(){this._needsRender=!1}}class QX extends Ci{constructor(){super("renderOrder","auto",!0),this.output=this._outputValue,this._actualValue=0}set value(e){this.isValid(e)&&(this._value=e,this._needsUpdate=!0)}update(e,t){if(this._value!=="auto")this._actualValue=this._value;else{const i=e._parent._value;if(i!==null){const s=i._renderOrder._actualValue,r=1+i._children._uis.indexOf(e);this._actualValue=s+r}}for(const i of e._children._uis)i._renderOrder._value==="auto"&&(i._renderOrder._needsUpdate=!0);this._outputValue(t)}_outputValue(e){e[this._id]=this._actualValue}get value(){return this._value}}class xd extends Ci{constructor(e,t=null,i=!0){super(e,t,i),this.output=this._outputValue,this._notInheritedValue=null}update(e,t){this._notInheritedValue=this._value,this._notInheritedValue==="inherit"&&(this._notInheritedValue=this.getInheritedInput(e)),this.propagate(e),this._outputValue(t)}propagate(e){for(const t of e._children._uis){const i=t[`_${this._id}`];i!==void 0&&i._value==="inherit"&&(t[`_${this._id}`]._needsUpdate=!0)}}_outputValue(e){e[this._id]=this._notInheritedValue}set value(e){this.isValid(e)&&this._value!==e&&(this._value=e,this._needsUpdate=!0)}get value(){return this._value==="inherit"?this._notInheritedValue:this._value}}class jX extends xd{constructor(){super("offset","inherit",!1)}update(e,t){super.update(e,t),e._parent._value!==null&&(e.position.z=this._notInheritedValue)}}class WX extends xd{constructor(){super("fontSmooth","inherit",!0),this._needsUpdate=!1,this.isValid=XX,this.output=this._outputValue}}const qX=["inherit","none","antialiased"];function XX(n){return qX.indexOf(n)===-1?(console.warn(`.fontSmoothing value '${n}' is not valid. Aborted`),!1):!0}var YX=n=>{var e={};return ua.d(e,n),e};const We=YX({BackSide:()=>mn,BufferAttribute:()=>it,BufferGeometry:()=>gt,Color:()=>ye,DoubleSide:()=>Ai,EventDispatcher:()=>ls,FileLoader:()=>Hn,FrontSide:()=>Es,LinearFilter:()=>St,Mesh:()=>me,MeshBasicMaterial:()=>ri,Object3D:()=>ge,Plane:()=>hr,PlaneGeometry:()=>Wn,ShaderMaterial:()=>Et,Texture:()=>Ft,TextureLoader:()=>dl,Vector2:()=>ie,Vector3:()=>w,Vector4:()=>tt});class Zi extends Ci{constructor(e,t,i=!0){super(e,"unset",i),this._input="inherit",this._allowsInherit=!0,this._inheritedInput=void 0,this._inline=void 0}update(e,t){this._allowsInherit||(this._inheritedInput=this.getInheritedInput(e)),this.computeOutputValue(e);for(const i of e._children._uis){const s=i[`_${this._id}`];(s._input?s._input:s._value)==="inherit"&&(i[`_${this._id}`]._needsUpdate=!0)}this.output(t)}computeOutputValue(e){this._value=this._input}_computeFromInherited(e){this._value=this._inheritedInput}set value(e){console.warn(".(style) sub-property cannot be directly set. It must comes from inline or computed setter.")}set inline(e){this.isValidValue(e)&&e!==this._inline&&(this._input=this._inline=e,this._needsUpdate=!0)}get inline(){return this._inline}isValidValue(e){return!0}getInheritedInput(e){if(this._input!=="inherit")return this._input;const t=e._parent._value;return t?t[`_${this._id}`].getInheritedInput(t):this.getDefaultValue()}}class fx extends Zi{constructor(e,t){super(e,t,!1),this._input=new We.Vector4(0,0,0,0),this._inline=null,this._value=new We.Vector4(0,0,0,0)}get value(){return this._value}computeOutputValue(e){this._vector4ValueSetter(this._value,this._input)}set inline(e){this._vector4ValueSetter(this._input,e),!this._input.equals(this._value)&&(this._needsUpdate=!0)}set top(e){this._input.x!==e&&(this._input.x=e,this._needsUpdate=!0)}get top(){return this._input.x}set right(e){this._input.y!==e&&(this._input.y=e,this._needsUpdate=!0)}get right(){return this._input.y}set bottom(e){this._input.z!==e&&(this._input.z=e,this._needsUpdate=!0)}get bottom(){return this._input.z}set left(e){this._input.w!==e&&(this._input.w=e,this._needsUpdate=!0)}get left(){return this._input.w}dispose(){this._computed=null,this._inline=null,this._input=null,this._output=null}_vector4ValueSetter(e,t){if(t instanceof We.Vector4){e.copy(t);return}if((typeof t=="string"||t instanceof String)&&(t=t.split(" ")),Array.isArray(t))switch(t=t.map(i=>parseFloat(i)),t.length){case 1:e.setScalar(t[0]);return;case 2:e.x=e.z=t[0],e.y=e.w=t[1];return;case 3:e.x=t[0],e.y=t[1],e.z=t[2];return;case 4:e.x=t[0],e.y=t[1],e.z=t[2],e.w=t[3];return;default:console.error("StyleVector4Property::set() Four Dimension property had more than four values");return}isNaN(t)||e.setScalar(t)}}class JX extends fx{constructor(){super("padding",new We.Vector4(0,0,0,0))}computeOutputValue(e){super.computeOutputValue(e),e._bounds._needsUpdate=!0,e._bounds._needsRender=!0,e._layouter._needsProcess=!0,e._renderer._needsRender=!0,e._parent._value&&(e._parent._value._layouter._needsProcess=!0)}}class KX extends fx{constructor(){super("margin",new We.Vector4(0,0,0,0))}computeOutputValue(e){super.computeOutputValue(e),e._renderer._needsRender=!0,e._parent._value&&(e._parent._value._flexDirection._needsProcess=!0)}}const AD=function(n,e,t){n[e]=t},ZX=function(n,e,t){t!==null&&(n[e]=t)};class zy{constructor(e){this._definition=e}set definition(e){this._definition=e}mediate(e,t,i,s=null){for(const r in this._definition){const o=this._definition[r];if(i[r]!==void 0){const a=o.t?o.t:AD;a(t,o.m,i[r]),s&&a(s,o.m,i[r])}}}static mediate(e,t,i,s,r=null){if(t)for(const o in s){const a=s[o];if(i[o]!==void 0){const c=a.t?a.t:AD;c(t,a.m,i[o]),r&&c(r,a.m,i[o])}}}}class $X extends Ci{constructor(){super("parent",null,!1)}update(e,t){e.parent&&e.parent.isUI?this._value=e.parent:this._value=null}set value(e){console.warn("ParentProperty is readonly")}get value(){return this._value}find(e){return this._value?e(this._value)?this._value:this._value._parent.find(e):null}dispose(){this._value=null}}const rT=function(n,e,t=6){return n.toFixed(t)===e.toFixed(t)};class vD extends Ci{constructor(e,t){super(e,t,!0),this.output=this._outputValue}set value(e){this.isValid(e)&&(rT(this._value,e)||(this._value=e,this._needsUpdate=!0))}get value(){return this._value}}class yD extends xd{constructor(e){super(e,"inherit",!0),this.isValid=tY}}const eY=[We.FrontSide,We.BackSide,We.DoubleSide];function tY(n){return eY.indexOf(n)===-1?(console.warn(`SideProperty value '${n}' is not valid. Abort`),!1):!0}const iY={light:"100",normal:"400",bold:"700",bolder:"900"};function w1(n){if(!isNaN(n))return n.toString();const e=iY[n];return e||n}class nY extends We.EventDispatcher{constructor(e,t){super(),this._isReady=!1,this._weight=w1(e),this._style=t,this._size=42,this._lineHeight=42,this._lineBase=42,this._font=null}get typographic(){return this._font}get isReady(){return this._isReady}get weight(){return this._weight}get style(){return this._style}get texture(){return this._texture}set fontMaterial(e){throw Error(`FontVariant('${this.id}')::fontMaterial - is abstract.`)}get fontMaterial(){throw Error(`FontVariant('${this.id}')::fontMaterial - is abstract.`)}get id(){return`${this._name}(w:${this.weight},s:${this.style})`}getTypographicGlyph(e){let t=this._chars[e];if(t)return t;if(e.match(/\s/))return this._chars[" "];const i=this._getFallbackCharacter(e);if(i&&(t=this._chars[i],t))return t;throw Error(`FontVariant('${this.id}')::getTypographicGlyph() - character('${e}') and/or fallback character were not found in provided msdf charset.`)}_getFallbackCharacter(e){throw new Error(`FontVariant(${typeof this})::_getFallbackCharacter() is abstract and should therefore be overridden.`)}getGeometricGlyph(e,t){throw new Error(`FontVariant(${typeof this})::getGeometryCharacter() is abstract and should therefore be overridden.`)}getKerningAmount(e){return this._kernings[e]?this._kernings[e]:0}adjustTypographicGlyphs(e){for(const t in e){const i=this.getTypographicGlyph(t),s=e[t];for(const r in s)i["_"+r]=e[t][r]}}_checkReadiness(){this._readyCondition()&&rY(this)}_alterElementProperties(e){throw new Error(`FontVariant(${typeof this})::_alterElementProperties() is abstract and should therefore be overridden.`)}_readyCondition(){throw new Error(`FontVariant(${typeof this})::_readyCondition() is abstract and should therefore be overridden.`)}}const sY={type:"ready"};function rY(n){n._isReady=!0,n.dispatchEvent(sY)}const XA=nY;class oY extends Ci{constructor(e=null){super("font",e,!1),this._needsUpdate=!1,this._fontVariant=null,this._handleFontReadyClosure=null,this.isValid=aY}output(e){e[this._id]=this._fontVariant}update(e,t){if(this._fontVariant&&!this._fontVariant.isReady&&this._fontVariant.removeEventListener("ready",this._handleFontReadyClosure),this._value&&this._value instanceof XA)this._fontVariant=this._value;else{const i=e._fontFamily._value;i&&(this._fontVariant=i.getVariant(e._fontWeight._value,e._fontStyle._value))}this._fontVariant&&(this._fontVariant._alterElementProperties(e),this._handleFontReadyClosure=cY(e,this),this._fontVariant.isReady?this._handleFontReadyClosure():this._fontVariant.addEventListener("ready",this._handleFontReadyClosure),(!e._fontMaterial._defaultMaterial||!(e._fontMaterial._defaultMaterial instanceof this._fontVariant.fontMaterial))&&(e._fontMaterial._defaultMaterial=new this._fontVariant.fontMaterial,e._fontMaterial._needsUpdate=!0))}set value(e){this.isValid(e)&&this._value!==e&&(this._value=e,this._needsUpdate=!0)}get value(){return this._value}get fontVariant(){return this._fontVariant}dispose(){this._handleFontReadyClosure&&(this._fontVariant.removeEventListener("ready",this._handleFontReadyClosure),this._handleFontReadyClosure=null),this._value=null,this._fontVariant=null}}function aY(n){return n instanceof XA?!0:(console.warn(`.font value '${n}' is not valid. It requires a FontVariant instance. Aborted`),!1)}function cY(n,e){return function(){e._needsUpdate=!0,n._glyphs._needsProcess=!0,e._fontVariant.removeEventListener("ready",e._handleFontReadyClosure),e._handleFontReadyClosure=null}}class lY extends Zi{constructor(e){super("display",e),this._value="flex",this._allowsInherit=!1,this._needsUpdate=!1,this.isValidValue=uY}computeOutputValue(e){e._visible._value=this._output!=="none"}}const hY=["none","flex"];function uY(n){return hY.indexOf(n)===-1?(console.warn(`(.style) display value '${n}' is not valid. Aborted`),!1):!0}class dY extends Zi{constructor(e){super("boxSizing",e),this._allowsInherit=!1,this.isValidValue=pY}computeOutputValue(e){this._value=this._inheritedInput,e._bounds._needsUpdate=!0}}const fY=["border-box","content-box"];function pY(n){return fY.indexOf(n)===-1?(console.warn(`(.style) boxSizing value '${n}' is not valid. Aborted`),!1):!0}class uA extends Zi{constructor(e,t){super(e,t,!1),this._value=new We.Color,this.output=this._outputValue}computeOutputValue(e){this._input!=="inherit"&&this._value.set(this._input)}set inline(e){this._input=this._inline=e,this._needsUpdate=!0}}class MS extends Zi{constructor(e,t){super(e,t,!0),this.isValidValue=mY,this._allowsInherit=!1,this._input=t,this._value=t,this.output=this._outputValue,this.computeOutputValue=this._computeFromInherited}_outputValue(e){e[this._id]=this._inheritedInput}}function mY(n){return n<0&&n>1?(console.warn(`(.style) styleFactorProperty('${this.id}') value '${n}' is not valid)`),!1):!0}class gY extends Zi{constructor(e){super("backgroundImage",e,!0),this._input=null,this._allowsInherit=!1,this._textureSize=new We.Vector2(1,1),this.isValidValue=AY}get value(){return this._value}output(e){e[this._id]=this._value,e.tSize=this._textureSize}computeOutputValue(e){if(this._value=this._inheritedInput,this._value instanceof We.Texture&&!this._value.image){console.warn("ThreeMeshUI - .backgroundImage :: Please provide preloaded texture in order to have accurate sizing.");return}this._needsProcess=!0}process(e){this._value?this._textureSize.set(this._value.image.width,this._value.image.height):this._textureSize.set(1,1)}}function AY(n){return!0}class vY extends Zi{constructor(e){super("backgroundSize",e,!0),this.isValidValue=bY,this.output=this._outputValue}}const yY=["cover","contain","stretch"];function bY(n){return yY.indexOf(n)===-1?(console.warn(`(.style) backgroundSize value '${n}' is not valid. Aborted`),!1):!0}class _Y extends Zi{constructor(e){super("overflow",e,!0),this.isValidValue=wY,this._clippingPlanes=null,this._renderStrategy=this._emptyRender}update(e,t){this._inline!==void 0&&this._inline!=="unset"?this._input=this._inline:this._computed!==void 0&&(this._input=this._computed),this._allowsInherit||(this._inheritedInput=this.getInheritedInput(e)),this.computeOutputValue(e);for(const i of e._children._uis)i._overflow._needsUpdate=!0;this.output(t)}output(e){e.clippingPlanes=this._clippingPlanes}computeOutputValue(e){super.computeOutputValue(e),this._value==="hidden"?this._renderStrategy=this._propagateRender:(this._renderStrategy=this._emptyRender,this._clippingPlanes=null);const t=e._parent._value;if(t!==null){const i=t._overflow;if((i._value==="hidden"||i._clippingPlanes!==null)&&!this._clippingPlanes){this._clippingPlanes=[new We.Plane(new We.Vector3(0,-1,0),1),new We.Plane(new We.Vector3(-1,0,0),1),new We.Plane(new We.Vector3(0,1,0),1),new We.Plane(new We.Vector3(1,0,0),1)];for(let s=0;s<this._clippingPlanes.length;s++)this._clippingPlanes[s].parent=t;i._clippingPlanes!==null&&this._clippingPlanes.push(...i._clippingPlanes),this._renderStrategy=this._hiddenRender,this._needsRender=!0}else(i._value==="visible"||i._clippingPlanes===null)&&this._clippingPlanes!==null&&(this._clippingPlanes=null,this._renderStrategy=this._emptyRender,this._needsRender=!0)}}render(e){this._renderStrategy(e)}_emptyRender(e){}_hiddenRender(e){const t=e._parent._value,i=t._bounds._offsetHeight,s=t._bounds._offsetWidth,r=t._padding._value,o=t._borderWidth._value;for(let a=0;a<4&&a<this._clippingPlanes.length;a++){const c=this._clippingPlanes[a];switch(a%4){case 0:c.constant=i/2-(r.x+o.x);break;case 1:c.constant=s/2-(r.y+o.y);break;case 2:c.constant=i/2-(r.z+o.z);break;case 3:c.constant=s/2-(r.w+o.w);break}c.applyMatrix4(t.matrixWorld)}for(let a=0;a<e._children._uis.length;a++){const c=e._children._uis[a];c._overflow._needsRender=!0}}_propagateRender(e){for(let t=0;t<e._children._uis.length;t++){const i=e._children._uis[t];i._overflow._needsRender=!0}}}const xY=["visible","hidden"];function wY(n){return xY.indexOf(n)===-1?(console.warn(`(.style) overflow value '${n}' is not valid. Aborted`),!1):!0}const vp="rem",eN="em",wb="%",SY=[vp,eN,wb],tN=function(n){return SY.indexOf(n)===-1?vp:n};class CY extends fx{constructor(e){super("borderRadius",e),this._valueUV=this._value.clone(),this._input=new We.Vector4(0,0,0,0),this._mediation=!0,this._cornerTL=new We.Vector2(0,1),this._cornerTR=new We.Vector2(1,1),this._cornerBR=new We.Vector2(1,0),this._cornerBL=new We.Vector2(0,0);const t=new Gy(this._valueUV,["x","y"]),i=new Gy(this._valueUV,["z","w"]),s=new Gy(this._valueUV,["x","w"]),r=new Gy(this._valueUV,["y","z"]);t.complementaryMediation=i,i.complementaryMediation=t,s.complementaryMediation=r,r.complementaryMediation=s,this._sideMediators=[t,i,s,r],this._units=vp}set units(e){this._units=tN(e),this._needsProcess=!0}get units(){return this._units}set mediation(e){e!==this._mediation&&(this._mediation=e,this._needsUpdate=!0)}get mediation(){return this._mediation}output(e){e.cornerTL=this._cornerTL,e.cornerTR=this._cornerTR,e.cornerBR=this._cornerBR,e.cornerBL=this._cornerBL}computeOutputValue(e){this._vector4ValueSetter(this._value,this._input),this._needsProcess=!0}process(e){this._needsRender=!0}render(e){this._valueUV.copy(this._value);const t=e._bounds._offsetWidth,i=e._bounds._offsetHeight;if(this._units===wb&&this._valueUV.divideScalar(100),this._units===vp&&this._valueUV.divideScalar(Math.min(t,i)),this._mediation)do this._sideMediators.forEach(o=>o.computeValue()),this._sideMediators.sort((o,a)=>o.value<a.value?1:-1),this._sideMediators[0].value>1&&this._sideMediators[0].mediate();while(this._sideMediators[0].value>1);let s=t>i?i/t:1,r=t<i?t/i:1;this._units===wb&&(s=r=1),this._cornerTL.x=this._valueUV.x*s,this._cornerTL.y=1-this._valueUV.x*r,this._cornerTR.x=1-this._valueUV.y*s,this._cornerTR.y=1-this._valueUV.y*r,this._cornerBR.x=1-this._valueUV.z*s,this._cornerBR.y=this._valueUV.z*r,this._cornerBL.x=this._valueUV.w*s,this._cornerBL.y=this._valueUV.w*r}dispose(){for(const e of this._sideMediators)e.dispose();this._sideMediators=null,this._cornerTL=null,this._cornerTR=null,this._cornerBR=null,this._cornerBL=null,super.dispose()}set topLeft(e){this._input.x!==e&&(this._input.x=e,this._needsUpdate=!0)}get topLeft(){return this._input.x}set topRight(e){this._input.y!==e&&(this._input.y=e,this._needsUpdate=!0)}get topRight(){return this._input.y}set bottomRight(e){this._input.z!==e&&(this._input.z=e,this._needsUpdate=!0)}get bottomRight(){return this._input.z}set bottomLeft(e){this._input.w!==e&&(this._input.w=e,this._needsUpdate=!0)}get bottomLeft(){return this._input.w}set top(e){this._input.x===e&&this._input.y===e||(this._input.x=this._input.y=e,this._needsUpdate=!0)}get top(){return(this._input.x+this._input.y)/2}set right(e){this._input.y===e&&this._input.z===e||(this._input.y=this._input.z=e,this._needsUpdate=!0)}get right(){return(this._input.y+this._input.z)/2}set bottom(e){this._input.z===e&&this._input.w===e||(this._input.z=this._input.w=e,this._needsUpdate=!0)}get bottom(){return(this._input.z+this._input.w)/2}set left(e){this._input.w===e&&this._input.x===e||(this._input.w=this._input.x=e,this._needsUpdate=!0)}get left(){return(this._input.w+this._input.x)/2}}class Gy{constructor(e,t){this._borderRadiuses=e,this._sideProperties=t,this._complementaryMediation=null,this._value=0}get value(){return this._value}set complementaryMediation(e){this._complementaryMediation=e}computeValue(){let e=0;for(const t of this._sideProperties)e+=this._borderRadiuses[t];this._value=e}mediate(e=!0){if(!(this._value<1)){for(const t of this._sideProperties)this._borderRadiuses[t]/=this._value;e&&this._complementaryMediation.mediate(!1)}}dispose(){this._complementaryMediation=null,this._borderRadiuses=null}}class EY extends fx{constructor(e){super("borderWidth",e,!1),this._valueUV=this._value.clone(),this.output=this._outputValue,this._units=vp}set units(e){this._units=tN(e),this._needsUpdate=!0}get units(){return this._units}computeOutputValue(e){this._vector4ValueSetter(this._value,this._input),this._needsProcess=!0,e._bounds._needsUpdate=!0,e._layouter._needsUpdate=!0}_outputValue(e){e[this._id]=this._valueUV}process(e){this._needsRender=!0,e._borderRadius._needsRender=!0}render(e){this._valueUV.copy(this._value);const t=e._bounds._offsetWidth,i=e._bounds._offsetHeight;if(this._units===wb&&(console.log("Percent"),console.log(this._valueUV)),this._units===vp)t!==0&&(this._valueUV.w/=t,this._valueUV.y/=t),i!==0&&(this._valueUV.x/=i,this._valueUV.z/=i);else if(this._units===eN){if(t!==0){const s=t>i?i/t:1;this._valueUV.y*=s,this._valueUV.w*=s}if(i!==0){const s=t<i?t/i:1;this._valueUV.x*=s,this._valueUV.z*=s}}}}class TY extends Ci{constructor(e,t=!0){super("visible",t,!0),this._needsUpdate=!1}update(e,t){e.visible=this._value,e._parent._value&&(e._parent._value._children._needsUpdate=!0)}set value(e){this.isValid(e)&&this._value!==e&&(this._value=e,this._needsUpdate=!0)}get value(){return this._value}}class iN extends uA{constructor(e){super("backgroundColor",e,!1),this._input="transparent",this._allowsInherit=!1}computeOutputValue(e){e._backgroundMesh.visible=!(this._input==="none"||this._input==="transparent"),this._input==="inherit"?this._value.set(this.getInheritedInput(e)):this._input==="transparent"||this._input==="none"||this._value.set(this._input)}}class Nc extends Ci{constructor(e="untitled"){super(e,void 0,!1)}update(e,t){}output(e){}}class MY extends Ci{constructor(){super("inlineJustificator",null,!1),this._value=null}update(e,t){}process(e){const t=e._bounds._innerHeight,i=e._layouter._value,s=Math.abs(i.height);let r=(()=>{switch(e._alignItems._value){case"inherit":case"start":return t/2;case"end":return s-t/2;case"stretch":case"center":return s/2}})();const o=e._padding._value,a=e._borderWidth._value;r+=(-o.x+o.z)/2+(-a.x+a.z)/2,i.forEach(c=>{c.y+=r,c.forEach(l=>{l.offsetY+=r})})}}const IY=["start","center","end","stretch"],RY=function(n){return IY.indexOf(n)===-1?(console.warn(`(.style) alignItems value '${n}' is not valid. Aborted`),!1):!0};class S1 extends Zi{constructor(){super("alignItems","inherit",!0),this.isValidValue=RY}}class C1 extends Zi{constructor(){super("textAlign","inherit",!0),this.isValidValue=BY}}const PY=["left","right","center","justify","justify-left","justify-right","justify-center"],BY=function(n){return PY.indexOf(n)===-1?(console.warn(`(.style) textAlign value '${n}' is not valid. Aborted`),!1):!0};class E1 extends Zi{constructor(){super("flexDirection","inherit",!0),this.isValid=OY}}const DY=["row","row-reverse","column","column-reverse"];function OY(n){return DY.indexOf(n)===-1?(console.warn(`(.style) flexDirection value '${n}' is not valid. Aborted`),!1):!0}class T1 extends Zi{constructor(){super("justifyContent","inherit",!0),this.isValidValue=LY}}const kY=["start","center","end","space-between","space-around","space-evenly"];function LY(n){return kY.indexOf(n)===-1?(console.warn(`(.style) justifyContent value '${n}' is not valid. Aborted`),!1):!0}class FY extends Zi{constructor(){super("order",0,!0),this._value=0,this._input=0,this._allowsInherit=!1}computeOutputValue(e){this._value=this._inheritedInput,e._parent._value&&(e._parent._value._children._needsProcess=!0)}}class nN extends Zi{constructor(){super("position","static",!0),this._allowsInherit=!1,this._value="static",this._needsUpdate=!1,this.computeOutputValue=this._computeFromInherited,this.isValidValue=NY}_computeFromInherited(e){super._computeFromInherited(e),e._parent._value&&(e._parent._value._children._needsProcess=!0)}}const UY=["static","absolute"];function NY(n){return UY.indexOf(n)===-1?(console.warn(`(.style) position value '${n}' is not valid. Aborted`),!1):!0}class sN extends Zi{constructor(e,t=null){super(e,t,!0),this._input="auto",this._auto=!0,this._relative=!1,this._updateRequired=!0}set inline(e){this.isValidValue(e)&&e!==this._inline&&(this._inline=e,this._input!==this._inline&&this._parseInput())}get inline(){return this._inline}_parseInput(){let e=!0;if(this._inline!==void 0&&this._inline!=="unset"?this._input=this._inline:this._computed!==void 0?(this._computed===this._input&&(e=!1),this._input=this._computed):e=this._input==="inherit",e){if(this._auto=!this._input||this._input==="auto",this._auto)this._relative=!1;else if((typeof this._input=="string"||this._input instanceof String)&&this._input.endsWith("%")){this._relative=!0,this._value=0;const t=parseFloat(this._input.replace("%","").trim());isNaN(t)||(this._value=t/100)}else this._relative=!1,this._value=this._input;this._needsUpdate=this._updateRequired=e}}update(e,t){if(this._updateRequired){this._updateRequired=!1,this._allowsInherit||(this._inheritedInput=this.getInheritedInput(e)),this.computeOutputValue(e);for(const i of e._children._uis)i[`_${this._id}`]._needsUpdate=!0;this.output(t),e._parent._value&&(e._parent._value._layouter._needsProcess=!0)}}computeOutputValue(e){e._bounds._needsUpdate=!0,e._renderer._needsRender=!0}getInheritedInput(e){if(this._input!=="inherit"&&!this._auto)return this._input;const t=e._parent._value;return t?t[`_${this._id}`].getInheritedInput(t):this.getDefaultValue()}getDefaultValue(){return 0}get value(){return this._value}}class zY extends sN{constructor(){super("width")}}class GY extends sN{constructor(){super("height")}computeOutputValue(e){super.computeOutputValue(e)}}class rN extends Nc{constructor(){super("textContent"),this._needsUpdate=!1}set value(e){}process(e){let t="";for(let i=0;i<e.children.length;i++){const s=e.children[i];s.isUI&&(t+=s.textContent)}this._value=t}}class oN extends Zi{constructor(e){super("fontStyle",e,!0),this.isValidValue=HY}}const VY=["normal","italic"];function HY(n){return VY.indexOf(n)===-1?(console.warn(`(.style) fontStyle value '${n}' is not valid. Aborted`),!1):!0}class aN extends Zi{constructor(){super("fontWeight","inherit",!0),this.isValid=jY}}const QY=["100","200","300","400","500","600","700","800","900","light","normal","bold","bolder"];function jY(n){return QY.indexOf(n.toString())===-1?(console.warn(`(.style) fontWeight value '${n}' is not valid. Aborted`),!1):!0}class cN{constructor(){this._size=42,this._lineHeight=42,this._lineBase=38,this._name="-",this._charset=""}get size(){return this._size}get lineHeight(){return this._lineHeight}get lineBase(){return this._lineBase}get name(){return this._name}get charset(){return this._charset}}class WY extends cN{constructor(e){super(),this._size=e.info.size,this._lineHeight=e.common.lineHeight,this._lineBase=e.common.base,this._name=e.info.face,this._textureWidth=e.common.scaleW,this._textureHeight=e.common.scaleH,this._charset=e.chars.map(t=>t.char).join("")}get textureWidth(){return this._textureWidth}get textureHeight(){return this._textureHeight}}class lN{constructor(e){this._char="",this._width=1,this._heigth=1,this._xadvance=1,this._xoffset=0,this._yoffset=0,this._font=e}get font(){return this._font}get char(){return this._char}get width(){return this._width}get height(){return this._heigth}get xadvance(){return this._xadvance}get xoffset(){return this._xoffset}get yoffset(){return this._yoffset}set yoffset(e){this._yoffset=e}clone(e){throw new Error("Abstract... Need to be implemented")}asInlineGlyph(){throw new Error("Abstract... Need to be implemented")}}class hN{constructor(){this._offsetX=0,this._offsetY=0,this._lineBreak=null,this._kerning=0,this._fontFactor=1,this._fontSize=0,this._cumulativeWidth=0,this._paddingLeft=0,this._paddingRight=0,this._marginLeft=0,this._marginRight=0}resetOffsets(){this._offsetX=this._offsetY=0,this._cumulativeWidth=0}get xadvance(){return 0}get xoffset(){return 0}get yoffset(){return 0}get width(){return 0}get height(){return 0}set lineBreak(e){this._lineBreak=e}get lineBreak(){return this._lineBreak}get anchor(){return 0}get kerning(){return this._kerning*this._fontFactor}set kerning(e){this._kerning=e}get fontSize(){return this._fontSize}set fontSize(e){this._fontSize=e}get lineHeight(){return 0}get offsetX(){return this._offsetX}set offsetX(e){this._offsetX=e}get offsetY(){return this._offsetY}set offsetY(e){this._offsetY=e}get cumulativeWidth(){return this._cumulativeWidth}set cumulativeWidth(e){this._cumulativeWidth=e}get marginLeft(){return this._marginLeft}set marginLeft(e){this._marginLeft=e}get marginRight(){return this._marginRight}set marginRight(e){this._marginRight=e}get paddingLeft(){return this._paddingLeft}set paddingLeft(e){this._paddingLeft=e}get paddingRight(){return this._paddingRight}set paddingRight(e){this._paddingRight=e}get lineBase(){return 0}set fontFactor(e){this._fontFactor=e}get fontFactor(){return this._fontFactor}}class uN extends hN{constructor(e){super(),this._typographic=e}get typographic(){return this._typographic}get xadvance(){return this._typographic.xadvance*this._fontFactor}get xoffset(){return this._typographic.xoffset*this._fontFactor}get yoffset(){return this._typographic.yoffset*this._fontFactor}get width(){return this._typographic.width*this._fontFactor}get height(){return this._typographic.height*this._fontFactor}get char(){return this._typographic.char}get anchor(){return this.yoffset}get lineHeight(){return this._typographic.font.lineHeight*this._fontFactor}get lineBase(){return this._typographic.font.lineBase*this._fontFactor}}class qY extends uN{constructor(e){super(e)}get uv(){return this.typographic.uv}}class Sb extends lN{constructor(e,t){super(e),this._char=t.char,this._width=t.width,this._heigth=t.height,this._xadvance=t.xadvance?t.xadvance:this._width,this._xoffset=t.xoffset?t.xoffset:0,this._yoffset=t.yoffset?t.yoffset:0,this._uv=t.uv?t.uv:null,isNaN(t.x)||(this._uv={left:t.x/e.textureWidth,right:(t.x+t.width)/e.textureWidth,top:1-(t.y+t.height)/e.textureHeight,bottom:1-t.y/e.textureHeight})}get uv(){return this._uv}clone(e){return new Sb(this._font,{char:e,width:this._width,height:this._heigth,xadvance:this._xadvance,xoffset:this._xoffset,yoffset:this._yoffset,uv:null})}asInlineGlyph(){return new qY(this)}}class XY extends We.PlaneGeometry{constructor(e,t){let i=1,s=1;const r=e.typographic.font.size,o=t._segments.value;i=Math.ceil(e.typographic.width/r*o),s=Math.ceil(e.typographic.height/r*o),super(e.width,e.height,i,s),e.uv?(this._mapUVs(e),this._transformGeometry(e)):(this._nullifyUVs(),this.scale(0,0,1),this.translate(0,e.fontSize/2,0)),this.name="GlyphGeometry"}_mapUVs(e){const t=e.uv.right-e.uv.left,i=e.uv.bottom-e.uv.top,s=this.getAttribute("uv").array.slice(),r=[];for(let o=0;o<s.length;o+=2){const a=s[o],c=s[o+1];r.push(e.uv.left+t*a),r.push(e.uv.top+i*c)}this.setAttribute("uvG",new We.BufferAttribute(new Float32Array(r),2))}_nullifyUVs(){const e=[],t=this.getAttribute("uv").array.length;for(let i=0;i<t;i++)e.push(0);this.setAttribute("uvG",new We.BufferAttribute(new Float32Array(e),2))}_transformGeometry(e){this.translate(e.width/2,-e.height/2,0)}}const YY=`
attribute vec2 uvG;
varying vec2 vUvG;
`,M1=YY,JY=`
vUvG = uvG;
`,I1=JY,KY=`
gl_Position.z -= 0.00001;
`,R1=KY,ZY=`
varying vec2 vUvG;
uniform sampler2D glyphMap;
uniform vec2 unitRange;
// functions from the original msdf repo:
// https://github.com/Chlumsky/msdfgen#using-a-multi-channel-distance-field
float median(float r, float g, float b) {
	return max(min(r, g), min(max(r, g), b));
}
float screenPxRange() {

	// precomputed unitRange as recommended by Chlumsky
	// vec2 unitRange = vec2(pxRange)/vec2(textureSize(glyphMap, 0));
	vec2 screenTexSize = vec2(1.0)/fwidth(vUvG);
	return max(0.5*dot(unitRange, screenTexSize), 1.0);
}
float tap(vec2 offsetUV) {
	vec3 msd = texture( glyphMap, offsetUV ).rgb;
	float sd = median(msd.r, msd.g, msd.b);
	float screenPxDistance = screenPxRange() * (sd - 0.5);
	float alpha = clamp(screenPxDistance + 0.5, 0.0, 1.0);
	return alpha;
}
`,P1=ZY,$Y=`
	float alpha;
#ifdef NO_RGSS

	alpha = tap( vUvG );

#else

	// shader-based supersampling based on https://bgolus.medium.com/sharper-mipmapping-using-shader-based-supersampling-ed7aadb47bec
	// per pixel partial derivatives
	vec2 dx = dFdx(vUvG);
	vec2 dy = dFdy(vUvG);
	// rotated grid uv offsets
	vec2 uvOffsets = vec2(0.125, 0.375);
	vec2 offsetUV = vec2(0.0, 0.0);
	// supersampled using 2x2 rotated grid
	alpha = 0.0;
	offsetUV.xy = vUvG + uvOffsets.x * dx + uvOffsets.y * dy;
	alpha += tap(offsetUV);
	offsetUV.xy = vUvG - uvOffsets.x * dx - uvOffsets.y * dy;
	alpha += tap(offsetUV);
	offsetUV.xy = vUvG + uvOffsets.y * dx - uvOffsets.x * dy;
	alpha += tap(offsetUV);
	offsetUV.xy = vUvG - uvOffsets.y * dx + uvOffsets.x * dy;
	alpha += tap(offsetUV);
	alpha *= 0.25;

#endif

	alpha = clamp( alpha, 0.0, 1.0 );

#ifdef INVERT_ALPHA

	alpha = 1.0 - alpha;

#endif

	diffuseColor.a *= alpha;
`,B1=$Y,px=function(n,e,t){n.alphaTest=t,D1(n,"USE_ALPHATEST",t>0)},D1=function(n,e,t){n.defines&&(t?n.defines[e]===void 0&&(n.defines[e]="",n.needsUpdate=!0):n.defines[e]!==void 0&&(delete n.defines[e],n.needsUpdate=!0))},dN=function(n,e,t){n.defines[e]&&n.defines[e]===t||(n.defines[e]=t,n.needsUpdate=!0)},xo=function(n,e,t){n.userData[e]?n.userData[e].value=t:n.uniforms[e].value=t},e7=function(n,e,t){n.userData[e].value=t};class Co{static ensureMaterialOptions(e){e.transparent=!0,e.alphaTest=e.alphaTest||.02}static ensureDefines(e){e.defines||(e.defines={})}static ensureUserData(e,t){e.userData.glyphMap={value:t.glyphMap},e.userData.unitRange={value:new We.Vector2}}static bindUniformsWithUserData(e,t){e.uniforms.glyphMap=t.userData.glyphMap,e.uniforms.unitRange=t.userData.unitRange}static injectShaderChunks(e){Co.injectVertexShaderChunks(e),Co.injectFragmentShaderChunks(e)}static injectVertexShaderChunks(e){e.vertexShader=e.vertexShader.replace("#include <uv_pars_vertex>",`#include <uv_pars_vertex>
`+M1),e.vertexShader=e.vertexShader.replace("#include <uv_vertex>",`#include <uv_vertex>
`+I1),e.vertexShader=e.vertexShader.replace("#include <project_vertex>",`#include <project_vertex>
`+R1)}static injectFragmentShaderChunks(e){e.fragmentShader=e.fragmentShader.replace("#include <uv_pars_fragment>",`#include <uv_pars_fragment>
`+P1),e.fragmentShader=e.fragmentShader.replace("#include <alphamap_fragment>",`#include <alphamap_fragment>
`+B1)}static from(e){return class extends e{constructor(i={}){Co.ensureMaterialOptions(i);super(i);u(this,"_cumulativeOnBeforeCompile",i=>{Co.bindUniformsWithUserData(i,this),Co.injectShaderChunks(i),this._userDefinedOnBeforeCompile(i)});Co.ensureDefines(this),Co.ensureUserData(this,i),this._userDefinedOnBeforeCompile=s=>{},this._onBeforeCompile=this._cumulativeOnBeforeCompile}static get fontMaterialProperties(){return Co.mediation}set onBeforeCompile(i){this._userDefinedOnBeforeCompile=i}get onBeforeCompile(){return this._onBeforeCompile}}}static get mediation(){return n7}}const t7=function(n,e,t){const i=t?t.texture:null,s=t?t.unitRange:new We.Vector2;if(n[e]!==void 0){n.glyphMap=i,n.unitRange=s;return}n.userData&&n.userData.glyphMap&&(n.userData.glyphMap.value=i,n.userData.unitRange.value=s)},i7=function(n,e,t){t&&t!=="antialiased"?n.defines.NO_RGSS="":delete n.defines.NO_RGSS,n.needsUpdate=!0},n7={clippingPlanes:{m:"clippingPlanes"},fontAlphaTest:{m:"alphaTest",t:px},fontSide:{m:"side"},font:{m:"glyphMap",t:t7},color:{m:"color"},fontOpacity:{m:"opacity"},fontSmooth:{m:"NO_RGSS",t:i7},invertAlpha:{m:"INVERT_ALPHA",t:D1}},s7=`
${M1}
#include <clipping_planes_pars_vertex>
void main() {
	${I1}
	#include <begin_vertex>
	#include <project_vertex>
	${R1}
	#include <clipping_planes_vertex>
}
`,r7=`
uniform vec3 diffuse;
uniform float opacity;
${P1}
#include <alphatest_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	// instead of <color_fragment> : vec4 diffuseColor
	vec4 diffuseColor = vec4( diffuse, opacity );
	${B1}
	#include <alphatest_fragment>
	// instead of <output_fragment>
	gl_FragColor = diffuseColor;
	#include <clipping_planes_fragment>
}
`,o7=.02;class O1 extends We.ShaderMaterial{static get mediation(){return Co.mediation}constructor(e={}){super({uniforms:{glyphMap:{value:null},diffuse:{value:null},opacity:{value:1},unitRange:{value:new We.Vector2(0,0)},alphaTest:{value:o7}},transparent:!0,clipping:!0,vertexShader:s7,fragmentShader:r7,extensions:{derivatives:!0}}),this.defines.USE_ALPHATEST="",this.needsUpdate=!0,this.noRGSS=e.noRGSS||!1}get color(){return this.uniforms.diffuse.value}set color(e){this.uniforms.diffuse.value=e}set opacity(e){this.uniforms&&(this.uniforms.opacity.value=e)}get opacity(){return this.uniforms.opacity.value}get unitRange(){return this.uniforms.unitRange.value}set unitRange(e){this.uniforms.unitRange.value.copy(e)}get glyphMap(){return this.uniforms.glyphMap.value}set glyphMap(e){this.uniforms.glyphMap.value=e}get isDefault(){return this.constructor===O1}get alphaTest(){return this.uniforms.alphaTest.value}set alphaTest(e){this.uniforms.alphaTest.value=e}}class a7 extends XA{constructor(e,t,i,s){if(super(e,t),this._unitRange=new We.Vector2(1,1),i.pages?this._buildData(i):c7(this,i),s instanceof We.Texture)this._texture=s,this._buildTexture(s);else if(typeof s=="string"||s instanceof String)l7(this,s);else throw new Error(`ThreeMeshUI::MSDFVariant provided 'texture' parameter is '${typeof s}'. Only Texture and String allowed.`);this._defaultMaterialClass=O1,this._checkReadiness()}get texture(){return this._texture}get unitRange(){return this._unitRange}set fontMaterial(e){this._defaultMaterialClass=e}get fontMaterial(){return this._defaultMaterialClass}_buildData(e){this._font=new WY(e),this._kernings=this._buildKerningPairs(e),this._chars=this._buildCharacters(e),this._chars[" "]=this._buildCharacterWhite(e),this._chars[`
`]=this._buildCharacterWhite(e,`
`,.001,1),this._chars["	"]=this._buildCharacterWhite(e,"	",4,1),this._size=e.info.size,this._lineHeight=e.common.lineHeight,this._lineBase=e.common.base,this._distanceRange=e.distanceField.distanceRange,this._unitRange=new We.Vector2(this._distanceRange,this._distanceRange).divide(new We.Vector2(e.common.scaleW,e.common.scaleH))}_buildTexture(e){e.generateMipmaps=!1,e.minFilter=We.LinearFilter,e.magFilter=We.LinearFilter,e.needsUpdate=!0}_getFallbackCharacter(e){return md.missingCharacter(this,e)}getGeometricGlyph(e,t){return new XY(e,t)}_readyCondition(){return this._chars&&this._texture&&this._texture.image}_buildKerningPairs(e){const t={};for(let i=0;i<e.kernings.length;i++){const s=e.kernings[i];if(s.amount===0)continue;const r=String.fromCharCode(s.first,s.second);t[r]=s.amount}return t}_buildCharacters(e){const t={};for(let i=0;i<e.chars.length;i++){const s=e.chars[i];t[s.char]=new Sb(this._font,s)}return t}_buildCharacterWhite(e,t=" ",i=1,s=1){return new Sb(this._font,{char:t,width:e.info.size/3*i,height:e.info.size*.7*s})}_alterElementProperties(e){}}function c7(n,e){new We.FileLoader().setResponseType("json").load(e,t=>{n._buildData(t),n._checkReadiness()})}function l7(n,e){n._texture=new We.TextureLoader().load(e,t=>{n._buildTexture(t),n._checkReadiness()})}class mx extends We.EventDispatcher{constructor(t){super();u(this,"_checkReadiness",()=>{this._variants.every(t=>t.isReady)&&u7(this)});this._name=t,this._variants=[],this._isReady=!1}get isReady(){return this._isReady}addVariant(t,i,s,r,o=!1){if(o||!this.getVariant(t,i)){this._isReady=!1;const a=new a7(t,i,s,r);this._variants.push(a),a.isReady?this._checkReadiness():a.addEventListener("ready",this._checkReadiness)}else console.warn(`FontFamily('${this._name}')::addVariant() - Variant(${t}, ${i}) already exists.`);return this}addCustomImplementationVariant(t,i=!1){return i||!this.getVariant(t.weight,t.style)?(this._isReady=!1,this._variants.push(t),t.isReady?this._checkReadiness():t.addEventListener("ready",this._checkReadiness)):console.warn(`FontFamily('${this._name}')::addCustomImplementationVariant() - Variant(${t.weight}, ${t.style}) already exists.`),this}getVariant(t,i){return t=w1(t),this._variants.find(s=>s.weight===t&&s.style===i)}get name(){return this._name}}const h7={type:"ready"};function u7(n){n._isReady=!0,n.dispatchEvent(h7)}const D0={},d7=function(n){const e=[...arguments];e.forEach(i=>{if(!(i instanceof mx))throw new Error(`FontLibrary::prepare() - One of the provided parameter is not a FontFamily. Instead ${typeof i} given.`)});const t=function(){return e.every(i=>i.isReady)};return new Promise((i,s)=>{if(t())i();else for(let r=0;r<e.length;r++){const o=e[r];o.isReady||o.addEventListener("ready",()=>{t()&&i()})}})},f7=function(n){return D0[n]&&console.error(`FontLibrary::addFontFamily - Font('${n}') is already registered`),D0[n]=new mx(n),D0[n]},p7=function(n){return D0[n]},m7=function(n){fN=n};let fN=function(n,e){return console.error(`The character '${e}' is not included in the font characters set.`)," "};function g7(n,e){return fN(n,e)}const A7={addFontFamily:f7,getFontFamily:p7,prepare:d7,setMissingCharacterHandler:m7,missingCharacter:g7},md=A7;class pN extends Zi{constructor(){super("fontFamily","inherit",!0)}computeOutputValue(e){if(this._input instanceof mx)this._value=this._input;else if(this._input!=="inherit")if(typeof this._input=="string"){const t=md.getFontFamily(this._input);t?this._value=t:console.warn(`(.style) fontFamily, the font '${this._input}' is not registered. Aborted.`)}else console.warn("(.style) fontFamily requires a registered fontFamily instance, or the id of a registered fontFamily."),console.warn("If you want to set a specific font, please use .font property instead.")}get value(){return this._value}getInheritedInput(e){if(this._input!=="inherit")return this._input;const t=e._parent._value;return t?t[`_${this._id}`].getInheritedInput(t):this.getDefaultValue()}}class mN extends Zi{constructor(){super("lineHeight","inherit",!0)}update(e,t){super.update(e,t),e._layouter._needsProcess=!0}}class gN extends Zi{constructor(){super("whiteSpace","inherit"),this.isValidValue=y7}}const v7=["normal","nowrap","pre","pre-line","pre-wrap"];function y7(n){return v7.indexOf(n)===-1?(console.warn(`(.style) whiteSpace value '${n}' is not valid. Aborted`),!1):!0}class AN extends Zi{constructor(){super("letterSpacing","inherit",!0)}}class b7 extends Zi{constructor(){super("fontSize","inherit",!0)}}class vN extends Ci{constructor(){super("segments",1,!1)}}class _7 extends xd{constructor(){super("invertAlpha","inherit")}}class gx extends Zi{constructor(){super("fontKerning","inherit"),this.isValidValue=w7}}const x7=["normal","none","inherit"];function w7(n){return x7.indexOf(n)===-1?(console.warn(`(.style) fontKerning value '${n}' is not valid. Aborted`),!1):!0}class Vy extends xd{constructor(e){super(e,"inherit",!0)}}class bD extends xd{constructor(e){super(e,"inherit",!1),this._mediation={},this._defaultMaterial=null}update(e,t){this._notInheritedValue=this._value,this._notInheritedValue==="inherit"?this._notInheritedValue=this.getInheritedInput(e):this.propagate(e),this._notInheritedValue?this._notInheritedValue.constructor.mediation?this._mediation={...this._notInheritedValue.constructor.mediation}:this._mediation={clippingPlanes:{m:"clippingPlanes"},fontAlphaTest:{m:"alphaTest",t:px},fontSide:{m:"side"},color:{m:"color"},fontOpacity:{m:"opacity"}}:this._mediation={},e._transferToFontMaterial(),this._outputValue(t)}getInheritedInput(e){if(this._value!=="inherit")return this._value;let t=e,i=null;for(;t._parent._value;)if(t=t._parent._value,t[`_${this._id}`]._value!=="inherit"){i=t[`_${this._id}`]._value;break}return i!==null?i:this.getDefaultValue()}getDefaultValue(){return this._defaultMaterial}}var S7=[509,0,227,0,150,4,294,9,1368,2,2,1,6,3,41,2,5,0,166,1,574,3,9,9,370,1,154,10,50,3,123,2,54,14,32,10,3,1,11,3,46,10,8,0,46,9,7,2,37,13,2,9,6,1,45,0,13,2,49,13,9,3,2,11,83,11,7,0,161,11,6,9,7,3,56,1,2,6,3,1,3,2,10,0,11,1,3,6,4,4,193,17,10,9,5,0,82,19,13,9,214,6,3,8,28,1,83,16,16,9,82,12,9,9,84,14,5,9,243,14,166,9,71,5,2,1,3,3,2,0,2,1,13,9,120,6,3,6,4,0,29,9,41,6,2,3,9,0,10,10,47,15,406,7,2,7,17,9,57,21,2,13,123,5,4,0,2,1,2,6,2,0,9,9,49,4,2,1,2,4,9,9,330,3,19306,9,87,9,39,4,60,6,26,9,1014,0,2,54,8,3,82,0,12,1,19628,1,4706,45,3,22,543,4,4,5,9,7,3,6,31,3,149,2,1418,49,513,54,5,49,9,0,15,0,23,4,2,14,1361,6,2,16,3,6,2,1,2,4,262,6,10,9,357,0,62,13,1495,6,110,6,6,9,4759,9,787719,239],yN=[0,11,2,25,2,18,2,1,2,14,3,13,35,122,70,52,268,28,4,48,48,31,14,29,6,37,11,29,3,35,5,7,2,4,43,157,19,35,5,35,5,39,9,51,13,10,2,14,2,6,2,1,2,10,2,14,2,6,2,1,68,310,10,21,11,7,25,5,2,41,2,8,70,5,3,0,2,43,2,1,4,0,3,22,11,22,10,30,66,18,2,1,11,21,11,25,71,55,7,1,65,0,16,3,2,2,2,28,43,28,4,28,36,7,2,27,28,53,11,21,11,18,14,17,111,72,56,50,14,50,14,35,349,41,7,1,79,28,11,0,9,21,43,17,47,20,28,22,13,52,58,1,3,0,14,44,33,24,27,35,30,0,3,0,9,34,4,0,13,47,15,3,22,0,2,0,36,17,2,24,85,6,2,0,2,3,2,14,2,9,8,46,39,7,3,1,3,21,2,6,2,1,2,4,4,0,19,0,13,4,159,52,19,3,21,2,31,47,21,1,2,0,185,46,42,3,37,47,21,0,60,42,14,0,72,26,38,6,186,43,117,63,32,7,3,0,3,7,2,1,2,23,16,0,2,0,95,7,3,38,17,0,2,0,29,0,11,39,8,0,22,0,12,45,20,0,19,72,264,8,2,36,18,0,50,29,113,6,2,1,2,37,22,0,26,5,2,1,2,31,15,0,328,18,190,0,80,921,103,110,18,195,2637,96,16,1070,4050,582,8634,568,8,30,18,78,18,29,19,47,17,3,32,20,6,18,689,63,129,74,6,0,67,12,65,1,2,0,29,6135,9,1237,43,8,8936,3,2,6,2,1,2,290,46,2,18,3,9,395,2309,106,6,12,4,8,8,9,5991,84,2,70,2,1,3,0,3,1,3,3,2,11,2,0,2,6,2,64,2,3,3,7,2,6,2,27,2,3,2,4,2,0,4,6,2,339,3,24,2,24,2,30,2,24,2,30,2,24,2,30,2,24,2,30,2,24,2,7,1845,30,482,44,11,6,17,0,322,29,19,43,1269,6,2,3,2,1,2,14,2,196,60,67,8,0,1205,3,2,26,2,1,2,0,3,0,2,9,2,3,2,0,2,0,7,0,5,0,2,0,2,0,2,2,2,1,2,0,3,0,2,0,2,0,2,0,2,0,2,1,2,0,3,3,2,6,2,3,2,3,2,0,2,9,2,16,6,2,2,4,2,16,4421,42719,33,4152,8,221,3,5761,15,7472,3104,541,1507,4938],C7="-----------------------------------------------------------------------------------------------------------------------------------------------------",bN="------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------",IS={3:"abstract boolean byte char class double enum export extends final float goto implements import int interface long native package private protected public short static super synchronized throws transient volatile",5:"class enum extends super const export import",6:"enum",strict:"implements interface let package private protected public static yield",strictBind:"eval arguments"},RS="break case catch continue debugger default do else finally for function if return switch throw try var while with null true false instanceof typeof void delete new in this",E7={5:RS,"5module":RS+" export import",6:RS+" const class extends export import super"},T7=/^in(stanceof)?$/,M7=new RegExp("["+bN+"]"),I7=new RegExp("["+bN+C7+"]");function oT(n,e){for(var t=65536,i=0;i<e.length;i+=2){if(t+=e[i],t>n)return!1;if(t+=e[i+1],t>=n)return!0}}function El(n,e){return n<65?n===36:n<91?!0:n<97?n===95:n<123?!0:n<=65535?n>=170&&M7.test(String.fromCharCode(n)):e===!1?!1:oT(n,yN)}function yp(n,e){return n<48?n===36:n<58?!0:n<65?!1:n<91?!0:n<97?n===95:n<123?!0:n<=65535?n>=170&&I7.test(String.fromCharCode(n)):e===!1?!1:oT(n,yN)||oT(n,S7)}var pi=function(e,t){t===void 0&&(t={}),this.label=e,this.keyword=t.keyword,this.beforeExpr=!!t.beforeExpr,this.startsExpr=!!t.startsExpr,this.isLoop=!!t.isLoop,this.isAssign=!!t.isAssign,this.prefix=!!t.prefix,this.postfix=!!t.postfix,this.binop=t.binop||null,this.updateContext=null};function go(n,e){return new pi(n,{beforeExpr:!0,binop:e})}var Ao={beforeExpr:!0},Mr={startsExpr:!0},k1={};function ci(n,e){return e===void 0&&(e={}),e.keyword=n,k1[n]=new pi(n,e)}var k={num:new pi("num",Mr),regexp:new pi("regexp",Mr),string:new pi("string",Mr),name:new pi("name",Mr),privateId:new pi("privateId",Mr),eof:new pi("eof"),bracketL:new pi("[",{beforeExpr:!0,startsExpr:!0}),bracketR:new pi("]"),braceL:new pi("{",{beforeExpr:!0,startsExpr:!0}),braceR:new pi("}"),parenL:new pi("(",{beforeExpr:!0,startsExpr:!0}),parenR:new pi(")"),comma:new pi(",",Ao),semi:new pi(";",Ao),colon:new pi(":",Ao),dot:new pi("."),question:new pi("?",Ao),questionDot:new pi("?."),arrow:new pi("=>",Ao),template:new pi("template"),invalidTemplate:new pi("invalidTemplate"),ellipsis:new pi("...",Ao),backQuote:new pi("`",Mr),dollarBraceL:new pi("${",{beforeExpr:!0,startsExpr:!0}),eq:new pi("=",{beforeExpr:!0,isAssign:!0}),assign:new pi("_=",{beforeExpr:!0,isAssign:!0}),incDec:new pi("++/--",{prefix:!0,postfix:!0,startsExpr:!0}),prefix:new pi("!/~",{beforeExpr:!0,prefix:!0,startsExpr:!0}),logicalOR:go("||",1),logicalAND:go("&&",2),bitwiseOR:go("|",3),bitwiseXOR:go("^",4),bitwiseAND:go("&",5),equality:go("==/!=/===/!==",6),relational:go("</>/<=/>=",7),bitShift:go("<</>>/>>>",8),plusMin:new pi("+/-",{beforeExpr:!0,binop:9,prefix:!0,startsExpr:!0}),modulo:go("%",10),star:go("*",10),slash:go("/",10),starstar:new pi("**",{beforeExpr:!0}),coalesce:go("??",1),_break:ci("break"),_case:ci("case",Ao),_catch:ci("catch"),_continue:ci("continue"),_debugger:ci("debugger"),_default:ci("default",Ao),_do:ci("do",{isLoop:!0,beforeExpr:!0}),_else:ci("else",Ao),_finally:ci("finally"),_for:ci("for",{isLoop:!0}),_function:ci("function",Mr),_if:ci("if"),_return:ci("return",Ao),_switch:ci("switch"),_throw:ci("throw",Ao),_try:ci("try"),_var:ci("var"),_const:ci("const"),_while:ci("while",{isLoop:!0}),_with:ci("with"),_new:ci("new",{beforeExpr:!0,startsExpr:!0}),_this:ci("this",Mr),_super:ci("super",Mr),_class:ci("class",Mr),_extends:ci("extends",Ao),_export:ci("export"),_import:ci("import",Mr),_null:ci("null",Mr),_true:ci("true",Mr),_false:ci("false",Mr),_in:ci("in",{beforeExpr:!0,binop:7}),_instanceof:ci("instanceof",{beforeExpr:!0,binop:7}),_typeof:ci("typeof",{beforeExpr:!0,prefix:!0,startsExpr:!0}),_void:ci("void",{beforeExpr:!0,prefix:!0,startsExpr:!0}),_delete:ci("delete",{beforeExpr:!0,prefix:!0,startsExpr:!0})},Vo=/\r\n?|\n|\u2028|\u2029/,R7=new RegExp(Vo.source,"g");function Up(n){return n===10||n===13||n===8232||n===8233}function _N(n,e,t){t===void 0&&(t=n.length);for(var i=e;i<t;i++){var s=n.charCodeAt(i);if(Up(s))return i<t-1&&s===13&&n.charCodeAt(i+1)===10?i+2:i+1}return-1}var xN=/[\u1680\u2000-\u200a\u202f\u205f\u3000\ufeff]/,Io=/(?:\s|\/\/.*|\/\*[^]*?\*\/)*/g,wN=Object.prototype,P7=wN.hasOwnProperty,B7=wN.toString,YA=Object.hasOwn||function(n,e){return P7.call(n,e)},_D=Array.isArray||function(n){return B7.call(n)==="[object Array]"};function Gu(n){return new RegExp("^(?:"+n.replace(/ /g,"|")+")$")}function Qh(n){return n<=65535?String.fromCharCode(n):(n-=65536,String.fromCharCode((n>>10)+55296,(n&1023)+56320))}var D7=/(?:[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])/,dA=function(e,t){this.line=e,this.column=t};dA.prototype.offset=function(e){return new dA(this.line,this.column+e)};var Ax=function(e,t,i){this.start=t,this.end=i,e.sourceFile!==null&&(this.source=e.sourceFile)};function SN(n,e){for(var t=1,i=0;;){var s=_N(n,i,e);if(s<0)return new dA(t,e-i);++t,i=s}}var aT={ecmaVersion:null,sourceType:"script",onInsertedSemicolon:null,onTrailingComma:null,allowReserved:null,allowReturnOutsideFunction:!1,allowImportExportEverywhere:!1,allowAwaitOutsideFunction:null,allowSuperOutsideMethod:null,allowHashBang:!1,locations:!1,onToken:null,onComment:null,ranges:!1,program:null,sourceFile:null,directSourceFile:null,preserveParens:!1},xD=!1;function O7(n){var e={};for(var t in aT)e[t]=n&&YA(n,t)?n[t]:aT[t];if(e.ecmaVersion==="latest"?e.ecmaVersion=1e8:e.ecmaVersion==null?(!xD&&typeof console=="object"&&console.warn&&(xD=!0,console.warn(`Since Acorn 8.0.0, options.ecmaVersion is required.
Defaulting to 2020, but this will stop working in the future.`)),e.ecmaVersion=11):e.ecmaVersion>=2015&&(e.ecmaVersion-=2009),e.allowReserved==null&&(e.allowReserved=e.ecmaVersion<5),n.allowHashBang==null&&(e.allowHashBang=e.ecmaVersion>=14),_D(e.onToken)){var i=e.onToken;e.onToken=function(s){return i.push(s)}}return _D(e.onComment)&&(e.onComment=k7(e,e.onComment)),e}function k7(n,e){return function(t,i,s,r,o,a){var c={type:t?"Block":"Line",value:i,start:s,end:r};n.locations&&(c.loc=new Ax(this,o,a)),n.ranges&&(c.range=[s,r]),e.push(c)}}var fA=1,Np=2,L1=4,CN=8,EN=16,TN=32,F1=64,MN=128,JA=256,U1=fA|Np|JA;function N1(n,e){return Np|(n?L1:0)|(e?CN:0)}var Cb=0,z1=1,ml=2,IN=3,RN=4,PN=5,os=function(e,t,i){this.options=e=O7(e),this.sourceFile=e.sourceFile,this.keywords=Gu(E7[e.ecmaVersion>=6?6:e.sourceType==="module"?"5module":5]);var s="";e.allowReserved!==!0&&(s=IS[e.ecmaVersion>=6?6:e.ecmaVersion===5?5:3],e.sourceType==="module"&&(s+=" await")),this.reservedWords=Gu(s);var r=(s?s+" ":"")+IS.strict;this.reservedWordsStrict=Gu(r),this.reservedWordsStrictBind=Gu(r+" "+IS.strictBind),this.input=String(t),this.containsEsc=!1,i?(this.pos=i,this.lineStart=this.input.lastIndexOf(`
`,i-1)+1,this.curLine=this.input.slice(0,this.lineStart).split(Vo).length):(this.pos=this.lineStart=0,this.curLine=1),this.type=k.eof,this.value=null,this.start=this.end=this.pos,this.startLoc=this.endLoc=this.curPosition(),this.lastTokEndLoc=this.lastTokStartLoc=null,this.lastTokStart=this.lastTokEnd=this.pos,this.context=this.initialContext(),this.exprAllowed=!0,this.inModule=e.sourceType==="module",this.strict=this.inModule||this.strictDirective(this.pos),this.potentialArrowAt=-1,this.potentialArrowInForAwait=!1,this.yieldPos=this.awaitPos=this.awaitIdentPos=0,this.labels=[],this.undefinedExports=Object.create(null),this.pos===0&&e.allowHashBang&&this.input.slice(0,2)==="#!"&&this.skipLineComment(2),this.scopeStack=[],this.enterScope(fA),this.regexpState=null,this.privateNameStack=[]},bc={inFunction:{configurable:!0},inGenerator:{configurable:!0},inAsync:{configurable:!0},canAwait:{configurable:!0},allowSuper:{configurable:!0},allowDirectSuper:{configurable:!0},treatFunctionsAsVar:{configurable:!0},allowNewDotTarget:{configurable:!0},inClassStaticBlock:{configurable:!0}};os.prototype.parse=function(){var e=this.options.program||this.startNode();return this.nextToken(),this.parseTopLevel(e)};bc.inFunction.get=function(){return(this.currentVarScope().flags&Np)>0};bc.inGenerator.get=function(){return(this.currentVarScope().flags&CN)>0&&!this.currentVarScope().inClassFieldInit};bc.inAsync.get=function(){return(this.currentVarScope().flags&L1)>0&&!this.currentVarScope().inClassFieldInit};bc.canAwait.get=function(){for(var n=this.scopeStack.length-1;n>=0;n--){var e=this.scopeStack[n];if(e.inClassFieldInit||e.flags&JA)return!1;if(e.flags&Np)return(e.flags&L1)>0}return this.inModule&&this.options.ecmaVersion>=13||this.options.allowAwaitOutsideFunction};bc.allowSuper.get=function(){var n=this.currentThisScope(),e=n.flags,t=n.inClassFieldInit;return(e&F1)>0||t||this.options.allowSuperOutsideMethod};bc.allowDirectSuper.get=function(){return(this.currentThisScope().flags&MN)>0};bc.treatFunctionsAsVar.get=function(){return this.treatFunctionsAsVarInScope(this.currentScope())};bc.allowNewDotTarget.get=function(){var n=this.currentThisScope(),e=n.flags,t=n.inClassFieldInit;return(e&(Np|JA))>0||t};bc.inClassStaticBlock.get=function(){return(this.currentVarScope().flags&JA)>0};os.extend=function(){for(var e=[],t=arguments.length;t--;)e[t]=arguments[t];for(var i=this,s=0;s<e.length;s++)i=e[s](i);return i};os.parse=function(e,t){return new this(t,e).parse()};os.parseExpressionAt=function(e,t,i){var s=new this(i,e,t);return s.nextToken(),s.parseExpression()};os.tokenizer=function(e,t){return new this(t,e)};Object.defineProperties(os.prototype,bc);var _r=os.prototype,L7=/^(?:'((?:\\.|[^'\\])*?)'|"((?:\\.|[^"\\])*?)")/;_r.strictDirective=function(n){if(this.options.ecmaVersion<5)return!1;for(;;){Io.lastIndex=n,n+=Io.exec(this.input)[0].length;var e=L7.exec(this.input.slice(n));if(!e)return!1;if((e[1]||e[2])==="use strict"){Io.lastIndex=n+e[0].length;var t=Io.exec(this.input),i=t.index+t[0].length,s=this.input.charAt(i);return s===";"||s==="}"||Vo.test(t[0])&&!(/[(`.[+\-/*%<>=,?^&]/.test(s)||s==="!"&&this.input.charAt(i+1)==="=")}n+=e[0].length,Io.lastIndex=n,n+=Io.exec(this.input)[0].length,this.input[n]===";"&&n++}};_r.eat=function(n){return this.type===n?(this.next(),!0):!1};_r.isContextual=function(n){return this.type===k.name&&this.value===n&&!this.containsEsc};_r.eatContextual=function(n){return this.isContextual(n)?(this.next(),!0):!1};_r.expectContextual=function(n){this.eatContextual(n)||this.unexpected()};_r.canInsertSemicolon=function(){return this.type===k.eof||this.type===k.braceR||Vo.test(this.input.slice(this.lastTokEnd,this.start))};_r.insertSemicolon=function(){if(this.canInsertSemicolon())return this.options.onInsertedSemicolon&&this.options.onInsertedSemicolon(this.lastTokEnd,this.lastTokEndLoc),!0};_r.semicolon=function(){!this.eat(k.semi)&&!this.insertSemicolon()&&this.unexpected()};_r.afterTrailingComma=function(n,e){if(this.type===n)return this.options.onTrailingComma&&this.options.onTrailingComma(this.lastTokStart,this.lastTokStartLoc),e||this.next(),!0};_r.expect=function(n){this.eat(n)||this.unexpected()};_r.unexpected=function(n){this.raise(n??this.start,"Unexpected token")};var vx=function(){this.shorthandAssign=this.trailingComma=this.parenthesizedAssign=this.parenthesizedBind=this.doubleProto=-1};_r.checkPatternErrors=function(n,e){if(n){n.trailingComma>-1&&this.raiseRecoverable(n.trailingComma,"Comma is not permitted after the rest element");var t=e?n.parenthesizedAssign:n.parenthesizedBind;t>-1&&this.raiseRecoverable(t,e?"Assigning to rvalue":"Parenthesized pattern")}};_r.checkExpressionErrors=function(n,e){if(!n)return!1;var t=n.shorthandAssign,i=n.doubleProto;if(!e)return t>=0||i>=0;t>=0&&this.raise(t,"Shorthand property assignments are valid only in destructuring patterns"),i>=0&&this.raiseRecoverable(i,"Redefinition of __proto__ property")};_r.checkYieldAwaitInDefaultParams=function(){this.yieldPos&&(!this.awaitPos||this.yieldPos<this.awaitPos)&&this.raise(this.yieldPos,"Yield expression cannot be a default value"),this.awaitPos&&this.raise(this.awaitPos,"Await expression cannot be a default value")};_r.isSimpleAssignTarget=function(n){return n.type==="ParenthesizedExpression"?this.isSimpleAssignTarget(n.expression):n.type==="Identifier"||n.type==="MemberExpression"};var Mt=os.prototype;Mt.parseTopLevel=function(n){var e=Object.create(null);for(n.body||(n.body=[]);this.type!==k.eof;){var t=this.parseStatement(null,!0,e);n.body.push(t)}if(this.inModule)for(var i=0,s=Object.keys(this.undefinedExports);i<s.length;i+=1){var r=s[i];this.raiseRecoverable(this.undefinedExports[r].start,"Export '"+r+"' is not defined")}return this.adaptDirectivePrologue(n.body),this.next(),n.sourceType=this.options.sourceType,this.finishNode(n,"Program")};var G1={kind:"loop"},F7={kind:"switch"};Mt.isLet=function(n){if(this.options.ecmaVersion<6||!this.isContextual("let"))return!1;Io.lastIndex=this.pos;var e=Io.exec(this.input),t=this.pos+e[0].length,i=this.input.charCodeAt(t);if(i===91||i===92||i>55295&&i<56320)return!0;if(n)return!1;if(i===123)return!0;if(El(i,!0)){for(var s=t+1;yp(i=this.input.charCodeAt(s),!0);)++s;if(i===92||i>55295&&i<56320)return!0;var r=this.input.slice(t,s);if(!T7.test(r))return!0}return!1};Mt.isAsyncFunction=function(){if(this.options.ecmaVersion<8||!this.isContextual("async"))return!1;Io.lastIndex=this.pos;var n=Io.exec(this.input),e=this.pos+n[0].length,t;return!Vo.test(this.input.slice(this.pos,e))&&this.input.slice(e,e+8)==="function"&&(e+8===this.input.length||!(yp(t=this.input.charCodeAt(e+8))||t>55295&&t<56320))};Mt.parseStatement=function(n,e,t){var i=this.type,s=this.startNode(),r;switch(this.isLet(n)&&(i=k._var,r="let"),i){case k._break:case k._continue:return this.parseBreakContinueStatement(s,i.keyword);case k._debugger:return this.parseDebuggerStatement(s);case k._do:return this.parseDoStatement(s);case k._for:return this.parseForStatement(s);case k._function:return n&&(this.strict||n!=="if"&&n!=="label")&&this.options.ecmaVersion>=6&&this.unexpected(),this.parseFunctionStatement(s,!1,!n);case k._class:return n&&this.unexpected(),this.parseClass(s,!0);case k._if:return this.parseIfStatement(s);case k._return:return this.parseReturnStatement(s);case k._switch:return this.parseSwitchStatement(s);case k._throw:return this.parseThrowStatement(s);case k._try:return this.parseTryStatement(s);case k._const:case k._var:return r=r||this.value,n&&r!=="var"&&this.unexpected(),this.parseVarStatement(s,r);case k._while:return this.parseWhileStatement(s);case k._with:return this.parseWithStatement(s);case k.braceL:return this.parseBlock(!0,s);case k.semi:return this.parseEmptyStatement(s);case k._export:case k._import:if(this.options.ecmaVersion>10&&i===k._import){Io.lastIndex=this.pos;var o=Io.exec(this.input),a=this.pos+o[0].length,c=this.input.charCodeAt(a);if(c===40||c===46)return this.parseExpressionStatement(s,this.parseExpression())}return this.options.allowImportExportEverywhere||(e||this.raise(this.start,"'import' and 'export' may only appear at the top level"),this.inModule||this.raise(this.start,"'import' and 'export' may appear only with 'sourceType: module'")),i===k._import?this.parseImport(s):this.parseExport(s,t);default:if(this.isAsyncFunction())return n&&this.unexpected(),this.next(),this.parseFunctionStatement(s,!0,!n);var l=this.value,h=this.parseExpression();return i===k.name&&h.type==="Identifier"&&this.eat(k.colon)?this.parseLabeledStatement(s,l,h,n):this.parseExpressionStatement(s,h)}};Mt.parseBreakContinueStatement=function(n,e){var t=e==="break";this.next(),this.eat(k.semi)||this.insertSemicolon()?n.label=null:this.type!==k.name?this.unexpected():(n.label=this.parseIdent(),this.semicolon());for(var i=0;i<this.labels.length;++i){var s=this.labels[i];if((n.label==null||s.name===n.label.name)&&(s.kind!=null&&(t||s.kind==="loop")||n.label&&t))break}return i===this.labels.length&&this.raise(n.start,"Unsyntactic "+e),this.finishNode(n,t?"BreakStatement":"ContinueStatement")};Mt.parseDebuggerStatement=function(n){return this.next(),this.semicolon(),this.finishNode(n,"DebuggerStatement")};Mt.parseDoStatement=function(n){return this.next(),this.labels.push(G1),n.body=this.parseStatement("do"),this.labels.pop(),this.expect(k._while),n.test=this.parseParenExpression(),this.options.ecmaVersion>=6?this.eat(k.semi):this.semicolon(),this.finishNode(n,"DoWhileStatement")};Mt.parseForStatement=function(n){this.next();var e=this.options.ecmaVersion>=9&&this.canAwait&&this.eatContextual("await")?this.lastTokStart:-1;if(this.labels.push(G1),this.enterScope(0),this.expect(k.parenL),this.type===k.semi)return e>-1&&this.unexpected(e),this.parseFor(n,null);var t=this.isLet();if(this.type===k._var||this.type===k._const||t){var i=this.startNode(),s=t?"let":this.value;return this.next(),this.parseVar(i,!0,s),this.finishNode(i,"VariableDeclaration"),(this.type===k._in||this.options.ecmaVersion>=6&&this.isContextual("of"))&&i.declarations.length===1?(this.options.ecmaVersion>=9&&(this.type===k._in?e>-1&&this.unexpected(e):n.await=e>-1),this.parseForIn(n,i)):(e>-1&&this.unexpected(e),this.parseFor(n,i))}var r=this.isContextual("let"),o=!1,a=new vx,c=this.parseExpression(e>-1?"await":!0,a);return this.type===k._in||(o=this.options.ecmaVersion>=6&&this.isContextual("of"))?(this.options.ecmaVersion>=9&&(this.type===k._in?e>-1&&this.unexpected(e):n.await=e>-1),r&&o&&this.raise(c.start,"The left-hand side of a for-of loop may not start with 'let'."),this.toAssignable(c,!1,a),this.checkLValPattern(c),this.parseForIn(n,c)):(this.checkExpressionErrors(a,!0),e>-1&&this.unexpected(e),this.parseFor(n,c))};Mt.parseFunctionStatement=function(n,e,t){return this.next(),this.parseFunction(n,mg|(t?0:cT),!1,e)};Mt.parseIfStatement=function(n){return this.next(),n.test=this.parseParenExpression(),n.consequent=this.parseStatement("if"),n.alternate=this.eat(k._else)?this.parseStatement("if"):null,this.finishNode(n,"IfStatement")};Mt.parseReturnStatement=function(n){return!this.inFunction&&!this.options.allowReturnOutsideFunction&&this.raise(this.start,"'return' outside of function"),this.next(),this.eat(k.semi)||this.insertSemicolon()?n.argument=null:(n.argument=this.parseExpression(),this.semicolon()),this.finishNode(n,"ReturnStatement")};Mt.parseSwitchStatement=function(n){this.next(),n.discriminant=this.parseParenExpression(),n.cases=[],this.expect(k.braceL),this.labels.push(F7),this.enterScope(0);for(var e,t=!1;this.type!==k.braceR;)if(this.type===k._case||this.type===k._default){var i=this.type===k._case;e&&this.finishNode(e,"SwitchCase"),n.cases.push(e=this.startNode()),e.consequent=[],this.next(),i?e.test=this.parseExpression():(t&&this.raiseRecoverable(this.lastTokStart,"Multiple default clauses"),t=!0,e.test=null),this.expect(k.colon)}else e||this.unexpected(),e.consequent.push(this.parseStatement(null));return this.exitScope(),e&&this.finishNode(e,"SwitchCase"),this.next(),this.labels.pop(),this.finishNode(n,"SwitchStatement")};Mt.parseThrowStatement=function(n){return this.next(),Vo.test(this.input.slice(this.lastTokEnd,this.start))&&this.raise(this.lastTokEnd,"Illegal newline after throw"),n.argument=this.parseExpression(),this.semicolon(),this.finishNode(n,"ThrowStatement")};var U7=[];Mt.parseTryStatement=function(n){if(this.next(),n.block=this.parseBlock(),n.handler=null,this.type===k._catch){var e=this.startNode();if(this.next(),this.eat(k.parenL)){e.param=this.parseBindingAtom();var t=e.param.type==="Identifier";this.enterScope(t?TN:0),this.checkLValPattern(e.param,t?RN:ml),this.expect(k.parenR)}else this.options.ecmaVersion<10&&this.unexpected(),e.param=null,this.enterScope(0);e.body=this.parseBlock(!1),this.exitScope(),n.handler=this.finishNode(e,"CatchClause")}return n.finalizer=this.eat(k._finally)?this.parseBlock():null,!n.handler&&!n.finalizer&&this.raise(n.start,"Missing catch or finally clause"),this.finishNode(n,"TryStatement")};Mt.parseVarStatement=function(n,e){return this.next(),this.parseVar(n,!1,e),this.semicolon(),this.finishNode(n,"VariableDeclaration")};Mt.parseWhileStatement=function(n){return this.next(),n.test=this.parseParenExpression(),this.labels.push(G1),n.body=this.parseStatement("while"),this.labels.pop(),this.finishNode(n,"WhileStatement")};Mt.parseWithStatement=function(n){return this.strict&&this.raise(this.start,"'with' in strict mode"),this.next(),n.object=this.parseParenExpression(),n.body=this.parseStatement("with"),this.finishNode(n,"WithStatement")};Mt.parseEmptyStatement=function(n){return this.next(),this.finishNode(n,"EmptyStatement")};Mt.parseLabeledStatement=function(n,e,t,i){for(var s=0,r=this.labels;s<r.length;s+=1){var o=r[s];o.name===e&&this.raise(t.start,"Label '"+e+"' is already declared")}for(var a=this.type.isLoop?"loop":this.type===k._switch?"switch":null,c=this.labels.length-1;c>=0;c--){var l=this.labels[c];if(l.statementStart===n.start)l.statementStart=this.start,l.kind=a;else break}return this.labels.push({name:e,kind:a,statementStart:this.start}),n.body=this.parseStatement(i?i.indexOf("label")===-1?i+"label":i:"label"),this.labels.pop(),n.label=t,this.finishNode(n,"LabeledStatement")};Mt.parseExpressionStatement=function(n,e){return n.expression=e,this.semicolon(),this.finishNode(n,"ExpressionStatement")};Mt.parseBlock=function(n,e,t){for(n===void 0&&(n=!0),e===void 0&&(e=this.startNode()),e.body=[],this.expect(k.braceL),n&&this.enterScope(0);this.type!==k.braceR;){var i=this.parseStatement(null);e.body.push(i)}return t&&(this.strict=!1),this.next(),n&&this.exitScope(),this.finishNode(e,"BlockStatement")};Mt.parseFor=function(n,e){return n.init=e,this.expect(k.semi),n.test=this.type===k.semi?null:this.parseExpression(),this.expect(k.semi),n.update=this.type===k.parenR?null:this.parseExpression(),this.expect(k.parenR),n.body=this.parseStatement("for"),this.exitScope(),this.labels.pop(),this.finishNode(n,"ForStatement")};Mt.parseForIn=function(n,e){var t=this.type===k._in;return this.next(),e.type==="VariableDeclaration"&&e.declarations[0].init!=null&&(!t||this.options.ecmaVersion<8||this.strict||e.kind!=="var"||e.declarations[0].id.type!=="Identifier")&&this.raise(e.start,(t?"for-in":"for-of")+" loop variable declaration may not have an initializer"),n.left=e,n.right=t?this.parseExpression():this.parseMaybeAssign(),this.expect(k.parenR),n.body=this.parseStatement("for"),this.exitScope(),this.labels.pop(),this.finishNode(n,t?"ForInStatement":"ForOfStatement")};Mt.parseVar=function(n,e,t){for(n.declarations=[],n.kind=t;;){var i=this.startNode();if(this.parseVarId(i,t),this.eat(k.eq)?i.init=this.parseMaybeAssign(e):t==="const"&&!(this.type===k._in||this.options.ecmaVersion>=6&&this.isContextual("of"))?this.unexpected():i.id.type!=="Identifier"&&!(e&&(this.type===k._in||this.isContextual("of")))?this.raise(this.lastTokEnd,"Complex binding patterns require an initialization value"):i.init=null,n.declarations.push(this.finishNode(i,"VariableDeclarator")),!this.eat(k.comma))break}return n};Mt.parseVarId=function(n,e){n.id=this.parseBindingAtom(),this.checkLValPattern(n.id,e==="var"?z1:ml,!1)};var mg=1,cT=2,BN=4;Mt.parseFunction=function(n,e,t,i,s){this.initFunction(n),(this.options.ecmaVersion>=9||this.options.ecmaVersion>=6&&!i)&&(this.type===k.star&&e&cT&&this.unexpected(),n.generator=this.eat(k.star)),this.options.ecmaVersion>=8&&(n.async=!!i),e&mg&&(n.id=e&BN&&this.type!==k.name?null:this.parseIdent(),n.id&&!(e&cT)&&this.checkLValSimple(n.id,this.strict||n.generator||n.async?this.treatFunctionsAsVar?z1:ml:IN));var r=this.yieldPos,o=this.awaitPos,a=this.awaitIdentPos;return this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,this.enterScope(N1(n.async,n.generator)),e&mg||(n.id=this.type===k.name?this.parseIdent():null),this.parseFunctionParams(n),this.parseFunctionBody(n,t,!1,s),this.yieldPos=r,this.awaitPos=o,this.awaitIdentPos=a,this.finishNode(n,e&mg?"FunctionDeclaration":"FunctionExpression")};Mt.parseFunctionParams=function(n){this.expect(k.parenL),n.params=this.parseBindingList(k.parenR,!1,this.options.ecmaVersion>=8),this.checkYieldAwaitInDefaultParams()};Mt.parseClass=function(n,e){this.next();var t=this.strict;this.strict=!0,this.parseClassId(n,e),this.parseClassSuper(n);var i=this.enterClassBody(),s=this.startNode(),r=!1;for(s.body=[],this.expect(k.braceL);this.type!==k.braceR;){var o=this.parseClassElement(n.superClass!==null);o&&(s.body.push(o),o.type==="MethodDefinition"&&o.kind==="constructor"?(r&&this.raise(o.start,"Duplicate constructor in the same class"),r=!0):o.key&&o.key.type==="PrivateIdentifier"&&N7(i,o)&&this.raiseRecoverable(o.key.start,"Identifier '#"+o.key.name+"' has already been declared"))}return this.strict=t,this.next(),n.body=this.finishNode(s,"ClassBody"),this.exitClassBody(),this.finishNode(n,e?"ClassDeclaration":"ClassExpression")};Mt.parseClassElement=function(n){if(this.eat(k.semi))return null;var e=this.options.ecmaVersion,t=this.startNode(),i="",s=!1,r=!1,o="method",a=!1;if(this.eatContextual("static")){if(e>=13&&this.eat(k.braceL))return this.parseClassStaticBlock(t),t;this.isClassElementNameStart()||this.type===k.star?a=!0:i="static"}if(t.static=a,!i&&e>=8&&this.eatContextual("async")&&((this.isClassElementNameStart()||this.type===k.star)&&!this.canInsertSemicolon()?r=!0:i="async"),!i&&(e>=9||!r)&&this.eat(k.star)&&(s=!0),!i&&!r&&!s){var c=this.value;(this.eatContextual("get")||this.eatContextual("set"))&&(this.isClassElementNameStart()?o=c:i=c)}if(i?(t.computed=!1,t.key=this.startNodeAt(this.lastTokStart,this.lastTokStartLoc),t.key.name=i,this.finishNode(t.key,"Identifier")):this.parseClassElementName(t),e<13||this.type===k.parenL||o!=="method"||s||r){var l=!t.static&&Eb(t,"constructor"),h=l&&n;l&&o!=="method"&&this.raise(t.key.start,"Constructor can't have get/set modifier"),t.kind=l?"constructor":o,this.parseClassMethod(t,s,r,h)}else this.parseClassField(t);return t};Mt.isClassElementNameStart=function(){return this.type===k.name||this.type===k.privateId||this.type===k.num||this.type===k.string||this.type===k.bracketL||this.type.keyword};Mt.parseClassElementName=function(n){this.type===k.privateId?(this.value==="constructor"&&this.raise(this.start,"Classes can't have an element named '#constructor'"),n.computed=!1,n.key=this.parsePrivateIdent()):this.parsePropertyName(n)};Mt.parseClassMethod=function(n,e,t,i){var s=n.key;n.kind==="constructor"?(e&&this.raise(s.start,"Constructor can't be a generator"),t&&this.raise(s.start,"Constructor can't be an async method")):n.static&&Eb(n,"prototype")&&this.raise(s.start,"Classes may not have a static property named prototype");var r=n.value=this.parseMethod(e,t,i);return n.kind==="get"&&r.params.length!==0&&this.raiseRecoverable(r.start,"getter should have no params"),n.kind==="set"&&r.params.length!==1&&this.raiseRecoverable(r.start,"setter should have exactly one param"),n.kind==="set"&&r.params[0].type==="RestElement"&&this.raiseRecoverable(r.params[0].start,"Setter cannot use rest params"),this.finishNode(n,"MethodDefinition")};Mt.parseClassField=function(n){if(Eb(n,"constructor")?this.raise(n.key.start,"Classes can't have a field named 'constructor'"):n.static&&Eb(n,"prototype")&&this.raise(n.key.start,"Classes can't have a static field named 'prototype'"),this.eat(k.eq)){var e=this.currentThisScope(),t=e.inClassFieldInit;e.inClassFieldInit=!0,n.value=this.parseMaybeAssign(),e.inClassFieldInit=t}else n.value=null;return this.semicolon(),this.finishNode(n,"PropertyDefinition")};Mt.parseClassStaticBlock=function(n){n.body=[];var e=this.labels;for(this.labels=[],this.enterScope(JA|F1);this.type!==k.braceR;){var t=this.parseStatement(null);n.body.push(t)}return this.next(),this.exitScope(),this.labels=e,this.finishNode(n,"StaticBlock")};Mt.parseClassId=function(n,e){this.type===k.name?(n.id=this.parseIdent(),e&&this.checkLValSimple(n.id,ml,!1)):(e===!0&&this.unexpected(),n.id=null)};Mt.parseClassSuper=function(n){n.superClass=this.eat(k._extends)?this.parseExprSubscripts(!1):null};Mt.enterClassBody=function(){var n={declared:Object.create(null),used:[]};return this.privateNameStack.push(n),n.declared};Mt.exitClassBody=function(){for(var n=this.privateNameStack.pop(),e=n.declared,t=n.used,i=this.privateNameStack.length,s=i===0?null:this.privateNameStack[i-1],r=0;r<t.length;++r){var o=t[r];YA(e,o.name)||(s?s.used.push(o):this.raiseRecoverable(o.start,"Private field '#"+o.name+"' must be declared in an enclosing class"))}};function N7(n,e){var t=e.key.name,i=n[t],s="true";return e.type==="MethodDefinition"&&(e.kind==="get"||e.kind==="set")&&(s=(e.static?"s":"i")+e.kind),i==="iget"&&s==="iset"||i==="iset"&&s==="iget"||i==="sget"&&s==="sset"||i==="sset"&&s==="sget"?(n[t]="true",!1):i?!0:(n[t]=s,!1)}function Eb(n,e){var t=n.computed,i=n.key;return!t&&(i.type==="Identifier"&&i.name===e||i.type==="Literal"&&i.value===e)}Mt.parseExport=function(n,e){if(this.next(),this.eat(k.star))return this.options.ecmaVersion>=11&&(this.eatContextual("as")?(n.exported=this.parseModuleExportName(),this.checkExport(e,n.exported,this.lastTokStart)):n.exported=null),this.expectContextual("from"),this.type!==k.string&&this.unexpected(),n.source=this.parseExprAtom(),this.semicolon(),this.finishNode(n,"ExportAllDeclaration");if(this.eat(k._default)){this.checkExport(e,"default",this.lastTokStart);var t;if(this.type===k._function||(t=this.isAsyncFunction())){var i=this.startNode();this.next(),t&&this.next(),n.declaration=this.parseFunction(i,mg|BN,!1,t)}else if(this.type===k._class){var s=this.startNode();n.declaration=this.parseClass(s,"nullableID")}else n.declaration=this.parseMaybeAssign(),this.semicolon();return this.finishNode(n,"ExportDefaultDeclaration")}if(this.shouldParseExportStatement())n.declaration=this.parseStatement(null),n.declaration.type==="VariableDeclaration"?this.checkVariableExport(e,n.declaration.declarations):this.checkExport(e,n.declaration.id,n.declaration.id.start),n.specifiers=[],n.source=null;else{if(n.declaration=null,n.specifiers=this.parseExportSpecifiers(e),this.eatContextual("from"))this.type!==k.string&&this.unexpected(),n.source=this.parseExprAtom();else{for(var r=0,o=n.specifiers;r<o.length;r+=1){var a=o[r];this.checkUnreserved(a.local),this.checkLocalExport(a.local),a.local.type==="Literal"&&this.raise(a.local.start,"A string literal cannot be used as an exported binding without `from`.")}n.source=null}this.semicolon()}return this.finishNode(n,"ExportNamedDeclaration")};Mt.checkExport=function(n,e,t){n&&(typeof e!="string"&&(e=e.type==="Identifier"?e.name:e.value),YA(n,e)&&this.raiseRecoverable(t,"Duplicate export '"+e+"'"),n[e]=!0)};Mt.checkPatternExport=function(n,e){var t=e.type;if(t==="Identifier")this.checkExport(n,e,e.start);else if(t==="ObjectPattern")for(var i=0,s=e.properties;i<s.length;i+=1){var r=s[i];this.checkPatternExport(n,r)}else if(t==="ArrayPattern")for(var o=0,a=e.elements;o<a.length;o+=1){var c=a[o];c&&this.checkPatternExport(n,c)}else t==="Property"?this.checkPatternExport(n,e.value):t==="AssignmentPattern"?this.checkPatternExport(n,e.left):t==="RestElement"?this.checkPatternExport(n,e.argument):t==="ParenthesizedExpression"&&this.checkPatternExport(n,e.expression)};Mt.checkVariableExport=function(n,e){if(n)for(var t=0,i=e;t<i.length;t+=1){var s=i[t];this.checkPatternExport(n,s.id)}};Mt.shouldParseExportStatement=function(){return this.type.keyword==="var"||this.type.keyword==="const"||this.type.keyword==="class"||this.type.keyword==="function"||this.isLet()||this.isAsyncFunction()};Mt.parseExportSpecifiers=function(n){var e=[],t=!0;for(this.expect(k.braceL);!this.eat(k.braceR);){if(t)t=!1;else if(this.expect(k.comma),this.afterTrailingComma(k.braceR))break;var i=this.startNode();i.local=this.parseModuleExportName(),i.exported=this.eatContextual("as")?this.parseModuleExportName():i.local,this.checkExport(n,i.exported,i.exported.start),e.push(this.finishNode(i,"ExportSpecifier"))}return e};Mt.parseImport=function(n){return this.next(),this.type===k.string?(n.specifiers=U7,n.source=this.parseExprAtom()):(n.specifiers=this.parseImportSpecifiers(),this.expectContextual("from"),n.source=this.type===k.string?this.parseExprAtom():this.unexpected()),this.semicolon(),this.finishNode(n,"ImportDeclaration")};Mt.parseImportSpecifiers=function(){var n=[],e=!0;if(this.type===k.name){var t=this.startNode();if(t.local=this.parseIdent(),this.checkLValSimple(t.local,ml),n.push(this.finishNode(t,"ImportDefaultSpecifier")),!this.eat(k.comma))return n}if(this.type===k.star){var i=this.startNode();return this.next(),this.expectContextual("as"),i.local=this.parseIdent(),this.checkLValSimple(i.local,ml),n.push(this.finishNode(i,"ImportNamespaceSpecifier")),n}for(this.expect(k.braceL);!this.eat(k.braceR);){if(e)e=!1;else if(this.expect(k.comma),this.afterTrailingComma(k.braceR))break;var s=this.startNode();s.imported=this.parseModuleExportName(),this.eatContextual("as")?s.local=this.parseIdent():(this.checkUnreserved(s.imported),s.local=s.imported),this.checkLValSimple(s.local,ml),n.push(this.finishNode(s,"ImportSpecifier"))}return n};Mt.parseModuleExportName=function(){if(this.options.ecmaVersion>=13&&this.type===k.string){var n=this.parseLiteral(this.value);return D7.test(n.value)&&this.raise(n.start,"An export name cannot include a lone surrogate."),n}return this.parseIdent(!0)};Mt.adaptDirectivePrologue=function(n){for(var e=0;e<n.length&&this.isDirectiveCandidate(n[e]);++e)n[e].directive=n[e].expression.raw.slice(1,-1)};Mt.isDirectiveCandidate=function(n){return this.options.ecmaVersion>=5&&n.type==="ExpressionStatement"&&n.expression.type==="Literal"&&typeof n.expression.value=="string"&&(this.input[n.start]==='"'||this.input[n.start]==="'")};var ba=os.prototype;ba.toAssignable=function(n,e,t){if(this.options.ecmaVersion>=6&&n)switch(n.type){case"Identifier":this.inAsync&&n.name==="await"&&this.raise(n.start,"Cannot use 'await' as identifier inside an async function");break;case"ObjectPattern":case"ArrayPattern":case"AssignmentPattern":case"RestElement":break;case"ObjectExpression":n.type="ObjectPattern",t&&this.checkPatternErrors(t,!0);for(var i=0,s=n.properties;i<s.length;i+=1){var r=s[i];this.toAssignable(r,e),r.type==="RestElement"&&(r.argument.type==="ArrayPattern"||r.argument.type==="ObjectPattern")&&this.raise(r.argument.start,"Unexpected token")}break;case"Property":n.kind!=="init"&&this.raise(n.key.start,"Object pattern can't contain getter or setter"),this.toAssignable(n.value,e);break;case"ArrayExpression":n.type="ArrayPattern",t&&this.checkPatternErrors(t,!0),this.toAssignableList(n.elements,e);break;case"SpreadElement":n.type="RestElement",this.toAssignable(n.argument,e),n.argument.type==="AssignmentPattern"&&this.raise(n.argument.start,"Rest elements cannot have a default value");break;case"AssignmentExpression":n.operator!=="="&&this.raise(n.left.end,"Only '=' operator can be used for specifying default value."),n.type="AssignmentPattern",delete n.operator,this.toAssignable(n.left,e);break;case"ParenthesizedExpression":this.toAssignable(n.expression,e,t);break;case"ChainExpression":this.raiseRecoverable(n.start,"Optional chaining cannot appear in left-hand side");break;case"MemberExpression":if(!e)break;default:this.raise(n.start,"Assigning to rvalue")}else t&&this.checkPatternErrors(t,!0);return n};ba.toAssignableList=function(n,e){for(var t=n.length,i=0;i<t;i++){var s=n[i];s&&this.toAssignable(s,e)}if(t){var r=n[t-1];this.options.ecmaVersion===6&&e&&r&&r.type==="RestElement"&&r.argument.type!=="Identifier"&&this.unexpected(r.argument.start)}return n};ba.parseSpread=function(n){var e=this.startNode();return this.next(),e.argument=this.parseMaybeAssign(!1,n),this.finishNode(e,"SpreadElement")};ba.parseRestBinding=function(){var n=this.startNode();return this.next(),this.options.ecmaVersion===6&&this.type!==k.name&&this.unexpected(),n.argument=this.parseBindingAtom(),this.finishNode(n,"RestElement")};ba.parseBindingAtom=function(){if(this.options.ecmaVersion>=6)switch(this.type){case k.bracketL:var n=this.startNode();return this.next(),n.elements=this.parseBindingList(k.bracketR,!0,!0),this.finishNode(n,"ArrayPattern");case k.braceL:return this.parseObj(!0)}return this.parseIdent()};ba.parseBindingList=function(n,e,t){for(var i=[],s=!0;!this.eat(n);)if(s?s=!1:this.expect(k.comma),e&&this.type===k.comma)i.push(null);else{if(t&&this.afterTrailingComma(n))break;if(this.type===k.ellipsis){var r=this.parseRestBinding();this.parseBindingListItem(r),i.push(r),this.type===k.comma&&this.raise(this.start,"Comma is not permitted after the rest element"),this.expect(n);break}else{var o=this.parseMaybeDefault(this.start,this.startLoc);this.parseBindingListItem(o),i.push(o)}}return i};ba.parseBindingListItem=function(n){return n};ba.parseMaybeDefault=function(n,e,t){if(t=t||this.parseBindingAtom(),this.options.ecmaVersion<6||!this.eat(k.eq))return t;var i=this.startNodeAt(n,e);return i.left=t,i.right=this.parseMaybeAssign(),this.finishNode(i,"AssignmentPattern")};ba.checkLValSimple=function(n,e,t){e===void 0&&(e=Cb);var i=e!==Cb;switch(n.type){case"Identifier":this.strict&&this.reservedWordsStrictBind.test(n.name)&&this.raiseRecoverable(n.start,(i?"Binding ":"Assigning to ")+n.name+" in strict mode"),i&&(e===ml&&n.name==="let"&&this.raiseRecoverable(n.start,"let is disallowed as a lexically bound name"),t&&(YA(t,n.name)&&this.raiseRecoverable(n.start,"Argument name clash"),t[n.name]=!0),e!==PN&&this.declareName(n.name,e,n.start));break;case"ChainExpression":this.raiseRecoverable(n.start,"Optional chaining cannot appear in left-hand side");break;case"MemberExpression":i&&this.raiseRecoverable(n.start,"Binding member expression");break;case"ParenthesizedExpression":return i&&this.raiseRecoverable(n.start,"Binding parenthesized expression"),this.checkLValSimple(n.expression,e,t);default:this.raise(n.start,(i?"Binding":"Assigning to")+" rvalue")}};ba.checkLValPattern=function(n,e,t){switch(e===void 0&&(e=Cb),n.type){case"ObjectPattern":for(var i=0,s=n.properties;i<s.length;i+=1){var r=s[i];this.checkLValInnerPattern(r,e,t)}break;case"ArrayPattern":for(var o=0,a=n.elements;o<a.length;o+=1){var c=a[o];c&&this.checkLValInnerPattern(c,e,t)}break;default:this.checkLValSimple(n,e,t)}};ba.checkLValInnerPattern=function(n,e,t){switch(e===void 0&&(e=Cb),n.type){case"Property":this.checkLValInnerPattern(n.value,e,t);break;case"AssignmentPattern":this.checkLValPattern(n.left,e,t);break;case"RestElement":this.checkLValPattern(n.argument,e,t);break;default:this.checkLValPattern(n,e,t)}};var Ko=function(e,t,i,s,r){this.token=e,this.isExpr=!!t,this.preserveSpace=!!i,this.override=s,this.generator=!!r},Ki={b_stat:new Ko("{",!1),b_expr:new Ko("{",!0),b_tmpl:new Ko("${",!1),p_stat:new Ko("(",!1),p_expr:new Ko("(",!0),q_tmpl:new Ko("`",!0,!0,function(n){return n.tryReadTemplateToken()}),f_stat:new Ko("function",!1),f_expr:new Ko("function",!0),f_expr_gen:new Ko("function",!0,!1,null,!0),f_gen:new Ko("function",!1,!1,null,!0)},zp=os.prototype;zp.initialContext=function(){return[Ki.b_stat]};zp.curContext=function(){return this.context[this.context.length-1]};zp.braceIsBlock=function(n){var e=this.curContext();return e===Ki.f_expr||e===Ki.f_stat?!0:n===k.colon&&(e===Ki.b_stat||e===Ki.b_expr)?!e.isExpr:n===k._return||n===k.name&&this.exprAllowed?Vo.test(this.input.slice(this.lastTokEnd,this.start)):n===k._else||n===k.semi||n===k.eof||n===k.parenR||n===k.arrow?!0:n===k.braceL?e===Ki.b_stat:n===k._var||n===k._const||n===k.name?!1:!this.exprAllowed};zp.inGeneratorContext=function(){for(var n=this.context.length-1;n>=1;n--){var e=this.context[n];if(e.token==="function")return e.generator}return!1};zp.updateContext=function(n){var e,t=this.type;t.keyword&&n===k.dot?this.exprAllowed=!1:(e=t.updateContext)?e.call(this,n):this.exprAllowed=t.beforeExpr};zp.overrideContext=function(n){this.curContext()!==n&&(this.context[this.context.length-1]=n)};k.parenR.updateContext=k.braceR.updateContext=function(){if(this.context.length===1){this.exprAllowed=!0;return}var n=this.context.pop();n===Ki.b_stat&&this.curContext().token==="function"&&(n=this.context.pop()),this.exprAllowed=!n.isExpr};k.braceL.updateContext=function(n){this.context.push(this.braceIsBlock(n)?Ki.b_stat:Ki.b_expr),this.exprAllowed=!0};k.dollarBraceL.updateContext=function(){this.context.push(Ki.b_tmpl),this.exprAllowed=!0};k.parenL.updateContext=function(n){var e=n===k._if||n===k._for||n===k._with||n===k._while;this.context.push(e?Ki.p_stat:Ki.p_expr),this.exprAllowed=!0};k.incDec.updateContext=function(){};k._function.updateContext=k._class.updateContext=function(n){n.beforeExpr&&n!==k._else&&!(n===k.semi&&this.curContext()!==Ki.p_stat)&&!(n===k._return&&Vo.test(this.input.slice(this.lastTokEnd,this.start)))&&!((n===k.colon||n===k.braceL)&&this.curContext()===Ki.b_stat)?this.context.push(Ki.f_expr):this.context.push(Ki.f_stat),this.exprAllowed=!1};k.backQuote.updateContext=function(){this.curContext()===Ki.q_tmpl?this.context.pop():this.context.push(Ki.q_tmpl),this.exprAllowed=!1};k.star.updateContext=function(n){if(n===k._function){var e=this.context.length-1;this.context[e]===Ki.f_expr?this.context[e]=Ki.f_expr_gen:this.context[e]=Ki.f_gen}this.exprAllowed=!0};k.name.updateContext=function(n){var e=!1;this.options.ecmaVersion>=6&&n!==k.dot&&(this.value==="of"&&!this.exprAllowed||this.value==="yield"&&this.inGeneratorContext())&&(e=!0),this.exprAllowed=e};var Yt=os.prototype;Yt.checkPropClash=function(n,e,t){if(!(this.options.ecmaVersion>=9&&n.type==="SpreadElement")&&!(this.options.ecmaVersion>=6&&(n.computed||n.method||n.shorthand))){var i=n.key,s;switch(i.type){case"Identifier":s=i.name;break;case"Literal":s=String(i.value);break;default:return}var r=n.kind;if(this.options.ecmaVersion>=6){s==="__proto__"&&r==="init"&&(e.proto&&(t?t.doubleProto<0&&(t.doubleProto=i.start):this.raiseRecoverable(i.start,"Redefinition of __proto__ property")),e.proto=!0);return}s="$"+s;var o=e[s];if(o){var a;r==="init"?a=this.strict&&o.init||o.get||o.set:a=o.init||o[r],a&&this.raiseRecoverable(i.start,"Redefinition of property")}else o=e[s]={init:!1,get:!1,set:!1};o[r]=!0}};Yt.parseExpression=function(n,e){var t=this.start,i=this.startLoc,s=this.parseMaybeAssign(n,e);if(this.type===k.comma){var r=this.startNodeAt(t,i);for(r.expressions=[s];this.eat(k.comma);)r.expressions.push(this.parseMaybeAssign(n,e));return this.finishNode(r,"SequenceExpression")}return s};Yt.parseMaybeAssign=function(n,e,t){if(this.isContextual("yield")){if(this.inGenerator)return this.parseYield(n);this.exprAllowed=!1}var i=!1,s=-1,r=-1,o=-1;e?(s=e.parenthesizedAssign,r=e.trailingComma,o=e.doubleProto,e.parenthesizedAssign=e.trailingComma=-1):(e=new vx,i=!0);var a=this.start,c=this.startLoc;(this.type===k.parenL||this.type===k.name)&&(this.potentialArrowAt=this.start,this.potentialArrowInForAwait=n==="await");var l=this.parseMaybeConditional(n,e);if(t&&(l=t.call(this,l,a,c)),this.type.isAssign){var h=this.startNodeAt(a,c);return h.operator=this.value,this.type===k.eq&&(l=this.toAssignable(l,!1,e)),i||(e.parenthesizedAssign=e.trailingComma=e.doubleProto=-1),e.shorthandAssign>=l.start&&(e.shorthandAssign=-1),this.type===k.eq?this.checkLValPattern(l):this.checkLValSimple(l),h.left=l,this.next(),h.right=this.parseMaybeAssign(n),o>-1&&(e.doubleProto=o),this.finishNode(h,"AssignmentExpression")}else i&&this.checkExpressionErrors(e,!0);return s>-1&&(e.parenthesizedAssign=s),r>-1&&(e.trailingComma=r),l};Yt.parseMaybeConditional=function(n,e){var t=this.start,i=this.startLoc,s=this.parseExprOps(n,e);if(this.checkExpressionErrors(e))return s;if(this.eat(k.question)){var r=this.startNodeAt(t,i);return r.test=s,r.consequent=this.parseMaybeAssign(),this.expect(k.colon),r.alternate=this.parseMaybeAssign(n),this.finishNode(r,"ConditionalExpression")}return s};Yt.parseExprOps=function(n,e){var t=this.start,i=this.startLoc,s=this.parseMaybeUnary(e,!1,!1,n);return this.checkExpressionErrors(e)||s.start===t&&s.type==="ArrowFunctionExpression"?s:this.parseExprOp(s,t,i,-1,n)};Yt.parseExprOp=function(n,e,t,i,s){var r=this.type.binop;if(r!=null&&(!s||this.type!==k._in)&&r>i){var o=this.type===k.logicalOR||this.type===k.logicalAND,a=this.type===k.coalesce;a&&(r=k.logicalAND.binop);var c=this.value;this.next();var l=this.start,h=this.startLoc,d=this.parseExprOp(this.parseMaybeUnary(null,!1,!1,s),l,h,r,s),f=this.buildBinary(e,t,n,d,c,o||a);return(o&&this.type===k.coalesce||a&&(this.type===k.logicalOR||this.type===k.logicalAND))&&this.raiseRecoverable(this.start,"Logical expressions and coalesce expressions cannot be mixed. Wrap either by parentheses"),this.parseExprOp(f,e,t,i,s)}return n};Yt.buildBinary=function(n,e,t,i,s,r){i.type==="PrivateIdentifier"&&this.raise(i.start,"Private identifier can only be left side of binary expression");var o=this.startNodeAt(n,e);return o.left=t,o.operator=s,o.right=i,this.finishNode(o,r?"LogicalExpression":"BinaryExpression")};Yt.parseMaybeUnary=function(n,e,t,i){var s=this.start,r=this.startLoc,o;if(this.isContextual("await")&&this.canAwait)o=this.parseAwait(i),e=!0;else if(this.type.prefix){var a=this.startNode(),c=this.type===k.incDec;a.operator=this.value,a.prefix=!0,this.next(),a.argument=this.parseMaybeUnary(null,!0,c,i),this.checkExpressionErrors(n,!0),c?this.checkLValSimple(a.argument):this.strict&&a.operator==="delete"&&a.argument.type==="Identifier"?this.raiseRecoverable(a.start,"Deleting local variable in strict mode"):a.operator==="delete"&&DN(a.argument)?this.raiseRecoverable(a.start,"Private fields can not be deleted"):e=!0,o=this.finishNode(a,c?"UpdateExpression":"UnaryExpression")}else if(!e&&this.type===k.privateId)(i||this.privateNameStack.length===0)&&this.unexpected(),o=this.parsePrivateIdent(),this.type!==k._in&&this.unexpected();else{if(o=this.parseExprSubscripts(n,i),this.checkExpressionErrors(n))return o;for(;this.type.postfix&&!this.canInsertSemicolon();){var l=this.startNodeAt(s,r);l.operator=this.value,l.prefix=!1,l.argument=o,this.checkLValSimple(o),this.next(),o=this.finishNode(l,"UpdateExpression")}}if(!t&&this.eat(k.starstar))if(e)this.unexpected(this.lastTokStart);else return this.buildBinary(s,r,o,this.parseMaybeUnary(null,!1,!1,i),"**",!1);else return o};function DN(n){return n.type==="MemberExpression"&&n.property.type==="PrivateIdentifier"||n.type==="ChainExpression"&&DN(n.expression)}Yt.parseExprSubscripts=function(n,e){var t=this.start,i=this.startLoc,s=this.parseExprAtom(n,e);if(s.type==="ArrowFunctionExpression"&&this.input.slice(this.lastTokStart,this.lastTokEnd)!==")")return s;var r=this.parseSubscripts(s,t,i,!1,e);return n&&r.type==="MemberExpression"&&(n.parenthesizedAssign>=r.start&&(n.parenthesizedAssign=-1),n.parenthesizedBind>=r.start&&(n.parenthesizedBind=-1),n.trailingComma>=r.start&&(n.trailingComma=-1)),r};Yt.parseSubscripts=function(n,e,t,i,s){for(var r=this.options.ecmaVersion>=8&&n.type==="Identifier"&&n.name==="async"&&this.lastTokEnd===n.end&&!this.canInsertSemicolon()&&n.end-n.start===5&&this.potentialArrowAt===n.start,o=!1;;){var a=this.parseSubscript(n,e,t,i,r,o,s);if(a.optional&&(o=!0),a===n||a.type==="ArrowFunctionExpression"){if(o){var c=this.startNodeAt(e,t);c.expression=a,a=this.finishNode(c,"ChainExpression")}return a}n=a}};Yt.parseSubscript=function(n,e,t,i,s,r,o){var a=this.options.ecmaVersion>=11,c=a&&this.eat(k.questionDot);i&&c&&this.raise(this.lastTokStart,"Optional chaining cannot appear in the callee of new expressions");var l=this.eat(k.bracketL);if(l||c&&this.type!==k.parenL&&this.type!==k.backQuote||this.eat(k.dot)){var h=this.startNodeAt(e,t);h.object=n,l?(h.property=this.parseExpression(),this.expect(k.bracketR)):this.type===k.privateId&&n.type!=="Super"?h.property=this.parsePrivateIdent():h.property=this.parseIdent(this.options.allowReserved!=="never"),h.computed=!!l,a&&(h.optional=c),n=this.finishNode(h,"MemberExpression")}else if(!i&&this.eat(k.parenL)){var d=new vx,f=this.yieldPos,p=this.awaitPos,m=this.awaitIdentPos;this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0;var g=this.parseExprList(k.parenR,this.options.ecmaVersion>=8,!1,d);if(s&&!c&&!this.canInsertSemicolon()&&this.eat(k.arrow))return this.checkPatternErrors(d,!1),this.checkYieldAwaitInDefaultParams(),this.awaitIdentPos>0&&this.raise(this.awaitIdentPos,"Cannot use 'await' as identifier inside an async function"),this.yieldPos=f,this.awaitPos=p,this.awaitIdentPos=m,this.parseArrowExpression(this.startNodeAt(e,t),g,!0,o);this.checkExpressionErrors(d,!0),this.yieldPos=f||this.yieldPos,this.awaitPos=p||this.awaitPos,this.awaitIdentPos=m||this.awaitIdentPos;var y=this.startNodeAt(e,t);y.callee=n,y.arguments=g,a&&(y.optional=c),n=this.finishNode(y,"CallExpression")}else if(this.type===k.backQuote){(c||r)&&this.raise(this.start,"Optional chaining cannot appear in the tag of tagged template expressions");var A=this.startNodeAt(e,t);A.tag=n,A.quasi=this.parseTemplate({isTagged:!0}),n=this.finishNode(A,"TaggedTemplateExpression")}return n};Yt.parseExprAtom=function(n,e){this.type===k.slash&&this.readRegexp();var t,i=this.potentialArrowAt===this.start;switch(this.type){case k._super:return this.allowSuper||this.raise(this.start,"'super' keyword outside a method"),t=this.startNode(),this.next(),this.type===k.parenL&&!this.allowDirectSuper&&this.raise(t.start,"super() call outside constructor of a subclass"),this.type!==k.dot&&this.type!==k.bracketL&&this.type!==k.parenL&&this.unexpected(),this.finishNode(t,"Super");case k._this:return t=this.startNode(),this.next(),this.finishNode(t,"ThisExpression");case k.name:var s=this.start,r=this.startLoc,o=this.containsEsc,a=this.parseIdent(!1);if(this.options.ecmaVersion>=8&&!o&&a.name==="async"&&!this.canInsertSemicolon()&&this.eat(k._function))return this.overrideContext(Ki.f_expr),this.parseFunction(this.startNodeAt(s,r),0,!1,!0,e);if(i&&!this.canInsertSemicolon()){if(this.eat(k.arrow))return this.parseArrowExpression(this.startNodeAt(s,r),[a],!1,e);if(this.options.ecmaVersion>=8&&a.name==="async"&&this.type===k.name&&!o&&(!this.potentialArrowInForAwait||this.value!=="of"||this.containsEsc))return a=this.parseIdent(!1),(this.canInsertSemicolon()||!this.eat(k.arrow))&&this.unexpected(),this.parseArrowExpression(this.startNodeAt(s,r),[a],!0,e)}return a;case k.regexp:var c=this.value;return t=this.parseLiteral(c.value),t.regex={pattern:c.pattern,flags:c.flags},t;case k.num:case k.string:return this.parseLiteral(this.value);case k._null:case k._true:case k._false:return t=this.startNode(),t.value=this.type===k._null?null:this.type===k._true,t.raw=this.type.keyword,this.next(),this.finishNode(t,"Literal");case k.parenL:var l=this.start,h=this.parseParenAndDistinguishExpression(i,e);return n&&(n.parenthesizedAssign<0&&!this.isSimpleAssignTarget(h)&&(n.parenthesizedAssign=l),n.parenthesizedBind<0&&(n.parenthesizedBind=l)),h;case k.bracketL:return t=this.startNode(),this.next(),t.elements=this.parseExprList(k.bracketR,!0,!0,n),this.finishNode(t,"ArrayExpression");case k.braceL:return this.overrideContext(Ki.b_expr),this.parseObj(!1,n);case k._function:return t=this.startNode(),this.next(),this.parseFunction(t,0);case k._class:return this.parseClass(this.startNode(),!1);case k._new:return this.parseNew();case k.backQuote:return this.parseTemplate();case k._import:return this.options.ecmaVersion>=11?this.parseExprImport():this.unexpected();default:this.unexpected()}};Yt.parseExprImport=function(){var n=this.startNode();this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword import");var e=this.parseIdent(!0);switch(this.type){case k.parenL:return this.parseDynamicImport(n);case k.dot:return n.meta=e,this.parseImportMeta(n);default:this.unexpected()}};Yt.parseDynamicImport=function(n){if(this.next(),n.source=this.parseMaybeAssign(),!this.eat(k.parenR)){var e=this.start;this.eat(k.comma)&&this.eat(k.parenR)?this.raiseRecoverable(e,"Trailing comma is not allowed in import()"):this.unexpected(e)}return this.finishNode(n,"ImportExpression")};Yt.parseImportMeta=function(n){this.next();var e=this.containsEsc;return n.property=this.parseIdent(!0),n.property.name!=="meta"&&this.raiseRecoverable(n.property.start,"The only valid meta property for import is 'import.meta'"),e&&this.raiseRecoverable(n.start,"'import.meta' must not contain escaped characters"),this.options.sourceType!=="module"&&!this.options.allowImportExportEverywhere&&this.raiseRecoverable(n.start,"Cannot use 'import.meta' outside a module"),this.finishNode(n,"MetaProperty")};Yt.parseLiteral=function(n){var e=this.startNode();return e.value=n,e.raw=this.input.slice(this.start,this.end),e.raw.charCodeAt(e.raw.length-1)===110&&(e.bigint=e.raw.slice(0,-1).replace(/_/g,"")),this.next(),this.finishNode(e,"Literal")};Yt.parseParenExpression=function(){this.expect(k.parenL);var n=this.parseExpression();return this.expect(k.parenR),n};Yt.parseParenAndDistinguishExpression=function(n,e){var t=this.start,i=this.startLoc,s,r=this.options.ecmaVersion>=8;if(this.options.ecmaVersion>=6){this.next();var o=this.start,a=this.startLoc,c=[],l=!0,h=!1,d=new vx,f=this.yieldPos,p=this.awaitPos,m;for(this.yieldPos=0,this.awaitPos=0;this.type!==k.parenR;)if(l?l=!1:this.expect(k.comma),r&&this.afterTrailingComma(k.parenR,!0)){h=!0;break}else if(this.type===k.ellipsis){m=this.start,c.push(this.parseParenItem(this.parseRestBinding())),this.type===k.comma&&this.raise(this.start,"Comma is not permitted after the rest element");break}else c.push(this.parseMaybeAssign(!1,d,this.parseParenItem));var g=this.lastTokEnd,y=this.lastTokEndLoc;if(this.expect(k.parenR),n&&!this.canInsertSemicolon()&&this.eat(k.arrow))return this.checkPatternErrors(d,!1),this.checkYieldAwaitInDefaultParams(),this.yieldPos=f,this.awaitPos=p,this.parseParenArrowList(t,i,c,e);(!c.length||h)&&this.unexpected(this.lastTokStart),m&&this.unexpected(m),this.checkExpressionErrors(d,!0),this.yieldPos=f||this.yieldPos,this.awaitPos=p||this.awaitPos,c.length>1?(s=this.startNodeAt(o,a),s.expressions=c,this.finishNodeAt(s,"SequenceExpression",g,y)):s=c[0]}else s=this.parseParenExpression();if(this.options.preserveParens){var A=this.startNodeAt(t,i);return A.expression=s,this.finishNode(A,"ParenthesizedExpression")}else return s};Yt.parseParenItem=function(n){return n};Yt.parseParenArrowList=function(n,e,t,i){return this.parseArrowExpression(this.startNodeAt(n,e),t,!1,i)};var z7=[];Yt.parseNew=function(){this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword new");var n=this.startNode(),e=this.parseIdent(!0);if(this.options.ecmaVersion>=6&&this.eat(k.dot)){n.meta=e;var t=this.containsEsc;return n.property=this.parseIdent(!0),n.property.name!=="target"&&this.raiseRecoverable(n.property.start,"The only valid meta property for new is 'new.target'"),t&&this.raiseRecoverable(n.start,"'new.target' must not contain escaped characters"),this.allowNewDotTarget||this.raiseRecoverable(n.start,"'new.target' can only be used in functions and class static block"),this.finishNode(n,"MetaProperty")}var i=this.start,s=this.startLoc,r=this.type===k._import;return n.callee=this.parseSubscripts(this.parseExprAtom(),i,s,!0,!1),r&&n.callee.type==="ImportExpression"&&this.raise(i,"Cannot use new with import()"),this.eat(k.parenL)?n.arguments=this.parseExprList(k.parenR,this.options.ecmaVersion>=8,!1):n.arguments=z7,this.finishNode(n,"NewExpression")};Yt.parseTemplateElement=function(n){var e=n.isTagged,t=this.startNode();return this.type===k.invalidTemplate?(e||this.raiseRecoverable(this.start,"Bad escape sequence in untagged template literal"),t.value={raw:this.value,cooked:null}):t.value={raw:this.input.slice(this.start,this.end).replace(/\r\n?/g,`
`),cooked:this.value},this.next(),t.tail=this.type===k.backQuote,this.finishNode(t,"TemplateElement")};Yt.parseTemplate=function(n){n===void 0&&(n={});var e=n.isTagged;e===void 0&&(e=!1);var t=this.startNode();this.next(),t.expressions=[];var i=this.parseTemplateElement({isTagged:e});for(t.quasis=[i];!i.tail;)this.type===k.eof&&this.raise(this.pos,"Unterminated template literal"),this.expect(k.dollarBraceL),t.expressions.push(this.parseExpression()),this.expect(k.braceR),t.quasis.push(i=this.parseTemplateElement({isTagged:e}));return this.next(),this.finishNode(t,"TemplateLiteral")};Yt.isAsyncProp=function(n){return!n.computed&&n.key.type==="Identifier"&&n.key.name==="async"&&(this.type===k.name||this.type===k.num||this.type===k.string||this.type===k.bracketL||this.type.keyword||this.options.ecmaVersion>=9&&this.type===k.star)&&!Vo.test(this.input.slice(this.lastTokEnd,this.start))};Yt.parseObj=function(n,e){var t=this.startNode(),i=!0,s={};for(t.properties=[],this.next();!this.eat(k.braceR);){if(i)i=!1;else if(this.expect(k.comma),this.options.ecmaVersion>=5&&this.afterTrailingComma(k.braceR))break;var r=this.parseProperty(n,e);n||this.checkPropClash(r,s,e),t.properties.push(r)}return this.finishNode(t,n?"ObjectPattern":"ObjectExpression")};Yt.parseProperty=function(n,e){var t=this.startNode(),i,s,r,o;if(this.options.ecmaVersion>=9&&this.eat(k.ellipsis))return n?(t.argument=this.parseIdent(!1),this.type===k.comma&&this.raise(this.start,"Comma is not permitted after the rest element"),this.finishNode(t,"RestElement")):(t.argument=this.parseMaybeAssign(!1,e),this.type===k.comma&&e&&e.trailingComma<0&&(e.trailingComma=this.start),this.finishNode(t,"SpreadElement"));this.options.ecmaVersion>=6&&(t.method=!1,t.shorthand=!1,(n||e)&&(r=this.start,o=this.startLoc),n||(i=this.eat(k.star)));var a=this.containsEsc;return this.parsePropertyName(t),!n&&!a&&this.options.ecmaVersion>=8&&!i&&this.isAsyncProp(t)?(s=!0,i=this.options.ecmaVersion>=9&&this.eat(k.star),this.parsePropertyName(t,e)):s=!1,this.parsePropertyValue(t,n,i,s,r,o,e,a),this.finishNode(t,"Property")};Yt.parsePropertyValue=function(n,e,t,i,s,r,o,a){if((t||i)&&this.type===k.colon&&this.unexpected(),this.eat(k.colon))n.value=e?this.parseMaybeDefault(this.start,this.startLoc):this.parseMaybeAssign(!1,o),n.kind="init";else if(this.options.ecmaVersion>=6&&this.type===k.parenL)e&&this.unexpected(),n.kind="init",n.method=!0,n.value=this.parseMethod(t,i);else if(!e&&!a&&this.options.ecmaVersion>=5&&!n.computed&&n.key.type==="Identifier"&&(n.key.name==="get"||n.key.name==="set")&&this.type!==k.comma&&this.type!==k.braceR&&this.type!==k.eq){(t||i)&&this.unexpected(),n.kind=n.key.name,this.parsePropertyName(n),n.value=this.parseMethod(!1);var c=n.kind==="get"?0:1;if(n.value.params.length!==c){var l=n.value.start;n.kind==="get"?this.raiseRecoverable(l,"getter should have no params"):this.raiseRecoverable(l,"setter should have exactly one param")}else n.kind==="set"&&n.value.params[0].type==="RestElement"&&this.raiseRecoverable(n.value.params[0].start,"Setter cannot use rest params")}else this.options.ecmaVersion>=6&&!n.computed&&n.key.type==="Identifier"?((t||i)&&this.unexpected(),this.checkUnreserved(n.key),n.key.name==="await"&&!this.awaitIdentPos&&(this.awaitIdentPos=s),n.kind="init",e?n.value=this.parseMaybeDefault(s,r,this.copyNode(n.key)):this.type===k.eq&&o?(o.shorthandAssign<0&&(o.shorthandAssign=this.start),n.value=this.parseMaybeDefault(s,r,this.copyNode(n.key))):n.value=this.copyNode(n.key),n.shorthand=!0):this.unexpected()};Yt.parsePropertyName=function(n){if(this.options.ecmaVersion>=6){if(this.eat(k.bracketL))return n.computed=!0,n.key=this.parseMaybeAssign(),this.expect(k.bracketR),n.key;n.computed=!1}return n.key=this.type===k.num||this.type===k.string?this.parseExprAtom():this.parseIdent(this.options.allowReserved!=="never")};Yt.initFunction=function(n){n.id=null,this.options.ecmaVersion>=6&&(n.generator=n.expression=!1),this.options.ecmaVersion>=8&&(n.async=!1)};Yt.parseMethod=function(n,e,t){var i=this.startNode(),s=this.yieldPos,r=this.awaitPos,o=this.awaitIdentPos;return this.initFunction(i),this.options.ecmaVersion>=6&&(i.generator=n),this.options.ecmaVersion>=8&&(i.async=!!e),this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,this.enterScope(N1(e,i.generator)|F1|(t?MN:0)),this.expect(k.parenL),i.params=this.parseBindingList(k.parenR,!1,this.options.ecmaVersion>=8),this.checkYieldAwaitInDefaultParams(),this.parseFunctionBody(i,!1,!0,!1),this.yieldPos=s,this.awaitPos=r,this.awaitIdentPos=o,this.finishNode(i,"FunctionExpression")};Yt.parseArrowExpression=function(n,e,t,i){var s=this.yieldPos,r=this.awaitPos,o=this.awaitIdentPos;return this.enterScope(N1(t,!1)|EN),this.initFunction(n),this.options.ecmaVersion>=8&&(n.async=!!t),this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,n.params=this.toAssignableList(e,!0),this.parseFunctionBody(n,!0,!1,i),this.yieldPos=s,this.awaitPos=r,this.awaitIdentPos=o,this.finishNode(n,"ArrowFunctionExpression")};Yt.parseFunctionBody=function(n,e,t,i){var s=e&&this.type!==k.braceL,r=this.strict,o=!1;if(s)n.body=this.parseMaybeAssign(i),n.expression=!0,this.checkParams(n,!1);else{var a=this.options.ecmaVersion>=7&&!this.isSimpleParamList(n.params);(!r||a)&&(o=this.strictDirective(this.end),o&&a&&this.raiseRecoverable(n.start,"Illegal 'use strict' directive in function with non-simple parameter list"));var c=this.labels;this.labels=[],o&&(this.strict=!0),this.checkParams(n,!r&&!o&&!e&&!t&&this.isSimpleParamList(n.params)),this.strict&&n.id&&this.checkLValSimple(n.id,PN),n.body=this.parseBlock(!1,void 0,o&&!r),n.expression=!1,this.adaptDirectivePrologue(n.body.body),this.labels=c}this.exitScope()};Yt.isSimpleParamList=function(n){for(var e=0,t=n;e<t.length;e+=1){var i=t[e];if(i.type!=="Identifier")return!1}return!0};Yt.checkParams=function(n,e){for(var t=Object.create(null),i=0,s=n.params;i<s.length;i+=1){var r=s[i];this.checkLValInnerPattern(r,z1,e?null:t)}};Yt.parseExprList=function(n,e,t,i){for(var s=[],r=!0;!this.eat(n);){if(r)r=!1;else if(this.expect(k.comma),e&&this.afterTrailingComma(n))break;var o=void 0;t&&this.type===k.comma?o=null:this.type===k.ellipsis?(o=this.parseSpread(i),i&&this.type===k.comma&&i.trailingComma<0&&(i.trailingComma=this.start)):o=this.parseMaybeAssign(!1,i),s.push(o)}return s};Yt.checkUnreserved=function(n){var e=n.start,t=n.end,i=n.name;if(this.inGenerator&&i==="yield"&&this.raiseRecoverable(e,"Cannot use 'yield' as identifier inside a generator"),this.inAsync&&i==="await"&&this.raiseRecoverable(e,"Cannot use 'await' as identifier inside an async function"),this.currentThisScope().inClassFieldInit&&i==="arguments"&&this.raiseRecoverable(e,"Cannot use 'arguments' in class field initializer"),this.inClassStaticBlock&&(i==="arguments"||i==="await")&&this.raise(e,"Cannot use "+i+" in class static initialization block"),this.keywords.test(i)&&this.raise(e,"Unexpected keyword '"+i+"'"),!(this.options.ecmaVersion<6&&this.input.slice(e,t).indexOf("\\")!==-1)){var s=this.strict?this.reservedWordsStrict:this.reservedWords;s.test(i)&&(!this.inAsync&&i==="await"&&this.raiseRecoverable(e,"Cannot use keyword 'await' outside an async function"),this.raiseRecoverable(e,"The keyword '"+i+"' is reserved"))}};Yt.parseIdent=function(n,e){var t=this.startNode();return this.type===k.name?t.name=this.value:this.type.keyword?(t.name=this.type.keyword,(t.name==="class"||t.name==="function")&&(this.lastTokEnd!==this.lastTokStart+1||this.input.charCodeAt(this.lastTokStart)!==46)&&this.context.pop()):this.unexpected(),this.next(!!n),this.finishNode(t,"Identifier"),n||(this.checkUnreserved(t),t.name==="await"&&!this.awaitIdentPos&&(this.awaitIdentPos=t.start)),t};Yt.parsePrivateIdent=function(){var n=this.startNode();return this.type===k.privateId?n.name=this.value:this.unexpected(),this.next(),this.finishNode(n,"PrivateIdentifier"),this.privateNameStack.length===0?this.raise(n.start,"Private field '#"+n.name+"' must be declared in an enclosing class"):this.privateNameStack[this.privateNameStack.length-1].used.push(n),n};Yt.parseYield=function(n){this.yieldPos||(this.yieldPos=this.start);var e=this.startNode();return this.next(),this.type===k.semi||this.canInsertSemicolon()||this.type!==k.star&&!this.type.startsExpr?(e.delegate=!1,e.argument=null):(e.delegate=this.eat(k.star),e.argument=this.parseMaybeAssign(n)),this.finishNode(e,"YieldExpression")};Yt.parseAwait=function(n){this.awaitPos||(this.awaitPos=this.start);var e=this.startNode();return this.next(),e.argument=this.parseMaybeUnary(null,!0,!1,n),this.finishNode(e,"AwaitExpression")};var Tb=os.prototype;Tb.raise=function(n,e){var t=SN(this.input,n);e+=" ("+t.line+":"+t.column+")";var i=new SyntaxError(e);throw i.pos=n,i.loc=t,i.raisedAt=this.pos,i};Tb.raiseRecoverable=Tb.raise;Tb.curPosition=function(){if(this.options.locations)return new dA(this.curLine,this.pos-this.lineStart)};var Kh=os.prototype,G7=function(e){this.flags=e,this.var=[],this.lexical=[],this.functions=[],this.inClassFieldInit=!1};Kh.enterScope=function(n){this.scopeStack.push(new G7(n))};Kh.exitScope=function(){this.scopeStack.pop()};Kh.treatFunctionsAsVarInScope=function(n){return n.flags&Np||!this.inModule&&n.flags&fA};Kh.declareName=function(n,e,t){var i=!1;if(e===ml){var s=this.currentScope();i=s.lexical.indexOf(n)>-1||s.functions.indexOf(n)>-1||s.var.indexOf(n)>-1,s.lexical.push(n),this.inModule&&s.flags&fA&&delete this.undefinedExports[n]}else if(e===RN){var r=this.currentScope();r.lexical.push(n)}else if(e===IN){var o=this.currentScope();this.treatFunctionsAsVar?i=o.lexical.indexOf(n)>-1:i=o.lexical.indexOf(n)>-1||o.var.indexOf(n)>-1,o.functions.push(n)}else for(var a=this.scopeStack.length-1;a>=0;--a){var c=this.scopeStack[a];if(c.lexical.indexOf(n)>-1&&!(c.flags&TN&&c.lexical[0]===n)||!this.treatFunctionsAsVarInScope(c)&&c.functions.indexOf(n)>-1){i=!0;break}if(c.var.push(n),this.inModule&&c.flags&fA&&delete this.undefinedExports[n],c.flags&U1)break}i&&this.raiseRecoverable(t,"Identifier '"+n+"' has already been declared")};Kh.checkLocalExport=function(n){this.scopeStack[0].lexical.indexOf(n.name)===-1&&this.scopeStack[0].var.indexOf(n.name)===-1&&(this.undefinedExports[n.name]=n)};Kh.currentScope=function(){return this.scopeStack[this.scopeStack.length-1]};Kh.currentVarScope=function(){for(var n=this.scopeStack.length-1;;n--){var e=this.scopeStack[n];if(e.flags&U1)return e}};Kh.currentThisScope=function(){for(var n=this.scopeStack.length-1;;n--){var e=this.scopeStack[n];if(e.flags&U1&&!(e.flags&EN))return e}};var yx=function(e,t,i){this.type="",this.start=t,this.end=0,e.options.locations&&(this.loc=new Ax(e,i)),e.options.directSourceFile&&(this.sourceFile=e.options.directSourceFile),e.options.ranges&&(this.range=[t,0])},KA=os.prototype;KA.startNode=function(){return new yx(this,this.start,this.startLoc)};KA.startNodeAt=function(n,e){return new yx(this,n,e)};function ON(n,e,t,i){return n.type=e,n.end=t,this.options.locations&&(n.loc.end=i),this.options.ranges&&(n.range[1]=t),n}KA.finishNode=function(n,e){return ON.call(this,n,e,this.lastTokEnd,this.lastTokEndLoc)};KA.finishNodeAt=function(n,e,t,i){return ON.call(this,n,e,t,i)};KA.copyNode=function(n){var e=new yx(this,n.start,this.startLoc);for(var t in n)e[t]=n[t];return e};var kN="ASCII ASCII_Hex_Digit AHex Alphabetic Alpha Any Assigned Bidi_Control Bidi_C Bidi_Mirrored Bidi_M Case_Ignorable CI Cased Changes_When_Casefolded CWCF Changes_When_Casemapped CWCM Changes_When_Lowercased CWL Changes_When_NFKC_Casefolded CWKCF Changes_When_Titlecased CWT Changes_When_Uppercased CWU Dash Default_Ignorable_Code_Point DI Deprecated Dep Diacritic Dia Emoji Emoji_Component Emoji_Modifier Emoji_Modifier_Base Emoji_Presentation Extender Ext Grapheme_Base Gr_Base Grapheme_Extend Gr_Ext Hex_Digit Hex IDS_Binary_Operator IDSB IDS_Trinary_Operator IDST ID_Continue IDC ID_Start IDS Ideographic Ideo Join_Control Join_C Logical_Order_Exception LOE Lowercase Lower Math Noncharacter_Code_Point NChar Pattern_Syntax Pat_Syn Pattern_White_Space Pat_WS Quotation_Mark QMark Radical Regional_Indicator RI Sentence_Terminal STerm Soft_Dotted SD Terminal_Punctuation Term Unified_Ideograph UIdeo Uppercase Upper Variation_Selector VS White_Space space XID_Continue XIDC XID_Start XIDS",LN=kN+" Extended_Pictographic",FN=LN,UN=FN+" EBase EComp EMod EPres ExtPict",V7=UN,H7={9:kN,10:LN,11:FN,12:UN,13:V7},wD="Cased_Letter LC Close_Punctuation Pe Connector_Punctuation Pc Control Cc cntrl Currency_Symbol Sc Dash_Punctuation Pd Decimal_Number Nd digit Enclosing_Mark Me Final_Punctuation Pf Format Cf Initial_Punctuation Pi Letter L Letter_Number Nl Line_Separator Zl Lowercase_Letter Ll Mark M Combining_Mark Math_Symbol Sm Modifier_Letter Lm Modifier_Symbol Sk Nonspacing_Mark Mn Number N Open_Punctuation Ps Other C Other_Letter Lo Other_Number No Other_Punctuation Po Other_Symbol So Paragraph_Separator Zp Private_Use Co Punctuation P punct Separator Z Space_Separator Zs Spacing_Mark Mc Surrogate Cs Symbol S Titlecase_Letter Lt Unassigned Cn Uppercase_Letter Lu",NN="Adlam Adlm Ahom Anatolian_Hieroglyphs Hluw Arabic Arab Armenian Armn Avestan Avst Balinese Bali Bamum Bamu Bassa_Vah Bass Batak Batk Bengali Beng Bhaiksuki Bhks Bopomofo Bopo Brahmi Brah Braille Brai Buginese Bugi Buhid Buhd Canadian_Aboriginal Cans Carian Cari Caucasian_Albanian Aghb Chakma Cakm Cham Cham Cherokee Cher Common Zyyy Coptic Copt Qaac Cuneiform Xsux Cypriot Cprt Cyrillic Cyrl Deseret Dsrt Devanagari Deva Duployan Dupl Egyptian_Hieroglyphs Egyp Elbasan Elba Ethiopic Ethi Georgian Geor Glagolitic Glag Gothic Goth Grantha Gran Greek Grek Gujarati Gujr Gurmukhi Guru Han Hani Hangul Hang Hanunoo Hano Hatran Hatr Hebrew Hebr Hiragana Hira Imperial_Aramaic Armi Inherited Zinh Qaai Inscriptional_Pahlavi Phli Inscriptional_Parthian Prti Javanese Java Kaithi Kthi Kannada Knda Katakana Kana Kayah_Li Kali Kharoshthi Khar Khmer Khmr Khojki Khoj Khudawadi Sind Lao Laoo Latin Latn Lepcha Lepc Limbu Limb Linear_A Lina Linear_B Linb Lisu Lisu Lycian Lyci Lydian Lydi Mahajani Mahj Malayalam Mlym Mandaic Mand Manichaean Mani Marchen Marc Masaram_Gondi Gonm Meetei_Mayek Mtei Mende_Kikakui Mend Meroitic_Cursive Merc Meroitic_Hieroglyphs Mero Miao Plrd Modi Mongolian Mong Mro Mroo Multani Mult Myanmar Mymr Nabataean Nbat New_Tai_Lue Talu Newa Newa Nko Nkoo Nushu Nshu Ogham Ogam Ol_Chiki Olck Old_Hungarian Hung Old_Italic Ital Old_North_Arabian Narb Old_Permic Perm Old_Persian Xpeo Old_South_Arabian Sarb Old_Turkic Orkh Oriya Orya Osage Osge Osmanya Osma Pahawh_Hmong Hmng Palmyrene Palm Pau_Cin_Hau Pauc Phags_Pa Phag Phoenician Phnx Psalter_Pahlavi Phlp Rejang Rjng Runic Runr Samaritan Samr Saurashtra Saur Sharada Shrd Shavian Shaw Siddham Sidd SignWriting Sgnw Sinhala Sinh Sora_Sompeng Sora Soyombo Soyo Sundanese Sund Syloti_Nagri Sylo Syriac Syrc Tagalog Tglg Tagbanwa Tagb Tai_Le Tale Tai_Tham Lana Tai_Viet Tavt Takri Takr Tamil Taml Tangut Tang Telugu Telu Thaana Thaa Thai Thai Tibetan Tibt Tifinagh Tfng Tirhuta Tirh Ugaritic Ugar Vai Vaii Warang_Citi Wara Yi Yiii Zanabazar_Square Zanb",zN=NN+" Dogra Dogr Gunjala_Gondi Gong Hanifi_Rohingya Rohg Makasar Maka Medefaidrin Medf Old_Sogdian Sogo Sogdian Sogd",GN=zN+" Elymaic Elym Nandinagari Nand Nyiakeng_Puachue_Hmong Hmnp Wancho Wcho",VN=GN+" Chorasmian Chrs Diak Dives_Akuru Khitan_Small_Script Kits Yezi Yezidi",Q7=VN+" Cypro_Minoan Cpmn Old_Uyghur Ougr Tangsa Tnsa Toto Vithkuqi Vith",j7={9:NN,10:zN,11:GN,12:VN,13:Q7},HN={};function W7(n){var e=HN[n]={binary:Gu(H7[n]+" "+wD),nonBinary:{General_Category:Gu(wD),Script:Gu(j7[n])}};e.nonBinary.Script_Extensions=e.nonBinary.Script,e.nonBinary.gc=e.nonBinary.General_Category,e.nonBinary.sc=e.nonBinary.Script,e.nonBinary.scx=e.nonBinary.Script_Extensions}for(var PS=0,SD=[9,10,11,12,13];PS<SD.length;PS+=1){var q7=SD[PS];W7(q7)}var _t=os.prototype,Dl=function(e){this.parser=e,this.validFlags="gim"+(e.options.ecmaVersion>=6?"uy":"")+(e.options.ecmaVersion>=9?"s":"")+(e.options.ecmaVersion>=13?"d":""),this.unicodeProperties=HN[e.options.ecmaVersion>=13?13:e.options.ecmaVersion],this.source="",this.flags="",this.start=0,this.switchU=!1,this.switchN=!1,this.pos=0,this.lastIntValue=0,this.lastStringValue="",this.lastAssertionIsQuantifiable=!1,this.numCapturingParens=0,this.maxBackReference=0,this.groupNames=[],this.backReferenceNames=[]};Dl.prototype.reset=function(e,t,i){var s=i.indexOf("u")!==-1;this.start=e|0,this.source=t+"",this.flags=i,this.switchU=s&&this.parser.options.ecmaVersion>=6,this.switchN=s&&this.parser.options.ecmaVersion>=9};Dl.prototype.raise=function(e){this.parser.raiseRecoverable(this.start,"Invalid regular expression: /"+this.source+"/: "+e)};Dl.prototype.at=function(e,t){t===void 0&&(t=!1);var i=this.source,s=i.length;if(e>=s)return-1;var r=i.charCodeAt(e);if(!(t||this.switchU)||r<=55295||r>=57344||e+1>=s)return r;var o=i.charCodeAt(e+1);return o>=56320&&o<=57343?(r<<10)+o-56613888:r};Dl.prototype.nextIndex=function(e,t){t===void 0&&(t=!1);var i=this.source,s=i.length;if(e>=s)return s;var r=i.charCodeAt(e),o;return!(t||this.switchU)||r<=55295||r>=57344||e+1>=s||(o=i.charCodeAt(e+1))<56320||o>57343?e+1:e+2};Dl.prototype.current=function(e){return e===void 0&&(e=!1),this.at(this.pos,e)};Dl.prototype.lookahead=function(e){return e===void 0&&(e=!1),this.at(this.nextIndex(this.pos,e),e)};Dl.prototype.advance=function(e){e===void 0&&(e=!1),this.pos=this.nextIndex(this.pos,e)};Dl.prototype.eat=function(e,t){return t===void 0&&(t=!1),this.current(t)===e?(this.advance(t),!0):!1};_t.validateRegExpFlags=function(n){for(var e=n.validFlags,t=n.flags,i=0;i<t.length;i++){var s=t.charAt(i);e.indexOf(s)===-1&&this.raise(n.start,"Invalid regular expression flag"),t.indexOf(s,i+1)>-1&&this.raise(n.start,"Duplicate regular expression flag")}};_t.validateRegExpPattern=function(n){this.regexp_pattern(n),!n.switchN&&this.options.ecmaVersion>=9&&n.groupNames.length>0&&(n.switchN=!0,this.regexp_pattern(n))};_t.regexp_pattern=function(n){n.pos=0,n.lastIntValue=0,n.lastStringValue="",n.lastAssertionIsQuantifiable=!1,n.numCapturingParens=0,n.maxBackReference=0,n.groupNames.length=0,n.backReferenceNames.length=0,this.regexp_disjunction(n),n.pos!==n.source.length&&(n.eat(41)&&n.raise("Unmatched ')'"),(n.eat(93)||n.eat(125))&&n.raise("Lone quantifier brackets")),n.maxBackReference>n.numCapturingParens&&n.raise("Invalid escape");for(var e=0,t=n.backReferenceNames;e<t.length;e+=1){var i=t[e];n.groupNames.indexOf(i)===-1&&n.raise("Invalid named capture referenced")}};_t.regexp_disjunction=function(n){for(this.regexp_alternative(n);n.eat(124);)this.regexp_alternative(n);this.regexp_eatQuantifier(n,!0)&&n.raise("Nothing to repeat"),n.eat(123)&&n.raise("Lone quantifier brackets")};_t.regexp_alternative=function(n){for(;n.pos<n.source.length&&this.regexp_eatTerm(n););};_t.regexp_eatTerm=function(n){return this.regexp_eatAssertion(n)?(n.lastAssertionIsQuantifiable&&this.regexp_eatQuantifier(n)&&n.switchU&&n.raise("Invalid quantifier"),!0):(n.switchU?this.regexp_eatAtom(n):this.regexp_eatExtendedAtom(n))?(this.regexp_eatQuantifier(n),!0):!1};_t.regexp_eatAssertion=function(n){var e=n.pos;if(n.lastAssertionIsQuantifiable=!1,n.eat(94)||n.eat(36))return!0;if(n.eat(92)){if(n.eat(66)||n.eat(98))return!0;n.pos=e}if(n.eat(40)&&n.eat(63)){var t=!1;if(this.options.ecmaVersion>=9&&(t=n.eat(60)),n.eat(61)||n.eat(33))return this.regexp_disjunction(n),n.eat(41)||n.raise("Unterminated group"),n.lastAssertionIsQuantifiable=!t,!0}return n.pos=e,!1};_t.regexp_eatQuantifier=function(n,e){return e===void 0&&(e=!1),this.regexp_eatQuantifierPrefix(n,e)?(n.eat(63),!0):!1};_t.regexp_eatQuantifierPrefix=function(n,e){return n.eat(42)||n.eat(43)||n.eat(63)||this.regexp_eatBracedQuantifier(n,e)};_t.regexp_eatBracedQuantifier=function(n,e){var t=n.pos;if(n.eat(123)){var i=0,s=-1;if(this.regexp_eatDecimalDigits(n)&&(i=n.lastIntValue,n.eat(44)&&this.regexp_eatDecimalDigits(n)&&(s=n.lastIntValue),n.eat(125)))return s!==-1&&s<i&&!e&&n.raise("numbers out of order in {} quantifier"),!0;n.switchU&&!e&&n.raise("Incomplete quantifier"),n.pos=t}return!1};_t.regexp_eatAtom=function(n){return this.regexp_eatPatternCharacters(n)||n.eat(46)||this.regexp_eatReverseSolidusAtomEscape(n)||this.regexp_eatCharacterClass(n)||this.regexp_eatUncapturingGroup(n)||this.regexp_eatCapturingGroup(n)};_t.regexp_eatReverseSolidusAtomEscape=function(n){var e=n.pos;if(n.eat(92)){if(this.regexp_eatAtomEscape(n))return!0;n.pos=e}return!1};_t.regexp_eatUncapturingGroup=function(n){var e=n.pos;if(n.eat(40)){if(n.eat(63)&&n.eat(58)){if(this.regexp_disjunction(n),n.eat(41))return!0;n.raise("Unterminated group")}n.pos=e}return!1};_t.regexp_eatCapturingGroup=function(n){if(n.eat(40)){if(this.options.ecmaVersion>=9?this.regexp_groupSpecifier(n):n.current()===63&&n.raise("Invalid group"),this.regexp_disjunction(n),n.eat(41))return n.numCapturingParens+=1,!0;n.raise("Unterminated group")}return!1};_t.regexp_eatExtendedAtom=function(n){return n.eat(46)||this.regexp_eatReverseSolidusAtomEscape(n)||this.regexp_eatCharacterClass(n)||this.regexp_eatUncapturingGroup(n)||this.regexp_eatCapturingGroup(n)||this.regexp_eatInvalidBracedQuantifier(n)||this.regexp_eatExtendedPatternCharacter(n)};_t.regexp_eatInvalidBracedQuantifier=function(n){return this.regexp_eatBracedQuantifier(n,!0)&&n.raise("Nothing to repeat"),!1};_t.regexp_eatSyntaxCharacter=function(n){var e=n.current();return QN(e)?(n.lastIntValue=e,n.advance(),!0):!1};function QN(n){return n===36||n>=40&&n<=43||n===46||n===63||n>=91&&n<=94||n>=123&&n<=125}_t.regexp_eatPatternCharacters=function(n){for(var e=n.pos,t=0;(t=n.current())!==-1&&!QN(t);)n.advance();return n.pos!==e};_t.regexp_eatExtendedPatternCharacter=function(n){var e=n.current();return e!==-1&&e!==36&&!(e>=40&&e<=43)&&e!==46&&e!==63&&e!==91&&e!==94&&e!==124?(n.advance(),!0):!1};_t.regexp_groupSpecifier=function(n){if(n.eat(63)){if(this.regexp_eatGroupName(n)){n.groupNames.indexOf(n.lastStringValue)!==-1&&n.raise("Duplicate capture group name"),n.groupNames.push(n.lastStringValue);return}n.raise("Invalid group")}};_t.regexp_eatGroupName=function(n){if(n.lastStringValue="",n.eat(60)){if(this.regexp_eatRegExpIdentifierName(n)&&n.eat(62))return!0;n.raise("Invalid capture group name")}return!1};_t.regexp_eatRegExpIdentifierName=function(n){if(n.lastStringValue="",this.regexp_eatRegExpIdentifierStart(n)){for(n.lastStringValue+=Qh(n.lastIntValue);this.regexp_eatRegExpIdentifierPart(n);)n.lastStringValue+=Qh(n.lastIntValue);return!0}return!1};_t.regexp_eatRegExpIdentifierStart=function(n){var e=n.pos,t=this.options.ecmaVersion>=11,i=n.current(t);return n.advance(t),i===92&&this.regexp_eatRegExpUnicodeEscapeSequence(n,t)&&(i=n.lastIntValue),X7(i)?(n.lastIntValue=i,!0):(n.pos=e,!1)};function X7(n){return El(n,!0)||n===36||n===95}_t.regexp_eatRegExpIdentifierPart=function(n){var e=n.pos,t=this.options.ecmaVersion>=11,i=n.current(t);return n.advance(t),i===92&&this.regexp_eatRegExpUnicodeEscapeSequence(n,t)&&(i=n.lastIntValue),Y7(i)?(n.lastIntValue=i,!0):(n.pos=e,!1)};function Y7(n){return yp(n,!0)||n===36||n===95||n===8204||n===8205}_t.regexp_eatAtomEscape=function(n){return this.regexp_eatBackReference(n)||this.regexp_eatCharacterClassEscape(n)||this.regexp_eatCharacterEscape(n)||n.switchN&&this.regexp_eatKGroupName(n)?!0:(n.switchU&&(n.current()===99&&n.raise("Invalid unicode escape"),n.raise("Invalid escape")),!1)};_t.regexp_eatBackReference=function(n){var e=n.pos;if(this.regexp_eatDecimalEscape(n)){var t=n.lastIntValue;if(n.switchU)return t>n.maxBackReference&&(n.maxBackReference=t),!0;if(t<=n.numCapturingParens)return!0;n.pos=e}return!1};_t.regexp_eatKGroupName=function(n){if(n.eat(107)){if(this.regexp_eatGroupName(n))return n.backReferenceNames.push(n.lastStringValue),!0;n.raise("Invalid named reference")}return!1};_t.regexp_eatCharacterEscape=function(n){return this.regexp_eatControlEscape(n)||this.regexp_eatCControlLetter(n)||this.regexp_eatZero(n)||this.regexp_eatHexEscapeSequence(n)||this.regexp_eatRegExpUnicodeEscapeSequence(n,!1)||!n.switchU&&this.regexp_eatLegacyOctalEscapeSequence(n)||this.regexp_eatIdentityEscape(n)};_t.regexp_eatCControlLetter=function(n){var e=n.pos;if(n.eat(99)){if(this.regexp_eatControlLetter(n))return!0;n.pos=e}return!1};_t.regexp_eatZero=function(n){return n.current()===48&&!bx(n.lookahead())?(n.lastIntValue=0,n.advance(),!0):!1};_t.regexp_eatControlEscape=function(n){var e=n.current();return e===116?(n.lastIntValue=9,n.advance(),!0):e===110?(n.lastIntValue=10,n.advance(),!0):e===118?(n.lastIntValue=11,n.advance(),!0):e===102?(n.lastIntValue=12,n.advance(),!0):e===114?(n.lastIntValue=13,n.advance(),!0):!1};_t.regexp_eatControlLetter=function(n){var e=n.current();return jN(e)?(n.lastIntValue=e%32,n.advance(),!0):!1};function jN(n){return n>=65&&n<=90||n>=97&&n<=122}_t.regexp_eatRegExpUnicodeEscapeSequence=function(n,e){e===void 0&&(e=!1);var t=n.pos,i=e||n.switchU;if(n.eat(117)){if(this.regexp_eatFixedHexDigits(n,4)){var s=n.lastIntValue;if(i&&s>=55296&&s<=56319){var r=n.pos;if(n.eat(92)&&n.eat(117)&&this.regexp_eatFixedHexDigits(n,4)){var o=n.lastIntValue;if(o>=56320&&o<=57343)return n.lastIntValue=(s-55296)*1024+(o-56320)+65536,!0}n.pos=r,n.lastIntValue=s}return!0}if(i&&n.eat(123)&&this.regexp_eatHexDigits(n)&&n.eat(125)&&J7(n.lastIntValue))return!0;i&&n.raise("Invalid unicode escape"),n.pos=t}return!1};function J7(n){return n>=0&&n<=1114111}_t.regexp_eatIdentityEscape=function(n){if(n.switchU)return this.regexp_eatSyntaxCharacter(n)?!0:n.eat(47)?(n.lastIntValue=47,!0):!1;var e=n.current();return e!==99&&(!n.switchN||e!==107)?(n.lastIntValue=e,n.advance(),!0):!1};_t.regexp_eatDecimalEscape=function(n){n.lastIntValue=0;var e=n.current();if(e>=49&&e<=57){do n.lastIntValue=10*n.lastIntValue+(e-48),n.advance();while((e=n.current())>=48&&e<=57);return!0}return!1};_t.regexp_eatCharacterClassEscape=function(n){var e=n.current();if(K7(e))return n.lastIntValue=-1,n.advance(),!0;if(n.switchU&&this.options.ecmaVersion>=9&&(e===80||e===112)){if(n.lastIntValue=-1,n.advance(),n.eat(123)&&this.regexp_eatUnicodePropertyValueExpression(n)&&n.eat(125))return!0;n.raise("Invalid property name")}return!1};function K7(n){return n===100||n===68||n===115||n===83||n===119||n===87}_t.regexp_eatUnicodePropertyValueExpression=function(n){var e=n.pos;if(this.regexp_eatUnicodePropertyName(n)&&n.eat(61)){var t=n.lastStringValue;if(this.regexp_eatUnicodePropertyValue(n)){var i=n.lastStringValue;return this.regexp_validateUnicodePropertyNameAndValue(n,t,i),!0}}if(n.pos=e,this.regexp_eatLoneUnicodePropertyNameOrValue(n)){var s=n.lastStringValue;return this.regexp_validateUnicodePropertyNameOrValue(n,s),!0}return!1};_t.regexp_validateUnicodePropertyNameAndValue=function(n,e,t){YA(n.unicodeProperties.nonBinary,e)||n.raise("Invalid property name"),n.unicodeProperties.nonBinary[e].test(t)||n.raise("Invalid property value")};_t.regexp_validateUnicodePropertyNameOrValue=function(n,e){n.unicodeProperties.binary.test(e)||n.raise("Invalid property name")};_t.regexp_eatUnicodePropertyName=function(n){var e=0;for(n.lastStringValue="";WN(e=n.current());)n.lastStringValue+=Qh(e),n.advance();return n.lastStringValue!==""};function WN(n){return jN(n)||n===95}_t.regexp_eatUnicodePropertyValue=function(n){var e=0;for(n.lastStringValue="";Z7(e=n.current());)n.lastStringValue+=Qh(e),n.advance();return n.lastStringValue!==""};function Z7(n){return WN(n)||bx(n)}_t.regexp_eatLoneUnicodePropertyNameOrValue=function(n){return this.regexp_eatUnicodePropertyValue(n)};_t.regexp_eatCharacterClass=function(n){if(n.eat(91)){if(n.eat(94),this.regexp_classRanges(n),n.eat(93))return!0;n.raise("Unterminated character class")}return!1};_t.regexp_classRanges=function(n){for(;this.regexp_eatClassAtom(n);){var e=n.lastIntValue;if(n.eat(45)&&this.regexp_eatClassAtom(n)){var t=n.lastIntValue;n.switchU&&(e===-1||t===-1)&&n.raise("Invalid character class"),e!==-1&&t!==-1&&e>t&&n.raise("Range out of order in character class")}}};_t.regexp_eatClassAtom=function(n){var e=n.pos;if(n.eat(92)){if(this.regexp_eatClassEscape(n))return!0;if(n.switchU){var t=n.current();(t===99||YN(t))&&n.raise("Invalid class escape"),n.raise("Invalid escape")}n.pos=e}var i=n.current();return i!==93?(n.lastIntValue=i,n.advance(),!0):!1};_t.regexp_eatClassEscape=function(n){var e=n.pos;if(n.eat(98))return n.lastIntValue=8,!0;if(n.switchU&&n.eat(45))return n.lastIntValue=45,!0;if(!n.switchU&&n.eat(99)){if(this.regexp_eatClassControlLetter(n))return!0;n.pos=e}return this.regexp_eatCharacterClassEscape(n)||this.regexp_eatCharacterEscape(n)};_t.regexp_eatClassControlLetter=function(n){var e=n.current();return bx(e)||e===95?(n.lastIntValue=e%32,n.advance(),!0):!1};_t.regexp_eatHexEscapeSequence=function(n){var e=n.pos;if(n.eat(120)){if(this.regexp_eatFixedHexDigits(n,2))return!0;n.switchU&&n.raise("Invalid escape"),n.pos=e}return!1};_t.regexp_eatDecimalDigits=function(n){var e=n.pos,t=0;for(n.lastIntValue=0;bx(t=n.current());)n.lastIntValue=10*n.lastIntValue+(t-48),n.advance();return n.pos!==e};function bx(n){return n>=48&&n<=57}_t.regexp_eatHexDigits=function(n){var e=n.pos,t=0;for(n.lastIntValue=0;qN(t=n.current());)n.lastIntValue=16*n.lastIntValue+XN(t),n.advance();return n.pos!==e};function qN(n){return n>=48&&n<=57||n>=65&&n<=70||n>=97&&n<=102}function XN(n){return n>=65&&n<=70?10+(n-65):n>=97&&n<=102?10+(n-97):n-48}_t.regexp_eatLegacyOctalEscapeSequence=function(n){if(this.regexp_eatOctalDigit(n)){var e=n.lastIntValue;if(this.regexp_eatOctalDigit(n)){var t=n.lastIntValue;e<=3&&this.regexp_eatOctalDigit(n)?n.lastIntValue=e*64+t*8+n.lastIntValue:n.lastIntValue=e*8+t}else n.lastIntValue=e;return!0}return!1};_t.regexp_eatOctalDigit=function(n){var e=n.current();return YN(e)?(n.lastIntValue=e-48,n.advance(),!0):(n.lastIntValue=0,!1)};function YN(n){return n>=48&&n<=55}_t.regexp_eatFixedHexDigits=function(n,e){var t=n.pos;n.lastIntValue=0;for(var i=0;i<e;++i){var s=n.current();if(!qN(s))return n.pos=t,!1;n.lastIntValue=16*n.lastIntValue+XN(s),n.advance()}return!0};var V1=function(e){this.type=e.type,this.value=e.value,this.start=e.start,this.end=e.end,e.options.locations&&(this.loc=new Ax(e,e.startLoc,e.endLoc)),e.options.ranges&&(this.range=[e.start,e.end])},oi=os.prototype;oi.next=function(n){!n&&this.type.keyword&&this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword "+this.type.keyword),this.options.onToken&&this.options.onToken(new V1(this)),this.lastTokEnd=this.end,this.lastTokStart=this.start,this.lastTokEndLoc=this.endLoc,this.lastTokStartLoc=this.startLoc,this.nextToken()};oi.getToken=function(){return this.next(),new V1(this)};typeof Symbol<"u"&&(oi[Symbol.iterator]=function(){var n=this;return{next:function(){var e=n.getToken();return{done:e.type===k.eof,value:e}}}});oi.nextToken=function(){var n=this.curContext();if((!n||!n.preserveSpace)&&this.skipSpace(),this.start=this.pos,this.options.locations&&(this.startLoc=this.curPosition()),this.pos>=this.input.length)return this.finishToken(k.eof);if(n.override)return n.override(this);this.readToken(this.fullCharCodeAtPos())};oi.readToken=function(n){return El(n,this.options.ecmaVersion>=6)||n===92?this.readWord():this.getTokenFromCode(n)};oi.fullCharCodeAtPos=function(){var n=this.input.charCodeAt(this.pos);if(n<=55295||n>=56320)return n;var e=this.input.charCodeAt(this.pos+1);return e<=56319||e>=57344?n:(n<<10)+e-56613888};oi.skipBlockComment=function(){var n=this.options.onComment&&this.curPosition(),e=this.pos,t=this.input.indexOf("*/",this.pos+=2);if(t===-1&&this.raise(this.pos-2,"Unterminated comment"),this.pos=t+2,this.options.locations)for(var i=void 0,s=e;(i=_N(this.input,s,this.pos))>-1;)++this.curLine,s=this.lineStart=i;this.options.onComment&&this.options.onComment(!0,this.input.slice(e+2,t),e,this.pos,n,this.curPosition())};oi.skipLineComment=function(n){for(var e=this.pos,t=this.options.onComment&&this.curPosition(),i=this.input.charCodeAt(this.pos+=n);this.pos<this.input.length&&!Up(i);)i=this.input.charCodeAt(++this.pos);this.options.onComment&&this.options.onComment(!1,this.input.slice(e+n,this.pos),e,this.pos,t,this.curPosition())};oi.skipSpace=function(){e:for(;this.pos<this.input.length;){var n=this.input.charCodeAt(this.pos);switch(n){case 32:case 160:++this.pos;break;case 13:this.input.charCodeAt(this.pos+1)===10&&++this.pos;case 10:case 8232:case 8233:++this.pos,this.options.locations&&(++this.curLine,this.lineStart=this.pos);break;case 47:switch(this.input.charCodeAt(this.pos+1)){case 42:this.skipBlockComment();break;case 47:this.skipLineComment(2);break;default:break e}break;default:if(n>8&&n<14||n>=5760&&xN.test(String.fromCharCode(n)))++this.pos;else break e}}};oi.finishToken=function(n,e){this.end=this.pos,this.options.locations&&(this.endLoc=this.curPosition());var t=this.type;this.type=n,this.value=e,this.updateContext(t)};oi.readToken_dot=function(){var n=this.input.charCodeAt(this.pos+1);if(n>=48&&n<=57)return this.readNumber(!0);var e=this.input.charCodeAt(this.pos+2);return this.options.ecmaVersion>=6&&n===46&&e===46?(this.pos+=3,this.finishToken(k.ellipsis)):(++this.pos,this.finishToken(k.dot))};oi.readToken_slash=function(){var n=this.input.charCodeAt(this.pos+1);return this.exprAllowed?(++this.pos,this.readRegexp()):n===61?this.finishOp(k.assign,2):this.finishOp(k.slash,1)};oi.readToken_mult_modulo_exp=function(n){var e=this.input.charCodeAt(this.pos+1),t=1,i=n===42?k.star:k.modulo;return this.options.ecmaVersion>=7&&n===42&&e===42&&(++t,i=k.starstar,e=this.input.charCodeAt(this.pos+2)),e===61?this.finishOp(k.assign,t+1):this.finishOp(i,t)};oi.readToken_pipe_amp=function(n){var e=this.input.charCodeAt(this.pos+1);if(e===n){if(this.options.ecmaVersion>=12){var t=this.input.charCodeAt(this.pos+2);if(t===61)return this.finishOp(k.assign,3)}return this.finishOp(n===124?k.logicalOR:k.logicalAND,2)}return e===61?this.finishOp(k.assign,2):this.finishOp(n===124?k.bitwiseOR:k.bitwiseAND,1)};oi.readToken_caret=function(){var n=this.input.charCodeAt(this.pos+1);return n===61?this.finishOp(k.assign,2):this.finishOp(k.bitwiseXOR,1)};oi.readToken_plus_min=function(n){var e=this.input.charCodeAt(this.pos+1);return e===n?e===45&&!this.inModule&&this.input.charCodeAt(this.pos+2)===62&&(this.lastTokEnd===0||Vo.test(this.input.slice(this.lastTokEnd,this.pos)))?(this.skipLineComment(3),this.skipSpace(),this.nextToken()):this.finishOp(k.incDec,2):e===61?this.finishOp(k.assign,2):this.finishOp(k.plusMin,1)};oi.readToken_lt_gt=function(n){var e=this.input.charCodeAt(this.pos+1),t=1;return e===n?(t=n===62&&this.input.charCodeAt(this.pos+2)===62?3:2,this.input.charCodeAt(this.pos+t)===61?this.finishOp(k.assign,t+1):this.finishOp(k.bitShift,t)):e===33&&n===60&&!this.inModule&&this.input.charCodeAt(this.pos+2)===45&&this.input.charCodeAt(this.pos+3)===45?(this.skipLineComment(4),this.skipSpace(),this.nextToken()):(e===61&&(t=2),this.finishOp(k.relational,t))};oi.readToken_eq_excl=function(n){var e=this.input.charCodeAt(this.pos+1);return e===61?this.finishOp(k.equality,this.input.charCodeAt(this.pos+2)===61?3:2):n===61&&e===62&&this.options.ecmaVersion>=6?(this.pos+=2,this.finishToken(k.arrow)):this.finishOp(n===61?k.eq:k.prefix,1)};oi.readToken_question=function(){var n=this.options.ecmaVersion;if(n>=11){var e=this.input.charCodeAt(this.pos+1);if(e===46){var t=this.input.charCodeAt(this.pos+2);if(t<48||t>57)return this.finishOp(k.questionDot,2)}if(e===63){if(n>=12){var i=this.input.charCodeAt(this.pos+2);if(i===61)return this.finishOp(k.assign,3)}return this.finishOp(k.coalesce,2)}}return this.finishOp(k.question,1)};oi.readToken_numberSign=function(){var n=this.options.ecmaVersion,e=35;if(n>=13&&(++this.pos,e=this.fullCharCodeAtPos(),El(e,!0)||e===92))return this.finishToken(k.privateId,this.readWord1());this.raise(this.pos,"Unexpected character '"+Qh(e)+"'")};oi.getTokenFromCode=function(n){switch(n){case 46:return this.readToken_dot();case 40:return++this.pos,this.finishToken(k.parenL);case 41:return++this.pos,this.finishToken(k.parenR);case 59:return++this.pos,this.finishToken(k.semi);case 44:return++this.pos,this.finishToken(k.comma);case 91:return++this.pos,this.finishToken(k.bracketL);case 93:return++this.pos,this.finishToken(k.bracketR);case 123:return++this.pos,this.finishToken(k.braceL);case 125:return++this.pos,this.finishToken(k.braceR);case 58:return++this.pos,this.finishToken(k.colon);case 96:if(this.options.ecmaVersion<6)break;return++this.pos,this.finishToken(k.backQuote);case 48:var e=this.input.charCodeAt(this.pos+1);if(e===120||e===88)return this.readRadixNumber(16);if(this.options.ecmaVersion>=6){if(e===111||e===79)return this.readRadixNumber(8);if(e===98||e===66)return this.readRadixNumber(2)}case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return this.readNumber(!1);case 34:case 39:return this.readString(n);case 47:return this.readToken_slash();case 37:case 42:return this.readToken_mult_modulo_exp(n);case 124:case 38:return this.readToken_pipe_amp(n);case 94:return this.readToken_caret();case 43:case 45:return this.readToken_plus_min(n);case 60:case 62:return this.readToken_lt_gt(n);case 61:case 33:return this.readToken_eq_excl(n);case 63:return this.readToken_question();case 126:return this.finishOp(k.prefix,1);case 35:return this.readToken_numberSign()}this.raise(this.pos,"Unexpected character '"+Qh(n)+"'")};oi.finishOp=function(n,e){var t=this.input.slice(this.pos,this.pos+e);return this.pos+=e,this.finishToken(n,t)};oi.readRegexp=function(){for(var n,e,t=this.pos;;){this.pos>=this.input.length&&this.raise(t,"Unterminated regular expression");var i=this.input.charAt(this.pos);if(Vo.test(i)&&this.raise(t,"Unterminated regular expression"),n)n=!1;else{if(i==="[")e=!0;else if(i==="]"&&e)e=!1;else if(i==="/"&&!e)break;n=i==="\\"}++this.pos}var s=this.input.slice(t,this.pos);++this.pos;var r=this.pos,o=this.readWord1();this.containsEsc&&this.unexpected(r);var a=this.regexpState||(this.regexpState=new Dl(this));a.reset(t,s,o),this.validateRegExpFlags(a),this.validateRegExpPattern(a);var c=null;try{c=new RegExp(s,o)}catch{}return this.finishToken(k.regexp,{pattern:s,flags:o,value:c})};oi.readInt=function(n,e,t){for(var i=this.options.ecmaVersion>=12&&e===void 0,s=t&&this.input.charCodeAt(this.pos)===48,r=this.pos,o=0,a=0,c=0,l=e??1/0;c<l;++c,++this.pos){var h=this.input.charCodeAt(this.pos),d=void 0;if(i&&h===95){s&&this.raiseRecoverable(this.pos,"Numeric separator is not allowed in legacy octal numeric literals"),a===95&&this.raiseRecoverable(this.pos,"Numeric separator must be exactly one underscore"),c===0&&this.raiseRecoverable(this.pos,"Numeric separator is not allowed at the first of digits"),a=h;continue}if(h>=97?d=h-97+10:h>=65?d=h-65+10:h>=48&&h<=57?d=h-48:d=1/0,d>=n)break;a=h,o=o*n+d}return i&&a===95&&this.raiseRecoverable(this.pos-1,"Numeric separator is not allowed at the last of digits"),this.pos===r||e!=null&&this.pos-r!==e?null:o};function $7(n,e){return e?parseInt(n,8):parseFloat(n.replace(/_/g,""))}function JN(n){return typeof BigInt!="function"?null:BigInt(n.replace(/_/g,""))}oi.readRadixNumber=function(n){var e=this.pos;this.pos+=2;var t=this.readInt(n);return t==null&&this.raise(this.start+2,"Expected number in radix "+n),this.options.ecmaVersion>=11&&this.input.charCodeAt(this.pos)===110?(t=JN(this.input.slice(e,this.pos)),++this.pos):El(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number"),this.finishToken(k.num,t)};oi.readNumber=function(n){var e=this.pos;!n&&this.readInt(10,void 0,!0)===null&&this.raise(e,"Invalid number");var t=this.pos-e>=2&&this.input.charCodeAt(e)===48;t&&this.strict&&this.raise(e,"Invalid number");var i=this.input.charCodeAt(this.pos);if(!t&&!n&&this.options.ecmaVersion>=11&&i===110){var s=JN(this.input.slice(e,this.pos));return++this.pos,El(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number"),this.finishToken(k.num,s)}t&&/[89]/.test(this.input.slice(e,this.pos))&&(t=!1),i===46&&!t&&(++this.pos,this.readInt(10),i=this.input.charCodeAt(this.pos)),(i===69||i===101)&&!t&&(i=this.input.charCodeAt(++this.pos),(i===43||i===45)&&++this.pos,this.readInt(10)===null&&this.raise(e,"Invalid number")),El(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number");var r=$7(this.input.slice(e,this.pos),t);return this.finishToken(k.num,r)};oi.readCodePoint=function(){var n=this.input.charCodeAt(this.pos),e;if(n===123){this.options.ecmaVersion<6&&this.unexpected();var t=++this.pos;e=this.readHexChar(this.input.indexOf("}",this.pos)-this.pos),++this.pos,e>1114111&&this.invalidStringToken(t,"Code point out of bounds")}else e=this.readHexChar(4);return e};oi.readString=function(n){for(var e="",t=++this.pos;;){this.pos>=this.input.length&&this.raise(this.start,"Unterminated string constant");var i=this.input.charCodeAt(this.pos);if(i===n)break;i===92?(e+=this.input.slice(t,this.pos),e+=this.readEscapedChar(!1),t=this.pos):i===8232||i===8233?(this.options.ecmaVersion<10&&this.raise(this.start,"Unterminated string constant"),++this.pos,this.options.locations&&(this.curLine++,this.lineStart=this.pos)):(Up(i)&&this.raise(this.start,"Unterminated string constant"),++this.pos)}return e+=this.input.slice(t,this.pos++),this.finishToken(k.string,e)};var KN={};oi.tryReadTemplateToken=function(){this.inTemplateElement=!0;try{this.readTmplToken()}catch(n){if(n===KN)this.readInvalidTemplateToken();else throw n}this.inTemplateElement=!1};oi.invalidStringToken=function(n,e){if(this.inTemplateElement&&this.options.ecmaVersion>=9)throw KN;this.raise(n,e)};oi.readTmplToken=function(){for(var n="",e=this.pos;;){this.pos>=this.input.length&&this.raise(this.start,"Unterminated template");var t=this.input.charCodeAt(this.pos);if(t===96||t===36&&this.input.charCodeAt(this.pos+1)===123)return this.pos===this.start&&(this.type===k.template||this.type===k.invalidTemplate)?t===36?(this.pos+=2,this.finishToken(k.dollarBraceL)):(++this.pos,this.finishToken(k.backQuote)):(n+=this.input.slice(e,this.pos),this.finishToken(k.template,n));if(t===92)n+=this.input.slice(e,this.pos),n+=this.readEscapedChar(!0),e=this.pos;else if(Up(t)){switch(n+=this.input.slice(e,this.pos),++this.pos,t){case 13:this.input.charCodeAt(this.pos)===10&&++this.pos;case 10:n+=`
`;break;default:n+=String.fromCharCode(t);break}this.options.locations&&(++this.curLine,this.lineStart=this.pos),e=this.pos}else++this.pos}};oi.readInvalidTemplateToken=function(){for(;this.pos<this.input.length;this.pos++)switch(this.input[this.pos]){case"\\":++this.pos;break;case"$":if(this.input[this.pos+1]!=="{")break;case"`":return this.finishToken(k.invalidTemplate,this.input.slice(this.start,this.pos))}this.raise(this.start,"Unterminated template")};oi.readEscapedChar=function(n){var e=this.input.charCodeAt(++this.pos);switch(++this.pos,e){case 110:return`
`;case 114:return"\r";case 120:return String.fromCharCode(this.readHexChar(2));case 117:return Qh(this.readCodePoint());case 116:return"	";case 98:return"\b";case 118:return"\v";case 102:return"\f";case 13:this.input.charCodeAt(this.pos)===10&&++this.pos;case 10:return this.options.locations&&(this.lineStart=this.pos,++this.curLine),"";case 56:case 57:if(this.strict&&this.invalidStringToken(this.pos-1,"Invalid escape sequence"),n){var t=this.pos-1;return this.invalidStringToken(t,"Invalid escape sequence in template string"),null}default:if(e>=48&&e<=55){var i=this.input.substr(this.pos-1,3).match(/^[0-7]+/)[0],s=parseInt(i,8);return s>255&&(i=i.slice(0,-1),s=parseInt(i,8)),this.pos+=i.length-1,e=this.input.charCodeAt(this.pos),(i!=="0"||e===56||e===57)&&(this.strict||n)&&this.invalidStringToken(this.pos-1-i.length,n?"Octal literal in template string":"Octal literal in strict mode"),String.fromCharCode(s)}return Up(e)?"":String.fromCharCode(e)}};oi.readHexChar=function(n){var e=this.pos,t=this.readInt(16,n);return t===null&&this.invalidStringToken(e,"Bad character escape sequence"),t};oi.readWord1=function(){this.containsEsc=!1;for(var n="",e=!0,t=this.pos,i=this.options.ecmaVersion>=6;this.pos<this.input.length;){var s=this.fullCharCodeAtPos();if(yp(s,i))this.pos+=s<=65535?1:2;else if(s===92){this.containsEsc=!0,n+=this.input.slice(t,this.pos);var r=this.pos;this.input.charCodeAt(++this.pos)!==117&&this.invalidStringToken(this.pos,"Expecting Unicode escape sequence \\uXXXX"),++this.pos;var o=this.readCodePoint();(e?El:yp)(o,i)||this.invalidStringToken(r,"Invalid Unicode escape"),n+=Qh(o),t=this.pos}else break;e=!1}return n+this.input.slice(t,this.pos)};oi.readWord=function(){var n=this.readWord1(),e=k.name;return this.keywords.test(n)&&(e=k1[n]),this.finishToken(e,n)};var eJ="8.8.0";os.acorn={Parser:os,version:eJ,defaultOptions:aT,Position:dA,SourceLocation:Ax,getLineInfo:SN,Node:yx,TokenType:pi,tokTypes:k,keywordTypes:k1,TokContext:Ko,tokContexts:Ki,isIdentifierChar:yp,isIdentifierStart:El,Token:V1,isNewLine:Up,lineBreak:Vo,lineBreakG:R7,nonASCIIwhitespace:xN};const tJ=function(n,e,t){n.traverse(i=>{i.renderOrder=t})};class ZA extends We.Object3D{constructor(t,i){super();u(this,"_rebuildParentUI",()=>{this._parent._needsUpdate=!0,this.parent&&!this.parent.isUI?(Mb.register(this),this.activatePseudoState("root")):(Mb.remove(this),this.deactivatePseudoState("root"))});Object.defineProperties(this,{isUI:{configurable:!1,enumerable:!0,value:!0}}),this._backgroundMesh=null,this._backgroundMaterial=null,this._backgroundCustomDepthMaterial=null,this._backgroundMaterialMediation={},this._backgroundMeshMediation={backgroundCastShadow:{m:"castShadow"},backgroundReceiveShadow:{m:"receiveShadow"},renderOrder:{m:"renderOrder",t:tJ}},this._fontMesh=null,this._fontMaterial=new bD("fontMaterial"),this._fontCustomDepthMaterial=new bD("fontCustomDepthMaterial"),this._fontMeshMediation={fontMaterial:{m:"material"},fontCustomDepthMaterial:{m:"customDepthMaterial",t:ZX},fontCastShadow:{m:"castShadow"},fontReceiveShadow:{m:"receiveShadow"},renderOrder:{m:"renderOrder"}},this._children=t.children?new t.children:new Nc("children"),this._parent=new $X,this.addEventListener("added",this._rebuildParentUI),this.addEventListener("removed",this._rebuildParentUI),this._backgroundSide=new yD("backgroundSide"),this._fontSide=new yD("fontSide"),this._backgroundAlphaTest=new vD("backgroundAlphaTest",.02),this._fontAlphaTest=new vD("fontAlphaTest",.02),this._visible=new TY("visible",!0),this._backgroundCastShadow=new Vy("backgroundCastShadow"),this._fontCastShadow=new Vy("fontCastShadow"),this._backgroundReceiveShadow=new Vy("backgroundReceiveShadow"),this._fontReceiveShadow=new Vy("fontReceiveShadow"),this._renderOrder=new QX,this._segments=t.segments?new t.segments:new vN,this._bounds=t.bounds?new t.bounds:new Nc("bounds"),this._order=new FY,this._padding=new JX,this._margin=new KX,this._position=new nN,this._flexDirection=t.flexDirection?new t.flexDirection:new E1,this._justifyContent=t.justifyContent?new t.justifyContent:new T1,this._alignItems=t.alignItems?new t.alignItems:new S1,this._display=new lY("flex"),this._boxSizing=new dY("border-box"),this._width=new zY,this._height=new GY,this._backgroundColor=t.backgroundColor?new t.backgroundColor:new iN,this._backgroundOpacity=new MS("backgroundOpacity",.5),this._backgroundImage=new gY,this._backgroundSize=new vY("cover"),this._color=t.color?new t.color:new uA("color","inherit"),this._fontOpacity=new MS("fontOpacity","inherit"),this._whiteSpace=t.whiteSpace?new t.whiteSpace:new gN,this._fontFamily=t.fontFamily?new t.fontFamily:new pN,this._fontStyle=t.fontStyle?new t.fontStyle:new oN("normal"),this._fontWeight=t.fontWeight?new t.fontWeight:new aN,this._fontSize=t.fontSize?new t.fontSize:new b7,this._lineHeight=t.lineHeight?new t.lineHeight:new mN,this._fontKerning=t.fontKerning?new t.fontKerning:new gx,this._letterSpacing=t.letterSpacing?new t.letterSpacing:new AN,this._overflow=new _Y("visible"),this._borderRadius=new CY(0),this._borderWidth=new EY(0),this._borderColor=new uA("borderColor",16711935),this._borderOpacity=new MS("borderOpacity",1),this._font=new oY,this._lineBreak=t.lineBreak?new t.lineBreak:new Nc("lineBreak"),this._textContent=t.textContent?new t.textContent:new rN,this._glyphs=t.glyphs?new t.glyphs:new Nc("glyphs"),this._inlines=t.inlines?new t.inlines:new Nc("inlines"),this._layouter=t.layouter?new t.layouter:new Nc("layouter"),this._inlineJustificator=new MY,this._textAlign=t.textAlign?new t.textAlign:new C1,this._autoSize=t.autoSize?new t.autoSize:new Nc("autoSize"),this._renderer=t.renderer?new t.renderer:new Nc("renderer"),this._offset=new jX,this._invertAlpha=new _7,this._fontSmooth=t.fontSmooth?new t.fontSmooth:new WX,this._components=[this._textContent,this._children,this._parent,this._autoSize,this._fontFamily,this._fontStyle,this._fontWeight,this._font,this._whiteSpace,this._glyphs,this._inlines,this._visible,this._backgroundSide,this._fontSide,this._backgroundAlphaTest,this._fontAlphaTest,this._backgroundCastShadow,this._fontCastShadow,this._backgroundReceiveShadow,this._fontReceiveShadow,this._renderOrder,this._segments,this._padding,this._margin,this._width,this._height,this._borderWidth,this._boxSizing,this._bounds,this._position,this._flexDirection,this._justifyContent,this._alignItems,this._order,this._display,this._backgroundColor,this._backgroundOpacity,this._backgroundImage,this._backgroundSize,this._fontOpacity,this._color,this._fontSize,this._lineHeight,this._fontKerning,this._letterSpacing,this._borderRadius,this._borderColor,this._borderOpacity,this._lineBreak,this._offset,this._layouter,this._inlineJustificator,this._textAlign,this._invertAlpha,this._fontSmooth,this._fontMaterial,this._fontCustomDepthMaterial,this._overflow,this._renderer],this._onAfterUpdates=[],i.backgroundSide||(i.backgroundSide=0),i&&this.set(i)}update(){const t={};for(const i of this._components)i._needsUpdate&&(i.update(this,t),i._needsUpdate=!1);this._transferToBackgroundMesh(t),this._transferToFontMesh(t),this._transferToBackgroundMaterial(t),this._transferToFontMaterial(t);for(const i of this._children._uis)i.update()}process(){for(const t of this._children._uis)t.process();for(const t of this._components)t._needsProcess&&(t.process(this),t._needsProcess=!1)}render(){for(let t=0;t<this._components.length;t++){const i=this._components[t];i._needsRender&&(i.render(this),i._needsRender=!1)}for(const t of this._children._uis)t.render()}set(t){if(t.fontTexture&&(console.warn("ThreeMeshUI::set( {fontTexture} ) is deprecated. Please use fontLibrary to register font families and variants."),t.fontFamily)){const i=t.fontFamily.pages?t.fontFamily.info.face:t.fontFamily;let s=md.getFontFamily(i);if(!s){const r=t.fontStyle?t.fontStyle:"normal",o=t.fontWeight?t.fontWeight:"400";s=md.addFontFamily(i).addVariant(o,r,t.fontFamily,t.fontTexture)}t.fontFamily=s,delete t.fontTexture}for(let i of Object.keys(t)){const s=t[i];switch(i){case"contentDirection":console.warn("ThreeMeshUI v7xx: property `contentDirection` is deprecated and has been renamed as `flexDirection`"),i="flexDirection";break;case"interLine":console.warn("ThreeMeshUI v7xx: property `interLine` is deprecated and has been renamed as `lineHeight`"),i="lineHeight";break;case"content":console.warn("ThreeMeshUI v7xx: property `content` is deprecated and has been renamed as `textContent`"),i="textContent";break;case"fontColor":console.warn("ThreeMeshUI v7xx: property `fontColor` is deprecated and has been renamed as `color`"),i="color";break;case"hiddenOverflow":console.warn("ThreeMeshUI v7xx: property `hiddenOverflow` is deprecated and has been renamed as `overflow`"),i="overflow";break;case"backgroundTexture":console.warn("ThreeMeshUI v7xx: property `backgroundTexture` is deprecated and has been renamed as `backgroundImage`"),i="backgroundImage";break;case"alignContent":console.warn("ThreeMeshUI v7xx: property `alignContent` is deprecated and has been renamed as `alignItems`"),i="alignItems";break;case"borderTopColor":case"borderBottomColor":case"borderLeftColor":case"borderRightColor":i="borderColor";break}switch(i){case"fontSmooth":case"renderOrder":case"segments":case"visible":case"offset":this[`_${i}`].value=s;break;case"flexDirection":case"justifyContent":case"alignItems":case"color":case"fontFamily":case"fontOpacity":case"fontKerning":case"fontSize":case"fontStyle":case"fontWeight":case"textAlign":case"letterSpacing":case"lineHeight":case"whiteSpace":case"breakOn":case"width":case"height":case"padding":case"margin":case"backgroundColor":case"backgroundOpacity":case"backgroundImage":case"backgroundSize":case"borderColor":case"borderOpacity":case"borderRadius":case"borderWidth":case"overflow":case"order":case"boxSizing":this[`_${i}`]&&(this[`_${i}`].inline=s);break;case"paddingTop":this._padding.top=s;break;case"paddingRight":this._padding.right=s;break;case"paddingBottom":this._padding.bottom=s;break;case"paddingLeft":this._padding.left=s;break;case"marginTop":this._margin.top=s;break;case"marginRight":this._margin.right=s;break;case"marginBottom":this._margin.bottom=s;break;case"marginLeft":this._margin.left=s;break;case"borderTopWidth":this._borderWidth.top=s;break;case"borderRightWidth":this._borderWidth.right=s;break;case"borderBottomWidth":this._borderWidth.bottom=s;break;case"borderLeftWidth":this._borderWidth.left=s;break;case"borderTopLeftRadius":this._borderRadius.topLeft=s;break;case"borderTopRightRadius":this._borderRadius.topRight=s;break;case"borderBottomRightRadius":this._borderRadius.bottomRight=s;break;case"borderBottomLeftRadius":this._borderRadius.bottomLeft=s;break;case"side":case"castShadow":case"receiveShadow":const r=i.charAt(0).toUpperCase()+i.substr(1);this[`_background${r}`].value=s,this[`_font${r}`].value=s;break;case"fontSide":case"backgroundSide":case"fontCastShadow":case"backgroundCastShadow":case"fontReceiveShadow":case"backgroundReceiveShadow":case"fontMaterial":case"fontCustomDepthMaterial":this[`_${i}`].value=s;break;default:this[`_${i}`]!==void 0?this[`_${i}`].value=s:this[i]=s}}}get(t){switch(t){case"overflow":case"width":case"height":return this[`_${t}`].inline}}_rebuildChildrenLists(){this._children._needsUpdate=!0}add(t){let i=!1;for(let s=0;s<arguments.length;s++)super.add(arguments[s]),arguments[s].isUI&&(i=!0);return i&&this._rebuildChildrenLists(),this}remove(t){for(const i of Object.keys(arguments))arguments[i].isInline&&this.update(null,!0);return super.remove(...arguments),this._rebuildChildrenLists(),this}clear(){return this.removeFromParent(),this.traverse(t=>{t.material&&t.material.dispose(),t.geometry&&t.geometry.dispose()}),super.clear(),this._backgroundMesh=null,this._backgroundMaterial=null,this._backgroundMaterialMediation=null,this._backgroundMeshMediation=null,this._children.dispose(),this._children=null,this._parent.dispose(),this._parent=null,this._backgroundSide=null,this._backgroundAlphaTest=null,this._visible=null,this._backgroundCastShadow=null,this._backgroundReceiveShadow=null,this._renderOrder=null,this._segments=null,this._bounds=null,this._boxSizing=null,this._padding=null,this._margin=null,this._position=null,this._flexDirection=null,this._justifyContent=null,this._alignItems=null,this._display=null,this._backgroundColor=null,this._backgroundOpacity=null,this._backgroundSize=null,this._fontOpacity=null,this._color=null,this._whiteSpace=null,this._fontFamily=null,this._fontStyle=null,this._fontWeight=null,this._lineHeight=null,this._fontKerning=null,this._letterSpacing=null,this._overflow=null,this._textAlign=null,this._font=null,this._lineBreak=null,this._layouter=null,this}get textContent(){return this._textContent.process(this),this._textContent._value}get backgroundMaterial(){return this._backgroundMaterial}set backgroundMaterial(t){this._backgroundMaterial=t,this._backgroundMaterialMediation={...t.constructor.mediation},this._transferToBackgroundMaterial(),this._backgroundMesh&&(this._backgroundMesh.material=this._backgroundMaterial,xo(t,"frameSize",this._backgroundMesh.scale))}set backgroundCustomDepthMaterial(t){this._backgroundCustomDepthMaterial=t,this._transferToBackgroundMaterial(),this._backgroundMesh&&(this._backgroundMesh.customDepthMaterial=this._backgroundCustomDepthMaterial)}get backgroundCustomDepthMaterial(){return this._backgroundCustomDepthMaterial}_transferToBackgroundMaterial(t=null){if(!t){t={};for(const i of this._components)i.output(t)}zy.mediate(this,this._backgroundMaterial,t,this._backgroundMaterialMediation,this._backgroundCustomDepthMaterial)}set backgroundSide(t){this._backgroundSide.value=t,this._backgroundMaterial&&(this._backgroundMaterial.side=t)}get backgroundSide(){return this._backgroundSide.value}set backgroundAlphaTest(t){this._backgroundAlphaTest.value=t,this._backgroundMaterial&&(this._backgroundMaterial.alphaTest=t)}get backgroundAlphaTest(){return this._backgroundAlphaTest.value}get fontMaterial(){return this._fontMaterial.value}set fontMaterial(t){this._fontMaterial.value=t}set fontCustomDepthMaterial(t){this._fontCustomDepthMaterial.value=t}get fontCustomDepthMaterial(){return this._fontCustomDepthMaterial.value}_transferToFontMaterial(t=null){const i=this._fontMaterial.value;if(i){if(!t){t={};for(const s of this._components)s.output(t)}zy.mediate(this,i,t,this._fontMaterial._mediation,this._fontCustomDepthMaterial.value)}}set fontSide(t){this._fontSide.value=t}get fontSide(){return this._fontSide.value}set fontAlphaTest(t){this._fontAlphaTest.value=t}get fontAlphaTest(){return this._fontAlphaTest.value}_transferToBackgroundMesh(t=null){if(!t){t={};for(const i of this._components)i.output(t)}zy.mediate(this,this._backgroundMesh,t,this._backgroundMeshMediation)}setBackgroundMesh(t){this._backgroundMesh&&(this.remove(this._backgroundMesh),this.unbindBackgroundMeshProperties()),this._backgroundMesh=t,this._backgroundMesh&&(this.bindBackgroundMeshProperties(),this._backgroundCustomDepthMaterial&&(this._backgroundMesh.customDepthMaterial=this._backgroundCustomDepthMaterial),this._backgroundMaterial&&xo(this._backgroundMaterial,"frameSize",this._backgroundMesh.scale),this._transferToBackgroundMesh(),this.add(this._backgroundMesh))}bindBackgroundMeshProperties(){}unbindBackgroundMeshProperties(){}activatePseudoState(t){}deactivatePseudoState(t){}togglePseudoState(t){}hasPseudoState(t){return!1}set borderRadiusMediation(t){this._borderRadius.mediation=t}set backgroundCastShadow(t){this._backgroundCastShadow&&(this._backgroundCastShadow.value=t)}get backgroundCastShadow(){return this._backgroundCastShadow}set backgroundReceiveShadow(t){this._backgroundReceiveShadow&&(this._backgroundReceiveShadow.value=t)}get backgroundReceiveShadow(){return this._backgroundReceiveShadow}set renderOrder(t){this._renderOrder&&(this._renderOrder.value=t)}get renderOrder(){return this._renderOrder.value}_transferToFontMesh(t=null){if(this._fontMesh){if(!t){t={};for(const i of this._components)i.output(t)}zy.mediate(this,this._fontMesh,t,this._fontMeshMediation)}}setFontMesh(t){this._fontMesh&&(this.remove(this._fontMesh),this._fontMesh.material&&this._fontMesh.material.dispose(),this._fontMesh.geometry&&this._fontMesh.geometry.dispose(),this._fontMesh=null,this.unbindFontMeshProperties()),this._fontMesh=t,this._fontMesh&&(this._fontMesh.raycast=()=>{},this.bindFontMeshProperties(),this._transferToFontMaterial(),this._transferToFontMesh(),this.add(this._fontMesh))}bindFontMeshProperties(){}unbindFontMeshProperties(){}set fontCastShadow(t){this._fontCastShadow&&(this._fontCastShadow.value=t)}get fontCastShadow(){return this._fontCastShadow}set fontReceiveShadow(t){this._fontReceiveShadow&&(this._fontReceiveShadow.value=t)}get fontReceiveShadow(){return this._fontReceiveShadow}set segments(t){this._segments.value=t}get segments(){return this._segments.value}set onAfterUpdate(t){console.warn("ThreeMeshUI v7xx : `onAfterUpdate()` property has been deprecated, please rely on `addAfterUpdate` instead."),this.addAfterUpdate(t)}addAfterUpdate(t){this._onAfterUpdates.push(t)}removeAfterUpdate(t){const i=this._onAfterUpdates.indexOf(t);i!==-1&&this._onAfterUpdates.splice(i,1)}performAfterUpdate(){for(let t=0;t<this._onAfterUpdates.length;t++)this._onAfterUpdates[t]()}getProperty(t){return this[`_${t}`]?this[`_${t}`]:null}appendProperty(t,i){this[`_${t}`]=i,this._components.push(i)}replaceProperty(t,i){const s=this[`_${t}`],r=this._components.indexOf(s);return this._components[r]=this[`_${t}`]=i,i.needsUpdate=!0,s}}class Mb{static register(e){this.elements.includes(e)||this.elements.push(e)}static remove(e){const t=this.elements.indexOf(e);t!==-1&&this.elements.splice(t,1)}static update(){for(const e of this.elements)e.update(),e.process(),e.process(),e.render()}}Mb.elements=[];const iJ=`

// FrameBorder vertex pars
attribute vec2 uvB;
varying vec2 vUvB;

`,H1=iJ,nJ=`

	// FrameBorder vertex shader
	vUvB = uvB;

`,Q1=nJ,sJ=`

// borders sequences are : x:TOP, y:RIGHT, z:BOTTOM, w:LEFT
uniform vec4 borderWidth;
uniform vec3 borderColor;
uniform float borderOpacity;
uniform vec4 borderRadius;

uniform vec2 cornerTL;
uniform vec2 cornerTR;
uniform vec2 cornerBR;
uniform vec2 cornerBL;

varying vec2 vUvB;

float getEllipticFactor( vec2 uv, vec2 center, float radiusX, float radiusY )
{

		float edx = uv.x - center.x;
		float edy = uv.y - center.y;

		float ddx = (edx * edx) / (radiusX * radiusX);
		float ddy = (edy * edy) / (radiusY * radiusY);

		return ddx + ddy;

}

`,j1=sJ,rJ=`

vec4 borderColor = vec4( borderColor, borderOpacity );

// This could be tweak to produce more smoothing
float mult = 1.0;

// Step 1 ----------------------------------------------
// Draw the four borders ( top - right - bottom - left )
// Without worrying about radiuses ( Straight boorders )

// Top
float topBorderUVy = 1.0 - borderWidth.x;
if( borderWidth.x > 0.0 && vUvB.y > topBorderUVy )
{

	float w = fwidth( 1.0 - vUvB.y ) * mult;
	float step = smoothstep( topBorderUVy , topBorderUVy + w , vUvB.y );
	diffuseColor = mix( diffuseColor, borderColor, step );

}

// Left
float leftBorderUVx = borderWidth.w;
if( borderWidth.w > 0.0 && vUvB.x < leftBorderUVx )
{

	float w = fwidth( vUvB.x ) * mult ;
	float step = smoothstep( leftBorderUVx , leftBorderUVx - w , vUvB.x );
	diffuseColor = mix( diffuseColor, borderColor, step );

}

// Bottom
float bottomBorderUVy = borderWidth.z;
if( borderWidth.z > 0.0 && vUvB.y < bottomBorderUVy )
{
	float w = fwidth( vUvB.y ) * mult;
	float step = smoothstep( bottomBorderUVy , bottomBorderUVy - w , vUvB.y );
	diffuseColor = mix( diffuseColor, borderColor, step );
}

// Right
float rightBorderUVx = 1.0 - borderWidth.y;
if( borderWidth.y > 0.0 && vUvB.x > rightBorderUVx )
{
	float w = fwidth( 1.0 - vUvB.x ) * mult;
	float step = smoothstep( rightBorderUVx , rightBorderUVx + w , vUvB.x );
	diffuseColor = mix( diffuseColor, borderColor, step );
}


// Step 2 ----------------------------------------------
// Process each corners ( topLeft, topRight, bottomRight, bottomLeft )
// To transparentize outside radiuses
// To draw ellipse border on the corner


// Top Left corner
if( vUvB.x < cornerTL.x && vUvB.y > cornerTL.y ) {

		// Only draw border if width is set
		if( borderWidth.w + borderWidth.x > 0.0 ){

			float borderFactor = getEllipticFactor( vUvB, cornerTL, cornerTL.x - borderWidth.w,  ( 1.0 - cornerTL.y ) - borderWidth.x );
			float step = smoothstep( 1.0, 1.0 + fwidth( borderFactor ) * mult, borderFactor );
			diffuseColor = mix( diffuseColor, borderColor, step );

		}

		// Then then radius
		float radiusFactor = getEllipticFactor( vUvB, cornerTL, cornerTL.x, 1.0 - cornerTL.y );
		float alphaStep = smoothstep( 1.0 , 1.0 + fwidth(radiusFactor) * mult , radiusFactor );
		diffuseColor.a = mix( diffuseColor.a, 0.0, alphaStep );

}
// Bottom Left
if( vUvB.x < cornerBL.x && vUvB.y < cornerBL.y ) {

		if( borderWidth.w + borderWidth.z > 0.0 ){

			float borderFactor = getEllipticFactor( vUvB, cornerBL, cornerBL.x - borderWidth.w,  cornerBL.y - borderWidth.z );
			float step = smoothstep( 1.0, 1.0 + fwidth( borderFactor ) * mult, borderFactor );
			diffuseColor = mix( diffuseColor, borderColor, step );

		}


		float radiusFactor = getEllipticFactor( vUvB, cornerBL, cornerBL.x, cornerBL.y );
		float alphaStep = smoothstep( 1.0 , 1.0 + fwidth(radiusFactor) * mult , radiusFactor );
		diffuseColor.a = mix( diffuseColor.a, 0.0, alphaStep );

}
// Top Right
if( vUvB.x > cornerTR.x && vUvB.y > cornerTR.y ) {

		if( borderWidth.y + borderWidth.x > 0.0 ){

			float borderFactor = getEllipticFactor( vUvB, cornerTR, ( 1.0 - cornerTR.x ) - borderWidth.y,  ( 1.0 - cornerTR.y ) - borderWidth.x );
			float step = smoothstep( 1.0, 1.0 + fwidth( borderFactor ) * mult, borderFactor );
			diffuseColor = mix( diffuseColor, borderColor, step );

		}

		float radiusFactor = getEllipticFactor( vUvB, cornerTR, 1.0 - cornerTR.x, 1.0 - cornerTR.y );
		float alphaStep = smoothstep( 1.0 , 1.0 + fwidth(radiusFactor) * mult , radiusFactor );
		diffuseColor.a = mix( diffuseColor.a, 0.0, alphaStep );

}
// Bottom Right
if( vUvB.x > cornerBR.x && vUvB.y < cornerBR.y ) {

		if( borderWidth.y + borderWidth.z > 0.0 ){

			float borderFactor = getEllipticFactor( vUvB, cornerBR, ( 1.0 - cornerBR.x ) - borderWidth.y,  cornerBR.y - borderWidth.z );
			float step = smoothstep( 1.0, 1.0 + fwidth( borderFactor ) * mult, borderFactor );
			diffuseColor = mix( diffuseColor, borderColor, step );

		}

		float radiusFactor = getEllipticFactor( vUvB, cornerBR, 1.0 - cornerBR.x, cornerBR.y );
		float alphaStep = smoothstep( 1.0 , 1.0 + fwidth(radiusFactor) * mult , radiusFactor );
		diffuseColor.a = mix( diffuseColor.a, 0.0, alphaStep );

}

`,W1=rJ,oJ=`

// To be removed - required for both border and background
uniform vec3 frameSize;
uniform vec2 textureSize;

`,q1=oJ,aJ=`

#ifdef USE_MAP

vec4 sampleTexture() {

	vec2 uv = vUv;

	// default stretch
	#if BACKGROUND_MAPPING != 0

	float textureRatio = textureSize.x / textureSize.y;
	float panelRatio = frameSize.x / frameSize.y;
	float ratio = panelRatio / textureRatio;
	float ratio2 = textureRatio / panelRatio;

		// contain
		#if BACKGROUND_MAPPING == 1
		if ( textureRatio < panelRatio ) { // repeat on X
			float newX = uv.x * ratio;
			newX += 0.5 - 0.5 * ratio;
			uv.x = newX;
		} else { // repeat on Y
			float newY = uv.y * ratio2;
			newY += 0.5 - 0.5 * ratio2;
			uv.y = newY;
		}
		#else
		// cover
		if ( textureRatio < panelRatio ) { // stretch on Y
			float newY = uv.y * ratio2;
			newY += 0.5 - 0.5 * ratio2;
			uv.y = newY;
		} else { // stretch on X
			float newX = uv.x * ratio;
			newX += 0.5 - 0.5 * ratio;
			uv.x = newX;
		}

		#endif

	#endif

	return texture2D( map, uv );

}
#endif
`,X1=aJ,cJ=`
#ifdef USE_MAP

	vec4 textureSample = sampleTexture();
	diffuseColor *= textureSample;

#endif
`,Y1=cJ,ZN={msdfAlphaglyphParsVertexGlsl:M1,msdfAlphaglyphVertexGlsl:I1,msdfOffsetglyphVertexGlsl:R1,msdfAlphaglyphParsFragmentGlsl:P1,msdfAlphaglyphFragmentGlsl:B1,frameBorderParsVertexGlsl:H1,frameBorderVertexGlsl:Q1,frameCommonParsFragmentGlsl:q1,frameBorderParsFragmentGlsl:j1,frameBorderFragmentGlsl:W1,frameBackgroundParsFragmentGlsl:X1,frameBackgroundFragmentGlsl:Y1},lJ=`
// Would be automatic on three materials and from USE_UV
#ifdef USE_MAP
varying vec2 vUv;
#endif

${H1}

#include <clipping_planes_pars_vertex>

void main() {

	#ifdef USE_MAP
	vUv = uv;
	#endif

	${Q1}

	vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );
	gl_Position = projectionMatrix * mvPosition;

	#include <clipping_planes_vertex>

}
`,hJ=`

// Basic
uniform vec3 diffuse;
uniform float opacity;

#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif

${q1}

${j1}


#ifdef USE_MAP
varying vec2 vUv;
uniform sampler2D map;
#endif

${X1}

#include <clipping_planes_pars_fragment>

void main() {

	vec4 diffuseColor = vec4( diffuse, opacity );

	// map
	${Y1}

	${W1}

	#ifdef USE_ALPHATEST

	if ( diffuseColor.a < alphaTest ) discard;

	#endif

	// output
	gl_FragColor = diffuseColor;


	#include <clipping_planes_fragment>
}
`;class Ib{static get mediation(){return dJ}static ensureMaterialOptions(e){e.transparent=!0,e.alphaTest=e.alphaTest||.02}static ensureDefines(e){e.defines||(e.defines={})}static ensureUserData(e,t){e.userData.borderColor={value:null},e.userData.borderRadius={value:new We.Vector4(0,0,0,0)},e.userData.cornerTL={value:new We.Vector2(0,1)},e.userData.cornerTR={value:new We.Vector2(1,1)},e.userData.cornerBR={value:new We.Vector2(1,0)},e.userData.cornerBL={value:new We.Vector2(0,0)},e.userData.borderWidth={value:new We.Vector4(0,0,0,0)},e.userData.borderOpacity={value:null},e.userData.frameSize={value:new We.Vector3(1,1,1)},e.userData.textureSize={value:new We.Vector2(1,1)}}static bindUniformsWithUserData(e,t){e.uniforms.borderColor=t.userData.borderColor,e.uniforms.borderRadius=t.userData.borderRadius,e.uniforms.cornerTL=t.userData.cornerTL,e.uniforms.cornerTR=t.userData.cornerTR,e.uniforms.cornerBR=t.userData.cornerBR,e.uniforms.cornerBL=t.userData.cornerBL,e.uniforms.borderWidth=t.userData.borderWidth,e.uniforms.borderOpacity=t.userData.borderOpacity,e.uniforms.frameSize=t.userData.frameSize,e.uniforms.textureSize=t.userData.textureSize}static injectShaderChunks(e){Ib.injectVertexShaderChunks(e),Ib.injectFragmentShaderChunks(e)}static injectVertexShaderChunks(e){e.vertexShader=e.vertexShader.replace("#include <uv_pars_vertex>",`#include <uv_pars_vertex>
`+H1),e.vertexShader=e.vertexShader.replace("#include <uv_vertex>",`#include <uv_vertex>
`+Q1)}static injectFragmentShaderChunks(e){e.fragmentShader=e.fragmentShader.replace("#include <map_pars_fragment>",`#include <map_pars_fragment>
`+X1),e.fragmentShader=e.fragmentShader.replace("#include <map_pars_fragment>",`#include <map_pars_fragment>
`+j1),e.fragmentShader=e.fragmentShader.replace("#include <map_pars_fragment>",`#include <map_pars_fragment>
`+q1),e.fragmentShader=e.fragmentShader.replace("#include <map_fragment>",Y1),e.fragmentShader=e.fragmentShader.replace("#include <alphamap_fragment>",W1+`
#include <alphamap_fragment>`)}}const uJ=function(n,e,t){t=["stretch","contain","cover"].indexOf(t),dN(n,"BACKGROUND_MAPPING",t)},dJ={clippingPlanes:{m:"clippingPlanes"},backgroundAlphaTest:{m:"alphaTest",t:px},backgroundSide:{m:"side"},backgroundImage:{m:"map"},backgroundColor:{m:"color"},backgroundOpacity:{m:"opacity"},backgroundSize:{m:"computedBackgroundSize",t:uJ},borderWidth:{m:"borderWidth",t:xo},borderColor:{m:"borderColor",t:xo},cornerTL:{m:"cornerTL",t:xo},cornerTR:{m:"cornerTR",t:xo},cornerBR:{m:"cornerBR",t:xo},cornerBL:{m:"cornerBL",t:xo},borderOpacity:{m:"borderOpacity",t:xo},size:{m:"frameSize",t:xo},tSize:{m:"textureSize",t:xo}};class $N extends We.ShaderMaterial{static get mediation(){return Ib.mediation}constructor(){super({uniforms:{alphaTest:{value:.02},map:{value:null},diffuse:{value:new We.Color(16777215)},opacity:{value:1},borderColor:{value:new We.Color(0)},borderOpacity:{value:0},borderRadius:{value:new We.Vector4(0,0,0,0)},cornerTL:{value:new We.Vector2(0,1)},cornerTR:{value:new We.Vector2(1,1)},cornerBR:{value:new We.Vector2(1,0)},cornerBL:{value:new We.Vector2(0,0)},borderWidth:{value:new We.Vector4(0,0,0,0)},frameSize:{value:new We.Vector3(1,1,1)},textureSize:{value:new We.Vector2(1,1)}},side:We.FrontSide,transparent:!0,clipping:!0,vertexShader:lJ,fragmentShader:hJ,extensions:{derivatives:!0}}),this.defines.USE_ALPHATEST="",this.needsUpdate=!0}set map(e){this.uniforms.map.value=e,e?this.defines.USE_UV===void 0&&(this.defines.USE_UV="",this.needsUpdate=!0):this.defines.USE_UV!==void 0&&(delete this.defines.USE_UV,this.needsUpdate=!0),this.needsUpdate=!0}get map(){return this.uniforms.map.value}get alphaTest(){return this.uniforms.alphaTest.value}set alphaTest(e){this.uniforms.alphaTest.value=e}set opacity(e){this.uniforms&&(this.uniforms.opacity.value=e)}get opacity(){return this.uniforms.opacity.value}get color(){return this.uniforms.diffuse.value}set color(e){this.uniforms.diffuse.value=e}}class fJ extends Ci{constructor(){super("children",null,!1);u(this,"_sortOrder",(t,i)=>t._order._value<i._order._value?-1:t._order._value>i._order._value?1:this._uis.indexOf(t)<this._uis.indexOf(i)?-1:1);this._uis=[],this._boxes=[]}update(t,i){this._compute(t),t._layouter._needsUpdate=!0,t._renderOrder._needsUpdate=!0}process(t){this._compute(t),t._flexDirection._needsProcess=!0,t._layouter._needsProcess=!0,t._overflow._needsRender=!0}_compute(t){this._uis=t.children.filter(i=>i.visible&&i.isUI),this._boxes=this._uis.filter(i=>i.isBox).sort(this._sortOrder)}dispose(){this._uis=null,this._boxes=null}}class e3 extends Ci{constructor(){super("bounds",null,!1),this._size=new We.Vector3(1,1,1),this._offsetWidth=0,this._offsetHeight=0,this._innerWidth=0,this._innerHeight=0,this._centerX=.5,this._centerY=.5,this._needsProcess=!0}setReferenceWidth(e,t){const i=e._width,s=e._padding._value,r=e._borderWidth._value,o=e._margin._value,a=i._auto?1:i._value,c=t*a-(o.y+o.w);rT(c,this._offsetWidth)||(this._offsetWidth=c,this._innerWidth=this._offsetWidth-(s.y+s.w+r.y+r.w),this._centerX=BS(e),this._propagateWidth(e),this._triggerCascadingDependencies(e))}setReferenceHeight(e,t){const i=e._height,s=e._padding._value,r=e._borderWidth._value,o=e._margin._value,a=i._auto?1:i._value,c=t*a-(o.x+o.z);rT(c,this._offsetHeight)||(this._offsetHeight=c,this._innerHeight=this._offsetHeight-(s.x+s.z+r.x+r.z),this._centerY=DS(e),this._propagateHeight(e),this._triggerCascadingDependencies(e))}setChildrenWidth(e,t){const i=e._padding._value,s=e._borderWidth._value;this._innerWidth=t,this._offsetWidth=this._innerWidth+(i.y+i.w+s.y+s.w),this._centerX=BS(e),this._propagateWidth(e),this._triggerCascadingDependencies(e)}setChildrenHeight(e,t){const i=e._padding._value,s=e._borderWidth._value;this._innerHeight=t,this._offsetHeight=this._innerHeight+(i.x+i.z+s.x+s.z),this._centerY=DS(e),this._propagateHeight(e),this._triggerCascadingDependencies(e)}update(e,t){const i=e._padding._value,s=e._borderWidth._value,r=e._width;!r._auto&&!r._relative&&(e._boxSizing._value==="content-box"?(this._innerWidth=r._value,this._offsetWidth=this._innerWidth+i.y+i.w+s.y+s.w):(this._offsetWidth=r._value,this._innerWidth=this._offsetWidth-(i.y+i.w+s.y+s.w)),this._centerX=BS(e),this._needsProcess=!0,this._propagateWidth(e),this._triggerCascadingDependencies(e));const o=e._height;!o._auto&&!o._relative&&(e._boxSizing._value==="content-box"?(this._innerHeight=o._value,this._offsetHeight=this._innerHeight+i.x+i.z+s.x+s.z):(this._offsetHeight=o._value,this._innerHeight=this._offsetHeight-(i.x+i.z+s.x+s.z)),this._centerY=DS(e),this._needsProcess=!0,this._propagateHeight(e),this._triggerCascadingDependencies(e))}render(e){this._size.x=this._offsetWidth,this._size.y=this._offsetHeight,e._backgroundMesh&&e._backgroundMesh.updateScale(),e._renderer._needsRender=!0}output(e){e.size=this._size}process(e){e._overflow._needsRender=!0}_computeChildrenSideWidth(e){return pJ(e)}_computeChildrenSideHeight(e){return mJ(e)}_propagateWidth(e){for(let t=0;t<e._children._boxes.length;t++){const i=e._children._boxes[t];i._width._relative&&i._bounds.setReferenceWidth(i,this._innerWidth)}}_propagateHeight(e){for(let t=0;t<e._children._boxes.length;t++){const i=e._children._boxes[t];i._height._relative&&i._bounds.setReferenceHeight(i,this._innerHeight)}}_triggerCascadingDependencies(e){e._parent._value&&(e._parent._value._autoSize._needsProcess=!0),e._flexDirection._needsProcess=!0,e._fontSize._needsProcess=!0,e._layouter._needsProcess=!0,this._needsRender=!0,e._borderWidth._needsRender=!0,e._borderRadius._needsRender=!0,e._overflow._needsRender=!0}}function BS(n){const e=n._padding._value,t=n._borderWidth._value,i=e.w+t.w,s=e.y+t.y;return(i-s)/2}function DS(n){const e=n._padding._value,t=n._borderWidth._value,i=e.x+t.x;return(e.z+t.z-i)/2}function pJ(n){return n._children._boxes.reduce((e,t)=>{const i=t._margin._value,s=t._bounds._offsetWidth+i.y+i.w;return e+s},0)}function mJ(n){return n._children._boxes.reduce((e,t)=>{const i=t._margin._value,s=t._bounds._offsetHeight+i.x+i.z;return e+s},0)}class gJ extends S1{constructor(){super(),this._allowsInherit=!1,this._needsUpdate=!0,this._process=this.emptyStrategyLogic,this._childAlign=this.emptyStrategyLogic}computeOutputValue(e){switch(this._value=this._inheritedInput,e._flexDirection._value){case"row":case"row-reverse":switch(this._process=xJ,this._value){case"start":this._childAlign=vJ;break;case"end":this._childAlign=AJ;break;default:this._childAlign=CD}break;case"column":case"column-reverse":switch(this._process=_J,this._value){case"start":this._childAlign=bJ;break;case"end":this._childAlign=yJ;break;default:this._childAlign=CD}break}this._needsProcess=!0,e._autoSize._needsProcess=!0,e._flexDirection._needsProcess=!0,e._justifyContent._needsProcess=!0,this._needsProcess=!0,e._fontSize._needsProcess=!0,e._layouter._needsProcess=!0}process(e){this._process(e,this._childAlign);let t="center",i="center",s="center";const r=e._padding._value,o=e._borderWidth._value;e._flexDirection._value.indexOf("column")!==-1?this._value==="start"?t=i="left":this._value==="end"?t=i="right":t="centerX":this._value==="start"?t=s="top":this._value==="end"?t=s="bottom":t="centerY";let a=-(r.x-r.z)/2-(o.x-o.z)/2,c=-(r.y-r.w)/2-(o.y-o.w)/2;i==="left"?c=(r.w-r.y)/2+(o.w-o.y)/2:i==="right"&&(c=-(r.y-r.w)/2-(o.y-o.w)/2),s==="top"?a=-(r.x-r.z)/2-(o.x-o.z)/2:s==="bottom"&&(a=(r.z-r.x)/2+(o.z-o.x)/2),e._children._boxes.forEach(l=>{let h=0,d=0;t==="top"?d=-l._margin._value.x:t==="bottom"?d=l._margin._value.z:t==="left"?h=l._margin._value.w:t==="right"?h=-l._margin._value.y:t==="centerX"?h=(l._margin._value.w-l._margin._value.y)/2:t==="centerY"&&(d=(-l._margin._value.x+l._margin._value.z)/2),e._layouter._childrenPos[l.id].x+=c+h,e._layouter._childrenPos[l.id].y+=a+d})}}function CD(){return 0}function AJ(n,e){return-e+n._bounds._offsetHeight/2}function vJ(n,e){return e-n._bounds._offsetHeight/2}function yJ(n,e){return e-n._bounds._offsetWidth/2}function bJ(n,e){return-e+n._bounds._offsetWidth/2}function _J(n,e){const t=n._bounds._innerWidth/2;n._children._boxes.forEach(i=>{n._layouter._childrenPos[i.id].x=e(i,t)})}function xJ(n,e){const t=n._bounds._innerHeight/2;n._children._boxes.forEach(i=>{n._layouter._childrenPos[i.id].y=e(i,t)})}class wJ extends E1{constructor(){super(),this._allowsInherit=!1,this._needsUpdate=!0,this._offset=0,this._reverse=1,this._process=this.emptyStrategyLogic}computeOutputValue(e){switch(this._value=this._inheritedInput,this._value){case"row":this._process=SJ;break;case"row-reverse":this._process=CJ;break;case"column":this._process=EJ;break;case"column-reverse":this._process=TJ;break}e._justifyContent._needsUpdate||e._justifyContent.computeOutputValue(e),e._alignItems._needsUpdate||e._alignItems.computeOutputValue(e),this._needsProcess=!0}process(e){switch(this._value){case"row":this._offset=-e._bounds._innerWidth/2;break;case"row-reverse":this._offset=e._bounds._innerWidth/2;break;case"column":this._offset=e._bounds._innerHeight/2;break;case"column-reverse":this._offset=-e._bounds._innerHeight/2;break}this._reverse=-Math.sign(this._offset),this._reverse===0&&(this._reverse=1),this._process(e),e._justifyContent._needsProcess=!0,e._layouter._needsProcess=!0}}function SJ(n){let e=n._flexDirection._offset;const t=n._flexDirection._reverse,i=n._children._boxes;for(let s=0;s<i.length;s++){const r=i[s],o=r.id,a=r._bounds._offsetWidth;e+=r._margin._value.w*t;const c=n._layouter._childrenPos[o];c.x=e+a/2*t,c.y=0,e+=t*(a+r._margin._value.y)}}function CJ(n){let e=n._flexDirection._offset;const t=n._flexDirection._reverse,i=n._children._boxes;for(let s=0;s<i.length;s++){const r=i[s],o=r.id,a=r._bounds._offsetWidth;e+=r._margin._value.y*t;const c=n._layouter._childrenPos[o];c.x=e+a/2*t,c.y=0,e+=(a+r._margin._value.w)*t}}function EJ(n){let e=n._flexDirection._offset;const t=n._flexDirection._reverse,i=n._children._boxes;for(let s=0;s<i.length;s++){const r=i[s],o=r.id,a=r._bounds._offsetHeight;e+=r._margin._value.x*t;const c=n._layouter._childrenPos[o];c.x=0,c.y=e+a/2*t,e+=(a+r._margin._value.z)*t}}function TJ(n){let e=n._flexDirection._offset;const t=n._flexDirection._reverse,i=n._children._boxes;for(let s=0;s<i.length;s++){const r=i[s],o=r.id,a=r._bounds._offsetHeight;e+=r._margin._value.z*t;const c=n._layouter._childrenPos[o];c.x=0,c.y=e+a/2*t,e+=(a+r._margin._value.x)*t}}class MJ extends T1{constructor(e){super("justifyContent",e,!0),this._allowsInherit=!1,this._needsUpdate=!0,this._computeOffset=this.emptyStrategyLogic,this._computeMargin=this.emptyStrategyLogic,this._process=this.emptyStrategyLogic}computeOutputValue(e){switch(this._value=this._inheritedInput,e._flexDirection._value){case"column-reverse":case"column":this._process=RJ.bind(this);break;case"row-reverse":case"row":this._process=IJ.bind(this);break}switch(this._value){case"end":this._computeOffset=DJ,this._computeMargin=OS;break;case"center":this._computeOffset=OJ,this._computeMargin=OS;break;case"start":this._computeOffset=Hy,this._computeMargin=OS;break;case"space-between":this._computeOffset=Hy,this._computeMargin=kJ;break;case"space-around":this._computeOffset=Hy,this._computeMargin=FJ;break;case"space-evenly":this._computeOffset=Hy,this._computeMargin=LJ;break}e._flexDirection._needsProcess=!0}process(e){this._process(e),e._alignItems._needsProcess=!0}}function IJ(n){const e=n._flexDirection._offset,{usedDirectionSpace:t,remainingSpace:i}=PJ(n),s=e*2-t*Math.sign(e),r=this._computeOffset(s),o=this._computeMargin(n,i,n._flexDirection._reverse);n._children._boxes.forEach((a,c)=>{n._layouter._childrenPos[a.id].x-=r-o[c]})}function RJ(n){const e=n._flexDirection._offset,{usedDirectionSpace:t,remainingSpace:i}=BJ(n),s=e*2-t*Math.sign(e),r=this._computeOffset(s),o=this._computeMargin(n,i,n._flexDirection._reverse);n._children._boxes.forEach((a,c)=>{n._layouter._childrenPos[a.id].y-=r-o[c]})}function PJ(n){const e=n._bounds._computeChildrenSideWidth(n);return{usedDirectionSpace:e,remainingSpace:n._bounds._innerWidth-e}}function BJ(n){const e=n._bounds._computeChildrenSideHeight(n);return{usedDirectionSpace:e,remainingSpace:n._bounds._innerHeight-e}}function Hy(n){return 0}function DJ(n){return n}function OJ(n){return n/2}function OS(n,e=0,t=1){return Array(n._children._boxes.length).fill(0)}function kJ(n,e=0,t=1){const s=n._children._boxes.length,r=Array(s).fill(0);if(e>0&&s>1){const o=e/(s-1)*t;r[0]=0;for(let a=1;a<s;a++)r[a]=o*a}return r}function LJ(n,e=0,t=1){const s=n._children._boxes.length,r=Array(s).fill(0);if(e>0){const o=e/(s+1)*t;for(let a=0;a<s;a++)r[a]=o*(a+1)}return r}function FJ(n,e=0,t=1){const s=n._children._boxes.length,r=Array(s).fill(0);if(e>0){const o=e/s*t,a=o/2;r[0]=a;for(let c=1;c<s;c++)r[c]=a+o*c}return r}let kS;class t3 extends We.Mesh{constructor(e){const t=e.slice,i={};let s=1,r=1;if(t){if(s=t.width?t.width:1,r=t.height?t.height:1,t.top){if(t.left){const f=new We.PlaneGeometry(t.left*s,t.top*r,1,1);Lc(f,0,t.left,1-t.top,1),f.translate(t.left*s/2,-t.top*r/2,0),i.topLeft=f}const d=new We.PlaneGeometry(1,t.top*r,1,1);if(Lc(d,t.left,1-t.right,1-t.top,1),d.translate(0,-t.top*r/2,0),i.top=d,t.right){const f=new We.PlaneGeometry(t.right*s,t.top*r,1,1);Lc(f,1-t.right,1,1-t.top,1),f.translate(-t.right*s/2,-t.top*r/2,0),i.topRight=f}}if(t.left){const d=new We.PlaneGeometry(t.left*s,1,1,1);Lc(d,0,t.left,t.bottom,1-t.top),d.translate(t.left*s/2,0,0),i.left=d}const h=new We.PlaneGeometry(1,1,1,1);if(Lc(h,t.left,1-t.right,t.bottom,1-t.top),i.middle=h,t.right){const d=new We.PlaneGeometry(t.right*s,1,1,1);Lc(d,1-t.right,1,t.bottom,1-t.top),d.translate(-t.right*s/2,0,0),i.right=d}if(t.bottom){if(t.left){const f=new We.PlaneGeometry(t.left*s,t.bottom*r,1,1);Lc(f,0,t.left,0,t.bottom),f.translate(t.left*s/2,t.bottom*r/2,0),i.bottomLeft=f}const d=new We.PlaneGeometry(1,t.bottom*r,1,1);if(Lc(d,t.left,1-t.right,0,t.bottom),d.translate(0,t.bottom*r/2,0),i.bottom=d,t.right){const f=new We.PlaneGeometry(t.right*s,t.bottom*r,1,1);Lc(f,1-t.right,1,0,t.bottom),f.translate(-t.right*s/2,t.bottom*r/2,0),i.bottomRight=f}}}let o=e.backgroundMaterial;t&&(kS||(kS=new We.MeshBasicMaterial({alphaTest:1.1})),o=kS);const a=new We.PlaneGeometry(1,1,e._segments.value,e._segments.value),c=new We.BufferAttribute(new Float32Array(a.getAttribute("uv").array),2);if(a.setAttribute("uvB",c).name="uvB",super(a,o),this.name="UIBackgroundBox",t){this.slice=t,this.sliceSize=new We.Vector3(1-(t.left+t.right),1-(t.bottom+t.top),1),this.sliceScale=new We.Vector3(s,r,1);for(const l in i){const h=new We.Mesh(i[l],e.backgroundMaterial);this.add(h),i[l]=h}this.updateScale=this.updateScaleSlice,this.slices=i}}updateScale(){}updateScaleSlice(){const e=new We.Vector3(1,1,1);this.scale.x<(this.slice.left+this.slice.right)*this.sliceScale.x&&(e.x=this.scale.x/((this.slice.left+this.slice.right)*this.sliceScale.x)),this.scale.y<(this.slice.bottom+this.slice.top)*this.sliceScale.y&&(e.y=this.scale.y/((this.slice.bottom+this.slice.top)*this.sliceScale.y));for(const t in this.slices){const i=this.slices[t];i.scale.set(1/this.scale.x,1/this.scale.y,this.scale.y);const s=UJ[t];for(const o in s)i.position[o]=this.scale[o]*s[o]*i.scale[o];const r=NJ[t];if(r){r.x&&(i.position.x=this.sliceScale.x*.5*(this.slice.left-this.slice.right)*(1/this.scale.x)),r.y&&(i.position.y=this.sliceScale.y*.5*(this.slice.bottom-this.slice.top)*(1/this.scale.y));for(const o in r){const a=this.scale[o]-(1-this.sliceSize[o])*this.sliceScale[o];i.scale[o]=Math.max(0,a*(1/this.scale[o]))}}}e.x!==1&&(this.slices.left.scale.x*=e.x,this.slices.topLeft.scale.x*=e.x,this.slices.bottomLeft.scale.x*=e.x,this.slices.right.scale.x*=e.x,this.slices.topRight.scale.x*=e.x,this.slices.bottomRight.scale.x*=e.x),e.y!==1&&(this.slices.top.scale.y*=e.y,this.slices.topLeft.scale.y*=e.y,this.slices.topRight.scale.y*=e.y,this.slices.bottom.scale.y*=e.y,this.slices.bottomLeft.scale.y*=e.y,this.slices.bottomRight.scale.y*=e.y)}}const UJ={topLeft:{x:-.5,y:.5},top:{y:.5},topRight:{x:.5,y:.5},left:{x:-.5},right:{x:.5},bottomLeft:{x:-.5,y:-.5},bottom:{y:-.5},bottomRight:{x:.5,y:-.5}},NJ={top:{x:1},left:{y:1},right:{y:1},bottom:{x:1},middle:{x:1,y:1}};function Lc(n,e,t,i,s){const r=t-e,o=s-i,a=n.attributes.uv;for(let l=0;l<a.count;l++){const h=a.getX(l),d=a.getY(l);a.setXY(l,e+h*r,i+d*o)}const c=new We.BufferAttribute(new Float32Array(n.getAttribute("uv").array),2);n.setAttribute("uvB",c).name="uvB"}class i3 extends Ci{constructor(){super("renderer")}render(e){e._backgroundMesh||e.setBackgroundMesh(new t3(e)),e.performAfterUpdate()}}class zJ extends nN{constructor(){super("position")}update(e,t){super.update(e,t),this._needsProcess=!0}}class GJ extends Ci{constructor(){super("autosize"),this._needsProcess=!0}process(e){e._width._auto&&VJ(e),e._height._auto&&HJ(e);const t=e._alignItems._value==="stretch",i=t&&e._flexDirection._value.indexOf("column")!==-1,s=t&&!i;for(const r of e._children._boxes)(r._width._auto&&i||r._width._relative)&&r._bounds.setReferenceWidth(r,e._bounds._innerWidth),(r._height._auto&&s||r._height._relative)&&r._bounds.setReferenceHeight(r,e._bounds._innerHeight)}}function VJ(n){n._bounds.setChildrenWidth(n,jJ(n))}function HJ(n){n._bounds.setChildrenHeight(n,QJ(n))}function QJ(n){switch(n._flexDirection._value){case"row":case"row-reverse":return YJ(n);case"column":case"column-reverse":return qJ(n)}}function jJ(n){switch(n._flexDirection._value){case"row":case"row-reverse":return WJ(n);case"column":case"column-reverse":return XJ(n)}}function WJ(n){let e=0;for(const t of n._children._boxes){if(t._position._value!=="static")continue;const i=t._margin._value,s=t._bounds._offsetWidth+i.y+i.w;e+=s}return e}function qJ(n){let e=0;for(const t of n._children._boxes){if(t._position._value!=="static")continue;const i=t._margin._value,s=t._bounds._offsetHeight+i.x+i.z;e+=s}return e}function XJ(n){let e=0;for(const t of n._children._boxes){if(t._position._value!=="static")continue;const i=t._margin._value,s=t._bounds._offsetWidth+i.y+i.w;s>e&&(e=s)}return e}function YJ(n){let e=0;for(const t of n._children._boxes){if(t._position._value!=="static")continue;const i=t._margin._value,s=t._bounds._offsetHeight+i.x+i.z;s>e&&(e=s)}return e}class pA extends ZA{constructor(e,t){pA.definePropertiesValues(e,t),super(e,t),pA.init(this)}bindBackgroundMeshProperties(){this._bounds._size=this._backgroundMesh.scale,this._bounds._needsProcess=!0}unbindBackgroundMeshProperties(){this._bounds._size=new We.Vector3(1,1,1),this._bounds._needsProcess=!0}static definePropertiesValues(e,t){e.children||(e.children=fJ),e.bounds||(e.bounds=e3),e.flexDirection||(e.flexDirection=wJ),e.justifyContent||(e.justifyContent=MJ),e.alignItems||(e.alignItems=gJ),e.position||(e.position=zJ),e.autoSize||(e.autoSize=GJ),e.renderer||(e.renderer=i3),t.fontSide||(t.fontSide=0),t.invertAlpha||(t.invertAlpha=!1),t.fontCastShadow||(t.fontCastShadow=!1),t.fontReceiveShadow||(t.fontReceiveShadow=!1),t.backgroundCastShadow||(t.backgroundCastShadow=!1),t.backgroundReceiveShadow||(t.backgroundReceiveShadow=!1)}static init(e){Object.defineProperties(e,{isBox:{configurable:!1,enumerable:!0,value:!0}}),e.backgroundMaterial=new $N,e._renderer.render(e),e._backgroundMesh.visible=!1}}class ED extends Array{constructor(...e){super(...e),this.width=0,this.lineBase=0,this.lineHeight=0,this.y=0}}class JJ extends Ci{constructor(){super("layouter",null,!1),this._needsUpdate=!0,this._childrenPos={}}update(e,t){this._childrenPos={};for(const i of e._children._boxes)i._position._value==="static"&&(this._childrenPos[i.id]=i.position)}process(e){}}class mA extends pA{constructor(e={}){const t={};mA.definePropertiesValues(t,e),super(t,e),mA.init(this)}add(e){const t=[];for(let i=0;i<arguments.length;i++){const s=arguments[i];!s.isUI||s.isBox?t.push(s):console.warn("Block element can only contain Box elements.",s)}return super.add(...t)}static definePropertiesValues(e,t){e.layouter=JJ}static init(e){Object.defineProperties(e,{isBlock:{configurable:!1,enumerable:!0,value:!0}})}}class KJ extends Ci{constructor(){super("textContent",null,!1)}update(e,t){e._glyphs._needsUpdate=!0,e._whiteSpace._needsProcess=!0}}class ZJ extends Ci{constructor(){super("inlines",null,!1),this._value=null}process(e){if(this._value=e._glyphs._value.map(t=>t.asInlineGlyph()),this._value.length){this._value[0].paddingLeft=e._padding._value.w,this._value[0].marginLeft=e._margin._value.w;const t=this._value.length-1;this._value[t].paddingRight=e._padding._value.y,this._value[t].marginRight=e._margin._value.y}e._fontSize._needsProcess=!0,e._lineBreak._needsProcess=!0,e._fontKerning._needsProcess=!0,e._layouter._needsProcess=!0}get value(){return this._value}}class $J extends Ci{constructor(){super("glyphs",null,!1),this._needsUpdate=!1,this._value=null}process(e){e._font._fontVariant&&e._font._fontVariant.isReady&&(this._value=e._whiteSpace._whiteSpacedContent.split("").map(t=>e._font._fontVariant.getTypographicGlyph(t)),this._value&&(e._inlines._needsProcess=!0))}get value(){return this._value}}class eK extends uA{constructor(){super("color","inherit",!1),this.output=this._outputValue}computeOutputValue(e){this._input==="inherit"?this._value.set(this.getInheritedInput(e)):this._value.set(this._input)}}class n3 extends Ci{constructor(e=`- ,.:?!
`){super("lineBreak",e,!0),this._newLineBreakability=null}update(e,t){this._needsProcess=!0}process(e){const t=e._whiteSpace._newLineBreakability;if(e._inlines._value)for(let i=0;i<e._inlines._value.length;i++){const s=e._inlines._value[i],r=s.char;let o=null;r!==void 0&&(t!=="nowrap"&&(this._value.includes(r)||r.match(/\s/g))&&(o="possible"),r.match(/\n/g)&&(o=t)),s.lineBreak=o}}get value(){return this._value}}class s3 extends Ci{constructor(){super("layouter",null,!1),this._value=null}update(e,t){this._value=e._parent.find(i=>i.isUI&&i.isText),this._needsProcess=!0}process(e){this._value&&(this._value._layouter._needsProcess=!0)}}class tK extends uA{constructor(e){super("backgroundColor",e,!1),this._allowsInherit=!1,this._input=0}computeOutputValue(e){this._input==="inherit"?this._value.set(this.getInheritedInput(e)):this._value.set(this._input)}}class r3 extends oN{constructor(){super(),this._allowsInherit=!1,this.computeOutputValue=this._computeFromInherited}}class o3 extends aN{constructor(){super()}computeOutputValue(e){this._value=w1(this.getInheritedInput(e))}}class a3 extends pN{constructor(){super("fontFamily","inherit",!0),this._input="inherit",this._needsUpdate=!0,this._allowsInherit=!1}computeOutputValue(e){let t=this._inheritedInput;if(t==="inherit"&&(t=this.getInheritedInput(e)),t instanceof mx)this._value=t,e._font._needsUpdate=!0;else if(typeof t=="string"){const i=md.getFontFamily(t);i?(this._value=i,e._font._needsUpdate=!0):console.warn(`(.style) fontFamily, the font '${t}' is not registered. Aborted.`)}else console.warn("(.style) fontFamily requires a registered fontFamily instance, or the id of a registered fontFamily."),console.warn("If you want to set a specific font, please use .font property instead.")}get value(){return this._value}}class J1 extends gN{constructor(){super(),this._allowsInherit=!1,this.computeOutputValue=this._computeFromInherited,this._whiteSpacedContent="",this._stringCollapser=this.emptyStrategyLogic,this._inlineCollapser=this.emptyStrategyLogic,this._inlineWrapper=this.emptyStrategyLogic}_computeFromInherited(e){switch(super._computeFromInherited(e),this._newLineBreakability=iK(this._value),this._value){case"nowrap":case"normal":this._stringCollapser=nK;break;case"pre-line":this._stringCollapser=c3;break;default:this._stringCollapser=sK}switch(this._value){case"pre-line":case"nowrap":case"normal":this._inlineCollapser=lK;break;case"pre-wrap":this._inlineCollapser=cK;break;default:this._inlineCollapser=hK}switch(this._value){case"pre-line":case"pre-wrap":case"normal":this._inlineWrapper=rK;break;case"pre":this._inlineWrapper=oK;break;default:this._inlineWrapper=aK}this._needsProcess=!0}process(e){e.isInline&&!e.isInlineBlock&&(this._whiteSpacedContent=this._stringCollapser(e._textContent._value),e._glyphs._needsProcess=!0)}}const TD={"	":"	","\n":`
`,"\r":"\r"," ":" "},iK=function(n){switch(n){case"pre":case"pre-wrap":case"pre-line":return"mandatory"}return null};function nK(n){return c3(n.replace(/\n/g," "))}function c3(n){return n.replace(/[ ]{2,}/g," ")}function sK(n){return n}function rK(n,e,t,i){const s=n[e];if(s.lineBreak==="mandatory"||t+s.xadvance+s.xoffset+s.kerning>i.INNER_WIDTH)return!0;const r=u3(n,e,i);return uK(n[e-1],t,r,i)}function oK(n,e,t,i){return n[e].lineBreak==="mandatory"}function aK(){return!1}function cK(n){if(!n[0])return 0;const e=n[0],t=n[n.length-1];return e.char&&e.char===`
`&&n.length>1&&h3([e],n[1]),t.char&&t.char===`
`&&n.length>1&&l3([t],n[n.length-2]),e.offsetX}function lK(n){if(!n[0])return 0;let e=[],t;for(let i=0;i<n.length;i++){const s=n[i];if(s.char&&TD[s.char]&&n.length>i){e.push(s),t=n[i+1];continue}break}h3(e,t),e=[],t=null;for(let i=n.length-1;i>0;i--){const s=n[i];if(s.char&&TD[s.char]&&i>0){e.push(s),t=n[i-1];continue}break}return l3(e,t),n[0].offsetX}function hK(n){return n[0]?n[0].offsetX:0}function l3(n,e){if(e)for(let t=0;t<n.length;t++){const i=n[t];i.fontFactor=0,i.offsetX=e.offsetX+e.cumulativeWidth,i.cumulativeWidth=0}}function h3(n,e){if(e)for(let t=0;t<n.length;t++){const i=n[t];i.fontFactor=0,i.offsetX=e.offsetX,i.cumulativeWidth=0}}function u3(n,e,t,i){if(i=i||0,!n[e])return i;const s=n[e];return s.lineBreak?i+s.xadvance:u3(n,e+1,t,i+s.xadvance+s.xoffset+s.kerning+t.LETTERSPACING)}function uK(n,e,t,i){return!n||!n.char||e+t<i.INNER_WIDTH?!1:i.BREAKON.indexOf(n.char)>-1}class d3 extends AN{constructor(){super(),this._input="inherit",this._allowsInherit=!1,this.computeOutputValue=this._computeFromInherited}_computeFromInherited(e){super._computeFromInherited(e),e._fontSize._needsProcess=!0,e._layouter._needsProcess=!0}}class f3 extends Zi{constructor(){super("fontSize","inherit",!0),this._allowsInherit=!1}computeOutputValue(e){this._value=this._inheritedInput,e._font._fontVariant&&(e._bounds._needsProcess=!0,e._layouter._needsProcess=!0)}process(e){if(!e._font._fontVariant||!e._font._fontVariant.isReady)return;const t=this._value/e._font._fontVariant.typographic.size,i=e._inlines._value;for(let s=0;s<i.length;s++){const r=i[s];r.resetOffsets(),r.fontSize=this._value,r.fontFactor=t}}get value(){return this._value}}class p3 extends vN{constructor(){super("segments",1,!1),this._notInheritedValue=void 0}update(e,t){this._notInheritedValue=this._value,this._notInheritedValue==="inherit"&&(this._notInheritedValue=this.getInheritedInput(e)),e._layouter._needsUpdate=!0}set value(e){this._value!==e&&(this._value=e,this._needsUpdate=!0)}get value(){return this._value==="inherit"?this._notInheritedValue:this._value}}class dK extends p3{constructor(){super(),this._value="inherit"}}class fK extends gx{constructor(){super(),this._allowsInherit=!1,this.computeOutputValue=this._computeFromInherited}_computeFromInherited(e){super._computeFromInherited(e),e._parent._value._layouter._needsProcess=!1}process(e){if(this._value!=="none"){const t=e._whiteSpace._whiteSpacedContent,i=e._inlines._value;for(let s=1;s<i.length;s++){const r=t[s-1]+t[s];i[s].kerning=e._font._fontVariant.getKerningAmount(r)}}}}class m3 extends Ci{constructor(){super("children",null,!1),this._uis=[]}update(e,t){}process(e){}_compute(e){}dispose(){}}function pK(n,e=!1){const t=n[0].index!==null,i=new Set(Object.keys(n[0].attributes)),s=new Set(Object.keys(n[0].morphAttributes)),r={},o={},a=n[0].morphTargetsRelative,c=new We.BufferGeometry;let l=0;for(let h=0;h<n.length;++h){const d=n[h];let f=0;if(t!==(d.index!==null))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+h+". All geometries must have compatible attributes; make sure index attribute exists among all geometries, or in none of them."),null;for(const p in d.attributes){if(!i.has(p))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+h+'. All geometries must have compatible attributes; make sure "'+p+'" attribute exists among all geometries, or in none of them.'),null;r[p]===void 0&&(r[p]=[]),r[p].push(d.attributes[p]),f++}if(f!==i.size)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+h+". Make sure all geometries have the same number of attributes."),null;if(a!==d.morphTargetsRelative)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+h+". .morphTargetsRelative must be consistent throughout all geometries."),null;for(const p in d.morphAttributes){if(!s.has(p))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+h+".  .morphAttributes must be consistent throughout all geometries."),null;o[p]===void 0&&(o[p]=[]),o[p].push(d.morphAttributes[p])}if(c.userData.mergedUserData=c.userData.mergedUserData||[],c.userData.mergedUserData.push(d.userData),e){let p;if(t)p=d.index.count;else if(d.attributes.position!==void 0)p=d.attributes.position.count;else return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+h+". The geometry must have either an index or a position attribute"),null;c.addGroup(l,p,h),l+=p}}if(t){let h=0;const d=[];for(let f=0;f<n.length;++f){const p=n[f].index;for(let m=0;m<p.count;++m)d.push(p.getX(m)+h);h+=n[f].attributes.position.count}c.setIndex(d)}for(const h in r){const d=MD(r[h]);if(!d)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed while trying to merge the "+h+" attribute."),null;c.setAttribute(h,d)}for(const h in o){const d=o[h][0].length;if(d===0)break;c.morphAttributes=c.morphAttributes||{},c.morphAttributes[h]=[];for(let f=0;f<d;++f){const p=[];for(let g=0;g<o[h].length;++g)p.push(o[h][g][f]);const m=MD(p);if(!m)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed while trying to merge the "+h+" morphAttribute."),null;c.morphAttributes[h].push(m)}}return c}function MD(n){let e,t,i,s=0;for(let a=0;a<n.length;++a){const c=n[a];if(c.isInterleavedBufferAttribute)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. InterleavedBufferAttributes are not supported."),null;if(e===void 0&&(e=c.array.constructor),e!==c.array.constructor)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.array must be of consistent array types across matching attributes."),null;if(t===void 0&&(t=c.itemSize),t!==c.itemSize)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.itemSize must be consistent across matching attributes."),null;if(i===void 0&&(i=c.normalized),i!==c.normalized)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.normalized must be consistent across matching attributes."),null;s+=c.array.length}const r=new e(s);let o=0;for(let a=0;a<n.length;++a)r.set(n[a].array,o),o+=n[a].array.length;return new We.BufferAttribute(r,t,i)}class mK extends Ci{constructor(){super("renderer")}render(e){if(!e._inlines._value||!e._inlines._value.length)return;const t=e._inlines._value.map(s=>e._font._fontVariant.getGeometricGlyph(s,e).translate(s.offsetX,s.offsetY,0)),i=pK(t);e.setFontMesh(new We.Mesh(i,e.fontMaterial)),e._fontMesh.renderOrder=1/0}}class gK extends C1{constructor(){super(),this._allowsInherit=!1,this._needsUpdate=!1}computeOutputValue(e){this._value=this._inheritedInput,e._layouter._needsProcess=!0}}class bp extends ZA{constructor(t={}){const i={};bp.definePropertiesValues(i,t);super(i,t);u(this,"_rebuildParentUI",()=>{super._rebuildParentUI(),this._layouter._needsUpdate=!0});bp.init(this)}add(t){const i=[];for(let s=0;s<arguments.length;s++){const r=arguments[s];!r.isUI||r.isInline?(i.push(r),r.position.z=.005):console.warn("Block element can only contain Box elements.",r)}return super.add(...i)}set textContent(t){this._textContent.value=t}get textContent(){return this._textContent._value}set invertAlpha(t){this._invertAlpha.value=t}get invertAlpha(){return this._invertAlpha._value}static definePropertiesValues(t,i){t.children||(t.children=m3),t.textContent||(t.textContent=KJ),t.glyphs||(t.glyphs=$J),t.inlines||(t.inlines=ZJ),t.layouter||(t.layouter=s3),t.renderer||(t.renderer=mK),t.fontFamily||(t.fontFamily=a3),t.fontWeight||(t.fontWeight=o3),t.fontStyle||(t.fontStyle=r3),t.fontSize||(t.fontSize=f3),t.color||(t.color=eK),t.backgroundColor||(t.backgroundColor=tK),t.lineBreak||(t.lineBreak=n3),t.letterSpacing||(t.letterSpacing=d3),t.whiteSpace||(t.whiteSpace=J1),t.segments||(t.segments=dK),t.textAlign||(t.textAlign=gK),t.fontKerning||(t.fontKerning=fK)}static init(t){Object.defineProperties(t,{isInline:{configurable:!1,enumerable:!0,value:!0}})}}class AK extends rN{constructor(){super("textContent",null,!1),this._needsUpdate=!1}set value(e){this._value!==e&&(this._value=e,this._needsUpdate=!0)}update(e,t){this._needsUpdate=!1;for(let i=e.children.length-1;i>=0;i--){const s=e.children[i];s.isUI&&(e.remove(s),s.clear())}e._children._uis=[],this._value&&e.add(new bp({name:"anonymousInline",textContent:this._value}))}}class vK extends Array{constructor(...e){super(...e),this.width=0,this.height=0}}class yK extends Ci{constructor(){super("layouter",null,!1),this._value=null}update(e,t){}process(e){let t=e._width._value;e._width._auto?t=1/0:t=e._bounds._innerWidth;const i=e._lineHeight._value,s=new vK(new ED);let r=0;e._children._inlines.forEach(d=>{if(!d._inlines.value)return;this._resetInlines(d);const f=d._fontSize._value,p=d._letterSpacing._value*f,m=d._whiteSpace._value,g=d._lineBreak._value,y={WHITESPACE:m,LETTERSPACING:p,BREAKON:g,INNER_WIDTH:t},A=d._whiteSpace._inlineWrapper;r+=d._margin._value.w+d._padding._value.w,d._inlines.value.forEach((v,b,_)=>{const T=s[s.length-1];if(A(_,b,r,y)){if(s.push(new ED(v)),v.offsetX=v.xoffset,v.width===0){r=0;return}v.cumulativeWidth=v.xadvance+p,r=v.cumulativeWidth;return}s[s.length-1].push(v),v.offsetX=r+v.xoffset+v.kerning,v.cumulativeWidth=v.xadvance+v.kerning+p,r+=v.cumulativeWidth,T.length-1===1&&T[T.length-2].width===0&&(v.offsetX-=v.xoffset,r-=v.xoffset)}),r+=d._margin._value.y+d._padding._value.y});const o=e._whiteSpace._inlineCollapser;let a=0,c=0,l=0;s.forEach((d,f)=>{const p=o(d);let m=0,g=0;if(d.forEach(y=>{m=Math.max(m,y.lineHeight),g=Math.max(g,y.lineBase),y.offsetX-=p}),d.lineHeight=m,d.lineBase=g,f===0?l=-(m*i-m)*.5:l-=s[f-1].lineHeight*i,d.y=l,d.x=0,d.forEach(y=>{y.offsetY=l-y.anchor,y.lineHeight<d.lineHeight&&(y.offsetY-=d.lineBase-y.lineBase)}),c+=d.lineHeight*i,d.width=0,d[0]){const y=d[d.length-1];d.width=y.offsetX+y.cumulativeWidth+y.paddingRight+y.marginRight+d[0].offsetX,a=Math.max(a,d.width)}}),s.height=c,s.width=a,this._value=s,t===1/0&&e._bounds.setChildrenWidth(e,s.width),e._height._auto&&e._bounds.setChildrenHeight(e,s.height);const h=e._parent._value;h&&(h._autoSize._needsProcess=!0,h._flexDirection._needsProcess=!0),e._inlineJustificator._needsProcess=!0,e._textAlign._needsProcess=!0,e._overflow._needsUpdate=!0}_resetInlines(e){e._fontSize.process(e)}}class bK extends C1{constructor(){super(),this._allowsInherit=!1,this._needsUpdate=!0}computeOutputValue(e){this._value=this._inheritedInput,this._needsProcess=!0}process(e){_K(e),e._renderer._needsRender=!0}}function _K(n){const e=n._layouter._value,t=n._textAlign._value,i=n._bounds._innerWidth;for(let s=0;s<e.length;s++){const r=e[s],o=xK(n,r,s===e.length-1),a=n._padding._value,c=n._borderWidth._value,l=(-a.w+a.y)/2+(-c.w+c.y)/2;r.x+=o;for(let h=0;h<r.length;h++)r[h].offsetX+=o-l}if(t.indexOf("justify")===0)for(let s=0;s<e.length;s++){const r=e[s];if(t.indexOf("-")!==-1&&s===e.length-1)return;const o=i-r.width;if(o<=0)return;let a=0;for(let d=1;d<r.length-1;d++)a+=r[d].char===" "?1:0;const c=o/a;let l=1;t==="justify-right"&&(r.reverse(),l=-1);let h=0;for(let d=1;d<=r.length-1;d++){const f=r[d];f.offsetX+=h*l,h+=f.char===" "?c:0}t==="justify-right"&&r.reverse()}}function xK(n,e,t){switch(n._textAlign._value){case"justify-left":case"justify":case"left":return-n._bounds._innerWidth/2;case"justify-right":case"right":return-e.width+n._bounds._innerWidth/2;case"center":return-e.width/2;case"justify-center":return t?-e.width/2:-n._bounds._innerWidth/2;default:console.warn(`textAlign: '${n._textAlign._value}' is not valid`)}}class wK extends E1{constructor(){super(),this._value=this._input="column",this._allowsInherit=!1,this._needsUpdate=!0}computeOutputValue(e){this._value=this._inheritedInput}}class SK extends mN{constructor(){super(),this._allowsInherit=!1,this.computeOutputValue=this._computeFromInherited}}class CK extends gx{constructor(){super(),this._value=this._input=this.getDefaultValue(),this._allowsInherit=!1,this.computeOutputValue=this._computeFromInherited}_computeFromInherited(e){super._computeFromInherited(e)}}class EK extends e3{constructor(){super(),this._innerWidth=1/0,this._innerHeight=0}}class TK extends Ci{constructor(){super("children",null,!1);u(this,"_sortOrder",(t,i)=>t._order._value<i._order._value?-1:t._order._value>i._order._value?1:this._uis.indexOf(t)<this._uis.indexOf(i)?-1:1);this._uis=[],this._inlines=[],this._boxes=[]}update(t,i){this._compute(t),this._needsProcess=!0}process(t){this._compute(t),t._overflow._needsRender=!0}_compute(t){this._uis=t.children.filter(i=>i.visible&&i.isUI),this._inlines=this._uis.filter(i=>i.isInline).sort(this._sortOrder)}dispose(){this._inlines=null}}class MK extends Ci{constructor(){super("autosize")}process(e){if(e._layouter._value&&e._layouter._value.length){const t=e._layouter._value,i=e._padding._value,s=e._borderWidth._value;e._width._auto&&e._bounds.setOffsetWidth(e,t.width+i.w+i.y+s.w+s.y),e._height._auto&&e._bounds.setOffsetHeight(e,t.height+i.x+i.z+s.x+s.z)}}}class IK extends i3{constructor(){super("renderer"),this._needsUpdate=!1}render(e){super.render(e);for(const t of e._children._inlines)t._renderer.render(t);e.performAfterUpdate()}}class gA extends pA{constructor(e={},t={}){gA.definePropertiesValues(t,e),super(t,e),gA.init(this)}add(e){const t=[];let i=!1;for(let s=0;s<arguments.length;s++){const r=arguments[s];!r.isUI||r.isInline?(r.isInline&&(i=!0),t.push(r)):console.warn("Block element can only contain Box elements.",r)}return t.length>0&&super.add(...t),i&&(this._children._needsUpdate=!0,this._layouter._needsProcess=!0),this}set textContent(e){this._textContent.value=e}get textContent(){return super.textContent}set invertAlpha(e){this._invertAlpha.value=e}get invertAlpha(){return this._invertAlpha._value}get lines(){return this._layouter._value}static definePropertiesValues(e,t){e.flexDirection=wK,e.justifyContent=T1,e.alignItems=S1,e.bounds=EK,e.autoSize=MK,e.renderer=IK,e.children||(e.children=TK),e.textContent||(e.textContent=AK),e.layouter||(e.layouter=yK),e.lineHeight||(e.lineHeight=SK),e.textAlign||(e.textAlign=bK),e.whiteSpace||(e.whiteSpace=J1),e.fontKerning||(e.fontKerning=CK),e.segments||(e.segments=p3),t.width||(t.width="100%"),t.fontSide||(t.fontSide=0)}static init(e){Object.defineProperties(e,{isText:{configurable:!1,enumerable:!0,value:!0}})}}class RK extends Ci{constructor(){super("inlines",null,!1),this._value=[]}process(e){this._value[0].paddingLeft=e._padding._value.w,this._value[0].marginLeft=e._margin._value.w;const t=this._value.length-1;this._value[t].paddingRight=e._padding._value.y,this._value[t].marginRight=e._margin._value.y}}class PK extends Ci{constructor(){super("renderer")}render(e){e._backgroundMesh||e.setBackgroundMesh(new t3(e)),e._backgroundMesh.position.x=e._inlines._value[0].offsetX+e._inlines._value[0].width/2,e._backgroundMesh.position.y=e._inlines._value[0].offsetY+e._inlines._value[0].lineBase/2,e._bounds.render(e)}}class BK extends Ci{constructor(){super("bounds",null,!1),this._size=new We.Vector3(1,1,1),this._offsetWidth=0,this._offsetHeight=0,this._innerWidth=0,this._innerHeight=0}update(e,t){this.output(t),this._needsProcess=!0}process(e){this._offsetWidth=this._innerWidth=e._inlines._value[0].width,this._offsetHeight=this._innerHeight=e._inlines._value[0].height,this._needsRender=!0,e._borderWidth._needsRender=!0,e._borderRadius._needsRender=!0}render(e){this._size.x=this._offsetWidth,this._size.y=this._offsetHeight}output(e){e.size=this._size}}class AA extends ZA{constructor(e={}){const t={};AA.definePropertiesValues(t,e),super(t,e),AA.init(this)}clear(){for(const e of this._inlines._value)e.clear();return super.clear()}bindBackgroundMeshProperties(){this._backgroundMesh.raycast=()=>{},this._bounds._size=this._backgroundMesh.scale,this._bounds._needsUpdate=!0}unbindBackgroundMeshProperties(){this._bounds._size=new We.Vector3(1,1,1),this._bounds._needsUpdate=!0}add(e){const t=[];for(let i=0;i<arguments.length;i++){const s=arguments[i];s.isUI?console.warn("ThreeMeshUI::InlineBlockElement cannot contains UI Elements.",s):(t.push(s),s.position.z=.005)}return super.add(...t)}static definePropertiesValues(e,t){e.children||(e.children=m3),e.bounds||(e.bounds=BK),e.inlines||(e.inlines=RK),e.layouter||(e.layouter=s3),e.renderer||(e.renderer=PK),e.fontFamily||(e.fontFamily=a3),e.fontWeight||(e.fontWeight=o3),e.fontStyle||(e.fontStyle=r3),e.fontSize||(e.fontSize=f3),e.backgroundColor||(e.backgroundColor=iN),e.lineBreak||(e.lineBreak=n3),e.letterSpacing||(e.letterSpacing=d3),e.whiteSpace||(e.whiteSpace=J1),e.fontKerning||(e.fontKerning=gx),t.backgroundSize||(t.backgroundSize="cover"),t.width||(t.width="100%"),t.height||(t.height="100%"),t.boxSizing||(t.boxSizing="border-box")}static init(e){Object.defineProperties(e,{isInline:{configurable:!1,enumerable:!0,value:!0},isInlineBlock:{configurable:!1,enumerable:!0,value:!0}}),e._inlines._value=[new DK(e)],e.backgroundMaterial=new $N,e._renderer.render(e)}}class DK extends hN{constructor(e){super(),this._uiElement=e}get xadvance(){const e=this._uiElement._padding._value,t=this._uiElement._width;return t._relative?t._value*this._uiElement._fontSize.getInheritedInput(this._uiElement):e.w+e.y+t.value}get width(){const e=this._uiElement._width;return e._relative?e._value*this._uiElement._fontSize.getInheritedInput(this._uiElement):e.value}get height(){const e=this._uiElement._height;return e._relative?e._value*this._uiElement._fontSize.getInheritedInput(this._uiElement):e.value}get anchor(){return this.height}get lineHeight(){const e=this._uiElement._height;return e._relative?e._value*this._uiElement._fontSize.getInheritedInput(this._uiElement):e.value}get lineBase(){const e=this._uiElement._height;return e._relative?e._value*this._uiElement._fontSize.getInheritedInput(this._uiElement):e.value}clear(){this._uiElement=null}}class g3{constructor(e){this._subject=e}attach(){console.error(`Behavior::attach() - Is abstract and therefore should be overridden in ${this.constructor.name}`)}act(){throw new Error(`Behavior::act() - Is abstract and therefore should be overridden in ${this.constructor.name}`)}detach(){console.error(`Behavior::detach() - Is abstract and therefore should be overridden in ${this.constructor.name}`)}clear(){}}const A3=()=>Mb.update(),v3={BaseProperty:Ci,Block:mA,Text:gA,Inline:bp,InlineBlock:AA,MeshUIBaseElement:ZA,FontLibrary:md,update:A3,MSDFFontMaterialUtils:Co,ShaderChunkUI:ZN,Behavior:g3,FontVariant:XA};typeof global<"u"&&(global.ThreeMeshUI=v3);const OK=v3;var kK=Fn.w8,y3=Fn.cg,K1=Fn.gO,LK=Fn.wb,lT=Fn.zV,FK=Fn.HS,UK=Fn.Ec,O0=Fn.gF,NK=Fn.ol,zK=Fn.pz,GK=Fn.tx,VK=Fn.hj,HK=Fn.FV,QK=Fn.sV,Z1=Fn.xv,jK=Fn.mx,WK=Fn.gE,bf=Fn.ZP,b3=Fn.Vx;const ID=Object.freeze(Object.defineProperty({__proto__:null,BaseProperty:kK,Behavior:y3,Block:K1,DefaultValues:LK,FontLibrary:lT,FontVariant:FK,InheritableProperty:UK,Inline:O0,InlineBlock:NK,InlineGlyph:zK,MSDFFontMaterialUtils:GK,MaterialTransformers:VK,MeshUIBaseElement:HK,ShaderChunkUI:QK,Text:Z1,TypographicFont:jK,TypographicGlyph:WK,default:bf,update:b3},Symbol.toStringTag,{value:"Module"}));class qK{constructor(){u(this,"Rad2Deg",180/Math.PI);u(this,"Deg2Rad",Math.PI/180);u(this,"Epsilon",1e-5)}random(e,t){return e!==void 0&&t!==void 0?Math.random()*(t-e)+e:Math.random()}clamp(e,t,i){return e<t?t:e>i?i:e}clamp01(e){return this.clamp(e,0,1)}lerp(e,t,i){return i=i<0?0:i,i=i>1?1:i,e+(t-e)*i}inverseLerp(e,t,i){return(i-e)/(t-e)}remap(e,t,i,s,r){return s+(r-s)*(e-t)/(i-t)}moveTowards(e,t,i){return e+=i,(i<0&&e<t||i>0&&e>t)&&(e=t),e}toDegrees(e){return e*180/Math.PI}toRadians(e){return e*Math.PI/180}tan(e){return Math.tan(e)}gammaToLinear(e){return Math.pow(e,2.2)}linearToGamma(e){return Math.pow(e,1/2.2)}approximately(e,t,i=Number.EPSILON){for(const s of XK){const r=e[s],o=t[s];if(r===void 0||o===void 0)break;if(Math.abs(r-o)>i)return!1}return!0}easeInOutCubic(e){return e<.5?4*e*e*e:1-Math.pow(-2*e+2,3)/2}}const XK=["x","y","z","w"],nt=new qK;new Me().setFromAxisAngle(new w(0,1,0),Math.PI);function _3(n,e,t=!0,i=!1){const s=Ht(e),r=Ht(n);if(i){if(fa(n,In(e)),t){const o=r.sub(x3(n));n.lookAt(o)}return}t&&(s.y=r.y),n.lookAt(s)}const YK=new wl(()=>new w,100);function Gn(n,e,t){const i=YK.get();return n instanceof w?i.copy(n):n instanceof DOMPointReadOnly?i.set(n.x,n.y,n.z):(typeof n=="number"&&(i.x=n),typeof e=="number"&&(i.y=e),typeof t=="number"&&(i.z=t)),i}const JK=new wl(()=>new Me,100);function Bf(n){const e=JK.get();return n instanceof Me?e.copy(n):n instanceof DOMPointReadOnly&&e.set(n.x,n.y,n.z,n.w),e}const $1=new wl(()=>new w,100),RD=Symbol("lastMatrixWorldUpdateKey");function Ht(n,e=null,t=!0){const i=e??$1.get();return n?n.parent?(t&&n.updateWorldMatrix(!0,!1),n.matrixWorldNeedsUpdate&&n[RD]!==Date.now()&&(n[RD]=Date.now(),n.updateMatrixWorld()),i.setFromMatrixPosition(n.matrixWorld),i):i.copy(n.position):i.set(0,0,0)}function vr(n,e){if(!n)return;const t=$1.get();e!==t&&t.copy(e),((n==null?void 0:n.parent)??n).worldToLocal(t),n.position.set(t.x,t.y,t.z)}function vA(n,e,t,i){const s=$1.get();s.set(e,t,i),vr(n,s)}const Rb=new wl(()=>new Me,100),$u=new Me,LS=new Me;function In(n,e=null){if(!n)return Rb.get().identity();const t=e??Rb.get();return n.parent?(n.getWorldQuaternion(t),t):t.copy(n.quaternion)}function fa(n,e){if(!n)return;e!==$u&&$u.copy(e);const t=$u,i=n==null?void 0:n.parent;i==null||i.getWorldQuaternion(LS),LS.invert();const s=LS.multiply(t);n.quaternion.set(s.x,s.y,s.z,s.w)}function KK(n,e,t,i,s){$u.set(e,t,i,s),fa(n,$u)}const ZK=new wl(()=>new w,100),$K=new w;function br(n,e=null){return e||(e=ZK.get()),n?n.parent?(n.getWorldScale(e),e):e.copy(n.scale):e.set(0,0,0)}function Pb(n,e){if(!n)return;if(!n.parent){n.scale.copy(e);return}const t=$K;n.parent.getWorldScale(t),n.scale.copy(e),n.scale.divide(t)}new w;const eZ=new wl(()=>new w,100),PD=new Me;function x3(n,e){return e||(e=eZ.get().set(0,0,1)),In(n,PD),e.applyQuaternion(PD)}const BD=new ws,DD=new ws,tZ=new w;function w3(n){const e=Rb.get();return n.getWorldQuaternion(e),DD.setFromQuaternion(e),DD}function S3(n,e){const t=Rb.get();fa(n,t.setFromEuler(e))}function _x(n){const e=w3(n),t=tZ;return t.set(e.x,e.y,e.z),t.x=nt.toDegrees(t.x),t.y=nt.toDegrees(t.y),t.z=nt.toDegrees(t.z),t}function C3(n,e){xx(n,e.x,e.y,e.z,!0)}function xx(n,e,t,i,s=!0){s&&(e=nt.toRadians(e),t=nt.toRadians(t),i=nt.toRadians(i)),BD.set(e,t,i),$u.setFromEuler(BD),fa(n,$u)}function hT(n,e=!0){n&&(e?function t(i){console.groupCollapsed((i.name?i.name:"(no name : "+i.type+")")+" %o",i),i.children.forEach(t),console.groupEnd()}(n):n.traverse(function(t){for(var i="|___",s=t;s.parent!==null;)i="	"+i,s=s.parent;console.log(i+t.name+" <"+t.type+">")}))}function iZ(n){if(n){const e=n;return e.blendMode!==void 0&&e.clampWhenFinished!==void 0&&e.enabled!==void 0&&e.fadeIn!==void 0&&e.getClip!==void 0}return!1}class zc{static createBlitMaterial(e){return new Et({uniforms:{map:new we(null)},vertexShader:this.vertex,fragmentShader:e})}static copyTexture(e,t){const i=t??this.blipMaterial;i.uniforms.map.value=e,i.needsUpdate=!0,i.uniformsNeedUpdate=!0,this.blipMaterial||(this.blipMaterial=new Et({uniforms:{map:new we(null)},vertexShader:this.vertex,fragmentShader:this.fragment})),this.mesh||(this.mesh=new me(this.planeGeometry,this.blipMaterial));const s=this.mesh;s.material=i,s.frustumCulled=!1,this.scene.children.length=0,this.scene.add(s),this.renderer||(this.renderer=new Rl({antialias:!1})),this.renderer.setSize(e.image.width,e.image.height),this.renderer.clear(),this.renderer.render(this.scene,this.perspectiveCam);const r=new Ft(this.renderer.domElement);return r.name="Copy",r.needsUpdate=!0,r}static textureToCanvas(e,t){if(!e)return null;(t===!0||e.isCompressedTexture===!0)&&(e=nZ(e));const i=e.image;if(sZ(i)){const s=document.createElement("canvas");s.width=i.width,s.height=i.height;const r=s.getContext("2d");return r?(r.drawImage(i,0,0,i.width,i.height,0,0,s.width,s.height),s):(console.error("Failed getting canvas 2d context"),null)}return null}}u(zc,"planeGeometry",new Wn(2,2,1,1)),u(zc,"renderer"),u(zc,"perspectiveCam",new Wt),u(zc,"scene",new Ws),u(zc,"vertex",`
    varying vec2 vUv;
    void main(){
        vUv = uv;
        gl_Position = vec4(position.xy * 1.0,0.,.999999);
    }`),u(zc,"fragment",`
    uniform sampler2D map; 
    varying vec2 vUv;
    void main(){ 
        vec2 uv = vUv;
        uv.y = 1.0 - uv.y;
        gl_FragColor = texture2D( map, uv);
        // gl_FragColor = vec4(uv.xy, 0, 1);
    }`),u(zc,"blipMaterial"),u(zc,"mesh");function nZ(n){return zc.copyTexture(n)}function sZ(n){return typeof HTMLImageElement<"u"&&n instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&n instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&n instanceof OffscreenCanvas||typeof ImageBitmap<"u"&&n instanceof ImageBitmap}const $n={Handedness:Object.freeze({NONE:"none",LEFT:"left",RIGHT:"right"}),ComponentState:Object.freeze({DEFAULT:"default",TOUCHED:"touched",PRESSED:"pressed"}),ComponentProperty:Object.freeze({BUTTON:"button",X_AXIS:"xAxis",Y_AXIS:"yAxis",STATE:"state"}),ComponentType:Object.freeze({TRIGGER:"trigger",SQUEEZE:"squeeze",TOUCHPAD:"touchpad",THUMBSTICK:"thumbstick",BUTTON:"button"}),ButtonTouchThreshold:.05,AxisTouchThreshold:.1,VisualResponseProperty:Object.freeze({TRANSFORM:"transform",VISIBILITY:"visibility"})};async function E3(n){const e=await fetch(n);if(e.ok)return e.json();throw new Error(e.statusText)}async function rZ(n){if(!n)throw new Error("No basePath supplied");return await E3(`${n}/profilesList.json`)}async function oZ(n,e,t=null,i=!0){if(!n)throw new Error("No xrInputSource supplied");if(!e)throw new Error("No basePath supplied");const s=await rZ(e);let r;if(n.profiles.some(c=>{const l=s[c];return l&&(r={profileId:c,profilePath:`${e}/${l.path}`,deprecated:!!l.deprecated}),!!r}),!r){if(!t)throw new Error("No matching profile name found");const c=s[t];if(!c)throw new Error(`No matching profile name found and default profile "${t}" missing.`);r={profileId:t,profilePath:`${e}/${c.path}`,deprecated:!!c.deprecated}}const o=await E3(r.profilePath);let a;if(i){let c;if(n.handedness==="any"?c=o.layouts[Object.keys(o.layouts)[0]]:c=o.layouts[n.handedness],!c)throw new Error(`No matching handedness, ${n.handedness}, in profile ${r.profileId}`);c.assetPath&&(a=r.profilePath.replace("profile.json",c.assetPath))}return{profile:o,assetPath:a}}const aZ={xAxis:0,yAxis:0,button:0,state:$n.ComponentState.DEFAULT};function cZ(n=0,e=0){let t=n,i=e;if(Math.sqrt(n*n+e*e)>1){const o=Math.atan2(e,n);t=Math.cos(o),i=Math.sin(o)}return{normalizedXAxis:t*.5+.5,normalizedYAxis:i*.5+.5}}let lZ=class{constructor(e){this.componentProperty=e.componentProperty,this.states=e.states,this.valueNodeName=e.valueNodeName,this.valueNodeProperty=e.valueNodeProperty,this.valueNodeProperty===$n.VisualResponseProperty.TRANSFORM&&(this.minNodeName=e.minNodeName,this.maxNodeName=e.maxNodeName),this.value=0,this.updateFromComponent(aZ)}updateFromComponent({xAxis:e,yAxis:t,button:i,state:s}){const{normalizedXAxis:r,normalizedYAxis:o}=cZ(e,t);switch(this.componentProperty){case $n.ComponentProperty.X_AXIS:this.value=this.states.includes(s)?r:.5;break;case $n.ComponentProperty.Y_AXIS:this.value=this.states.includes(s)?o:.5;break;case $n.ComponentProperty.BUTTON:this.value=this.states.includes(s)?i:0;break;case $n.ComponentProperty.STATE:this.valueNodeProperty===$n.VisualResponseProperty.VISIBILITY?this.value=this.states.includes(s):this.value=this.states.includes(s)?1:0;break;default:throw new Error(`Unexpected visualResponse componentProperty ${this.componentProperty}`)}}},hZ=class{constructor(e,t){if(!e||!t||!t.visualResponses||!t.gamepadIndices||Object.keys(t.gamepadIndices).length===0)throw new Error("Invalid arguments supplied");this.id=e,this.type=t.type,this.rootNodeName=t.rootNodeName,this.touchPointNodeName=t.touchPointNodeName,this.visualResponses={},Object.keys(t.visualResponses).forEach(i=>{const s=new lZ(t.visualResponses[i]);this.visualResponses[i]=s}),this.gamepadIndices=Object.assign({},t.gamepadIndices),this.values={state:$n.ComponentState.DEFAULT,button:this.gamepadIndices.button!==void 0?0:void 0,xAxis:this.gamepadIndices.xAxis!==void 0?0:void 0,yAxis:this.gamepadIndices.yAxis!==void 0?0:void 0}}get data(){return{id:this.id,...this.values}}updateFromGamepad(e){if(this.values.state=$n.ComponentState.DEFAULT,this.gamepadIndices.button!==void 0&&e.buttons.length>this.gamepadIndices.button){const t=e.buttons[this.gamepadIndices.button];this.values.button=t.value,this.values.button=this.values.button<0?0:this.values.button,this.values.button=this.values.button>1?1:this.values.button,t.pressed||this.values.button===1?this.values.state=$n.ComponentState.PRESSED:(t.touched||this.values.button>$n.ButtonTouchThreshold)&&(this.values.state=$n.ComponentState.TOUCHED)}this.gamepadIndices.xAxis!==void 0&&e.axes.length>this.gamepadIndices.xAxis&&(this.values.xAxis=e.axes[this.gamepadIndices.xAxis],this.values.xAxis=this.values.xAxis<-1?-1:this.values.xAxis,this.values.xAxis=this.values.xAxis>1?1:this.values.xAxis,this.values.state===$n.ComponentState.DEFAULT&&Math.abs(this.values.xAxis)>$n.AxisTouchThreshold&&(this.values.state=$n.ComponentState.TOUCHED)),this.gamepadIndices.yAxis!==void 0&&e.axes.length>this.gamepadIndices.yAxis&&(this.values.yAxis=e.axes[this.gamepadIndices.yAxis],this.values.yAxis=this.values.yAxis<-1?-1:this.values.yAxis,this.values.yAxis=this.values.yAxis>1?1:this.values.yAxis,this.values.state===$n.ComponentState.DEFAULT&&Math.abs(this.values.yAxis)>$n.AxisTouchThreshold&&(this.values.state=$n.ComponentState.TOUCHED)),Object.values(this.visualResponses).forEach(t=>{t.updateFromComponent(this.values)})}},uZ=class{constructor(e,t,i){if(!e)throw new Error("No xrInputSource supplied");if(!t)throw new Error("No profile supplied");this.xrInputSource=e,this.assetUrl=i,this.id=t.profileId,this.layoutDescription=t.layouts[e.handedness],this.components={},Object.keys(this.layoutDescription.components).forEach(s=>{const r=this.layoutDescription.components[s];this.components[s]=new hZ(s,r)}),this.updateFromGamepad()}get gripSpace(){return this.xrInputSource.gripSpace}get targetRaySpace(){return this.xrInputSource.targetRaySpace}get data(){const e=[];return Object.values(this.components).forEach(t=>{e.push(t.data)}),e}updateFromGamepad(){Object.values(this.components).forEach(e=>{e.updateFromGamepad(this.xrInputSource.gamepad)})}};class Ii extends ye{constructor(t,i,s,r){super(t,i,s);u(this,"alpha",1);this.alpha=r}get isRGBAColor(){return!0}set a(t){this.alpha=t}get a(){return this.alpha}clone(){const t=super.clone();return t.alpha=this.alpha,t}copy(t){return super.copy(t),"alpha"in t&&typeof t.alpha=="number"?this.alpha=t.alpha:typeof t.a=="number"&&(this.alpha=t.a),this}lerp(t,i){const s=t;return s.alpha&&(this.alpha=nt.lerp(this.alpha,s.alpha,i)),super.lerp(t,i)}lerpColors(t,i,s){const r=t,o=i;return r.alpha&&o.alpha&&(this.alpha=nt.lerp(r.alpha,o.alpha,s)),super.lerpColors(t,i,s)}multiply(t){const i=t;return i.alpha&&(this.alpha=this.alpha*i.alpha),super.multiply(t)}fromArray(t,i=0){return this.alpha=t[i+3],super.fromArray(t,i)}}const Bb=new Ce().makeRotationY(Math.PI),ta=new Me().setFromAxisAngle(new w(0,1,0),Math.PI),dZ=re("debugwebxr");class fZ{constructor(){u(this,"priority",-1e5);u(this,"gameObject");if(this.gameObject=new ge,this.gameObject.name="Implicit XR Rig",dZ){const e=eI(16733661);e.position.y+=.5,this.gameObject.add(e)}}isXRRig(){return!0}get isActive(){return this.gameObject.visible}}const sh=re("debugwebxr"),Em=re("debugcustomgesture");let FS=!1;const pZ="https://cdn.jsdelivr.net/npm/@webxr-input-profiles/assets@1.0/dist/profiles",mZ="generic-trigger";class T3{constructor(e,t,i){u(this,"xr");u(this,"inputSource");u(this,"index",0);u(this,"emitEvents",!0);u(this,"_connected",!0);u(this,"_isTracking",!1);u(this,"_hitTestSource");u(this,"_handJointPoses",new Map);u(this,"_gripPosition",new w);u(this,"_gripQuaternion",new Me);u(this,"_linearVelocity",new w);u(this,"_rayPosition",new w);u(this,"_rayQuaternion",new Me);u(this,"_gripWorldPosition",new w);u(this,"_gripWorldQuaternion",new Me);u(this,"_rayWorldPosition",new w);u(this,"_rayWorldQuaternion",new Me);u(this,"_ray");u(this,"_object");u(this,"_debugAxesHelper",new Fo(.2));u(this,"_needleGamepadButtons",{});u(this,"_buttonMap",new Map);u(this,"_motioncontroller");u(this,"_layout");u(this,"getMotionController");u(this,"_selectButtonIndex");u(this,"_squeezeButtonIndex");u(this,"onSelectStart",e=>{var s,r,o,a;if(this.inputSource!==e.inputSource)return;const t=(s=this._layout)==null?void 0:s.selectComponentId,i=(a=(o=(r=this._layout)==null?void 0:r.components[t])==null?void 0:o.gamepadIndices)==null?void 0:a.button;if(i!==void 0&&(this._selectButtonIndex=i),!Em){if(!FS){FS=!0;const c=this.getGesture("pinch");if(c!=null&&c.pressed){console.warn("Select start event was received but the pinch gesture is already down. This might happen the first time you start pinching",this.index,this.side);return}}sh&&kt.DrawDirection(this.rayWorldPosition,Gn(0,.01,1).applyQuaternion(this.rayWorldQuaternion),16711680,10),this.emitPointerEvent(li.PointerDown,this._selectButtonIndex||0,"xr-standard-trigger",!0,e)}});u(this,"onSelectEnd",e=>{Em||this.inputSource===e.inputSource&&this.emitPointerEvent(li.PointerUp,this._selectButtonIndex||0,"xr-standard-trigger",!0,e)});u(this,"onSequeezeStart",e=>{var t,i,s;this.inputSource===e.inputSource&&(this._squeezeButtonIndex=(s=(i=(t=this._layout)==null?void 0:t.components["xr-standard-squeeze"])==null?void 0:i.gamepadIndices)==null?void 0:s.button,this._squeezeButtonIndex!==void 0&&(sh&&kt.DrawDirection(this.rayWorldPosition,Gn(0,.01,1).applyQuaternion(this.rayWorldQuaternion),255,10),this.emitPointerEvent(li.PointerDown,this._squeezeButtonIndex||0,"xr-standard-squeeze",!0,e)))});u(this,"onSequeezeEnd",e=>{this.inputSource===e.inputSource&&this._squeezeButtonIndex!==void 0&&this.emitPointerEvent(li.PointerUp,this._squeezeButtonIndex||0,"xr-standard-squeeze",!0,e)});u(this,"states",{});u(this,"_didMoveLastFrame",!1);u(this,"_lastPointerMovePosition",new w);u(this,"_lastPointerMoveQuaternion",new Me);u(this,"pointerInit");var s,r,o;this.xr=e,this.inputSource=t,this.index=i,this._object=new ge,sh&&this._object.add(this._debugAxesHelper),this.xr.context.scene.add(this._object),this._ray=new ro,this.pointerInit={origin:this,pointerType:this.hand?"hand":"controller",deviceIndex:this.index,pointerId:-1,mode:this.inputSource.targetRayMode,ray:this._ray,device:this._object,buttonName:"none"},this.initialize(),this.subscribeEvents(),this.xr.mode==="immersive-ar"&&this.inputSource.targetRayMode==="tracked-pointer"&&((o=(r=(s=this.xr.session).requestHitTestSourceForTransientInput)==null?void 0:r.call(s,{profile:this.inputSource.profiles[0],offsetRay:new XRRay}))==null||o.then(a=>this._hitTestSource=a))}get context(){return this.xr.context}get connected(){return this._connected}get isTracking(){return this._isTracking}get gamepad(){return this.inputSource.gamepad}get isHand(){return this.inputSource.hand!=null}get hand(){return this.inputSource.hand}get handObject(){return this.context.renderer.xr.getHand(this.index)}get profiles(){return this.inputSource.profiles}get layout(){return this._layout}get targetRayMode(){return this.inputSource.targetRayMode}get targetRaySpace(){return this.inputSource.targetRaySpace}get gripSpace(){return this.inputSource.gripSpace}get side(){return this.inputSource.handedness}get isRight(){return this.side==="right"}get isLeft(){return this.side==="left"}get hitTestSource(){return this._hitTestSource}getHitTest(){return this.xr.getHitTest(this)}getHandJointPose(e){var i,s;if(!this.hand||!((i=this.xr.frame)!=null&&i.getJointPose)||!this.xr.referenceSpace)return null;let t=(s=this._handJointPoses)==null?void 0:s.get(e);return t||(t=this.xr.frame.getJointPose(e,this.xr.referenceSpace),t&&this._handJointPoses.set(e,t),t)}get gripPosition(){return Gn(this._gripPosition).applyMatrix4(Bb)}get gripQuaternion(){return Bf(this._gripQuaternion).premultiply(ta)}get gripLinearVelocity(){return Gn(this._linearVelocity).applyQuaternion(ta)}get rayPosition(){return Gn(this._rayPosition).applyMatrix4(Bb)}get rayQuaternion(){return Bf(this._rayQuaternion).premultiply(ta)}get gripWorldPosition(){return Gn(this._gripWorldPosition)}get gripWorldQuaternion(){return Bf(this._gripWorldQuaternion)}get rayWorldPosition(){return Gn(this._rayWorldPosition)}updateRayWorldPosition(){var t;const e=(t=this.xr.context.mainCamera)==null?void 0:t.parent;this._rayWorldPosition.copy(this._rayPosition),e&&this._rayWorldPosition.applyMatrix4(e.matrixWorld)}get rayWorldQuaternion(){return Bf(this._rayWorldQuaternion)}updateRayWorldQuaternion(){var i;const e=(i=this.xr.context.mainCamera)==null?void 0:i.parent,t=e?In(e):void 0;this._rayWorldQuaternion.copy(this._rayQuaternion).multiply(ta),t&&this._rayWorldQuaternion.premultiply(t)}get ray(){return this._ray.origin.copy(this.rayWorldPosition),this._ray.direction.copy(Gn(0,0,1).applyQuaternion(this.rayWorldQuaternion)),this._ray}get object(){return this._object}async getModelUrl(){var e;return(e=this.getMotionController)==null?void 0:e.then(t=>(t==null?void 0:t.assetUrl)||null)}onUpdate(e){this.onUpdateFrame(e),this.updateInputEvents(),this.onUpdateMove()}onRenderDebug(){var s;kt.DrawWireSphere(this.rayWorldPosition,.02),kt.DrawDirection(this.rayWorldPosition,Gn(0,0,10).applyQuaternion(this.rayWorldQuaternion));const e=this.gripWorldPosition.sub(this.object.worldForward.multiplyScalar(.1)),t=this.inputSource.profiles.join(`
`);let i=`Controller[${this.index}] ${this.side}
C:${this.connected?"yes":"no"} T:${this.isTracking?"yes":"no"} Hand:${this.inputSource.hand?"yes":"no"}`;this.inputSource.hand&&(i+=`
Pinch: ${(s=this.getGesture("pinch"))==null?void 0:s.value.toFixed(3)}`),i+=`
`+t,kt.DrawLabel(e,i,.01)}onUpdateFrame(e){var o,a,c;if(this._handJointPoses.clear(),!this.xr.referenceSpace){this._isTracking=!1;return}const t=e.getPose(this.inputSource.targetRaySpace,this.xr.referenceSpace);if(this._isTracking=t!=null,t){const l=t.transform;this._rayPosition.set(l.position.x,l.position.y,l.position.z),this._rayQuaternion.set(l.orientation.x,l.orientation.y,l.orientation.z,l.orientation.w)}if(this.inputSource.gripSpace){const l=e.getPose(this.inputSource.gripSpace,this.xr.referenceSpace);if(l){const h=l.transform;this._gripPosition.set(h.position.x,h.position.y,h.position.z),this._gripQuaternion.set(h.orientation.x,h.orientation.y,h.orientation.z,h.orientation.w),"linearVelocity"in l&&l.linearVelocity&&this._linearVelocity.set(l.linearVelocity.x,l.linearVelocity.y,l.linearVelocity.z)}}(o=this.xr.context.mainCamera)!=null&&o.parent&&this._object.parent!==((a=this.xr.context.mainCamera)==null?void 0:a.parent)&&this.xr.context.mainCamera.parent.add(this._object);const i=this.hand;if(i){let l=!1;const h=i.get("wrist"),d=h&&this.getHandJointPose(h);if(d){l=!0;const m=d.transform.position,g=d.transform.orientation;this._object.position.set(m.x,m.y,m.z),this._object.quaternion.set(g.x,g.y,g.z,g.w).multiply(ta)}l||(this._object.position.copy(this._rayPosition),this._object.quaternion.copy(this._rayQuaternion).multiply(ta));const f=i.get("middle-finger-metacarpal"),p=f&&this.getHandJointPose(f);if(p){const m=p.transform.position,g=p.transform.orientation;this._gripPosition.set(m.x,m.y,m.z),this._gripQuaternion.set(g.x,g.y,g.z,g.w)}}else this._object.position.copy(this._rayPosition),this._object.quaternion.copy(this._rayQuaternion).multiply(ta);const s=(c=this.xr.context.mainCamera)==null?void 0:c.parent,r=s?In(s):void 0;this._gripWorldPosition.copy(this._gripPosition),s&&this._gripWorldPosition.applyMatrix4(s.matrixWorld),this._gripWorldQuaternion.copy(this._gripQuaternion),this._gripWorldQuaternion.multiply(ta),r&&this._gripWorldQuaternion.premultiply(r),this.updateRayWorldPosition(),this.updateRayWorldQuaternion()}onDisconnected(){this._connected=!1,sh&&console.warn("Controller disconnected",this.index);for(const e of this._object.children)this.xr.context.scene.attach(e);this._object.removeFromParent(),this._debugAxesHelper.removeFromParent(),this.unsubscribeEvents()}getButton(e){var i;if(!this._layout)return;switch(e){case"primary-button":if(this.isLeft)e="x-button";else if(this.isRight)e="a-button";else return;break;case"primary":return this.toNeedleGamepadButton(0)}if(this._buttonMap.has(e))return this.toNeedleGamepadButton(this._buttonMap.get(e));const t=(i=this._layout)==null?void 0:i.components[e];if(t!=null&&t.gamepadIndices)switch(t.type){case"button":case"squeeze":if(this.inputSource.gamepad){const s=t.gamepadIndices.button;return this._buttonMap.set(e,s),this.toNeedleGamepadButton(s)}break;default:console.warn("Unsupported component type",t.type);break}this._buttonMap.set(e,void 0)}getGesture(e){const t=this.states[e];if(!t)return null;this.states[e]=t;const i=this._needleGamepadButtons[e]||new kD;return i.pressed=t.pressed,i.value=t.value,i.isDown=t.isDown,i.isUp=t.isUp,this._needleGamepadButtons[e]=i,i}toNeedleGamepadButton(e){var r;const t=(r=this.inputSource.gamepad)==null?void 0:r.buttons[e],i=this.states[e],s=this._needleGamepadButtons[e]||new kD;return t&&(s.pressed=t.pressed,s.value=t.value,s.touched=t.touched),i&&(s.isDown=i.isDown,s.isUp=i.isUp),this._needleGamepadButtons[e]=s,s}getStick(e){var i,s,r,o,a,c,l;if(!this._layout)return{x:0,y:0,z:0};if(e==="primary"){const h=((i=this.inputSource.gamepad)==null?void 0:i.axes[0])||0,d=((s=this.inputSource.gamepad)==null?void 0:s.axes[1])||0,f=((r=this.inputSource.gamepad)==null?void 0:r.buttons[3].value)||0;return{x:h,y:d,z:f}}const t=(o=this._layout)==null?void 0:o.components[e];if(t!=null&&t.gamepadIndices)switch(t.type){case"thumbstick":if(this.inputSource.gamepad){const h=t.gamepadIndices.xAxis,d=t.gamepadIndices.yAxis;let f=(a=this.inputSource.gamepad)==null?void 0:a.axes[h],p=(c=this.inputSource.gamepad)==null?void 0:c.axes[d];f*=-1,p*=-1;const m=t.gamepadIndices.button,g=(l=this.inputSource.gamepad)==null?void 0:l.buttons[m].value;return{x:f,y:p,z:g}}}return{x:0,y:0,z:0}}initialize(){if(!this._layout){const e=oZ(this.inputSource,pZ,mZ);this.getMotionController=e.then(t=>{var r;if(!this.connected)return null;this._motioncontroller=new uZ(this.inputSource,t.profile,t.assetPath||"");const s=t.profile.layouts[this.inputSource.handedness];if(this._layout=s,this._layout&&!((r=this._layout.gamepad)!=null&&r.length)){this._layout.gamepad=[];for(const o in this._layout.components){const a=this._layout.components[o];this._layout.gamepad[a.gamepadIndices.button]=o}}return this._motioncontroller}).catch(t=>{console.error(t)})}}subscribeEvents(){this.xr.session.addEventListener("selectstart",this.onSelectStart),this.xr.session.addEventListener("selectend",this.onSelectEnd),this.xr.session.addEventListener("squeezestart",this.onSequeezeStart),this.xr.session.addEventListener("squeezeend",this.onSequeezeEnd)}unsubscribeEvents(){this.xr.session.removeEventListener("selectstart",this.onSelectStart),this.xr.session.removeEventListener("selectend",this.onSelectEnd),this.xr.session.removeEventListener("squeezestart",this.onSequeezeStart),this.xr.session.removeEventListener("squeezeend",this.onSequeezeEnd)}updateInputEvents(){var e,t;if((e=this.gamepad)!=null&&e.buttons)for(let i=0;i<this.gamepad.buttons.length;i++){const s=this.gamepad.buttons[i],r=this.states[i]||new OD;let o=null;s.pressed&&!r.pressed?(o="pointerdown",r.isDown=!0,r.isUp=!1):!s.pressed&&r.pressed?(o="pointerup",r.isDown=!1,r.isUp=!0):(r.isDown=!1,r.isUp=!1),r.value=s.value,r.pressed=s.pressed,this.states[i]=r;const a=i!==this._selectButtonIndex&&i!==this._squeezeButtonIndex;if(o!=null&&a){const c=(t=this._layout)==null?void 0:t.gamepad[i];(sh||Em)&&console.log("Emitting pointer event",o,i,c,s.value,this.gamepad,this._layout),this.emitPointerEvent(o,i,c??"none",!1,null,s.value)}}if(this.hand){const i=this.handObject;if(i){const s=i.joints["index-finger-tip"],r=i.joints["thumb-tip"];if(s&&r){const c=s.position.distanceTo(r.position),l=this.states.pinch||new OD;l.value=c;const h=c<.02-.01,d=c>.02+.01;if(h&&!l.pressed?(Em&&console.log("pinch start",c),l.isDown=!0,l.isUp=!1,l.pressed=!0):d&&l.pressed?(l.isDown=!1,l.isUp=!0,l.pressed=!1):(l.isDown=!1,l.isUp=!1),this.states.pinch=l,!FS&&(l.isDown||l.isUp)){const f=h?"pointerdown":"pointerup",p=c/.02;if(Em){const m=this.rayWorldPosition.add(this.object.worldForward.multiplyScalar(.2));m.y+=.05,m.y+=Math.random()*.02,kt.DrawLabel(m,"pinch:"+f+", "+this.index+", "+this.side+`
`+i.uuid,.01,5,0,new Ii(1,1,1,.1))}this.emitPointerEvent(f,0,"pinch",!1,null,p)}}}}}onUpdateMove(){var i,s;let e=!1;if(this._lastPointerMovePosition.distanceTo(this.gripWorldPosition)>.02&&(e=!0),e||this._lastPointerMoveQuaternion.angleTo(this.gripWorldQuaternion)>.02&&(e=!0),e){this._didMoveLastFrame=!0,this._lastPointerMovePosition.copy(this.gripWorldPosition),this._lastPointerMoveQuaternion.copy(this.gripWorldQuaternion),sh&&kt.DrawLabel(this.rayWorldPosition.add(this.object.worldForward.multiplyScalar(.1)),"move",.01);let r=this.xr.context.input.getFirstPressedButtonForPointer(this.index);r===void 0&&(r=0);const o=(s=(i=this.gamepad)==null?void 0:i.buttons[r])==null?void 0:s.value;this.emitPointerEvent("pointermove",r,"none",!1,null,o)}else this._didMoveLastFrame=!1}emitPointerEvent(e,t,i,s,r=null,o){if(!this.emitEvents){sh&&e!==li.PointerMove&&console.warn("Pointer events are disabled for this controller",this.index,e,t);return}if(this.xr.mode==="immersive-vr"||this.xr.isPassThrough){this.pointerInit.origin=this,this.pointerInit.pointerId=this.index*10+t,this.pointerInit.pointerType=this.hand?"hand":"controller",this.pointerInit.button=t,this.pointerInit.buttonName=i,this.pointerInit.isPrimary=s,this.pointerInit.mode=this.inputSource.targetRayMode,this.pointerInit.ray=this.ray,this.pointerInit.device=this.object,this.pointerInit.pressure=o;const a=Lt.Current;Lt.Current=this.xr.context,sh&&e!=="pointermove"&&console.warn("Pointer event",e,t,i,{...this.pointerInit}),this.xr.context.input.createInputEvent(new lh(e,r,this.pointerInit)),Lt.Current=a}}}class OD{constructor(){u(this,"isDown",!1);u(this,"isUp",!1);u(this,"pressed",!1);u(this,"value",0)}}class kD{constructor(){u(this,"touched",!1);u(this,"pressed",!1);u(this,"value",0);u(this,"isDown",!1);u(this,"isUp",!1)}}const gg=re("debugwebxr");class US{constructor(e,t){u(this,"controllerStates",[]);u(this,"userId");u(this,"context");u(this,"userStateEvtName");u(this,"onReceivedControllerState",e=>{gg&&console.log(`XRSync: Received change for ${this.userId}: ${e.type} ${e.handedness}; tracked=${e.isTracking}`);let t=!1;for(let i=0;i<this.controllerStates.length;i++)if(this.controllerStates[i].index===e.index){this.controllerStates[i]=e,t=!0;break}t||this.controllerStates.push(e)});this.userId=e,this.context=t,this.userStateEvtName="xr-sync-user-state-"+e,this.context.connection.beginListen(this.userStateEvtName,this.onReceivedControllerState)}dispose(){this.context.connection.stopListen(this.userStateEvtName,this.onReceivedControllerState)}update(e){if(this.context.connection.isConnected!=!1){for(let t=this.controllerStates.length-1;t>=0;t--){const i=this.controllerStates[t];let s=!1;for(let r=0;r<e.controllers.length;r++)e.controllers[r].index===i.index&&(s=!0);s||(gg&&console.log(`XRSync: ${i.type} ${i.handedness} removed`,i.index),this.controllerStates.splice(t,1),this.sendControllerRemoved(i))}for(const t of e.controllers)this.updateControllerStates(t)}}onExitXR(e){for(const t of this.controllerStates)this.sendControllerRemoved(t);this.controllerStates.length=0}sendControllerRemoved(e){e.isTracking=!1,e.guid="",this.context.connection.send(this.userStateEvtName,e),this.context.connection.sendDeleteRemoteState(e.guid)}updateControllerStates(e){const t=this.controllerStates.find(i=>i.index===e.index);if(t){let i=!1;i||(i=t.isTracking!=e.isTracking),i&&(t.isTracking=e.isTracking,this.context.connection.send(this.userStateEvtName,t))}else{const i={guid:this.userId+"-"+e.index,isTracking:e.isTracking,handedness:e.side,index:e.index,type:e.hand?"hand":"controller"};this.controllerStates.push(i),this.context.connection.send(this.userStateEvtName,i),gg&&console.log(`XRSync: ${i.type} ${i.handedness} added`,i.index)}}}class gZ{constructor(e){u(this,"context");u(this,"onJoinedRoom",()=>{if(this.context.connection.connectionId){this._states.has(this.context.connection.connectionId)||(gg&&console.log("XRSync: Local user joined room",this.context.connection.connectionId),this._states.set(this.context.connection.connectionId,new US(this.context.connection.connectionId,this.context)));for(const e of this.context.connection.usersInRoom())this._states.has(e)||this._states.set(e,new US(e,this.context))}});u(this,"onLeftRoom",()=>{if(this.context.connection.connectionId&&!this._states.has(this.context.connection.connectionId)){const e=this._states.get(this.context.connection.connectionId);e==null||e.dispose(),this._states.delete(this.context.connection.connectionId)}});u(this,"onOtherUserJoinedRoom",e=>{const t=e.userId;this._states.has(t)||(gg&&console.log("XRSync: Remote user joined room",t),this._states.set(t,new US(t,this.context)))});u(this,"onOtherUserLeftRoom",e=>{const t=e.userId;if(!this._states.has(t)){const i=this._states.get(t);i==null||i.dispose(),this._states.delete(t)}});u(this,"_states",new Map);this.context=e,this.context.connection.beginListen(Xt.JoinedRoom,this.onJoinedRoom),this.context.connection.beginListen(Xt.LeftRoom,this.onLeftRoom),this.context.connection.beginListen(Xt.UserJoinedRoom,this.onOtherUserJoinedRoom),this.context.connection.beginListen(Xt.UserLeftRoom,this.onOtherUserLeftRoom)}hasState(e){return e?this._states.has(e):!1}isTracking(e,t){if(!e)return;const i=this._states.get(e);if(!i)return;const s=i.controllerStates.find(r=>r.handedness===t);return(s==null?void 0:s.isTracking)||!1}getDeviceType(e,t){if(!e)return;const i=this._states.get(e);if(!i)return;const s=i.controllerStates.find(r=>r.handedness===t);return(s==null?void 0:s.type)||"unknown"}destroy(){this.context.connection.stopListen(Xt.JoinedRoom,this.onJoinedRoom),this.context.connection.stopListen(Xt.LeftRoom,this.onLeftRoom),this.context.connection.stopListen(Xt.UserJoinedRoom,this.onOtherUserJoinedRoom),this.context.connection.stopListen(Xt.UserLeftRoom,this.onOtherUserLeftRoom)}onUpdate(e){if(this.context.connection.isConnected&&this.context.connection.connectionId){const t=this._states.get(this.context.connection.connectionId);t==null||t.update(e)}}onExitXR(e){if(this.context.connection.isConnected&&this.context.connection.connectionId){const t=this._states.get(this.context.connection.connectionId);t==null||t.onExitXR(e)}}}class LD{constructor(){u(this,"_fadeToColorQuad");u(this,"_fadeToColorMaterial");u(this,"_requestedFadeValue",0);u(this,"_transitionPromise",null);u(this,"_transitionResolve",null);this._fadeToColorMaterial=new ri({color:0,transparent:!0,depthTest:!1,fog:!1,side:Ai}),this._fadeToColorQuad=new me(new Wn(10,10),this._fadeToColorMaterial)}dispose(){this._fadeToColorQuad.geometry.dispose(),this._fadeToColorMaterial.dispose()}update(e,t){const i=this._fadeToColorQuad,s=this._fadeToColorMaterial;i.parent!==e&&s.opacity>0?e.add(i):s.opacity===0&&i.removeFromParent(),i.layers.set(2),i.material=this._fadeToColorMaterial,i.position.z=-1,i.renderOrder=1/0;const r=this._requestedFadeValue;s.opacity=nt.lerp(s.opacity,r,t/.03),Math.abs(s.opacity-r)<=.01&&this._transitionResolve&&(this._transitionResolve(),this._transitionResolve=null,this._transitionPromise=null,this._requestedFadeValue=0)}remove(){this._fadeToColorQuad.removeFromParent()}fadeTransition(){if(this._transitionPromise)return this._transitionPromise;this._requestedFadeValue=1;const e=new Promise(t=>{this._transitionResolve=t});return this._transitionPromise=e,e}}var fc;(function(n){n[n.Quad=0]="Quad",n[n.Cube=1]="Cube",n[n.Sphere=2]="Sphere"})(fc||(fc={}));class yA{static createPrimitive(e,t){let i;switch(e){case fc.Quad:const r=new Wn(1,1,1,1),o=(t==null?void 0:t.material)??new Ur({color:16777215});i=new me(r,o);break;case fc.Cube:const a=new Ni(1,1,1),c=(t==null?void 0:t.material)??new Ur({color:16777215});i=new me(a,c);break;case fc.Sphere:const l=new Aa(.5,16,16),h=(t==null?void 0:t.material)??new Ur({color:16777215});i=new me(l,h);break}return t!=null&&t.name&&(i.name=t.name),t!=null&&t.position&&i.position.set(t.position.x,t.position.y,t.position.z),t!=null&&t.rotation&&i.rotation.set(t.rotation.x,t.rotation.y,t.rotation.z),t!=null&&t.scale&&i.scale.set(t.scale.x,t.scale.y,t.scale.z),i}}const lR=class{constructor(e,t,i){u(this,"_session");u(this,"_mode");u(this,"_init");u(this,"_renderer");u(this,"_camera");u(this,"_scene");u(this,"onEnd",()=>{var e;(e=this._session)==null||e.removeEventListener("end",this.onEnd),this._renderer.setAnimationLoop(null),this._renderer.dispose(),this._scene.clear()});u(this,"_lastTime",0);u(this,"onFrame",(e,t)=>{const i=e-this._lastTime;this.update(e,i),this._camera.parent!==this._scene&&this._scene.add(this._camera),this._renderer.render(this._scene,this._camera)});u(this,"_spheres",[]);this._mode=e,this._init=t,this._session=i,this._session.addEventListener("end",this.onEnd),this._renderer=new Rl({alpha:!0}),this._renderer.setAnimationLoop(this.onFrame),this._renderer.xr.setSession(i),this._renderer.xr.enabled=!0,this._camera=new Wt,this._scene=new Ws,this._scene.add(this._camera),this.setupScene()}static get active(){return this._active}static async start(e,t){if(this._active)return console.error("Cannot start a new XR session while one is already active"),null;if(this._requestInFlight)return console.error("Cannot start a new XR session while a request is already in flight"),null;if("xr"in navigator&&navigator.xr){if(!t)return console.error("XRSessionInit must be provided"),null;this._requestInFlight=!0;const i=await navigator.xr.requestSession(e,t);return i.addEventListener("end",()=>{this._active=null}),this._requestInFlight?(this._requestInFlight=!1,this._active=new lR(e,t,i),this._active):(i.end(),null)}return null}static async handoff(){return this._active?this._active.handoff():null}static async stop(){this._requestInFlight=!1,this._active&&(await this._active.end(),await ha(100)),this._active=null}end(){return this._session?this._session.end():Promise.resolve()}async handoff(){if(!this._session)throw new Error("Cannot handoff a session that has already ended");const e={session:this._session,mode:this._mode,init:this._init};return await this.onBeforeHandoff(),this.onEnd(),this._session=null,e}async onBeforeHandoff(){const e=yA.createPrimitive(fc.Cube);e.position.z=-3,e.position.y=.5,this._scene.add(e),await ha(4e3),this._scene.clear(),await ha(100)}setupScene(){this._scene.background=new ye(0),this._scene.add(new ex(5,10,1118481,2236962));const e=new mp(16777215,1);e.position.set(2,2,2),e.castShadow=!1,this._scene.add(e);const t=new mp(16777215,1);t.position.set(-2,-2,-2),t.castShadow=!1,this._scene.add(t);const i=50;for(let s=0;s<100;s++){const r=yA.createPrimitive(fc.Sphere,{material:new Ur({color:2236962,metalness:1,roughness:.8})});r.position.x=nt.random(-i,i),r.position.y=nt.random(3,40),r.position.z=nt.random(-i,i),r.scale.multiplyScalar(2),this._spheres.push(r),this._scene.add(r)}}update(e,t){const i=e*4e-4;for(let s=0;s<this._spheres.length;s++){const r=this._spheres[s];r.position.y+=Math.sin(i+s*.5)*.002}}};let Vu=lR;u(Vu,"_active",null),u(Vu,"_requestInFlight",!1);const nr=re("debugwebxr"),AZ=re("stats");function vZ(n){let e=null;const t=n;return t.getAROverlayContainer?e=t.getAROverlayContainer():e=n,e}yZ();function yZ(){var n;if("xr"in navigator){if(/WebXRViewer\//i.test(navigator.userAgent)){console.warn("WebXRViewer does not support addEventListener");return}(n=navigator.xr)==null||n.addEventListener("sessiongranted",()=>{console.log("Received Session Granted...");const e=sessionStorage.getItem("needle_xr_session_mode"),t=sessionStorage.getItem("needle_xr_session_init");if(e&&t){console.log("Session Granted: Restore last session");const i=JSON.parse(t);mt.start(e,i).catch(s=>console.warn(s))}else mt.start("immersive-vr").catch(i=>console.warn("Session Granted failed:",i))})}}function bZ(n,e){sessionStorage.setItem("needle_xr_session_mode",n),sessionStorage.setItem("needle_xr_session_init",JSON.stringify(e))}function _Z(){sessionStorage.removeItem("needle_xr_session_mode"),sessionStorage.removeItem("needle_xr_session_init")}fb()&&Tt()&&window.addEventListener("keydown",n=>{n.key==="x"&&mt.active&&mt.stop()});if(re("simulatewebxrloading")){zi.registerCallback(Cn.ContextCreationStart,async e=>{await ha(3e3),setTimeout(async()=>{const t=await Vu.handoff();t?mt.setSession(t.mode,t.session,t.init,Lt.Current):mt.start("immersive-vr")},6e3)});let n=!1;window.addEventListener("click",()=>{n||(n=!0,Vu.start("immersive-vr",mt.getDefaultSessionInit("immersive-vr")))})}const gh=class{constructor(e,t,i,s){u(this,"context");u(this,"session");u(this,"mode");u(this,"controllers",[]);u(this,"_rigScale",1);u(this,"_lastRigScaleUpdate",-1);u(this,"_rigs",[]);u(this,"_viewerHitTestSource",null);u(this,"_defaultRig");u(this,"_xr_scripts");u(this,"_xr_update_scripts",[]);u(this,"_inactive_scripts",[]);u(this,"_controllerAdded");u(this,"_controllerRemoved");u(this,"_originalCameraWorldPosition");u(this,"_originalCameraWorldRotation");u(this,"_originalCameraWorldScale");u(this,"_originalCameraParent");u(this,"_mainCamera",null);u(this,"onRendererSessionSet",()=>{this.running&&(this.context.renderer.xr.enabled=!0,this.context.renderer.xr.updateCamera(this.context.mainCamera))});u(this,"onInputSourceAdded",e=>{if(e.targetRayMode==="screen")return;let t=0;for(let s=0;s<this.session.inputSources.length;s++)if(this.session.inputSources[s]===e){t=s;break}if(this.controllers.find(s=>s.inputSource===e))return;const i=new T3(this,e,t);this.controllers.push(i),this.controllers.sort((s,r)=>s.index-r.index),this._newControllers.push(i),this.invokeControllerEvent(i,this._controllerAdded,"added")});u(this,"_ended",!1);u(this,"_newControllers",[]);u(this,"onEnd",e=>{var s,r,o,a;if(this._ended)return;this._ended=!0,nr&&console.log("XR Session ended"),_Z(),this.onAfterRender(),this.revertCustomForward(),this._didStart=!1,this._previousCameraParent=null,Pq(this.onBefore,jt.LateUpdate);const t=this.context.pre_render_callbacks.indexOf(this.onBeforeRender);t>=0&&this.context.pre_render_callbacks.splice(t,1);const i=this.context.post_render_callbacks.indexOf(this.onAfterRender);i>=0&&this.context.post_render_callbacks.splice(i,1),this.context.xr=null,this.context.renderer.xr.enabled=!1,(s=this.context.mainCameraComponent)==null||s.applyClearFlags();for(const c of gh._xrEndListeners)c({xr:this});for(let c=0;c<this.controllers.length;c++)this.disconnectInputSource(this.controllers[c].inputSource);for(const c of this._xr_scripts)(r=c==null?void 0:c.onLeaveXR)==null||r.call(c,{xr:this});(o=this.sync)==null||o.onExitXR(this),this.context.mainCamera&&((a=this._originalCameraParent)==null||a.add(this.context.mainCamera),this._originalCameraWorldPosition&&vr(this.context.mainCamera,this._originalCameraWorldPosition),this._originalCameraWorldRotation&&fa(this.context.mainCamera,this._originalCameraWorldRotation),this._originalCameraWorldScale&&Pb(this.context.mainCamera,this._originalCameraWorldScale)),this.context.requestSizeUpdate(),this._defaultRig.gameObject.removeFromParent()});u(this,"_didStart",!1);u(this,"onBefore",e=>{var s,r,o,a,c,l,h,d;const t=e.xrFrame;if(!t)return;this.context.xr=this,this.context.mainCameraComponent&&this.context.mainCameraComponent!==this._mainCamera&&(this._mainCamera=this.context.mainCameraComponent),((s=this.rig)==null?void 0:s.isActive)==!1&&(nr&&console.warn("Latest rig is not active - trying to activate a different rig",this.rig),this.updateActiveXRRig()),this.rig&&((r=this._mainCamera)!=null&&r.gameObject)&&((a=(o=this._mainCamera)==null?void 0:o.gameObject)==null?void 0:a.parent)!==this.rig.gameObject&&this.rig.gameObject.add((c=this._mainCamera)==null?void 0:c.gameObject),this.internalUpdateState(),this.applyCustomForward();const i={xr:this};if(this._didStart){if(this.context.new_scripts_xr.length>0){const f=[...this.context.new_scripts_xr];for(let p=0;p<f.length;p++){const m=this.context.new_scripts_xr[p];if(!m||m.destroyed||((l=m.supportsXR)==null?void 0:l.call(m,this.mode))==!1){this.context.new_scripts_xr.splice(p,1);continue}if(!m.activeAndEnabled){this.context.new_scripts_xr.splice(p,1),this.markInactive(m);continue}if(this.addScript(m)){this.invokeCallback_EnterXR(m);for(const g of this.controllers)this.invokeCallback_ControllerAdded(m,g)}}}}else{this._didStart=!0;for(const p of gh._xrStartListeners)p(i);const f=[...this._xr_scripts];nr&&console.log("NeedleXRSession start, handle scripts:",f);for(const p of f){if(p.destroyed){this._script_to_remove.push(p);continue}if(!p.activeAndEnabled){this.markInactive(p);continue}this.invokeCallback_EnterXR(p);for(const m of this.controllers)this.invokeCallback_ControllerAdded(p,m)}}this.syncCameraCullingMask();for(const f of this.controllers)f.onUpdate(t);for(const f of this._newControllers)for(const p of this._xr_scripts){if(p.destroyed){this._script_to_remove.push(p);continue}p.onXRControllerAdded&&p.onXRControllerAdded({xr:this,controller:f,change:"added"})}this._newControllers.length=0;for(const f of this._xr_update_scripts){if(f.destroyed===!0){this._script_to_remove.push(f);continue}if(f.activeAndEnabled===!1){this.markInactive(f);continue}f.onUpdateXR&&f.onUpdateXR(i)}if(this.handleInactiveScripts(),this._script_to_remove.length>0){const f=[...new Set(this._script_to_remove)];this._script_to_remove.length=0;for(const p of f)!p.destroyed&&this.running&&((h=p.onLeaveXR)==null||h.call(p,i)),this.removeScript(p)}(d=this.sync)==null||d.onUpdate(this),this.onRenderDebug()});u(this,"onBeforeRender",()=>{this.context.mainCamera&&this.updateFade(this.context.mainCamera)});u(this,"onAfterRender",()=>{if(this.onUpdateFade_PostRender(),fb()){const e=this.context.renderer;if(e.xr.isPresenting&&this.context.mainCamera){const t=e.xr.enabled,i=e.getRenderTarget();e.xr.enabled=!1,e.setRenderTarget(null),e.render(this.context.scene,this.context.mainCamera),e.xr.enabled=t,e.setRenderTarget(i)}}});u(this,"_script_to_remove",[]);u(this,"_camera");u(this,"_cameraRenderParent",new ge().rotateY(Math.PI));u(this,"_previousCameraParent");u(this,"_customforward",!0);u(this,"originalCameraNearPlane");u(this,"_viewerPose");u(this,"_transformOrientation",new Me);u(this,"_transformPosition",new w);u(this,"_transition");var r,o,a;bZ(e,s.init),this.session=t,this.mode=e,this.context=i,this.context.xr=this,this.context.renderer.xr.setSession(this.session).then(this.onRendererSessionSet),this._xr_scripts=[...s.scripts],this._xr_update_scripts=this._xr_scripts.filter(c=>typeof c.onUpdateXR=="function"),this._controllerAdded=s.controller_added,this._controllerRemoved=s.controller_removed,eU(this.onBefore,jt.LateUpdate),this.context.pre_render_callbacks.push(this.onBeforeRender),this.context.post_render_callbacks.push(this.onAfterRender),((r=s.init.optionalFeatures)!=null&&r.includes("hit-test")||(o=s.init.requiredFeatures)!=null&&o.includes("hit-test"))&&t.requestReferenceSpace("viewer").then(c=>{var l,h;return(h=(l=t.requestHitTestSource)==null?void 0:l.call(t,{space:c}))==null?void 0:h.then(d=>this._viewerHitTestSource=d)}).catch(c=>console.warn(c)),this.context.mainCamera&&(this._originalCameraWorldPosition=Ht(this.context.mainCamera,new w),this._originalCameraWorldRotation=In(this.context.mainCamera,new Me),this._originalCameraWorldScale=br(this.context.mainCamera,new w),this._originalCameraParent=this.context.mainCamera.parent),(a=this.context.mainCameraComponent)==null||a.applyClearFlags(),this._defaultRig=new fZ,this.context.scene.add(this._defaultRig.gameObject),this.addRig(this._defaultRig);for(const c of this.session.inputSources)this.onInputSourceAdded(c);this.session.addEventListener("end",this.onEnd),this.session.addEventListener("inputsourceschange",c=>{for(const l of c.removed)this.disconnectInputSource(l);for(const l of c.added)this.onInputSourceAdded(l)})}static getXRSync(e){return this._sync||(this._sync=new gZ(e)),this._sync}static get currentSessionRequest(){return this._currentSessionRequestMode}static get active(){return this._activeSession}static get activeMode(){var e;return((e=this._activeSession)==null?void 0:e.mode)??null}static get xrSystem(){return"xr"in navigator?navigator.xr:void 0}static isXRSupported(){return Promise.all([this.isVRSupported(),this.isARSupported()]).then(e=>e.some(t=>t)).catch(()=>!1)}static isVRSupported(){return this.isSessionSupported("immersive-vr")}static isARSupported(){return this.isSessionSupported("immersive-ar")}static isSessionSupported(e){var t;return((t=this.xrSystem)==null?void 0:t.isSessionSupported(e).catch(i=>(nr&&console.error(i),!1)))??Promise.resolve(!1)}static onSessionRequestStart(e){this._sessionRequestStartListeners.push(e)}static offSessionRequestStart(e){const t=this._sessionRequestStartListeners.indexOf(e);t>=0&&this._sessionRequestStartListeners.splice(t,1)}static onSessionRequestEnd(e){this._sessionRequestEndListeners.push(e)}static offSessionRequestEnd(e){const t=this._sessionRequestEndListeners.indexOf(e);t>=0&&this._sessionRequestEndListeners.splice(t,1)}static onXRSessionStart(e){this._xrStartListeners.push(e)}static offXRSessionStart(e){const t=this._xrStartListeners.indexOf(e);t>=0&&this._xrStartListeners.splice(t,1)}static onXRSessionEnd(e){this._xrEndListeners.push(e)}static offXRSessionEnd(e){const t=this._xrEndListeners.indexOf(e);t>=0&&this._xrEndListeners.splice(t,1)}static onControllerAdded(e){this._controllerAddedListeners.push(e)}static offControllerAdded(e){const t=this._controllerAddedListeners.indexOf(e);t>=0&&this._controllerAddedListeners.splice(t,1)}static onControllerRemoved(e){this._controllerRemovedListeners.push(e)}static offControllerRemoved(e){const t=this._controllerRemovedListeners.indexOf(e);t>=0&&this._controllerRemovedListeners.splice(t,1)}static offerSession(e,t,i){return"xr"in navigator&&navigator.xr&&"offerSession"in navigator.xr?(typeof navigator.xr.offerSession=="function"&&(console.log("WebXR offerSession is available - requesting mode: "+e),t=="default"&&(t=this.getDefaultSessionInit(e)),navigator.xr.offerSession(e,{...t}).then(s=>gh.setSession(e,s,t,i)).catch(s=>{console.log("XRSession offer rejected (perhaps because another call to offerSession was made or a call to requestSession was made)")})),!0):!1}static getDefaultSessionInit(e){switch(e){case"immersive-ar":return{optionalFeatures:["anchors","local-floor","hand-tracking","layers","dom-overlay","hit-test"]};case"immersive-vr":return{optionalFeatures:["local-floor","bounded-floor","hand-tracking","high-fixed-foveation-level","layers"]};default:return console.warn("No default session init for mode",e),{}}}static async start(e,t,i){var o,a,c,l;if(this._currentSessionRequest)return console.warn("A XRSession is already being requested"),(nr||Tt())&&gn("A XRSession is already being requested"),this._currentSessionRequest.then(()=>this._activeSession);if(this._activeSession)return console.error("A XRSession is already running"),this._activeSession;if(i||(i=Lt.Current),i||(i=zi.All[0]),!i)throw new Error("No Needle Engine Context found");switch(t||(t={}),e){case"immersive-ar":{if(await((o=this.xrSystem)==null?void 0:o.isSessionSupported("immersive-ar"))!==!0)return console.error(e+" is not supported by this browser."),null;const d=this.getDefaultSessionInit(e),f=vZ(i.domElement);f&&!i1()&&(d.domOverlay={root:f},d.optionalFeatures.push("dom-overlay")),t={...d,...t}}break;case"immersive-vr":{if(await((a=this.xrSystem)==null?void 0:a.isSessionSupported("immersive-vr"))!==!0)return console.error(e+" is not supported by this browser."),null;t={...this.getDefaultSessionInit(e),...t}}break;default:console.warn("No default session init for mode",e);break}await Vu.stop();const s=e=="immersive-ar"?i.scripts_immersive_ar:i.scripts_immersive_vr;nr?console.log(`%cRequesting ${e} session`,"font-weight:bold;",t,s):console.log(`%cRequesting ${e} session`,"font-weight:bold;");for(const h of s)h.onBeforeXR&&h.onBeforeXR(e,t);for(const h of this._sessionRequestStartListeners)h({mode:e,init:t});nr&&Tn("Requesting "+e+" session ("+Date.now()+")"),this._currentSessionRequest=(c=navigator.xr)==null?void 0:c.requestSession(e,t),this._currentSessionRequestMode=e;const r=await((l=this._currentSessionRequest)==null?void 0:l.catch(h=>{console.error(h,"Code: "+h.code),h.code===9&&gn("Make sure your device has the required permissions (e.g. camera access)"),console.log("If the specified XR configuration is not supported (e.g. entering AR doesnt work) - make sure you access the website on a secure connection (HTTPS) and your device has the required permissions (e.g. camera access)"),location.protocol==="http:"&&gn("XR requires a secure connection (HTTPS)")}));this._currentSessionRequest=void 0,this._currentSessionRequestMode=null;for(const h of this._sessionRequestEndListeners)h({mode:e,init:t,newSession:r||null});return r?this.setSession(e,r,t,i):(console.warn("XR Session request was rejected"),null)}static setSession(e,t,i,s){if(this._activeSession)return console.error("A XRSession is already running"),this._activeSession;const r=e=="immersive-ar"?s.scripts_immersive_ar:s.scripts_immersive_vr;return this._activeSession=new gh(e,t,s,{scripts:r,controller_added:this._controllerAddedListeners,controller_removed:this._controllerRemovedListeners,init:i}),t.addEventListener("end",this.onEnd),nr?console.log(`%cStarted ${e} session`,"font-weight:bold;",r):console.log(`%cStarted ${e} session`,"font-weight:bold;"),this._activeSession}static stop(){var e;(e=this._activeSession)==null||e.end()}get sync(){return gh._sync}get running(){return!this._ended&&this.session!=null}get interactionMode(){return this.session.interactionMode}get visibilityState(){return this.session.visibilityState}get environmentBlendMode(){return this.session.environmentBlendMode}get frame(){return this.context.xrFrame}get leftController(){return this.controllers.find(e=>e.isLeft)}get rightController(){return this.controllers.find(e=>e.isRight)}getController(e){return this.controllers.find(t=>t.side===e)||null}get isPassThrough(){return!!(this.environmentBlendMode!=="opaque"&&this.interactionMode==="world-space"||this.mode==="immersive-ar"&&this.environmentBlendMode!=="opaque"&&this.controllers.some(e=>e.inputSource.targetRayMode==="tracked-pointer")||Tt()&&fb()&&this.mode==="immersive-ar")}get isAR(){return this.mode==="immersive-ar"}get isVR(){return this.mode==="immersive-vr"}get posePosition(){return this._transformPosition}get poseOrientation(){return this._transformOrientation}get referenceSpace(){return this.context.renderer.xr.getReferenceSpace()}get viewerPose(){return this._viewerPose}get isTrackingImages(){if(this.frame&&"getImageTrackingResults"in this.frame&&typeof this.frame.getImageTrackingResults=="function")try{const e=this.frame.getImageTrackingResults();for(const t of e)if(t.trackingState==="tracked")return!0}catch{return!1}return!1}get rig(){const e=this._rigs[0]??null;return e!=null&&e.gameObject&&_p(e.gameObject)||(e==null?void 0:e.isActive)===!1?(this.updateActiveXRRig(),this._rigs[0]??null):e}get rigScale(){return this._rigs[0]?(this._lastRigScaleUpdate!==this.context.time.frame&&(this._lastRigScaleUpdate=this.context.time.frame,this._rigScale=this._rigs[0].gameObject.worldScale.x),this._rigScale):1}addRig(e){this._rigs.indexOf(e)>=0||(e.priority===void 0&&(e.priority=0),this._rigs.push(e),this.updateActiveXRRig())}removeRig(e){const t=this._rigs.indexOf(e);t!==-1&&(this._rigs.splice(t,1),this.updateActiveXRRig())}setRigActive(e){const t=this._rigs.indexOf(e);this._rigs.splice(t,1),this._rigs.unshift(e),this.updateActiveXRRig()}updateActiveXRRig(){const e=this._rigs[0]??null;this._defaultRig.gameObject.parent!==this.context.scene&&this.context.scene.add(this._defaultRig.gameObject),this._defaultRig.gameObject.visible=!0,this._rigs.includes(this._defaultRig)||this._rigs.push(this._defaultRig);let t=this._rigs[0];t&&t.priority===void 0&&(t.priority=0);for(let i=1;i<this._rigs.length;i++){const s=this._rigs[i];if(s.isActive){if(_p(s.gameObject)){this._rigs.splice(i,1),i--;continue}(!t||t.isActive===!1||s.priority!==void 0&&s.priority>t.priority)&&(t=s)}}if(e!==t){const i=this._rigs.indexOf(t);i>=0&&this._rigs.splice(i,1),this._rigs.unshift(t)}nr&&(e===t?console.log("Updated Active XR Rig:",t,"prev:",e):console.log("Updated Active XRRig:",t," (the same as before)"))}getHitTest(e){if(e)return this.getControllerHitTest(e);if(!this._viewerHitTestSource)return null;const t=this._viewerHitTestSource,i=this.frame.getHitTestResults(t);if(i.length>0){const s=i[0];return this.convertHitTestResult(s)}return null}getControllerHitTest(e){const t=e.hitTestSource;if(!t)return null;const i=this.frame.getHitTestResultsForTransientInput(t);for(const s of i)if(s.inputSource===e.inputSource)for(const r of s.results)return this.convertHitTestResult(r);return null}convertHitTestResult(e){const t=this.context.renderer.xr.getReferenceSpace(),i=t&&e.getPose(t);if(i){const s=Gn(i.transform.position),r=Bf(i.transform.orientation),o=this.context.mainCamera;if((o==null?void 0:o.parent)!==this._cameraRenderParent&&s.applyMatrix4(Bb),o!=null&&o.parent){s.applyMatrix4(o.parent.matrixWorld),r.multiply(ta);const a=In(o.parent);a.premultiply(ta),r.premultiply(a)}return{hit:e,position:s,quaternion:r}}return null}convertSpace(e){const t=Gn(e.position);t.applyMatrix4(Bb);const i=Bf(e.orientation);return i.premultiply(ta),{position:t,quaternion:i}}end(){this._ended||this.session.end().catch(e=>console.warn(e))}disconnectInputSource(e){for(let t=this.controllers.length-1;t>=0;t--){const i=this.controllers[t];if(i.inputSource===e){this.controllers.splice(t,1),this.invokeControllerEvent(i,this._controllerRemoved,"removed");const s={xr:this,controller:i,change:"removed"};for(const r of this._xr_scripts)r.onXRControllerRemoved&&r.onXRControllerRemoved(s);i.onDisconnected()}}}onRenderDebug(){if(nr)for(const e of this.controllers)e.onRenderDebug();if((nr||AZ)&&this.rig){const e=this.rig.gameObject.worldPosition,t=this.rig.gameObject.worldForward;e.add(t.multiplyScalar(1.5));const i=this.rig.gameObject.worldUp;e.add(i.multiplyScalar(2.5));let s="";if(s+=this.context.time.smoothedFps.toFixed(1),nr)for(const r of this.controllers)s+=`
${r.hand?"hand":"ctrl"} ${r.inputSource.handedness}[${r.index}] con:${r.connected} tr:${r.isTracking}`;kt.DrawLabel(e,s)}}addScript(e){return this._xr_scripts.includes(e)?!1:(nr&&console.log("Register new XRScript",e),this._xr_scripts.push(e),typeof e.onUpdateXR=="function"&&this._xr_update_scripts.push(e),!0)}markInactive(e){if(!(this._inactive_scripts.indexOf(e)>=0)){this.removeScript(e,!1),this._inactive_scripts.push(e);for(const t of this.controllers)this.invokeCallback_ControllerRemoved(e,t);this.invokeCallback_LeaveXR(e)}}handleInactiveScripts(){if(this._inactive_scripts.length>0)for(let e=this._inactive_scripts.length-1;e>=0;e--){const t=this._inactive_scripts[e];if(t.activeAndEnabled){this._inactive_scripts.splice(e,1),this.addScript(t),this.invokeCallback_EnterXR(t);for(const i of this.controllers)this.invokeCallback_ControllerAdded(t,i)}}}removeScript(e,t=!0){nr&&console.log("Remove XRScript",e);const i=this._xr_scripts.indexOf(e);i>=0&&this._xr_scripts.splice(i,1);const s=this._xr_update_scripts.indexOf(e);if(s>=0&&this._xr_update_scripts.splice(s,1),t){const r=this._inactive_scripts.indexOf(e);r>=0&&this._inactive_scripts.splice(r,1)}}invokeCallback_EnterXR(e){e.onEnterXR&&e.onEnterXR({xr:this})}invokeCallback_ControllerAdded(e,t){e.onXRControllerAdded&&e.onXRControllerAdded({xr:this,controller:t,change:"added"})}invokeCallback_ControllerRemoved(e,t){e.onXRControllerRemoved&&e.onXRControllerRemoved({xr:this,controller:t,change:"removed"})}invokeCallback_LeaveXR(e){e.onLeaveXR&&!e.destroyed&&e.onLeaveXR({xr:this})}syncCameraCullingMask(){var i;const e=this.context.xrCamera,t=(i=this.context.mainCameraComponent)==null?void 0:i.cullingMask;if(e&&t!==void 0){for(const s of e.cameras)s.layers.mask=t;e.layers.mask=t}else if(e){for(const s of e.cameras)s.layers.enableAll();e.layers.enableAll()}}invokeControllerEvent(e,t,i){for(let s=t.length-1;s>=0;s--){const r=t[s];if(r)try{r({xr:this,controller:e,change:i})}catch(o){console.error(o)}}}applyCustomForward(){var e;if(this.context.mainCamera&&this._customforward){this._camera=this.context.mainCamera,this._camera.parent!==this._cameraRenderParent&&(this._previousCameraParent=this._camera.parent,(e=this._previousCameraParent)==null||e.add(this._cameraRenderParent)),this._cameraRenderParent.name="XR Camera Render Parent",this._cameraRenderParent.add(this._camera);let t=.02;if(this.rig){const i=br(this.rig.gameObject);t*=i.x}this._camera instanceof Wt&&this._camera.near>t&&(this.originalCameraNearPlane=this._camera.near,this._camera.near=t)}}revertCustomForward(){this._camera&&this._previousCameraParent&&this._previousCameraParent.add(this._camera),this._previousCameraParent=null,this._camera instanceof Wt&&this.originalCameraNearPlane!=null&&(this._camera.near=this.originalCameraNearPlane)}internalUpdateState(){const e=this.context.renderer.xr.getReferenceSpace();if(!e){this._viewerPose=void 0;return}if(this._viewerPose=this.frame.getViewerPose(e),this._viewerPose){const t=this._viewerPose.transform;this._transformPosition.set(t.position.x,t.position.y,t.position.z),this._transformOrientation.set(t.orientation.x,t.orientation.y,t.orientation.z,t.orientation.w)}}get transition(){return this._transition||(this._transition=new LD),this._transition}fadeTransition(){return this._transition||(this._transition=new LD),this._transition.fadeTransition()}updateFade(e){this._transition&&e instanceof Wt&&this._transition.update(e,this.context.time.deltaTime)}onUpdateFade_PostRender(){var e;(e=this._transition)==null||e.remove()}};let mt=gh;u(mt,"_sync",null),u(mt,"_currentSessionRequestMode",null),u(mt,"_currentSessionRequest"),u(mt,"_activeSession"),u(mt,"_sessionRequestStartListeners",[]),u(mt,"_sessionRequestEndListeners",[]),u(mt,"_xrStartListeners",[]),u(mt,"_xrEndListeners",[]),u(mt,"_controllerAddedListeners",[]),u(mt,"_controllerRemovedListeners",[]),u(mt,"onEnd",()=>{nr&&console.log("XR Session ended"),gh._activeSession=null});const NS=re("debugwebxr");class xZ{static tryFindAvatarObjects(e,t,i){if(i.head&&i.leftHand&&i.rightHand)return;const s=e.name.toLocaleLowerCase();!i.head&&s.includes("head")&&(NS&&console.log("FOUND AVATAR HEAD",e.name),i.head=new ii("",t,e)),s.includes("hand")&&(!i.leftHand&&s.includes("left")&&(NS&&console.log("FOUND AVATAR LEFT HAND",e.name),i.leftHand=new ii("",t,e)),!i.rightHand&&s.includes("right")&&(NS&&console.log("FOUND AVATAR RIGHT HAND",e.name),i.rightHand=new ii("",t,e)));for(let r=0;r<e.children.length;r++){if(i.head&&i.leftHand&&i.rightHand)return;const o=e.children[r];this.tryFindAvatarObjects(o,t,i)}}}const sr=new w,FD=new w,UD=new Me,wZ=re("debuggizmos"),Fc=8947848,Zo=class{static isGizmo(e){return e[uT]!==void 0}static DrawLabel(e,t,i=.05,s=0,r,o,a){var h;if(!Zo.enabled)return null;r||(r=Fc);const c=((h=mt.active)==null?void 0:h.rigScale)??1,l=Dn.getTextLabel(s,t,i*c,r,o);return a instanceof ge&&a.add(l),l.position.x=e.x,l.position.y=e.y,l.position.z=e.z,l}static DrawRay(e,t,i=Fc,s=0,r=!0){if(!Zo.enabled)return;const o=Dn.getLine(s),a=o.geometry.getAttribute("position");a.setXYZ(0,e.x,e.y,e.z),sr.set(t.x,t.y,t.z).multiplyScalar(999999999),a.setXYZ(1,e.x+sr.x,e.y+sr.y,e.z+sr.z),a.needsUpdate=!0,o.material.color.set(i),o.material.depthTest=r,o.material.depthWrite=!1}static DrawDirection(e,t,i=Fc,s=0,r=!0,o=1){if(!Zo.enabled)return;const a=Dn.getLine(s),c=a.geometry.getAttribute("position");c.setXYZ(0,e.x,e.y,e.z),t.w!==void 0?(sr.set(0,0,-o),UD.set(t.x,t.y,t.z,t.w),sr.applyQuaternion(UD)):(sr.set(t.x,t.y,t.z),sr.multiplyScalar(o)),c.setXYZ(1,e.x+sr.x,e.y+sr.y,e.z+sr.z),c.needsUpdate=!0,a.material.color.set(i),a.material.depthTest=r,a.material.depthWrite=!1}static DrawLine(e,t,i=Fc,s=0,r=!0){if(!Zo.enabled)return;const o=Dn.getLine(s),a=o.geometry.getAttribute("position");a.setXYZ(0,e.x,e.y,e.z),a.setXYZ(1,t.x,t.y,t.z),a.needsUpdate=!0,o.material.color.set(i),o.material.depthTest=r,o.material.depthWrite=!1}static DrawWireSphere(e,t,i=Fc,s=0,r=!0){if(!Zo.enabled)return;const o=Dn.getSphere(t,s,!0);vA(o,e.x,e.y,e.z),o.material.color.set(i),o.material.depthTest=r,o.material.depthWrite=!1}static DrawSphere(e,t,i=Fc,s=0,r=!0){if(!Zo.enabled)return;const o=Dn.getSphere(t,s,!1);vA(o,e.x,e.y,e.z),o.material.color.set(i),o.material.depthTest=r,o.material.depthWrite=!1}static DrawWireBox(e,t,i=Fc,s=0,r=!0){if(!Zo.enabled)return;const o=Dn.getBox(s);o.position.set(e.x,e.y,e.z),o.scale.set(t.x,t.y,t.z),o.material.color.set(i),o.material.depthTest=r,o.material.wireframe=!0,o.material.depthWrite=!1}static DrawWireBox3(e,t=Fc,i=0,s=!0){if(!Zo.enabled)return;const r=Dn.getBox(i);r.position.copy(e.getCenter(sr)),r.scale.copy(e.getSize(sr)),r.material.color.set(t),r.material.depthTest=s,r.material.wireframe=!0,r.material.depthWrite=!1}static DrawArrow(e,t,i=Fc,s=0,r=!0,o=!1){if(!Zo.enabled)return;const a=Dn.getArrowHead(s);a.position.set(t.x,t.y,t.z),a.quaternion.setFromUnitVectors(this._up.set(0,1,0),sr.set(t.x,t.y,t.z).sub(FD.set(e.x,e.y,e.z)).normalize());const l=sr.set(t.x,t.y,t.z).sub(FD.set(e.x,e.y,e.z)).length()*.1;a.scale.set(l,l,l),a.material.color.set(i),a.material.depthTest=r,a.material.wireframe=o,this.DrawLine(e,t,i,s,r)}};let kt=Zo;u(kt,"enabled",!0),u(kt,"_up",new w(0,1,0));const SZ=new Ni(1,1,1);function eI(n=null){const e=new ye(n??14540253),t=new FM(SZ);return new Go(t,new Ln({color:e}))}const uT=Symbol("GizmoCache");class Dn{static ensureFont(){let e=bf.FontLibrary.getFontFamily(this.familyName);if(!e){e=bf.FontLibrary.addFontFamily(this.familyName);const t=e.addVariant("normal","normal","./include/needle/arial-msdf.json","./include/needle/arial.png");t==null||t.addEventListener("ready",()=>{bf.update()})}}static getTextLabel(e,t,i,s,r){this.ensureFont();let o=this.textLabelCache.pop(),a=1;r&&typeof r=="string"&&(r==null?void 0:r.length)>=8&&r.startsWith("#")?(a=parseInt(r.substring(7),16)/255,r=r.substring(0,7),wZ&&console.log(r,a)):typeof r=="object"&&r.a!==void 0&&(a=r.a);const c={boxSizing:"border-box",fontFamily:this.familyName,width:"auto",fontSize:i,color:s,lineHeight:1,backgroundColor:r??void 0,backgroundOpacity:a,textContent:t,borderRadius:.5*i,padding:.8*i,whiteSpace:"pre"};if(o)o.set(c);else{o=new Z1(c);const l=this,h=o;h.setText=function(d){this.set({textContent:d}),l.tmuiNeedsUpdate=!0}}return this.tmuiNeedsUpdate=!0,this.registerTimedObject(Lt.Current,o,e,this.textLabelCache),o}static getBox(e){let t=this.boxesCache.pop();if(!t){const i=new Ni(1,1,1);t=new me(i)}return this.registerTimedObject(Lt.Current,t,e,this.boxesCache),t}static getLine(e){let t=this.linesCache.pop();if(!t){t=new Sn;let i=t.geometry.getAttribute("position");i||(i=new it(new Float32Array(2*3),3),t.geometry.setAttribute("position",i))}return t.frustumCulled=!1,this.registerTimedObject(Lt.Current,t,e,this.linesCache),t}static getSphere(e,t,i){let s=this.spheresCache.pop();return s||(s=new me(new Aa(1,8,8))),s.scale.set(e,e,e),s.material.wireframe=i,this.registerTimedObject(Lt.Current,s,t,this.spheresCache),s}static getArrowHead(e){let t=this.arrowHeadsCache.pop();return t||(t=new me(new xn(0,.5,1,8))),this.registerTimedObject(Lt.Current,t,e,this.arrowHeadsCache),t}static registerTimedObject(e,t,i,s){const r=this.contextBeforeRenderCallbacks.get(e),o=this.contextPostRenderCallbacks.get(e);if(r){if(e.pre_render_callbacks[e.pre_render_callbacks.length-1]!==r){const a=e.pre_render_callbacks.indexOf(r);a>=0&&e.pre_render_callbacks.splice(a,1),e.pre_render_callbacks.push(r)}}else{const a=()=>{this.onBeforeRender(e,this.timedObjectsBuffer)};this.contextBeforeRenderCallbacks.set(e,a),e.pre_render_callbacks.push(a)}if(o){if(e.post_render_callbacks[e.post_render_callbacks.length-1]!==o){const a=e.post_render_callbacks.indexOf(o);a>=0&&e.post_render_callbacks.splice(a,1),e.post_render_callbacks.push(o)}}else{const a=()=>{this.onPostRender(e,this.timedObjectsBuffer,this.timesBuffer)};this.contextPostRenderCallbacks.set(e,a),e.post_render_callbacks.push(a)}t.traverse(a=>{a.layers.disableAll(),a.layers.enable(2)}),t.renderOrder=999999,t[uT]=s,this.timedObjectsBuffer.push(t),this.timesBuffer.push(Lt.Current.time.realtimeSinceStartup+i),e.scene.add(t)}static onBeforeRender(e,t){this.tmuiNeedsUpdate&&bf.update();for(let i=0;i<t.length;i++){const s=t[i];if(e.mainCamera&&s instanceof bf.MeshUIBaseElement){if(_p(s))continue;const r=e.isInVR,o=!1,a=!r;_3(s,e.mainCamera,o,a)}}}static onPostRender(e,t,i){const s=e.time.realtimeSinceStartup;for(let r=t.length-1;r>=0;r--){const o=t[r];s>i[r]&&(t.splice(r,1),i.splice(r,1),o.removeFromParent(),_p(o)!=!0&&o[uT].push(o))}}}u(Dn,"familyName","needle-gizmos"),u(Dn,"linesCache",[]),u(Dn,"spheresCache",[]),u(Dn,"boxesCache",[]),u(Dn,"arrowHeadsCache",[]),u(Dn,"textLabelCache",[]),u(Dn,"timedObjectsBuffer",new Array),u(Dn,"timesBuffer",new Array),u(Dn,"contextPostRenderCallbacks",new Map),u(Dn,"contextBeforeRenderCallbacks",new Map),u(Dn,"tmuiNeedsUpdate",!1);const CZ=re("debugphysics"),ND=new Ar;class pa{constructor(){u(this,"ray");u(this,"cam");u(this,"screenPoint");u(this,"raycaster");u(this,"results");u(this,"targets");u(this,"recursive",!0);u(this,"minDistance");u(this,"maxDistance");u(this,"lineThreshold");u(this,"layerMask");u(this,"ignore");u(this,"testObject")}screenPointFromOffset(e,t){this.screenPoint===void 0&&(this.screenPoint=new ie),this.screenPoint.x=e/window.innerWidth*2-1,this.screenPoint.y=-(t/window.innerHeight)*2+1}setLayer(e){ND.set(e),this.layerMask=ND}setMask(e){this.layerMask||(this.layerMask=new Ar);const t=this.layerMask;t?t.mask=e:this.layerMask=e}}u(pa,"AllLayers",4294967295);class EZ{constructor(e,t,i){u(this,"distance");u(this,"point");u(this,"object");this.object=e,this.distance=t,this.point=i}}class TZ{constructor(e){u(this,"context");u(this,"engine");u(this,"raycaster",new Pp);u(this,"defaultRaycastOptions",new pa);u(this,"targetBuffer",new Array(1));u(this,"defaultThresholds",{Mesh:{},Line:{threshold:-1},LOD:{},Points:{threshold:0},Sprite:{}});u(this,"sphereResults",new Array);u(this,"sphereMask",new Ar);u(this,"tempBoundingBox",new Mi);this.context=e}raycastPhysicsFast(e,t=void 0,i=1/0,s=!0){var r;return((r=this.context.physics.engine)==null?void 0:r.raycast(e,t,i,s))??null}raycastPhysicsFastAndGetNormal(e,t=void 0,i=1/0,s=!0){var r;return((r=this.context.physics.engine)==null?void 0:r.raycastAndGetNormal(e,t,i,s))??null}sphereOverlapPhysics(e,t){var i;return((i=this.context.physics.engine)==null?void 0:i.sphereOverlap(e,t))??null}sphereOverlap(e,t,i=!0){if(this.sphereResults.length=0,!this.context.scene)return this.sphereResults;const s=new Mn(e,t),r=this.sphereMask;r.enableAll(),r.disable(2);for(const o of this.context.scene.children)this.onSphereOverlap(o,s,r,this.sphereResults,i);return this.sphereResults.sort((o,a)=>o.distance-a.distance)}onSphereOverlap(e,t,i,s,r){if(e.type==="Mesh"&&e.layers.test(i)&&!kt.isGizmo(e)){const o=e,a=o.geometry;if(a&&(a.boundingBox||a.computeBoundingBox(),a.boundingBox)){o.matrixWorldNeedsUpdate&&o.updateMatrixWorld();const c=this.tempBoundingBox.copy(a.boundingBox).applyMatrix4(o.matrixWorld);if(t.intersectsBox(c)){const l=Ht(e),h=l.distanceTo(t.center),d=new EZ(e,h,l);if(s.push(d),!r)return}}}if(e.children)for(const o of e.children){const a=s.length;if(this.onSphereOverlap(o,t,i,s,r),a!=s.length&&!r)return}}raycastFromRay(e,t=null){const i=t??this.defaultRaycastOptions;i.ray=e;const s=this.raycast(i);return i===this.defaultRaycastOptions&&(i.ray=void 0),s}raycast(e=null){e||(e=this.defaultRaycastOptions);const t=e.screenPoint??this.context.input.mousePositionRC,i=e.raycaster??this.raycaster;if(i.near=e.minDistance??0,i.far=e.maxDistance??1/0,i.params=this.defaultThresholds,e.lineThreshold===void 0&&(e.lineThreshold=-1),i.params.Line={threshold:e.lineThreshold},e.ray)i.ray.copy(e.ray);else{const a=e.cam??this.context.mainCamera;if(!a)return CZ&&console.error("Can not perform raycast - no main camera found"),this.defaultRaycastOptions.results&&(this.defaultRaycastOptions.results.length=0),this.defaultRaycastOptions.results??[];i.setFromCamera(t,a)}let s=e.targets;s||(s=this.targetBuffer,s.length=1,s[0]=this.context.scene);let r=e.results;this.defaultRaycastOptions.results&&(this.defaultRaycastOptions.results.length=0),r||(this.defaultRaycastOptions.results||(this.defaultRaycastOptions.results=new Array),r=this.defaultRaycastOptions.results),e.layerMask!==void 0?e.layerMask instanceof Ar?i.layers.mask=e.layerMask.mask:i.layers.mask=e.layerMask:(i.layers.enableAll(),i.layers.disable(2)),r.length=0,this.intersect(this.raycaster,s,r,e),r.sort((a,c)=>a.distance-c.distance);const o=e.ignore;return o!==void 0&&o.length>0&&(r=r.filter(a=>!o.includes(a.object))),r}intersect(e,t,i,s){var r;for(const o of t){if(o.visible===!1||kt.isGizmo(o)||s.lineThreshold!==void 0&&s.lineThreshold<0&&o instanceof Sn)continue;const a=(r=s.testObject)==null?void 0:r.call(s,o);if(a===!1)continue;a!=="continue in children"&&e.intersectObject(o,!1,i),s.recursive!==!1&&this.intersect(e,o.children,i,s)}return i}}const MZ=re("debugplayerview");var gl;(function(n){n.Browser="browser",n.Headset="headset",n.Handheld="handheld"})(gl||(gl={}));class IZ{constructor(e,t){u(this,"userId");u(this,"context");u(this,"viewDevice",gl.Browser);u(this,"removed",!1);u(this,"_object");this.userId=e,this.context=t}get currentObject(){return this._object}set currentObject(e){this._object=e}get isConnected(){return this.context.connection.userIsInRoom(this.userId)}}class RZ{constructor(e){u(this,"context");u(this,"playerViews",new Map);this.context=e}setPlayerView(e,t,i){let s=this.playerViews.get(e);s||(s=new IZ(e,this.context),this.playerViews.set(e,s)),s.viewDevice=i,s.currentObject=t,s.removed=!1}getPlayerView(e){if(!e)return;if(!this.context.connection.userIsInRoom(e)){this.playerViews.delete(e);return}return this.playerViews.get(e)}removePlayerView(e,t){const i=this.playerViews.get(e);(i==null?void 0:i.viewDevice)===t&&(MZ&&console.log("REMOVE",e),i.removed=!0,this.playerViews.delete(e))}}new Hn;const $A=new Uint8Array(4);$A[0]=255;$A[1]=255;$A[2]=255;$A[3]=255;const PZ=new io($A,1,1,xi);function M3(n,e=1){const t="alpha"in n,i=e*e,s=new Uint8Array(4*i),r=Math.floor(n.r*255),o=Math.floor(n.g*255),a=Math.floor(n.b*255);for(let l=0;l<i;l++){const h=l*4;s[h+0]=r,s[h+1]=o,s[h+2]=a,t?s[h+3]=Math.floor(n.alpha*255):s[h+3]=255}const c=new io(s,e,e);return c.needsUpdate=!0,c}function BZ(n,e,t,i=1,s=3){const o=i*s,a=[n,e,t],c=a.length,l=new Uint8Array(4*c*o),h=new ye;for(let f=0;f<s;f++){const p=Math.floor(f/s*c),m=nt.clamp(p+1,0,c-1),g=a[p],y=a[m],A=f/s*c%1;h.lerpColors(g,y,A);const v=Math.floor(h.r*255),b=Math.floor(h.g*255),_=Math.floor(h.b*255);for(let T=0;T<i;T++){const E=(f*i+T)*4;l[E+0]=v,l[E+1]=b,l[E+2]=_,l[E+3]=255}}const d=new io(l,i,s);return d.needsUpdate=!0,d}var zD;(function(n){n[n.Vertex=0]="Vertex",n[n.Fragment=1]="Fragment"})(zD||(zD={}));function Db(n,e){const t=n.elements;e||(e=[]),e.length=0;for(let i=0;i<16;i+=4){const s=t[i],r=t[i+1],o=t[i+2],a=t[i+3],c=new tt(s,r,o,a);e.push(c)}return e}const zS=[],GD=[];function DZ(n,e){if(zS.length===0)for(let t=0;t<27;t++)zS.push(0);e||(e=zS);for(let t=0;t<27;t++)GD[t]=e[t];e=GD,n.unity_SHAr={value:new tt(e[9],e[3],e[6],e[0])},n.unity_SHBr={value:new tt(e[12],e[15],e[18],e[21])},n.unity_SHAg={value:new tt(e[10],e[4],e[7],e[1])},n.unity_SHBg={value:new tt(e[13],e[16],e[19],e[22])},n.unity_SHAb={value:new tt(e[11],e[5],e[8],e[2])},n.unity_SHBb={value:new tt(e[14],e[17],e[20],e[23])},n.unity_SHC={value:new tt(e[24],e[25],e[26],1)}}class OZ{constructor(e,t,i){u(this,"vertexShader");u(this,"fragmentShader");u(this,"technique");this.vertexShader=e,this.fragmentShader=t,this.technique=i}}async function kZ(n,e){if(!n)return console.error("Can not find technique: no shader data"),null;const t=n.programs[e],i=t.vertexShader,s=t.fragmentShader;if(i!==void 0&&s!==void 0){const r=n.shaders[i],o=n.shaders[s];if(r.uri&&o.uri||r.code&&o.code){if(!r.code&&r.uri&&await VD(r),!o.code&&o.uri&&await VD(o),!r.code||!o.code)return null;const a=n.techniques[e];return new OZ(r.code,o.code,a)}}return console.error("Shader technique not found",e),null}async function VD(n){const e=n.uri;if(e)if(e.endsWith(".glsl")){const i=await new Hn().loadAsync(e);n.code=i.toString()}else n.code=LZ(n.uri)}function LZ(n){return decodeURIComponent(Array.prototype.map.call(atob(n),function(e){return"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)}).join(""))}const Yo=re("debugenvlight");var Ja;(function(n){n[n.Skybox=0]="Skybox",n[n.Trilight=1]="Trilight",n[n.Flat=3]="Flat",n[n.Custom=4]="Custom"})(Ja||(Ja={}));var bA;(function(n){n[n.Skybox=0]="Skybox",n[n.Custom=1]="Custom"})(bA||(bA={}));class FZ{constructor(e){u(this,"context");u(this,"_currentLightSettingsId");u(this,"_sceneLightSettings");u(this,"_timevec4",new tt);u(this,"__currentReflectionId",null);u(this,"_lighting",{});this.context=e,this.context.pre_update_callbacks.push(this.preUpdate.bind(this))}preUpdate(){const e=this.context.time;this._timevec4.x=e.time,this._timevec4.y=Math.sin(e.time),this._timevec4.z=Math.cos(e.time),this._timevec4.w=e.deltaTime}get timeVec4(){return this._timevec4}get environmentIntensity(){if(!this._sceneLightSettings||!this._currentLightSettingsId)return 1;const e=this._sceneLightSettings.get(this._currentLightSettingsId);return e?e.ambientIntensity:1}get sceneLightSettings(){var e;return(e=this._sceneLightSettings)==null?void 0:e.values()}enable(e){var i;e instanceof ii&&(e=e.uri);const t=(i=this._sceneLightSettings)==null?void 0:i.get(e);return t?(Yo&&console.log("Enable scene light settings",e,t),e!==this._currentLightSettingsId&&this._currentLightSettingsId&&this.disable(this._currentLightSettingsId),this._currentLightSettingsId=e,t.enabled=!0,!0):(Yo&&console.warn("No light settings found for",e),!1)}disable(e){var i;if(e instanceof ii&&(e=e.uri),e==null)return!1;const t=(i=this._sceneLightSettings)==null?void 0:i.get(e);return t?(Yo&&console.log("Disable scene light settings",e,t),t.enabled=!1,!0):!1}disableCurrent(){if(this._currentLightSettingsId){const e=this._currentLightSettingsId;return this.disable(this._currentLightSettingsId),e}return null}internalRegisterSceneLightSettings(e){const t=e.sourceId;if(!t){console.error("Missing source id for scene light settings, can not register:",e);return}Yo&&console.log("Register "+(e==null?void 0:e.sourceId)+" lighting",e),this._sceneLightSettings||(this._sceneLightSettings=new Map),this._sceneLightSettings.set(t,e)}internalUnregisterSceneLightSettings(e){const t=e.sourceId;if(!t){console.error("Missing source id for scene light settings, can not unregister:",e);return}Yo&&console.log("Unregister "+(e==null?void 0:e.sourceId)+" lighting",e),this._sceneLightSettings&&this._sceneLightSettings.delete(t)}internalRegisterReflection(e,t){Yo&&console.log("Register reflection",e,t);const i=new UZ(this.context,t,1);this._lighting[e]=i}internalGetReflection(e){return this._lighting[e]}internalEnableReflection(e){var i;this.__currentReflectionId=e;const t=(i=this._sceneLightSettings)==null?void 0:i.get(e);switch(Yo&&console.log("Enable reflection",e,t?Ja[t.ambientMode]:"Unknown ambient mode"),t==null?void 0:t.ambientMode){case Ja.Skybox:case Ja.Custom:const s=this.internalGetReflection(e);if(s&&s.Source){Yo&&console.log("Setting environment reflection",s);const r=this.context.scene,o=s.Source;o.colorSpace=zt,o.mapping=Oo,r.environment=o;return}else Yo&&console.warn("Could not find reflection for source",e);break}if((t==null?void 0:t.environmentReflectionSource)===bA.Custom)switch(t==null?void 0:t.ambientMode){case Ja.Trilight:if(t.ambientTrilight){const s=t.ambientTrilight,r=BZ(s[0],s[1],s[2],64,64);r.colorSpace=zt,r.mapping=Oo,this.context.scene.environment=r}else console.error("Missing ambient trilight",t.sourceId);return;case Ja.Flat:if(t.ambientLight){const s=M3(t.ambientLight,64);s.colorSpace=zt,s.mapping=Oo,this.context.scene.environment=s}else console.error("Missing ambientlight",t.sourceId);return;default:return}}internalDisableReflection(e){if(e&&e!==this.__currentReflectionId){Yo&&console.log("Not disabling reflection for",e,"because it is not the current light settings id",this.__currentReflectionId);return}Yo&&console.log("Disable reflection",e);const t=this.context.scene;t.environment=null}}class UZ{constructor(e,t,i=1){u(this,"_context");u(this,"_source");u(this,"_sphericalHarmonics",null);u(this,"_sphericalHarmonicsArray");u(this,"_ambientScale",1);u(this,"_lightProbe");this._context=e,this._source=t,this._ambientScale=i,t.mapping=Oo,t.colorSpace=zt}get Source(){return this._source}get Array(){return this._sphericalHarmonicsArray}}const HD=re("timescale");let dT=1;typeof HD=="number"&&(dT=HD);class NZ{constructor(){u(this,"deltaTime",0);u(this,"time",0);u(this,"timeScale",1);u(this,"frame",0);u(this,"clock",new qM);u(this,"_smoothedFps",0);u(this,"_smoothedDeltaTime",0);u(this,"_fpsSamples",[]);u(this,"_fpsSampleIndex",0);typeof dT=="number"&&(this.timeScale=dT)}get realtimeSinceStartup(){return this.clock.elapsedTime}get frameCount(){return this.frame}get smoothedFps(){return this._smoothedFps}get smoothedDeltaTime(){return 1/this._smoothedFps}update(){this.deltaTime=this.clock.getDelta(),this.deltaTime=Math.min(.1,this.deltaTime),this.deltaTime*=this.timeScale,this.deltaTime<=0&&(this.deltaTime=1e-12),this.frame+=1,this.time+=this.deltaTime,this._fpsSamples.length<60?this._fpsSamples.push(this.deltaTime):this._fpsSamples[this._fpsSampleIndex++%60]=this.deltaTime;let e=0;for(let t=0;t<this._fpsSamples.length;t++)e+=this._fpsSamples[t];this._smoothedDeltaTime=e/this._fpsSamples.length,this._smoothedFps=1/this._smoothedDeltaTime}}const Pr=re("debugcontext"),zZ=re("stats"),GZ=re("debugactive"),VZ=re("debugframerate"),HZ=re("debugcoroutine");var jt;(function(n){n[n.Start=-1]="Start",n[n.EarlyUpdate=0]="EarlyUpdate",n[n.Update=1]="Update",n[n.LateUpdate=2]="LateUpdate",n[n.OnBeforeRender=3]="OnBeforeRender",n[n.OnAfterRender=4]="OnAfterRender",n[n.PrePhysicsStep=9]="PrePhysicsStep",n[n.PostPhysicsStep=10]="PostPhysicsStep",n[n.Undefined=-1]="Undefined"})(jt||(jt={}));function tI(n,e){if(!n)return;if(!n.isComponent){(Tt()||Pr)&&console.error(`Registered script is not a Needle Engine component. 
The script will be ignored. Please make sure your component extends "Behaviour" imported from "@needle-tools/engine"
`,n);return}const t=(e==null?void 0:e.new_scripts)??Lt.Current.new_scripts;t.includes(n)||t.push(n)}const Hi=class{constructor(e){u(this,"name");u(this,"alias");u(this,"isManagedExternally",!1);u(this,"isPaused",!1);u(this,"runInBackground",!1);u(this,"targetFrameRate");u(this,"physicsSteps",1);u(this,"hash");u(this,"domElement");u(this,"_resolutionScaleFactor",1);u(this,"_boundingClientRectFrame",-1);u(this,"_boundingClientRect",null);u(this,"_domX");u(this,"_domY");u(this,"xr",null);u(this,"_xrFrame",null);u(this,"_currentFrameEvent",jt.Undefined);u(this,"scene");u(this,"renderer");u(this,"composer",null);u(this,"scripts",[]);u(this,"scripts_pausedChanged",[]);u(this,"scripts_earlyUpdate",[]);u(this,"scripts_update",[]);u(this,"scripts_lateUpdate",[]);u(this,"scripts_onBeforeRender",[]);u(this,"scripts_onAfterRender",[]);u(this,"scripts_WithCorroutines",[]);u(this,"scripts_immersive_vr",[]);u(this,"scripts_immersive_ar",[]);u(this,"coroutines",{});u(this,"post_setup_callbacks",[]);u(this,"pre_update_callbacks",[]);u(this,"pre_render_callbacks",[]);u(this,"post_render_callbacks",[]);u(this,"pre_update_oneshot_callbacks",[]);u(this,"new_scripts",[]);u(this,"new_script_start",[]);u(this,"new_scripts_pre_setup_callbacks",[]);u(this,"new_scripts_post_setup_callbacks",[]);u(this,"new_scripts_xr",[]);u(this,"mainCameraComponent");u(this,"_camera",null);u(this,"application");u(this,"time");u(this,"input");u(this,"physics");u(this,"connection");u(this,"assets");u(this,"mainLight",null);u(this,"sceneLighting");u(this,"addressables");u(this,"lightmaps");u(this,"players");u(this,"_sizeChanged",!1);u(this,"_isCreated",!1);u(this,"_isCreating",!1);u(this,"_isVisible",!1);u(this,"_stats",zZ?new ug:null);u(this,"_intersectionObserver",null);u(this,"_disposeCallbacks",[]);u(this,"_originalCreationArgs");u(this,"onUnhandledRejection",e=>{this.domElement.dispatchEvent(new CustomEvent("error",{detail:e.reason}))});u(this,"_cameraStack",[]);u(this,"_onBeforeRenderListeners",new Map);u(this,"_onAfterRenderListeners",new Map);u(this,"_requireDepthTexture",!1);u(this,"_requireColorTexture",!1);u(this,"_renderTarget");u(this,"_isRendering",!1);u(this,"_createId",0);u(this,"_renderlooperrors",0);u(this,"_lastTimestamp",0);u(this,"_accumulatedTime",0);u(this,"_dispatchReadyAfterFrame",!1);u(this,"_wasPaused",!1);this.name=(e==null?void 0:e.name)||"",this.alias=e==null?void 0:e.alias,this.domElement=(e==null?void 0:e.domElement)||document.body,this.hash=e==null?void 0:e.hash,e!=null&&e.renderer&&(this.renderer=e.renderer,this.isManagedExternally=!0),(e==null?void 0:e.runInBackground)!==void 0&&(this.runInBackground=e.runInBackground),e!=null&&e.scene?this.scene=e.scene:this.scene=new Ws,e!=null&&e.camera&&(this._camera=e.camera),this.application=new Mq(this),this.time=new NZ,this.input=new Rq(this),this.physics=new TZ(this),this.connection=new VX(this),this.assets=new k8,this.sceneLighting=new FZ(this),this.addressables=new Sq(this),this.lightmaps=new Kq(this),this.players=new RZ(this);const t=()=>this._sizeChanged=!0;window.addEventListener("resize",t),this._disposeCallbacks.push(()=>window.removeEventListener("resize",t));const i=new ResizeObserver(s=>this._sizeChanged=!0);i.observe(this.domElement),this._disposeCallbacks.push(()=>i.disconnect()),this._intersectionObserver=new IntersectionObserver(s=>{this._isVisible=s[0].isIntersecting}),this._disposeCallbacks.push(()=>{var s;return(s=this._intersectionObserver)==null?void 0:s.disconnect()}),zi.register(this)}static get DefaultTargetFrameRate(){return Hi._defaultTargetFramerate.value}static set DefaultTargetFrameRate(e){Hi._defaultTargetFramerate.value=e}static get DefaultWebGLRendererParameters(){return Hi._defaultWebglRendererParameters}get version(){return ol}static get Current(){return zi.Current}static set Current(e){zi.Current=e}appendHTMLElement(e){return this.domElement.shadowRoot?this.domElement.shadowRoot.appendChild(e):this.domElement.appendChild(e)}get resolutionScaleFactor(){return this._resolutionScaleFactor}set resolutionScaleFactor(e){if(e!==this._resolutionScaleFactor&&typeof e=="number"){if(e<=0){console.error("Invalid resolution scale factor",e);return}this._resolutionScaleFactor=e,this.updateSize()}}calculateBoundingClientRect(){if(this.isInAR){this._domX=0,this._domY=0;return}this._boundingClientRectFrame!==this.time.frame&&(this._boundingClientRectFrame=this.time.frame,this._boundingClientRect=this.domElement.getBoundingClientRect(),this._domX=this._boundingClientRect.x,this._domY=this._boundingClientRect.y)}get domWidth(){return this.isInAR?window.innerWidth:this.domElement.clientWidth}get domHeight(){return this.isInAR?window.innerHeight:this.domElement.clientHeight}get domX(){return this.calculateBoundingClientRect(),this._domX}get domY(){return this.calculateBoundingClientRect(),this._domY}get isInXR(){var e,t;return((t=(e=this.renderer)==null?void 0:e.xr)==null?void 0:t.isPresenting)||!1}get xrSessionMode(){var e;return(e=this.xr)==null?void 0:e.mode}get isInVR(){return this.xrSessionMode==="immersive-vr"}get isInAR(){return this.xrSessionMode==="immersive-ar"}get isInPassThrough(){return this.xr?this.xr.isPassThrough:!1}get xrSession(){var e,t;return(t=(e=this.renderer)==null?void 0:e.xr)==null?void 0:t.getSession()}get xrFrame(){return this._xrFrame}get xrCamera(){var e,t;return(t=(e=this.renderer)==null?void 0:e.xr)==null?void 0:t.getCamera()}get arOverlayElement(){const e=this.domElement;return typeof e.getAROverlayContainer=="function"?e.getAROverlayContainer():this.domElement}get currentFrameEvent(){return this._currentFrameEvent}get mainCamera(){if(this._camera)return this._camera;if(this.mainCameraComponent){const e=this.mainCameraComponent;return e.cam||e.buildCamera(),e.cam}return null}set mainCamera(e){this._camera=e}get rendererData(){return this.sceneLighting}get isCreated(){return this._isCreated}createNewRenderer(e){var t,i,s;if((t=this.renderer)==null||t.dispose(),e={...Hi.DefaultWebGLRendererParameters,...e},!e.canvas){const r=(s=(i=this.domElement)==null?void 0:i.shadowRoot)==null?void 0:s.querySelector("canvas");r&&(e.canvas=r,Pr&&console.log("Using canvas from shadow root",r))}Pr&&console.log("Using Renderer Parameters:",e,this.domElement),this.renderer=new Rl(e),this.renderer.debug.checkShaderErrors=Tt()||re("checkshadererrors")===!0,this.renderer.toneMappingExposure=1,this.renderer.toneMapping=Fr,this.renderer.setClearColor(new ye("lightgrey"),0),this.renderer.shadowMap.enabled=!0,this.renderer.shadowMap.type=iM,this.renderer.setSize(this.domWidth,this.domHeight),this.renderer.outputColorSpace=zt,this.renderer.useLegacyLights=!1,this.input.bindEvents()}internalOnUpdateVisible(){var e,t;(e=this._intersectionObserver)==null||e.disconnect(),(t=this._intersectionObserver)==null||t.observe(this.domElement)}requestSizeUpdate(){this._sizeChanged=!0}updateSize(e=!1){var t,i,s;if(e||!this.isManagedExternally&&((t=this.renderer.xr)==null?void 0:t.isPresenting)===!1){this._sizeChanged=!1;const r=this.resolutionScaleFactor,o=this.domWidth*r,a=this.domHeight*r,c=this.mainCamera;this.updateAspect(c),this.renderer.setSize(o,a,!0),this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.domElement.style.width="100%",this.renderer.domElement.style.height="100%",this.composer&&((i=this.composer.setSize)==null||i.call(this.composer,o,a),"setPixelRatio"in this.composer&&typeof this.composer.setPixelRatio=="function"&&((s=this.composer.setPixelRatio)==null||s.call(this.composer,window.devicePixelRatio)))}}updateAspect(e,t,i){if(!e)return;t===void 0&&(t=this.domWidth),i===void 0&&(i=this.domHeight);const s=e.aspect;e.aspect=t/i,s!==e.aspect&&e.updateProjectionMatrix()}recreate(){this.clear(),this.create(this._originalCreationArgs)}async onCreate(e){return this.create(e)}async create(e){try{this._isCreating=!0,e!==this._originalCreationArgs&&(this._originalCreationArgs=tx(e)),window.addEventListener("unhandledrejection",this.onUnhandledRejection);const t=await this.internalOnCreate(e);return this._isCreated=!0,t}finally{window.removeEventListener("unhandledrejection",this.onUnhandledRejection),this._isCreating=!1}}clear(){var e,t,i,s;zi.dispatchCallback(Cn.ContextClearing,this),gc(this.scene,!0,!0),this.scene=new Ws,(e=this.addressables)==null||e.dispose(),(t=this.lightmaps)==null||t.clear(),(s=(i=this.physics)==null?void 0:i.engine)==null||s.clearCaches(),this.isManagedExternally||this.renderer&&(this.renderer.renderLists.dispose(),this.renderer.state.reset(),this.renderer.resetState()),zi.dispatchCallback(Cn.ContextCleared,this)}dispose(){this.internalOnDestroy()}onDestroy(){this.internalOnDestroy()}internalOnDestroy(){var e,t;this.clear(),(e=this.renderer)==null||e.setAnimationLoop(null),this.renderer&&(this.renderer.setClearAlpha(0),this.renderer.clear(),this.isManagedExternally||(Pr&&console.log("Disposing renderer"),this.renderer.dispose())),this.scene=null,this.renderer=null,this.input.dispose();for(const i of this._disposeCallbacks)try{i()}catch(s){console.error("Error in on dispose callback:",s,i)}(t=this.domElement)!=null&&t.parentElement&&this.domElement.parentElement.removeChild(this.domElement),this._isCreated=!1,zi.dispatchCallback(Cn.ContextDestroyed,this),zi.unregister(this),Hi.Current===this&&(Hi.Current=null)}registerCoroutineUpdate(e,t,i){return typeof(t==null?void 0:t.next)!="function"?(console.error("Registered invalid coroutine function from "+e.name+`
Coroutine functions must be generators: "*myCoroutine() {...}"
Start a coroutine from a component by calling "this.startCoroutine(myCoroutine())"`),t):(this.coroutines[i]||(this.coroutines[i]=[]),this.coroutines[i].push({comp:e,main:t}),t)}unregisterCoroutineUpdate(e,t){if(!this.coroutines[t])return;const i=this.coroutines[t].findIndex(s=>s.main===e);i>=0&&this.coroutines[t].splice(i,1)}stopAllCoroutinesFrom(e){for(const t in this.coroutines){const i=this.coroutines[t];for(let s=i.length-1;s>=0;s--)i[s].comp===e&&i.splice(s,1)}}setCurrentCamera(e){var s;if(!e)return;if(e.cam||e.buildCamera(),!e.cam){console.warn("Camera component is missing camera",e);return}const t=this._cameraStack.indexOf(e);t>=0&&this._cameraStack.splice(t,1),this._cameraStack.push(e),this.mainCameraComponent=e;const i=e.cam;i.isPerspectiveCamera&&this.updateAspect(i),(s=this.mainCameraComponent)==null||s.applyClearFlagsIfIsActiveCamera()}removeCamera(e){if(!e)return;const t=this._cameraStack.indexOf(e);if(t>=0&&this._cameraStack.splice(t,1),this.mainCameraComponent===e&&(this.mainCameraComponent=void 0,this._cameraStack.length>0)){const i=this._cameraStack[this._cameraStack.length-1];this.setCurrentCamera(i)}}addBeforeRenderListener(e,t){this._onBeforeRenderListeners.has(e.uuid)||(this._onBeforeRenderListeners.set(e.uuid,[]),e.onBeforeRender=this._createRenderCallbackWrapper(e,this._onBeforeRenderListeners)),this._onBeforeRenderListeners.get(e.uuid).push(t)}removeBeforeRenderListener(e,t){if(this._onBeforeRenderListeners.has(e.uuid)){const i=this._onBeforeRenderListeners.get(e.uuid),s=i.indexOf(t);s>=0&&i.splice(s,1)}}addAfterRenderListener(e,t){var i;this._onAfterRenderListeners.has(e.uuid)||(this._onAfterRenderListeners.set(e.uuid,[]),e.onAfterRender=this._createRenderCallbackWrapper(e,this._onAfterRenderListeners)),(i=this._onAfterRenderListeners.get(e.uuid))==null||i.push(t)}removeAfterRenderListener(e,t){if(this._onAfterRenderListeners.has(e.uuid)){const i=this._onAfterRenderListeners.get(e.uuid),s=i.indexOf(t);s>=0&&i.splice(s,1)}}_createRenderCallbackWrapper(e,t){return(i,s,r,o,a,c)=>{const l=t.get(e.uuid);if(l)for(let h=0;h<l.length;h++){const d=l[h];d(i,s,r,o,a,c)}}}get isRendering(){return this._isRendering}setRequireDepth(e){this._requireDepthTexture=e}setRequireColor(e){this._requireColorTexture=e}get depthTexture(){var e;return((e=this._renderTarget)==null?void 0:e.depthTexture)||null}get opaqueColorTexture(){var e;return((e=this._renderTarget)==null?void 0:e.texture)||null}get isVisibleToUser(){if(this.isInXR)return!0;if(!this._isVisible)return!1;const e=getComputedStyle(this.domElement);return e.visibility!=="hidden"&&e.display!=="none"&&e.opacity!=="0"}async internalOnCreate(e){var o,a,c,l,h;const t=++this._createId;Pr&&console.log("Creating context",this.name,e),this.clear(),this.isManagedExternally===!1&&(this.createNewRenderer(),(o=this.renderer)==null||o.setAnimationLoop(null)),await ha(1),Hi.Current=this,await zi.dispatchCallback(Cn.ContextCreationStart,this);let i=!0,s;try{Hi.Current=this,e?s=await this.internalLoadInitialContent(t,e):s=[]}catch(d){console.error(d),i=!1}if(!i||t!==this._createId)return!1;if(this.internalOnUpdateVisible(),!this.renderer)return Pr&&console.warn("Context has no renderer (perhaps it was disconnected?",this.domElement.isConnected),!1;!this.isManagedExternally&&!this.domElement.shadowRoot&&this.domElement.prepend(this.renderer.domElement),Hi.Current=this,Hi.Current=this;for(let d=0;d<this.new_scripts.length;d++){const f=this.new_scripts[d];if(f.gameObject!==void 0&&f.gameObject!==null){f.gameObject.userData===void 0&&(f.gameObject.userData={}),f.gameObject.userData.components===void 0&&(f.gameObject.userData.components=[]);const p=f.gameObject.userData.components;p.includes(f)||p.push(f)}}if(this.post_setup_callbacks)for(let d=0;d<this.post_setup_callbacks.length;d++)Hi.Current=this,await this.post_setup_callbacks[d](this);if(!this.mainCamera){Hi.Current=this;let d=null;kb(this.scene,f=>{const p=f;if(p!=null&&p.isCamera){if(lg(p.gameObject),!p.activeAndEnabled)return;if(p.tag==="MainCamera")return d=p,!0;d=p}}),d?this.setCurrentCamera(d):!zi.dispatchCallback(Cn.MissingCamera,this,{files:s})&&!this.mainCamera&&!this.isManagedExternally&&console.warn("Missing camera in main scene",this)}if(this.input.bindEvents(),Hi.Current=this,gb(this),this.physics.engine&&((a=this.physics.engine)==null||a.step(0),(c=this.physics.engine)==null||c.postStep()),!this.isManagedExternally&&this.composer&&this.mainCamera){const d=new ax(this.scene,this.mainCamera);this.renderer.setSize(this.domWidth,this.domHeight),this.composer.addPass(d),this.composer.setSize(this.domWidth,this.domHeight)}this._sizeChanged=!0,this._stats&&(this._stats.showPanel(0),(l=this.domElement.shadowRoot)==null||l.appendChild(this._stats.dom)),Pr&&hT(this.scene,!0),this.targetFrameRate===void 0?(Pr&&console.warn("No target framerate set, using default",Hi.DefaultTargetFrameRate),this.targetFrameRate=Hi._defaultTargetFramerate):Pr&&console.log("Target framerate set to",this.targetFrameRate),this._dispatchReadyAfterFrame=!0;const r=zi.dispatchCallback(Cn.ContextCreated,this,{files:s});return r&&("internalSetLoadingMessage"in this.domElement&&typeof this.domElement.internalSetLoadingMessage=="function"&&((h=this.domElement)==null||h.internalSetLoadingMessage("finish loading")),await r),gu(this,Cn.ContextCreated),Pr&&console.log("Context Created...",this.renderer,this.renderer.domElement),this._isCreating=!1,this.isManagedExternally||this.restartRenderLoop(),r}async internalLoadInitialContent(e,t){var c,l;const i=new Array;if(t.files.length===0)return i;const s=[...t.files],r={name:"",progress:null,index:0,count:s.length},o=mc(),a=0;for(let h=0;h<s.length;h++){if(e!==this._createId){Pr&&console.log("Aborting loading because create id changed",e,this._createId);break}const d=s[h];if(!d.includes(".glb")&&!d.includes(".gltf")){const p=`Needle Engine: found suspicious src "${d}"`;console.warn(p),zr()&&gn(p)}(c=t==null?void 0:t.onLoadingStart)==null||c.call(this,h,d),Pr&&console.log("Context Load "+d);const f=await o.loadSync(this,d,d,a,p=>{var m;r.name=d,r.progress=p,r.index=h,r.count=s.length,(m=t.onLoadingProgress)==null||m.call(this,r)});(l=t==null?void 0:t.onLoadingFinished)==null||l.call(this,h,d,f??null),f?i.push({src:d,file:f}):console.warn("Could not load file: "+d)}if(e!==this._createId){for(const h of i)if(h&&h.file)for(const d of h.file.scenes)gc(d,!0,!0)}else for(const h of i)h&&h.file&&this.scene.add(h.file.scene);return i}restartRenderLoop(){return this.renderer?this._isCreating?(console.warn("Can not start render loop while creating context"),!1):(this.renderer.setAnimationLoop((e,t)=>{this.isManagedExternally||this.update(e,t)}),!0):(console.error("Can not start render loop without renderer"),!1)}update(e,t){if(t===void 0&&(t=null),Tt()||Pr||H8())try{this.internalStep(e,t),this._renderlooperrors=0}catch(i){this._renderlooperrors+=1,(Tt()||Pr)&&(i instanceof Error||i instanceof TypeError)&&Tn("Caught unhandled exception during render-loop - see console for details.",rs.Error),console.error("Frame #"+this.time.frame+`
`,i),this._renderlooperrors>=3&&(console.warn("Stopping render loop due to error"),this.renderer.setAnimationLoop(null)),this.domElement.dispatchEvent(new CustomEvent("error",{detail:i}))}else this.internalStep(e,t)}updatePhysics(e){this.internalUpdatePhysics(e)}internalStep(e,t){this.internalOnBeforeRender(e,t)!==!1&&(this.internalOnRender(),this.internalOnAfterRender())}internalOnBeforeRender(e,t){var s;const i=t!==null&&this._xrFrame===null;if(this._xrFrame=t,i&&this.domElement.dispatchEvent(new CustomEvent("xr-session-started",{detail:{context:this,session:this.xrSession,frame:t}})),this._currentFrameEvent=jt.Undefined,this.isManagedExternally===!1&&this.isInXR===!1&&this.targetFrameRate!==void 0){this._lastTimestamp===0&&(this._lastTimestamp=e),this._accumulatedTime+=(e-this._lastTimestamp)/1e3,this._lastTimestamp=e;let r=this.targetFrameRate;if(typeof r=="object"&&(r=r.value),this._accumulatedTime<1/(r+1))return!1;this._accumulatedTime=0}if((s=this._stats)==null||s.begin(),Hi.Current=this,this.onHandlePaused())return!1;for(Hi.Current=this,this.time.update(),VZ&&console.log("FPS",this.time.smoothedFps.toFixed(0)),gb(this),C0(this.scene),SF(this),gu(this,jt.Start);this._cameraStack.length>0&&(!this.mainCameraComponent||this.mainCameraComponent.destroyed);){this._cameraStack.splice(this._cameraStack.length-1,1);const r=this._cameraStack[this._cameraStack.length-1];this.setCurrentCamera(r)}if(this.pre_update_oneshot_callbacks){for(const r in this.pre_update_oneshot_callbacks)this.pre_update_oneshot_callbacks[r]();this.pre_update_oneshot_callbacks.length=0}if(this.pre_update_callbacks)for(const r in this.pre_update_callbacks)this.pre_update_callbacks[r]();this._currentFrameEvent=jt.EarlyUpdate;for(let r=0;r<this.scripts_earlyUpdate.length;r++){const o=this.scripts_earlyUpdate[r];o.activeAndEnabled&&o.earlyUpdate!==void 0&&(Hi.Current=this,o.earlyUpdate())}if(this.executeCoroutines(jt.EarlyUpdate),gu(this,jt.EarlyUpdate),this.onHandlePaused())return!1;this._currentFrameEvent=jt.Update;for(let r=0;r<this.scripts_update.length;r++){const o=this.scripts_update[r];o.activeAndEnabled&&o.update!==void 0&&(Hi.Current=this,o.update())}if(this.executeCoroutines(jt.Update),gu(this,jt.Update),this.onHandlePaused())return!1;this._currentFrameEvent=jt.LateUpdate;for(let r=0;r<this.scripts_lateUpdate.length;r++){const o=this.scripts_lateUpdate[r];o.activeAndEnabled&&o.lateUpdate!==void 0&&(Hi.Current=this,o.lateUpdate())}if(this.executeCoroutines(jt.LateUpdate),gu(this,jt.LateUpdate),this.onHandlePaused()||(this.physicsSteps===void 0&&(this.physicsSteps=1),this.physics.engine&&this.physicsSteps>0&&this.internalUpdatePhysics(this.physicsSteps),this.onHandlePaused()))return!1;if(this.isVisibleToUser||this.runInBackground){this._currentFrameEvent=jt.OnBeforeRender;for(let r=0;r<this.scripts_onBeforeRender.length;r++){const o=this.scripts_onBeforeRender[r];o.activeAndEnabled&&o.onBeforeRender!==void 0&&(Hi.Current=this,o.onBeforeRender(t))}if(this.executeCoroutines(jt.OnBeforeRender),gu(this,jt.OnBeforeRender),this._sizeChanged&&this.updateSize(),this.pre_render_callbacks)for(const r in this.pre_render_callbacks)this.pre_render_callbacks[r](t)}return!0}internalUpdatePhysics(e){if(!this.physics.engine)return!1;const t=e,i=this.time.deltaTime/t;for(let s=0;s<t;s++)this._currentFrameEvent=jt.PrePhysicsStep,this.executeCoroutines(jt.PrePhysicsStep),this.physics.engine.step(i),this._currentFrameEvent=jt.PostPhysicsStep,this.executeCoroutines(jt.PostPhysicsStep);return this.physics.engine.postStep(),!0}internalOnRender(){this.isManagedExternally||(W8(this),this._currentFrameEvent=jt.Undefined,this.renderNow(),this._currentFrameEvent=jt.OnAfterRender)}internalOnAfterRender(){if(this.isVisibleToUser||this.runInBackground){for(let e=0;e<this.scripts_onAfterRender.length;e++){const t=this.scripts_onAfterRender[e];t.activeAndEnabled&&t.onAfterRender!==void 0&&(Hi.Current=this,t.onAfterRender())}if(this.executeCoroutines(jt.OnAfterRender),gu(this,jt.OnAfterRender),this.post_render_callbacks)for(const e in this.post_render_callbacks)this.post_render_callbacks[e]()}this._currentFrameEvent=-1,this.connection.sendBufferedMessagesNow(),this._stats&&(this._stats.end(),this.time.frameCount%150===0&&console.log(this.renderer.info.render.calls+" DrawCalls",`
Render:`,{...this.renderer.info.render},`
Memory:`,{...this.renderer.info.memory})),this._dispatchReadyAfterFrame&&(this._dispatchReadyAfterFrame=!1,this.domElement.dispatchEvent(new CustomEvent("ready")),zi.dispatchCallback(Cn.ContextFirstFrameRendered,this))}renderNow(e){return!e&&(e=this.mainCamera,!e)?!1:(this._isRendering=!0,this.renderRequiredTextures(),this.composer&&!this.isInXR?this.composer.render(this.time.deltaTime):e&&this.renderer.render(this.scene,e),this._isRendering=!1,!0)}onHandlePaused(){const e=this.evaluatePaused();if(this._wasPaused!==e){GZ&&console.log("Paused?",e,"context:"+this.alias);for(let t=0;t<this.scripts_pausedChanged.length;t++){const i=this.scripts_pausedChanged[t];i.activeAndEnabled&&i.onPausedChanged!==void 0&&(Hi.Current=this,i.onPausedChanged(e,this._wasPaused))}}return this._wasPaused=e,e}evaluatePaused(){return this.isInXR?!1:this.isPaused?!0:this.runInBackground?!1:!this.isVisibleToUser}renderRequiredTextures(){if(!this.mainCamera||!this._requireDepthTexture&&!this._requireColorTexture)return;if(!this._renderTarget){if(this._renderTarget=new Zt(this.domWidth,this.domHeight),this._requireDepthTexture){const i=new Tp(this.domWidth,this.domHeight);this._renderTarget.depthTexture=i}this._requireColorTexture&&(this._renderTarget.texture=new Ft,this._renderTarget.texture.generateMipmaps=!1,this._renderTarget.texture.minFilter=Nt,this._renderTarget.texture.magFilter=Nt,this._renderTarget.texture.format=xi)}const e=this._renderTarget;e.texture&&(e.texture.colorSpace=this.renderer.outputColorSpace);const t=this.renderer.getRenderTarget();this.renderer.setRenderTarget(e),this.renderer.render(this.scene,this.mainCamera),this.renderer.setRenderTarget(t)}executeCoroutines(e){var i;if(this.coroutines[e]){const s=this.coroutines[e];for(let r=0;r<s.length;r++)try{const o=s[r];if(!o.comp||o.comp.destroyed||!o.main||o.comp.enabled===!1){HZ&&console.log("Removing coroutine",o.comp,o.comp.enabled),s.splice(r,1),--r;continue}const c=o.chained;if(c&&c.length>0){const f=c[c.length-1].next();if(f.done&&c.pop(),t(f)&&(o.chained||(o.chained=[]),o.chained.push(f.value)),!f.done)continue}const l=o.main.next();if(l.done===!0){s.splice(r,1),--r;continue}const h=l.value;if(t(h)){if(h.next().done)continue;o.chained||(o.chained=[]),o.chained.push(h)}else if(h instanceof Promise){const d=h;o.chained||(o.chained=[]);const f=Iq(d);(i=o.chained)==null||i.push(f);continue}}catch(o){console.error(o)}}function t(s){return!!(s&&s.next&&s.return)}}};let Lt=Hi;u(Lt,"_defaultTargetFramerate",{value:60}),u(Lt,"_defaultWebglRendererParameters",{antialias:!0,alpha:!1});zi.registerCallback(Cn.ContextCreated,n=>{const e=n.context;qZ(e),jZ(e)});const Ob=re("debugcomponents"),QD="eff8ba80-635d-11ec-90d6-0242ac120003";class Ss{constructor(e){u(this,"_originalSeed");u(this,"_seed");typeof e=="string"&&(e=Ss.hash(e)),this._originalSeed=e,this._seed=e}get seed(){return this._seed}set seed(e){this._seed=e}reset(){this._seed=this._originalSeed}generateUUID(e){if(typeof e=="string")return bB(e,QD);const t=this._seed;return this._seed-=1,bB(t.toString(),QD)}initialize(e){typeof e=="string"?this._seed=Ss.hash(e):this._seed=e}static createFromString(e){return new Ss(this.hash(e))}static hash(e){let t=0;for(let i=0;i<e.length;i++)t=e.charCodeAt(i)+((t<<5)-t);return t}}var gd;(function(n){n.NewInstanceCreated="new-instance-created",n.InstanceDestroyed="instance-destroyed"})(gd||(gd={}));class I3{constructor(e){u(this,"guid");this.guid=e}}function iI(n,e,t=!0){if(!n)return;const i=n;if(gc(n,t),!e){console.warn("Can not send destroy: No networking connection provided",n.guid);return}if(!e.isConnected){console.warn("Can not send destroy: not connected",n.guid);return}let s=n.guid;if(!s&&i.uuid&&(s=i.uuid),!s){console.warn("Can not send destroy: failed to find guid",n);return}const r=new I3(s);e.send(gd.InstanceDestroyed,r,ia.Queued)}function QZ(n,e){const t=new I3(n);e.send(gd.InstanceDestroyed,t,ia.Queued)}function jZ(n){n.connection.beginListen(gd.InstanceDestroyed,e=>{Ob&&console.log("[Remote] Destroyed",n.scene,e);const t=wx(e.guid,n.scene);t&&gc(t)})}class WZ{constructor(e,t){u(this,"guid");u(this,"originalGuid");u(this,"seed");u(this,"visible");u(this,"hostData");u(this,"dontSave");u(this,"parent");u(this,"position");u(this,"rotation");u(this,"scale");u(this,"preventCreation");this.originalGuid=e,this.guid=t}}function R3(n,e,t,i){var c;const s=n;if(!s.guid)return console.warn("Can not instantiate: No guid",s),null;if(e.context||(e.context=Lt.Current),!e.context)return console.error("Missing network instantiate options / reference to network connection in sync instantiate"),null;const r=e?{...e}:null,{instance:o,seed:a}=XZ(s,e);if(o){const l=o;if(l.guid){Ob&&console.log("[Local] new instance","gameobject:",o==null?void 0:o.guid);const h=new WZ(s.guid,l.guid);h.seed=a,r&&(r.position&&(h.position={x:r.position.x,y:r.position.y,z:r.position.z}),r.rotation&&(h.rotation={x:r.rotation.x,y:r.rotation.y,z:r.rotation.z,w:r.rotation.w}),r.scale&&(h.scale={x:r.scale.x,y:r.scale.y,z:r.scale.z})),h.position||(h.position={x:l.position.x,y:l.position.y,z:l.position.z}),h.rotation||(h.rotation={x:l.quaternion.x,y:l.quaternion.y,z:l.quaternion.z,w:l.quaternion.w}),h.scale||(h.scale={x:l.scale.x,y:l.scale.y,z:l.scale.z}),h.visible=s.visible,r!=null&&r.parent&&(typeof r.parent=="string"?h.parent=r.parent:h.parent=r.parent.guid),h.hostData=t,i===!1&&(h.dontSave=!0),(c=e==null?void 0:e.context)==null||c.connection.send(gd.NewInstanceCreated,h)}else console.warn("Missing guid, can not send new instance event",l)}return o}function nI(){return Math.random()*9999999}function qZ(n){n.connection.beginListen(gd.NewInstanceCreated,async e=>{const t=await JZ(e.originalGuid,n.scene);if(e.preventCreation===!0)return;if(!t){console.warn("could not find object that was instantiated: "+e.guid);return}const i=new _c;e.position&&(i.position=new w(e.position.x,e.position.y,e.position.z)),e.rotation&&(i.rotation=new Me(e.rotation.x,e.rotation.y,e.rotation.z,e.rotation.w)),e.scale&&(i.scale=new w(e.scale.x,e.scale.y,e.scale.z)),i.parent=e.parent,e.seed&&(i.idProvider=new Ss(e.seed)),i.visible=e.visible,i.context=n,Ob&&n.alias&&console.log("[Remote] instantiate in: "+n.alias);const s=tv(t,i);s&&(e.parent==="scene"&&n.scene.add(s),Ob&&console.log("[Remote] new instance","gameobject:",s==null?void 0:s.guid,t))})}function XZ(n,e){const t=nI(),i=e??new _c;i.idProvider=new Ss(t);const s=tv(n,i);return{seed:t,instance:s}}const P3={};function YZ(n,e){P3[n]=e}async function JZ(n,e){const t=P3[n];if(t!=null){const i=await t(n);if(i)return i}return B3(n,e)}function B3(n,e){if(e===null||!n)return null;if(e.guid===n)return e;if(e.children)for(const t of e.children){const i=B3(n,t);if(i)return i}return null}const k0=re("debuggetcomponent"),L0=re("debuginstantiate");var jD;(function(n){n[n.None=0]="None",n[n.HideInHierarchy=1]="HideInHierarchy",n[n.HideInInspector=2]="HideInInspector",n[n.DontSaveInEditor=4]="DontSaveInEditor",n[n.NotEditable=8]="NotEditable",n[n.DontSaveInBuild=16]="DontSaveInBuild",n[n.DontUnloadUnusedAsset=32]="DontUnloadUnusedAsset",n[n.DontSave=52]="DontSave",n[n.HideAndDontSave=61]="HideAndDontSave"})(jD||(jD={}));class _c{constructor(){u(this,"idProvider");u(this,"parent");u(this,"keepWorldPosition");u(this,"position");u(this,"rotation");u(this,"scale");u(this,"visible");u(this,"context")}clone(){var t,i,s;const e=new _c;return e.idProvider=this.idProvider,e.parent=this.parent,e.keepWorldPosition=this.keepWorldPosition,e.position=(t=this.position)==null?void 0:t.clone(),e.rotation=(i=this.rotation)==null?void 0:i.clone(),e.scale=(s=this.scale)==null?void 0:s.clone(),e}cloneAssign(e){var t,i,s;this.idProvider=e.idProvider,this.parent=e.parent,this.keepWorldPosition=e.keepWorldPosition,this.position=(t=e.position)==null?void 0:t.clone(),this.rotation=(i=e.rotation)==null?void 0:i.clone(),this.scale=(s=e.scale)==null?void 0:s.clone()}}function ev(n){return n.visible}function F0(n,e){return typeof e=="number"&&(e=e>.5),n.visible=e,n.visible}function KZ(n){return n[Bh]||sI(n)}function ZZ(n,e){n[xF]=e}function sI(n){return uc.isUsingInstancing(n)}function wx(n,e){return sA(n,e,!0,!0)}const D3=Symbol("isDestroyed");function _p(n){return n[D3]}function $Z(n,e){n[D3]=e}const fT=Symbol("isDontDestroy");function WD(n,e=!0){n[fT]=e}const U0=[],N0=[];function gc(n,e=!0,t=!1){U0.length=0,N0.length=0,pT(n,e,t,!0);for(const i of U0)i.gameObject=null,i.context=null;for(const i of N0)$Z(i,!0),t&&Qi(i),U8(i);N0.length=0,U0.length=0}function pT(n,e=!0,t=!1,i=!0){if(n==null)return;const s=n;if(s.isComponent){if(s[fT])return;U0.push(s);const a=s.gameObject;s.__internalDisable(),s.__internalDestroy(),s.gameObject=a;return}if(n[fT])return;const r=n;k0&&console.log(r),N0.push(r);const o=r.userData.components;if(o){let a=o.length;for(let c=0;c<o.length;c++){const l=o[c];pT(l,e,t,!1),o.length<a&&(a=o.length,c--)}}if(e&&r.children)for(const a of r.children)pT(a,e,t,!1);i&&r.removeFromParent()}function kb(n,e,t=!0){return k3(n,e,t)}function*O3(n,e,t=!1,i=999,s=0){if(n!=null&&n.userData.components&&!(s>i)){for(const r of n.userData.components)e&&(r==null?void 0:r.isComponent)===!0&&r instanceof e?yield r:yield r;if(t===!0)for(const r of n.children)yield*O3(r,e,!0,i,s+1)}}function k3(n,e,t,i=0){var s;if(n){if(n.isObject3D,i>1e3){console.warn("Failed to iterate components: too many levels");return}if((s=n.userData)!=null&&s.components)for(let r=0;r<n.userData.components.length;r++){const o=n.userData.components[r];if((o==null?void 0:o.isComponent)===!0){const a=e(o);if(a!==void 0)return a}}if(t&&n.children){const r=i+1;for(let o=0;o<n.children.length;o++){const a=n.children[o];if(!a)continue;const c=k3(a,e,t,r);if(c!==void 0)return c}}}}function tv(n,e=null){let t=null;e!==null&&(e.x!==void 0?(t=new _c,t.position=e):t=e);let i=Lt.Current;t!=null&&t.context&&(i=t.context),k0&&i.alias&&console.log("context",i.alias),t&&!t.idProvider&&(t.idProvider=new Ss(Date.now()));const s=[],r={},o={},a=L3(i,n,t,s,r,o);a&&(t$(r),e$(o,r)),k0&&(hT(n,!0),hT(a,!0));const c={};for(const l in s){const h=s[l],d=h.guid;t&&t.idProvider&&(h.guid=t.idProvider.generateUUID(),c[d]=h.guid,k0&&console.log(h.name,h.guid)),tI(h,i),h.__internalNewInstanceCreated&&h.__internalNewInstanceCreated()}for(const l in s){const h=s[l];h.resolveGuids&&h.resolveGuids(c),h.enabled!==!1&&(h.enabled=!0)}return gb(i),a}function L3(n,e,t,i,s,r){var h;if(!e)return null;const o=e.userData;e.userData={};const a=e.children;e.children=[];const c=e.clone(!1);if(rI(c),e.userData=o,e.children=a,s[e.uuid]={original:e,clone:c},L0&&console.log("ADD",e,c),e.type==="SkinnedMesh"&&(r[e.uuid]={original:e,clone:c}),(t==null?void 0:t.visible)!==void 0&&(c.visible=t.visible),t!=null&&t.idProvider){c.uuid=t.idProvider.generateUUID();const d=c;d&&(d.guid=c.uuid)}e.animations&&e.animations.length>0&&(c.animations=[...e.animations]);const l=e.parent;if(l&&l.add(c),t!=null&&t.position?vr(c,t.position):c.position.copy(e.position),t!=null&&t.rotation?fa(c,t.rotation):c.quaternion.copy(e.quaternion),t!=null&&t.scale?c.scale.copy(t.scale):c.scale.copy(e.scale),t!=null&&t.parent&&t.parent!=="scene"){let d=null;if(typeof t.parent=="string"?d=sA(t.parent,n.scene,!0):d=t.parent,d){const f=t.keepWorldPosition===!0?d.attach:d.add;f?f.call(d,c):console.error("Invalid parent object",d,"received when instantiating:",e)}else console.warn("could not find parent:",t.parent)}for(const[d,f]of Object.entries(e.userData))d!=="components"&&(c.userData[d]=f);if((h=e.userData)!=null&&h.components){const d=e.userData.components,f=[];c.userData.components=f;for(let p=0;p<d.length;p++){const m=d[p],g=new m.constructor;gp(g,m),m[S0]!==void 0&&(g[S0]=m[S0]),f.push(g),g.gameObject=c,i.push(g),sx.dispatchComponentLifecycleEvent(oA.Added,g)}}t&&(t.position=void 0,t.rotation=void 0,t.scale=void 0,t.parent=void 0);for(const d in e.children){const f=e.children[d],p=L3(n,f,t,i,s,r);p&&c.add(p)}return c}function e$(n,e){for(const t in n){const i=n[t],s=i.original,r=s.skeleton,o=i.clone;if(!r){console.warn("Skinned mesh has no skeleton?",i);continue}const a=r.bones,c=o.skeleton.clone();o.skeleton=c,o.bindMatrix.clone().copy(s.bindMatrix),o.bindMatrixInverse.copy(s.bindMatrixInverse);const l=[];c.bones=l;for(let h=0;h<a.length;h++){const d=a[h],p=e[d.uuid].clone;l.push(p)}}for(const t in n){const i=n[t].clone;i.skeleton.update(),i.bind(i.skeleton,i.bindMatrix),i.updateMatrixWorld(!0)}}function t$(n){var e;for(const t in n){const s=n[t].clone;if((e=s.userData)!=null&&e.components)for(let r=0;r<s.userData.components.length;r++){const o=s.userData.components[r],a=Object.entries(o);for(const[c,l]of a)if(Array.isArray(l)){const h=[];o[c]=h;for(let d=0;d<l.length;d++){const f=l[d];if(typeof f!="object"){h.push(f);continue}const p=qD(o,c,f,n);p!==void 0?h.push(p):h.push(f)}}else if(typeof l=="object"){const h=qD(o,c,l,n);h!==void 0&&(o[c]=h)}}}}function qD(n,e,t,i){var s,r;if(t!=null)if(t.isComponent===!0){const o=t.gameObject;if(o){const a=o.uuid,c=(s=i[a])==null?void 0:s.clone;if(!c){L0&&console.log("reference did not change",e,n,t);return}const l=o.userData.components.indexOf(t);if(l>=0)return L0&&console.log(e,a),c.userData.components[l];console.warn("could not find component",e,t)}}else if(t.isObject3D===!0){if(e==="gameObject")return;const o=t;if(o){const a=o.uuid,c=(r=i[a])==null?void 0:r.clone;if(c)return L0&&console.log(e,"old",t,"new",c),c}}else{if(t.isVector4||t.isVector3||t.isVector2||t.isQuaternion||t.isEuler)return t.clone();if(t.isColor===!0)return t.clone();if(t.isEventList===!0)return new t.constructor}}const F3=new Map;function i$(n,e){if(!n)return;if(!e){console.warn("No prototype found",n,n.prototype,n.constructor);return}const t=F3.get(e);t&&t.apply(n)}function n$(n){const e=s$(n.prototype);F3.set(n,e)}function s$(n){return new r$(n)}class r${constructor(e){u(this,"$symbol");u(this,"extensions");u(this,"descriptors");this.$symbol=Symbol("prototype-extension"),this.extensions=Object.keys(e),this.descriptors=new Array;for(let t=0;t<this.extensions.length;t++){const i=this.extensions[t],s=Object.getOwnPropertyDescriptor(e,i);s&&this.descriptors.push(s)}}apply(e){if(!e[this.$symbol]){e[this.$symbol]=!0;for(let t=0;t<this.extensions.length;t++){const i=this.extensions[t],s=this.descriptors[t];s&&Object.defineProperty(e,i,s)}}}}function rI(n){n&&n.isObject3D===!0&&i$(n,ge)}ge.prototype.SetActive=function(n){this.visible=n};ge.prototype.setActive=function(n){this.visible=n};ge.prototype.destroy=function(){gc(this)};ge.prototype.addComponent=function(n){return z3(this,n)};ge.prototype.addNewComponent=function(n){return wd(this,new n)};ge.prototype.removeComponent=function(n){return U3(this,n)};ge.prototype.getOrAddComponent=function(n){return oI(this,n)};ge.prototype.getComponent=function(n){return iv(this,n)};ge.prototype.getComponents=function(n,e){return Sx(this,n,e)};ge.prototype.getComponentInChildren=function(n){return Cx(this,n)};ge.prototype.getComponentsInChildren=function(n,e){return Ex(this,n,e)};ge.prototype.getComponentInParent=function(n){return Lb(this,n)};ge.prototype.getComponentsInParent=function(n,e){return aI(this,n,e)};Object.getOwnPropertyDescriptor(ge.prototype,"activeSelf")||Object.defineProperty(ge.prototype,"activeSelf",{get:function(){return ev(this)},set:function(n){F0(this,n)}});Object.getOwnPropertyDescriptor(ge.prototype,"transform")||Object.defineProperty(ge.prototype,"transform",{get:function(){return this}});Object.getOwnPropertyDescriptor(ge.prototype,"worldPosition")||Object.defineProperty(ge.prototype,"worldPosition",{get:function(){return this instanceof s1?Ht(this.object):Ht(this)},set:function(n){vr(this,n)}});Object.getOwnPropertyDescriptor(ge.prototype,"worldQuaternion")||Object.defineProperty(ge.prototype,"worldQuaternion",{get:function(){return this instanceof s1?In(this.object):In(this)},set:function(n){fa(this,n)}});Object.getOwnPropertyDescriptor(ge.prototype,"worldRotation")||Object.defineProperty(ge.prototype,"worldRotation",{get:function(){return _x(this)},set:function(n){C3(this,n)}});Object.getOwnPropertyDescriptor(ge.prototype,"worldScale")||Object.defineProperty(ge.prototype,"worldScale",{get:function(){return br(this)},set:function(n){Pb(this,n)}});Object.getOwnPropertyDescriptor(ge.prototype,"worldForward")||Object.defineProperty(ge.prototype,"worldForward",{get:function(){return Gn().set(0,0,1).applyQuaternion(In(this))}});Object.getOwnPropertyDescriptor(ge.prototype,"worldRight")||Object.defineProperty(ge.prototype,"worldRight",{get:function(){return Gn().set(1,0,0).applyQuaternion(In(this))}});Object.getOwnPropertyDescriptor(ge.prototype,"worldUp")||Object.defineProperty(ge.prototype,"worldUp",{get:function(){return Gn().set(0,1,0).applyQuaternion(In(this))}});n$(ge);const GS=re("debuggetcomponent");function o$(n){return n==null||n.isObject3D?n:n.object&&n.object.isObject3D?n.object:n}function U3(n,e){if(!n||!n.userData.components)return;const t=n.userData.components.indexOf(e);t<0||(sx.dispatchComponentLifecycleEvent(oA.Removing,e),e.gameObject=null,n.userData.components.splice(t,1))}function oI(n,e){const t=iv(n,e);if(t)return t;const i=new e;return wd(n,i)}const N3=new Ss("addComponentIdProvider");function wd(n,e,t=!0){n.userData||(n.userData={}),n.userData.components||(n.userData.components=[]),n.userData.components.push(e),e.gameObject=n,(e.guid===void 0||e.guid==="invalid")&&(e.guid=N3.generateUUID()),rI(n),tI(e);try{t&&e.__internalAwake&&(lg(n),e.activeAndEnabled&&e.__internalAwake()),sx.dispatchComponentLifecycleEvent(oA.Added,e)}catch(i){console.error(i)}return e}function z3(n,e){if(typeof e=="function")return wd(n,new e);if(e.destroyed)return console.warn("Can not move/add a destroyed component",e),e;if(e.gameObject===n)return e;if(e.gameObject&&e.gameObject.userData.components){const t=e.gameObject.userData.components.indexOf(e);e.gameObject.userData.components.splice(t,1)}if(!n.userData.components)n.userData.components=[];else if(n.userData.components.includes(e))return e;return n.userData.components.push(e),e.gameObject=n,(e.guid===void 0||e.guid==="invalid")&&(e.guid=N3.generateUUID()),tI(e),e}function a$(n){if(n.gameObject&&n.gameObject.userData.components){const e=n.gameObject.userData.components.indexOf(n);n.gameObject.userData.components.splice(e,1)}n.__internalDisable&&n.__internalDisable(),vh(n,n.context??Lt.Current),n.destroy(),n.gameObject=null}let XD=!1;function G3(n,e,t){var i;if(n==null)return null;if(!n.isObject3D)return console.error("Object is not object3D"),null;if(!((i=n==null?void 0:n.userData)!=null&&i.components)||(typeof e=="string"&&(XD||(XD=!0,console.warn(`Accessing components by name is not supported.
Please use the component type instead. This may keep working in local development but it will fail when bundling your application.

You can import other modules your main module to get access to types
or if you use npmdefs you can make types available globally using globalThis:
https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/globalThis`,e))),GS&&console.log("FIND",e),e==null))return null;for(let s=0;s<n.userData.components.length;s++){const r=n.userData.components[s];if(e===null||r.constructor.name===e.name||r.constructor.name===e)if(GS&&console.log(`MATCH BY NAME
`,r,`

componentType:`,e,`

componentType[name]:`,r.constructor.name,"==",e.name,`

constructor.name:`,r.constructor.name,"==",e),t)t.push(r);else return r}for(let s=0;s<n.userData.components.length;s++){const r=n.userData.components[s];let o=Object.getPrototypeOf(r.constructor);do{if(o===e)if(GS&&console.log("MATCH BY PROTOYPE",o),t)t.push(r);else return r;o=Object.getPrototypeOf(o)}while(o)}return t||null}function iv(n,e){return G3(n,e)}function Sx(n,e,t,i=!0){return t||(t=[]),i&&(t.length=0),G3(n,e,t),t}function Cx(n,e,t){var s;const i=iv(n,e);if(t===!1&&(i==null?void 0:i.enabled)===!1)return null;if(i)return i;for(let r=0;r<((s=n==null?void 0:n.children)==null?void 0:s.length);r++){const o=Cx(n.children[r],e);if(o)return o}return null}function Ex(n,e,t,i=!0){var s;t||(t=[]),i&&(t.length=0),Sx(n,e,t,!1);for(let r=0;r<((s=n==null?void 0:n.children)==null?void 0:s.length);r++)Ex(n.children[r],e,t,!1);return t}function Lb(n,e){if(!n)return null;if(Array.isArray(n)){for(let i=0;i<n.length;i++){const s=o$(n[i]),r=Lb(s,e);if(r)return r}return null}const t=iv(n,e);return t||(n.parent?Lb(n.parent,e):null)}function aI(n,e,t,i=!0){return t||(t=[]),i&&(t.length=0),n?(Sx(n,e,t,!1),n.parent?aI(n.parent,e,t,!1):t):t}function c$(n,e,t){if(!n)return null;if(!e&&(e=Lt.Current,!e))return console.error("Can not search object without any needle context or scene!!!"),null;let i=e;if(i.isScene||(i=e==null?void 0:e.scene),!i)return null;for(const s in i.children){const r=i.children[s];if(t===!1&&r[Bh]===!1)continue;if(r.constructor==n)return r;const o=Cx(r,n);if(o)return o}return null}function l$(n,e,t){if(!n)return e;if(e||(e=[]),e.length=0,!t&&(t=Lt.Current,!t))return console.error("Can not search object without any needle context or scene!!!"),e;const i=t.isScene===!0||t.isObject3D===!0?t:t==null?void 0:t.scene;if(!i)return e;for(const s in i.children){const r=i.children[s];if(r.constructor==n)return r;Ex(r,n,e,!1)}return e}class le extends ge{constructor(){super(...arguments);u(this,"guid")}static isDestroyed(t){return _p(t)}static setActive(t,i,s=!0){t&&(F0(t,i),C0(t),i&&s&&SF(Lt.Current,t))}static isActiveSelf(t){return ev(t)}static isActiveInHierarchy(t){return KZ(t)}static markAsInstancedRendered(t,i){ZZ(t,i)}static isUsingInstancing(t){return sI(t)}static foreachComponent(t,i,s=!0){return kb(t,i,s)}static instantiateSynced(t,i){return t?R3(t,i):null}static instantiate(t,i=null){return tv(t,i)}static destroySynced(t,i,s=!0){if(!t)return;const r=t;i=i??Lt.Current,iI(r,i.connection,s)}static destroy(t,i=!0,s=!0){return gc(t,i,s)}static add(t,i,s){if(!(!t||!i)){if(t===i){console.warn("Can not add object to self",t);return}s||(s=Lt.Current),i.add(t),F0(t,!0),C0(t),s?le.foreachComponent(t,r=>{CF(r,s),!r.__internalDidAwakeAndStart&&s.new_script_start.includes(r)===!1&&s.new_script_start.push(r)},!0):console.warn("Missing context")}}static remove(t){var i;t&&((i=t.parent)==null||i.remove(t),F0(t,!1),C0(t),le.foreachComponent(t,s=>{Q8(s)},!0))}static invokeOnChildren(t,i,...s){this.invoke(t,i,!0,s)}static invoke(t,i,s=!1,...r){t&&this.foreachComponent(t,o=>{const a=o[i];a&&typeof a=="function"&&(a==null||a.call(o,...r))},s)}static addNewComponent(t,i,s=!0){const r=new i;return wd(t,r,s),r}static addComponent(t,i){return this.moveComponent(t,i)}static moveComponent(t,i){return z3(t,i)}static removeComponent(t){return U3(t.gameObject,t),t}static getOrAddComponent(t,i){return oI(t,i)}static getComponent(t,i){return t===null?null:iv(t,i)}static getComponents(t,i,s=null){return t===null?s??[]:Sx(t,i,s)}static findByGuid(t,i){return wx(t,i)}static findObjectOfType(t,i,s=!0){return c$(t,i??Lt.Current,s)}static findObjectsOfType(t,i){const s=[];return l$(t,s,i),s}static getComponentInChildren(t,i){return Cx(t,i)}static getComponentsInChildren(t,i,s=null){return Ex(t,i,s??void 0)}static getComponentInParent(t,i){return Lb(t,i)}static getComponentsInParent(t,i,s=null){return aI(t,i,s)}static getAllComponents(t){var r;return[...(r=t.userData)==null?void 0:r.components]}static*iterateComponents(t){var s;const i=(s=t==null?void 0:t.userData)==null?void 0:s.components;if(i&&Array.isArray(i))for(let r=0;r<i.length;r++)yield i[r]}}var ec;let Te=(ec=class{constructor(){u(this,"__context");u(this,"__name");u(this,"gameObject");u(this,"guid","invalid");u(this,"sourceId");u(this,"__didAwake",!1);u(this,"__didStart",!1);u(this,"__didEnable",!1);u(this,"__isEnabled");u(this,"__destroyed",!1);u(this,"_eventListeners",new Map);this.__didAwake=!1,this.__didStart=!1,this.__didEnable=!1,this.__isEnabled=void 0,this.__destroyed=!1}get isComponent(){return!0}get context(){return this.__context??Lt.Current}set context(e){this.__context=e}get scene(){return this.context.scene}get layer(){var e,t;return(t=(e=this.gameObject)==null?void 0:e.userData)==null?void 0:t.layer}get name(){var e,t;return(e=this.gameObject)!=null&&e.name?this.gameObject.name:(t=this.gameObject)==null?void 0:t.userData.name}set name(e){this.gameObject?(this.gameObject.userData||(this.gameObject.userData={}),this.gameObject.userData.name=e,this.__name=e):this.__name=e}get tag(){var e;return(e=this.gameObject)==null?void 0:e.userData.tag}set tag(e){this.gameObject&&(this.gameObject.userData||(this.gameObject.userData={}),this.gameObject.userData.tag=e)}get static(){var e;return(e=this.gameObject)==null?void 0:e.userData.static}get hideFlags(){var e;return(e=this.gameObject)==null?void 0:e.userData.hideFlags}get activeAndEnabled(){return!(this.destroyed||this.__isEnabled===!1||!this.__isActiveInHierarchy)}get __isActive(){return this.gameObject.visible}get __isActiveInHierarchy(){if(!this.gameObject)return!1;const e=this.gameObject[Bh];return e===void 0?!0:e}set __isActiveInHierarchy(e){this.gameObject&&(this.gameObject[Bh]=e)}awake(){}onEnable(){}onDisable(){}onDestroy(){this.__destroyed=!0}startCoroutine(e,t=jt.Update){return this.context.registerCoroutineUpdate(this,e,t)}stopCoroutine(e,t=jt.Update){this.context.unregisterCoroutineUpdate(e,t)}get destroyed(){return this.__destroyed}destroy(){this.__destroyed||this.__internalDestroy()}get __internalDidAwakeAndStart(){return this.__didAwake&&this.__didStart}__internalNewInstanceCreated(){this.__didAwake=!1,this.__didStart=!1,this.__didEnable=!1,this.__isEnabled=void 0,this.__destroyed=!1}__internalAwake(){this.__didAwake||(this.__didAwake=!0,this.awake())}__internalStart(){this.__didStart||(this.__didStart=!0,this.start&&this.start())}__internalEnable(e){return this.__destroyed?(Tt()&&console.warn("[Needle Engine Dev] Trying to enable destroyed component"),!1):this.__didAwake?this.__didEnable?(e!==!0&&(this.__isEnabled=!0),!1):(this.__didEnable=!0,this.__isEnabled=!0,this.onEnable(),!0):!1}__internalDisable(e){if(this.__didAwake){if(!this.__didEnable){e!==!0&&(this.__isEnabled=!1);return}this.__didEnable=!1,this.__isEnabled=!1,this.onDisable()}}__internalDestroy(){var e;this.__destroyed||(this.__destroyed=!0,this.__didAwake&&((e=this.onDestroy)==null||e.call(this),this.dispatchEvent(new CustomEvent("destroyed",{detail:this}))),a$(this))}get enabled(){return typeof this.__isEnabled=="boolean"?this.__isEnabled:!0}set enabled(e){if(this.__destroyed){Tt()&&console.warn(`[Needle Engine Dev] Trying to ${e?"enable":"disable"} destroyed component`);return}if(typeof e=="number"&&(e>=.5?e=!0:e=!1),!this.__didAwake){this.__isEnabled=e;return}e?this.__internalEnable():this.__internalDisable()}get worldPosition(){return Ht(this.gameObject)}set worldPosition(e){vr(this.gameObject,e)}setWorldPosition(e,t,i){vA(this.gameObject,e,t,i)}get worldQuaternion(){return In(this.gameObject)}set worldQuaternion(e){fa(this.gameObject,e)}setWorldQuaternion(e,t,i,s){KK(this.gameObject,e,t,i,s)}get worldEuler(){return w3(this.gameObject)}set worldEuler(e){S3(this.gameObject,e)}get worldRotation(){return this.gameObject.worldRotation}set worldRotation(e){this.setWorldRotation(e.x,e.y,e.z,!0)}setWorldRotation(e,t,i,s=!0){xx(this.gameObject,e,t,i,s)}get forward(){return ec._forward.set(0,0,-1).applyQuaternion(this.worldQuaternion)}get right(){return ec._right.set(1,0,0).applyQuaternion(this.worldQuaternion)}get up(){return ec._up.set(0,1,0).applyQuaternion(this.worldQuaternion)}addEventListener(e,t){this._eventListeners[e]=this._eventListeners[e]||[],this._eventListeners[e].push(t)}removeEventListener(e,t){if(!this._eventListeners[e])return;const i=this._eventListeners[e].indexOf(t);i>=0&&this._eventListeners[e].splice(i,1)}dispatchEvent(e){if(!e||!this._eventListeners[e.type])return!1;const t=this._eventListeners[e.type];for(let i=0;i<t.length;i++)t[i](e);return!1}},u(ec,"_forward",new w),u(ec,"_right",new w),u(ec,"_up",new w),ec);const h$=Object.freeze(Object.defineProperty({__proto__:null,Behaviour:Te,Component:Te,GameObject:le},Symbol.toStringTag,{value:"Module"})),u$='<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 160 187.74"><defs><linearGradient id="a" x1="89.64" y1="184.81" x2="90.48" y2="21.85" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="#62d399"/><stop offset=".51" stop-color="#acd842"/><stop offset=".9" stop-color="#d7db0a"/></linearGradient><linearGradient id="b" x1="69.68" y1="178.9" x2="68.08" y2="16.77" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="#0ba398"/><stop offset=".5" stop-color="#4ca352"/><stop offset="1" stop-color="#76a30a"/></linearGradient><linearGradient id="c" x1="36.6" y1="152.17" x2="34.7" y2="84.19" gradientUnits="userSpaceOnUse"><stop offset=".19" stop-color="#36a382"/><stop offset=".54" stop-color="#49a459"/><stop offset="1" stop-color="#76a30b"/></linearGradient><linearGradient id="d" x1="15.82" y1="153.24" x2="18" y2="90.86" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="#267880"/><stop offset=".51" stop-color="#457a5c"/><stop offset="1" stop-color="#717516"/></linearGradient><linearGradient id="e" x1="135.08" y1="135.43" x2="148.93" y2="63.47" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="#b0d939"/><stop offset="1" stop-color="#eadb04"/></linearGradient><linearGradient id="f" x1="-4163.25" y1="2285.12" x2="-4160.81" y2="2215.34" gradientTransform="rotate(20 4088.49 13316.712)" gradientUnits="userSpaceOnUse"><stop offset=".17" stop-color="#74af52"/><stop offset=".48" stop-color="#99be32"/><stop offset="1" stop-color="#c0c40a"/></linearGradient><symbol id="g" viewBox="0 0 160 187.74"><path style="fill:url(#a)" d="M79.32 36.98v150.76L95 174.54l6.59-156.31-22.27 18.75z"/><path style="fill:url(#b)" d="M79.32 36.98 57.05 18.23l6.59 156.31 15.68 13.2V36.98z"/><path style="fill:url(#c)" d="m25.19 104.83 8.63 49.04 12.5-14.95-2.46-56.42-18.67 22.33z"/><path style="fill:url(#d)" d="M25.19 104.83 0 90.24l16.97 53.86 16.85 9.77-8.63-49.04z"/><path style="fill:#9c3" d="M43.86 82.5 18.69 67.98 0 90.24l25.18 14.59L43.86 82.5z"/><path style="fill:url(#e)" d="m134.82 78.69-9.97 56.5 15.58-9.04L160 64.1l-25.18 14.59z"/><path style="fill:url(#f)" d="m134.82 78.69-18.68-22.33-2.86 65 11.57 13.83 9.97-56.5z"/><path style="fill:#ffe113" d="m160 64.1-18.69-22.26-25.17 14.52 18.67 22.33L160 64.1z"/><path style="fill:#f3e600" d="M101.59 18.23 79.32 0 57.05 18.23l22.27 18.75 22.27-18.75z"/></symbol></defs><use width="160" height="187.74" xlink:href="#g"/></svg>',d$=new Blob([u$],{type:"image/svg+xml;charset=utf-8"}),f$=URL.createObjectURL(d$),z0=f$,Po=re("debuglicense");let ed="basic";Po&&console.log("License Type: "+ed);function Ag(){switch(ed){case"pro":case"enterprise":return!0}return!1}function V3(){switch(ed){case"indie":return!0}return!1}function td(){return Ag()||V3()}zi.registerCallback(Cn.ContextRegistered,n=>{g$(n.context),b$(),m$(n.context)});let Dh,mT=!1,Jm="";async function p$(){if(Dh)return Dh;if(ed==="basic")try{const n="https://engine.needle.tools/licensing/check?location="+encodeURIComponent(window.location.href)+"&version="+ol+"&generator="+encodeURIComponent(o1),e=await fetch(n,{method:"GET"}).catch(t=>{Po&&console.error("License check failed",t)});(e==null?void 0:e.status)===200?(mT=!1,Po&&console.log("License check succeeded"),ed="pro"):(e==null?void 0:e.status)===403?(mT=!0,Jm=await e.text()):Po&&console.log("License check failed with status "+(e==null?void 0:e.status))}catch(n){Po&&console.error("License check failed",n)}else Po&&console.log('Runtime license check is skipped because license is already applied as "'+ed+'"')}Dh=p$();async function m$(n){function e(){const s=document.createElement("div");s.className="needle-forbidden",s.style.cssText=`
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        pointer-events: all;
        zIndex: 2147483647;
        background-color: rgba(0,0,0,0.3);
        backdrop-filter: blur(10px);
        webkitBackdropFilter: blur(10px);
        line-height: 1.5;
        `;const r=document.createElement("div");s.appendChild(r),r.style.cssText=`
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        color: white;
        font-size: 24px;
        font-family: sans-serif;
        text-align: center;
        user-select: none;
        `;const o=(Jm==null?void 0:Jm.length)>1?Jm:"Needle Engine<br/>This application is not allowed to run on this domain!";return r.innerHTML=o,s}let t=e();const i=t.style.cssText;setInterval(()=>{var s;mT===!0&&(t.style.cssText!==i&&(t=e()),"isPaused"in n&&(n.isPaused=!0),t.parentNode!==n.domElement.shadowRoot&&((s=n.domElement.shadowRoot)==null||s.appendChild(t)))},500)}async function g$(n){try{if(td()!==!0)return VS(n)}catch(e){return Po&&console.log("License check failed",e),VS(n)}Po&&VS(n)}const H3="needle-license-element",gT=1e4,AT=1200;async function VS(n){let e=!1;n.domElement.addEventListener("ready",()=>e=!0),await(Dh==null?void 0:Dh.catch(()=>{})),!td()&&(A$(),e?vT(n):n.domElement.addEventListener("ready",()=>{vT(n)}))}function vT(n){const e=v$(),t=y$(),i=document.createElement("img");i.src=z0,i.classList.add("logo");const s="width: 55px; height: 55px; margin-right: 2px; vertical-align: middle; margin-bottom: 2px;";i.style.cssText=s,e.appendChild(i);const r=()=>{if(!e)return;const c=n.domElement.shadowRoot||n.domElement;e.parentNode!==c&&(c.appendChild(e),t&&c.appendChild(t)),i.parentElement!==e&&e.appendChild(i),(i.src!==z0||s!==i.style.cssText)&&(i.setAttribute("src",z0),i.style.cssText=s)};r();const o=setInterval(()=>{r()},1e3),a=document.createElement("div");if(a.classList.add("text"),e.appendChild(a),e.title="Needle Engine",td()||(e.title+=" No active license found - Non Commercial Use"),e.addEventListener("click",()=>{globalThis.open("https://needle.tools","_blank")}),V3()){const c=gT+AT;setTimeout(()=>{clearInterval(o),e==null||e.remove(),t==null||t.remove();const l=5;setTimeout(()=>{n.domElement.parentNode&&vT(n)},1e3*60*l)},c)}}let YD=0;async function A$(n){const e=Date.now();if(e-YD<2e3)return;YD=e;const i=`
        position: relative;
        display: block;
        font-size: 18px;
        background-size: 20px;
        background-position: 10px 5px;
        background-repeat:no-repeat;
        background-image:url('data:image/webp;base64,UklGRrABAABXRUJQVlA4WAoAAAAQAAAAHwAAHwAAQUxQSKEAAAARN6CmbSM4WR7vdARON11EBDq3fLiNbVtVzpMCPlKAEzsx0Y/x+Ovuv4dn0EFE/ydAvz6YggXzgh5sVgXM/zOC/4sii7qgGvB5N7hmuQYwkvazWAu1JPW41FXSHq6pnaQWvqYH18Fc0j1hO/BFTtIeSBlJi5w6qIIO7IOrwhFsB2Yxukif0FTRLpXswHR8MxbslKe9VZsn/Ub5C7YFOpqSTABWUDgg6AAAAFAGAJ0BKiAAIAA+7VyoTqmkpCI3+qgBMB2JbACdMt69DwMIQBLhkTO6XwY00UEDK6cNIDnuNibPf0EgAP7Y1myuiQHLDsF/0h5unrGh6WAbv7aegg2ZMd3uRKfT/3SJztcaujYfTvMXspfCTmYcoO6a+vhC3ss4M8uM58t4siiu59I4aOl59e9Sr6xoxYlHf2v+NnBNpJYeJf8jABQAId/PXuBkLEFkiCucgSGEcfhvajql/j3reCGl0M5/9gQWy7ayNPs+wlvIxFnNfSlfuND4CZOCyxOHhRqOmHN4ULHo3tCSrUNvgAA=');
        background-max-size: 40px;
        margin-bottom: 5px;
        margin-top: .3em;
        margin-bottom: .5em;
        padding: .2em;
        padding-left: 25px;
        border-radius: .5em;
        border: 2px solid rgba(160,160,160,.3);
    `,r=`Needle Engine  No license active, commercial use is not allowed. Visit https://needle.tools/pricing for more information and licensing options! v${ol}`;console.log("%c "+r,i)}function v$(){const n=document.createElement("div");n.setAttribute(H3,""),n.style.position="absolute",n.style.bottom="12px",n.style.right="15px";const e=2147483647;return n.style.zIndex=`${e}`,n}function y$(){const n=document.createElement("style"),e=`div[${H3}]`;return n.innerHTML=`
    ${e} {
        font-family: 'Roboto', sans-serif !important;
        font-weight: 300;
        transition: all 0.1s ease-in-out !important;
        pointer-events: all;
        overflow: hidden;
    }

    ${e}:hover {
        cursor: pointer;
        transition: all 0.3s ease-in-out !important;
    }

    ${e}, ${e} > * {
        display: inline-block !important;
        visibility: visible !important;
        border: none !important;
        text-decoration: none !important;
        vertical-align: middle !important;
    }
    
    @keyframes license-animation-text {
        1% {
            opacity: 0;
        }
        2.5% {
            opacity: 1;
        }
        100% {
            opacity: 1;
        }
    }
    ${e} .text {
        position: relative;
        display: inline-block;
        opacity: 0;
        animation: license-animation-text;
        animation-duration: ${gT/1e3}s;
        animation-delay: ${AT/1e3}s;
        animation-fill-mode: forwards;
        line-height: 1em;
        margin-left: -3px;
        color: rgba(20,20,20,1);
        font-size: 14px;
        font-weight: 800;
        background-color: rgba(220, 220, 220, .8);
        // padding: .51em .6em .43em .6em;
        border-radius: .7em;
    }

    ${e} .text .non-commercial {
        font-size: 0.8em;
        font-weight: 600;
        text-transform: uppercase;
    }
    
    @keyframes logo-animation {
        0% {
            transform: translate(0px, 10px);
            pointer-events: none;
        }
        3% {
            transform: translate(0, 0px);
            pointer-events: all;
            opacity: 1;
            transform: scale(1.1)
        }
        12% {
            transform: scale(1)
        }
        100% {
            opacity: 1;
            pointer-events: all;
            transform: scale(1)
        }
    }

    ${e} .logo {
        opacity: 0;
        pointer-events: none;
        animation: logo-animation;
        animation-duration: ${gT/1e3}s;
        animation-delay: ${AT/1e3}s;
        animation-easing: ease-in-out;
        animation-fill-mode: forwards;
    }

    ${e} .logo {
        position: relative !important;
        display: inline-block !important;
        border-radius: 50% !important;
        background-color: transparent !important;
        padding: 5px !important;
        transition: all 0.2s ease-in-out !important;
    }

    ${e}:hover .logo {
        transition: all 0.2s ease-in-out !important;
        transform: scale(1.1) !important;
        cursor: pointer !important;
    }

    @media (prefers-reduced-motion: reduce) {
        ${e} .text {
            animation: none !important;
            transition: none !important;
            /* animation end state */
            opacity: 1;
        }

        ${e} .logo {
            animation: none !important;
            transition: none !important;
            /* animation end state */
            opacity: 1;
            pointer-events: all;
            transform: scale(1)
        }
        ${e} .logo:hover { 
            transition: none !important; 
        }
    }
    `,n}async function b$(){try{const n="https://needle-engine-analytics-v2-r26roub2hq-lz.a.run.app";if(n){Po&&console.log("Analytics backend url",n);const e=window.location.href;let t="api/v2/new/request";n.endsWith("/")||(t="/"+t);const s=`${n}${t}?license=${ed}&url=${encodeURIComponent(e)}&hostname=${encodeURIComponent(window.location.hostname)}&pathname=${encodeURIComponent(window.location.pathname)}&search=${encodeURIComponent(window.location.search)}&hash=${encodeURIComponent(window.location.hash)}&version=${ol}&generator=${o1}`;Po&&console.log("Sending non-commercial usage message to analytics backend",s),fetch(s,{mode:"no-cors"}).catch(r=>{Po&&console.log("Failed to send non-commercial usage message to analytics backend",r)})}}catch(n){Po&&console.log("Failed to send non-commercial usage message to analytics backend",n)}}const Pu=re("debugloading"),Tm=re("debugloadingrendering"),JD=re("debuglicense");let Mm=0,KD;function Q3(n){Pu&&console.log(n.progress.loaded.toFixed(0)+"/"+n.progress.total.toFixed(0),n);const e=n.count,t=n.progress.total;t===0||t===void 0?(KD!==n.name&&(Mm=0),KD=n.name,Mm+=(1-Mm)*.001,Pu&&gn("Loading "+n.name+" did not report total size")):Mm=n.progress.loaded/t;const i=n.index/e+Mm/e;return nt.clamp01(i)}const u_=class{constructor(e,t){u(this,"loadingProgress",0);u(this,"_element");u(this,"_progress",0);u(this,"_allowCustomLoadingElement",!0);u(this,"_loadingElement");u(this,"_loadingTextContainer",null);u(this,"_loadingBar",null);u(this,"_messageContainer",null);u(this,"_loadingElementOptions");u(this,"_progressLoop");this._element=e,this._loadingElementOptions=t}async onLoadingBegin(e){const t=this._element.shadowRoot||this._element;if(Pu&&console.warn("Begin Loading"),!this._loadingElement){for(let i=0;i<t.children.length;i++){const s=t.children[i];if(s.classList.contains(u_.LoadingContainerClassName)){if(!this._allowCustomLoadingElement){Pu&&console.warn("Remove custom loading container"),t.removeChild(s);continue}this._loadingElement=this.createLoadingElement(s)}}this._loadingElement||(this._loadingElement=this.createLoadingElement())}this._progress=0,this.loadingProgress=0,this._loadingElement.style.display="flex",t.appendChild(this._loadingElement),this.smoothProgressLoop(),this.setMessage(e??"")}onLoadingUpdate(e,t){var s;if(!((s=this._loadingElement)!=null&&s.parentNode))return;let i=0;typeof e=="number"?i=e:("index"in e&&(i=Q3(e)),!t&&"name"in e&&this.setMessage("loading "+e.name)),this.loadingProgress=i,t&&this.setMessage(t),this.updateDisplay()}onLoadingFinished(){Pu&&console.warn("Finished Loading"),Tm||(this.loadingProgress=1,this.onDoneLoading())}setMessage(e){this._messageContainer&&(this._messageContainer.innerText=e)}smoothProgressLoop(){if(this._progressLoop)return;let e=1/12;Tm&&(e=1/500,typeof Tm=="number"&&(e*=Tm)),this._progressLoop=setInterval(()=>{this.loadingProgress>=.95&&!Tm&&(e=.9),this._progress=nt.lerp(this._progress,this.loadingProgress,e*this.loadingProgress),this.updateDisplay()},e)}onDoneLoading(){this._loadingElement&&(Pu&&console.log("Hiding loading element"),this._loadingElement.style.display="none",this._loadingElement.remove()),this._progressLoop&&clearInterval(this._progressLoop),this._progressLoop=null}updateDisplay(){const e=this._progress,t=(e*100).toFixed(0)+"%";this._loadingBar&&(this._loadingBar.style.width=e*100+"%"),this._loadingTextContainer&&(this._loadingTextContainer.textContent=t)}createLoadingElement(e){var p,m;Pu&&!e&&console.log("Creating loading element"),this._loadingElement=e||document.createElement("div");let t=this._element.getAttribute("loading-style");t==="auto"&&(window.matchMedia("(prefers-color-scheme: dark)").matches?t="dark":t="light");const i=Ag();if(!e&&(this._loadingElement.style.position="absolute",this._loadingElement.style.width="100%",this._loadingElement.style.height="100%",this._loadingElement.style.left="0",this._loadingElement.style.top="0",t==="light"?this._loadingElement.style.backgroundColor="#ddd":this._loadingElement.style.backgroundColor="#222",this._loadingElement.style.display="flex",this._loadingElement.style.alignItems="center",this._loadingElement.style.justifyContent="center",this._loadingElement.style.zIndex=Number.MAX_SAFE_INTEGER.toString(),this._loadingElement.style.flexDirection="column",this._loadingElement.style.pointerEvents="none",this._loadingElement.style.color="white",this._loadingElement.style.fontFamily="Roboto, sans-serif, Arial",t==="light"?this._loadingElement.style.color="rgba(0,0,0,.8)":this._loadingElement.style.color="rgba(255,255,255,.5)",i&&this._element)){const g=this._element.getAttribute("loading-background-color");g&&(this._loadingElement.style.backgroundColor=g);const y=this._element.getAttribute("loading-text-color");y&&(this._loadingElement.style.color=y)}const s=((p=this._loadingElementOptions)==null?void 0:p.className)??u_.LoadingContainerClassName;if(this._loadingElement.classList.add(s),(m=this._loadingElementOptions)!=null&&m.additionalClasses)for(const g of this._loadingElementOptions.additionalClasses)this._loadingElement.classList.add(g);const r=document.createElement("div");r.style.cssText=`
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        width: 100%;
        opacity: 0;
        transition: opacity 1.2s ease-in-out .2s;
        `,setTimeout(()=>{r.style.opacity="1"},1),this._loadingElement.appendChild(r);const o=document.createElement("div"),a=30;o.style.display="flex",o.style.width=a+"%",o.style.height="3px",t==="light"?o.style.backgroundColor="rgba(0,0,0,.2)":o.style.backgroundColor="rgba(255,255,255,.2)";const c=document.createElement("img"),l=64;c.style.width=`${l}px`,c.style.height=`${l}px`,c.style.marginBottom="20px",c.style.userSelect="none",c.style.objectFit="contain",td()||(c.style.transition="transform 1s ease-in-out, opacity 1s ease-in-out",c.style.transform="translateY(10px)",c.style.opacity="1",setTimeout(()=>{c.style.transform="translateY(0px)",c.style.opacity="1"},1)),c.src=z0;let h=!1;if(i&&this._element){const g=this._element.getAttribute("loading-logo-src");g&&(h=!0,c.src=g)}h||(c.style.cursor="pointer",c.style.pointerEvents="all",c.addEventListener("click",()=>window.open("https://needle.tools","_blank"))),r.appendChild(c),r.appendChild(o),this._loadingBar=document.createElement("div"),o.appendChild(this._loadingBar);const d=function(g){return nt.lerp(a*.5,100-a*.5,g)+"%"};if(this._loadingBar.style.background=`linear-gradient(90deg, #02022B ${d(0)}, #0BA398 ${d(.4)}, #99CC33 ${d(.5)}, #D7DB0A ${d(1)})`,this._loadingBar.style.backgroundAttachment="fixed",this._loadingBar.style.width="0%",this._loadingBar.style.height="100%",i&&this._element){const g=this._element.getAttribute("primary-color"),y=this._element.getAttribute("secondary-color");g&&y?this._loadingBar.style.background=`linear-gradient(90deg, ${g} ${d(0)}, ${y} ${d(1)})`:g?this._loadingBar.style.background=g:y&&(this._loadingBar.style.background=y)}this._loadingTextContainer=document.createElement("div"),this._loadingTextContainer.style.display="flex",this._loadingTextContainer.style.justifyContent="center",this._loadingTextContainer.style.marginTop="1.2em",r.appendChild(this._loadingTextContainer);const f=document.createElement("div");if(this._messageContainer=f,f.style.display="flex",f.style.fontSize=".8em",f.style.paddingTop=".5em",f.style.fontWeight="200",f.style.justifyContent="center",r.appendChild(f),i&&this._element){const g=this._element.getAttribute("loading-text-color");g&&(f.style.color=g)}return this.handleRuntimeLicense(r),this._loadingElement}async handleRuntimeLicense(e){let t=td();if(t)return;JD&&console.log("Loading UI has commercial license?",t);const i=document.createElement("div");i.style.paddingTop=".6em",i.style.fontSize=".8em",i.style.textTransform="uppercase",i.innerText="non commercial",i.style.opacity="0",e.appendChild(i),Dh&&(JD&&console.log("Waiting for runtime license check"),await Dh,t=td()),!t&&(i.style.transition="opacity .5s ease-in-out",i.style.opacity="1")}};let G0=u_;u(G0,"LoadingContainerClassName","loading");const Im=re("debugoverlay"),j3="ar",_$="quit-ar";class x${constructor(){u(this,"arContainer",null);u(this,"currentSession",null);u(this,"_createdAROnlyElements",[]);u(this,"_reparentedObjects",[]);u(this,"contentElement",null);u(this,"originalDomOverlayParent",null);u(this,"requestEndAR",()=>{this.onRequestedEndAR()})}get ARContainer(){return this.arContainer}onBegin(e,t,i){var s;if(this.currentSession=i,this.arContainer=t,$f()){const r=e.domElement.children;for(let o=0;o<(r==null?void 0:r.length);o++){const a=r[o];if(!a||a===this.arContainer)return;this._reparentedObjects.push({el:a,previousParent:a.parentElement}),(s=this.arContainer)==null||s.appendChild(a)}t?(this.originalDomOverlayParent=t.parentNode,this.originalDomOverlayParent&&(console.log("Reparent DOM Overlay to body",t,t.style.display),t.style.display="",t.style.visibility="",document.body.appendChild(t))):console.warn("WebXRViewer: No DOM Overlay found")}this.ensureQuitARButton(this.arContainer)}onEnd(e){var t;for(const i of this._createdAROnlyElements)i.remove&&i.remove();for(const i of this._reparentedObjects){const s=i.el;(t=i.previousParent)==null||t.appendChild(s)}this._reparentedObjects.length=0,$f()&&setTimeout(()=>{var o;const i=e.renderer.domElement;i&&((o=e.domElement.shadowRoot)==null||o.prepend(i));const s=document.querySelectorAll("*");for(var r=0;r<s.length;r++){const a=s[r];a&&a._displayChanged!==void 0&&a._displayWas!==void 0&&(a.style.display=a._displayWas)}},10)}createOverlayContainer(e){if(this.contentElement)return this.contentElement;Im&&console.log("Setup overlay container");const t=e.shadowRoot.querySelector(".content");this.contentElement=t;const i=e.shadowRoot.querySelector(".overlay-content");return i&&t.appendChild(i),Im&&!Pl()&&this.ensureQuitARButton(t),t}onRequestedEndAR(){this.currentSession&&(this.currentSession.end(),this.currentSession=null)}ensureQuitARButton(e){const t=document.createElement("slot");t.setAttribute("name","quit-ar"),this.appendElement(t,e),this._createdAROnlyElements.push(t),t.style.pointerEvents="auto";const i=document.querySelector(`.${_$}`);if(i){i.addEventListener("click",this.requestEndAR),Im&&i.addEventListener("click",()=>console.log("Clicked quit-ar button"));return}t.addEventListener("click",this.requestEndAR),Im&&t.addEventListener("click",()=>console.log("Clicked fallback close button"));const s=document.createElement("div");s.style.cssText=`
            position: fixed;
            top: 0;
            right: 0;
            z-index: 600;
            pointer-events: all;
        `,this.appendElement(s,t);var r=document.createElementNS("http://www.w3.org/2000/svg","svg");r.classList.add("quit-ar-button"),r.setAttribute("width","38px"),r.setAttribute("height","38px"),r.style.cssText=`
            background: radial-gradient(circle, rgba(0,0,0,.05) 70%, rgba(0,0,0,0) 100%);
            border-radius: 50%;
        `,s.appendChild(r);var o=document.createElementNS("http://www.w3.org/2000/svg","path");o.setAttribute("d","M 12,12 L 28,28 M 28,12 12,28"),o.setAttribute("stroke","#fff"),o.setAttribute("stroke-width","3px"),o.style.cssText=`
            filter: drop-shadow(0 0px 1.2px rgba(0,0,0,.7));
        `,r.appendChild(o),Im&&console.log("Created fallback close button",r,e)}appendElement(e,t){return t.shadowRoot?t.shadowRoot.appendChild(e):t.appendChild(e)}}var w$=function(){var n="b9H79Tebbbe8Fv9Gbb9Gvuuuuueu9Giuuub9Geueu9Giuuueuikqbeeedddillviebeoweuec:q;iekr;leDo9TW9T9VV95dbH9F9F939H79T9F9J9H229F9Jt9VV7bb8A9TW79O9V9Wt9F9KW9J9V9KW9wWVtW949c919M9MWVbeY9TW79O9V9Wt9F9KW9J9V9KW69U9KW949c919M9MWVbdE9TW79O9V9Wt9F9KW9J9V9KW69U9KW949tWG91W9U9JWbiL9TW79O9V9Wt9F9KW9J9V9KWS9P2tWV9p9JtblK9TW79O9V9Wt9F9KW9J9V9KWS9P2tWV9r919HtbvL9TW79O9V9Wt9F9KW9J9V9KWS9P2tWVT949Wbol79IV9Rbrq:P8Yqdbk;3sezu8Jjjjjbcj;eb9Rgv8Kjjjjbc9:hodnadcefal0mbcuhoaiRbbc:Ge9hmbavaialfgrad9Radz1jjjbhwcj;abad9UhoaicefhldnadTmbaoc;WFbGgocjdaocjd6EhDcbhqinaqae9pmeaDaeaq9RaqaDfae6Egkcsfgocl4cifcd4hxdndndndnaoc9WGgmTmbcbhPcehsawcjdfhzalhHinaraH9Rax6midnaraHaxfgl9RcK6mbczhoinawcj;cbfaogifgoc9WfhOdndndndndnaHaic9WfgAco4fRbbaAci4coG4ciGPlbedibkaO9cb83ibaOcwf9cb83ibxikaOalRblalRbbgAco4gCaCciSgCE86bbaocGfalclfaCfgORbbaAcl4ciGgCaCciSgCE86bbaocVfaOaCfgORbbaAcd4ciGgCaCciSgCE86bbaoc7faOaCfgORbbaAciGgAaAciSgAE86bbaoctfaOaAfgARbbalRbegOco4gCaCciSgCE86bbaoc91faAaCfgARbbaOcl4ciGgCaCciSgCE86bbaoc4faAaCfgARbbaOcd4ciGgCaCciSgCE86bbaoc93faAaCfgARbbaOciGgOaOciSgOE86bbaoc94faAaOfgARbbalRbdgOco4gCaCciSgCE86bbaoc95faAaCfgARbbaOcl4ciGgCaCciSgCE86bbaoc96faAaCfgARbbaOcd4ciGgCaCciSgCE86bbaoc97faAaCfgARbbaOciGgOaOciSgOE86bbaoc98faAaOfgORbbalRbiglco4gAaAciSgAE86bbaoc99faOaAfgORbbalcl4ciGgAaAciSgAE86bbaoc9:faOaAfgORbbalcd4ciGgAaAciSgAE86bbaocufaOaAfgoRbbalciGglalciSglE86bbaoalfhlxdkaOalRbwalRbbgAcl4gCaCcsSgCE86bbaocGfalcwfaCfgORbbaAcsGgAaAcsSgAE86bbaocVfaOaAfgORbbalRbegAcl4gCaCcsSgCE86bbaoc7faOaCfgORbbaAcsGgAaAcsSgAE86bbaoctfaOaAfgORbbalRbdgAcl4gCaCcsSgCE86bbaoc91faOaCfgORbbaAcsGgAaAcsSgAE86bbaoc4faOaAfgORbbalRbigAcl4gCaCcsSgCE86bbaoc93faOaCfgORbbaAcsGgAaAcsSgAE86bbaoc94faOaAfgORbbalRblgAcl4gCaCcsSgCE86bbaoc95faOaCfgORbbaAcsGgAaAcsSgAE86bbaoc96faOaAfgORbbalRbvgAcl4gCaCcsSgCE86bbaoc97faOaCfgORbbaAcsGgAaAcsSgAE86bbaoc98faOaAfgORbbalRbogAcl4gCaCcsSgCE86bbaoc99faOaCfgORbbaAcsGgAaAcsSgAE86bbaoc9:faOaAfgORbbalRbrglcl4gAaAcsSgAE86bbaocufaOaAfgoRbbalcsGglalcsSglE86bbaoalfhlxekaOal8Pbb83bbaOcwfalcwf8Pbb83bbalczfhlkdnaiam9pmbaiczfhoaral9RcL0mekkaiam6mialTmidnakTmbawaPfRbbhOcbhoazhiinaiawcj;cbfaofRbbgAce4cbaAceG9R7aOfgO86bbaiadfhiaocefgoak9hmbkkazcefhzaPcefgPad6hsalhHaPad9hmexvkkcbhlasceGmdxikalaxad2fhCdnakTmbcbhHcehsawcjdfhminaral9Rax6mialTmdalaxfhlawaHfRbbhOcbhoamhiinaiawcj;cbfaofRbbgAce4cbaAceG9R7aOfgO86bbaiadfhiaocefgoak9hmbkamcefhmaHcefgHad6hsaHad9hmbkaChlxikcbhocehsinaral9Rax6mdalTmealaxfhlaocefgoad6hsadao9hmbkaChlxdkcbhlasceGTmekc9:hoxikabaqad2fawcjdfakad2z1jjjb8Aawawcjdfakcufad2fadz1jjjb8Aakaqfhqalmbkc9:hoxekcbc99aral9Radcaadca0ESEhokavcj;ebf8Kjjjjbaok;yzeHu8Jjjjjbc;ae9Rgv8Kjjjjbc9:hodnaeci9UgrcHfal0mbcuhoaiRbbgwc;WeGc;Ge9hmbawcsGgDce0mbavc;abfcFecjez:jjjjb8AavcUf9cu83ibavc8Wf9cu83ibavcyf9cu83ibavcaf9cu83ibavcKf9cu83ibavczf9cu83ibav9cu83iwav9cu83ibaialfc9WfhqaicefgwarfhodnaeTmbcmcsaDceSEhkcbhxcbhmcbhDcbhicbhlindnaoaq9nmbc9:hoxikdndnawRbbgrc;Ve0mbavc;abfalarcl4cu7fcsGcitfgPydlhsaPydbhzdnarcsGgPak9pmbavaiarcu7fcsGcdtfydbaxaPEhraPThPdndnadcd9hmbabaDcetfgHaz87ebaHcdfas87ebaHclfar87ebxekabaDcdtfgHazBdbaHclfasBdbaHcwfarBdbkaxaPfhxavc;abfalcitfgHarBdbaHasBdlavaicdtfarBdbavc;abfalcefcsGglcitfgHazBdbaHarBdlaiaPfhialcefhlxdkdndnaPcsSmbamaPfaPc987fcefhmxekaocefhrao8SbbgPcFeGhHdndnaPcu9mmbarhoxekaocvfhoaHcFbGhHcrhPdninar8SbbgOcFbGaPtaHVhHaOcu9kmearcefhraPcrfgPc8J9hmbxdkkarcefhokaHce4cbaHceG9R7amfhmkdndnadcd9hmbabaDcetfgraz87ebarcdfas87ebarclfam87ebxekabaDcdtfgrazBdbarclfasBdbarcwfamBdbkavc;abfalcitfgramBdbarasBdlavaicdtfamBdbavc;abfalcefcsGglcitfgrazBdbaramBdlaicefhialcefhlxekdnarcpe0mbaxcefgOavaiaqarcsGfRbbgPcl49RcsGcdtfydbaPcz6gHEhravaiaP9RcsGcdtfydbaOaHfgsaPcsGgOEhPaOThOdndnadcd9hmbabaDcetfgzax87ebazcdfar87ebazclfaP87ebxekabaDcdtfgzaxBdbazclfarBdbazcwfaPBdbkavaicdtfaxBdbavc;abfalcitfgzarBdbazaxBdlavaicefgicsGcdtfarBdbavc;abfalcefcsGcitfgzaPBdbazarBdlavaiaHfcsGgicdtfaPBdbavc;abfalcdfcsGglcitfgraxBdbaraPBdlalcefhlaiaOfhiasaOfhxxekaxcbaoRbbgzEgAarc;:eSgrfhsazcsGhCazcl4hXdndnazcs0mbascefhOxekashOavaiaX9RcsGcdtfydbhskdndnaCmbaOcefhxxekaOhxavaiaz9RcsGcdtfydbhOkdndnarTmbaocefhrxekaocdfhrao8SbegHcFeGhPdnaHcu9kmbaocofhAaPcFbGhPcrhodninar8SbbgHcFbGaotaPVhPaHcu9kmearcefhraocrfgoc8J9hmbkaAhrxekarcefhrkaPce4cbaPceG9R7amfgmhAkdndnaXcsSmbarhPxekarcefhPar8SbbgocFeGhHdnaocu9kmbarcvfhsaHcFbGhHcrhodninaP8SbbgrcFbGaotaHVhHarcu9kmeaPcefhPaocrfgoc8J9hmbkashPxekaPcefhPkaHce4cbaHceG9R7amfgmhskdndnaCcsSmbaPhoxekaPcefhoaP8SbbgrcFeGhHdnarcu9kmbaPcvfhOaHcFbGhHcrhrdninao8SbbgPcFbGartaHVhHaPcu9kmeaocefhoarcrfgrc8J9hmbkaOhoxekaocefhokaHce4cbaHceG9R7amfgmhOkdndnadcd9hmbabaDcetfgraA87ebarcdfas87ebarclfaO87ebxekabaDcdtfgraABdbarclfasBdbarcwfaOBdbkavc;abfalcitfgrasBdbaraABdlavaicdtfaABdbavc;abfalcefcsGcitfgraOBdbarasBdlavaicefgicsGcdtfasBdbavc;abfalcdfcsGcitfgraABdbaraOBdlavaiazcz6aXcsSVfgicsGcdtfaOBdbaiaCTaCcsSVfhialcifhlkawcefhwalcsGhlaicsGhiaDcifgDae6mbkkcbc99aoaqSEhokavc;aef8Kjjjjbaok:llevu8Jjjjjbcz9Rhvc9:hodnaecvfal0mbcuhoaiRbbc;:eGc;qe9hmbav9cb83iwaicefhraialfc98fhwdnaeTmbdnadcdSmbcbhDindnaraw6mbc9:skarcefhoar8SbbglcFeGhidndnalcu9mmbaohrxekarcvfhraicFbGhicrhldninao8SbbgdcFbGaltaiVhiadcu9kmeaocefhoalcrfglc8J9hmbxdkkaocefhrkabaDcdtfaicd4cbaice4ceG9R7avcwfaiceGcdtVgoydbfglBdbaoalBdbaDcefgDae9hmbxdkkcbhDindnaraw6mbc9:skarcefhoar8SbbglcFeGhidndnalcu9mmbaohrxekarcvfhraicFbGhicrhldninao8SbbgdcFbGaltaiVhiadcu9kmeaocefhoalcrfglc8J9hmbxdkkaocefhrkabaDcetfaicd4cbaice4ceG9R7avcwfaiceGcdtVgoydbfgl87ebaoalBdbaDcefgDae9hmbkkcbc99arawSEhokaok:Lvoeue99dud99eud99dndnadcl9hmbaeTmeindndnabcdfgd8Sbb:Yab8Sbbgi:Ygl:l:tabcefgv8Sbbgo:Ygr:l:tgwJbb;:9cawawNJbbbbawawJbbbb9GgDEgq:mgkaqaicb9iEalMgwawNakaqaocb9iEarMgqaqNMM:r:vglNJbbbZJbbb:;aDEMgr:lJbbb9p9DTmbar:Ohixekcjjjj94hikadai86bbdndnaqalNJbbbZJbbb:;aqJbbbb9GEMgq:lJbbb9p9DTmbaq:Ohdxekcjjjj94hdkavad86bbdndnawalNJbbbZJbbb:;awJbbbb9GEMgw:lJbbb9p9DTmbaw:Ohdxekcjjjj94hdkabad86bbabclfhbaecufgembxdkkaeTmbindndnabclfgd8Ueb:Yab8Uebgi:Ygl:l:tabcdfgv8Uebgo:Ygr:l:tgwJb;:FSawawNJbbbbawawJbbbb9GgDEgq:mgkaqaicb9iEalMgwawNakaqaocb9iEarMgqaqNMM:r:vglNJbbbZJbbb:;aDEMgr:lJbbb9p9DTmbar:Ohixekcjjjj94hikadai87ebdndnaqalNJbbbZJbbb:;aqJbbbb9GEMgq:lJbbb9p9DTmbaq:Ohdxekcjjjj94hdkavad87ebdndnawalNJbbbZJbbb:;awJbbbb9GEMgw:lJbbb9p9DTmbaw:Ohdxekcjjjj94hdkabad87ebabcwfhbaecufgembkkk;siliui99iue99dnaeTmbcbhiabhlindndnJ;Zl81Zalcof8UebgvciV:Y:vgoal8Ueb:YNgrJb;:FSNJbbbZJbbb:;arJbbbb9GEMgw:lJbbb9p9DTmbaw:OhDxekcjjjj94hDkalclf8Uebhqalcdf8UebhkabavcefciGaiVcetfaD87ebdndnaoak:YNgwJb;:FSNJbbbZJbbb:;awJbbbb9GEMgx:lJbbb9p9DTmbax:Ohkxekcjjjj94hkkabavcdfciGaiVcetfak87ebdndnaoaq:YNgoJb;:FSNJbbbZJbbb:;aoJbbbb9GEMgx:lJbbb9p9DTmbax:Ohqxekcjjjj94hqkabavcufciGaiVcetfaq87ebdndnJbbjZararN:tawawN:taoaoN:tgrJbbbbarJbbbb9GE:rJb;:FSNJbbbZMgr:lJbbb9p9DTmbar:Ohqxekcjjjj94hqkabavciGaiVcetfaq87ebalcwfhlaiclfhiaecufgembkkk9mbdnadcd4ae2geTmbinababydbgdcwtcw91:Yadce91cjjj;8ifcjjj98G::NUdbabclfhbaecufgembkkk9teiucbcbydj1jjbgeabcifc98GfgbBdj1jjbdndnabZbcztgd9nmbcuhiabad9RcFFifcz4nbcuSmekaehikaik;LeeeudndnaeabVciGTmbabhixekdndnadcz9pmbabhixekabhiinaiaeydbBdbaiclfaeclfydbBdbaicwfaecwfydbBdbaicxfaecxfydbBdbaiczfhiaeczfheadc9Wfgdcs0mbkkadcl6mbinaiaeydbBdbaeclfheaiclfhiadc98fgdci0mbkkdnadTmbinaiaeRbb86bbaicefhiaecefheadcufgdmbkkabk;aeedudndnabciGTmbabhixekaecFeGc:b:c:ew2hldndnadcz9pmbabhixekabhiinaialBdbaicxfalBdbaicwfalBdbaiclfalBdbaiczfhiadc9Wfgdcs0mbkkadcl6mbinaialBdbaiclfhiadc98fgdci0mbkkdnadTmbinaiae86bbaicefhiadcufgdmbkkabkkkebcjwklz9Kbb",e="b9H79TebbbeKl9Gbb9Gvuuuuueu9Giuuub9Geueuikqbbebeedddilve9Weeeviebeoweuec:q;Aekr;leDo9TW9T9VV95dbH9F9F939H79T9F9J9H229F9Jt9VV7bb8A9TW79O9V9Wt9F9KW9J9V9KW9wWVtW949c919M9MWVbdY9TW79O9V9Wt9F9KW9J9V9KW69U9KW949c919M9MWVblE9TW79O9V9Wt9F9KW9J9V9KW69U9KW949tWG91W9U9JWbvL9TW79O9V9Wt9F9KW9J9V9KWS9P2tWV9p9JtboK9TW79O9V9Wt9F9KW9J9V9KWS9P2tWV9r919HtbrL9TW79O9V9Wt9F9KW9J9V9KWS9P2tWVT949Wbwl79IV9RbDq;t9tqlbzik9:evu8Jjjjjbcz9Rhbcbheincbhdcbhiinabcwfadfaicjuaead4ceGglE86bbaialfhiadcefgdcw9hmbkaec:q:yjjbfai86bbaecitc:q1jjbfab8Piw83ibaecefgecjd9hmbkk;h8JlHud97euo978Jjjjjbcj;kb9Rgv8Kjjjjbc9:hodnadcefal0mbcuhoaiRbbc:Ge9hmbavaialfgrad9Rad;8qbbcj;abad9UhoaicefhldnadTmbaoc;WFbGgocjdaocjd6EhwcbhDinaDae9pmeawaeaD9RaDawfae6Egqcsfgoc9WGgkci2hxakcethmaocl4cifcd4hPabaDad2fhscbhzdnincehHalhOcbhAdninaraO9RaP6miavcj;cbfaAak2fhCaOaPfhlcbhidnakc;ab6mbaral9Rc;Gb6mbcbhoinaCaofhidndndndndnaOaoco4fRbbgXciGPlbedibkaipxbbbbbbbbbbbbbbbbpklbxikaialpbblalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLgQcdp:meaQpmbzeHdOiAlCvXoQrLpxiiiiiiiiiiiiiiiip9ogLpxiiiiiiiiiiiiiiiip8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklbalclfaYpQbfaKc:q:yjjbfRbbfhlxdkaialpbbwalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLpxssssssssssssssssp9ogLpxssssssssssssssssp8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklbalcwfaYpQbfaKc:q:yjjbfRbbfhlxekaialpbbbpklbalczfhlkdndndndndnaXcd4ciGPlbedibkaipxbbbbbbbbbbbbbbbbpklzxikaialpbblalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLgQcdp:meaQpmbzeHdOiAlCvXoQrLpxiiiiiiiiiiiiiiiip9ogLpxiiiiiiiiiiiiiiiip8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklzalclfaYpQbfaKc:q:yjjbfRbbfhlxdkaialpbbwalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLpxssssssssssssssssp9ogLpxssssssssssssssssp8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklzalcwfaYpQbfaKc:q:yjjbfRbbfhlxekaialpbbbpklzalczfhlkdndndndndnaXcl4ciGPlbedibkaipxbbbbbbbbbbbbbbbbpklaxikaialpbblalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLgQcdp:meaQpmbzeHdOiAlCvXoQrLpxiiiiiiiiiiiiiiiip9ogLpxiiiiiiiiiiiiiiiip8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklaalclfaYpQbfaKc:q:yjjbfRbbfhlxdkaialpbbwalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLpxssssssssssssssssp9ogLpxssssssssssssssssp8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklaalcwfaYpQbfaKc:q:yjjbfRbbfhlxekaialpbbbpklaalczfhlkdndndndndnaXco4Plbedibkaipxbbbbbbbbbbbbbbbbpkl8WxikaialpbblalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLgQcdp:meaQpmbzeHdOiAlCvXoQrLpxiiiiiiiiiiiiiiiip9ogLpxiiiiiiiiiiiiiiiip8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgXcitc:q1jjbfpbibaXc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgXcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spkl8WalclfaYpQbfaXc:q:yjjbfRbbfhlxdkaialpbbwalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLpxssssssssssssssssp9ogLpxssssssssssssssssp8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgXcitc:q1jjbfpbibaXc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgXcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spkl8WalcwfaYpQbfaXc:q:yjjbfRbbfhlxekaialpbbbpkl8Walczfhlkaoc;abfhiaocjefak0meaihoaral9Rc;Fb0mbkkdndnaiak9pmbaici4hoinaral9RcK6mdaCaifhXdndndndndnaOaico4fRbbaocoG4ciGPlbedibkaXpxbbbbbbbbbbbbbbbbpklbxikaXalpbblalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLgQcdp:meaQpmbzeHdOiAlCvXoQrLpxiiiiiiiiiiiiiiiip9ogLpxiiiiiiiiiiiiiiiip8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklbalclfaYpQbfaKc:q:yjjbfRbbfhlxdkaXalpbbwalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLpxssssssssssssssssp9ogLpxssssssssssssssssp8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklbalcwfaYpQbfaKc:q:yjjbfRbbfhlxekaXalpbbbpklbalczfhlkaocdfhoaiczfgiak6mbkkalTmbaAci6hHalhOaAcefgohAaoclSmdxekkcbhlaHceGmdkdnakTmbavcjdfazfhiavazfpbdbhYcbhXinaiavcj;cbfaXfgopblbgLcep9TaLpxeeeeeeeeeeeeeeeegQp9op9Hp9rgLaoakfpblbg8Acep9Ta8AaQp9op9Hp9rg8ApmbzeHdOiAlCvXoQrLgEaoamfpblbg3cep9Ta3aQp9op9Hp9rg3aoaxfpblbg5cep9Ta5aQp9op9Hp9rg5pmbzeHdOiAlCvXoQrLg8EpmbezHdiOAlvCXorQLgQaQpmbedibedibedibediaYp9UgYp9AdbbaiadfgoaYaQaQpmlvorlvorlvorlvorp9UgYp9AdbbaoadfgoaYaQaQpmwDqkwDqkwDqkwDqkp9UgYp9AdbbaoadfgoaYaQaQpmxmPsxmPsxmPsxmPsp9UgYp9AdbbaoadfgoaYaEa8EpmwDKYqk8AExm35Ps8E8FgQaQpmbedibedibedibedip9UgYp9AdbbaoadfgoaYaQaQpmlvorlvorlvorlvorp9UgYp9AdbbaoadfgoaYaQaQpmwDqkwDqkwDqkwDqkp9UgYp9AdbbaoadfgoaYaQaQpmxmPsxmPsxmPsxmPsp9UgYp9AdbbaoadfgoaYaLa8ApmwKDYq8AkEx3m5P8Es8FgLa3a5pmwKDYq8AkEx3m5P8Es8Fg8ApmbezHdiOAlvCXorQLgQaQpmbedibedibedibedip9UgYp9AdbbaoadfgoaYaQaQpmlvorlvorlvorlvorp9UgYp9AdbbaoadfgoaYaQaQpmwDqkwDqkwDqkwDqkp9UgYp9AdbbaoadfgoaYaQaQpmxmPsxmPsxmPsxmPsp9UgYp9AdbbaoadfgoaYaLa8ApmwDKYqk8AExm35Ps8E8FgQaQpmbedibedibedibedip9UgYp9AdbbaoadfgoaYaQaQpmlvorlvorlvorlvorp9UgYp9AdbbaoadfgoaYaQaQpmwDqkwDqkwDqkwDqkp9UgYp9AdbbaoadfgoaYaQaQpmxmPsxmPsxmPsxmPsp9UgYp9AdbbaoadfhiaXczfgXak6mbkkazclfgzad6mbkasavcjdfaqad2;8qbbavavcjdfaqcufad2fad;8qbbaqaDfhDc9:hoalmexikkc9:hoxekcbc99aral9Radcaadca0ESEhokavcj;kbf8Kjjjjbaokwbz:bjjjbk;uzeHu8Jjjjjbc;ae9Rgv8Kjjjjbc9:hodnaeci9UgrcHfal0mbcuhoaiRbbgwc;WeGc;Ge9hmbawcsGgDce0mbavc;abfcFecje;8kbavcUf9cu83ibavc8Wf9cu83ibavcyf9cu83ibavcaf9cu83ibavcKf9cu83ibavczf9cu83ibav9cu83iwav9cu83ibaialfc9WfhqaicefgwarfhodnaeTmbcmcsaDceSEhkcbhxcbhmcbhDcbhicbhlindnaoaq9nmbc9:hoxikdndnawRbbgrc;Ve0mbavc;abfalarcl4cu7fcsGcitfgPydlhsaPydbhzdnarcsGgPak9pmbavaiarcu7fcsGcdtfydbaxaPEhraPThPdndnadcd9hmbabaDcetfgHaz87ebaHcdfas87ebaHclfar87ebxekabaDcdtfgHazBdbaHclfasBdbaHcwfarBdbkaxaPfhxavc;abfalcitfgHarBdbaHasBdlavaicdtfarBdbavc;abfalcefcsGglcitfgHazBdbaHarBdlaiaPfhialcefhlxdkdndnaPcsSmbamaPfaPc987fcefhmxekaocefhrao8SbbgPcFeGhHdndnaPcu9mmbarhoxekaocvfhoaHcFbGhHcrhPdninar8SbbgOcFbGaPtaHVhHaOcu9kmearcefhraPcrfgPc8J9hmbxdkkarcefhokaHce4cbaHceG9R7amfhmkdndnadcd9hmbabaDcetfgraz87ebarcdfas87ebarclfam87ebxekabaDcdtfgrazBdbarclfasBdbarcwfamBdbkavc;abfalcitfgramBdbarasBdlavaicdtfamBdbavc;abfalcefcsGglcitfgrazBdbaramBdlaicefhialcefhlxekdnarcpe0mbaxcefgOavaiaqarcsGfRbbgPcl49RcsGcdtfydbaPcz6gHEhravaiaP9RcsGcdtfydbaOaHfgsaPcsGgOEhPaOThOdndnadcd9hmbabaDcetfgzax87ebazcdfar87ebazclfaP87ebxekabaDcdtfgzaxBdbazclfarBdbazcwfaPBdbkavaicdtfaxBdbavc;abfalcitfgzarBdbazaxBdlavaicefgicsGcdtfarBdbavc;abfalcefcsGcitfgzaPBdbazarBdlavaiaHfcsGgicdtfaPBdbavc;abfalcdfcsGglcitfgraxBdbaraPBdlalcefhlaiaOfhiasaOfhxxekaxcbaoRbbgzEgAarc;:eSgrfhsazcsGhCazcl4hXdndnazcs0mbascefhOxekashOavaiaX9RcsGcdtfydbhskdndnaCmbaOcefhxxekaOhxavaiaz9RcsGcdtfydbhOkdndnarTmbaocefhrxekaocdfhrao8SbegHcFeGhPdnaHcu9kmbaocofhAaPcFbGhPcrhodninar8SbbgHcFbGaotaPVhPaHcu9kmearcefhraocrfgoc8J9hmbkaAhrxekarcefhrkaPce4cbaPceG9R7amfgmhAkdndnaXcsSmbarhPxekarcefhPar8SbbgocFeGhHdnaocu9kmbarcvfhsaHcFbGhHcrhodninaP8SbbgrcFbGaotaHVhHarcu9kmeaPcefhPaocrfgoc8J9hmbkashPxekaPcefhPkaHce4cbaHceG9R7amfgmhskdndnaCcsSmbaPhoxekaPcefhoaP8SbbgrcFeGhHdnarcu9kmbaPcvfhOaHcFbGhHcrhrdninao8SbbgPcFbGartaHVhHaPcu9kmeaocefhoarcrfgrc8J9hmbkaOhoxekaocefhokaHce4cbaHceG9R7amfgmhOkdndnadcd9hmbabaDcetfgraA87ebarcdfas87ebarclfaO87ebxekabaDcdtfgraABdbarclfasBdbarcwfaOBdbkavc;abfalcitfgrasBdbaraABdlavaicdtfaABdbavc;abfalcefcsGcitfgraOBdbarasBdlavaicefgicsGcdtfasBdbavc;abfalcdfcsGcitfgraABdbaraOBdlavaiazcz6aXcsSVfgicsGcdtfaOBdbaiaCTaCcsSVfhialcifhlkawcefhwalcsGhlaicsGhiaDcifgDae6mbkkcbc99aoaqSEhokavc;aef8Kjjjjbaok:llevu8Jjjjjbcz9Rhvc9:hodnaecvfal0mbcuhoaiRbbc;:eGc;qe9hmbav9cb83iwaicefhraialfc98fhwdnaeTmbdnadcdSmbcbhDindnaraw6mbc9:skarcefhoar8SbbglcFeGhidndnalcu9mmbaohrxekarcvfhraicFbGhicrhldninao8SbbgdcFbGaltaiVhiadcu9kmeaocefhoalcrfglc8J9hmbxdkkaocefhrkabaDcdtfaicd4cbaice4ceG9R7avcwfaiceGcdtVgoydbfglBdbaoalBdbaDcefgDae9hmbxdkkcbhDindnaraw6mbc9:skarcefhoar8SbbglcFeGhidndnalcu9mmbaohrxekarcvfhraicFbGhicrhldninao8SbbgdcFbGaltaiVhiadcu9kmeaocefhoalcrfglc8J9hmbxdkkaocefhrkabaDcetfaicd4cbaice4ceG9R7avcwfaiceGcdtVgoydbfgl87ebaoalBdbaDcefgDae9hmbkkcbc99arawSEhokaok:EPliuo97eue978Jjjjjbca9Rhidndnadcl9hmbdnaec98GglTmbcbhvabhdinadadpbbbgocKp:RecKp:Sep;6egraocwp:RecKp:Sep;6earp;Geaoczp:RecKp:Sep;6egwp;Gep;Kep;LegDpxbbbbbbbbbbbbbbbbp:2egqarpxbbbjbbbjbbbjbbbjgkp9op9rp;Kegrpxbb;:9cbb;:9cbb;:9cbb;:9cararp;MeaDaDp;Meawaqawakp9op9rp;Kegrarp;Mep;Kep;Kep;Jep;Negwp;Mepxbbn0bbn0bbn0bbn0gqp;KepxFbbbFbbbFbbbFbbbp9oaopxbbbFbbbFbbbFbbbFp9op9qarawp;Meaqp;Kecwp:RepxbFbbbFbbbFbbbFbbp9op9qaDawp;Meaqp;Keczp:RepxbbFbbbFbbbFbbbFbp9op9qpkbbadczfhdavclfgval6mbkkalae9pmeaiaeciGgvcdtgdVcbczad9R;8kbaiabalcdtfglad;8qbbdnavTmbaiaipblbgocKp:RecKp:Sep;6egraocwp:RecKp:Sep;6earp;Geaoczp:RecKp:Sep;6egwp;Gep;Kep;LegDpxbbbbbbbbbbbbbbbbp:2egqarpxbbbjbbbjbbbjbbbjgkp9op9rp;Kegrpxbb;:9cbb;:9cbb;:9cbb;:9cararp;MeaDaDp;Meawaqawakp9op9rp;Kegrarp;Mep;Kep;Kep;Jep;Negwp;Mepxbbn0bbn0bbn0bbn0gqp;KepxFbbbFbbbFbbbFbbbp9oaopxbbbFbbbFbbbFbbbFp9op9qarawp;Meaqp;Kecwp:RepxbFbbbFbbbFbbbFbbp9op9qaDawp;Meaqp;Keczp:RepxbbFbbbFbbbFbbbFbp9op9qpklbkalaiad;8qbbskdnaec98GgxTmbcbhvabhdinadczfglalpbbbgopxbbbbbbFFbbbbbbFFgkp9oadpbbbgDaopmlvorxmPsCXQL358E8FpxFubbFubbFubbFubbp9op;6eaDaopmbediwDqkzHOAKY8AEgoczp:Sep;6egrp;Geaoczp:Reczp:Sep;6egwp;Gep;Kep;Legopxb;:FSb;:FSb;:FSb;:FSawaopxbbbbbbbbbbbbbbbbp:2egqawpxbbbjbbbjbbbjbbbjgmp9op9rp;Kegwawp;Meaoaop;Mearaqaramp9op9rp;Kegoaop;Mep;Kep;Kep;Jep;Negrp;Mepxbbn0bbn0bbn0bbn0gqp;Keczp:Reawarp;Meaqp;KepxFFbbFFbbFFbbFFbbp9op9qgwaoarp;Meaqp;KepxFFbbFFbbFFbbFFbbp9ogopmwDKYqk8AExm35Ps8E8Fp9qpkbbadaDakp9oawaopmbezHdiOAlvCXorQLp9qpkbbadcafhdavclfgvax6mbkkaxae9pmbaiaeciGgvcitgdfcbcaad9R;8kbaiabaxcitfglad;8qbbdnavTmbaiaipblzgopxbbbbbbFFbbbbbbFFgkp9oaipblbgDaopmlvorxmPsCXQL358E8FpxFubbFubbFubbFubbp9op;6eaDaopmbediwDqkzHOAKY8AEgoczp:Sep;6egrp;Geaoczp:Reczp:Sep;6egwp;Gep;Kep;Legopxb;:FSb;:FSb;:FSb;:FSawaopxbbbbbbbbbbbbbbbbp:2egqawpxbbbjbbbjbbbjbbbjgmp9op9rp;Kegwawp;Meaoaop;Mearaqaramp9op9rp;Kegoaop;Mep;Kep;Kep;Jep;Negrp;Mepxbbn0bbn0bbn0bbn0gqp;Keczp:Reawarp;Meaqp;KepxFFbbFFbbFFbbFFbbp9op9qgwaoarp;Meaqp;KepxFFbbFFbbFFbbFFbbp9ogopmwDKYqk8AExm35Ps8E8Fp9qpklzaiaDakp9oawaopmbezHdiOAlvCXorQLp9qpklbkalaiad;8qbbkk;4wllue97euv978Jjjjjbc8W9Rhidnaec98GglTmbcbhvabhoinaiaopbbbgraoczfgwpbbbgDpmlvorxmPsCXQL358E8Fgqczp:Segkclp:RepklbaopxbbjZbbjZbbjZbbjZpx;Zl81Z;Zl81Z;Zl81Z;Zl81Zakpxibbbibbbibbbibbbp9qp;6ep;NegkaraDpmbediwDqkzHOAKY8AEgrczp:Reczp:Sep;6ep;MegDaDp;Meakarczp:Sep;6ep;Megxaxp;Meakaqczp:Reczp:Sep;6ep;Megqaqp;Mep;Kep;Kep;Lepxbbbbbbbbbbbbbbbbp:4ep;Jepxb;:FSb;:FSb;:FSb;:FSgkp;Mepxbbn0bbn0bbn0bbn0grp;KepxFFbbFFbbFFbbFFbbgmp9oaxakp;Mearp;Keczp:Rep9qgxaqakp;Mearp;Keczp:ReaDakp;Mearp;Keamp9op9qgkpmbezHdiOAlvCXorQLgrp5baipblbpEb:T:j83ibaocwfarp5eaipblbpEe:T:j83ibawaxakpmwDKYqk8AExm35Ps8E8Fgkp5baipblbpEd:T:j83ibaocKfakp5eaipblbpEi:T:j83ibaocafhoavclfgval6mbkkdnalae9pmbaiaeciGgvcitgofcbcaao9R;8kbaiabalcitfgwao;8qbbdnavTmbaiaipblbgraipblzgDpmlvorxmPsCXQL358E8Fgqczp:Segkclp:RepklaaipxbbjZbbjZbbjZbbjZpx;Zl81Z;Zl81Z;Zl81Z;Zl81Zakpxibbbibbbibbbibbbp9qp;6ep;NegkaraDpmbediwDqkzHOAKY8AEgrczp:Reczp:Sep;6ep;MegDaDp;Meakarczp:Sep;6ep;Megxaxp;Meakaqczp:Reczp:Sep;6ep;Megqaqp;Mep;Kep;Kep;Lepxbbbbbbbbbbbbbbbbp:4ep;Jepxb;:FSb;:FSb;:FSb;:FSgkp;Mepxbbn0bbn0bbn0bbn0grp;KepxFFbbFFbbFFbbFFbbgmp9oaxakp;Mearp;Keczp:Rep9qgxaqakp;Mearp;Keczp:ReaDakp;Mearp;Keamp9op9qgkpmbezHdiOAlvCXorQLgrp5baipblapEb:T:j83ibaiarp5eaipblapEe:T:j83iwaiaxakpmwDKYqk8AExm35Ps8E8Fgkp5baipblapEd:T:j83izaiakp5eaipblapEi:T:j83iKkawaiao;8qbbkk:Pddiue978Jjjjjbc;ab9Rhidnadcd4ae2glc98GgvTmbcbhdabheinaeaepbbbgocwp:Recwp:Sep;6eaocep:SepxbbjZbbjZbbjZbbjZp:UepxbbjFbbjFbbjFbbjFp9op;Mepkbbaeczfheadclfgdav6mbkkdnaval9pmbaialciGgdcdtgeVcbc;abae9R;8kbaiabavcdtfgvae;8qbbdnadTmbaiaipblbgocwp:Recwp:Sep;6eaocep:SepxbbjZbbjZbbjZbbjZp:UepxbbjFbbjFbbjFbbjFp9op;Mepklbkavaiae;8qbbkk9teiucbcbydj1jjbgeabcifc98GfgbBdj1jjbdndnabZbcztgd9nmbcuhiabad9RcFFifcz4nbcuSmekaehikaikkkebcjwklz9Tbb",t=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]),i=new Uint8Array([32,0,65,2,1,106,34,33,3,128,11,4,13,64,6,253,10,7,15,116,127,5,8,12,40,16,19,54,20,9,27,255,113,17,42,67,24,23,146,148,18,14,22,45,70,69,56,114,101,21,25,63,75,136,108,28,118,29,73,115]);if(typeof WebAssembly!="object")return{supported:!1};var s=WebAssembly.validate(t)?e:n,r,o=WebAssembly.instantiate(a(s),{}).then(function(A){r=A.instance,r.exports.__wasm_call_ctors()});function a(A){for(var v=new Uint8Array(A.length),b=0;b<A.length;++b){var _=A.charCodeAt(b);v[b]=_>96?_-97:_>64?_-39:_+4}for(var T=0,b=0;b<A.length;++b)v[T++]=v[b]<60?i[v[b]]:(v[b]-60)*64+v[++b];return v.buffer.slice(0,T)}function c(A,v,b,_,T,E){var M=r.exports.sbrk,I=b+3&-4,S=M(I*_),C=M(T.length),D=new Uint8Array(r.exports.memory.buffer);D.set(T,C);var G=A(S,b,_,C,T.length);if(G==0&&E&&E(S,I,_),v.set(D.subarray(S,S+b*_)),M(S-M(0)),G!=0)throw new Error("Malformed buffer data: "+G)}var l={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},h={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"},d=[],f=0;function p(A){var v={object:new Worker(A),pending:0,requests:{}};return v.object.onmessage=function(b){var _=b.data;v.pending-=_.count,v.requests[_.id][_.action](_.value),delete v.requests[_.id]},v}function m(A){for(var v="var instance; var ready = WebAssembly.instantiate(new Uint8Array(["+new Uint8Array(a(s))+"]), {}).then(function(result) { instance = result.instance; instance.exports.__wasm_call_ctors(); });self.onmessage = workerProcess;"+c.toString()+y.toString(),b=new Blob([v],{type:"text/javascript"}),_=URL.createObjectURL(b),T=0;T<A;++T)d[T]=p(_);URL.revokeObjectURL(_)}function g(A,v,b,_,T){for(var E=d[0],M=1;M<d.length;++M)d[M].pending<E.pending&&(E=d[M]);return new Promise(function(I,S){var C=new Uint8Array(b),D=f++;E.pending+=A,E.requests[D]={resolve:I,reject:S},E.object.postMessage({id:D,count:A,size:v,source:C,mode:_,filter:T},[C.buffer])})}function y(A){o.then(function(){var v=A.data;try{var b=new Uint8Array(v.count*v.size);c(r.exports[v.mode],b,v.count,v.size,v.source,r.exports[v.filter]),self.postMessage({id:v.id,count:v.count,action:"resolve",value:b},[b.buffer])}catch(_){self.postMessage({id:v.id,count:v.count,action:"reject",value:_})}})}return{ready:o,supported:!0,useWorkers:function(A){m(A)},decodeVertexBuffer:function(A,v,b,_,T){c(r.exports.meshopt_decodeVertexBuffer,A,v,b,_,r.exports[l[T]])},decodeIndexBuffer:function(A,v,b,_){c(r.exports.meshopt_decodeIndexBuffer,A,v,b,_)},decodeIndexSequence:function(A,v,b,_){c(r.exports.meshopt_decodeIndexSequence,A,v,b,_)},decodeGltfBuffer:function(A,v,b,_,T,E){c(r.exports[h[T]],A,v,b,_,r.exports[l[E]])},decodeGltfBufferAsync:function(A,v,b,_,T){return d.length>0?g(A,v,b,h[_],l[T]):o.then(function(){var E=new Uint8Array(A*v);return c(r.exports[h[_]],E,A,v,b,r.exports[l[T]]),E})}}}();const HS=new WeakMap;class cI extends Ms{constructor(e){super(e),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(e){return this.decoderPath=e,this}setDecoderConfig(e){return this.decoderConfig=e,this}setWorkerLimit(e){return this.workerLimit=e,this}load(e,t,i,s){const r=new Hn(this.manager);r.setPath(this.path),r.setResponseType("arraybuffer"),r.setRequestHeader(this.requestHeader),r.setWithCredentials(this.withCredentials),r.load(e,o=>{this.parse(o,t,s)},i,s)}parse(e,t,i=()=>{}){this.decodeDracoFile(e,t,null,null,zt).catch(i)}decodeDracoFile(e,t,i,s,r=Ri,o=()=>{}){const a={attributeIDs:i||this.defaultAttributeIDs,attributeTypes:s||this.defaultAttributeTypes,useUniqueIDs:!!i,vertexColorSpace:r};return this.decodeGeometry(e,a).then(t).catch(o)}decodeGeometry(e,t){const i=JSON.stringify(t);if(HS.has(e)){const c=HS.get(e);if(c.key===i)return c.promise;if(e.byteLength===0)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let s;const r=this.workerNextTaskID++,o=e.byteLength,a=this._getWorker(r,o).then(c=>(s=c,new Promise((l,h)=>{s._callbacks[r]={resolve:l,reject:h},s.postMessage({type:"decode",id:r,taskConfig:t,buffer:e},[e])}))).then(c=>this._createGeometry(c.geometry));return a.catch(()=>!0).then(()=>{s&&r&&this._releaseTask(s,r)}),HS.set(e,{key:i,promise:a}),a}_createGeometry(e){const t=new gt;e.index&&t.setIndex(new it(e.index.array,1));for(let i=0;i<e.attributes.length;i++){const s=e.attributes[i],r=s.name,o=s.array,a=s.itemSize,c=new it(o,a);r==="color"&&(this._assignVertexColorSpace(c,s.vertexColorSpace),c.normalized=!(o instanceof Float32Array)),t.setAttribute(r,c)}return t}_assignVertexColorSpace(e,t){if(t!==zt)return;const i=new ye;for(let s=0,r=e.count;s<r;s++)i.fromBufferAttribute(e,s).convertSRGBToLinear(),e.setXYZ(s,i.r,i.g,i.b)}_loadLibrary(e,t){const i=new Hn(this.manager);return i.setPath(this.decoderPath),i.setResponseType(t),i.setWithCredentials(this.withCredentials),new Promise((s,r)=>{i.load(e,s,void 0,r)})}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;const e=typeof WebAssembly!="object"||this.decoderConfig.type==="js",t=[];return e?t.push(this._loadLibrary("draco_decoder.js","text")):(t.push(this._loadLibrary("draco_wasm_wrapper.js","text")),t.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(t).then(i=>{const s=i[0];e||(this.decoderConfig.wasmBinary=i[1]);const r=S$.toString(),o=["/* draco decoder */",s,"","/* worker */",r.substring(r.indexOf("{")+1,r.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([o]))}),this.decoderPending}_getWorker(e,t){return this._initDecoder().then(()=>{if(this.workerPool.length<this.workerLimit){const s=new Worker(this.workerSourceURL);s._callbacks={},s._taskCosts={},s._taskLoad=0,s.postMessage({type:"init",decoderConfig:this.decoderConfig}),s.onmessage=function(r){const o=r.data;switch(o.type){case"decode":s._callbacks[o.id].resolve(o);break;case"error":s._callbacks[o.id].reject(o);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+o.type+'"')}},this.workerPool.push(s)}else this.workerPool.sort(function(s,r){return s._taskLoad>r._taskLoad?-1:1});const i=this.workerPool[this.workerPool.length-1];return i._taskCosts[e]=t,i._taskLoad+=t,i})}_releaseTask(e,t){e._taskLoad-=e._taskCosts[t],delete e._callbacks[t],delete e._taskCosts[t]}debug(){console.log("Task load: ",this.workerPool.map(e=>e._taskLoad))}dispose(){for(let e=0;e<this.workerPool.length;++e)this.workerPool[e].terminate();return this.workerPool.length=0,this.workerSourceURL!==""&&URL.revokeObjectURL(this.workerSourceURL),this}}function S$(){let n,e;onmessage=function(o){const a=o.data;switch(a.type){case"init":n=a.decoderConfig,e=new Promise(function(h){n.onModuleLoaded=function(d){h({draco:d})},DracoDecoderModule(n)});break;case"decode":const c=a.buffer,l=a.taskConfig;e.then(h=>{const d=h.draco,f=new d.Decoder;try{const p=t(d,f,new Int8Array(c),l),m=p.attributes.map(g=>g.array.buffer);p.index&&m.push(p.index.array.buffer),self.postMessage({type:"decode",id:a.id,geometry:p},m)}catch(p){console.error(p),self.postMessage({type:"error",id:a.id,error:p.message})}finally{d.destroy(f)}});break}};function t(o,a,c,l){const h=l.attributeIDs,d=l.attributeTypes;let f,p;const m=a.GetEncodedGeometryType(c);if(m===o.TRIANGULAR_MESH)f=new o.Mesh,p=a.DecodeArrayToMesh(c,c.byteLength,f);else if(m===o.POINT_CLOUD)f=new o.PointCloud,p=a.DecodeArrayToPointCloud(c,c.byteLength,f);else throw new Error("THREE.DRACOLoader: Unexpected geometry type.");if(!p.ok()||f.ptr===0)throw new Error("THREE.DRACOLoader: Decoding failed: "+p.error_msg());const g={index:null,attributes:[]};for(const y in h){const A=self[d[y]];let v,b;if(l.useUniqueIDs)b=h[y],v=a.GetAttributeByUniqueId(f,b);else{if(b=a.GetAttributeId(f,o[h[y]]),b===-1)continue;v=a.GetAttribute(f,b)}const _=s(o,a,f,y,A,v);y==="color"&&(_.vertexColorSpace=l.vertexColorSpace),g.attributes.push(_)}return m===o.TRIANGULAR_MESH&&(g.index=i(o,a,f)),o.destroy(f),g}function i(o,a,c){const h=c.num_faces()*3,d=h*4,f=o._malloc(d);a.GetTrianglesUInt32Array(c,d,f);const p=new Uint32Array(o.HEAPF32.buffer,f,h).slice();return o._free(f),{array:p,itemSize:1}}function s(o,a,c,l,h,d){const f=d.num_components(),m=c.num_points()*f,g=m*h.BYTES_PER_ELEMENT,y=r(o,h),A=o._malloc(g);a.GetAttributeDataArrayForAllPoints(c,d,y,g,A);const v=new h(o.HEAPF32.buffer,A,m).slice();return o._free(A),{name:l,array:v,itemSize:f}}function r(o,a){switch(a){case Float32Array:return o.DT_FLOAT32;case Int8Array:return o.DT_INT8;case Int16Array:return o.DT_INT16;case Int32Array:return o.DT_INT32;case Uint8Array:return o.DT_UINT8;case Uint16Array:return o.DT_UINT16;case Uint32Array:return o.DT_UINT32}}}class C${constructor(e=4){this.pool=e,this.queue=[],this.workers=[],this.workersResolve=[],this.workerStatus=0}_initWorker(e){if(!this.workers[e]){const t=this.workerCreator();t.addEventListener("message",this._onMessage.bind(this,e)),this.workers[e]=t}}_getIdleWorker(){for(let e=0;e<this.pool;e++)if(!(this.workerStatus&1<<e))return e;return-1}_onMessage(e,t){const i=this.workersResolve[e];if(i&&i(t),this.queue.length){const{resolve:s,msg:r,transfer:o}=this.queue.shift();this.workersResolve[e]=s,this.workers[e].postMessage(r,o)}else this.workerStatus^=1<<e}setWorkerCreator(e){this.workerCreator=e}setWorkerLimit(e){this.pool=e}postMessage(e,t){return new Promise(i=>{const s=this._getIdleWorker();s!==-1?(this._initWorker(s),this.workerStatus|=1<<s,this.workersResolve[s]=i,this.workers[s].postMessage(e,t)):this.queue.push({resolve:i,msg:e,transfer:t})})}dispose(){this.workers.forEach(e=>e.terminate()),this.workersResolve.length=0,this.workers.length=0,this.queue.length=0,this.workerStatus=0}}const E$=0,ZD=2,T$=1,$D=2,M$=0,I$=1,R$=10,P$=0,W3=9,q3=15,X3=16,Y3=22,J3=37,K3=43,Z3=76,$3=83,ez=97,tz=100,iz=103,nz=109,sz=165,rz=166;class B${constructor(){this.vkFormat=0,this.typeSize=1,this.pixelWidth=0,this.pixelHeight=0,this.pixelDepth=0,this.layerCount=0,this.faceCount=1,this.supercompressionScheme=0,this.levels=[],this.dataFormatDescriptor=[{vendorId:0,descriptorType:0,descriptorBlockSize:0,versionNumber:2,colorModel:0,colorPrimaries:1,transferFunction:2,flags:0,texelBlockDimension:[0,0,0,0],bytesPlane:[0,0,0,0,0,0,0,0],samples:[]}],this.keyValue={},this.globalData=null}}class Rm{constructor(e,t,i,s){this._dataView=new DataView(e.buffer,e.byteOffset+t,i),this._littleEndian=s,this._offset=0}_nextUint8(){const e=this._dataView.getUint8(this._offset);return this._offset+=1,e}_nextUint16(){const e=this._dataView.getUint16(this._offset,this._littleEndian);return this._offset+=2,e}_nextUint32(){const e=this._dataView.getUint32(this._offset,this._littleEndian);return this._offset+=4,e}_nextUint64(){const e=this._dataView.getUint32(this._offset,this._littleEndian)+4294967296*this._dataView.getUint32(this._offset+4,this._littleEndian);return this._offset+=8,e}_nextInt32(){const e=this._dataView.getInt32(this._offset,this._littleEndian);return this._offset+=4,e}_skip(e){return this._offset+=e,this}_scan(e,t=0){const i=this._offset;let s=0;for(;this._dataView.getUint8(this._offset)!==t&&s<e;)s++,this._offset++;return s<e&&this._offset++,new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+i,s)}}const rr=[171,75,84,88,32,50,48,187,13,10,26,10];function eO(n){return typeof TextDecoder<"u"?new TextDecoder().decode(n):Buffer.from(n).toString("utf8")}function D$(n){const e=new Uint8Array(n.buffer,n.byteOffset,rr.length);if(e[0]!==rr[0]||e[1]!==rr[1]||e[2]!==rr[2]||e[3]!==rr[3]||e[4]!==rr[4]||e[5]!==rr[5]||e[6]!==rr[6]||e[7]!==rr[7]||e[8]!==rr[8]||e[9]!==rr[9]||e[10]!==rr[10]||e[11]!==rr[11])throw new Error("Missing KTX 2.0 identifier.");const t=new B$,i=17*Uint32Array.BYTES_PER_ELEMENT,s=new Rm(n,rr.length,i,!0);t.vkFormat=s._nextUint32(),t.typeSize=s._nextUint32(),t.pixelWidth=s._nextUint32(),t.pixelHeight=s._nextUint32(),t.pixelDepth=s._nextUint32(),t.layerCount=s._nextUint32(),t.faceCount=s._nextUint32();const r=s._nextUint32();t.supercompressionScheme=s._nextUint32();const o=s._nextUint32(),a=s._nextUint32(),c=s._nextUint32(),l=s._nextUint32(),h=s._nextUint64(),d=s._nextUint64(),f=new Rm(n,rr.length+i,3*r*8,!0);for(let U=0;U<r;U++)t.levels.push({levelData:new Uint8Array(n.buffer,n.byteOffset+f._nextUint64(),f._nextUint64()),uncompressedByteLength:f._nextUint64()});const p=new Rm(n,o,a,!0),m={vendorId:p._skip(4)._nextUint16(),descriptorType:p._nextUint16(),versionNumber:p._nextUint16(),descriptorBlockSize:p._nextUint16(),colorModel:p._nextUint8(),colorPrimaries:p._nextUint8(),transferFunction:p._nextUint8(),flags:p._nextUint8(),texelBlockDimension:[p._nextUint8(),p._nextUint8(),p._nextUint8(),p._nextUint8()],bytesPlane:[p._nextUint8(),p._nextUint8(),p._nextUint8(),p._nextUint8(),p._nextUint8(),p._nextUint8(),p._nextUint8(),p._nextUint8()],samples:[]},g=(m.descriptorBlockSize/4-6)/4;for(let U=0;U<g;U++){const H={bitOffset:p._nextUint16(),bitLength:p._nextUint8(),channelType:p._nextUint8(),samplePosition:[p._nextUint8(),p._nextUint8(),p._nextUint8(),p._nextUint8()],sampleLower:-1/0,sampleUpper:1/0};64&H.channelType?(H.sampleLower=p._nextInt32(),H.sampleUpper=p._nextInt32()):(H.sampleLower=p._nextUint32(),H.sampleUpper=p._nextUint32()),m.samples[U]=H}t.dataFormatDescriptor.length=0,t.dataFormatDescriptor.push(m);const y=new Rm(n,c,l,!0);for(;y._offset<l;){const U=y._nextUint32(),H=y._scan(U),Y=eO(H),J=y._scan(U-H.byteLength);t.keyValue[Y]=Y.match(/^ktx/i)?eO(J):J,y._offset%4&&y._skip(4-y._offset%4)}if(d<=0)return t;const A=new Rm(n,h,d,!0),v=A._nextUint16(),b=A._nextUint16(),_=A._nextUint32(),T=A._nextUint32(),E=A._nextUint32(),M=A._nextUint32(),I=[];for(let U=0;U<r;U++)I.push({imageFlags:A._nextUint32(),rgbSliceByteOffset:A._nextUint32(),rgbSliceByteLength:A._nextUint32(),alphaSliceByteOffset:A._nextUint32(),alphaSliceByteLength:A._nextUint32()});const S=h+A._offset,C=S+_,D=C+T,G=D+E,Q=new Uint8Array(n.buffer,n.byteOffset+S,_),L=new Uint8Array(n.buffer,n.byteOffset+C,T),V=new Uint8Array(n.buffer,n.byteOffset+D,E),O=new Uint8Array(n.buffer,n.byteOffset+G,M);return t.globalData={endpointCount:v,selectorCount:b,imageDescs:I,endpointsData:Q,selectorsData:L,tablesData:V,extendedData:O},t}let QS,Gc,yT;const jS={env:{emscripten_notify_memory_growth:function(n){yT=new Uint8Array(Gc.exports.memory.buffer)}}};class O${init(){return QS||(QS=typeof fetch<"u"?fetch("data:application/wasm;base64,"+tO).then(e=>e.arrayBuffer()).then(e=>WebAssembly.instantiate(e,jS)).then(this._init):WebAssembly.instantiate(Buffer.from(tO,"base64"),jS).then(this._init),QS)}_init(e){Gc=e.instance,jS.env.emscripten_notify_memory_growth(0)}decode(e,t=0){if(!Gc)throw new Error("ZSTDDecoder: Await .init() before decoding.");const i=e.byteLength,s=Gc.exports.malloc(i);yT.set(e,s),t=t||Number(Gc.exports.ZSTD_findDecompressedSize(s,i));const r=Gc.exports.malloc(t),o=Gc.exports.ZSTD_decompress(r,t,s,i),a=yT.slice(r,r+o);return Gc.exports.free(s),Gc.exports.free(r),a}}const tO="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IAMNACAEQQNxBEADQCACRQ0FIAAgAkF/aiICaiIDIAEgAmotAAA6AAAgA0EDcQ0ACwsgAkEDTQ0AA0AgACACQXxqIgJqIAEgAmooAgA2AgAgAkEDSw0ACwsgAkUNAgNAIAAgAkF/aiICaiABIAJqLQAAOgAAIAINAAsMAgsgAkEDTQ0AIAIhBANAIAMgASgCADYCACABQQRqIQEgA0EEaiEDIARBfGoiBEEDSw0ACyACQQNxIQILIAJFDQADQCADIAEtAAA6AAAgA0EBaiEDIAFBAWohASACQX9qIgINAAsLIAAL8wICAn8BfgJAIAJFDQAgACACaiIDQX9qIAE6AAAgACABOgAAIAJBA0kNACADQX5qIAE6AAAgACABOgABIANBfWogAToAACAAIAE6AAIgAkEHSQ0AIANBfGogAToAACAAIAE6AAMgAkEJSQ0AIABBACAAa0EDcSIEaiIDIAFB/wFxQYGChAhsIgE2AgAgAyACIARrQXxxIgRqIgJBfGogATYCACAEQQlJDQAgAyABNgIIIAMgATYCBCACQXhqIAE2AgAgAkF0aiABNgIAIARBGUkNACADIAE2AhggAyABNgIUIAMgATYCECADIAE2AgwgAkFwaiABNgIAIAJBbGogATYCACACQWhqIAE2AgAgAkFkaiABNgIAIAQgA0EEcUEYciIEayICQSBJDQAgAa0iBUIghiAFhCEFIAMgBGohAQNAIAEgBTcDGCABIAU3AxAgASAFNwMIIAEgBTcDACABQSBqIQEgAkFgaiICQR9LDQALCyAACy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAIajYCACADCy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAFajYCACADCx8AIAAgASACKAIEEAg2AgAgARAEGiAAIAJBCGo2AgQLCAAgAGdBH3MLugUBDX8jAEEQayIKJAACfyAEQQNNBEAgCkEANgIMIApBDGogAyAEEAsaIAAgASACIApBDGpBBBAVIgBBbCAAEAMbIAAgACAESxsMAQsgAEEAIAEoAgBBAXRBAmoQECENQVQgAygAACIGQQ9xIgBBCksNABogAiAAQQVqNgIAIAMgBGoiAkF8aiEMIAJBeWohDiACQXtqIRAgAEEGaiELQQQh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ASIDNgLE4AEgACgCvOABIQQgACABNgK84AEgACABIAJqNgK44AEgACABIAQgA2tqNgLA4AELpgEBAX8gACAAKALs4QEQFjYCyOABIABCADcD+OABIABCADcDuOABIABBwOABakIANwMAIABBqNAAaiIBQYyAgOAANgIAIABBADYCmOIBIABCADcDiOEBIABCAzcDgOEBIABBrNABakHgEikCADcCACAAQbTQAWpB6BIoAgA2AgAgACABNgIMIAAgAEGYIGo2AgggACAAQaAwajYCBCAAIABBEGo2AgALYQEBf0G4fyEDAkAgAUEDSQ0AIAIgABAhIgFBA3YiADYCCCACIAFBAXE2AgQgAiABQQF2QQNxIgM2AgACQCADQX9qIgFBAksNAAJAIAFBAWsOAgEAAgtBbA8LIAAhAwsgAwsMACAAIAEgAkEAEC4LiAQCA38CfiADEBYhBCAAQQBBKBAQIQAgBCACSwRAIAQPCyABRQRAQX8PCwJAAkAgA0EBRg0AIAEoAAAiBkGo6r5pRg0AQXYhAyAGQXBxQdDUtMIBRw0BQQghAyACQQhJDQEgAEEAQSgQECEAIAEoAAQhASAAQQE2AhQgACABrTcDAEEADwsgASACIAMQLyIDIAJLDQAgACADNgIYQXIhAyABIARqIgVBf2otAAAiAkEIcQ0AIAJBIHEiBkUEQEFwIQMgBS0AACIFQacBSw0BIAVBB3GtQgEgBUEDdkEKaq2GIgdCA4h+IAd8IQggBEEBaiEECyACQQZ2IQMgAkECdiEFAkAgAkEDcUF/aiICQQJLBEBBACECDAELAkACQAJAIAJBAWsOAgECAAsgASAEai0AACECIARBAWohBAwCCyABIARqLwAAIQIgBEECaiEEDAELIAEgBGooAAAhAiAEQQRqIQQLIAVBAXEhBQJ+AkACQAJAIANBf2oiA0ECTQRAIANBAWsOAgIDAQtCfyAGRQ0DGiABIARqMQAADAMLIAEgBGovAACtQoACfAwCCyABIARqKAAArQwBCyABIARqKQAACyEHIAAgBTYCICAAIAI2AhwgACAHNwMAQQAhAyAAQQA2AhQgACAHIAggBhsiBzcDCCAAIAdCgIAIIAdCgIAIVBs+AhALIAMLWwEBf0G4fyEDIAIQFiICIAFNBH8gACACakF/ai0AACIAQQNxQQJ0QaAeaigC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C0Egak8NAQsgByAHKQNoNwMQIAcgBykDYDcDCCAEIA0gB0EIaiAHQdwAaiAPIA4gESAQEB4hCwwBCyACIARqIQggBCAKEAcgAkERTwRAIARBEGohAgNAIAIgCkEQaiIKEAcgAkEQaiICIAhJDQALCyAIIAlrIQIgByATNgJcIAkgCCAOa0sEQCAJIAggEWtLBEBBbCELDAILIBAgAiAOayICaiIKIANqIBBNBEAgCCAKIAMQDxoMAgsgCCAKQQAgAmsQDyEIIAcgAiADaiIDNgJkIAggAmshCCAOIQILIAlBEE8EQCADIAhqIQMDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALDAELAkAgCUEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgCUECdCIDQcAeaigCAGoiAhAXIAIgA0HgHmooAgBrIQIgBygCZCEDDAELIAggAhAMCyADQQlJDQAgAyAIaiEDIAhBCGoiCCACQQhqIgJrQQ9MBEADQCAIIAIQDCACQQhqIQIgCEEIaiIIIANJDQAMAgALAAsDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALCyAHQRhqEAQaIAsgDCALEAMiAhshDCAEIAQgC2ogAhshBCAFQX9qIgUNAAsgDBADDQFBbCEMIAdBGGoQBEECSQ0BQQAhCANAIAhBA0cEQCAAIAhBAnQiAmpBrNABaiACIAdqKAJENgIAIAhBAWohCAwBCwsgBygCXCEIC0G6fyEMIA8gCGsiACANIARrSw0AIAQEfyAEIAggABALIABqBUEACyABayEMCyAHQfAAaiQAIAwLkRcCFn8FfiMAQdABayIHJAAgByAAKALw4QEiCDYCvAEgASACaiESIAggACgCgOIBaiETAkACQCAFRQRAIAEhAwwBCyAAKALE4AEhESAAKALA4AEhFSAAKAK84AEhDyAAQQE2AozhAUEAIQgDQCAIQQNHBEAgByAIQQJ0IgJqIAAgAmpBrNABaigCADYCVCAIQQFqIQgMAQsLIAcgETYCZCAHIA82AmAgByABIA9rNgJoQWwhECAHQShqIAMgBBAGEAMNASAFQQQgBUEESBshFyAHQTxqIAdBKGogACgCABATIAdBxABqIAdBKGogACgCCBATIAdBzABqIAdB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IAdB0AFqJAAgEAslACAAQgA3AgAgAEEAOwEIIABBADoACyAAIAE2AgwgACACOgAKC7QFAQN/IwBBMGsiBCQAIABB/wFqIgVBfWohBgJAIAMvAQIEQCAEQRhqIAEgAhAGIgIQAw0BIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahASOgAAIAMgBEEIaiAEQRhqEBI6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0FIAEgBEEQaiAEQRhqEBI6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBSABIARBCGogBEEYahASOgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEjoAACABIAJqIABrIQIMAwsgAyAEQRBqIARBGGoQEjoAAiADIARBCGogBEEYahASOgADIANBBGohAwwAAAsACyAEQRhqIAEgAhAGIgIQAw0AIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahAROgAAIAMgBEEIaiAEQRhqEBE6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0EIAEgBEEQaiAEQRhqEBE6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBCABIARBCGogBEEYahAROgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEToAACABIAJqIABrIQIMAgsgAyAEQRBqIARBGGoQEToAAiADIARBCGogBEEYahAROgADIANBBGohAwwAAAsACyAEQTBqJAAgAgtpAQF/An8CQAJAIAJBB00NACABKAAAQbfIwuF+Rw0AIAAgASgABDYCmOIBQWIgAEEQaiABIAIQPiIDEAMNAhogAEKBgICAEDcDiOEBIAAgASADaiACIANrECoMAQsgACABIAIQKgtBAAsLrQMBBn8jAEGAAWsiAyQAQWIhCAJAIAJBCUkNACAAQZjQAGogAUEIaiIEIAJBeGogAEGY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wOABCwutAgIEfwF+IwBBQGoiBCQAAkACQCACQQhJDQAgASgAAEFwcUHQ1LTCAUcNACABIAIQIiEBIABCADcDCCAAQQA2AgQgACABNgIADAELIARBGGogASACEC0iAxADBEAgACADEBoMAQsgAwRAIABBuH8QGgwBCyACIAQoAjAiA2shAiABIANqIQMDQAJAIAAgAyACIARBCGoQLCIFEAMEfyAFBSACIAVBA2oiBU8NAUG4fwsQGgwCCyAGQQFqIQYgAiAFayECIAMgBWohAyAEKAIMRQ0ACyAEKAI4BEAgAkEDTQRAIABBuH8QGgwCCyADQQRqIQMLIAQoAighAiAEKQMYIQcgAEEANgIEIAAgAyABazYCACAAIAIgBmytIAcgB0J/URs3AwgLIARBQGskAAslAQF/IwBBEGsiAiQAIAIgACABEFEgAigCACEAIAJBEGokACAAC30BBH8jAEGQBGsiBCQAIARB/wE2AggCQCAEQRBqIARBCGogBEEMaiABIAIQFSIGEAMEQCAGIQUMAQtBVCEFIAQoAgwiB0EGSw0AIAMgBEEQaiAEKAIIIAcQQSIFEAMNACAAIAEgBmogAiAGayADEDwhBQsgBEGQBGokACAFC4cBAgJ/An5BABAWIQMCQANAIAEgA08EQAJAIAAoAABBcHFB0NS0wgFGBEAgACABECIiAhADRQ0BQn4PCyAAIAEQVSIEQn1WDQMgBCAFfCIFIARUIQJCfiEEIAINAyAAIAEQUiICEAMNAwsgASACayEBIAAgAmohAAwBCwtCfiAFIAEbIQQLIAQLPwIBfwF+IwBBMGsiAiQAAn5CfiACQQhqIAAgARAtDQAaQgAgAigCHEEBRg0AGiACKQMICyEDIAJBMGokACADC40BAQJ/IwBBMGsiASQAAkAgAEUNACAAKAKI4gENACABIABB/OEBaigCADYCKCABIAApAvThATcDICAAEDAgACgCqOIBIQIgASABKAIoNgIYIAEgASkDIDcDECACIAFBEGoQGyAAQQA2AqjiASABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALKgECfyMAQRBrIgAkACAAQQA2AgggAEIANwMAIAAQWCEBIABBEGokACABC4cBAQN/IwBBEGsiAiQAAkAgACgCAEUgACgCBEVzDQAgAiAAKAIINgIIIAIgACkCADcDAAJ/IAIoAgAiAQRAIAIoAghBqOMJIAERBQAMAQtBqOMJECgLIgFFDQAgASAAKQIANwL04QEgAUH84QFqIAAoAgg2AgAgARBZIAEhAwsgAkEQaiQAIAMLywEBAn8jAEEgayIBJAAgAEGBgIDAADYCtOIBIABBADYCiOIBIABBADYC7OEBIABCADcDkOIBIABBADYCpOMJIABBADYC3OIBIABCADcCzOIBIABBADYCvOIBIABBADYCxOABIABCADcCnOIBIABBpOIBakIANwIAIABBrOIBakEANgIAIAFCADcCECABQgA3AhggASABKQMYNwMIIAEgASkDEDcDACABKAIIQQh2QQFxIQIgAEEANgLg4gEgACACNgKM4gEgAUEgaiQAC3YBA38jAEEwayIBJAAgAARAIAEgAEHE0AFqIgIoAgA2AiggASAAKQK80AE3AyAgACgCACEDIAEgAigCADYCGCABIAApArzQATcDECADIAFBEGoQGyABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALzAEBAX8gACABKAK00AE2ApjiASAAIAEoAgQiAjYCwOABIAAgAjYCvOABIAAgAiABKAIIaiICNgK44AEgACACNgLE4AEgASgCuNABBEAgAEKBgICAEDcDiOEBIAAgAUGk0ABqNgIMIAAgAUGUIGo2AgggACABQZwwajYCBCAAIAFBDGo2AgAgAEGs0AFqIAFBqNABaigCADYCACAAQbDQAWogAUGs0AFqKAIANgIAIABBtNABaiABQbDQAWooAgA2AgAPCyAAQgA3A4jhAQs7ACACRQRAQbp/DwsgBEUEQEFsDwsgAiAEEGAEQCAAIAEgAiADIAQgBRBhDwsgACABIAIgAyAEIAUQZQtGAQF/IwBBEGsiBSQAIAVBCGogBBAOAn8gBS0ACQRAIAAgASACIAMgBBAyDAELIAAgASACIAMgBBA0CyEAIAVBEGokACAACzQAIAAgAyAEIAUQNiIFEAMEQCAFDwsgBSAESQR/IAEgAiADIAVqIAQgBWsgABA1BUG4fwsLRgEBfyMAQRBrIgUkACAFQQhqIAQQDgJ/IAUtAAkEQCAAIAEgAiADIAQQYgwBCyAAIAEgAiADIAQQNQshACAFQRBqJAAgAAtZAQF/QQ8hAiABIABJBEAgAUEE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",WS=new WeakMap;let qS=0,XS;class la extends Ms{constructor(e){super(e),this.transcoderPath="",this.transcoderBinary=null,this.transcoderPending=null,this.workerPool=new C$,this.workerSourceURL="",this.workerConfig=null,typeof MSC_TRANSCODER<"u"&&console.warn('THREE.KTX2Loader: Please update to latest "basis_transcoder". "msc_basis_transcoder" is no longer supported in three.js r125+.')}setTranscoderPath(e){return this.transcoderPath=e,this}setWorkerLimit(e){return this.workerPool.setWorkerLimit(e),this}async detectSupportAsync(e){return this.workerConfig={astcSupported:await e.hasFeatureAsync("texture-compression-astc"),etc1Supported:await e.hasFeatureAsync("texture-compression-etc1"),etc2Supported:await e.hasFeatureAsync("texture-compression-etc2"),dxtSupported:await e.hasFeatureAsync("texture-compression-bc"),bptcSupported:await e.hasFeatureAsync("texture-compression-bptc"),pvrtcSupported:await e.hasFeatureAsync("texture-compression-pvrtc")},this}detectSupport(e){return e.isWebGPURenderer===!0?this.workerConfig={astcSupported:e.hasFeature("texture-compression-astc"),etc1Supported:e.hasFeature("texture-compression-etc1"),etc2Supported:e.hasFeature("texture-compression-etc2"),dxtSupported:e.hasFeature("texture-compression-bc"),bptcSupported:e.hasFeature("texture-compression-bptc"),pvrtcSupported:e.hasFeature("texture-compression-pvrtc")}:(this.workerConfig={astcSupported:e.extensions.has("WEBGL_compressed_texture_astc"),etc1Supported:e.extensions.has("WEBGL_compressed_texture_etc1"),etc2Supported:e.extensions.has("WEBGL_compressed_texture_etc"),dxtSupported:e.extensions.has("WEBGL_compressed_texture_s3tc"),bptcSupported:e.extensions.has("EXT_texture_compression_bptc"),pvrtcSupported:e.extensions.has("WEBGL_compressed_texture_pvrtc")||e.extensions.has("WEBKIT_WEBGL_compressed_texture_pvrtc")},e.capabilities.isWebGL2&&(this.workerConfig.etc1Supported=!1)),this}init(){if(!this.transcoderPending){const e=new Hn(this.manager);e.setPath(this.transcoderPath),e.setWithCredentials(this.withCredentials);const t=e.loadAsync("basis_transcoder.js"),i=new Hn(this.manager);i.setPath(this.transcoderPath),i.setResponseType("arraybuffer"),i.setWithCredentials(this.withCredentials);const s=i.loadAsync("basis_transcoder.wasm");this.transcoderPending=Promise.all([t,s]).then(([r,o])=>{const a=la.BasisWorker.toString(),c=["/* constants */","let _EngineFormat = "+JSON.stringify(la.EngineFormat),"let _TranscoderFormat = "+JSON.stringify(la.TranscoderFormat),"let _BasisFormat = "+JSON.stringify(la.BasisFormat),"/* basis_transcoder.js */",r,"/* worker */",a.substring(a.indexOf("{")+1,a.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([c])),this.transcoderBinary=o,this.workerPool.setWorkerCreator(()=>{const l=new Worker(this.workerSourceURL),h=this.transcoderBinary.slice(0);return l.postMessage({type:"init",config:this.workerConfig,transcoderBinary:h},[h]),l})}),qS>0&&console.warn("THREE.KTX2Loader: Multiple active KTX2 loaders may cause performance issues. Use a single KTX2Loader instance, or call .dispose() on old instances."),qS++}return this.transcoderPending}load(e,t,i,s){if(this.workerConfig===null)throw new Error("THREE.KTX2Loader: Missing initialization with `.detectSupport( renderer )`.");const r=new Hn(this.manager);r.setResponseType("arraybuffer"),r.setWithCredentials(this.withCredentials),r.load(e,o=>{if(WS.has(o))return WS.get(o).promise.then(t).catch(s);this._createTexture(o).then(a=>t?t(a):null).catch(s)},i,s)}_createTextureFrom(e,t){const{faces:i,width:s,height:r,format:o,type:a,error:c,dfdFlags:l}=e;if(a==="error")return Promise.reject(c);let h;if(t.faceCount===6)h=new M2(i,o,gi);else{const d=i[0].mipmaps;h=t.layerCount>1?new T2(d,s,r,t.layerCount,o,gi):new lc(d,s,r,o,gi)}return h.minFilter=i[0].mipmaps.length===1?St:kr,h.magFilter=St,h.generateMipmaps=!1,h.needsUpdate=!0,h.colorSpace=oz(t),h.premultiplyAlpha=!!(l&T$),h}async _createTexture(e,t={}){const i=D$(new Uint8Array(e));if(i.vkFormat!==P$)return L$(i);const s=t,r=this.init().then(()=>this.workerPool.postMessage({type:"transcode",buffer:e,taskConfig:s},[e])).then(o=>this._createTextureFrom(o.data,i));return WS.set(e,{promise:r}),r}dispose(){return this.workerPool.dispose(),this.workerSourceURL&&URL.revokeObjectURL(this.workerSourceURL),qS--,this}}la.BasisFormat={ETC1S:0,UASTC_4x4:1};la.TranscoderFormat={ETC1:0,ETC2:1,BC1:2,BC3:3,BC4:4,BC5:5,BC7_M6_OPAQUE_ONLY:6,BC7_M5:7,PVRTC1_4_RGB:8,PVRTC1_4_RGBA:9,ASTC_4x4:10,ATC_RGB:11,ATC_RGBA_INTERPOLATED_ALPHA:12,RGBA32:13,RGB565:14,BGR565:15,RGBA4444:16};la.EngineFormat={RGBAFormat:xi,RGBA_ASTC_4x4_Format:sb,RGBA_BPTC_Format:ig,RGBA_ETC2_EAC_Format:nb,RGBA_PVRTC_4BPPV1_Format:tb,RGBA_S3TC_DXT5_Format:tg,RGB_ETC1_Format:C_,RGB_ETC2_Format:ib,RGB_PVRTC_4BPPV1_Format:eb,RGB_S3TC_DXT1_Format:eg};la.BasisWorker=function(){let n,e,t;const i=_EngineFormat,s=_TranscoderFormat,r=_BasisFormat;self.addEventListener("message",function(m){const g=m.data;switch(g.type){case"init":n=g.config,o(g.transcoderBinary);break;case"transcode":e.then(()=>{try{const{faces:y,buffers:A,width:v,height:b,hasAlpha:_,format:T,dfdFlags:E}=a(g.buffer);self.postMessage({type:"transcode",id:g.id,faces:y,width:v,height:b,hasAlpha:_,format:T,dfdFlags:E},A)}catch(y){console.error(y),self.postMessage({type:"error",id:g.id,error:y.message})}});break}});function o(m){e=new Promise(g=>{t={wasmBinary:m,onRuntimeInitialized:g},BASIS(t)}).then(()=>{t.initializeBasis(),t.KTX2File===void 0&&console.warn("THREE.KTX2Loader: Please update Basis Universal transcoder.")})}function a(m){const g=new t.KTX2File(new Uint8Array(m));function y(){g.close(),g.delete()}if(!g.isValid())throw y(),new Error("THREE.KTX2Loader:	Invalid or unsupported .ktx2 file");const A=g.isUASTC()?r.UASTC_4x4:r.ETC1S,v=g.getWidth(),b=g.getHeight(),_=g.getLayers()||1,T=g.getLevels(),E=g.getFaces(),M=g.getHasAlpha(),I=g.getDFDFlags(),{transcoderFormat:S,engineFormat:C}=d(A,v,b,M);if(!v||!b||!T)throw y(),new Error("THREE.KTX2Loader:	Invalid texture");if(!g.startTranscoding())throw y(),new Error("THREE.KTX2Loader: .startTranscoding failed");const D=[],G=[];for(let Q=0;Q<E;Q++){const L=[];for(let V=0;V<T;V++){const O=[];let U,H;for(let J=0;J<_;J++){const se=g.getImageLevelInfo(V,J,Q);Q===0&&V===0&&J===0&&(se.origWidth%4!==0||se.origHeight%4!==0)&&console.warn("THREE.KTX2Loader: ETC1S and UASTC textures should use multiple-of-four dimensions."),T>1?(U=se.origWidth,H=se.origHeight):(U=se.width,H=se.height);const fe=new Uint8Array(g.getImageTranscodedSizeInBytes(V,J,0,S));if(!g.transcodeImage(fe,V,J,Q,S,0,-1,-1))throw y(),new Error("THREE.KTX2Loader: .transcodeImage failed.");O.push(fe)}const Y=p(O);L.push({data:Y,width:U,height:H}),G.push(Y.buffer)}D.push({mipmaps:L,width:v,height:b,format:C})}return y(),{faces:D,buffers:G,width:v,height:b,hasAlpha:M,format:C,dfdFlags:I}}const c=[{if:"astcSupported",basisFormat:[r.UASTC_4x4],transcoderFormat:[s.ASTC_4x4,s.ASTC_4x4],engineFormat:[i.RGBA_ASTC_4x4_Format,i.RGBA_ASTC_4x4_Format],priorityETC1S:1/0,priorityUASTC:1,needsPowerOfTwo:!1},{if:"bptcSupported",basisFormat:[r.ETC1S,r.UASTC_4x4],transcoderFormat:[s.BC7_M5,s.BC7_M5],engineFormat:[i.RGBA_BPTC_Format,i.RGBA_BPTC_Format],priorityETC1S:3,priorityUASTC:2,needsPowerOfTwo:!1},{if:"dxtSupported",basisFormat:[r.ETC1S,r.UASTC_4x4],transcoderFormat:[s.BC1,s.BC3],engineFormat:[i.RGB_S3TC_DXT1_Format,i.RGBA_S3TC_DXT5_Format],priorityETC1S:4,priorityUASTC:5,needsPowerOfTwo:!1},{if:"etc2Supported",basisFormat:[r.ETC1S,r.UASTC_4x4],transcoderFormat:[s.ETC1,s.ETC2],engineFormat:[i.RGB_ETC2_Format,i.RGBA_ETC2_EAC_Format],priorityETC1S:1,priorityUASTC:3,needsPowerOfTwo:!1},{if:"etc1Supported",basisFormat:[r.ETC1S,r.UASTC_4x4],transcoderFormat:[s.ETC1],engineFormat:[i.RGB_ETC1_Format],priorityETC1S:2,priorityUASTC:4,needsPowerOfTwo:!1},{if:"pvrtcSupported",basisFormat:[r.ETC1S,r.UASTC_4x4],transcoderFormat:[s.PVRTC1_4_RGB,s.PVRTC1_4_RGBA],engineFormat:[i.RGB_PVRTC_4BPPV1_Format,i.RGBA_PVRTC_4BPPV1_Format],priorityETC1S:5,priorityUASTC:6,needsPowerOfTwo:!0}],l=c.sort(function(m,g){return m.priorityETC1S-g.priorityETC1S}),h=c.sort(function(m,g){return m.priorityUASTC-g.priorityUASTC});function d(m,g,y,A){let v,b;const _=m===r.ETC1S?l:h;for(let T=0;T<_.length;T++){const E=_[T];if(n[E.if]&&E.basisFormat.includes(m)&&!(A&&E.transcoderFormat.length<2)&&!(E.needsPowerOfTwo&&!(f(g)&&f(y))))return v=E.transcoderFormat[A?1:0],b=E.engineFormat[A?1:0],{transcoderFormat:v,engineFormat:b}}return console.warn("THREE.KTX2Loader: No suitable compressed texture format found. Decoding to RGBA32."),v=s.RGBA32,b=i.RGBAFormat,{transcoderFormat:v,engineFormat:b}}function f(m){return m<=2?!0:(m&m-1)===0&&m!==0}function p(m){if(m.length===1)return m[0];let g=0;for(let v=0;v<m.length;v++){const b=m[v];g+=b.byteLength}const y=new Uint8Array(g);let A=0;for(let v=0;v<m.length;v++){const b=m[v];y.set(b,A),A+=b.byteLength}return y}};const k$=new Set([xi,Sh,tc]),YS={[nz]:xi,[ez]:xi,[J3]:xi,[K3]:xi,[iz]:Sh,[$3]:Sh,[X3]:Sh,[Y3]:Sh,[tz]:tc,[Z3]:tc,[q3]:tc,[W3]:tc,[rz]:Qg,[sz]:Qg},JS={[nz]:Ji,[ez]:sn,[J3]:gi,[K3]:gi,[iz]:Ji,[$3]:sn,[X3]:gi,[Y3]:gi,[tz]:Ji,[Z3]:sn,[q3]:gi,[W3]:gi,[rz]:gi,[sz]:gi};async function L$(n){const{vkFormat:e}=n;if(YS[e]===void 0)throw new Error("THREE.KTX2Loader: Unsupported vkFormat.");let t;n.supercompressionScheme===ZD&&(XS||(XS=new Promise(async r=>{const o=new O$;await o.init(),r(o)})),t=await XS);const i=[];for(let r=0;r<n.levels.length;r++){const o=Math.max(1,n.pixelWidth>>r),a=Math.max(1,n.pixelHeight>>r),c=n.pixelDepth?Math.max(1,n.pixelDepth>>r):0,l=n.levels[r];let h;if(n.supercompressionScheme===E$)h=l.levelData;else if(n.supercompressionScheme===ZD)h=t.decode(l.levelData,l.uncompressedByteLength);else throw new Error("THREE.KTX2Loader: Unsupported supercompressionScheme.");let d;JS[e]===Ji?d=new Float32Array(h.buffer,h.byteOffset,h.byteLength/Float32Array.BYTES_PER_ELEMENT):JS[e]===sn?d=new Uint16Array(h.buffer,h.byteOffset,h.byteLength/Uint16Array.BYTES_PER_ELEMENT):d=h,i.push({data:d,width:o,height:a,depth:c})}let s;if(k$.has(YS[e]))s=n.pixelDepth===0?new io(i[0].data,n.pixelWidth,n.pixelHeight):new I_(i[0].data,n.pixelWidth,n.pixelHeight,n.pixelDepth);else{if(n.pixelDepth>0)throw new Error("THREE.KTX2Loader: Unsupported pixelDepth.");s=new lc(i,n.pixelWidth,n.pixelHeight)}return s.mipmaps=i,s.type=JS[e],s.format=YS[e],s.colorSpace=oz(n),s.needsUpdate=!0,Promise.resolve(s)}function oz(n){const e=n.dataFormatDescriptor[0];return e.colorPrimaries===I$?e.transferFunction===$D?zt:Ri:e.colorPrimaries===R$?e.transferFunction===$D?kA:Cp:(e.colorPrimaries===M$||console.warn(`THREE.KTX2Loader: Unsupported color primaries, "${e.colorPrimaries}"`),is)}const ep=re("debugdecoders"),iO="https://www.gstatic.com/draco/versioned/decoders/1.4.1/",nO="https://www.gstatic.com/basis-universal/versioned/2021-04-15-ba1c3e4/";let sa,KS,yh;function sO(n){n!==void 0&&typeof n=="string"&&(sa||(sa=new cI),ep&&console.log("Setting draco decoder path to",n),sa.setDecoderPath(n))}function rO(n){n!==void 0&&typeof n=="string"&&(sa||(sa=new cI),ep&&console.log("Setting draco decoder type to",n),sa.setDecoderConfig({type:n}))}function oO(n){n!==void 0&&typeof n=="string"&&(yh||(yh=new la),ep&&console.log("Setting ktx2 transcoder path to",n),yh.setTranscoderPath(n))}function nv(n,e){sa||(sa=new cI,sa.setDecoderPath(iO),sa.setDecoderConfig({type:"js"}),ep&&console.log("Setting draco decoder path to",iO)),yh||(yh=new la,yh.setTranscoderPath(nO),ep&&console.log("Setting ktx2 transcoder path to",nO)),KS||(KS=w$,ep&&console.log("Using the default meshopt decoder")),e.renderer?yh.detectSupport(e.renderer):console.warn("No renderer provided to detect ktx2 support - loading KTX2 textures will probably fail"),n.setDRACOLoader(sa),n.setKTX2Loader(yh),n.setMeshoptDecoder(KS)}function aO(n,e){if(e===NL)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),n;if(e===rb||e===mM){let t=n.getIndex();if(t===null){const o=[],a=n.getAttribute("position");if(a!==void 0){for(let c=0;c<a.count;c++)o.push(c);n.setIndex(o),t=n.getIndex()}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),n}const i=t.count-2,s=[];if(e===rb)for(let o=1;o<=i;o++)s.push(t.getX(0)),s.push(t.getX(o)),s.push(t.getX(o+1));else for(let o=0;o<i;o++)o%2===0?(s.push(t.getX(o)),s.push(t.getX(o+1)),s.push(t.getX(o+2))):(s.push(t.getX(o+2)),s.push(t.getX(o+1)),s.push(t.getX(o)));s.length/3!==i&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const r=n.clone();return r.setIndex(s),r.clearGroups(),r}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",e),n}class Gp extends Ms{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(t){return new G$(t)}),this.register(function(t){return new J$(t)}),this.register(function(t){return new K$(t)}),this.register(function(t){return new Z$(t)}),this.register(function(t){return new H$(t)}),this.register(function(t){return new Q$(t)}),this.register(function(t){return new j$(t)}),this.register(function(t){return new W$(t)}),this.register(function(t){return new z$(t)}),this.register(function(t){return new q$(t)}),this.register(function(t){return new V$(t)}),this.register(function(t){return new Y$(t)}),this.register(function(t){return new X$(t)}),this.register(function(t){return new U$(t)}),this.register(function(t){return new $$(t)}),this.register(function(t){return new eee(t)})}load(e,t,i,s){const r=this;let o;if(this.resourcePath!=="")o=this.resourcePath;else if(this.path!==""){const l=Ih.extractUrlBase(e);o=Ih.resolveURL(l,this.path)}else o=Ih.extractUrlBase(e);this.manager.itemStart(e);const a=function(l){s?s(l):console.error(l),r.manager.itemError(e),r.manager.itemEnd(e)},c=new Hn(this.manager);c.setPath(this.path),c.setResponseType("arraybuffer"),c.setRequestHeader(this.requestHeader),c.setWithCredentials(this.withCredentials),c.load(e,function(l){try{r.parse(l,o,function(h){t(h),r.manager.itemEnd(e)},a)}catch(h){a(h)}},i,a)}setDRACOLoader(e){return this.dracoLoader=e,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return this.pluginCallbacks.indexOf(e)===-1&&this.pluginCallbacks.push(e),this}unregister(e){return this.pluginCallbacks.indexOf(e)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,i,s){let r;const o={},a={},c=new TextDecoder;if(typeof e=="string")r=JSON.parse(e);else if(e instanceof ArrayBuffer)if(c.decode(new Uint8Array(e,0,4))===az){try{o[si.KHR_BINARY_GLTF]=new tee(e)}catch(d){s&&s(d);return}r=JSON.parse(o[si.KHR_BINARY_GLTF].content)}else r=JSON.parse(c.decode(e));else r=e;if(r.asset===void 0||r.asset.version[0]<2){s&&s(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}const l=new pee(r,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});l.fileLoader.setRequestHeader(this.requestHeader);for(let h=0;h<this.pluginCallbacks.length;h++){const d=this.pluginCallbacks[h](l);d.name||console.error("THREE.GLTFLoader: Invalid plugin found: missing name"),a[d.name]=d,o[d.name]=!0}if(r.extensionsUsed)for(let h=0;h<r.extensionsUsed.length;++h){const d=r.extensionsUsed[h],f=r.extensionsRequired||[];switch(d){case si.KHR_MATERIALS_UNLIT:o[d]=new N$;break;case si.KHR_DRACO_MESH_COMPRESSION:o[d]=new iee(r,this.dracoLoader);break;case si.KHR_TEXTURE_TRANSFORM:o[d]=new nee;break;case si.KHR_MESH_QUANTIZATION:o[d]=new see;break;default:f.indexOf(d)>=0&&a[d]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+d+'".')}}l.setExtensions(o),l.setPlugins(a),l.parse(i,s)}parseAsync(e,t){const i=this;return new Promise(function(s,r){i.parse(e,t,s,r)})}}function F$(){let n={};return{get:function(e){return n[e]},add:function(e,t){n[e]=t},remove:function(e){delete n[e]},removeAll:function(){n={}}}}const si={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_ANISOTROPY:"KHR_materials_anisotropy",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_MATERIALS_BUMP:"EXT_materials_bump",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class U${constructor(e){this.parser=e,this.name=si.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,t=this.parser.json.nodes||[];for(let i=0,s=t.length;i<s;i++){const r=t[i];r.extensions&&r.extensions[this.name]&&r.extensions[this.name].light!==void 0&&e._addNodeRef(this.cache,r.extensions[this.name].light)}}_loadLight(e){const t=this.parser,i="light:"+e;let s=t.cache.get(i);if(s)return s;const r=t.json,c=((r.extensions&&r.extensions[this.name]||{}).lights||[])[e];let l;const h=new ye(16777215);c.color!==void 0&&h.setRGB(c.color[0],c.color[1],c.color[2],Ri);const d=c.range!==void 0?c.range:0;switch(c.type){case"directional":l=new mp(h),l.target.position.set(0,0,-1),l.add(l.target);break;case"point":l=new J_(h),l.distance=d;break;case"spot":l=new Y_(h),l.distance=d,c.spot=c.spot||{},c.spot.innerConeAngle=c.spot.innerConeAngle!==void 0?c.spot.innerConeAngle:0,c.spot.outerConeAngle=c.spot.outerConeAngle!==void 0?c.spot.outerConeAngle:Math.PI/4,l.angle=c.spot.outerConeAngle,l.penumbra=1-c.spot.innerConeAngle/c.spot.outerConeAngle,l.target.position.set(0,0,-1),l.add(l.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+c.type)}return l.position.set(0,0,0),l.decay=2,dh(l,c),c.intensity!==void 0&&(l.intensity=c.intensity),l.name=t.createUniqueName(c.name||"light_"+e),s=Promise.resolve(l),t.cache.add(i,s),s}getDependency(e,t){if(e==="light")return this._loadLight(t)}createNodeAttachment(e){const t=this,i=this.parser,r=i.json.nodes[e],a=(r.extensions&&r.extensions[this.name]||{}).light;return a===void 0?null:this._loadLight(a).then(function(c){return i._getNodeRef(t.cache,a,c)})}}let N$=class{constructor(){this.name=si.KHR_MATERIALS_UNLIT}getMaterialType(){return ri}extendParams(e,t,i){const s=[];e.color=new ye(1,1,1),e.opacity=1;const r=t.pbrMetallicRoughness;if(r){if(Array.isArray(r.baseColorFactor)){const o=r.baseColorFactor;e.color.setRGB(o[0],o[1],o[2],Ri),e.opacity=o[3]}r.baseColorTexture!==void 0&&s.push(i.assignTexture(e,"map",r.baseColorTexture,zt))}return Promise.all(s)}},z$=class{constructor(e){this.parser=e,this.name=si.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(e,t){const s=this.parser.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=s.extensions[this.name].emissiveStrength;return r!==void 0&&(t.emissiveIntensity=r),Promise.resolve()}},G$=class{constructor(e){this.parser=e,this.name=si.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:so}extendMaterialParams(e,t){const i=this.parser,s=i.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=[],o=s.extensions[this.name];if(o.clearcoatFactor!==void 0&&(t.clearcoat=o.clearcoatFactor),o.clearcoatTexture!==void 0&&r.push(i.assignTexture(t,"clearcoatMap",o.clearcoatTexture)),o.clearcoatRoughnessFactor!==void 0&&(t.clearcoatRoughness=o.clearcoatRoughnessFactor),o.clearcoatRoughnessTexture!==void 0&&r.push(i.assignTexture(t,"clearcoatRoughnessMap",o.clearcoatRoughnessTexture)),o.clearcoatNormalTexture!==void 0&&(r.push(i.assignTexture(t,"clearcoatNormalMap",o.clearcoatNormalTexture)),o.clearcoatNormalTexture.scale!==void 0)){const a=o.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new ie(a,a)}return Promise.all(r)}},V$=class{constructor(e){this.parser=e,this.name=si.KHR_MATERIALS_IRIDESCENCE}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:so}extendMaterialParams(e,t){const i=this.parser,s=i.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=[],o=s.extensions[this.name];return o.iridescenceFactor!==void 0&&(t.iridescence=o.iridescenceFactor),o.iridescenceTexture!==void 0&&r.push(i.assignTexture(t,"iridescenceMap",o.iridescenceTexture)),o.iridescenceIor!==void 0&&(t.iridescenceIOR=o.iridescenceIor),t.iridescenceThicknessRange===void 0&&(t.iridescenceThicknessRange=[100,400]),o.iridescenceThicknessMinimum!==void 0&&(t.iridescenceThicknessRange[0]=o.iridescenceThicknessMinimum),o.iridescenceThicknessMaximum!==void 0&&(t.iridescenceThicknessRange[1]=o.iridescenceThicknessMaximum),o.iridescenceThicknessTexture!==void 0&&r.push(i.assignTexture(t,"iridescenceThicknessMap",o.iridescenceThicknessTexture)),Promise.all(r)}},H$=class{constructor(e){this.parser=e,this.name=si.KHR_MATERIALS_SHEEN}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:so}extendMaterialParams(e,t){const i=this.parser,s=i.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=[];t.sheenColor=new ye(0,0,0),t.sheenRoughness=0,t.sheen=1;const o=s.extensions[this.name];if(o.sheenColorFactor!==void 0){const a=o.sheenColorFactor;t.sheenColor.setRGB(a[0],a[1],a[2],Ri)}return o.sheenRoughnessFactor!==void 0&&(t.sheenRoughness=o.sheenRoughnessFactor),o.sheenColorTexture!==void 0&&r.push(i.assignTexture(t,"sheenColorMap",o.sheenColorTexture,zt)),o.sheenRoughnessTexture!==void 0&&r.push(i.assignTexture(t,"sheenRoughnessMap",o.sheenRoughnessTexture)),Promise.all(r)}},Q$=class{constructor(e){this.parser=e,this.name=si.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:so}extendMaterialParams(e,t){const i=this.parser,s=i.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=[],o=s.extensions[this.name];return o.transmissionFactor!==void 0&&(t.transmission=o.transmissionFactor),o.transmissionTexture!==void 0&&r.push(i.assignTexture(t,"transmissionMap",o.transmissionTexture)),Promise.all(r)}},j$=class{constructor(e){this.parser=e,this.name=si.KHR_MATERIALS_VOLUME}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:so}extendMaterialParams(e,t){const i=this.parser,s=i.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=[],o=s.extensions[this.name];t.thickness=o.thicknessFactor!==void 0?o.thicknessFactor:0,o.thicknessTexture!==void 0&&r.push(i.assignTexture(t,"thicknessMap",o.thicknessTexture)),t.attenuationDistance=o.attenuationDistance||1/0;const a=o.attenuationColor||[1,1,1];return t.attenuationColor=new ye().setRGB(a[0],a[1],a[2],Ri),Promise.all(r)}},W$=class{constructor(e){this.parser=e,this.name=si.KHR_MATERIALS_IOR}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:so}extendMaterialParams(e,t){const s=this.parser.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=s.extensions[this.name];return t.ior=r.ior!==void 0?r.ior:1.5,Promise.resolve()}},q$=class{constructor(e){this.parser=e,this.name=si.KHR_MATERIALS_SPECULAR}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:so}extendMaterialParams(e,t){const i=this.parser,s=i.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=[],o=s.extensions[this.name];t.specularIntensity=o.specularFactor!==void 0?o.specularFactor:1,o.specularTexture!==void 0&&r.push(i.assignTexture(t,"specularIntensityMap",o.specularTexture));const a=o.specularColorFactor||[1,1,1];return t.specularColor=new ye().setRGB(a[0],a[1],a[2],Ri),o.specularColorTexture!==void 0&&r.push(i.assignTexture(t,"specularColorMap",o.specularColorTexture,zt)),Promise.all(r)}},X$=class{constructor(e){this.parser=e,this.name=si.EXT_MATERIALS_BUMP}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:so}extendMaterialParams(e,t){const i=this.parser,s=i.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=[],o=s.extensions[this.name];return t.bumpScale=o.bumpFactor!==void 0?o.bumpFactor:1,o.bumpTexture!==void 0&&r.push(i.assignTexture(t,"bumpMap",o.bumpTexture)),Promise.all(r)}},Y$=class{constructor(e){this.parser=e,this.name=si.KHR_MATERIALS_ANISOTROPY}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:so}extendMaterialParams(e,t){const i=this.parser,s=i.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=[],o=s.extensions[this.name];return o.anisotropyStrength!==void 0&&(t.anisotropy=o.anisotropyStrength),o.anisotropyRotation!==void 0&&(t.anisotropyRotation=o.anisotropyRotation),o.anisotropyTexture!==void 0&&r.push(i.assignTexture(t,"anisotropyMap",o.anisotropyTexture)),Promise.all(r)}};class J${constructor(e){this.parser=e,this.name=si.KHR_TEXTURE_BASISU}loadTexture(e){const t=this.parser,i=t.json,s=i.textures[e];if(!s.extensions||!s.extensions[this.name])return null;const r=s.extensions[this.name],o=t.options.ktx2Loader;if(!o){if(i.extensionsRequired&&i.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(e,r.source,o)}}class K${constructor(e){this.parser=e,this.name=si.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){const t=this.name,i=this.parser,s=i.json,r=s.textures[e];if(!r.extensions||!r.extensions[t])return null;const o=r.extensions[t],a=s.images[o.source];let c=i.textureLoader;if(a.uri){const l=i.options.manager.getHandler(a.uri);l!==null&&(c=l)}return this.detectSupport().then(function(l){if(l)return i.loadTextureImage(e,o.source,c);if(s.extensionsRequired&&s.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return i.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(t.height===1)}})),this.isSupported}}class Z${constructor(e){this.parser=e,this.name=si.EXT_TEXTURE_AVIF,this.isSupported=null}loadTexture(e){const t=this.name,i=this.parser,s=i.json,r=s.textures[e];if(!r.extensions||!r.extensions[t])return null;const o=r.extensions[t],a=s.images[o.source];let c=i.textureLoader;if(a.uri){const l=i.options.manager.getHandler(a.uri);l!==null&&(c=l)}return this.detectSupport().then(function(l){if(l)return i.loadTextureImage(e,o.source,c);if(s.extensionsRequired&&s.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: AVIF required by asset but unsupported.");return i.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=",t.onload=t.onerror=function(){e(t.height===1)}})),this.isSupported}}class $${constructor(e){this.name=si.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){const t=this.parser.json,i=t.bufferViews[e];if(i.extensions&&i.extensions[this.name]){const s=i.extensions[this.name],r=this.parser.getDependency("buffer",s.buffer),o=this.parser.options.meshoptDecoder;if(!o||!o.supported){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return r.then(function(a){const c=s.byteOffset||0,l=s.byteLength||0,h=s.count,d=s.byteStride,f=new Uint8Array(a,c,l);return o.decodeGltfBufferAsync?o.decodeGltfBufferAsync(h,d,f,s.mode,s.filter).then(function(p){return p.buffer}):o.ready.then(function(){const p=new ArrayBuffer(h*d);return o.decodeGltfBuffer(new Uint8Array(p),h,d,f,s.mode,s.filter),p})})}else return null}}let eee=class{constructor(e){this.name=si.EXT_MESH_GPU_INSTANCING,this.parser=e}createNodeMesh(e){const t=this.parser.json,i=t.nodes[e];if(!i.extensions||!i.extensions[this.name]||i.mesh===void 0)return null;const s=t.meshes[i.mesh];for(const l of s.primitives)if(l.mode!==wo.TRIANGLES&&l.mode!==wo.TRIANGLE_STRIP&&l.mode!==wo.TRIANGLE_FAN&&l.mode!==void 0)return null;const o=i.extensions[this.name].attributes,a=[],c={};for(const l in o)a.push(this.parser.getDependency("accessor",o[l]).then(h=>(c[l]=h,c[l])));return a.length<1?null:(a.push(this.parser.createNodeMesh(e)),Promise.all(a).then(l=>{const h=l.pop(),d=h.isGroup?h.children:[h],f=l[0].count,p=[];for(const m of d){const g=new Ce,y=new w,A=new Me,v=new w(1,1,1),b=new B_(m.geometry,m.material,f);for(let _=0;_<f;_++)c.TRANSLATION&&y.fromBufferAttribute(c.TRANSLATION,_),c.ROTATION&&A.fromBufferAttribute(c.ROTATION,_),c.SCALE&&v.fromBufferAttribute(c.SCALE,_),b.setMatrixAt(_,g.compose(y,A,v));for(const _ in c)if(_==="_COLOR_0"){const T=c[_];b.instanceColor=new Or(T.array,T.itemSize,T.normalized)}else _!=="TRANSLATION"&&_!=="ROTATION"&&_!=="SCALE"&&m.geometry.setAttribute(_,c[_]);ge.prototype.copy.call(b,m),this.parser.assignFinalMaterial(b),p.push(b)}return h.isGroup?(h.clear(),h.add(...p),h):p[0]}))}};const az="glTF",Pm=12,cO={JSON:1313821514,BIN:5130562};class tee{constructor(e){this.name=si.KHR_BINARY_GLTF,this.content=null,this.body=null;const t=new DataView(e,0,Pm),i=new TextDecoder;if(this.header={magic:i.decode(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==az)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const s=this.header.length-Pm,r=new DataView(e,Pm);let o=0;for(;o<s;){const a=r.getUint32(o,!0);o+=4;const c=r.getUint32(o,!0);if(o+=4,c===cO.JSON){const l=new Uint8Array(e,Pm+o,a);this.content=i.decode(l)}else if(c===cO.BIN){const l=Pm+o;this.body=e.slice(l,l+a)}o+=a}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class iee{constructor(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=si.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}decodePrimitive(e,t){const i=this.json,s=this.dracoLoader,r=e.extensions[this.name].bufferView,o=e.extensions[this.name].attributes,a={},c={},l={};for(const h in o){const d=bT[h]||h.toLowerCase();a[d]=o[h]}for(const h in e.attributes){const d=bT[h]||h.toLowerCase();if(o[h]!==void 0){const f=i.accessors[e.attributes[h]],p=tp[f.componentType];l[d]=p.name,c[d]=f.normalized===!0}}return t.getDependency("bufferView",r).then(function(h){return new Promise(function(d,f){s.decodeDracoFile(h,function(p){for(const m in p.attributes){const g=p.attributes[m],y=c[m];y!==void 0&&(g.normalized=y)}d(p)},a,l,Ri,f)})})}}class nee{constructor(){this.name=si.KHR_TEXTURE_TRANSFORM}extendTexture(e,t){return(t.texCoord===void 0||t.texCoord===e.channel)&&t.offset===void 0&&t.rotation===void 0&&t.scale===void 0||(e=e.clone(),t.texCoord!==void 0&&(e.channel=t.texCoord),t.offset!==void 0&&e.offset.fromArray(t.offset),t.rotation!==void 0&&(e.rotation=t.rotation),t.scale!==void 0&&e.repeat.fromArray(t.scale),e.needsUpdate=!0),e}}class see{constructor(){this.name=si.KHR_MESH_QUANTIZATION}}class cz extends Rp{constructor(e,t,i,s){super(e,t,i,s)}copySampleValue_(e){const t=this.resultBuffer,i=this.sampleValues,s=this.valueSize,r=e*s*3+s;for(let o=0;o!==s;o++)t[o]=i[r+o];return t}interpolate_(e,t,i,s){const r=this.resultBuffer,o=this.sampleValues,a=this.valueSize,c=a*2,l=a*3,h=s-t,d=(i-t)/h,f=d*d,p=f*d,m=e*l,g=m-l,y=-2*p+3*f,A=p-f,v=1-y,b=A-f+d;for(let _=0;_!==a;_++){const T=o[g+_+a],E=o[g+_+c]*h,M=o[m+_+a],I=o[m+_]*h;r[_]=v*T+b*E+y*M+A*I}return r}}const ree=new Me;class oee extends cz{interpolate_(e,t,i,s){const r=super.interpolate_(e,t,i,s);return ree.fromArray(r).normalize().toArray(r),r}}const wo={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},tp={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},lO={9728:Nt,9729:St,9984:dp,9985:Wu,9986:Zc,9987:kr},hO={33071:ts,33648:hd,10497:Lo},ZS={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},bT={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},rh={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},aee={CUBICSPLINE:void 0,LINEAR:Gh,STEP:ud},$S={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function cee(n){return n.DefaultMaterial===void 0&&(n.DefaultMaterial=new Ur({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:Es})),n.DefaultMaterial}function yu(n,e,t){for(const i in t.extensions)n[i]===void 0&&(e.userData.gltfExtensions=e.userData.gltfExtensions||{},e.userData.gltfExtensions[i]=t.extensions[i])}function dh(n,e){e.extras!==void 0&&(typeof e.extras=="object"?Object.assign(n.userData,e.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+e.extras))}function lee(n,e,t){let i=!1,s=!1,r=!1;for(let l=0,h=e.length;l<h;l++){const d=e[l];if(d.POSITION!==void 0&&(i=!0),d.NORMAL!==void 0&&(s=!0),d.COLOR_0!==void 0&&(r=!0),i&&s&&r)break}if(!i&&!s&&!r)return Promise.resolve(n);const o=[],a=[],c=[];for(let l=0,h=e.length;l<h;l++){const d=e[l];if(i){const f=d.POSITION!==void 0?t.getDependency("accessor",d.POSITION):n.attributes.position;o.push(f)}if(s){const f=d.NORMAL!==void 0?t.getDependency("accessor",d.NORMAL):n.attributes.normal;a.push(f)}if(r){const f=d.COLOR_0!==void 0?t.getDependency("accessor",d.COLOR_0):n.attributes.color;c.push(f)}}return Promise.all([Promise.all(o),Promise.all(a),Promise.all(c)]).then(function(l){const h=l[0],d=l[1],f=l[2];return i&&(n.morphAttributes.position=h),s&&(n.morphAttributes.normal=d),r&&(n.morphAttributes.color=f),n.morphTargetsRelative=!0,n})}function hee(n,e){if(n.updateMorphTargets(),e.weights!==void 0)for(let t=0,i=e.weights.length;t<i;t++)n.morphTargetInfluences[t]=e.weights[t];if(e.extras&&Array.isArray(e.extras.targetNames)){const t=e.extras.targetNames;if(n.morphTargetInfluences.length===t.length){n.morphTargetDictionary={};for(let i=0,s=t.length;i<s;i++)n.morphTargetDictionary[t[i]]=i}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function uee(n){let e;const t=n.extensions&&n.extensions[si.KHR_DRACO_MESH_COMPRESSION];if(t?e="draco:"+t.bufferView+":"+t.indices+":"+eC(t.attributes):e=n.indices+":"+eC(n.attributes)+":"+n.mode,n.targets!==void 0)for(let i=0,s=n.targets.length;i<s;i++)e+=":"+eC(n.targets[i]);return e}function eC(n){let e="";const t=Object.keys(n).sort();for(let i=0,s=t.length;i<s;i++)e+=t[i]+":"+n[t[i]]+";";return e}function _T(n){switch(n){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}function dee(n){return n.search(/\.jpe?g($|\?)/i)>0||n.search(/^data\:image\/jpeg/)===0?"image/jpeg":n.search(/\.webp($|\?)/i)>0||n.search(/^data\:image\/webp/)===0?"image/webp":"image/png"}const fee=new Ce;class pee{constructor(e={},t={}){this.json=e,this.extensions={},this.plugins={},this.options=t,this.cache=new F$,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let i=!1,s=!1,r=-1;typeof navigator<"u"&&(i=/^((?!chrome|android).)*safari/i.test(navigator.userAgent)===!0,s=navigator.userAgent.indexOf("Firefox")>-1,r=s?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1),typeof createImageBitmap>"u"||i||s&&r<98?this.textureLoader=new dl(this.options.manager):this.textureLoader=new Z2(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new Hn(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,t){const i=this,s=this.json,r=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll(function(o){return o._markDefs&&o._markDefs()}),Promise.all(this._invokeAll(function(o){return o.beforeRoot&&o.beforeRoot()})).then(function(){return Promise.all([i.getDependencies("scene"),i.getDependencies("animation"),i.getDependencies("camera")])}).then(function(o){const a={scene:o[0][s.scene||0],scenes:o[0],animations:o[1],cameras:o[2],asset:s.asset,parser:i,userData:{}};return yu(r,a,s),dh(a,s),Promise.all(i._invokeAll(function(c){return c.afterRoot&&c.afterRoot(a)})).then(function(){e(a)})}).catch(t)}_markDefs(){const e=this.json.nodes||[],t=this.json.skins||[],i=this.json.meshes||[];for(let s=0,r=t.length;s<r;s++){const o=t[s].joints;for(let a=0,c=o.length;a<c;a++)e[o[a]].isBone=!0}for(let s=0,r=e.length;s<r;s++){const o=e[s];o.mesh!==void 0&&(this._addNodeRef(this.meshCache,o.mesh),o.skin!==void 0&&(i[o.mesh].isSkinnedMesh=!0)),o.camera!==void 0&&this._addNodeRef(this.cameraCache,o.camera)}}_addNodeRef(e,t){t!==void 0&&(e.refs[t]===void 0&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)}_getNodeRef(e,t,i){if(e.refs[t]<=1)return i;const s=i.clone(),r=(o,a)=>{const c=this.associations.get(o);c!=null&&this.associations.set(a,c);for(const[l,h]of o.children.entries())r(h,a.children[l])};return r(i,s),s.name+="_instance_"+e.uses[t]++,s}_invokeOne(e){const t=Object.values(this.plugins);t.push(this);for(let i=0;i<t.length;i++){const s=e(t[i]);if(s)return s}return null}_invokeAll(e){const t=Object.values(this.plugins);t.unshift(this);const i=[];for(let s=0;s<t.length;s++){const r=e(t[s]);r&&i.push(r)}return i}getDependency(e,t){const i=e+":"+t;let s=this.cache.get(i);if(!s){switch(e){case"scene":s=this.loadScene(t);break;case"node":s=this._invokeOne(function(r){return r.loadNode&&r.loadNode(t)});break;case"mesh":s=this._invokeOne(function(r){return r.loadMesh&&r.loadMesh(t)});break;case"accessor":s=this.loadAccessor(t);break;case"bufferView":s=this._invokeOne(function(r){return r.loadBufferView&&r.loadBufferView(t)});break;case"buffer":s=this.loadBuffer(t);break;case"material":s=this._invokeOne(function(r){return r.loadMaterial&&r.loadMaterial(t)});break;case"texture":s=this._invokeOne(function(r){return r.loadTexture&&r.loadTexture(t)});break;case"skin":s=this.loadSkin(t);break;case"animation":s=this._invokeOne(function(r){return r.loadAnimation&&r.loadAnimation(t)});break;case"camera":s=this.loadCamera(t);break;default:if(s=this._invokeOne(function(r){return r!=this&&r.getDependency&&r.getDependency(e,t)}),!s)throw new Error("Unknown type: "+e);break}this.cache.add(i,s)}return s}getDependencies(e){let t=this.cache.get(e);if(!t){const i=this,s=this.json[e+(e==="mesh"?"es":"s")]||[];t=Promise.all(s.map(function(r,o){return i.getDependency(e,o)})),this.cache.add(e,t)}return t}loadBuffer(e){const t=this.json.buffers[e],i=this.fileLoader;if(t.type&&t.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(t.uri===void 0&&e===0)return Promise.resolve(this.extensions[si.KHR_BINARY_GLTF].body);const s=this.options;return new Promise(function(r,o){i.load(Ih.resolveURL(t.uri,s.path),r,void 0,function(){o(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))})})}loadBufferView(e){const t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then(function(i){const s=t.byteLength||0,r=t.byteOffset||0;return i.slice(r,r+s)})}loadAccessor(e){const t=this,i=this.json,s=this.json.accessors[e];if(s.bufferView===void 0&&s.sparse===void 0){const o=ZS[s.type],a=tp[s.componentType],c=s.normalized===!0,l=new a(s.count*o);return Promise.resolve(new it(l,o,c))}const r=[];return s.bufferView!==void 0?r.push(this.getDependency("bufferView",s.bufferView)):r.push(null),s.sparse!==void 0&&(r.push(this.getDependency("bufferView",s.sparse.indices.bufferView)),r.push(this.getDependency("bufferView",s.sparse.values.bufferView))),Promise.all(r).then(function(o){const a=o[0],c=ZS[s.type],l=tp[s.componentType],h=l.BYTES_PER_ELEMENT,d=h*c,f=s.byteOffset||0,p=s.bufferView!==void 0?i.bufferViews[s.bufferView].byteStride:void 0,m=s.normalized===!0;let g,y;if(p&&p!==d){const A=Math.floor(f/p),v="InterleavedBuffer:"+s.bufferView+":"+s.componentType+":"+A+":"+s.count;let b=t.cache.get(v);b||(g=new l(a,A*p,s.count*p/h),b=new zA(g,p/h),t.cache.add(v,b)),y=new pr(b,c,f%p/h,m)}else a===null?g=new l(s.count*c):g=new l(a,f,s.count*c),y=new it(g,c,m);if(s.sparse!==void 0){const A=ZS.SCALAR,v=tp[s.sparse.indices.componentType],b=s.sparse.indices.byteOffset||0,_=s.sparse.values.byteOffset||0,T=new v(o[1],b,s.sparse.count*A),E=new l(o[2],_,s.sparse.count*c);a!==null&&(y=new it(y.array.slice(),y.itemSize,y.normalized));for(let M=0,I=T.length;M<I;M++){const S=T[M];if(y.setX(S,E[M*c]),c>=2&&y.setY(S,E[M*c+1]),c>=3&&y.setZ(S,E[M*c+2]),c>=4&&y.setW(S,E[M*c+3]),c>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return y})}loadTexture(e){const t=this.json,i=this.options,r=t.textures[e].source,o=t.images[r];let a=this.textureLoader;if(o.uri){const c=i.manager.getHandler(o.uri);c!==null&&(a=c)}return this.loadTextureImage(e,r,a)}loadTextureImage(e,t,i){const s=this,r=this.json,o=r.textures[e],a=r.images[t],c=(a.uri||a.bufferView)+":"+o.sampler;if(this.textureCache[c])return this.textureCache[c];const l=this.loadImageSource(t,i).then(function(h){h.flipY=!1,h.name=o.name||a.name||"",h.name===""&&typeof a.uri=="string"&&a.uri.startsWith("data:image/")===!1&&(h.name=a.uri);const f=(r.samplers||{})[o.sampler]||{};return h.magFilter=lO[f.magFilter]||St,h.minFilter=lO[f.minFilter]||kr,h.wrapS=hO[f.wrapS]||Lo,h.wrapT=hO[f.wrapT]||Lo,h.anisotropy=4,s.associations.set(h,{textures:e}),h}).catch(function(){return null});return this.textureCache[c]=l,l}loadImageSource(e,t){const i=this,s=this.json,r=this.options;if(this.sourceCache[e]!==void 0)return this.sourceCache[e].then(d=>d.clone());const o=s.images[e],a=self.URL||self.webkitURL;let c=o.uri||"",l=!1;if(o.bufferView!==void 0)c=i.getDependency("bufferView",o.bufferView).then(function(d){l=!0;const f=new Blob([d],{type:o.mimeType});return c=a.createObjectURL(f),c});else if(o.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");const h=Promise.resolve(c).then(function(d){return new Promise(function(f,p){let m=f;t.isImageBitmapLoader===!0&&(m=function(g){const y=new Ft(g);y.needsUpdate=!0,f(y)}),t.load(Ih.resolveURL(d,r.path),m,void 0,p)})}).then(function(d){return l===!0&&a.revokeObjectURL(c),d.userData.mimeType=o.mimeType||dee(o.uri),d}).catch(function(d){throw console.error("THREE.GLTFLoader: Couldn't load texture",c),d});return this.sourceCache[e]=h,h}assignTexture(e,t,i,s){const r=this;return this.getDependency("texture",i.index).then(function(o){if(!o)return null;if(i.texCoord!==void 0&&i.texCoord>0&&(o=o.clone(),o.channel=i.texCoord),r.extensions[si.KHR_TEXTURE_TRANSFORM]){const a=i.extensions!==void 0?i.extensions[si.KHR_TEXTURE_TRANSFORM]:void 0;if(a){const c=r.associations.get(o);o=r.extensions[si.KHR_TEXTURE_TRANSFORM].extendTexture(o,a),r.associations.set(o,c)}}return s!==void 0&&(o.colorSpace=s),e[t]=o,o})}assignFinalMaterial(e){const t=e.geometry;let i=e.material;const s=t.attributes.tangent===void 0,r=t.attributes.color!==void 0,o=t.attributes.normal===void 0;if(e.isPoints){const a="PointsMaterial:"+i.uuid;let c=this.cache.get(a);c||(c=new D_,Ot.prototype.copy.call(c,i),c.color.copy(i.color),c.map=i.map,c.sizeAttenuation=!1,this.cache.add(a,c)),i=c}else if(e.isLine){const a="LineBasicMaterial:"+i.uuid;let c=this.cache.get(a);c||(c=new Ln,Ot.prototype.copy.call(c,i),c.color.copy(i.color),c.map=i.map,this.cache.add(a,c)),i=c}if(s||r||o){let a="ClonedMaterial:"+i.uuid+":";s&&(a+="derivative-tangents:"),r&&(a+="vertex-colors:"),o&&(a+="flat-shading:");let c=this.cache.get(a);c||(c=i.clone(),r&&(c.vertexColors=!0),o&&(c.flatShading=!0),s&&(c.normalScale&&(c.normalScale.y*=-1),c.clearcoatNormalScale&&(c.clearcoatNormalScale.y*=-1)),this.cache.add(a,c),this.associations.set(c,this.associations.get(i))),i=c}e.material=i}getMaterialType(){return Ur}loadMaterial(e){const t=this,i=this.json,s=this.extensions,r=i.materials[e];let o;const a={},c=r.extensions||{},l=[];if(c[si.KHR_MATERIALS_UNLIT]){const d=s[si.KHR_MATERIALS_UNLIT];o=d.getMaterialType(),l.push(d.extendParams(a,r,t))}else{const d=r.pbrMetallicRoughness||{};if(a.color=new ye(1,1,1),a.opacity=1,Array.isArray(d.baseColorFactor)){const f=d.baseColorFactor;a.color.setRGB(f[0],f[1],f[2],Ri),a.opacity=f[3]}d.baseColorTexture!==void 0&&l.push(t.assignTexture(a,"map",d.baseColorTexture,zt)),a.metalness=d.metallicFactor!==void 0?d.metallicFactor:1,a.roughness=d.roughnessFactor!==void 0?d.roughnessFactor:1,d.metallicRoughnessTexture!==void 0&&(l.push(t.assignTexture(a,"metalnessMap",d.metallicRoughnessTexture)),l.push(t.assignTexture(a,"roughnessMap",d.metallicRoughnessTexture))),o=this._invokeOne(function(f){return f.getMaterialType&&f.getMaterialType(e)}),l.push(Promise.all(this._invokeAll(function(f){return f.extendMaterialParams&&f.extendMaterialParams(e,a)})))}r.doubleSided===!0&&(a.side=Ai);const h=r.alphaMode||$S.OPAQUE;if(h===$S.BLEND?(a.transparent=!0,a.depthWrite=!1):(a.transparent=!1,h===$S.MASK&&(a.alphaTest=r.alphaCutoff!==void 0?r.alphaCutoff:.5)),r.normalTexture!==void 0&&o!==ri&&(l.push(t.assignTexture(a,"normalMap",r.normalTexture)),a.normalScale=new ie(1,1),r.normalTexture.scale!==void 0)){const d=r.normalTexture.scale;a.normalScale.set(d,d)}if(r.occlusionTexture!==void 0&&o!==ri&&(l.push(t.assignTexture(a,"aoMap",r.occlusionTexture)),r.occlusionTexture.strength!==void 0&&(a.aoMapIntensity=r.occlusionTexture.strength)),r.emissiveFactor!==void 0&&o!==ri){const d=r.emissiveFactor;a.emissive=new ye().setRGB(d[0],d[1],d[2],Ri)}return r.emissiveTexture!==void 0&&o!==ri&&l.push(t.assignTexture(a,"emissiveMap",r.emissiveTexture,zt)),Promise.all(l).then(function(){const d=new o(a);return r.name&&(d.name=r.name),dh(d,r),t.associations.set(d,{materials:e}),r.extensions&&yu(s,d,r),d})}createUniqueName(e){const t=qt.sanitizeNodeName(e||"");return t in this.nodeNamesUsed?t+"_"+ ++this.nodeNamesUsed[t]:(this.nodeNamesUsed[t]=0,t)}loadGeometries(e){const t=this,i=this.extensions,s=this.primitiveCache;function r(a){return i[si.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(a,t).then(function(c){return uO(c,a,t)})}const o=[];for(let a=0,c=e.length;a<c;a++){const l=e[a],h=uee(l),d=s[h];if(d)o.push(d.promise);else{let f;l.extensions&&l.extensions[si.KHR_DRACO_MESH_COMPRESSION]?f=r(l):f=uO(new gt,l,t),s[h]={primitive:l,promise:f},o.push(f)}}return Promise.all(o)}loadMesh(e){const t=this,i=this.json,s=this.extensions,r=i.meshes[e],o=r.primitives,a=[];for(let c=0,l=o.length;c<l;c++){const h=o[c].material===void 0?cee(this.cache):this.getDependency("material",o[c].material);a.push(h)}return a.push(t.loadGeometries(o)),Promise.all(a).then(function(c){const l=c.slice(0,c.length-1),h=c[c.length-1],d=[];for(let p=0,m=h.length;p<m;p++){const g=h[p],y=o[p];let A;const v=l[p];if(y.mode===wo.TRIANGLES||y.mode===wo.TRIANGLE_STRIP||y.mode===wo.TRIANGLE_FAN||y.mode===void 0)A=r.isSkinnedMesh===!0?new cc(g,v):new me(g,v),A.isSkinnedMesh===!0&&A.normalizeSkinWeights(),y.mode===wo.TRIANGLE_STRIP?A.geometry=aO(A.geometry,mM):y.mode===wo.TRIANGLE_FAN&&(A.geometry=aO(A.geometry,rb));else if(y.mode===wo.LINES)A=new Go(g,v);else if(y.mode===wo.LINE_STRIP)A=new Sn(g,v);else if(y.mode===wo.LINE_LOOP)A=new MM(g,v);else if(y.mode===wo.POINTS)A=new IM(g,v);else throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+y.mode);Object.keys(A.geometry.morphAttributes).length>0&&hee(A,r),A.name=t.createUniqueName(r.name||"mesh_"+e),dh(A,r),y.extensions&&yu(s,A,y),t.assignFinalMaterial(A),d.push(A)}for(let p=0,m=d.length;p<m;p++)t.associations.set(d[p],{meshes:e,primitives:p});if(d.length===1)return r.extensions&&yu(s,d[0],r),d[0];const f=new fr;r.extensions&&yu(s,f,r),t.associations.set(f,{meshes:e});for(let p=0,m=d.length;p<m;p++)f.add(d[p]);return f})}loadCamera(e){let t;const i=this.json.cameras[e],s=i[i.type];if(!s){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return i.type==="perspective"?t=new Wt(Vn.radToDeg(s.yfov),s.aspectRatio||1,s.znear||1,s.zfar||2e6):i.type==="orthographic"&&(t=new vc(-s.xmag,s.xmag,s.ymag,-s.ymag,s.znear,s.zfar)),i.name&&(t.name=this.createUniqueName(i.name)),dh(t,i),Promise.resolve(t)}loadSkin(e){const t=this.json.skins[e],i=[];for(let s=0,r=t.joints.length;s<r;s++)i.push(this._loadNodeShallow(t.joints[s]));return t.inverseBindMatrices!==void 0?i.push(this.getDependency("accessor",t.inverseBindMatrices)):i.push(null),Promise.all(i).then(function(s){const r=s.pop(),o=s,a=[],c=[];for(let l=0,h=o.length;l<h;l++){const d=o[l];if(d){a.push(d);const f=new Ce;r!==null&&f.fromArray(r.array,l*16),c.push(f)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',t.joints[l])}return new Ip(a,c)})}loadAnimation(e){const t=this.json,i=this,s=t.animations[e],r=s.name?s.name:"animation_"+e,o=[],a=[],c=[],l=[],h=[];let d=0,f=s.channels.length;for(d=0,f=s.channels.length;d<f;d++){const p=s.channels[d],m=s.samplers[p.sampler],g=p.target,y=g.node,A=s.parameters!==void 0?s.parameters[m.input]:m.input,v=s.parameters!==void 0?s.parameters[m.output]:m.output;g.node!==void 0&&(o.push(this.getDependency("node",y)),a.push(this.getDependency("accessor",A)),c.push(this.getDependency("accessor",v)),l.push(m),h.push(g))}return Promise.all([Promise.all(o),Promise.all(a),Promise.all(c),Promise.all(l),Promise.all(h)]).then(function(p){const m=p[0],g=p[1],y=p[2],A=p[3],v=p[4],b=[];for(d=0,f=m.length;d<f;d++){const _=m[d],T=g[d],E=y[d],M=A[d],I=v[d];if(_===void 0)continue;_.updateMatrix&&_.updateMatrix();const S=i._createAnimationTracks(_,T,E,M,I);if(S)for(let C=0;C<S.length;C++)b.push(S[C])}return new Nr(r,void 0,b)})}createNodeMesh(e){const t=this.json,i=this,s=t.nodes[e];return s.mesh===void 0?null:i.getDependency("mesh",s.mesh).then(function(r){const o=i._getNodeRef(i.meshCache,s.mesh,r);return s.weights!==void 0&&o.traverse(function(a){if(a.isMesh)for(let c=0,l=s.weights.length;c<l;c++)a.morphTargetInfluences[c]=s.weights[c]}),o})}loadNode(e){const t=this.json,i=this,s=t.nodes[e],r=i._loadNodeShallow(e),o=[],a=s.children||[];for(let l=0,h=a.length;l<h;l++)o.push(i.getDependency("node",a[l]));const c=s.skin===void 0?Promise.resolve(null):i.getDependency("skin",s.skin);return Promise.all([r,Promise.all(o),c]).then(function(l){const h=l[0],d=l[1],f=l[2];f!==null&&h.traverse(function(p){p.isSkinnedMesh&&p.bind(f,fee)});for(let p=0,m=d.length;p<m;p++)h.add(d[p]);return h})}_loadNodeShallow(e){const t=this.json,i=this.extensions,s=this;if(this.nodeCache[e]!==void 0)return this.nodeCache[e];const r=t.nodes[e],o=r.name?s.createUniqueName(r.name):"",a=[],c=s._invokeOne(function(l){return l.createNodeMesh&&l.createNodeMesh(e)});return c&&a.push(c),r.camera!==void 0&&a.push(s.getDependency("camera",r.camera).then(function(l){return s._getNodeRef(s.cameraCache,r.camera,l)})),s._invokeAll(function(l){return l.createNodeAttachment&&l.createNodeAttachment(e)}).forEach(function(l){a.push(l)}),this.nodeCache[e]=Promise.all(a).then(function(l){let h;if(r.isBone===!0?h=new GA:l.length>1?h=new fr:l.length===1?h=l[0]:h=new ge,h!==l[0])for(let d=0,f=l.length;d<f;d++)h.add(l[d]);if(r.name&&(h.userData.name=r.name,h.name=o),dh(h,r),r.extensions&&yu(i,h,r),r.matrix!==void 0){const d=new Ce;d.fromArray(r.matrix),h.applyMatrix4(d)}else r.translation!==void 0&&h.position.fromArray(r.translation),r.rotation!==void 0&&h.quaternion.fromArray(r.rotation),r.scale!==void 0&&h.scale.fromArray(r.scale);return s.associations.has(h)||s.associations.set(h,{}),s.associations.get(h).nodes=e,h}),this.nodeCache[e]}loadScene(e){const t=this.extensions,i=this.json.scenes[e],s=this,r=new fr;i.name&&(r.name=s.createUniqueName(i.name)),dh(r,i),i.extensions&&yu(t,r,i);const o=i.nodes||[],a=[];for(let c=0,l=o.length;c<l;c++)a.push(s.getDependency("node",o[c]));return Promise.all(a).then(function(c){for(let h=0,d=c.length;h<d;h++)r.add(c[h]);const l=h=>{const d=new Map;for(const[f,p]of s.associations)(f instanceof Ot||f instanceof Ft)&&d.set(f,p);return h.traverse(f=>{const p=s.associations.get(f);p!=null&&d.set(f,p)}),d};return s.associations=l(r),r})}_createAnimationTracks(e,t,i,s,r){const o=[],a=e.name?e.name:e.uuid,c=[];rh[r.path]===rh.weights?e.traverse(function(f){f.morphTargetInfluences&&c.push(f.name?f.name:f.uuid)}):c.push(a);let l;switch(rh[r.path]){case rh.weights:l=pd;break;case rh.rotation:l=xl;break;case rh.position:case rh.scale:l=Vh;break;default:switch(i.itemSize){case 1:l=pd;break;case 2:case 3:default:l=Vh;break}break}const h=s.interpolation!==void 0?aee[s.interpolation]:Gh,d=this._getArrayFromAccessor(i);for(let f=0,p=c.length;f<p;f++){const m=new l(c[f]+"."+rh[r.path],t.array,d,h);s.interpolation==="CUBICSPLINE"&&this._createCubicSplineTrackInterpolant(m),o.push(m)}return o}_getArrayFromAccessor(e){let t=e.array;if(e.normalized){const i=_T(t.constructor),s=new Float32Array(t.length);for(let r=0,o=t.length;r<o;r++)s[r]=t[r]*i;t=s}return t}_createCubicSplineTrackInterpolant(e){e.createInterpolant=function(i){const s=this instanceof xl?oee:cz;return new s(this.times,this.values,this.getValueSize()/3,i)},e.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0}}function mee(n,e,t){const i=e.attributes,s=new Mi;if(i.POSITION!==void 0){const a=t.json.accessors[i.POSITION],c=a.min,l=a.max;if(c!==void 0&&l!==void 0){if(s.set(new w(c[0],c[1],c[2]),new w(l[0],l[1],l[2])),a.normalized){const h=_T(tp[a.componentType]);s.min.multiplyScalar(h),s.max.multiplyScalar(h)}}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}else return;const r=e.targets;if(r!==void 0){const a=new w,c=new w;for(let l=0,h=r.length;l<h;l++){const d=r[l];if(d.POSITION!==void 0){const f=t.json.accessors[d.POSITION],p=f.min,m=f.max;if(p!==void 0&&m!==void 0){if(c.setX(Math.max(Math.abs(p[0]),Math.abs(m[0]))),c.setY(Math.max(Math.abs(p[1]),Math.abs(m[1]))),c.setZ(Math.max(Math.abs(p[2]),Math.abs(m[2]))),f.normalized){const g=_T(tp[f.componentType]);c.multiplyScalar(g)}a.max(c)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}s.expandByVector(a)}n.boundingBox=s;const o=new Mn;s.getCenter(o.center),o.radius=s.min.distanceTo(s.max)/2,n.boundingSphere=o}function uO(n,e,t){const i=e.attributes,s=[];function r(o,a){return t.getDependency("accessor",o).then(function(c){n.setAttribute(a,c)})}for(const o in i){const a=bT[o]||o.toLowerCase();a in n.attributes||s.push(r(i[o],a))}if(e.indices!==void 0&&!n.index){const o=t.getDependency("accessor",e.indices).then(function(a){n.setIndex(a)});s.push(o)}return _i.workingColorSpace!==Ri&&"COLOR_0"in i&&console.warn(`THREE.GLTFLoader: Converting vertex colors from "srgb-linear" to "${_i.workingColorSpace}" not supported.`),dh(n,e),mee(n,e,t),Promise.all(s).then(function(){return e.targets!==void 0?lee(n,e.targets,t):n})}typeof globalThis!==void 0&&!("OffscreenCanvas"in globalThis)&&(globalThis.OffscreenCanvas=class{constructor(e,t){u(this,"canvas");return this.canvas=document.createElement("canvas"),this.canvas.width=e,this.canvas.height=t,this.canvas.convertToBlob=(i,s)=>new Promise(r=>{this.canvas.toBlob(r,i,s)}),this.canvas}});const sv=function(n){return x(n)},x=function(n){if(n===void 0&&(n=null),!Array.isArray(n))n=dO(n);else for(let e=0;e<n.length;e++){const t=n[e];n[e]=dO(t)}return function(e,t){typeof t!="string"&&(t=t.name),Object.getOwnPropertyDescriptor(e,"$serializedTypes")||(e.$serializedTypes={});const i=e.$serializedTypes=e.$serializedTypes||{};i[t]=n}};function dO(n){var e,t;switch((t=(e=n==null?void 0:n.prototype)==null?void 0:e.constructor)==null?void 0:t.name){case"Number":case"String":case"Boolean":return null}return n}const tC="NEEDLE_progressive",Nn=re("debugprogressive"),iC=Symbol("needle-progressive-texture"),xT=new Map;let nC=!1;Nn&&window.addEventListener("keyup",n=>{n.key==="p"&&(xT.forEach((e,t)=>{Object.entries(e).forEach(([i,s])=>{nC?t[i]=s.lod0:t[i]=s.original,t.needsUpdate=!0})}),nC=!nC)});const Ug=class{constructor(e,t,i){u(this,"parser");u(this,"sourceId");u(this,"context");this.parser=e,this.sourceId=t,this.context=i}get name(){return tC}static assignTextureLOD(e,t,i,s=0){if(!i)return Promise.resolve(null);const r=[];if(i instanceof HA)for(const o of Object.keys(i.uniforms)){const a=i.uniforms[o].value;if(a instanceof Ft){const c=this.assignTextureLODForSlot(e,t,i,s,o,a);r.push(c)}}else for(const o of Object.keys(i)){const a=i[o];if(a instanceof Ft){const c=this.assignTextureLODForSlot(e,t,i,s,o,a);r.push(c)}}return ix(r)}static assignTextureLODForSlot(e,t,i,s,r,o){return(o==null?void 0:o.isTexture)!==!0?Promise.resolve(null):(Nn&&console.log(`-----------
`,"FIND",i.name,r,o==null?void 0:o.name,o==null?void 0:o.userData,o,i),Ug.getOrLoadTexture(e,t,i,r,o,s).then(a=>{if((a==null?void 0:a.isTexture)===!0){if(Nn&&console.warn("Assign LOD",i.name,r,a.name,a.guid,i,"Prev:",o,"Now:",a,`
--------------`),i[r]=a,a.needsUpdate=!0,i.needsUpdate=!0,Nn){let c=xT.get(i);c||(c={},xT.set(i,c));let l=c[r];l||(l=c[r]={original:o,lod0:a}),l.lod0=a}return a}return null}))}afterRoot(e){var t;return Nn&&console.log("AFTER",this.sourceId,e),(t=this.parser.json.textures)==null||t.forEach((i,s)=>{if(i!=null&&i.extensions){const r=i==null?void 0:i.extensions[tC];r&&this.parser.getDependency("texture",s).then(a=>(Nn&&console.log("> Progressive: register",a.name,a.uuid,r),a.source&&(a.source[iC]=r),Ug.cache.set(a.uuid,r),a))}}),null}static async getOrLoadTexture(e,t,i,s,r,o){var l,h;const a=r.uuid;let c;if(r.source&&r.source[iC]&&(c=r.source[iC]),c||(c=Ug.cache.get(a)),c){Nn&&console.log(a,c.uri,c.guid);const d=Bp(t,c.uri);if(d.endsWith(".glb")||d.endsWith(".gltf")){if(!c.guid)return console.warn("missing pointer for glb/gltf texture",c),null;const f=d+"_"+c.guid;if(this.resolved[f]){let m=this.resolved[f];if((l=m.image)!=null&&l.data||(h=m.source)!=null&&h.data)return Nn&&console.log("Texture has already been loaded: "+f,i.name,s,r.name,m),m=this.copySettings(r,m),m;m&&Nn&&console.warn("Texture has been disposed, will load again: "+f,i.name,s,r.name,m.source.data)}const p=this.onProgressiveLoadStart(e,t,d,i,s);try{if(this.currentlyLoading[f]!==void 0){Nn&&console.log("Already loading:",i.name+"."+s,f);let A=await this.currentlyLoading[f];return A&&(A=this.copySettings(r,A)),A}const m=c,g=new Promise(async(A,v)=>{var S;const b=new Gp;nv(b,e),Nn&&console.warn("Start loading "+d,i.name,s,m.guid),Nn&&await ha(Math.random()*1e3);const _=await b.loadAsync(d),T=_.parser;Nn&&console.log("Loading finished "+d,i.name,s,m.guid);let E=-1,M=!1;if(!((S=_.parser.json)!=null&&S.textures))return Nn&&console.warn("No textures in glTF "+d+" - may be a bug",i.name,s,m.guid),A(null);for(const C of _.parser.json.textures)if(E++,C!=null&&C.extensions){const D=C==null?void 0:C.extensions[tC];if(D!=null&&D.guid&&D.guid===m.guid){M=!0;break}}if(!M)return A(null);let I=await T.getDependency("texture",E);I=this.copySettings(r,I),I&&(I.guid=m.guid),this.resolved[f]=I,Nn&&console.log(i.name,s,'change "'+r.name+'"  "'+I.name+'"',d,E,I,i,f),A(I)});return this.currentlyLoading[f]=g,await g}finally{delete this.currentlyLoading[f],this.onProgressiveLoadEnd(p)}}else{const f=this.onProgressiveLoadStart(e,t,d,i,s);try{Nn&&console.log("Load texture from uri: "+d);const m=await new dl().loadAsync(d);return m?(m.guid=c.guid,m.flipY=!1,m.needsUpdate=!0,m.colorSpace=r.colorSpace,Nn&&console.log(c,m)):Nn&&console.warn("failed loading",d),m}finally{this.onProgressiveLoadEnd(f)}}}else Nn&&console.warn("unknown texture",r.name,r.uuid,r);return null}static copySettings(e,t){const i=e.clone(),s=t.source,r=t.mipmaps;return i.copy(e),i.source=s,i.mipmaps=r,i}static beginListenStart(e,t){this._progressiveEventListeners.has(e)||this._progressiveEventListeners.set(e,new fO),this._progressiveEventListeners.get(e).start.push(t)}static stopListenStart(e,t){if(!this._progressiveEventListeners.has(e))return;const i=this._progressiveEventListeners.get(e).start,s=i.indexOf(t);s>=0&&i.splice(s,1)}static beginListenEnd(e,t){this._progressiveEventListeners.has(e)||this._progressiveEventListeners.set(e,new fO),this._progressiveEventListeners.get(e).end.push(t)}static stopListenEnd(e,t){if(!this._progressiveEventListeners.has(e))return;const i=this._progressiveEventListeners.get(e).end,s=i.indexOf(t);s>=0&&i.splice(s,1)}static onProgressiveLoadStart(e,t,i,s,r){this._currentProgressiveLoadingInfo.has(e)||this._currentProgressiveLoadingInfo.set(e,[]);const o=new gee(e,t,i,s,r),a=this._currentProgressiveLoadingInfo.get(e),c=this._progressiveEventListeners.get(e);return c&&c.onStart(o),a.push(o),o}static onProgressiveLoadEnd(e){if(!e)return;const t=e.context;if(!this._currentProgressiveLoadingInfo.has(t))return;const i=this._currentProgressiveLoadingInfo.get(t),s=i.indexOf(e);if(s<0)return;i.splice(s,1);const r=this._progressiveEventListeners.get(t);r&&r.onEnd(e)}};let Eo=Ug;u(Eo,"cache",new Map),u(Eo,"resolved",{}),u(Eo,"currentlyLoading",{}),u(Eo,"_progressiveEventListeners",new Map),u(Eo,"_currentProgressiveLoadingInfo",new Map);class gee{constructor(e,t,i,s,r){u(this,"context");u(this,"source");u(this,"uri");u(this,"material");u(this,"slot");this.context=e,this.source=t,this.uri=i,this.material=s,this.slot=r}}class fO{constructor(){u(this,"start",[]);u(this,"end",[])}onStart(e){for(const t of this.start)t(e)}onEnd(e){for(const t of this.end)t(e)}}const sC=re("debugstencil");function Aee(n,e){return(n&1<<e.layer)!=0}const vee=Symbol("stencils"),Ou=class{constructor(e,t){u(this,"parser");u(this,"source");this.parser=e,this.source=t}get name(){return"NEEDLE_render_objects"}static applyStencil(e){if(!e)return;const t=e.sourceId;if(sC&&console.log(t,Ou.stencils),!t)return;const i=Ou.stencils[t];if(i)for(let s=i.length-1;s>=0;s--){const r=i[s];if(Aee(r.layer,e)){sC&&console.log(r),setTimeout(()=>{zr()&&sI(e.gameObject)&&(gn("Stencil not supported on instanced objects"),console.warn("Stencil not supported on instanced objects",e))},500);for(let o=0;o<e.sharedMaterials.length;o++){let a=e.sharedMaterials[o];a&&(a=a.clone(),a[vee]=!0,a.stencilWrite=!0,a.stencilWriteMask=255,a.stencilFuncMask=255,a.stencilRef=r.value,a.stencilFunc=r.compareFunc,a.stencilZPass=r.passOp,a.stencilFail=r.failOp,a.stencilZFail=r.zFailOp,e.sharedMaterials[o]=a)}e.gameObject.renderOrder=r.event*1e3+r.index*50;break}}}afterRoot(e){const t=this.parser.json.extensions;if(t){const i=t[bee];if(i){sC&&console.log(i);const s=i.stencil;if(s&&Array.isArray(s))for(const r of s){const o={...r};o.compareFunc=yee(o.compareFunc),o.passOp=rC(o.passOp),o.failOp=rC(o.failOp),o.zFailOp=rC(o.zFailOp),Ou.stencils[this.source]||(Ou.stencils[this.source]=[]),Ou.stencils[this.source].push(o)}}}return null}};let vg=Ou;u(vg,"stencils",{});var ka;(function(n){n[n.Keep=0]="Keep",n[n.Zero=1]="Zero",n[n.Replace=2]="Replace",n[n.IncrementSaturate=3]="IncrementSaturate",n[n.DecrementSaturate=4]="DecrementSaturate",n[n.Invert=5]="Invert",n[n.IncrementWrap=6]="IncrementWrap",n[n.DecrementWrap=7]="DecrementWrap"})(ka||(ka={}));var La;(function(n){n[n.Disabled=0]="Disabled",n[n.Never=1]="Never",n[n.Less=2]="Less",n[n.Equal=3]="Equal",n[n.LessEqual=4]="LessEqual",n[n.Greater=5]="Greater",n[n.NotEqual=6]="NotEqual",n[n.GreaterEqual=7]="GreaterEqual",n[n.Always=8]="Always"})(La||(La={}));function rC(n){switch(n){case ka.Keep:return hh;case ka.Zero:return GL;case ka.Replace:return VL;case ka.IncrementSaturate:return HL;case ka.DecrementSaturate:return QL;case ka.IncrementWrap:return jL;case ka.DecrementWrap:return WL;case ka.Invert:return qL}return 0}function yee(n){switch(n){case La.Never:return dE;case La.Less:return XL;case La.Equal:return YL;case La.LessEqual:return JL;case La.Greater:return KL;case La.NotEqual:return ZL;case La.GreaterEqual:return $L;case La.Always:return ob}return dE}const bee="NEEDLE_render_objects",lz=Symbol("customVisibilityFlag");function _f(n,e){n.layers[lz]=e}const pO=Symbol("DidPatchLayers");function _ee(){const n=Ar.prototype;if(n[pO])return;n[pO]=!0;const e=n.test;n.test=function(t){return this[lz]===!1?!1:e.call(this,t)}}_ee();class _A{constructor(e,t){u(this,"method");u(this,"enabled");this.method=e,this.enabled=t!==void 0?t:!0}invoke(...e){if(this.enabled!==!1){if(!this.method){console.warn("No function. Please check you assigned a method to invoke on export",this);return}this.method(...e)}}}const xee=n=>/^[A-Z]*$/.test(n);class lI extends Event{constructor(){super(...arguments);u(this,"args")}}class Cs{constructor(e){u(this,"isEventList",!0);u(this,"target");u(this,"key");u(this,"_isInvoking",!1);u(this,"methods",[]);this.methods=e??[]}setEventTarget(e,t){if(this.key=e,this.target=t,this.key!==void 0){let i="",s=!1;for(const r of this.key)s&&xee(r)&&(i+="-"),s=!0,i+=r.toLowerCase();this.key=i}}get listenerCount(){var e;return((e=this.methods)==null?void 0:e.length)??0}get isInvoking(){return this._isInvoking}invoke(...e){var t;if(this._isInvoking)return console.warn("Circular event invocation detected. Please check your event listeners for circular references.",this),!1;if(((t=this.methods)==null?void 0:t.length)<=0)return!1;this._isInvoking=!0;try{for(const i of this.methods)i.invoke(...e);if(typeof this.target=="object"&&typeof this.key=="string"){const i=this.target.dispatchEvent;if(typeof i=="function"){const s=new lI(this.key);s.args=e,i.call(this.target,s)}}}finally{this._isInvoking=!1}return!0}addEventListener(e){return this.methods.push(new _A(e,!0)),e}removeEventListener(e){if(e)for(let t=this.methods.length-1;t>=0;t--)this.methods[t].method===e&&(this.methods[t].enabled=!1,this.methods.splice(t,1))}removeAllEventListeners(){this.methods.length=0}}const mO=Symbol("previous-visibility"),Wf=class extends Zt{render(e,t,i){if(i instanceof h1)this._unsupported_effectcomposer_warning||(console.warn("RenderTexture.render() does not yet support EffectComposer"),this._unsupported_effectcomposer_warning=!0);else{this.onBeforeRender();const s=i.getRenderTarget(),r=i.xr.enabled;i.xr.enabled=!1,i.setRenderTarget(this),i.clear(!0,!0,!0),i.render(e,t),i.setRenderTarget(s),i.xr.enabled=r,this.onAfterRender()}}onBeforeRender(){Wf._userSet.clear();const e=bF(this.texture,!0,null,Wf._userSet);for(const t of e)t instanceof me&&(t[mO]=t.visible,t.visible=!1)}onAfterRender(){for(const e of Wf._userSet)e instanceof me&&(e.visible=e[mO]);Wf._userSet.clear()}};let id=Wf;u(id,"_userSet",new Set);class wee extends Bl{constructor(){super([ye,Ii])}onDeserialize(e){if(e!=null)return e.a!==void 0?new Ii(e.r,e.g,e.b,e.a):e.alpha!==void 0?new Ii(e.r,e.g,e.b,e.alpha):new ye(e.r,e.g,e.b)}onSerialize(e){if(e!=null)return e.a!==void 0?{r:e.r,g:e.g,b:e.b,a:e.a}:{r:e.r,g:e.g,b:e.b}}}new wee;class See extends Bl{constructor(){super(ge)}onSerialize(e,t){if(t.objectToNode!==void 0&&e.uuid){const i=t.objectToNode[e.uuid];return _s&&console.log(i,e.name,e.uuid),{node:i}}}onDeserialize(e,t){var i,s,r;if(typeof e=="string"){if(e.endsWith(".glb")||e.endsWith(".gltf")){if(t.serializable instanceof Array&&t.serializable.includes(ii))return;Tt()&&gn("Detected wrong usage of @serializable with Object3D or GameObject. Instead you should use AssetReference here! Please see the console for details.");const o=(s=(i=t.target)==null?void 0:i.constructor)==null?void 0:s.name;console.warn(`Wrong usage of @serializable detected in your script "${o}"

It looks like you used @serializable(Object3D) or @serializable(GameObject) for a prefab or scene reference which is exported to a separate glTF file.

To fix this please change your code to:

@serializable(AssetReference)
${t.path}! : AssetReference;
\0`)}return}if(e){if(e.node!==void 0&&t.nodeToObject){const o=t.nodeToObject[e.node];return _s&&console.log("Deserialized object reference?",e,o,t==null?void 0:t.nodeToObject),o||console.warn("Did not find node: "+e.node,t.nodeToObject,t.object),o}else if(e.guid){if(!t.context){console.error("Missing context");return}let o;const a=(r=t.gltf)==null?void 0:r.scene;return a&&(o=le.findByGuid(e.guid,a)),o||(o=le.findByGuid(e.guid,t.context.scene)),o?_s&&console.log("Deserialized object reference?",e,o,t==null?void 0:t.nodeToObject):((Tt()||_s)&&console.warn("Could not resolve object reference",t.path,e,t.target,t.context.scene),e.could_not_resolve=!0),o}}}}const Cee=new See;class Eee extends Bl{constructor(){super([Te,Te])}onSerialize(e,t){if(e!=null&&e.guid)return{guid:e.guid}}onDeserialize(e,t){var i;if(e!=null&&e.guid){if(e.___persistentAsset){_s&&console.log("Skipping component deserialization because it's a persistent asset",e);return}const s=t.path;_s&&console.log(e.guid,t.root,t.object,t.target);let r=this.findObjectForGuid(e.guid,t.root);if(r||t.context&&(r=this.findObjectForGuid(e.guid,(i=t.context)==null?void 0:i.scene),r))return r;(Tt()||_s)&&console.warn('Could not resolve component reference: "'+s+'" using guid '+e.guid,t.target),e.could_not_resolve=!0;return}}findObjectForGuid(e,t){if(t.guid===e)return t;const i=le.foreachComponent(t,s=>{if(s.guid===e)return s},!1);if(i!==void 0)return i;for(let s=0;s<t.children.length;s++){const r=t.children[s],o=this.findObjectForGuid(e,r);if(o)return o}}}const oC=new Eee,Tee=Symbol("eventListDebugInfo");class Mee extends Bl{constructor(){super([Cs])}onSerialize(e,t){console.log("TODO: SERIALIZE EVENT")}onDeserialize(e,t){var i,s,r,o;if(typeof e=="function")return new Cs([new _A(e,!0)]);if(e&&e.type==="EventList"){_s&&console.log("DESERIALIZE EVENT",e);const a=new Array;if(e.calls&&Array.isArray(e.calls))for(const h of e.calls){let p=function(A){if(typeof A=="object"){let v=Cee.onDeserialize(A,t);if(v||(v=oC.onDeserialize(A,t)),v)return v}return A};_s&&console.log(h);let d=oC.findObjectForGuid(h.target,t.root);!d&&((i=t.context)!=null&&i.scene)&&(d=oC.findObjectForGuid(h.target,(s=t.context)==null?void 0:s.scene));const f=((r=h.method)==null?void 0:r.length)>0;if(d&&f){const A=()=>{const b=h.method[0].toUpperCase()+h.method.slice(1);if(typeof d[b]=="function"){console.warn(`EventList method:
Could not find method ${h.method} on object ${d.name}. Please rename ${h.method} to ${b}?
`,d[b],`
 in script: `,d),gn("EventList methods must start with lowercase letter, see console for details");return}else console.warn(`EventList method:
Could not find method ${h.method} on object ${d.name}`,d,typeof d[h.method])};if(typeof d[h.method]!="function"){let b=!1,_=d;for(;_;){const T=Object.getOwnPropertyDescriptor(_,h.method);if(T&&(T.writable===!0||T.set)){b=!0;break}_=Object.getPrototypeOf(_)}!b&&(Tt()||_s)&&A()}}let m=h.argument;m!==void 0?m=p(m):h.arguments!==void 0&&(m=h.arguments.map(p));const g=f?this.createEventMethod(d,h.method,m):void 0,y=new _A(g,h.enabled);if(y.method||(y[Tee]=(o=t.object)==null?void 0:o.name),!d||!y.method){const A=t.object?"Current object: "+t.object.name+", "+t.object.guid:null;d?console.warn('EventList method not found: "'+h.method+'" on',d):console.warn("EventList is missing target - will be ignored",h.target,A,e)}else a.push(y)}const c=new Cs(a);_s&&console.log(c);const l=t.target;return l!==void 0&&t.path!==void 0&&c.setEventTarget(t.path,l),c}}createEventMethod(e,t,i){return(...s)=>{const r=e[t];typeof r=="function"?i!==void 0?Array.isArray(i)?r==null||r.call(e,...i):r==null||r.call(e,i):r==null||r.call(e,...s):e[t]=i}}}new Mee;class Iee extends Bl{constructor(){super([id,Zt])}onSerialize(e,t){}onDeserialize(e,t){if(e instanceof Ft&&t.type===id){const i=e,s=new id(i.image.width,i.image.height,{colorSpace:Ri});return s.texture=i,i.isRenderTargetTexture=!0,i.flipY=!0,i.offset.y=1,i.repeat.y=-1,i.needsUpdate=!0,i instanceof lc&&(i.isCompressedTexture=!1,i.format=xi),s}}}new Iee;class Ree extends Bl{constructor(){super([URL])}onSerialize(e,t){return null}onDeserialize(e,t){if(typeof e=="string"&&e.length>0)return Bp(t.gltfId,e)}}new Ree;const Pee=re("gizmos"),Bee=re("debugboxhelper"),bo=class extends Te{constructor(){super(...arguments);u(this,"box",null);u(this,"_lastMatrixUpdateFrame",-1);u(this,"_helper",null);u(this,"_color",null)}isInBox(t,i){var r;if(!t)return;if(this.box||(this.box=new Mi),t.type==="Mesh")bo.testBox.setFromObject(t);else if(t.type==="Group"){if(bo.testBox.makeEmpty(),t.children.length>0)for(let o=0;o<t.children.length;o++)t.children[o].type==="Mesh"&&bo.testBox.expandByObject(t)}else{const o=Ht(t,bo._position),a=br(t,bo._size);i!==void 0&&a.multiplyScalar(i),bo.testBox.setFromCenterAndSize(o,a)}this.updateBox();const s=(r=this.box)==null?void 0:r.intersectsBox(bo.testBox);return s&&Bee&&kt.DrawWireBox3(bo.testBox,16711680,5),s}intersects(t){return t?this.updateBox(!1).intersectsBox(t):!1}updateBox(t=!1){if(this.box||(this.box=new Mi),t||this.context.time.frameCount!=this._lastMatrixUpdateFrame){const i=this._lastMatrixUpdateFrame<0;this._lastMatrixUpdateFrame=this.context.time.frameCount;const s=i,r=Ht(this.gameObject,bo._position,s),o=br(this.gameObject,bo._size);this.box.setFromCenterAndSize(r,o)}return this.box}awake(){this._helper=null,this._color=null,this.box=null}showHelper(t=null,i=!1){var s;if(!(!Pee&&!i)){if(this._helper){t&&((s=this._color)==null||s.set(t)),this.gameObject.add(this._helper);return}this._helper=eI(t),this.gameObject.add(this._helper)}}};let ra=bo;u(ra,"testBox",new Mi),u(ra,"_position",new w),u(ra,"_size",new w(.01,.01,.01));var hz=globalThis&&globalThis.__decorate||function(n,e,t,i){var s=arguments.length,r=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(e,t,r):o(e,t))||r);return s>3&&r&&Object.defineProperty(e,t,r),r};const Bm=re("debugreflectionprobe"),gO=re("noreflectionprobe"),Dee=Symbol("reflectionProbeKey"),Oee=Symbol("original material"),Na=class extends Te{constructor(){var t;super();u(this,"_texture");u(this,"center");u(this,"size");u(this,"_boxHelper");Na._probes.has(this.context)||Na._probes.set(this.context,[]),(t=Na._probes.get(this.context))==null||t.push(this)}static get(t,i,s,r){if(!t||t.isObject3D!==!0||gO)return null;const o=Na._probes.get(i);if(o){for(const a of o)if(a.__didAwake||a.__internalAwake(),a.enabled){if(r){if(a.gameObject===r)return a}else if(a.isInBox(t,void 0))return Bm&&console.log("Found reflection probe",t.name,a.name),a}}return Bm&&console.debug("Did not find reflection probe",t.name,s,t),null}set texture(t){if(t&&!(t instanceof Ft)){console.error("ReflectionProbe.texture must be a Texture",t);return}this._texture=t,t&&(t.mapping=Oo,t.colorSpace=zt,t.needsUpdate=!0)}get texture(){return this._texture}isInBox(t,i){var s;return(s=this._boxHelper)==null?void 0:s.isInBox(t,i)}awake(){this._boxHelper=this.gameObject.addNewComponent(ra),this._boxHelper.updateBox(!0),Bm&&this._boxHelper.showHelper(5592320,!0),this.texture&&(this.texture.mapping=Oo,this.texture.colorSpace=zt,this.texture.needsUpdate=!0)}onDestroy(){const t=Na._probes.get(this.context);if(t){const i=t.indexOf(this);i>=0&&t.splice(i,1)}}onSet(t){var s;if(gO||!this.enabled||((s=t.sharedMaterials)==null?void 0:s.length)<=0||!this.texture)return;let i=Na._rendererMaterialsCache.get(t);i||(i=[],Na._rendererMaterialsCache.set(t,i));for(let r=0;r<t.sharedMaterials.length;r++){const o=t.sharedMaterials[r];if(!o||o.envMap===void 0)continue;let a=i[r];const c=o===(a==null?void 0:a.copy),l=!a||a.material.uuid!==o.uuid||a.copy.version!==o.version;if(!c&&l){if(Bm){let f="";a?a.material!==o?f="reference changed; cached instance?: "+c:a.copy.version!==o.version&&(f="version changed"):f="not cached",console.warn("Cloning material",o.name,o.version,"Reason:",f,`
`,o.uuid,`
`,a==null?void 0:a.copy.uuid,`
`,t.name)}const d=o.clone();d.version=o.version,a?(a.copy=d,a.material=o):(a={material:o,copy:d},i.push(a)),d[Dee]=this,d[Oee]=o,Bm&&console.log("Set reflection",t.name,t.guid)}const h=a==null?void 0:a.copy;h.envMap=this.texture,t.sharedMaterials[r]=h}}onUnset(t){const i=Na._rendererMaterialsCache.get(t);if(i)for(let s=0;s<i.length;s++){const r=i[s];t.sharedMaterials[s]=r.material}}};let cl=Na;u(cl,"_probes",new Map),u(cl,"_rendererMaterialsCache",new Map);hz([x(w)],cl.prototype,"center",void 0);hz([x(w)],cl.prototype,"size",void 0);const aC=re("debuglightmaps");class Fb{constructor(e,t){u(this,"lightmapIndex",-1);u(this,"lightmapScaleOffset",new tt(1,1,0,0));u(this,"context");u(this,"gameObject");u(this,"lightmapTexture",null);u(this,"lightmapScaleOffsetUniform",{value:new tt(1,1,0,0)});u(this,"lightmapUniform",{value:null});u(this,"onBeforeCompile",(e,t)=>{aC&&console.log("Lightmaps, before compile",e),e.lightMapUv="uv1",this.lightmapScaleOffsetUniform.value=this.lightmapScaleOffset,this.lightmapUniform.value=this.lightmapTexture,e.uniforms.lightmapScaleOffset=this.lightmapScaleOffsetUniform});this.gameObject=e,this.context=t}get lightmap(){return this.lightmapTexture}set lightmap(e){e!==this.lightmapTexture&&(this.lightmapTexture=e,this.applyLightmap())}init(e,t,i){console.assert(this.gameObject!==void 0&&this.gameObject!==null,"Missing gameobject",this),this.lightmapIndex=e,!(this.lightmapIndex<0)&&(this.lightmapScaleOffset=t,this.lightmapTexture=i,aC&&(console.log("Lightmap:",this.gameObject.name,e,`
ScaleOffset:`,t,`
Texture:`,i),this.setLightmapDebugMaterial()),this.applyLightmap())}updateLightmapUniforms(e){const t=e.uniforms;t&&t.lightmap&&(this.lightmapScaleOffsetUniform.value=this.lightmapScaleOffset,t.lightmapScaleOffset=this.lightmapScaleOffsetUniform)}applyLightmap(){if(this.gameObject.type==="Object3D"){aC&&console.warn("Can not add lightmap. Is this object missing a renderer?",this.gameObject.name);return}if(this.gameObject.type==="Group"){console.warn("Lightmap on multimaterial object is not supported yet... please open a feature request on https://github.com/needle-tools/needle-engine-support if your project requires it");return}console.assert(this.gameObject.type==="Mesh","Lightmap only works on meshes",this);const e=this.gameObject;if(e.geometry.getAttribute("uv1")||e.geometry.setAttribute("uv1",e.geometry.getAttribute("uv")),Array.isArray(this.gameObject.material)){const t=this.gameObject.material;for(let i=0;i<t.length;i++){const r=t[i].clone();t[i]=r,r.onBeforeCompile=this.onBeforeCompile}}else{const t=this.gameObject.material.clone();this.gameObject.material=t,this.gameObject.material.onBeforeCompile=this.onBeforeCompile}if(this.lightmapIndex>=0&&this.lightmapTexture){const t=this.gameObject.material;t&&(t.lightMap=this.lightmapTexture,t.needsUpdate=!0)}}setLightmapDebugMaterial(){this.gameObject.material=new Et({vertexShader:`
                varying vec2 vUv1;
                void main()
                {
                    vUv1 = uv1;
                    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
                }
                `,fragmentShader:`
                uniform sampler2D lightMap;
                uniform float lightMapIntensity;
                uniform vec4 lightmapScaleOffset;
                varying vec2 vUv1;

                // took from threejs 05fc79cd52b79e8c3e8dec1e7dca72c5c39983a4
                vec4 conv_sRGBToLinear( in vec4 value ) {
                    return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );
                }

                void main() {
                    vec2 lUv = vUv1.xy * lightmapScaleOffset.xy + vec2(lightmapScaleOffset.z, (1. - (lightmapScaleOffset.y + lightmapScaleOffset.w)));
                    
                    vec4 lightMapTexel = texture2D( lightMap, lUv);
                    gl_FragColor = lightMapTexel;
                    gl_FragColor.a = 1.;
                }
                `,defines:{USE_LIGHTMAP:""}})}}var Ol=globalThis&&globalThis.__decorate||function(n,e,t,i){var s=arguments.length,r=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(e,t,r):o(e,t))||r);return s>3&&r&&Object.defineProperty(e,t,r),r};const V0=re("debugrenderer"),kee=re("debugskinnedmesh"),AO=re("noInstancing"),Km=re("debuginstancing"),Lee=re("debugprogressive"),Fee=re("noprogressive"),Uee=re("wireframe");var Df;(function(n){n[n.Off=0]="Off",n[n.BlendProbes=1]="BlendProbes",n[n.BlendProbesAndSkybox=2]="BlendProbesAndSkybox",n[n.Simple=3]="Simple"})(Df||(Df={}));class uz{constructor(){u(this,"path",null);u(this,"asset",null);u(this,"default")}}var vO;(function(n){n[n.Both=0]="Both",n[n.Back=1]="Back",n[n.Front=2]="Front"})(vO||(vO={}));class Nee{constructor(e,t){u(this,"_renderer");u(this,"_targets",[]);u(this,"_indexMapMaxIndex");u(this,"_indexMap");u(this,"_changed",!1);this._renderer=e;const i=this.setMaterial.bind(this),s=this.getMaterial.bind(this),r=e.gameObject;if(this._targets=[],r)switch(r.type){case"Group":this._targets=[...r.children];break;case"SkinnedMesh":case"Mesh":this._targets.push(r);break}let o=!1,a,c=0;for(let l=0;l<this._targets.length;l++){const h=this._targets[l];if(!h)continue;const d=h.material;if(d){d.shadowSide=d.side;for(let f=0;f<t.length;f++){const p=t[f];if(!p){o=!0;continue}if(d.name===p.name){a===void 0&&(a=new Map),a.set(f,l),c=Math.max(c,f);break}}}}if(o){this._indexMapMaxIndex=c,this._indexMap=a;const l=`Renderer ${e.name} was initialized with missing materials - this may lead to unexpected behaviour when trying to access sharedMaterials by index.`;console.warn(l),zr()&&gn("Found renderer with missing materials: please check the console for details.")}return new Proxy(this,{get(l,h){if(typeof h=="string"){const d=parseInt(h);if(!isNaN(d))return s(d)}return l[h]},set(l,h,d){return typeof h=="string"&&i(d,Number.parseInt(h)),Reflect.set(l,h,d)?(d instanceof Ot&&(l.changed=!0),!0):!1}})}get changed(){return this._changed}set changed(e){e===!0&&V0&&console.warn("SharedMaterials have changed: "+this._renderer.name,this),this._changed=e}is(e){return this._renderer===e}get length(){return this._indexMapMaxIndex!==void 0?this._indexMapMaxIndex+1:this._targets.length}*[Symbol.iterator](){for(let e=0;e<this.length;e++)yield this.getMaterial(e)}resolveIndex(e){const t=this._indexMap;return t&&t.has(e)?t.get(e):e}setMaterial(e,t){if(t=this.resolveIndex(t),t<0||t>=this._targets.length)return;const i=this._targets[t];!i||i.material===void 0||(i.material=e,this.changed=!0)}getMaterial(e){if(e=this.resolveIndex(e),e<0)return null;const t=this._targets;if(e>=t.length)return null;const i=t[e];return i?i.material:null}}class an extends Te{constructor(){super(...arguments);u(this,"receiveShadows",!1);u(this,"shadowCastingMode",Ub.Off);u(this,"lightmapIndex",-1);u(this,"lightmapScaleOffset",new tt(1,1,0,0));u(this,"enableInstancing");u(this,"renderOrder");u(this,"allowOcclusionWhenDynamic",!0);u(this,"probeAnchor");u(this,"reflectionProbeUsage",Df.Off);u(this,"_lightmaps");u(this,"_sharedMeshes",[]);u(this,"_sharedMaterials");u(this,"_originalMaterials");u(this,"_lightmapTextureOverride");u(this,"allowProgressiveLoading",!0);u(this,"_isInstancingEnabled",!1);u(this,"handles");u(this,"onBeforeRenderThree",(t,i,s,r,o,a)=>{var c;if(o.envMapIntensity!==void 0){const l=this.hasLightmap?Math.PI:1,h=((c=this.context.mainCameraComponent)==null?void 0:c.environmentIntensity)??1;o.envMapIntensity=Math.max(0,h*this.context.sceneLighting.environmentIntensity/l)}if(this._lightmaps)for(const l of this._lightmaps)l.updateLightmapUniforms(o)});u(this,"_reflectionProbe",null)}static setVisible(t,i){_f(t,i)}get sharedMesh(){if(this.gameObject.type==="Mesh")return this.gameObject;if(this.gameObject.type==="SkinnesMesh")return this.gameObject;if(this.gameObject.type==="Group")return this.gameObject.children[0]}get sharedMeshes(){if(this.destroyed||!this.gameObject)return this._sharedMeshes;if(this._sharedMeshes.length=0,this.gameObject.type==="Group")for(const t of this.gameObject.children)(t.type==="Mesh"||t.type==="SkinnedMesh")&&this._sharedMeshes.push(t);else(this.gameObject.type==="Mesh"||this.gameObject.type==="SkinnedMesh")&&this._sharedMeshes.push(this.gameObject);return this._sharedMeshes}get sharedMaterial(){return this.sharedMaterials[0]}set sharedMaterial(t){this.sharedMaterials[0]!==t&&(this.sharedMaterials[0]=t,this.applyLightmapping())}get material(){return this.sharedMaterials[0]}set material(t){this.sharedMaterial=t}set sharedMaterials(t){if(!this._originalMaterials)this._originalMaterials=t;else if(t){let i=!1;for(let s=0;s<this._sharedMaterials.length;s++){const r=s<t.length?t[s]:null;r&&r instanceof Ot?this.sharedMaterials[s]=r:i||(i=!0,console.warn("Can not assign null as material: "+this.name,r))}}}get sharedMaterials(){return(!this._sharedMaterials||!this._sharedMaterials.is(this))&&(this._originalMaterials||(this._originalMaterials=[]),this._sharedMaterials=new Nee(this,this._originalMaterials)),this._sharedMaterials}static get shouldSuppressInstancing(){return AO}get lightmap(){var t;return(t=this._lightmaps)!=null&&t.length?this._lightmaps[0].lightmap:null}set lightmap(t){var i;if(this._lightmapTextureOverride=t,t===void 0&&(t=this.context.lightmaps.tryGetLightmap(this.sourceId,this.lightmapIndex)),(i=this._lightmaps)!=null&&i.length)for(const s of this._lightmaps)s.lightmap=t}get hasLightmap(){const t=this.lightmap;return t!=null}registering(){this.enabled||this.setVisibility(!1)}awake(){if(V0&&console.log("Renderer ",this.name,this),this.clearInstancingState(),this.probeAnchor&&V0&&this.probeAnchor.add(new Fo(.2)),this._reflectionProbe=null,this.isMultiMaterialObject(this.gameObject)){for(const t of this.gameObject.children)this.context.addBeforeRenderListener(t,this.onBeforeRenderThree),t.layers.mask=this.gameObject.layers.mask;if(this.renderOrder!==void 0){let t=0;for(let i=0;i<this.gameObject.children.length;i++){const s=this.gameObject.children[i];if(!(!this.isMeshOrSkinnedMesh(s)||le.getComponent(s,an))){if(this.renderOrder.length<=t){console.warn("Incorrect renderOrder element count",this,this.renderOrder.length+" but expected "+this.gameObject.children.length,"Index: "+t,"ChildElement:",s);continue}s.renderOrder=this.renderOrder[t],t+=1}}}}else this.isMeshOrSkinnedMesh(this.gameObject)?(this.context.addBeforeRenderListener(this.gameObject,this.onBeforeRenderThree),this.renderOrder!==void 0&&this.renderOrder.length>0&&(this.gameObject.renderOrder=this.renderOrder[0])):this.context.addBeforeRenderListener(this.gameObject,this.onBeforeRenderThree);if(this.applyLightmapping(),Uee)for(let t=0;t<this.sharedMaterials.length;t++){const i=this.sharedMaterials[t];i&&(i.wireframe=!0)}}applyLightmapping(){var t;if(this.lightmapIndex>=0){const i=this.gameObject.type,s=this._lightmapTextureOverride!==void 0?this._lightmapTextureOverride:this.context.lightmaps.tryGetLightmap(this.sourceId,this.lightmapIndex);if(s){if(this._lightmaps||(this._lightmaps=[]),i==="Mesh"){const r=this.gameObject.material;if(r!=null&&r.isMeshBasicMaterial)r&&console.warn("Lightmapping is not supported on MeshBasicMaterial",r.name);else{if(this._lightmaps.length<=0){const a=new Fb(this.gameObject,this.context);this._lightmaps.push(a)}this._lightmaps[0].init(this.lightmapIndex,this.lightmapScaleOffset,s)}}else if(this.isMultiMaterialObject(this.gameObject)&&this.sharedMaterials.length>0)for(let r=0;r<this.gameObject.children.length;r++){const o=this.gameObject.children[r];if(!((t=o.material)!=null&&t.isMeshBasicMaterial)){let a;r>=this._lightmaps.length?(a=new Fb(o,this.context),this._lightmaps.push(a)):a=this._lightmaps[r],a.init(this.lightmapIndex,this.lightmapScaleOffset,s)}}}else V0&&console.warn("Lightmap not found",this.sourceId,this.lightmapIndex)}}clearInstancingState(){this._isInstancingEnabled=!1,this.handles=void 0}setInstancingEnabled(t){if(this._isInstancingEnabled===t)return t&&(this.handles===void 0||this.handles!=null&&this.handles.length>0);if(this._isInstancingEnabled=t,t){if(this.handles===void 0){if(this.handles=Gee.setup(this,this.gameObject,this.context,null,{rend:this,foundMeshes:0,useMatrixWorldAutoUpdate:this.useInstanceMatrixWorldAutoUpdate()}),this.handles)return le.markAsInstancedRendered(this.gameObject,!0),!0}else if(this.handles!==null){for(const i of this.handles)i.updateInstanceMatrix(!0),i.add();return le.markAsInstancedRendered(this.gameObject,!0),!0}}else{if(this.handles)for(const i of this.handles)i.remove();return!0}return!1}useInstanceMatrixWorldAutoUpdate(){return!0}start(){if(this.enableInstancing&&!AO&&(this.setInstancingEnabled(!0),uc.markDirty(this.gameObject)),this.gameObject.frustumCulled=this.allowOcclusionWhenDynamic,this.isMultiMaterialObject(this.gameObject))for(let t=0;t<this.gameObject.children.length;t++){const i=this.gameObject.children[t];i.frustumCulled=this.allowOcclusionWhenDynamic}}onEnable(){this.sharedMeshes,this.setVisibility(!0),this._isInstancingEnabled?this.setInstancingEnabled(!0):this.enabled&&this.applyStencil(),this.updateReflectionProbe()}onDisable(){this.setVisibility(!1),this.handles&&this.handles.length>0&&this.setInstancingEnabled(!1)}onDestroy(){if(this.handles=null,this.isMultiMaterialObject(this.gameObject))for(const t of this.gameObject.children)this.context.removeBeforeRenderListener(t,this.onBeforeRenderThree);else this.context.removeBeforeRenderListener(this.gameObject,this.onBeforeRenderThree)}applyStencil(){vg.applyStencil(this)}onBeforeRender(){var t,i;if(this.gameObject){if(this.isMultiMaterialObject(this.gameObject)&&((t=this.gameObject.children)==null?void 0:t.length)>0)for(const s of this.gameObject.children)this.applySettings(s);else this.applySettings(this.gameObject);if(this.sharedMaterials.changed&&(this.sharedMaterials.changed=!1,this.applyLightmapping()),(i=this.handles)!=null&&i.length&&this.gameObject[aA]===!0){Km&&console.log("UPDATE INSTANCED MATRICES",this.context.time.frame),this.gameObject[aA]=!1;for(let r=this.handles.length-1;r>=0;r--)this.handles[r].updateInstanceMatrix();this.gameObject.matrixWorldNeedsUpdate=!1}if(this.handles&&this.handles.length<=0&&le.markAsInstancedRendered(this.gameObject,!1),this._isInstancingEnabled&&this.handles)for(let s=0;s<this.handles.length;s++){const r=this.handles[s];_f(r.object,!1)}for(const s of this.sharedMaterials)s&&this.loadProgressiveTextures(s);this.reflectionProbeUsage!==Df.Off&&this._reflectionProbe&&this._reflectionProbe.onSet(this)}}onAfterRender(){if(this._isInstancingEnabled&&this.handles)for(let t=0;t<this.handles.length;t++){const i=this.handles[t];_f(i.object,!0)}this.reflectionProbeUsage!==Df.Off&&this._reflectionProbe&&this._reflectionProbe.onUnset(this)}loadProgressiveTextures(t){return!Fee&&t&&t._didRequestTextureLOD===void 0&&this.allowProgressiveLoading?(t._didRequestTextureLOD=0,Lee&&console.log("Load material LOD",t.name),Eo.assignTextureLOD(this.context,this.sourceId,t)):Promise.resolve(!0)}applySettings(t){t.receiveShadow=this.receiveShadows,this.shadowCastingMode==Ub.On?t.castShadow=!0:t.castShadow=!1}updateReflectionProbe(){if(this._reflectionProbe=null,this.reflectionProbeUsage!==Df.Off){if(!this.probeAnchor)return;this.startCoroutine(this._updateReflectionProbe(),jt.LateUpdate)}}*_updateReflectionProbe(){const t=this.probeAnchor||this.gameObject,i=!!this.probeAnchor;this._reflectionProbe=cl.get(t,this.context,i,this.probeAnchor)}setVisibility(t){if(!this.isMultiMaterialObject(this.gameObject))_f(this.gameObject,t);else for(const i of this.gameObject.children)this.isMeshOrSkinnedMesh(i)&&_f(i,t)}isMultiMaterialObject(t){return t.type==="Group"}isMeshOrSkinnedMesh(t){return t.type==="Mesh"||t.type==="SkinnedMesh"}}Ol([x()],an.prototype,"receiveShadows",void 0);Ol([x()],an.prototype,"shadowCastingMode",void 0);Ol([x()],an.prototype,"lightmapIndex",void 0);Ol([x(tt)],an.prototype,"lightmapScaleOffset",void 0);Ol([x()],an.prototype,"enableInstancing",void 0);Ol([x()],an.prototype,"renderOrder",void 0);Ol([x()],an.prototype,"allowOcclusionWhenDynamic",void 0);Ol([x(ge)],an.prototype,"probeAnchor",void 0);Ol([x()],an.prototype,"reflectionProbeUsage",void 0);class Tx extends an{}class dz extends Tx{awake(){var e;super.awake(),this.allowOcclusionWhenDynamic=!1,(e=this.gameObject.parent)==null||e.updateWorldMatrix(!1,!0)}onBeforeRender(){if(super.onBeforeRender(),kee&&this.gameObject instanceof cc&&this.gameObject.boundingSphere){const e=Gn(this.gameObject.boundingSphere.center).applyMatrix4(this.gameObject.matrixWorld);kt.DrawWireSphere(e,this.gameObject.boundingSphere.radius,"red")}}}var Ub;(function(n){n[n.Off=0]="Off",n[n.On=1]="On",n[n.TwoSided=2]="TwoSided",n[n.ShadowsOnly=3]="ShadowsOnly"})(Ub||(Ub={}));class zee{constructor(){u(this,"objs",[])}setup(e,t,i,s,r,o=0){e.applySettings(t);const a=this.tryCreateOrAddInstance(t,i,r);if(a)e.loadProgressiveTextures(a.instancer.material),s===null&&(s=[]),s.push(a);else if(o<=0&&t.type!=="Mesh"){const c=o+1;for(const l of t.children)s=this.setup(e,l,i,s,r,c)}return o===0&&r.useMatrixWorldAutoUpdate&&s&&s.length>=0&&this.autoUpdateInstanceMatrix(t),s}tryCreateOrAddInstance(e,t,i){if(e.type==="Mesh"){const s=i.foundMeshes;if(i.foundMeshes+=1,!i.rend.enableInstancing||s>=i.rend.enableInstancing.length||!i.rend.enableInstancing[s])return null;const r=e,o=r.geometry,a=r.material;for(const h of this.objs)if(!h.isFull()&&h.geo===o&&h.material===a)return h.addInstance(r);const c=new H0(e.name,o,a,200,t);return this.objs.push(c),c.addInstance(r)}return null}autoUpdateInstanceMatrix(e){const t=e.matrixWorld.multiplyMatrices.bind(e.matrixWorld),i=e.matrixWorld.clone(),s=(r,o)=>{const a=t(r,o);return(e[aA]||i.equals(a)===!1)&&(i.copy(a),e[aA]=!0),a};e.matrixWorld.multiplyMatrices=s}}const Gee=new zee;class Vee{constructor(e,t,i){u(this,"instanceIndex",-1);u(this,"object");u(this,"instancer");this.instanceIndex=e,this.object=t,this.instancer=i,t[wF]=i,le.markAsInstancedRendered(t,!0)}get name(){return this.object.name}updateInstanceMatrix(e=!1){this.instanceIndex<0||(this.object.updateWorldMatrix(!0,e),this.instancer.updateInstance(this.object.matrixWorld,this.instanceIndex))}setMatrix(e){this.instanceIndex<0||this.instancer.updateInstance(e,this.instanceIndex)}add(){this.instanceIndex>=0||this.instancer.add(this)}remove(){this.instanceIndex<0||this.instancer.remove(this)}}const hR=class{constructor(e,t,i,s,r){u(this,"name","");u(this,"geo");u(this,"material");u(this,"context");u(this,"inst");u(this,"handles",[]);u(this,"maxCount");u(this,"_needUpdateBounds",!1);u(this,"onBeforeRender",()=>{this.inst.layers.enableAll(),this._needUpdateBounds&&this.inst[IE]===!0&&(Km&&console.log("Update instancing bounds",this.name,this.inst.matrixWorldNeedsUpdate),this.updateBounds())});u(this,"onAfterRender",()=>{this.inst.layers.disableAll()});this.name=e,this.geo=t,this.material=i,this.context=r,this.maxCount=s,Km&&(i=new ri({color:this.randomColor()})),this.inst=new B_(t,i,s),this.inst[IE]=!0,this.inst.count=0,this.inst.visible=!0,this.context.scene.add(this.inst),i instanceof HA&&(i.defines.USE_INSTANCING=!0,i.needsUpdate=!0),r.pre_render_callbacks.push(this.onBeforeRender),r.post_render_callbacks.push(this.onAfterRender)}get mesh(){return this.inst}get visible(){return this.inst.visible}set visible(e){this.inst.visible=e}get castShadow(){return this.inst.castShadow}set castShadow(e){this.inst.castShadow=e}set receiveShadow(e){this.inst.receiveShadow=e}updateBounds(e=!0,t=!0){this._needUpdateBounds=!1,e&&this.inst.computeBoundingBox(),t&&this.inst.computeBoundingSphere()}get currentCount(){return this.inst.count}isFull(){return this.currentCount>=this.maxCount}randomColor(){return new ye(Math.random(),Math.random(),Math.random())}addInstance(e){if(this.currentCount>=this.maxCount)return console.error("TOO MANY INSTANCES - resize is not yet implemented!",this.inst.count),null;const t=new Vee(-1,e,this);return e.castShadow===!0&&this.inst.castShadow===!1&&(this.inst.castShadow=!0),e.receiveShadow===!0&&this.inst.receiveShadow===!1&&(this.inst.receiveShadow=!0),this.add(t),t}add(e){e.instanceIndex<0&&(e.instanceIndex=this.currentCount,e.instanceIndex>=this.handles.length?this.handles.push(e):this.handles[e.instanceIndex]=e),e.object.updateWorldMatrix(!0,!0),this.inst.setMatrixAt(e.instanceIndex,e.object.matrixWorld),this.inst.instanceMatrix.needsUpdate=!0,this.inst.count+=1,this._needUpdateBounds=!0,this.inst.count>0&&(this.inst.visible=!0),Km&&console.log("Added",this.name,this.inst.count)}remove(e){if(!e||e.instanceIndex<0||e.instanceIndex>=this.handles.length||this.inst.count<=0)return;if(this.handles[e.instanceIndex]!==e){console.error("instance handle is not part of renderer, was it removed before?",e.instanceIndex,this.name);const i=this.handles.indexOf(e);if(i<0)return;e.instanceIndex=i}if(this.handles[e.instanceIndex]=null,this.inst.setMatrixAt(e.instanceIndex,hR.nullMatrix),!(e.instanceIndex>=this.currentCount-1)&&this.currentCount>0){const i=this.handles[this.currentCount-1];i&&(i.instanceIndex=e.instanceIndex,i.updateInstanceMatrix(),this.handles[e.instanceIndex]=i,this.handles[this.currentCount-1]=null)}this.inst.count>0&&(this.inst.count-=1),e.instanceIndex=-1,this._needUpdateBounds=!0,this.inst.count<=0&&(this.inst.visible=!1),this.inst.instanceMatrix.needsUpdate=!0,Km&&console.log("Removed",this.name,this.inst.count)}updateInstance(e,t){this.inst.setMatrixAt(t,e),this.inst.instanceMatrix.needsUpdate=!0,this._needUpdateBounds=!0}};let H0=hR;u(H0,"nullMatrix",new Ce);function jh(n){return n=n.replace(/[^a-zA-Z0-9_]/g,""),n.match(/^[a-zA-Z_]/)||(n="_"+n),n}function fz(n){if(n.length===0)return null;const e=n.map(i=>{const s=new Array;for(;i.parent;)s.unshift(i.parent),i=i.parent;return s});return e[0].findLast(i=>e.every(s=>s.includes(i)))||null}function pz(n){const e=fz(n),t=new Set;for(const i of n){let s=i.parent;for(;s&&s!==e;)n.includes(s)||t.add(s),s=s.parent}return t}const ku=class{constructor(e,t,i,s=null,r=null,o=null,a=null,c=null){u(this,"uuid");u(this,"name");u(this,"displayName");u(this,"matrix");u(this,"_isDynamic");u(this,"geometry");u(this,"material");u(this,"camera");u(this,"parent");u(this,"skinnedMesh");u(this,"children",[]);u(this,"animations");u(this,"_eventListeners");this.uuid=e,this.name=jh(t),this.displayName=t,this.matrix=i.clone(),this.geometry=s,this.material=r,this.camera=o,this.parent=null,this.children=[],this._eventListeners={},this._isDynamic=!1,this.skinnedMesh=a,this.animations=c}get isDynamic(){return this._isDynamic}set isDynamic(e){this._isDynamic=e}static createEmptyParent(e){const t=new ku(Vn.generateUUID(),e.name+"_empty_"+ku.USDObject_export_id++,e.matrix);return e.parent.add(t),t.add(e),t.isDynamic=!0,e.matrix=new Ce().identity(),t}static createEmpty(){const e=new ku(Vn.generateUUID(),"Empty_"+ku.USDObject_export_id++,new Ce);return e.isDynamic=!0,e}is(e){return e?this.uuid===e.uuid:!1}isEmpty(){return!this.geometry}clone(){const e=new ku(Vn.generateUUID(),this.name,this.matrix,this.geometry,this.material);return e.isDynamic=this.isDynamic,e}deepClone(){const e=this.clone();for(const t of this.children)t&&e.add(t.deepClone());return e}getPath(){let e=this.parent,t=this.name;for(;e;)t=(e.parent?e.name:e.name+"/Scenes/Scene")+"/"+t,e=e.parent;return"</"+t+">"}add(e){e.parent&&e.parent.remove(e),e.parent=this,this.children.push(e)}remove(e){const t=this.children.indexOf(e);t>=0&&(e.parent===this&&(e.parent=null),this.children.splice(t,1))}addEventListener(e,t){this._eventListeners[e]||(this._eventListeners[e]=[]),this._eventListeners[e].push(t)}removeEventListener(e,t){if(!this._eventListeners[e])return;const i=this._eventListeners[e].indexOf(t);i>=0&&this._eventListeners[e].splice(i,1)}onSerialize(e,t){const i=this._eventListeners.serialize;i&&i.forEach(s=>s(e,t))}};let Zr=ku;u(Zr,"USDObject_export_id",0);class mz extends Zr{constructor(){super(void 0,"StageRoot",new Ce,null,null,null);u(this,"stageLength");this.children=[],this.stageLength=200}get isDocumentRoot(){return!0}get isDynamic(){return!1}add(t){t.parent=this,this.children.push(t)}remove(t){const i=this.children.indexOf(t);i>=0&&(t.parent===this&&(t.parent=null),this.children.splice(i,1))}traverse(t,i=null){if(i!==null?t(i):i=this,i.children)for(const s of i.children)this.traverse(t,s)}findById(t){let i=!1;function s(r){if(!i){if(r.uuid===t)return i=!0,r;if(r.children)for(const o of r.children){const a=s(o);if(a)return a}}}return s(this)}buildHeader(t){return`#usda 1.0
(
	customLayerData = {
		string creator = "Needle Engine USDZExporter"
	}
	defaultPrim = "${jh(this.name)}"
	metersPerUnit = 1
	upAxis = "Y"
	startTimeCode = 0
	endTimeCode = ${t}
	timeCodesPerSecond = 60
	framesPerSecond = 60
)
`}}const cf=`
`,jr="</StageRoot/Materials";class Hee{constructor(){u(this,"str");u(this,"indent");this.str="",this.indent=0}clear(){this.str="",this.indent=0}beginBlock(e=void 0,t="{",i=!0){e!==void 0?(e=this.applyIndent(e),this.str+=e,i?(this.str+=cf,this.str+=this.applyIndent(t)):this.str+=" "+t):this.str+=this.applyIndent(t),this.str+=cf,this.indent+=1}closeBlock(e="}"){this.indent-=1,this.str+=this.applyIndent(e)+cf}beginArray(e){e=this.applyIndent(e+" = ["),this.str+=e,this.str+=cf,this.indent+=1}closeArray(){this.indent-=1,this.str+=this.applyIndent("]")+cf}appendLine(e=""){e=this.applyIndent(e),this.str+=e,this.str+=cf}toString(){return this.str}applyIndent(e){let t="";for(let i=0;i<this.indent;i++)t+="	";return t+e}}class Qee{constructor(e,t,i,s){u(this,"root");u(this,"exporter");u(this,"extensions");u(this,"quickLookCompatible");u(this,"materials");u(this,"textures");u(this,"files");u(this,"document");u(this,"output");u(this,"animations");this.root=e,this.exporter=t,this.quickLookCompatible=s,i&&(this.extensions=i),this.materials=new Map,this.textures={},this.files={},this.document=new mz,this.output="",this.animations=[]}}class yO{constructor(){u(this,"ar",{anchoring:{type:"plane"},planeAnchoring:{alignment:"horizontal"}});u(this,"quickLookCompatible",!1);u(this,"extensions",[]);u(this,"maxTextureSize",4096)}}let jee=class{constructor(){u(this,"debug");u(this,"sceneAnchoringOptions",{});u(this,"extensions");this.debug=!1}getEndTimeCode(e){let t=0;for(const i of e){const s=i.duration*60;t<s&&(t=s)}return t}async parse(e,t=new yO){t=Object.assign(new yO,t),this.sceneAnchoringOptions=t;const i=new Qee(e,this,t.extensions,t.quickLookCompatible);this.extensions=i.extensions;const s=i.files,r="model.usda";s[r]=null;const o=i.materials,a=i.textures;await Q0(i,"onBeforeBuildDocument");const c=[];e.traverseVisible(m=>{if(m.isSkinnedMesh){const g=m.skeleton.bones,y=fz(g);y&&c.push({object:m,originalParent:m.parent,newParent:y})}});for(const m of c){const{object:g,originalParent:y,newParent:A}=m;this.debug&&console.log("REPARENTING",g,"from",y,"to",A),A.add(g)}gz(e,i.document,i),await Q0(i,"onAfterBuildDocument"),Wee(i,()=>$ee(o,a,t.quickLookCompatible)),await Q0(i,"onAfterSerialize");for(const m of c){const{object:g,originalParent:y,newParent:A}=m;y.add(g)}const l=this.getEndTimeCode(i.animations),d=i.document.buildHeader(l)+`
`+i.output;this.debug&&console.log(d),s[r]=yb(d),i.output="";const f=new Rl({antialias:!1,alpha:!0});for(const m in a){const g=a[m];let y=g.texture;const A=bz.includes(y.format);(y.isCompressedTexture||y.isRenderTargetTexture)&&(y=qee(y,t.maxTextureSize,f));const v=await vz(y.image,g.scale,!1,t.maxTextureSize).catch(b=>{console.error("Error converting texture to canvas",y,b)});if(v){const b=await v.convertToBlob({type:A?"image/png":"image/jpeg",quality:.95});s[`textures/${m}.${A?"png":"jpg"}`]=new Uint8Array(await b.arrayBuffer())}else console.warn("Can`t export texture: ",y)}f.dispose();let p=0;for(const m in s){const g=s[m],y=34+m.length;p+=y;const A=p&63;if(A!==4){const v=64-A,b=new Uint8Array(v);s[m]=[g,{extra:{12345:b}}]}p=g.length}return Yq(s,{level:0})}};function gz(n,e,t){if(!n.visible)return;let i,s,r;(n instanceof me||n instanceof cc)&&(s=n.geometry,r=n.material);const o=le.getComponent(n,an);if(o&&!o.enabled&&(s=void 0,r=void 0),(n instanceof me||n instanceof cc)&&r&&(r instanceof Ur||r instanceof ri)){const a=Wy(n),c=n instanceof cc?n:null;i=new Zr(n.uuid,a,n.matrix,s,r,void 0,c,n.animations)}else if(n instanceof Wt||n instanceof vc){const a=Wy(n);i=new Zr(n.uuid,a,n.matrix,void 0,void 0,n)}else{const a=Wy(n);i=new Zr(n.uuid,a,n.matrix,void 0,void 0,void 0,void 0,n.animations)}if(i){if(i.displayName=n.name,e&&e.add(i),e=i,t.extensions)for(const a of t.extensions)a.onExportObject&&a.onExportObject.call(a,n,i,t)}else{const a=Wy(n),c=new Zr(n.uuid,a,n.matrix);e&&e.add(c),e=c}for(const a of n.children)gz(a,e,t)}async function Wee(n,e){for(const i of n.document.children)Az(i,n);const t=new Hee;t.beginBlock(`def Xform "${n.document.name}"`),t.beginBlock(`def Scope "Scenes" (
		kind = "sceneLibrary"
	)`),t.beginBlock(`def Xform "Scene" (
			apiSchemas = ["Preliminary_AnchoringAPI"]
			customData = {
				bool preliminary_collidesWithEnvironment = 0
				string sceneName = "Scene"
			}
			sceneName = "Scene"
		)`),t.appendLine(`token preliminary:anchoring:type = "${n.exporter.sceneAnchoringOptions.ar.anchoring.type}"`),n.exporter.sceneAnchoringOptions.ar.anchoring.type==="plane"&&t.appendLine(`token preliminary:planeAnchoring:alignment = "${n.exporter.sceneAnchoringOptions.ar.planeAnchoring.alignment}"`),n.exporter.sceneAnchoringOptions.ar.anchoring.type==="image"&&t.appendLine(`rel preliminary:imageAnchoring:referenceImage = </${n.document.name}/Scenes/Scene/AnchoringReferenceImage>`),t.appendLine();for(const i of n.document.children)yz(i,t,n);Q0(n,"onAfterHierarchy",t),t.closeBlock(),t.closeBlock(),t.appendLine(e()),t.closeBlock(),n.output+=t.toString()}function Az(n,e){var s,r;if(n==null)return;const t=n.geometry,i=n.material;if(t)if(i&&("isMeshStandardMaterial"in i&&i.isMeshStandardMaterial||"isMeshBasicMaterial"in i&&i.isMeshBasicMaterial)){const o="geometries/"+wT(t,n.name)+".usda";if(!(o in e.files)){const a=Kee(t,(r=(s=n.skinnedMesh)==null?void 0:s.skeleton)==null?void 0:r.bones);e.files[o]=Jee(a)}}else console.warn("THREE.USDZExporter: Unsupported material type (USDZ only supports MeshStandardMaterial)",name);i&&(i.uuid in e.materials||(e.materials[i.uuid]=i));for(const o of n.children)Az(o,e)}async function Q0(n,e,t=null){if(n.extensions){for(const i of n.extensions)if(i&&typeof i[e]=="function"){const r=i[e].call(i,n,t);r instanceof Promise&&await r}}}let Qy=null,cC,lf,jy;function qee(n,e=1/0,t=null){cC||(cC=new Wn(2,2,1,1)),lf||(lf=new Et({uniforms:{blitTexture:new we(n)},vertexShader:`
            varying vec2 vUv;
            void main(){
                vUv = uv;
				vUv.y = 1. - vUv.y;
                gl_Position = vec4(position.xy * 1.0,0.,.999999);
            }`,fragmentShader:`
            uniform sampler2D blitTexture; 
            varying vec2 vUv;

            void main(){ 
                gl_FragColor = vec4(vUv.xy, 0, 1);
                
                #ifdef IS_SRGB
                gl_FragColor = LinearTosRGB( texture2D( blitTexture, vUv) );
                #else
                gl_FragColor = texture2D( blitTexture, vUv);
                #endif
				gl_FragColor.rgb *= gl_FragColor.a;
            }`})),lf.uniforms.blitTexture.value=n,lf.defines.IS_SRGB=n.colorSpace==zt,lf.needsUpdate=!0,jy||(jy=new me(cC,lf),jy.frustumCulled=!1);const i=new Wt,s=new Ws;s.add(jy),t||(t=Qy=new Rl({antialias:!1,alpha:!0})),t.setSize(Math.min(n.image.width,e),Math.min(n.image.height,e)),t.clear(),t.render(s,i);const r=new Ft(t.domElement);return r.minFilter=n.minFilter,r.magFilter=n.magFilter,r.wrapS=n.wrapS,r.wrapT=n.wrapT,r.name=n.name,Qy&&(Qy.dispose(),Qy=null),r}function Xee(n){return typeof HTMLImageElement<"u"&&n instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&n instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&n instanceof OffscreenCanvas||typeof ImageBitmap<"u"&&n instanceof ImageBitmap}async function vz(n,e=void 0,t=!1,i=4096){if(Xee(n)){const s=i/Math.max(n.width,n.height),r=new OffscreenCanvas(n.width*Math.min(1,s),n.height*Math.min(1,s)),o=r.getContext("2d");if(!o)throw new Error("Could not get canvas 2D context");if(t===!0&&(o.translate(0,r.height),o.scale(1,-1)),o.drawImage(n,0,0,r.width,r.height),e!==void 0){const a=e.x,c=e.y,l=e.z,h=e.w,d=o.getImageData(0,0,r.width,r.height),f=d.data;for(let p=0;p<f.length;p+=4)f[p+0]=f[p+0]*a,f[p+1]=f[p+1]*c,f[p+2]=f[p+2]*l,f[p+3]=f[p+3]*h;o.putImageData(d,0,0)}return r}else throw new Error("THREE.USDZExporter: No valid image data found. Unable to process texture.")}const En=7;function Yee(){return`#usda 1.0
(
    customLayerData = {
        string creator = "Needle Engine USDZExporter"
    }
    metersPerUnit = 1
    upAxis = "Y"
)
`}function Jee(n,e){let t=Yee();return t+=n,yb(t)}function Wy(n){return n.name.replace(/[-<>\(\)\[\]$%&\/\\\=\?\,\;]/g,"")+"_"+n.id}function bO(n){return jh(n.name||"bone_"+n.uuid)}function wT(n,e){return jh(n.name||e||"Geometry_")+n.id}function ip(n,e){let t=bO(n),i=n.parent;for(;i&&i!==e;)t=bO(i)+"/"+t,i=i.parent;return t}function yz(n,e,t){if(n==null)return;const i=n.matrix,s=n.geometry,r=n.material,o=n.camera,a=n.name;if(n.animations)for(const f of n.animations)t.animations.push(f);const c=Of(i);i.determinant()<0&&console.warn("THREE.USDZExporter: USDZ does not support negative scales",a);const l=s&&s.isBufferGeometry&&s.attributes.skinIndex!==void 0&&s.attributes.skinIndex.count>0,h=l?"SkelRoot":"Xform",d=l?'"MaterialBindingAPI", "SkelBindingAPI"':'"MaterialBindingAPI"';if(s?(e.beginBlock(`def ${h} "${a}"`,"(",!1),t.quickLookCompatible&&r&&r.side===Ai&&!l?e.appendLine(`prepend references = @./geometries/${wT(s,a)}.usda@</Geometry_doubleSided>`):e.appendLine(`prepend references = @./geometries/${wT(s,a)}.usda@</Geometry>`),e.appendLine(`prepend apiSchemas = [${d}]`)):o?e.beginBlock(`def Camera "${a}"`,"(",!1):e.beginBlock(`def Xform "${a}"`,"(",!1),n.displayName&&e.appendLine(`displayName = "${n.displayName}"`),e.closeBlock(")"),e.beginBlock(),s&&r){const f=jh(r.name)+`_${r.id}`;e.appendLine(`rel material:binding = </StageRoot/Materials/${f}>`),!t.quickLookCompatible&&r.side===Ai&&(e.beginBlock('over "Geometry" '),e.appendLine("uniform bool doubleSided = 1"),e.closeBlock())}if(l?(e.appendLine("rel skel:skeleton = <Rig>"),e.appendLine("rel skel:animationSource = <Rig/_anim>"),e.appendLine(`matrix4d xformOp:transform = ${Of(new Ce)}`)):e.appendLine(`matrix4d xformOp:transform = ${c}`),e.appendLine('uniform token[] xformOpOrder = ["xformOp:transform"]'),o&&("isOrthographicCamera"in o&&o.isOrthographicCamera?(e.appendLine(`float2 clippingRange = (${o.near}, ${o.far})`),e.appendLine(`float horizontalAperture = ${((Math.abs(o.left)+Math.abs(o.right))*10).toPrecision(En)}`),e.appendLine(`float verticalAperture = ${((Math.abs(o.top)+Math.abs(o.bottom))*10).toPrecision(En)}`),e.appendLine('token projection = "orthographic"')):"isPerspectiveCamera"in o&&o.isPerspectiveCamera&&(e.appendLine(`float2 clippingRange = (${o.near.toPrecision(En)}, ${o.far.toPrecision(En)})`),e.appendLine(`float focalLength = ${o.getFocalLength().toPrecision(En)}`),e.appendLine(`float focusDistance = ${o.focus.toPrecision(En)}`),e.appendLine(`float horizontalAperture = ${o.getFilmWidth().toPrecision(En)}`),e.appendLine('token projection = "perspective"'),e.appendLine(`float verticalAperture = ${o.getFilmHeight().toPrecision(En)}`))),n.onSerialize&&n.onSerialize(e,t),n.children){e.appendLine();for(const f of n.children)yz(f,e,t)}e.closeBlock()}function Zn(n){return Number.isInteger(n)?n.toString():n.toFixed(10)}function Of(n){const e=n.elements;return`( ${qy(e,0)}, ${qy(e,4)}, ${qy(e,8)}, ${qy(e,12)} )`}function qy(n,e){return`(${Zn(n[e+0])}, ${Zn(n[e+1])}, ${Zn(n[e+2])}, ${Zn(n[e+3])})`}function Kee(n,e=[]){return`
def "Geometry"
${Zee(n,e)}
`}function Zee(n,e=[]){const t="Geometry",i=n.attributes,s=i.position.count,r=e&&e.length>0,o=[],a=[];let c=new Array,l=i.skinIndex,h="";if(r){for(const m in e)o.push({bone:e[m],index:parseInt(m)});for(const m of pz(e))o.push({bone:m,index:o.length});const f=e[0].parent;o.sort((m,g)=>ip(m.bone,f)>ip(g.bone,f)?1:-1),h=o.map(m=>'"'+ip(m.bone,f)+'"').join(", ");for(const m in o)a[o[m].index]=parseInt(m);const p=i.skinIndex;c=new Array;for(let m=0;m<p.count;m++){const g=p.getX(m),y=p.getY(m),A=p.getZ(m),v=p.getW(m);c.push(a[g],a[y],a[A],a[v])}l=new it(new Uint16Array(c),4)}const d=i.skinWeight&&i.skinIndex;return`
{	
    def Mesh "${t}" ${d?`(
        prepend apiSchemas = ["SkelBindingAPI"]
    )`:""}
    {
        int[] faceVertexCounts = [${lC(n)}]
        int[] faceVertexIndices = [${hC(n)}]
        normal3f[] normals = [${_O(i.normal,s)}] (
            interpolation = "vertex"
        )
        point3f[] points = [${_O(i.position,s)}]
        ${i.uv?`texCoord2f[] primvars:st = [${wO(i.uv,s)}] (
            interpolation = "vertex"
        )`:""}
		${i.uv2?`texCoord2f[] primvars:st2 = [${wO(i.uv2,s)}] (
            interpolation = "vertex"
        )`:""}
		${d?`matrix4d primvars:skel:geomBindTransform = ( (1, 0, 0, 0), (0, 1, 0, 0), (0, 0, 1, 0), (0, 0, 0, 1) ) (
				elementSize = 1
				interpolation = "constant"
			)`:""}
		${i.skinIndex?`int[] primvars:skel:jointIndices = [${xO(l,!0)}] (
			elementSize = 4
			interpolation = "vertex"
		)`:""}
		${i.skinWeight?`float[] primvars:skel:jointWeights = [${xO(i.skinWeight)}] (
			elementSize = 4
			interpolation = "vertex"
		)`:""}
		${r?`uniform token[] skel:joints = [${h}]`:""}
        uniform token subdivisionScheme = "none"
    }
}

# This is a workaround for QuickLook/RealityKit not supporting the doubleSided attribute. We're adding a second
# geometry definition here, that uses the same mesh data but appends extra faces with reversed winding order.
def "${t}_doubleSided" (
	prepend references = </Geometry>
)
{
	over "Geometry"
	{
		int[] faceVertexCounts = [${lC(n)+", "+lC(n)}]
		int[] faceVertexIndices = [${hC(n)+", "+hC(n,!0)}]
	}
}
`}function lC(n){const e=n.index!==null?n.index.count:n.attributes.position.count;return Array(e/3).fill(3).join(", ")}function hC(n,e=!1){const t=n.index,i=[];if(t!==null)for(let s=0;s<t.count;s++){let r=s;e&&(r=s%3===0?s+2:s%3===2?s-2:s),i.push(t.getX(r))}else{const s=n.attributes.position.count;for(let r=0;r<s;r++){let o=r;e&&(o=r%3===0?r+2:r%3===2?r-2:r),i.push(o)}}return i.join(", ")}function _O(n,e){if(n===void 0)return console.warn("USDZExporter: Normals missing."),Array(e).fill("(0, 0, 0)").join(", ");const t=[];for(let i=0;i<n.count;i++){const s=n.getX(i),r=n.getY(i),o=n.getZ(i);t.push(`(${s.toPrecision(En)}, ${r.toPrecision(En)}, ${o.toPrecision(En)})`)}return t.join(", ")}function xO(n,e=!1){const t=[];for(let i=0;i<n.count;i++){const s=n.getX(i),r=n.getY(i),o=n.getZ(i),a=n.getW(i);t.push(`${e?s:s.toPrecision(En)}`),t.push(`${e?r:r.toPrecision(En)}`),t.push(`${e?o:o.toPrecision(En)}`),t.push(`${e?a:a.toPrecision(En)}`)}return t.join(", ")}function wO(n,e){if(n===void 0)return console.warn("USDZExporter: UVs missing."),Array(e).fill("(0, 0)").join(", ");const t=[];for(let i=0;i<n.count;i++){const s=n.getX(i),r=n.getY(i);t.push(`(${s.toPrecision(En)}, ${1-r.toPrecision(En)})`)}return t.join(", ")}function $ee(n,e,t=!1){const i=[];for(const s in n){const r=n[s];i.push(ete(r,e,t))}return`def "Materials"
    {
${i.join("")}
    }

`}function ete(n,e,t=!1){var f;const i="                ",s=[],r=[],o=jh(n.name)+`_${n.id}`;function a(p){return jh(p.name)+"_"+p.id}function c(p,m,g=void 0,y=void 0){const A=a(p),v=A+(y!==void 0&&y!==1?"_"+y:""),b=t&&y!==void 0&&y!==1,_=b?new tt(1,1,1,y):void 0;y===void 0&&(y=1),b&&(y=1),_&&_.w<=.05&&(_.w=.05),e[v]={texture:p,scale:_};const T=p.channel>0?"st"+p.channel:"st",E=bz.includes(p.format),M={1e3:"repeat",1001:"clamp",1002:"mirror"},I=p.repeat.clone(),S=p.offset.clone(),C=p.rotation,D=Math.sin(C),G=Math.cos(C);S.y=1-S.y-I.y,t?(S.x=S.x/I.x,S.y=S.y/I.y,S.x+=D/I.x,S.y+=G-1):(S.x+=D*I.x,S.y+=(1-G)*I.y);const Q=I.x!=1||I.y!=1||S.x!=0||S.y!=0||C!=0,L=`${jr}/${o}/${"uvReader_"+T}.outputs:result>`,V=`${jr}/${o}/Transform2d_${m}.outputs:result>`,O=m!=="normal"&&g&&(g.r!==1||g.g!==1||g.b!==1||y!==1)||!1,U=m==="normal",H=n instanceof Ur&&n.normalScale?n.normalScale.x*2:2,Y=H.toFixed(En),J=(-1*(H/2)).toFixed(En),se=(1-H).toFixed(En);return`
        ${Q?`def Shader "Transform2d_${m}" (
            sdrMetadata = {
                string role = "math"
            }
        )
        {
            uniform token info:id = "UsdTransform2d"
            float2 inputs:in.connect = ${L}
            float2 inputs:scale = ${CO(I)}
            float2 inputs:translation = ${CO(S)}
			float inputs:rotation = ${(C/Math.PI*180).toFixed(En)}
            float2 outputs:result
        }
		`:""}
		def Shader "${A}_${m}"
        {
            uniform token info:id = "UsdUVTexture"
            asset inputs:file = @textures/${v}.${E?"png":"jpg"}@
			token inputs:sourceColorSpace = "${p.colorSpace==="srgb"?"sRGB":"raw"}"
            float2 inputs:st.connect = ${Q?V:L}
			${O?`
			float4 inputs:scale = (${g?g.r+", "+g.g+", "+g.b:"1, 1, 1"}, ${y})
			`:""}
			${U?`
			float4 inputs:scale = (${Y}, ${Y}, ${Y}, 1)
			float4 inputs:bias = (${J}, ${J}, ${se}, 0)
			`:""}
			token inputs:wrapS = "${M[p.wrapS]}"
			token inputs:wrapT = "${M[p.wrapT]}"
            float outputs:r
            float outputs:g
            float outputs:b
            float3 outputs:rgb
            ${n.transparent||n.alphaTest>0?"float outputs:a":""}
        }`}let l=n.transparent||n.alphaTest?n.opacity:1,h=!1,d=!1;if(n instanceof so&&n.transmission!==void 0&&(l*=1-n.transmission*(1-n.roughness*.5)),n.map?(s.push(`${i}color3f inputs:diffuseColor.connect = ${jr}/${o}/${a(n.map)}_diffuse.outputs:rgb>`),n.transparent?(s.push(`${i}float inputs:opacity.connect = ${jr}/${o}/${a(n.map)}_diffuse.outputs:a>`),h=!0):n.alphaTest>0&&(s.push(`${i}float inputs:opacity.connect = ${jr}/${o}/${a(n.map)}_diffuse.outputs:a>`),h=!0,s.push(`${i}float inputs:opacityThreshold = ${n.alphaTest}`),d=!0),r.push(c(n.map,"diffuse",n.color,l))):s.push(`${i}color3f inputs:diffuseColor = ${SO(n.color)}`),n.alphaHash&&(d?console.warn("Opacity threshold for "+n.name+" was already connected. Skipping alphaHash opacity threshold."):(s.push(`${i}float inputs:opacityThreshold = 0.0000000001`),d=!0)),n.aoMap&&(s.push(`${i}float inputs:occlusion.connect = ${jr}/${o}/${a(n.aoMap)}_occlusion.outputs:r>`),r.push(c(n.aoMap,"occlusion"))),n.alphaMap?(s.push(`${i}float inputs:opacity.connect = ${jr}/${o}/${a(n.alphaMap)}_opacity.outputs:r>`),s.push(`${i}float inputs:opacityThreshold = 0.0000000001`),h=!0,d=!0,r.push(c(n.alphaMap,"opacity",new ye(1,1,1),l))):(h?console.warn("Opacity for "+n.name+" was already connected. Skipping default opacity."):(s.push(`${i}float inputs:opacity = ${l}`),h=!0),n.alphaTest>0&&(d?console.warn("Opacity threshold for "+n.name+" was already connected. Skipping default opacity threshold."):(s.push(`${i}float inputs:opacityThreshold = ${n.alphaTest}`),d=!0))),n instanceof Ur){if(n.emissiveMap){s.push(`${i}color3f inputs:emissiveColor.connect = ${jr}/${o}/${a(n.emissiveMap)}_emissive.outputs:rgb>`);const p=n.emissive.clone();p.multiplyScalar(n.emissiveIntensity),r.push(c(n.emissiveMap,"emissive",p))}else if(((f=n.emissive)==null?void 0:f.getHex())>0){const p=n.emissive.clone();p.multiplyScalar(n.emissiveIntensity),s.push(`${i}color3f inputs:emissiveColor = ${SO(p)}`)}n.normalMap&&(s.push(`${i}normal3f inputs:normal.connect = ${jr}/${o}/${a(n.normalMap)}_normal.outputs:rgb>`),r.push(c(n.normalMap,"normal"))),n.roughnessMap&&n.roughness===1?(s.push(`${i}float inputs:roughness.connect = ${jr}/${o}/${a(n.roughnessMap)}_roughness.outputs:g>`),r.push(c(n.roughnessMap,"roughness"))):s.push(`${i}float inputs:roughness = ${n.roughness!==void 0?n.roughness:1}`),n.metalnessMap&&n.metalness===1?(s.push(`${i}float inputs:metallic.connect = ${jr}/${o}/${a(n.metalnessMap)}_metallic.outputs:b>`),r.push(c(n.metalnessMap,"metallic"))):s.push(`${i}float inputs:metallic = ${n.metalness!==void 0?n.metalness:0}`)}return n instanceof so&&(s.push(`${i}float inputs:clearcoat = ${n.clearcoat}`),s.push(`${i}float inputs:clearcoatRoughness = ${n.clearcoatRoughness}`),s.push(`${i}float inputs:ior = ${n.ior}`),!n.transparent&&!(n.alphaTest>0)&&n.transmissionMap&&(s.push(`${i}float inputs:opacity.connect = ${jr}/${o}/${a(n.transmissionMap)}_transmission.outputs:r>`),r.push(c(n.transmissionMap,"transmission")))),`
		def Material "${o}" (
			${n.name?`displayName = "${n.name}"`:""}
		)
		{
			def Shader "PreviewSurface"
			{
				uniform token info:id = "UsdPreviewSurface"
${s.join(`
`)}
				int inputs:useSpecularWorkflow = 0
				token outputs:surface
			}

			token outputs:surface.connect = ${jr}/${o}/PreviewSurface.outputs:surface>

			def Shader "uvReader_st"
			{
				uniform token info:id = "UsdPrimvarReader_float2"
				token inputs:varname = "st"
				float2 inputs:fallback = (0.0, 0.0)
				float2 outputs:result
			}

			def Shader "uvReader_st2"
			{
				uniform token info:id = "UsdPrimvarReader_float2"
				token inputs:varname = "st2"
				float2 inputs:fallback = (0.0, 0.0)
				float2 outputs:result
			}

${r.join(`
`)}

		}
`}function SO(n){return`(${n.r}, ${n.g}, ${n.b})`}function CO(n){return`(${n.x}, ${n.y})`}const bz=[1023,33777,33778,33779,35842,35843,37496,37808,37809,37810,37811,37812,37813,37814,37815,37816,37817,37818,37819,37820,37821,36492];re("debugusdz");const uR=class{constructor(e,t,i){u(this,"id");u(this,"trigger");u(this,"action");u(this,"exclusive",!1);this.id="Behavior_"+jh(e)+"_"+uR.global_id++,this.trigger=t,this.action=i}makeExclusive(e){return this.exclusive=e,this}writeTo(e,t,i){if(!this.trigger||!this.action)return;i.beginBlock(`def Preliminary_Behavior "${this.id}"`),i.appendLine(`rel actions = <${this.action.id}>`),i.appendLine(`uniform bool exclusive = ${this.exclusive}`);let s="";if(Array.isArray(this.trigger)){s="[";for(let r=0;r<this.trigger.length;r++){const o=this.trigger[r];s+="<"+o.id+">",r+1<this.trigger.length&&(s+=", ")}s+="]"}else s=`<${this.trigger.id}>`;if(i.appendLine(`rel triggers = ${s} `),i.appendLine(),Array.isArray(this.trigger))for(const r of this.trigger)r.writeTo(t,i),i.appendLine();else this.trigger.writeTo(t,i);i.appendLine(),this.action.writeTo(t,i),i.closeBlock()}};let ss=uR;u(ss,"global_id",0);function ST(n,e){var i,s;let t="";if(Array.isArray(n)){let r="[ ";for(let o=0;o<n.length;o++){let a=n[o];if(typeof a=="string")r+=a;else if(typeof a=="object"){a.isObject3D&&(a=e.findById(a.uuid));const c=(i=a.getPath)==null?void 0:i.call(a);r+=c}o+1<n.length&&(r+=", ")}r+=" ]",t=r}else typeof n=="object"&&(n.isObject3D&&(n=e.findById(n.uuid)),t=(s=n.getPath)==null?void 0:s.call(n));return t}const dR=class{constructor(e,t){u(this,"id");u(this,"targetId");u(this,"tokenId");u(this,"type");u(this,"distance");e&&(this.targetId=e),t?this.id=t:this.id="Trigger_"+dR.global_id++}writeTo(e,t){t.beginBlock(`def Preliminary_Trigger "${this.id}"`),this.targetId&&(typeof this.targetId!="string"&&(this.targetId=ST(this.targetId,e)),t.appendLine("rel affectedObjects = "+this.targetId)),this.tokenId&&t.appendLine(`token info:id = "${this.tokenId}"`),this.type&&t.appendLine(`token type = "${this.type}"`),typeof this.distance=="number"&&t.appendLine(`double distance = ${this.distance}`),t.closeBlock()}};let Oh=dR;u(Oh,"global_id",0);class js{static sceneStartTrigger(){const e=new Oh;return e.targetId=void 0,e.tokenId="SceneTransition",e.type="enter",e}static tapTrigger(e){const t=new Oh(e);return t.tokenId="TapGesture",t}static isTapTrigger(e){return(e==null?void 0:e.tokenId)==="TapGesture"}static proximityToCameraTrigger(e,t){const i=new Oh(e);return i.tokenId="ProximityToCamera",i.distance=t,i}}class Hu{constructor(e,t){u(this,"id");u(this,"actions");u(this,"loops",0);u(this,"performCount",1);u(this,"type","serial");this.id=e,this.actions=t}static getId(){return this.global_id++}addAction(e){return this.actions.push(e),this}makeParallel(){return this.type="parallel",this}makeSequence(){return this.type="serial",this}makeLooping(){return this.loops=1,this}makeRepeat(e){return this.performCount=e,this}writeTo(e,t){t.beginBlock(`def Preliminary_Action "${this.id}"`),t.beginArray("rel actions");for(const i of this.actions){if(!i)continue;const s=i===this.actions[this.actions.length-1];t.appendLine("<"+i.id+">"+(s?"":", "))}t.closeArray(),t.appendLine(),t.appendLine('token info:id = "Group"'),t.appendLine(`bool loops = ${this.loops} `),t.appendLine(`int performCount = ${this.performCount} `),t.appendLine(`token type = "${this.type}"`),t.appendLine();for(const i of this.actions)i&&(i.writeTo(e,t),t.appendLine());t.closeBlock()}}u(Hu,"global_id",0);var xA;(function(n){n[n.pop=0]="pop",n[n.blink=1]="blink",n[n.bounce=2]="bounce",n[n.flip=3]="flip",n[n.float=4]="float",n[n.jiggle=5]="jiggle",n[n.pulse=6]="pulse",n[n.spin=7]="spin"})(xA||(xA={}));var Nb;(function(n){n.Relative="relative",n.Absolute="absolute"})(Nb||(Nb={}));var wA;(function(n){n.Allow="allow",n.Ignore="ignore",n.Stop="stop"})(wA||(wA={}));const d_=class{constructor(e,t){u(this,"id");u(this,"tokenId");u(this,"affectedObjects");u(this,"easeType");u(this,"motionType");u(this,"duration");u(this,"moveDistance");u(this,"style");u(this,"type");u(this,"front");u(this,"up");u(this,"start");u(this,"animationSpeed");u(this,"reversed");u(this,"pingPong");u(this,"xFormTarget");u(this,"audio");u(this,"gain");u(this,"auralMode");u(this,"multiplePerformOperation");e&&(this.affectedObjects=e),t?this.id=t:this.id="Action",this.id+="_"+d_.global_id++}clone(){const e=new d_,t=e.id;return Object.assign(e,this),e.id=t,e}writeTo(e,t){t.beginBlock(`def Preliminary_Action "${this.id}"`),this.affectedObjects&&(typeof this.affectedObjects!="string"&&(this.affectedObjects=ST(this.affectedObjects,e)),t.appendLine("rel affectedObjects = "+this.affectedObjects)),typeof this.duration=="number"&&t.appendLine(`double duration = ${this.duration} `),this.easeType&&t.appendLine(`token easeType = "${this.easeType}"`),this.tokenId&&t.appendLine(`token info:id = "${this.tokenId}"`),this.motionType&&t.appendLine(`token motionType = "${this.motionType}"`),typeof this.moveDistance=="number"&&t.appendLine(`double moveDistance = ${this.moveDistance} `),this.style&&t.appendLine(`token style = "${this.style}"`),this.type&&t.appendLine(`token type = "${this.type}"`),this.front&&t.appendLine(`vector3d front = (${this.front.x}, ${this.front.y}, ${this.front.z})`),this.up&&t.appendLine(`vector3d upVector = (${this.up.x}, ${this.up.y}, ${this.up.z})`),typeof this.start=="number"&&t.appendLine(`double start = ${this.start} `),typeof this.animationSpeed=="number"&&t.appendLine(`double animationSpeed = ${this.animationSpeed} `),typeof this.reversed=="boolean"&&t.appendLine(`bool reversed = ${this.reversed}`),typeof this.pingPong=="boolean"&&t.appendLine(`bool reverses = ${this.pingPong}`),this.xFormTarget&&(typeof this.xFormTarget!="string"&&(this.xFormTarget=ST(this.xFormTarget,e)),t.appendLine(`rel xformTarget = ${this.xFormTarget}`)),typeof this.audio=="string"&&t.appendLine(`asset audio = @${this.audio}@`),typeof this.gain=="number"&&t.appendLine(`double gain = ${this.gain}`),typeof this.auralMode=="string"&&t.appendLine(`token auralMode = "${this.auralMode}"`),typeof this.multiplePerformOperation=="string"&&t.appendLine(`token multiplePerformOperation = "${this.multiplePerformOperation}"`),t.closeBlock()}};let To=d_;u(To,"global_id",0);let kf=class xf{constructor(e,t,i){u(this,"x",0);u(this,"y",0);u(this,"z",0);this.x=e,this.y=t,this.z=i}static get up(){return new xf(0,1,0)}static get right(){return new xf(1,0,0)}static get forward(){return new xf(0,0,1)}static get back(){return new xf(0,0,-1)}static get zero(){return new xf(0,0,0)}};var SA;(function(n){n.Play="play",n.Pause="pause",n.Stop="stop"})(SA||(SA={}));var CA;(function(n){n.Spatial="spatial",n.NonSpatial="nonSpatial",n.Ambient="ambient"})(CA||(CA={}));class di{static sequence(...e){return new Hu("group_"+Hu.getId(),e).makeSequence()}static parallel(...e){return new Hu("group_"+Hu.getId(),e).makeParallel()}static fadeAction(e,t,i){const s=new To(e);return s.tokenId="Visibility",s.type=i?"show":"hide",s.duration=t,s.style="basic",s.motionType="none",s.moveDistance=0,s.easeType="none",s}static startAnimationAction(e,t,i=0,s=1,r=!1,o=!1){const a=new To(e);if(a.tokenId="StartAnimation",a.start=t,a.duration=i,a.animationSpeed=s,a.reversed=r,a.pingPong=o,a.multiplePerformOperation=wA.Allow,r&&(a.start-=i),o){a.pingPong=!1;const c=a.clone();return c.reversed=!r,c.start=a.start,c.reversed&&(c.start-=i),di.sequence(a,c)}return a}static waitAction(e){const t=new To;return t.tokenId="Wait",t.duration=e,t}static lookAtCameraAction(e,t=9999999999999,i,s){const r=new To(e);return r.tokenId="LookAtCamera",r.duration=t,r.front=i??kf.forward,r.up=s??kf.up,r}static emphasize(e,t,i=xA.bounce,s=1,r="basic"){const o=new To(e);return o.tokenId="Emphasize",o.duration=t,o.style=r??"basic",o.motionType=xA[i],o.moveDistance=s,o}static transformAction(e,t,i,s,r="inout"){const o=new To(e);return o.tokenId="Transform",o.duration=i,o.type=s,o.easeType=r,Array.isArray(t)&&console.error("Transform target must not be an array",t),o.xFormTarget=t,o}static playAudioAction(e,t,i=SA.Play,s=1,r=CA.Spatial){const o=new To(e);return o.tokenId="Audio",o.type=i,o.audio=t,o.gain=s,o.auralMode=r,o.multiplePerformOperation=wA.Allow,o}}class tte{constructor(e){u(this,"object");u(this,"model");this.object=e}get id(){return this.object.uuid}apply(e){if(!this.model&&(this.model=e.findById(this.object.uuid),!this.model)){console.error("could not find model with id "+this.object.uuid);return}this.onApply(e)}}class _z extends tte{constructor(t,i,s,r){super(t);u(this,"matrix");u(this,"material");u(this,"geometry");u(this,"_enableAction");u(this,"_disableAction");this.matrix=i,this.material=s,this.geometry=r}onApply(t){var r,o;const i=this.model;if(!i)return;(r=i.parent)!=null&&r.isDynamic||Zr.createEmptyParent(i);const s=i.clone();this.matrix&&(s.matrix=this.matrix),this.material&&(s.material=this.material),this.geometry&&(s.geometry=this.geometry),(o=i.parent)==null||o.add(s)}enable(){return this._enableAction?this._enableAction:(this._enableAction=di.fadeAction(this.object,0,!0),this._enableAction)}disable(){return this._disableAction?this._disableAction:(this._disableAction=di.fadeAction(this.object,0,!1),this._disableAction)}}class xz{constructor(e){u(this,"actions");u(this,"sortedActions");this.actions=[...e]}organize(){this.sortedActions={};for(const e of this.actions){const t=e.id;this.sortedActions[t]||(this.sortedActions[t]=[]),this.sortedActions[t].push(e)}}getActions(e){return this.sortedActions||this.organize(),this.sortedActions[e.uuid]}}var wz=globalThis&&globalThis.__decorate||function(n,e,t,i){var s=arguments.length,r=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(e,t,r):o(e,t))||r);return s>3&&r&&Object.defineProperty(e,t,r),r};class Mx extends Te{constructor(){super(...arguments);u(this,"from");u(this,"to");u(this,"width",0);u(this,"centered",!0);u(this,"_centerPos")}awake(){this._centerPos=new w}update(){if(!this.from||!this.to)return;const t=Ht(this.from).clone(),i=Ht(this.to).clone(),s=t.distanceTo(i);this._centerPos.copy(t),this._centerPos.add(i),this._centerPos.multiplyScalar(.5),vr(this.gameObject,this.centered?this._centerPos:t),this.gameObject.lookAt(Ht(this.to).clone()),this.gameObject.scale.set(this.width,this.width,s)}}wz([x(le)],Mx.prototype,"from",void 0);wz([x(le)],Mx.prototype,"to",void 0);var rv=globalThis&&globalThis.__decorate||function(n,e,t,i){var s=arguments.length,r=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(e,t,r):o(e,t))||r);return s>3&&r&&Object.defineProperty(e,t,r),r};const hf=re("debuganimation");class Uo extends Te{constructor(){super(...arguments);u(this,"playAutomatically",!0);u(this,"randomStartTime",!0);u(this,"minMaxSpeed");u(this,"minMaxOffsetNormalized");u(this,"loop",!0);u(this,"clampWhenFinished",!1);u(this,"_tempAnimationClipBeforeGameObjectExisted",null);u(this,"_tempAnimationsArray");u(this,"mixer");u(this,"_actions",[]);u(this,"_currentActions",[]);u(this,"_handles",[]);u(this,"_didInit",!1)}get clip(){var t;return(t=this.animations)!=null&&t.length?this.animations[0]:null}set clip(t){if(!this.__didAwake){hf&&console.warn("Assign clip during serialization",t),this._tempAnimationClipBeforeGameObjectExisted=t;return}t&&(this.gameObject.animations||(this.gameObject.animations=[]),!this.animations.includes(t)&&(this.animations.length>0?this.animations.splice(0,0,t):this.animations.push(t)))}set clips(t){this.animations=t}set animations(t){t==null||!Array.isArray(t)||(this.gameObject?this.gameObject.animations=t:this._tempAnimationsArray=t)}get animations(){return this.gameObject.animations||this._tempAnimationsArray||[]}get currentAction(){return this._currentActions[0]}get currentActions(){return this._currentActions}get actions(){return this._actions}set actions(t){this._actions=t}awake(){hf&&console.log("Animation Awake",this.name,this),this._tempAnimationsArray&&(this.animations=this._tempAnimationsArray,this._tempAnimationsArray=void 0),this._tempAnimationClipBeforeGameObjectExisted&&(this.clip=this._tempAnimationClipBeforeGameObjectExisted,this._tempAnimationClipBeforeGameObjectExisted=null),this.playAutomatically&&this.init()}onEnable(){var t;if(this.playAutomatically&&((t=this.animations)==null?void 0:t.length)>0&&this.currentActions.length<=0){const i=Math.floor(Math.random()*this.actions.length);this.play(i)}}start(){this.randomStartTime&&this.currentAction&&(this.currentAction.time=Math.random()*this.currentAction.getClip().duration)}update(){this.mixer&&this.mixer.update(this.context.time.deltaTime)}getAction(t){var i;return(i=this.actions)==null?void 0:i.find(s=>s.getClip().name===t)}get isPlaying(){for(let t=0;t<this.actions.length;t++)if(this.actions[t].isRunning())return!0;return!1}play(t=0,i){if(hf&&console.log("PLAY",t),this.init(),!this.mixer){hf&&console.warn("Missing mixer",this);return}t===void 0&&(t=0);let s=t;if(typeof t=="number"){if(t>=this.animations.length){hf&&console.log("No animation at index",t);return}s=this.animations[t]}else typeof t=="string"&&(s=this.animations.find(o=>o.name===t));if(!s){console.error("Could not find clip",t);return}i||(i={}),i.minMaxOffsetNormalized||(i.minMaxOffsetNormalized=this.minMaxOffsetNormalized),i.minMaxSpeed||(i.minMaxSpeed=this.minMaxSpeed),i.loop===void 0&&(i.loop=this.loop),i.clampWhenFinished===void 0&&(i.clampWhenFinished=this.clampWhenFinished);for(const o of this.actions)if(o.getClip()===s)return this.internalOnPlay(o,i);if(!(s instanceof Nr)){console.warn("Clip is no AnimationClip",s,"on object: "+this.name);return}const r=this.mixer.clipAction(s);return this.actions.push(r),this.internalOnPlay(r,i)}internalOnPlay(t,i){var s=this.currentAction;if(s===t&&s.isRunning()&&s.time<s.getClip().duration){const c=this.tryFindHandle(t);if(c)return c.getPromise()}const r=(i==null?void 0:i.exclusive)??!0;i!=null&&i.fadeDuration?(r&&(s==null||s.fadeOut(i.fadeDuration)),t.fadeIn(i.fadeDuration)):r&&(s==null||s.stop()),t.reset(),t.enabled=!0,t.time=0,t.timeScale=1;const o=t.getClip();i!=null&&i.minMaxOffsetNormalized&&(t.time=nt.lerp(i.minMaxOffsetNormalized.x,i.minMaxOffsetNormalized.y,Math.random())*o.duration),i!=null&&i.minMaxSpeed&&(t.timeScale=nt.lerp(i.minMaxSpeed.x,i.minMaxSpeed.y,Math.random())),i!=null&&i.clampWhenFinished&&(t.clampWhenFinished=!0),(i==null?void 0:i.startTime)!==void 0&&(t.time=i.startTime),(i==null?void 0:i.loop)!==void 0?t.loop=i.loop?fM:jg:t.loop=jg,t.play(),hf&&console.log("PLAY",t.getClip().name,t);const a=new ite(t,this.mixer,i,c=>{this._handles.splice(this._handles.indexOf(a),1)});return this._handles.push(a),a.getPromise()}tryFindHandle(t){for(const i of this._handles)if(i.action===t)return i}init(){this._didInit||(this._didInit=!0,this.gameObject&&(this.actions=[],this.mixer=new $_(this.gameObject)))}}rv([x()],Uo.prototype,"playAutomatically",void 0);rv([x()],Uo.prototype,"randomStartTime",void 0);rv([x()],Uo.prototype,"loop",void 0);rv([x()],Uo.prototype,"clampWhenFinished",void 0);rv([x(Nr)],Uo.prototype,"clips",null);class ite{constructor(e,t,i,s){u(this,"mixer");u(this,"action");u(this,"promise",null);u(this,"resolve",null);u(this,"reject",null);u(this,"_options");u(this,"_resolveCallback",null);u(this,"_rejectCallback",null);u(this,"_loopCallback");u(this,"_finishedCallback");u(this,"_resolvedOrRejectedCallback");this.action=e,this.mixer=t,this._resolvedOrRejectedCallback=s,this._options=i}getPromise(){return this.promise?this.promise:(this.promise=new Promise((e,t)=>{this._resolveCallback=e,this._rejectCallback=t,this.resolve=this.onResolve.bind(this),this.reject=this.onReject.bind(this)}),this._loopCallback=this.onLoop.bind(this),this._finishedCallback=this.onFinished.bind(this),this.mixer.addEventListener("loop",this._loopCallback),this.mixer.addEventListener("finished",this._finishedCallback),this.promise)}_update(){this._options&&this._options.endTime!==void 0&&this.action.time>this._options.endTime&&(this._options.loop===!0?this.action.time=this._options.startTime??0:(this.action.time=this._options.endTime,this.action.timeScale=0,this.onResolve()))}onResolve(){var e,t;this.dispose(),(e=this._resolvedOrRejectedCallback)==null||e.call(this,this),(t=this._resolveCallback)==null||t.call(this,this.action)}onReject(e){var t,i;this.dispose(),(t=this._resolvedOrRejectedCallback)==null||t.call(this,this),(i=this._rejectCallback)==null||i.call(this,e)}onLoop(e){}onFinished(e){e.action===this.action&&this.onResolve()}dispose(){this._loopCallback&&this.mixer.removeEventListener("loop",this._loopCallback),this._finishedCallback&&this.mixer.removeEventListener("finished",this._finishedCallback),this._loopCallback=void 0,this._finishedCallback=void 0}}var Zh=globalThis&&globalThis.__decorate||function(n,e,t,i){var s=arguments.length,r=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(e,t,r):o(e,t))||r);return s>3&&r&&Object.defineProperty(e,t,r),r};class kl{constructor(){u(this,"time");u(this,"value");u(this,"inTangent");u(this,"inWeight");u(this,"outTangent");u(this,"outWeight");u(this,"weightedMode")}}Zh([x()],kl.prototype,"time",void 0);Zh([x()],kl.prototype,"value",void 0);Zh([x()],kl.prototype,"inTangent",void 0);Zh([x()],kl.prototype,"inWeight",void 0);Zh([x()],kl.prototype,"outTangent",void 0);Zh([x()],kl.prototype,"outWeight",void 0);Zh([x()],kl.prototype,"weightedMode",void 0);class Tl{constructor(){u(this,"keys")}clone(){var t;const e=new Tl;return e.keys=((t=this.keys)==null?void 0:t.map(i=>{const s=new kl;return s.time=i.time,s.value=i.value,s.inTangent=i.inTangent,s.inWeight=i.inWeight,s.outTangent=i.outTangent,s.outWeight=i.outWeight,s.weightedMode=i.weightedMode,s}))||[],e}get duration(){return!this.keys||this.keys.length==0?0:this.keys[this.keys.length-1].time}evaluate(e){if(!this.keys||this.keys.length==0)return 0;if(this.keys[0].time>=e)return this.keys[0].value;for(let t=0;t<this.keys.length;t++){const i=this.keys[t];if(i.time<=e)if(t+1<this.keys.length){const r=this.keys[t+1];if(r.time<e)continue;return!isFinite(i.outTangent)||!isFinite(r.inTangent)?i.value:Tl.interpolateValue(e,i,r)}else return i.value}return this.keys[this.keys.length-1].value}static interpolateValue(e,t,i){const s=t.time,r=t.value,o=t.outTangent,a=i.time,c=i.value,l=i.inTangent,h=a-s,d=h*h,f=d*h,p=((o+l)*h-2*(c-r))/f,m=(3*(c-r)-(l+2*o)*h)/d,g=o,y=r,A=e-s,v=A*A,b=v*A;return p*b+m*v+g*A+y}}Zh([x(kl)],Tl.prototype,"keys",void 0);class nte extends Sn{constructor(e,t=1,i=16,s=2){const r=new gt,o=i+s*2,a=new Float32Array((o*3+3)*3);r.setAttribute("position",new it(a,3));const c=new Ln({color:65280}),l=new Ln({color:16776960});super(r,[l,c]),this.audio=e,this.range=t,this.divisionsInnerAngle=i,this.divisionsOuterAngle=s,this.type="PositionalAudioHelper",this.update()}update(){const e=this.audio,t=this.range,i=this.divisionsInnerAngle,s=this.divisionsOuterAngle,r=Vn.degToRad(e.panner.coneInnerAngle),o=Vn.degToRad(e.panner.coneOuterAngle),a=r/2,c=o/2;let l=0,h=0,d,f;const p=this.geometry,m=p.attributes.position;p.clearGroups();function g(y,A,v,b){const _=(A-y)/v;for(m.setXYZ(l,0,0,0),h++,d=y;d<A;d+=_)f=l+h,m.setXYZ(f,Math.sin(d)*t,0,Math.cos(d)*t),m.setXYZ(f+1,Math.sin(Math.min(d+_,A))*t,0,Math.cos(Math.min(d+_,A))*t),m.setXYZ(f+2,0,0,0),h+=3;p.addGroup(l,h,b),l+=h,h=0}g(-c,-a,s,0),g(-a,a,i,1),g(a,c,s,0),m.needsUpdate=!0,r===o&&(this.material[0].visible=!1)}dispose(){this.geometry.dispose(),this.material[0].dispose(),this.material[1].dispose()}}var xc=globalThis&&globalThis.__decorate||function(n,e,t,i){var s=arguments.length,r=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(e,t,r):o(e,t))||r);return s>3&&r&&Object.defineProperty(e,t,r),r};const Fs=re("debugaudio");var yg;(function(n){n[n.Logarithmic=0]="Logarithmic",n[n.Linear=1]="Linear",n[n.Custom=2]="Custom"})(yg||(yg={}));let zb=!1;const Gb=[];function Ix(){if(zb)return;Tt()&&console.log("User interaction registered: audio can now be played"),zb=!0;const n=[...Gb];Gb.length=0,n.forEach(e=>e())}document.addEventListener("pointerdown",Ix);document.addEventListener("click",Ix);document.addEventListener("dragstart",Ix);document.addEventListener("touchstart",Ix);class Ti extends Te{constructor(){super(...arguments);u(this,"clip","");u(this,"playOnAwake",!1);u(this,"preload",!1);u(this,"_spatialBlend",0);u(this,"_minDistance",1);u(this,"_maxDistance",100);u(this,"_volume",1);u(this,"rollOffMode",0);u(this,"playInBackground",!0);u(this,"_loop",!1);u(this,"sound",null);u(this,"helper",null);u(this,"wasPlaying",!1);u(this,"audioLoader",null);u(this,"shouldPlay",!1);u(this,"_lastClipStartedLoading",null);u(this,"_audioElement",null);u(this,"onVisibilityChanged",()=>{switch(document.visibilityState){case"hidden":(this.playInBackground===!1||Pl())&&(this.wasPlaying=this.isPlaying,this.isPlaying&&this.pause());break;case"visible":Fs&&console.log("visible",this.enabled,this.playOnAwake,!this.isPlaying,Ti.userInteractionRegistered,this.wasPlaying),this.enabled&&this.playOnAwake&&!this.isPlaying&&Ti.userInteractionRegistered&&this.wasPlaying&&this.play();break}});u(this,"onApplicationMuteChanged",()=>{var t,i;this.context.application.muted?(t=this.sound)==null||t.setVolume(0):(i=this.sound)==null||i.setVolume(this.volume)});u(this,"createAudio",t=>{Fs&&console.log("AudioBuffer finished loading",t);const i=this.Sound;if(!i){Fs&&console.warn("Failed getting sound?",this.name);return}i.isPlaying&&i.stop(),t&&i.setBuffer(t),i.loop=this._loop,this.context.application.muted?i.setVolume(0):i.setVolume(this.volume),i.autoplay=this.shouldPlay&&Ti.userInteractionRegistered,this.applySpatialDistanceSettings(),i.isPlaying&&i.stop(),Ti.registerWaitForAllowAudio(this.__onAllowAudioCallback)});u(this,"__onAllowAudioCallback",()=>{this.shouldPlay&&this.play()});u(this,"_lastContextTime",0);u(this,"_hasEnded",!0);u(this,"_needUpdateSpatialDistanceSettings",!1)}static get userInteractionRegistered(){return zb}static registerWaitForAllowAudio(t){if(t!==null){if(zb){t();return}Gb.indexOf(t)===-1&&Gb.push(t)}}get loop(){return this.sound&&(this._loop=this.sound.getLoop()),this._loop}set loop(t){this._loop=t,this.sound&&this.sound.setLoop(t)}get spatialBlend(){return this._spatialBlend}set spatialBlend(t){t!==this._spatialBlend&&(this._spatialBlend=t,this._needUpdateSpatialDistanceSettings=!0)}get minDistance(){return this._minDistance}set minDistance(t){this._minDistance!==t&&(this._minDistance=t,this._needUpdateSpatialDistanceSettings=!0)}get maxDistance(){return this._maxDistance}set maxDistance(t){this._maxDistance!==t&&(this._maxDistance=t,this._needUpdateSpatialDistanceSettings=!0)}get volume(){return this._volume}set volume(t){this._volume=t,this.sound&&!this.context.application.muted&&(Fs&&console.log(this.name,"audio set volume",t),this.sound.setVolume(t))}get Sound(){var t;if(!this.sound&&Ti.userInteractionRegistered){let i=le.getComponent(this.context.mainCamera,sd)??le.findObjectOfType(sd,this.context);!i&&this.context.mainCamera&&(i=le.addNewComponent(this.context.mainCamera,sd)),i!=null&&i.listener?(this.sound=new eF(i.listener),(t=this.gameObject)==null||t.add(this.sound)):Fs&&console.warn("No audio listener found in scene - can not play audio")}return this.sound}get ShouldPlay(){return this.shouldPlay}get audioContext(){var t;return(t=this.sound)==null?void 0:t.context}awake(){Fs&&console.log(this),this.audioLoader=new ub,this.playOnAwake&&(this.shouldPlay=!0),this.preload&&typeof this.clip=="string"&&this.audioLoader.load(this.clip,this.createAudio,()=>{},console.error)}onEnable(){this.sound&&this.gameObject.add(this.sound),Ti.userInteractionRegistered?this.playOnAwake&&this.context.application.isVisible&&this.play():Ti.registerWaitForAllowAudio(()=>{this.enabled&&!this.destroyed&&this.shouldPlay&&this.onNewClip(this.clip)}),globalThis.addEventListener("visibilitychange",this.onVisibilityChanged),this.context.application.addEventListener(Zu.MuteChanged,this.onApplicationMuteChanged)}onDisable(){globalThis.removeEventListener("visibilitychange",this.onVisibilityChanged),this.context.application.removeEventListener(Zu.MuteChanged,this.onApplicationMuteChanged),this.pause()}applySpatialDistanceSettings(){const t=this.sound;if(!t)return;this._needUpdateSpatialDistanceSettings=!1;const i=nt.lerp(10*this._maxDistance/Math.max(1e-4,this.spatialBlend),this._minDistance,this.spatialBlend);switch(Fs&&console.log(this.name,this._minDistance,this._maxDistance,this.spatialBlend,"Ref distance="+i),t.setRefDistance(i),t.setMaxDistance(Math.max(.01,this._maxDistance)),this.rollOffMode){case yg.Logarithmic:t.setDistanceModel("exponential");break;case yg.Linear:t.setDistanceModel("linear");break;case yg.Custom:break}this.spatialBlend>0?Fs&&!this.helper&&(this.helper=new nte(t,t.getRefDistance()),t.add(this.helper)):this.helper&&this.helper.parent&&this.helper.removeFromParent()}async onNewClip(t){if(t&&(this.clip=t),typeof t=="string")if(Fs&&console.log(t),t.endsWith(".mp3")||t.endsWith(".wav")){if(this.audioLoader||(this.audioLoader=new ub),this.shouldPlay=!0,this._lastClipStartedLoading===t){Fs&&console.log("Is currently loading:",this._lastClipStartedLoading,this);return}this._lastClipStartedLoading=t,Fs&&console.log("load audio",t);const i=await this.audioLoader.loadAsync(t).catch(console.error);this._lastClipStartedLoading=null,i&&this.createAudio(i)}else console.warn("Unsupported audio clip type",t);else this.shouldPlay=!0,this.createAudio()}play(t=void 0){var s,r,o;!t&&this.clip&&(t=this.clip),t!==void 0&&typeof t!="string"&&!(t instanceof MediaStream)&&(Tt()&&console.warn("Called play on AudioSource with unknown argument type:",t+`
Using the assigned clip instead:`,this.clip),t=this.clip);let i=!this.sound||t&&t!==this.clip;if(typeof t=="string"&&!this.audioLoader&&(i=!0),(t instanceof MediaStream||typeof t=="string")&&(this.clip=t),i){this.shouldPlay=!0,this.onNewClip(t);return}if(this.shouldPlay=!0,this._hasEnded=!1,Fs&&console.log("play",(s=this.sound)==null?void 0:s.getVolume(),this.sound),this.sound&&!this.sound.isPlaying){const a=this.context.application.muted;a&&this.sound.setVolume(0),(r=this.gameObject)==null||r.add(this.sound),this.clip instanceof MediaStream?(this.sound.setMediaStreamSource(this.clip),this._audioElement||(this._audioElement=document.createElement("audio"),this._audioElement.style.display="none"),this._audioElement.parentNode||(o=this.context.domElement.shadowRoot)==null||o.append(this._audioElement),this._audioElement.srcObject=this.clip,this._audioElement.autoplay=!1):(this._audioElement&&this._audioElement.remove(),this.sound.play(a?.1:0))}}pause(){var t,i;Fs&&console.log("Pause",this),this._hasEnded=!0,this.shouldPlay=!1,this.sound&&this.sound.isPlaying&&this.sound.source&&(this._lastContextTime=(t=this.sound)==null?void 0:t.context.currentTime,this.sound.pause()),(i=this._audioElement)==null||i.remove()}stop(){var t,i;Fs&&console.log("Pause",this),this._hasEnded=!0,this.shouldPlay=!1,this.sound&&this.sound.source&&(this._lastContextTime=(t=this.sound)==null?void 0:t.context.currentTime,Fs&&console.log(this._lastContextTime),this.sound.stop()),(i=this._audioElement)==null||i.remove()}get isPlaying(){var t;return((t=this.sound)==null?void 0:t.isPlaying)??!1}set isPlaying(t){}get time(){var t,i;return(t=this.sound)!=null&&t.source?((i=this.sound.source)==null?void 0:i.context.currentTime)-this._lastContextTime+this.sound.offset:0}set time(t){if(this.sound){if(t===this.sound.offset)return;const i=this.isPlaying;this.stop(),this.sound.offset=t,i&&this.play()}}update(){this.helper&&(this.isPlaying&&this.helper.update(),this.helper.visible=this.isPlaying),this._needUpdateSpatialDistanceSettings&&this.applySpatialDistanceSettings(),this.sound&&!this.sound.isPlaying&&this.shouldPlay&&!this._hasEnded&&(this._hasEnded=!0,Fs&&console.log("Audio clip ended",this.clip),this.dispatchEvent(new CustomEvent("ended",{detail:this})))}}xc([x(URL)],Ti.prototype,"clip",void 0);xc([x()],Ti.prototype,"playOnAwake",void 0);xc([x()],Ti.prototype,"preload",void 0);xc([x()],Ti.prototype,"loop",null);xc([x()],Ti.prototype,"spatialBlend",null);xc([x()],Ti.prototype,"minDistance",null);xc([x()],Ti.prototype,"maxDistance",null);xc([x()],Ti.prototype,"volume",null);xc([x()],Ti.prototype,"rollOffMode",void 0);xc([x()],Ti.prototype,"playInBackground",void 0);const EO={type:"change"},uC={type:"start"},TO={type:"end"},Xy=new ro,MO=new hr,ste=Math.cos(70*Vn.DEG2RAD);let rte=class extends ls{constructor(e,t){super(),this.object=e,this.domElement=t,this.domElement.style.touchAction="none",this.enabled=!0,this.target=new w,this.cursor=new w,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minTargetRadius=0,this.maxTargetRadius=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.zoomToCursor=!1,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:Eu.ROTATE,MIDDLE:Eu.DOLLY,RIGHT:Eu.PAN},this.touches={ONE:Tu.ROTATE,TWO:Tu.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this.getPolarAngle=function(){return a.phi},this.getAzimuthalAngle=function(){return a.theta},this.getDistance=function(){return this.object.position.distanceTo(this.target)},this.listenToKeyEvents=function(j){j.addEventListener("keydown",At),this._domElementKeyEvents=j},this.stopListenToKeyEvents=function(){this._domElementKeyEvents.removeEventListener("keydown",At),this._domElementKeyEvents=null},this.saveState=function(){i.target0.copy(i.target),i.position0.copy(i.object.position),i.zoom0=i.object.zoom},this.reset=function(){i.target.copy(i.target0),i.object.position.copy(i.position0),i.object.zoom=i.zoom0,i.object.updateProjectionMatrix(),i.dispatchEvent(EO),i.update(),r=s.NONE},this.update=function(){const j=new w,Ne=new Me().setFromUnitVectors(e.up,new w(0,1,0)),ne=Ne.clone().invert(),q=new w,He=new Me,Ye=new w,at=2*Math.PI;return function(Ei=null){const vi=i.object.getWorldPosition(e.position);j.copy(vi).sub(i.target),j.applyQuaternion(Ne),a.setFromVector3(j),i.autoRotate&&r===s.NONE&&Q(D(Ei)),i.enableDamping?(a.theta+=c.theta*i.dampingFactor,a.phi+=c.phi*i.dampingFactor):(a.theta+=c.theta,a.phi+=c.phi);let fi=i.minAzimuthAngle,Li=i.maxAzimuthAngle;isFinite(fi)&&isFinite(Li)&&(fi<-Math.PI?fi+=at:fi>Math.PI&&(fi-=at),Li<-Math.PI?Li+=at:Li>Math.PI&&(Li-=at),fi<=Li?a.theta=Math.max(fi,Math.min(Li,a.theta)):a.theta=a.theta>(fi+Li)/2?Math.max(fi,a.theta):Math.min(Li,a.theta)),a.phi=Math.max(i.minPolarAngle,Math.min(i.maxPolarAngle,a.phi)),a.makeSafe(),i.enableDamping===!0?i.target.addScaledVector(d,i.dampingFactor):i.target.add(d),i.target.sub(i.cursor),i.target.clampLength(i.minTargetRadius,i.maxTargetRadius),i.target.add(i.cursor),i.zoomToCursor&&M||i.object.isOrthographicCamera?a.radius=se(a.radius):(i.enableDamping?h=Vn.lerp(h,l,i.dampingFactor):h=l,a.radius=se(a.radius*h)),j.setFromSpherical(a),j.applyQuaternion(ne),vi.copy(i.target).add(j),i.object.parent?i.object.parent.worldToLocal(vi):i.object.position.copy(vi),i.object.lookAt(i.target),i.enableDamping===!0?(c.theta*=1-i.dampingFactor,c.phi*=1-i.dampingFactor,d.multiplyScalar(1-i.dampingFactor)):(c.set(0,0,0),d.set(0,0,0));let ui=!1;if(i.zoomToCursor&&M){let vn=null;if(i.object.isPerspectiveCamera){const en=j.length();vn=se(en*l);const fo=en-vn;i.object.position.addScaledVector(T,fo),i.object.updateMatrixWorld()}else if(i.object.isOrthographicCamera){const en=new w(E.x,E.y,0);en.unproject(i.object),i.object.zoom=Math.max(i.minZoom,Math.min(i.maxZoom,i.object.zoom/l)),i.object.updateProjectionMatrix(),ui=!0;const fo=new w(E.x,E.y,0);fo.unproject(i.object),i.object.position.sub(fo).add(en),i.object.updateMatrixWorld(),vn=j.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),i.zoomToCursor=!1;vn!==null&&(this.screenSpacePanning?i.target.set(0,0,-1).transformDirection(i.object.matrix).multiplyScalar(vn).add(i.object.position):(Xy.origin.copy(i.object.position),Xy.direction.set(0,0,-1).transformDirection(i.object.matrix),Math.abs(i.object.up.dot(Xy.direction))<ste?e.lookAt(i.target):(MO.setFromNormalAndCoplanarPoint(i.object.up,i.target),Xy.intersectPlane(MO,i.target))))}else i.object.isOrthographicCamera&&(ui=l!==1,ui&&(i.object.zoom=Math.max(i.minZoom,Math.min(i.maxZoom,i.object.zoom/l)),i.object.updateProjectionMatrix()));return l=1,M=!1,ui||q.distanceToSquared(i.object.position)>o||8*(1-He.dot(i.object.quaternion))>o||Ye.distanceToSquared(i.target)>0?(i.dispatchEvent(EO),q.copy(i.object.position),He.copy(i.object.quaternion),Ye.copy(i.target),!0):!1}}(),this.dispose=function(){i.domElement.removeEventListener("contextmenu",dt),i.domElement.removeEventListener("pointerdown",B),i.domElement.removeEventListener("pointercancel",Se),i.domElement.removeEventListener("wheel",et),i.domElement.removeEventListener("pointermove",ce),window.removeEventListener("pointerup",Se),i._domElementKeyEvents!==null&&(i._domElementKeyEvents.removeEventListener("keydown",At),i._domElementKeyEvents=null)};const i=this,s={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let r=s.NONE;const o=1e-6,a=new _E,c=new _E;let l=1,h=1;const d=new w,f=new ie,p=new ie,m=new ie,g=new ie,y=new ie,A=new ie,v=new ie,b=new ie,_=new ie,T=new w,E=new ie;let M=!1;const I=[],S={};let C=!1;function D(j){return j!==null?2*Math.PI/60*i.autoRotateSpeed*j:2*Math.PI/60/60*i.autoRotateSpeed}function G(j){const Ne=Math.abs(j*.01);return Math.pow(.95,i.zoomSpeed*Ne)}function Q(j){c.theta-=j}function L(j){c.phi-=j}const V=function(){const j=new w;return function(ne,q){j.setFromMatrixColumn(q,0),j.multiplyScalar(-ne),d.add(j)}}(),O=function(){const j=new w;return function(ne,q){i.screenSpacePanning===!0?j.setFromMatrixColumn(q,1):(j.setFromMatrixColumn(q,0),j.crossVectors(i.object.up,j)),j.multiplyScalar(ne),d.add(j)}}(),U=function(){const j=new w,Ne=new w;return function(q,He){const Ye=i.domElement;if(i.object.isPerspectiveCamera){i.object.getWorldPosition(Ne),j.copy(Ne).sub(i.target);let at=j.length();at*=Math.tan(i.object.fov/2*Math.PI/180),V(2*q*at/Ye.clientHeight,i.object.matrixWorld),O(2*He*at/Ye.clientHeight,i.object.matrixWorld)}else i.object.isOrthographicCamera?(V(q*(i.object.right-i.object.left)/i.object.zoom/Ye.clientWidth,i.object.matrixWorld),O(He*(i.object.top-i.object.bottom)/i.object.zoom/Ye.clientHeight,i.object.matrixWorld)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),i.enablePan=!1)}}();function H(j){i.object.isPerspectiveCamera||i.object.isOrthographicCamera?l/=j:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),i.enableZoom=!1)}function Y(j){i.object.isPerspectiveCamera||i.object.isOrthographicCamera?l*=j:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),i.enableZoom=!1)}function J(j,Ne){if(!i.zoomToCursor)return;M=!0;const ne=i.domElement.getBoundingClientRect(),q=j-ne.left,He=Ne-ne.top,Ye=ne.width,at=ne.height;E.x=q/Ye*2-1,E.y=-(He/at)*2+1,T.set(E.x,E.y,1).unproject(i.object).sub(i.object.position).normalize()}function se(j){return Math.max(i.minDistance,Math.min(i.maxDistance,j))}function fe(j){f.set(j.clientX,j.clientY)}function _e(j){J(j.clientX,j.clientX),v.set(j.clientX,j.clientY)}function Oe(j){g.set(j.clientX,j.clientY)}function qe(j){p.set(j.clientX,j.clientY),m.subVectors(p,f).multiplyScalar(i.rotateSpeed);const Ne=i.domElement;Q(2*Math.PI*m.x/Ne.clientHeight),L(2*Math.PI*m.y/Ne.clientHeight),f.copy(p),i.update()}function ae(j){b.set(j.clientX,j.clientY),_.subVectors(b,v),_.y>0?H(G(_.y)):_.y<0&&Y(G(_.y)),v.copy(b),i.update()}function ve(j){y.set(j.clientX,j.clientY),A.subVectors(y,g).multiplyScalar(i.panSpeed),U(A.x,A.y),g.copy(y),i.update()}function Ue(j){J(j.clientX,j.clientY),j.deltaY<0?Y(G(j.deltaY)):j.deltaY>0&&H(G(j.deltaY)),i.update()}function Ge(j){let Ne=!1;switch(j.code){case i.keys.UP:j.ctrlKey||j.metaKey||j.shiftKey?L(2*Math.PI*i.rotateSpeed/i.domElement.clientHeight):U(0,i.keyPanSpeed),Ne=!0;break;case i.keys.BOTTOM:j.ctrlKey||j.metaKey||j.shiftKey?L(-2*Math.PI*i.rotateSpeed/i.domElement.clientHeight):U(0,-i.keyPanSpeed),Ne=!0;break;case i.keys.LEFT:j.ctrlKey||j.metaKey||j.shiftKey?Q(2*Math.PI*i.rotateSpeed/i.domElement.clientHeight):U(i.keyPanSpeed,0),Ne=!0;break;case i.keys.RIGHT:j.ctrlKey||j.metaKey||j.shiftKey?Q(-2*Math.PI*i.rotateSpeed/i.domElement.clientHeight):U(-i.keyPanSpeed,0),Ne=!0;break}Ne&&(j.preventDefault(),i.update())}function Xe(j){if(I.length===1)f.set(j.pageX,j.pageY);else{const Ne=pt(j),ne=.5*(j.pageX+Ne.x),q=.5*(j.pageY+Ne.y);f.set(ne,q)}}function ze(j){if(I.length===1)g.set(j.pageX,j.pageY);else{const Ne=pt(j),ne=.5*(j.pageX+Ne.x),q=.5*(j.pageY+Ne.y);g.set(ne,q)}}function Pe(j){const Ne=pt(j),ne=j.pageX-Ne.x,q=j.pageY-Ne.y,He=Math.sqrt(ne*ne+q*q);v.set(0,He)}function X(j){i.enableZoom&&Pe(j),i.enablePan&&ze(j)}function Ae(j){i.enableZoom&&Pe(j),i.enableRotate&&Xe(j)}function ke(j){if(I.length==1)p.set(j.pageX,j.pageY);else{const ne=pt(j),q=.5*(j.pageX+ne.x),He=.5*(j.pageY+ne.y);p.set(q,He)}m.subVectors(p,f).multiplyScalar(i.rotateSpeed);const Ne=i.domElement;Q(2*Math.PI*m.x/Ne.clientHeight),L(2*Math.PI*m.y/Ne.clientHeight),f.copy(p)}function be(j){if(I.length===1)y.set(j.pageX,j.pageY);else{const Ne=pt(j),ne=.5*(j.pageX+Ne.x),q=.5*(j.pageY+Ne.y);y.set(ne,q)}A.subVectors(y,g).multiplyScalar(i.panSpeed),U(A.x,A.y),g.copy(y)}function je(j){const Ne=pt(j),ne=j.pageX-Ne.x,q=j.pageY-Ne.y,He=Math.sqrt(ne*ne+q*q);b.set(0,He),_.set(0,Math.pow(b.y/v.y,i.zoomSpeed)),H(_.y),v.copy(b);const Ye=(j.pageX+Ne.x)*.5,at=(j.pageY+Ne.y)*.5;J(Ye,at)}function ct(j){i.enableZoom&&je(j),i.enablePan&&be(j)}function F(j){i.enableZoom&&je(j),i.enableRotate&&ke(j)}function B(j){i.enabled!==!1&&(I.length===0&&(i.domElement.addEventListener("pointermove",ce),window.addEventListener("pointerup",Se)),ft(j),j.pointerType==="touch"?Ee(j):xe(j))}function ce(j){i.enabled!==!1&&(j.pointerType==="touch"?Rt(j):Ie(j))}function Se(j){switch(Ze(j),I.length){case 0:i.domElement.removeEventListener("pointermove",ce),i.domElement.removeEventListener("pointerup",Se),i.dispatchEvent(TO),r=s.NONE;break;case 1:const Ne=I[0],ne=S[Ne];Ee({pointerId:Ne,pageX:ne.x,pageY:ne.y});break}}function xe(j){let Ne;switch(j.button){case 0:Ne=i.mouseButtons.LEFT;break;case 1:Ne=i.mouseButtons.MIDDLE;break;case 2:Ne=i.mouseButtons.RIGHT;break;default:Ne=-1}switch(Ne){case Eu.DOLLY:if(i.enableZoom===!1)return;_e(j),r=s.DOLLY;break;case Eu.ROTATE:if(j.ctrlKey||j.metaKey||j.shiftKey){if(i.enablePan===!1)return;Oe(j),r=s.PAN}else{if(i.enableRotate===!1)return;fe(j),r=s.ROTATE}break;case Eu.PAN:if(j.ctrlKey||j.metaKey||j.shiftKey){if(i.enableRotate===!1)return;fe(j),r=s.ROTATE}else{if(i.enablePan===!1)return;Oe(j),r=s.PAN}break;default:r=s.NONE}r!==s.NONE&&i.dispatchEvent(uC)}function Ie(j){switch(r){case s.ROTATE:if(i.enableRotate===!1)return;qe(j);break;case s.DOLLY:if(i.enableZoom===!1)return;ae(j);break;case s.PAN:if(i.enablePan===!1)return;ve(j);break}}function et(j){i.enabled===!1||i.enableZoom===!1||r!==s.NONE||(j.preventDefault(),i.dispatchEvent(uC),Ue(Fe(j)),i.dispatchEvent(TO))}function Fe(j){const Ne=j.deltaMode,ne={clientX:j.clientX,clientY:j.clientY,deltaY:j.deltaY};switch(Ne){case 1:ne.deltaY*=16;break;case 2:ne.deltaY*=100;break}return j.ctrlKey&&!C&&(ne.deltaY*=10),ne}function Ke(j){j.key==="Control"&&(C=!0,i.domElement.getRootNode().addEventListener("keyup",rt,{passive:!0,capture:!0}))}function rt(j){j.key==="Control"&&(C=!1,i.domElement.getRootNode().removeEventListener("keyup",rt,{passive:!0,capture:!0}))}function At(j){i.enabled===!1||i.enablePan===!1||Ge(j)}function Ee(j){switch(Ve(j),I.length){case 1:switch(i.touches.ONE){case Tu.ROTATE:if(i.enableRotate===!1)return;Xe(j),r=s.TOUCH_ROTATE;break;case Tu.PAN:if(i.enablePan===!1)return;ze(j),r=s.TOUCH_PAN;break;default:r=s.NONE}break;case 2:switch(i.touches.TWO){case Tu.DOLLY_PAN:if(i.enableZoom===!1&&i.enablePan===!1)return;X(j),r=s.TOUCH_DOLLY_PAN;break;case Tu.DOLLY_ROTATE:if(i.enableZoom===!1&&i.enableRotate===!1)return;Ae(j),r=s.TOUCH_DOLLY_ROTATE;break;default:r=s.NONE}break;default:r=s.NONE}r!==s.NONE&&i.dispatchEvent(uC)}function Rt(j){switch(Ve(j),r){case s.TOUCH_ROTATE:if(i.enableRotate===!1)return;ke(j),i.update();break;case s.TOUCH_PAN:if(i.enablePan===!1)return;be(j),i.update();break;case s.TOUCH_DOLLY_PAN:if(i.enableZoom===!1&&i.enablePan===!1)return;ct(j),i.update();break;case s.TOUCH_DOLLY_ROTATE:if(i.enableZoom===!1&&i.enableRotate===!1)return;F(j),i.update();break;default:r=s.NONE}}function dt(j){i.enabled!==!1&&j.preventDefault()}function ft(j){I.push(j.pointerId)}function Ze(j){delete S[j.pointerId];for(let Ne=0;Ne<I.length;Ne++)if(I[Ne]==j.pointerId){I.splice(Ne,1);return}}function Ve(j){let Ne=S[j.pointerId];Ne===void 0&&(Ne=new ie,S[j.pointerId]=Ne),Ne.set(j.pageX,j.pageY)}function pt(j){const Ne=j.pointerId===I[0]?I[1]:I[0];return S[Ne]}i.domElement.addEventListener("contextmenu",dt),i.domElement.addEventListener("pointerdown",B),i.domElement.addEventListener("pointercancel",Se),i.domElement.addEventListener("wheel",et,{passive:!1}),i.domElement.getRootNode().addEventListener("keydown",Ke,{passive:!0,capture:!0}),this.update()}};class Sz extends me{constructor(e,t,i,s=128){if(t<=0||i<=0||s<=0)throw new Error("GroundedSkybox height, radius, and resolution must be positive.");const r=new Aa(i,2*s,s);r.scale(1,1,-1);const o=r.getAttribute("position"),a=new w;for(let c=0;c<o.count;++c)if(a.fromBufferAttribute(o,c),a.y<0){const l=-t*3/2,h=a.y<l?-t/a.y:1-a.y*a.y/(3*l*l);a.multiplyScalar(h),a.toArray(o.array,3*c)}o.needsUpdate=!0,super(r,new ri({map:e,depthWrite:!1}))}}const j0=Symbol("cameraController");function ote(n){return n[j0]}function IO(n,e,t){t?n[j0]=e:n[j0]===e&&(n[j0]=null)}const RO=Symbol("camera autofit");function ate(n){return n[RO]===void 0?!0:n[RO]!==!1}var cte=globalThis&&globalThis.__decorate||function(n,e,t,i){var s=arguments.length,r=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(e,t,r):o(e,t))||r);return s>3&&r&&Object.defineProperty(e,t,r),r};class Rx extends Te{constructor(){super(...arguments);u(this,"constraintActive",!0);u(this,"locked",!1);u(this,"sources",[])}}cte([x(ge)],Rx.prototype,"sources",void 0);function lte(n){eU(n,jt.Update)}class nd{constructor(){u(this,"bb",null);u(this,"bb_pos",0)}__init(e,t){return this.bb_pos=e,this.bb=t,this}x(){return this.bb.readFloat32(this.bb_pos)}y(){return this.bb.readFloat32(this.bb_pos+4)}z(){return this.bb.readFloat32(this.bb_pos+8)}static sizeOf(){return 12}static createVec3(e,t,i,s){return e.prep(4,12),e.writeFloat32(s),e.writeFloat32(i),e.writeFloat32(t),e.offset()}}class Cz{constructor(){u(this,"bb",null);u(this,"bb_pos",0)}__init(e,t){return this.bb_pos=e,this.bb=t,this}position(e){return(e||new nd).__init(this.bb_pos,this.bb)}rotation(e){return(e||new nd).__init(this.bb_pos+12,this.bb)}scale(e){return(e||new nd).__init(this.bb_pos+24,this.bb)}static sizeOf(){return 36}static createTransform(e,t,i,s,r,o,a,c,l,h){return e.prep(4,36),e.prep(4,12),e.writeFloat32(h),e.writeFloat32(l),e.writeFloat32(c),e.prep(4,12),e.writeFloat32(a),e.writeFloat32(o),e.writeFloat32(r),e.prep(4,12),e.writeFloat32(s),e.writeFloat32(i),e.writeFloat32(t),e.offset()}}class il{constructor(){u(this,"bb",null);u(this,"bb_pos",0)}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsSyncedTransformModel(e,t){return(t||new il).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsSyncedTransformModel(e,t){return e.setPosition(e.position()+g1),(t||new il).__init(e.readInt32(e.position())+e.position(),e)}guid(e){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.__string(this.bb_pos+t,e):null}fast(){const e=this.bb.__offset(this.bb_pos,6);return e?!!this.bb.readInt8(this.bb_pos+e):!1}transform(e){const t=this.bb.__offset(this.bb_pos,8);return t?(e||new Cz).__init(this.bb_pos+t,this.bb):null}dontSave(){const e=this.bb.__offset(this.bb_pos,10);return e?!!this.bb.readInt8(this.bb_pos+e):!1}static startSyncedTransformModel(e){e.startObject(4)}static addGuid(e,t){e.addFieldOffset(0,t,0)}static addFast(e,t){e.addFieldInt8(1,+t,0)}static addTransform(e,t){e.addFieldStruct(2,t,0)}static addDontSave(e,t){e.addFieldInt8(3,+t,0)}static endSyncedTransformModel(e){return e.endObject()}static finishSyncedTransformModelBuffer(e,t){e.finish(t)}static finishSizePrefixedSyncedTransformModelBuffer(e,t){e.finish(t,void 0,!0)}}var PO;(function(n){n[n.Average=0]="Average",n[n.Multiply=1]="Multiply",n[n.Minimum=2]="Minimum",n[n.Maximum=3]="Maximum"})(PO||(PO={}));var CT;(function(n){n[n.Discrete=0]="Discrete",n[n.Continuous=1]="Continuous"})(CT||(CT={}));var _n;(function(n){n[n.None=0]="None",n[n.FreezePositionX=2]="FreezePositionX",n[n.FreezePositionY=4]="FreezePositionY",n[n.FreezePositionZ=8]="FreezePositionZ",n[n.FreezePosition=14]="FreezePosition",n[n.FreezeRotationX=16]="FreezeRotationX",n[n.FreezeRotationY=32]="FreezeRotationY",n[n.FreezeRotationZ=64]="FreezeRotationZ",n[n.FreezeRotation=112]="FreezeRotation",n[n.FreezeAll=126]="FreezeAll"})(_n||(_n={}));var Lf;(function(n){n[n.None=0]="None",n[n.X=2]="X",n[n.Y=4]="Y",n[n.Z=8]="Z",n[n.All=-1]="All"})(Lf||(Lf={}));const Ks=function(n,e){return function(t,i,s){hte(t,i,s,n,e)}};function hte(n,e,t,i,s){if(!s&&!i&&!n.onValidate)return;if(t!==void 0){console.error("Invalid usage of validate decorator. Only fields can be validated.",n,e,t),Tn("Invalid usage of validate decorator. Only fields can be validated. Property: "+e,rs.Error);return}let r="";if(typeof e=="string"?r=e:r=e.name,n.__internalAwake){const o=Symbol(r),a=n.__internalAwake;n.__internalAwake=function(){var c;if(!this.onValidate){Tt()&&console.warn('Usage of @validate decorate detected but there is no onValidate method in your class: "'+((c=n.constructor)==null?void 0:c.name)+'"');return}if(this[o]===void 0){this[o]=this[r];const l=this[r];if(l instanceof ie||l instanceof w||l instanceof tt||l instanceof Me){const h=this[r];t1(h,()=>{this.onValidate(r)})}Object.defineProperty(this,r,{set:function(h){var d;if(this[FE]===!0)this[o]=h;else{i==null||i.call(this,h);const f=this[o];this[o]=h,(d=this.onValidate)==null||d.call(this,r,f)}},get:function(){return s==null||s.call(this),this[o]}})}a.call(this)}}}var Ho=globalThis&&globalThis.__decorate||function(n,e,t,i){var s=arguments.length,r=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(e,t,r):o(e,t))||r);return s>3&&r&&Object.defineProperty(e,t,r),r};class ute{constructor(e,t){u(this,"positionChanged",!1);u(this,"rotationChanged",!1);u(this,"position");u(this,"quaternion");u(this,"_positionKeys",["x","y","z"]);u(this,"_quaternionKeys",["_x","_y","_z","_w"]);u(this,"mute",!1);u(this,"context");u(this,"obj");u(this,"_positionWatch");u(this,"_rotationWatch");this.context=t,this.obj=e}get isDirty(){return this.positionChanged||this.rotationChanged}reset(e=!1){if(this.positionChanged=!1,this.rotationChanged=!1,this.mute=!1,e){if(this.position)for(const t of this._positionKeys)delete this.position[t];if(this.quaternion)for(const t of this._quaternionKeys)delete this.quaternion[t]}}syncValues(){for(const e of this._positionKeys)this.position[e]=this.obj.position[e];for(const e of this._quaternionKeys)this.quaternion[e]=this.obj.quaternion[e]}applyValues(){if(this.positionChanged&&this.position)for(const e of this._positionKeys){const t=this.position[e];t!==void 0&&(this.obj.position[e]=t)}if(this.rotationChanged&&this.quaternion)for(const e of this._quaternionKeys){const t=this.quaternion[e];t!==void 0&&(this.obj.quaternion[e]=t)}}start(e,t){this.reset(),e&&(this._positionWatch||(this._positionWatch=new Rh(this.obj.position,["x","y","z"])),this._positionWatch.apply(),this.position={},this._positionWatch.subscribeWrite((r,o)=>{var c;if((c=this.context.physics.engine)!=null&&c.isUpdating||this.mute)return;const a=this.position[o];Math.abs(a-r)<1e-5||(this.position[o]=r,this.positionChanged=!0)})),t&&(this._rotationWatch||(this._rotationWatch=new Rh(this.obj.quaternion,["_x","_y","_z","_w"])),this._rotationWatch.apply(),this.quaternion={},this._rotationWatch.subscribeWrite((r,o)=>{var c;if((c=this.context.physics.engine)!=null&&c.isUpdating||this.mute)return;const a=this.quaternion[o];Math.abs(a-r)<1e-5||(this.quaternion[o]=r,this.rotationChanged=!0)}));const i=this.obj.matrixWorld.multiplyMatrices.bind(this.obj.matrixWorld),s=new Ce;this.obj.matrixWorld.multiplyMatrices=(r,o)=>{var a;return(a=this.context.physics.engine)!=null&&a.isUpdating||this.mute||s.equals(r)||(this.positionChanged=!0,this.rotationChanged=!0,s.copy(r)),i(r,o)}}stop(){var e,t;(e=this._positionWatch)==null||e.revoke(),(t=this._rotationWatch)==null||t.revoke()}}const f_=class extends Te{constructor(){super(...arguments);u(this,"autoMass",!0);u(this,"_mass",0);u(this,"useGravity",!0);u(this,"constraints",_n.None);u(this,"isKinematic",!1);u(this,"drag",0);u(this,"angularDrag",1);u(this,"detectCollisions",!0);u(this,"sleepThreshold",.01);u(this,"collisionDetectionMode",CT.Discrete);u(this,"_gravityScale",1);u(this,"dominanceGroup",0);u(this,"_propertiesChanged",!1);u(this,"_currentVelocity",new w);u(this,"_smoothedVelocity",new w);u(this,"_smoothedVelocityGetter",new w);u(this,"_lastPosition",new w);u(this,"_watch")}set mass(t){t!==this._mass&&(this._mass=t,this._propertiesChanged=!0,this.__didAwake&&(this.autoMass=!1))}get mass(){var t,i;return this.autoMass?((i=(t=this.context.physics.engine)==null?void 0:t.getBody(this))==null?void 0:i.mass())??-1:this._mass}get lockPositionX(){return(this.constraints&_n.FreezePositionX)!==0}get lockPositionY(){return(this.constraints&_n.FreezePositionY)!==0}get lockPositionZ(){return(this.constraints&_n.FreezePositionZ)!==0}get lockRotationX(){return(this.constraints&_n.FreezeRotationX)!==0}get lockRotationY(){return(this.constraints&_n.FreezeRotationY)!==0}get lockRotationZ(){return(this.constraints&_n.FreezeRotationZ)!==0}set lockPositionX(t){t?this.constraints|=_n.FreezePositionX:this.constraints&=~_n.FreezePositionX}set lockPositionY(t){t?this.constraints|=_n.FreezePositionY:this.constraints&=~_n.FreezePositionY}set lockPositionZ(t){t?this.constraints|=_n.FreezePositionZ:this.constraints&=~_n.FreezePositionZ}set lockRotationX(t){t?this.constraints|=_n.FreezeRotationX:this.constraints&=~_n.FreezeRotationX}set lockRotationY(t){t?this.constraints|=_n.FreezeRotationY:this.constraints&=~_n.FreezeRotationY}set lockRotationZ(t){t?this.constraints|=_n.FreezeRotationZ:this.constraints&=~_n.FreezeRotationZ}set gravityScale(t){this._gravityScale=t}get gravityScale(){return this._gravityScale}awake(){this._watch=void 0,this._propertiesChanged=!1}onEnable(){this._watch||(this._watch=new ute(this.gameObject,this.context)),this._watch.start(!0,!0),this.startCoroutine(this.beforePhysics(),jt.LateUpdate)}onDisable(){var t,i;(t=this._watch)==null||t.stop(),(i=this.context.physics.engine)==null||i.removeBody(this)}onDestroy(){var t;(t=this.context.physics.engine)==null||t.removeBody(this)}onValidate(){this._propertiesChanged=!0}*beforePhysics(){var t,i,s,r;for(;;)this._propertiesChanged&&(this._propertiesChanged=!1,(t=this.context.physics.engine)==null||t.updateProperties(this)),(i=this._watch)!=null&&i.isDirty?(this._watch.mute=!0,this._watch.applyValues(),(s=this.context.physics.engine)==null||s.updateBody(this,this._watch.positionChanged,this._watch.rotationChanged),this._watch.reset()):(r=this._watch)==null||r.syncValues(),this.captureVelocity(),yield}teleport(t,i=!0){var s;(s=this._watch)==null||s.reset(!0),i?this.gameObject.position.set(t.x,t.y,t.z):this.setWorldPosition(t.x,t.y,t.z),this.resetForcesAndTorques(),this.resetVelocities()}resetForces(t=!0){var i;(i=this.context.physics.engine)==null||i.resetForces(this,t)}resetTorques(t=!0){var i;(i=this.context.physics.engine)==null||i.resetTorques(this,t)}resetVelocities(){this.setVelocity(0,0,0),this.setAngularVelocity(0,0,0)}resetForcesAndTorques(){this.resetForces(),this.resetTorques()}wakeUp(){var t;(t=this.context.physics.engine)==null||t.wakeup(this)}get isSleeping(){var t;return(t=this.context.physics.engine)==null?void 0:t.isSleeping(this)}updateProperties(){var t;return this._propertiesChanged=!1,(t=this.context.physics.engine)==null?void 0:t.updateProperties(this)}applyForce(t,i,s=!0){var r;this._propertiesChanged&&this.updateProperties(),(r=this.context.physics.engine)==null||r.addForce(this,t,s)}applyImpulse(t,i=!0){var s;this._propertiesChanged&&this.updateProperties(),(s=this.context.physics.engine)==null||s.applyImpulse(this,t,i)}setForce(t,i,s,r=!0){var o,a,c;(o=this.context.physics.engine)==null||o.resetForces(this,r),typeof t=="number"?(i??(i=0),s??(s=0),(a=this.context.physics.engine)==null||a.addForce(this,{x:t,y:i,z:s},r)):(c=this.context.physics.engine)==null||c.addForce(this,t,r)}getVelocity(){var i;const t=(i=this.context.physics.engine)==null?void 0:i.getLinearVelocity(this);return t?(this._currentVelocity.x=t.x,this._currentVelocity.y=t.y,this._currentVelocity.z=t.z,this._currentVelocity):this._currentVelocity.set(0,0,0)}setVelocity(t,i,s,r=!0){var o,a;if(t instanceof w){const c=t;(o=this.context.physics.engine)==null||o.setLinearVelocity(this,c,r);return}i===void 0||s===void 0||(a=this.context.physics.engine)==null||a.setLinearVelocity(this,{x:t,y:i,z:s},r)}getAngularVelocity(){var i;const t=(i=this.context.physics.engine)==null?void 0:i.getAngularVelocity(this);return t?(this._currentVelocity.x=t.x,this._currentVelocity.y=t.y,this._currentVelocity.z=t.z,this._currentVelocity):this._currentVelocity.set(0,0,0)}setAngularVelocity(t,i,s,r=!0){var o,a;if(t instanceof w){const c=t;(o=this.context.physics.engine)==null||o.setAngularVelocity(this,c,r);return}i===void 0||s===void 0||(a=this.context.physics.engine)==null||a.setAngularVelocity(this,{x:t,y:i,z:s},r)}setTorque(t,i,s){this.setAngularVelocity(t,i,s)}get smoothedVelocity(){return this._smoothedVelocityGetter.copy(this._smoothedVelocity),this._smoothedVelocityGetter.multiplyScalar(1/this.context.time.deltaTime)}setBodyFromGameObject(t=null){}captureVelocity(){const t=Ht(this.gameObject);f_.tempPosition.copy(t);const i=t.sub(this._lastPosition);this._lastPosition.copy(f_.tempPosition),this._smoothedVelocity.lerp(i,this.context.time.deltaTime/.1)}};let ki=f_;u(ki,"tempPosition",new w);Ho([Ks()],ki.prototype,"autoMass",void 0);Ho([x()],ki.prototype,"mass",null);Ho([Ks(),x()],ki.prototype,"useGravity",void 0);Ho([Ks(),x()],ki.prototype,"constraints",void 0);Ho([Ks(),x()],ki.prototype,"isKinematic",void 0);Ho([Ks(),x()],ki.prototype,"drag",void 0);Ho([Ks(),x()],ki.prototype,"angularDrag",void 0);Ho([Ks(),x()],ki.prototype,"detectCollisions",void 0);Ho([Ks(),x()],ki.prototype,"sleepThreshold",void 0);Ho([Ks(),x()],ki.prototype,"collisionDetectionMode",void 0);Ho([Ks()],ki.prototype,"_gravityScale",void 0);Ho([Ks()],ki.prototype,"dominanceGroup",void 0);const Vc=re("debugsync"),EA="STRS";cU(EA,il.getRootAsSyncedTransformModel);const Ma=new WA;function Ez(n,e,t=!0){Ma.clear();const i=Ma.createString(n);il.startSyncedTransformModel(Ma),il.addGuid(Ma,i),il.addFast(Ma,t);const s=e.worldPosition,r=e.worldEuler,o=e.gameObject.scale;il.addTransform(Ma,Cz.createTransform(Ma,s.x,s.y,s.z,r.x,r.y,r.z,o.x,o.y,o.z));const a=il.endSyncedTransformModel(Ma);return Ma.finish(a,EA),Ma.asUint8Array()}let ET=0,bg=0;lte(n=>{var i;const t=((i=n.connection.currentServerUrl)==null?void 0:i.includes("glitch"))?10:40;bg=Math.floor(ET/t),ET=0,Vc&&bg>0&&console.log("Sync Transform Fast Interval",bg)});class Ad extends Te{constructor(){super(...arguments);u(this,"overridePhysics",!0);u(this,"interpolatePosition",!0);u(this,"interpolateRotation",!0);u(this,"fastMode",!1);u(this,"syncDestroy",!1);u(this,"_model",null);u(this,"_needsUpdate",!0);u(this,"rb",null);u(this,"_wasKinematic",!1);u(this,"_receivedDataBefore",!1);u(this,"_targetPosition");u(this,"_targetRotation");u(this,"_receivedFastUpdate",!1);u(this,"_shouldRequestOwnership",!1);u(this,"joinedRoomCallback",null);u(this,"receivedDataCallback",null);u(this,"tempEuler",new ws);u(this,"receivedUpdate",!1);u(this,"lastWorldPos");u(this,"lastWorldRotation")}requestOwnership(){Vc&&console.log("Request ownership"),this._model?this._model.requestOwnership():(this._shouldRequestOwnership=!0,this._needsUpdate=!0)}hasOwnership(){var t;return((t=this._model)==null?void 0:t.hasOwnership)??void 0}isOwned(){var t;return(t=this._model)==null?void 0:t.isOwned}awake(){Vc&&console.log("new instance",this.guid,this),this._receivedDataBefore=!1,this._targetPosition=new w,this._targetRotation=new Me,this.lastWorldPos=new w,this.lastWorldRotation=new Me,this.rb=le.getComponentInChildren(this.gameObject,ki),this.rb&&(this._wasKinematic=this.rb.isKinematic),this.receivedUpdate=!0,this._model=new ZU(this.context.connection,this.guid),this.context.connection.isConnected&&this.tryGetLastState(),this.joinedRoomCallback=this.tryGetLastState.bind(this),this.context.connection.beginListen(Xt.JoinedRoom,this.joinedRoomCallback),this.receivedDataCallback=this.onReceivedData.bind(this),this.context.connection.beginListenBinary(EA,this.receivedDataCallback)}onDestroy(){this.syncDestroy&&QZ(this.guid,this.context.connection),this._model=null,this.context.connection.stopListen(Xt.JoinedRoom,this.joinedRoomCallback),this.context.connection.stopListenBinary(EA,this.receivedDataCallback)}tryGetLastState(){const t=this.context.connection.tryGetState(this.guid);t&&this.onReceivedData(t)}onReceivedData(t){var i;if(!this.destroyed&&typeof t.guid=="function"&&t.guid()===this.guid){Vc&&console.log("new data",this.context.connection.connectionId,this.context.time.frameCount,this.guid,t),this.receivedUpdate=!0,this._receivedFastUpdate=t.fast();const s=t.transform();if(s){uc.markDirty(this.gameObject,!0);const r=s.position();r&&(this.interpolatePosition&&((i=this._targetPosition)==null||i.set(r.x(),r.y(),r.z())),(!this.interpolatePosition||!this._receivedDataBefore)&&this.setWorldPosition(r.x(),r.y(),r.z()));const o=s.rotation();o&&(this.tempEuler.set(o.x(),o.y(),o.z()),this.interpolateRotation&&this._targetRotation.setFromEuler(this.tempEuler),(!this.interpolateRotation||!this._receivedDataBefore)&&S3(this.gameObject,this.tempEuler))}this._receivedDataBefore=!0}}onEnable(){this.lastWorldPos.copy(this.worldPosition),this.lastWorldRotation.copy(this.worldQuaternion),this._needsUpdate=!0,this._model&&this._model.updateIsOwned()}onDisable(){this._model&&this._model.freeOwnership()}onBeforeRender(){if(!this.activeAndEnabled||!this.context.connection.isConnected)return;if(!this.context.connection.isInRoom||!this._model){Vc&&console.log("no model or room",this.name,this.guid,this.context.connection.isInRoom);return}this._shouldRequestOwnership&&(this._shouldRequestOwnership=!1,this._model.requestOwnership());const t=this.worldPosition,i=this.worldQuaternion;if(this._model.isOwned&&!this.receivedUpdate){const o=t.distanceTo(this.lastWorldPos),a=i.angleTo(this.lastWorldRotation),c=this._model.hasOwnership||this.fastMode?1e-4:.001;(o>c||a>c)&&(this._model.hasOwnership?this._needsUpdate=!0:(Vc&&console.log(this.guid,"reset because not owned but",this.gameObject.name,this.lastWorldPos),this.worldPosition=this.lastWorldPos,t.copy(this.lastWorldPos),this.worldQuaternion=this.lastWorldRotation,i.copy(this.lastWorldRotation),uc.markDirty(this.gameObject,!0),this._needsUpdate=!1))}if(this._model&&!this._model.hasOwnership&&this._model.isOwned&&this._receivedDataBefore){const a=this._receivedFastUpdate||this.fastMode?.5:.3;let c=!1;if(this.interpolatePosition&&this._targetPosition){const l=this.worldPosition;l.lerp(this._targetPosition,a),this.worldPosition=l,c=!0}if(this.interpolateRotation&&this._targetRotation){const l=this.worldQuaternion;l.slerp(this._targetRotation,a),this.worldQuaternion=l,c=!0}c&&uc.markDirty(this.gameObject,!0)}if(this.receivedUpdate=!1,this.lastWorldPos.copy(t),this.lastWorldRotation.copy(i),!this._model)return;if(!this._model||this._model.hasOwnership===void 0||!this._model.hasOwnership){this.rb&&(this.rb.isKinematic=this._model.isOwned??!1,this.rb.setVelocity(0,0,0));return}this.rb&&(this._wasKinematic!==void 0&&(Vc&&console.log("reset kinematic",this.rb.name,this._wasKinematic),this.rb.isKinematic=this._wasKinematic),this.gameObject.position.distanceTo(new w(0,0,0))>1e3&&(Vc&&console.log("RESET",this.name),this.gameObject.position.set(0,1,0),this.rb.setVelocity(0,0,0)));const s=10,r=this.rb||this.fastMode;if(this._needsUpdate&&(this.context.time.frameCount%s===0||r)){if(ET++,r&&bg>0&&this.context.time.frameCount%bg!==0)return;Vc&&console.log("send update",this.context.connection.connectionId,this.guid,this.gameObject.name,this.gameObject.guid),this.overridePhysics&&this.rb,this._needsUpdate=!1;const o=Ez(this.guid,this,!!r);this.context.connection.sendBinary(o)}}}const dte=re("debugshadowcomponents");K1.prototype.interactable={get(){return this.interactive},set(n){this.interactable=n}};const Bo=Symbol("shadowDomOwner");class Ac extends Te{constructor(){super(...arguments);u(this,"_shadowComponent",null);u(this,"_controlsChildLayout",!0);u(this,"_root");u(this,"_parentComponent")}isRoot(){var t;return((t=this.Root)==null?void 0:t.gameObject)===this.gameObject}get canvas(){const t=this.Root;return t!=null&&t.isCanvas?t:null}get Canvas(){return this.canvas}markDirty(){$r.markUIDirty(this.context)}get shadowComponent(){return this._shadowComponent}set shadowComponent(t){this._shadowComponent=t}get controlsChildLayout(){return this._controlsChildLayout}set controlsChildLayout(t){this._controlsChildLayout=t,this.shadowComponent&&(this.shadowComponent.autoLayout=t)}get Root(){return this._root===void 0&&(this._root=le.getComponentInParent(this.gameObject,Px)),this._root}__internalNewInstanceCreated(){super.__internalNewInstanceCreated(),this.shadowComponent=null,this._root=void 0,this._parentComponent=void 0}onEnable(){super.onEnable()}addShadowComponent(t,i){var o;this.removeShadowComponent();const s=this.isRoot()?this.gameObject:this.gameObject.parent;if(this._parentComponent=le.getComponentInParent(s,Ac),!this._parentComponent){console.warn(`Component "${this.name}" doesn't have a UI parent anywhere. Do you have an UI element outside a Canvas? UI components must be a child of a Canvas component`,this);return}t.name=this.name+" ("+(this.constructor.name??"UI")+")",t.autoLayout=this._parentComponent.controlsChildLayout,t[Bo]=this,this.setShadowComponentOwner(t);let r=!1;if(((o=this.Root)==null?void 0:o.gameObject)===this.gameObject)this.gameObject.add(t);else{const a=this._parentComponent.shadowComponent;a&&(a==null||a.add(t),r=!0)}this.shadowComponent=t,i&&i.shadowComponent&&this.shadowComponent&&i.shadowComponent.add(this.shadowComponent),jA&&t.add(new Fo(.5)),this.onAfterAddedToScene(),r&&b3(),dte&&console.log(this.shadowComponent)}setShadowComponentOwner(t){if(t&&(t[Bo]===void 0||t[Bo]===this)&&(t[Bo]=this,t.children))for(const i of t.children)this.setShadowComponentOwner(i)}traverseOwnedShadowComponents(t,i,s){if(t&&t[Bo]===i){s(t);for(const r of t.children)this.traverseOwnedShadowComponents(r,i,s)}}removeShadowComponent(){this.shadowComponent&&this.shadowComponent.removeFromParent()}onAfterAddedToScene(){}setInteractable(t){this.shadowComponent&&(this.shadowComponent.interactable=t)}}class Px extends Ac{awake(){super.awake()}}class ov{constructor(e,t){u(this,"event");u(this,"button");u(this,"buttonName");u(this,"_used",!1);u(this,"_propagationStopped",!1);u(this,"z__pointer_ctured",!1);u(this,"z__pointer_cture_rleased",!1);u(this,"inputSource");u(this,"object");u(this,"point");u(this,"normal");u(this,"face");u(this,"distance");u(this,"instanceId");u(this,"isDown");u(this,"isUp");u(this,"isPressed");u(this,"isClick");u(this,"isDoubleClick");u(this,"input");this.event=t,this.input=e,this.button=t.button}get deviceIndex(){return this.event.deviceIndex}get pointerId(){return this.event.pointerId}get pressure(){return this.event.pressure}get used(){return this._used}use(){this._used||(this._used=!0,this.pointerId!==void 0&&this.input.setPointerUsed(this.pointerId))}get propagationStopped(){return this._propagationStopped}stopPropagation(){this._propagationStopped=!0,this.event.stopImmediatePropagation()}stopImmediatePropagation(){this._propagationStopped=!0,this.event.stopImmediatePropagation()}setPointerCapture(){this.z__pointer_ctured=!0}releasePointerCapture(){this.z__pointer_cture_rleased=!0}get mode(){return this.event.mode}clone(){const e=new ov(this.input,this.event);return Object.assign(e,this),e}Use(){this.use()}StopPropagation(){this.event.stopImmediatePropagation()}}function BO(n,e){return le.foreachComponent(n,i=>{if(!i.enabled)return;const s=i;if(e)switch(e){case"pointerdown":if(s.onPointerDown)return!0;break;case"pointerup":if(s.onPointerUp||s.onPointerClick)return!0;break;case"pointermove":if(s.onPointerEnter||s.onPointerExit||s.onPointerMove)return!0;break}else if(s.onPointerDown||s.onPointerUp||s.onPointerEnter||s.onPointerExit||s.onPointerClick)return!0},!1)===!0}var fte=globalThis&&globalThis.__decorate||function(n,e,t,i){var s=arguments.length,r=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(e,t,r):o(e,t))||r);return s>3&&r&&Object.defineProperty(e,t,r),r};class av extends Te{awake(){$r.createIfNoneExists(this.context)}onEnable(){var e;(e=$r.get(this.context))==null||e.register(this)}onDisable(){var e;(e=$r.get(this.context))==null||e.unregister(this)}}class No extends av{constructor(){super(...arguments);u(this,"targets",null);u(this,"raycastHits",[]);u(this,"ignoreSkinnedMeshes",!1)}start(){this.targets=[this.gameObject]}performRaycast(t=null){if(!this.targets)return null;t??(t=new pa),t.targets=this.targets,t.results=this.raycastHits;const i=t.testObject;this.ignoreSkinnedMeshes&&(t.testObject=r=>r instanceof cc?"continue in children":i?i(r):!0);const s=this.context.physics.raycast(t);return t.testObject=i,s}}fte([x()],No.prototype,"ignoreSkinnedMeshes",void 0);class hI extends No{constructor(){super(),this.ignoreSkinnedMeshes=!0}}class Vb extends av{performRaycast(e){if(!mt.active||!(e!=null&&e.ray))return null;const t=e.ray.origin,i=.01;return this.context.physics.sphereOverlap(t,i)}}class uI{static getObject(e){const t=e[Bo];return t&&(t.isComponent===!0?e=t.gameObject:e=t),e}static isInteractable(e,t){if(t&&(t.canvasGroup=void 0,t.graphic=void 0),e==null||!e.visible||(e=this.getObject(e),!e.visible))return!1;const i=this.tryFindCanvasGroup(e);if((i==null?void 0:i.isCanvasGroup)===!0&&(t&&(t.canvasGroup=i),i.blocksRaycasts===!1||i.interactable===!1))return!1;const s=kb(e,r=>{if(r.isGraphic===!0)return r},!1);return t&&(s==null?void 0:s.isGraphic)===!0&&(t.graphic=s),!((s==null?void 0:s.raycastTarget)===!1||(s==null?void 0:s.layer)===2)}static tryFindCanvasGroup(e){if(!e)return null;const t=kb(e,i=>{const s=i;if(s.blocksRaycasts!==void 0&&s.interactable!==void 0)return s},!1);return t!==void 0?t:this.tryFindCanvasGroup(e.parent)}}function dI(n){const e=n[Bo];return e||(n.parent?dI(n.parent):null)}function pte(n){return n.isUI===!0||typeof n[Bo]=="object"}function Hb(n,e){if(!n)return;const t=n.material;if((t==null?void 0:t.isMaterial)===!0){const i=n.parent;i&&i.isText,t.side=e.doubleSided??!0?Ai:Es,t.shadowSide=e.doubleSided?Ai:Es,n.castShadow=e.castShadows?e.castShadows:!1,n.receiveShadow=e.receiveShadows?e.receiveShadows:!1}for(const i of n.children)Hb(i,e)}function wf(n,e,t){n[e]===void 0&&console.warn("Field",e,"is undefined on",n);const i=Proxy.revocable(n[e],{set(o,a,c,l){const h=o[a],d=Reflect.set(o,a,c,l);return t(c,h),d}}),s=i.revoke,r=n[e];return i.revoke=()=>{n[e]=r,s()},n[e]=i.proxy,i}const DO=Symbol("Scheduled action");function mte(n,e,t=jt.OnBeforeRender){let i=n[DO];i||(i=n[DO]={});const s=e.name;i[t]||(i[t]={});const r=i[t];if(r[s])return;function*a(){e==null||e.call(n),r[s]=null}const c=n.startCoroutine(a(),t);r[s]=c}const Hc=re("debugeventsystem");var xp;(function(n){n.BeforeHandleInput="BeforeHandleInput",n.AfterHandleInput="AfterHandleInput"})(xp||(xp={}));const za=class extends Te{constructor(){super();u(this,"raycaster",[]);u(this,"_handleInputFn");u(this,"pressedByID",new Map);u(this,"hoveredByID",new Map);u(this,"_sortedHits",[]);u(this,"_testObjectsCache",new Map);u(this,"_currentlyActiveRaycaster",null);u(this,"_currentPointerEventName",null);u(this,"shouldRaycastObject",t=>{var r;let i=null;if(pte(t)&&(i=(r=t[Bo])==null?void 0:r.gameObject),this._testObjectsCache.has(t)||i&&this._testObjectsCache.has(i))return this._testObjectsCache.get(t)===!1?"continue in children":!0;{let o=BO(t,this._currentPointerEventName);if(!o&&i&&(o=BO(i,this._currentPointerEventName)),o){this._testObjectsCache.set(t,!0);for(const a of t.children)this.shouldRaycastObject_AddToYesCache(a);return!0}return this._testObjectsCache.set(t,!1),"continue in children"}});u(this,"_sortingBuffer",[]);u(this,"_noDepthTestingResults",[]);u(this,"out",{});u(this,"_capturedPointer",{});u(this,"pointerEnterSymbol",Symbol("pointerEnter"));u(this,"pointerExitSymbol",Symbol("pointerExit"));u(this,"currentActiveMeshUIComponents",[]);za.systems.push(this)}static createIfNoneExists(t){this.didSearchEventSystem||(this.didSearchEventSystem=!0,za.systems.length<=0&&za.systems.push(...le.findObjectsOfType(za,t)));for(const s of za.systems)if(s.context===t)return;const i=new ge;le.addNewComponent(i,za),t.scene.add(i)}static get systems(){const t=Lt.Current;return this._eventSystemMap.has(t)||this._eventSystemMap.set(t,[]),this._eventSystemMap.get(t)}static get(t){const i=this._eventSystemMap.get(t);return i&&i.length>0?i[0]:null}static get instance(){return this.systems[0]}static ensureUpdateMeshUI(t,i,s=!1){bh.update(t,i,s)}static markUIDirty(t){bh.markDirty()}get hasActiveUI(){return this.currentActiveMeshUIComponents.length>0}get isHoveringObjects(){return this.hoveredByID.size>0}onDestroy(){za.systems.splice(za.systems.indexOf(this),1)}start(){if(this.raycaster.length<=0&&!le.findObjectOfType(av,this.context)){const i=le.addNewComponent(this.context.scene,No);this.raycaster.push(i),(Tt()||Hc)&&console.warn("Added an ObjectRaycaster to the scene because no raycaster was found.")}}register(t){var i;t&&this.raycaster&&!this.raycaster.includes(t)&&((i=this.raycaster)==null||i.push(t))}unregister(t){var s,r;const i=(s=this.raycaster)==null?void 0:s.indexOf(t);i!==void 0&&i!==-1&&((r=this.raycaster)==null||r.splice(i,1))}onEnable(){this._handleInputFn??(this._handleInputFn=this.onPointerEvent.bind(this)),this.context.input.addEventListener(li.PointerDown,this._handleInputFn),this.context.input.addEventListener(li.PointerUp,this._handleInputFn),this.context.input.addEventListener(li.PointerMove,this._handleInputFn)}onDisable(){this.context.input.removeEventListener(li.PointerDown,this._handleInputFn),this.context.input.removeEventListener(li.PointerUp,this._handleInputFn),this.context.input.removeEventListener(li.PointerMove,this._handleInputFn)}onBeforeRender(){this.resetMeshUIStates()}onPointerEvent(t){if(t===void 0||t.propagationStopped)return;const i=new ov(this.context.input,t);this._currentPointerEventName=t.type,i.inputSource=this.context.input,i.isClick=t.isClick,i.isDoubleClick=t.isDoubleClick,i.isDown=t.type==li.PointerDown,i.isUp=t.type==li.PointerUp,i.isPressed=this.context.input.getPointerPressed(t.pointerId),Hc&&(i.isDown?console.log("DOWN",i.pointerId):i.isUp&&console.log("UP",i.pointerId),i.isClick&&console.log("CLICK",i.pointerId));const s=new pa;t.ray?s.ray=t.ray:s.screenPoint=this.context.input.getPointerPositionRC(t.pointerId);const r=this.performRaycast(s);Hc&&i.isClick&&Tn("EventSystem: "+i.pointerId+" - "+this.context.time.frame+" - Up:"+i.isUp+", Down:"+i.isDown);const o={sender:this,args:i,hasActiveUI:this.currentActiveMeshUIComponents.length>0};this.dispatchEvent(new CustomEvent(xp.BeforeHandleInput,{detail:o})),this.handleIntersections(r,i),this.dispatchEvent(new CustomEvent(xp.AfterHandleInput,{detail:o}))}shouldRaycastObject_AddToYesCache(t){this._testObjectsCache.set(t,!0);for(const i of t.children)this.shouldRaycastObject_AddToYesCache(i)}performRaycast(t){if(!this.raycaster)return null;this._testObjectsCache.clear(),this._sortedHits.length=0,t||(t=new pa),t.testObject=this.shouldRaycastObject;for(const i of this.raycaster){if(!i.activeAndEnabled)continue;this._currentlyActiveRaycaster=i;const s=i.performRaycast(t);this._currentlyActiveRaycaster=null,s&&s.length>0&&this._sortedHits.push(...s)}return this._sortedHits.sort((i,s)=>i.distance-s.distance),this._sortedHits}assignHitInformation(t,i){i?(t.point=i.point,t.normal=i.normal,t.face=i.face,t.distance=i.distance,t.instanceId=i.instanceId):(t.point=void 0,t.normal=void 0,t.face=void 0,t.distance=void 0,t.instanceId=void 0)}handleIntersections(t,i){var r;if(t!=null&&t.length){t=this.sortCandidates(t);for(const o of t){if(i.event.immediatePropagationStopped)return!1;if(this.assignHitInformation(i,o),this.handleEventOnObject(o.object,i))return!0}}this.assignHitInformation(i,t==null?void 0:t[0]),this.invokePointerCapture(i);const s=this.hoveredByID.get(i.pointerId);return s&&this.propagatePointerExit(s.obj,s.data,null),this.hoveredByID.delete(i.pointerId),i.isUp&&((r=this.pressedByID.get(i.pointerId))==null||r.handlers.forEach(o=>this.invokeOnPointerUp(i,o)),this.pressedByID.delete(i.pointerId)),!1}sortCandidates(t){this._sortingBuffer.length=0,this._noDepthTestingResults.length=0;for(let i=0;i<t.length;i++){const s=t[i],r=s.object;if(r.material&&r.material.depthTest===!1){this._noDepthTestingResults.push(s);continue}this._sortingBuffer.push(s)}for(const i of this._sortingBuffer)this._noDepthTestingResults.push(i);return this._noDepthTestingResults}handleEventOnObject(t,i){if(!this.testIsVisible(t))return i.isClick&&Hc&&console.log("not allowed",t),!1;if(i.pointerId===void 0)return Hc&&console.error("Event without pointer can't be handled",i),!1;i.object=t;const s=t.parent;let r=!1;const o=i.isClick??!1;let a=null;if(s&&s.isUI){const f=(i.isPressed||i.isClick)??!1;if(s[Bo]){const p=s[Bo].gameObject;if(p){if(!uI.isInteractable(p,this.out))return!1;a=this.out.canvasGroup??null,this.handleMeshUIIntersection(t,f),t=p,r=!0}}if(!r&&this.handleMeshUiObjectWithoutShadowDom(s,f))return!0}o&&Hc&&console.log(this.context.time.frame,t);const c=this.hoveredByID.get(i.pointerId),l=c==null?void 0:c.obj;l!==t&&l&&this.propagatePointerExit(l,c.data,t);const d=this.hoveredByID.get(i.pointerId);if(d?(d.obj=t,d.data=i):this.hoveredByID.set(i.pointerId,{obj:t,data:i}),i.isDown){const f=this.pressedByID.get(i.pointerId);f?(f.obj=t,f.data=i):this.pressedByID.set(i.pointerId,{obj:t,data:i,handlers:new Set})}return(a===null||a.interactable)&&this.handleMainInteraction(t,i,l??null),!0}propagate(t,i){for(;t;)le.foreachComponent(t,s=>{i(s)},!1),t=t.parent}handleMainInteraction(t,i,s){const r=this.pressedByID.get(i.pointerId),o=s!==t;let a=!0;switch(i.event.pointerType){case"mouse":case"touch":const c=this.context.input.getPointerPositionLastFrame(i.pointerId),l=this.context.input.getPointerPosition(i.pointerId);a=c&&!nt.approximately(c,l);break}this.propagate(t,c=>{var h;const l=c;l.interactable!==!1&&(!l.activeAndEnabled||!l.enabled||(l.onPointerEnter&&o&&this.handlePointerEnter(l,i),i.isDown&&l.onPointerDown&&(l.onPointerDown(i),r==null||r.handlers.add(l),this.handlePointerCapture(i,l)),l.onPointerMove&&(a&&l.onPointerMove(i),this.handlePointerCapture(i,l)),i.isUp&&(l.onPointerUp&&(this.invokeOnPointerUp(i,l),r==null||r.handlers.delete(l)),l.onPointerExit&&((h=i.event)==null?void 0:h.pointerType)===zs.Touch&&(this.handlePointerExit(l,i),this.hoveredByID.delete(i.pointerId))),i.isClick&&l.onPointerClick&&l.onPointerClick(i)))}),i.isUp&&(r==null||r.handlers.forEach(c=>{this.invokeOnPointerUp(i,c)}),this.pressedByID.delete(i.pointerId))}propagatePointerExit(t,i,s){this.propagate(t,r=>{if(!r.gameObject||r.destroyed)return;const o=r;if(o.onPointerExit){if(s&&this.isChild(s,r.gameObject))return;this.handlePointerExit(o,i)}})}invokeOnPointerUp(t,i){var s;(s=i.onPointerUp)==null||s.call(i,t),this.releasePointerCapture(t,i)}handlePointerEnter(t,i){t.onPointerEnter&&this.updatePointerState(t,i.pointerId,this.pointerEnterSymbol,!0)&&t.onPointerEnter(i),this.updatePointerState(t,i.pointerId,this.pointerExitSymbol,!1)}handlePointerExit(t,i){t.onPointerExit&&this.updatePointerState(t,i.pointerId,this.pointerExitSymbol,!0)&&t.onPointerExit(i),this.updatePointerState(t,i.pointerId,this.pointerEnterSymbol,!1)}updatePointerState(t,i,s,r){let o=t[s];if(r)return o&&o.includes(i)?!1:(o=o||[],o.push(i),t[s]=o,!0);{if(!o||!o.includes(i))return!1;const a=o.indexOf(i);return a!==-1&&o.splice(a,1),!0}}handlePointerCapture(t,i){if(t.z__pointer_ctured){t.z__pointer_ctured=!1;const s=t.pointerId;if(i.onPointerMove){const r=this._capturedPointer[s]||[];r.push(i),this._capturedPointer[s]=r}else Tt()&&!i.z__warned_no_pointermove&&(i.z__warned_no_pointermove=!0,console.warn("PointerCapture was requested but the component doesn't implement onPointerMove. It will not receive any pointer events"))}else t.z__pointer_cture_rleased&&(t.z__pointer_cture_rleased=!1,this.releasePointerCapture(t,i))}releasePointerCapture(t,i){const s=t.pointerId;if(this._capturedPointer[s]){const r=this._capturedPointer[s].indexOf(i);r!==-1&&(this._capturedPointer[s].splice(r,1),Hc&&console.log("released pointer capture",s,i,this._capturedPointer))}}invokePointerCapture(t){var i;if(t.event.type===li.PointerMove){const s=t.pointerId,r=this._capturedPointer[s];if(r){Hc&&console.log("Captured",s,r);for(let o=0;o<r.length;o++){const a=r[o];if(a.destroyed){r.splice(o,1),o--;continue}(i=a.onPointerMove)==null||i.call(a,t)}}}}isChild(t,i){return!t||!i?!1:t===i?!0:t.parent?this.isChild(t.parent,i):!1}handleMeshUiObjectWithoutShadowDom(t,i){return!t||!t.isUI?!0:this.handleMeshUIIntersection(t,i)}handleMeshUIIntersection(t,i){const s=bh.updateState(t,i);return s&&this.currentActiveMeshUIComponents.push(s),s!==null}resetMeshUIStates(){if(this.context.input.getPointerPressedCount()>0&&bh.resetLastSelected(),!(!this.currentActiveMeshUIComponents||this.currentActiveMeshUIComponents.length<=0)){for(let t=0;t<this.currentActiveMeshUIComponents.length;t++){const i=this.currentActiveMeshUIComponents[t];bh.resetState(i)}this.currentActiveMeshUIComponents.length=0}}testIsVisible(t){return t?le.isActiveSelf(t)?this.testIsVisible(t.parent):!1:!0}};let $r=za;u($r,"_eventSystemMap",new Map),u($r,"didSearchEventSystem",!1);class bh{static markDirty(){this.needsUpdate=!0}static update(e,t,i=!1){if(i){e.update();return}const s=t.time.frameCount;for(const r of this.lastUpdateFrame)if(r.context===t){if(s===r.frame)return;r.frame=s;let o=this.needsUpdate||s<1;r.nextUpdate===t.time.frameCount&&(o=!0),o&&(Hc&&console.log("Update threemeshui"),this.needsUpdate=!1,e.update());return}this.lastUpdateFrame=[{context:t,frame:s,nextUpdate:s}],e.update()}static updateState(e,t){let i=null;if(e&&(i=this.findBlockInParent(e),i&&i!==this.lastSelected)){if(i.interactable===!1)return null;this.needsUpdate=!0}return i}static resetLastSelected(){const e=this.lastSelected;e&&(this.lastSelected=null,this.resetState(e))}static resetState(e){e&&(this.needsUpdate=!0)}static findBlockInParent(e){return e?e.isBlock?e:this.findBlockInParent(e.parent):null}}u(bh,"lastSelected",null),u(bh,"lastUpdateFrame",[]),u(bh,"needsUpdate",!1);var Ps=globalThis&&globalThis.__decorate||function(n,e,t,i){var s=arguments.length,r=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(e,t,r):o(e,t))||r);return s>3&&r&&Object.defineProperty(e,t,r),r};const gte=re("debugorbit"),Yy=re("freecam"),Dm=re("debugcamerafit"),Jy=re("smoothcam"),Ate={LEFT:"",UP:"",RIGHT:"",BOTTOM:""};let dC;var TT;(function(n){n.CameraTargetReached="target-reached"})(TT||(TT={}));class Qb extends CustomEvent{constructor(e,t){super(TT.CameraTargetReached,{detail:{controls:e,type:t}})}}class $i extends Te{constructor(){super(...arguments);u(this,"autoFit",!1);u(this,"enableRotate",!0);u(this,"autoRotate",!1);u(this,"autoRotateSpeed",1);u(this,"enableKeys",!0);u(this,"enableDamping",!0);u(this,"dampingFactor",.1);u(this,"enableZoom",!0);u(this,"minZoom",0);u(this,"maxZoom",1/0);u(this,"enablePan",!0);u(this,"lookAtConstraint",null);u(this,"lookAtConstraint01",1);u(this,"allowInterrupt",!0);u(this,"middleClickToFocus",!0);u(this,"doubleClickToFocus",!0);u(this,"useSlerp",!0);u(this,"debugLog",!1);u(this,"targetLerpDuration",1);u(this,"autoTarget",!0);u(this,"_controls",null);u(this,"_cameraObject",null);u(this,"_lookTargetLerpActive",!1);u(this,"_lookTargetStartPosition",new w);u(this,"_lookTargetEndPosition",new w);u(this,"_lookTargetLerp01",0);u(this,"_lookTargetLerpDuration",0);u(this,"_cameraLerpActive",!1);u(this,"_cameraStartPosition",new w);u(this,"_cameraEndPosition",new w);u(this,"_cameraLerp01",0);u(this,"_cameraLerpDuration",0);u(this,"_inputs",0);u(this,"_enableTime",0);u(this,"_startedListeningToKeyEvents",!1);u(this,"_eventSystem");u(this,"_afterHandleInputFn");u(this,"_camera",null);u(this,"_syncedTransform");u(this,"_didStart",!1);u(this,"targetElement",null);u(this,"onControlsChangeStarted",()=>{this._syncedTransform&&this._syncedTransform.requestOwnership()});u(this,"_shouldDisable",!1);u(this,"_haveAttachedKeyboardEvents",!1)}get isCameraController(){return!0}get controls(){return this._controls}get controllerObject(){return this._cameraObject}onStartInteraction(t){var i;(i=this.controls)==null||i.addEventListener("start",t)}get targetLerpSpeed(){return 5}set targetLerpSpeed(t){this.targetLerpDuration=1/t}awake(){this._didStart=!1,this._startedListeningToKeyEvents=!1}start(){if(this._didStart=!0,this.autoTarget&&this._controls){const t=le.getComponent(this.gameObject,Di);if(t&&!this.setLookTargetFromConstraint()){this.debugLog&&console.log("NO TARGET");const s=Ht(t.cam).length(),r=new w(0,0,-s).applyMatrix4(t.cam.matrixWorld);this.setLookTargetPosition(r,!0)}if(this.autoTarget&&!this.setLookTargetFromConstraint()){const i=new pa;i.screenPoint=new ie(0,0),i.lineThreshold=.1;const s=this.context.physics.raycast(i);s.length>0&&this.setLookTargetPosition(s[0].point,!0),Dm&&console.log("OrbitControls hits",...s)}this.autoFit&&this.fitCamera()}this._eventSystem=$r.get(this.context)??void 0,this._eventSystem&&(this._afterHandleInputFn=this.afterHandleInput.bind(this),this._eventSystem.addEventListener(xp.AfterHandleInput,this._afterHandleInputFn))}onDestroy(){var t,i;(t=this._controls)==null||t.dispose(),(i=this._eventSystem)==null||i.removeEventListener(xp.AfterHandleInput,this._afterHandleInputFn)}onEnable(){this._enableTime=this.context.time.time;const t=le.getComponent(this.gameObject,Di);this._camera=t;const i=t==null?void 0:t.cam;if(i&&IO(i,this,!0),!this._controls){if(!i){console.warn("OrbitControls: Requires a Camera component on the same object as this component.");return}i&&(this._cameraObject=i);const s=this.targetElement??this.context.renderer.domElement,r=i==null?void 0:i.quaternion.clone();this._controls=new rte(i,s),i==null||i.quaternion.copy(r),dC===void 0&&(dC={...this._controls.keys})}this._controls&&(Yy&&(this.enablePan=!0,this.enableZoom=!0,this.middleClickToFocus=!0,Pl()&&(this.doubleClickToFocus=!0)),this._controls.addEventListener("start",this.onControlsChangeStarted),(i==null?void 0:i.type)==="PerspectiveCamera"?Yy||(this._controls.minDistance=this.minZoom,this._controls.maxDistance=this.maxZoom):Yy||(this._controls.minZoom=this.minZoom,this._controls.maxZoom=this.maxZoom),this._startedListeningToKeyEvents||(this._startedListeningToKeyEvents=!0,this._controls.listenToKeyEvents(window.document.body))),this._syncedTransform=le.getComponent(this.gameObject,Ad)??void 0}onDisable(){var t;(t=this._camera)!=null&&t.cam&&IO(this._camera.cam,this,!1),this._controls&&(this._controls.enabled=!1,this._controls.autoRotate=!1,this._controls.removeEventListener("start",this.onControlsChangeStarted))}afterHandleInput(t){t.detail.args.pointerId===0&&(t.detail.args.isDown?this._controls&&this._eventSystem&&(this._shouldDisable=this._eventSystem.hasActiveUI):(!t.detail.args.isPressed||t.detail.args.isUp)&&(this._shouldDisable=!1))}onBeforeRender(){var i,s;if(!this._controls||this._cameraObject!==this.context.mainCamera)return;(this.context.input.getPointerDown(1)||this.context.input.getPointerDown(2)||this.context.input.mouseWheelChanged||this.context.input.getPointerPressed(0)&&((i=this.context.input.getPointerPositionDelta(0))!=null&&i.length())||0>.1)&&(this._inputs+=1),this._inputs>0&&this.allowInterrupt&&(this.enableRotate&&(this.autoRotate=!1),this._cameraLerpActive=!1,this._lookTargetLerpActive=!1),this._inputs=0;let t=this.middleClickToFocus&&this.context.input.getPointerClicked(1);if(t||(t=this.doubleClickToFocus&&this.context.input.getPointerDoubleClicked(0)&&this.context.time.time-this._enableTime>.3),t&&this.setTargetFromRaycast(),this._lookTargetLerpActive||this._cameraLerpActive){if(this._cameraLerpActive&&this._cameraObject)if(this._cameraLerp01+=this.context.time.deltaTime/this._cameraLerpDuration,this._cameraLerp01>=1)this._cameraObject.position.copy(this._cameraEndPosition),this._cameraLerpActive=!1,this.dispatchEvent(new Qb(this,"camera"));else{const r=nt.easeInOutCubic(this._cameraLerp01);this._cameraObject.position.lerpVectors(this._cameraStartPosition,this._cameraEndPosition,r)}if(this._lookTargetLerpActive)if(this._lookTargetLerp01+=this.context.time.deltaTime/this._lookTargetLerpDuration,this._lookTargetLerp01>=1)this._controls.target.copy(this._lookTargetEndPosition),this._lookTargetLerpActive=!1,this.dispatchEvent(new Qb(this,"lookat"));else{const r=nt.easeInOutCubic(this._lookTargetLerp01);this._controls.target.lerpVectors(this._lookTargetStartPosition,this._lookTargetEndPosition,r)}}if(this._controls){if(this.debugLog&&(this._controls.domElement=this.context.renderer.domElement),this._controls.enabled=!this._shouldDisable&&this._camera===this.context.mainCameraComponent&&!this.context.isInXR,this._controls.keys=this.enableKeys?dC:Ate,this._controls.autoRotate=this.autoRotate,this._controls.autoRotateSpeed=this.autoRotateSpeed,this._controls.enableZoom=this.enableZoom,this._controls.enableDamping=this.enableDamping,this._controls.dampingFactor=this.dampingFactor,this._controls.enablePan=this.enablePan,this._controls.enableRotate=this.enableRotate,typeof Jy=="number"||Jy===!0){this._controls.enableDamping=!0;const r=typeof Jy=="number"?Jy:.99;this._controls.dampingFactor=Math.max(.001,1-Math.min(1,r))}this.allowInterrupt||(this._lookTargetLerpActive&&(this._controls.enablePan=!1),this._cameraLerpActive&&(this._controls.enableRotate=!1,this._controls.autoRotate=!1),(this._lookTargetLerpActive||this._cameraLerpActive)&&(this._controls.enableZoom=!1)),this.context.isInXR||(!Yy&&((s=this.lookAtConstraint)!=null&&s.locked)&&this.setLookTargetFromConstraint(0,this.lookAtConstraint01),this._controls.update(),gte&&kt.DrawWireSphere(this._controls.target,.1,65280))}}setCameraAndLookTarget(t){if(!t||!(t instanceof ge))return;const i=Ht(t),s=x3(t);this.setTargetFromRaycast(new ro(i,s)),this.setCameraTargetPosition(i)}setCameraTargetPosition(t,i=!1){var s,r;t&&(t instanceof ge&&(t=Ht(t)),this._cameraEndPosition||(this._cameraEndPosition=new w),this._cameraEndPosition.copy(t),i===!0?(this._cameraLerpActive=!1,(s=this.controllerObject)==null||s.position.copy(this._cameraEndPosition)):this._cameraObject&&(this._cameraLerpActive=!0,this._cameraLerp01=0,this._cameraStartPosition.copy((r=this._cameraObject)==null?void 0:r.position),typeof i=="number"?this._cameraLerpDuration=i:this._cameraLerpDuration=this.targetLerpDuration))}get cameraLerpActive(){return this._cameraLerpActive}stopCameraLerp(){this._cameraLerpActive=!1}setLookTargetPosition(t=null,i=!1){this._controls&&t&&(t instanceof ge&&(t=Ht(t)),this._lookTargetEndPosition.copy(t),i===!0?this._controls.target.copy(this._lookTargetEndPosition):(this._lookTargetLerpActive=!0,this._lookTargetLerp01=0,this._lookTargetStartPosition.copy(this._controls.target),typeof i=="number"?this._lookTargetLerpDuration=i:this._lookTargetLerpDuration=this.targetLerpDuration))}get lookTargetLerpActive(){return this._lookTargetLerpActive}stopLookTargetLerp(){this._lookTargetLerpActive=!1}setLookTargetFromConstraint(t=0,i=1){var r;if(!this._controls)return!1;const s=(r=this.lookAtConstraint)==null?void 0:r.sources;if(s&&s.length>0){const o=s[t];if(o)return o.getWorldPosition(this._lookTargetEndPosition),this.lerpLookTarget(this._lookTargetEndPosition,i),!0}return!1}lerpTarget(t,i){return this.lerpLookTarget(t,i)}lerpLookTarget(t,i){this._controls&&(i>=1?this._controls.target.copy(t):this._controls.target.lerp(t,i))}setTargetFromRaycast(t){var s,r;if(!this.controls)return;const i=t?this.context.physics.raycastFromRay(t):this.context.physics.raycast();for(const o of i)if(o.distance>0&&le.isActiveInHierarchy(o.object)){const a=dI(o.object);if(a){const c=a.canvas;if(c!=null&&c.screenspace)break}if(this.setLookTargetPosition(o.point),this.context.mainCamera){const l=Ht(this.context.mainCamera).clone().sub(this.controls.target).add(this._lookTargetEndPosition);(r=(s=this._cameraObject)==null?void 0:s.parent)==null||r.worldToLocal(l),this.setCameraTargetPosition(l)}break}}fitCamera(t,i=1.1,s=!0){const r=this._cameraObject,o=this._controls;if(t!=null&&t.length||(t=this.context.scene.children),t.length<=0||!r||!o)return;const a=new w,c=new w,l=new Mi;l.makeEmpty();const h=[];function d(b){let _=!0;if(b.visible&&ate(b)!==!1&&!(b.type==="TransformControlsGizmo"||b.type==="TransformControlsPlane")&&(b instanceof xE&&(_=!1),b instanceof ex&&(_=!1),b instanceof Sz&&(_=!1),b.material instanceof W_&&(_=!1),b instanceof me||(_=!1),b!==r&&b.isUI!==!0)){if(_){Dm&&console.log(b.name,b.type,b);const T=b.children;b.children=h;const E=b.position,M=b.scale;if(Number.isNaN(E.x)||Number.isNaN(E.y)||Number.isNaN(E.z)){console.warn(`Object "${b.name}" has NaN values in position or scale.... will ignore it`,E,M);return}l.expandByObject(b,!0),b.children=T}for(const T of b.children)d(T)}}for(const b of t)b.updateMatrixWorld(),d(b);if(r.updateMatrixWorld(),r.updateProjectionMatrix(),l.getCenter(c),l.applyMatrix4(r.matrixWorldInverse),l.getSize(a),l.setFromCenterAndSize(c,a),Number.isNaN(a.x)||Number.isNaN(a.y)||Number.isNaN(a.z)){console.warn("Camera fit size resultet in NaN",r,l,[...t]);return}if(a.length()<=1e-10){Dm&&console.warn("Camera fit size is zero",l,[...t]);return}const f=r.fov,p=2*Math.atan(Math.tan(f*Math.PI/360/2)*r.aspect)/Math.PI*360,m=a.y/(2*Math.atan(Math.PI*f/360)),g=a.x/(2*Math.atan(Math.PI*p/360)),y=i*Math.max(m,g)+a.z/2;Dm&&console.log("Fit camera to objects",m,g,"distance",y);const A=Ht(r),v=o.target.clone().sub(A).normalize().multiplyScalar(y);if(o.maxDistance=y*10,o.minDistance=y*.01,this.setLookTargetPosition(c,s),this.autoTarget=!1,r.near=y/1e3,r.far=y*100,r.updateMatrixWorld(),r.updateProjectionMatrix(),r.parent){const b=r.parent.worldToLocal(o.target.clone().sub(v));this.setCameraTargetPosition(b,s)}else console.error(`Can not fit camera ${r.name} because it has no parent`);if(Dm){const b=new xE(l);this.context.scene.add(b),C3(b,_x(r)),this._haveAttachedKeyboardEvents||(this._haveAttachedKeyboardEvents=!0,document.body.addEventListener("keydown",_=>{_.code==="KeyF"&&this.fitCamera(t)}))}o.update()}}Ps([x()],$i.prototype,"autoFit",void 0);Ps([x()],$i.prototype,"enableRotate",void 0);Ps([x()],$i.prototype,"autoRotate",void 0);Ps([x()],$i.prototype,"autoRotateSpeed",void 0);Ps([x()],$i.prototype,"enableKeys",void 0);Ps([x()],$i.prototype,"enableDamping",void 0);Ps([x()],$i.prototype,"dampingFactor",void 0);Ps([x()],$i.prototype,"enableZoom",void 0);Ps([x()],$i.prototype,"minZoom",void 0);Ps([x()],$i.prototype,"maxZoom",void 0);Ps([x()],$i.prototype,"enablePan",void 0);Ps([x(Rx)],$i.prototype,"lookAtConstraint",void 0);Ps([x()],$i.prototype,"lookAtConstraint01",void 0);Ps([x()],$i.prototype,"allowInterrupt",void 0);Ps([x()],$i.prototype,"middleClickToFocus",void 0);Ps([x()],$i.prototype,"doubleClickToFocus",void 0);Ps([x()],$i.prototype,"targetLerpDuration",void 0);var oo=globalThis&&globalThis.__decorate||function(n,e,t,i){var s=arguments.length,r=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(e,t,r):o(e,t))||r);return s>3&&r&&Object.defineProperty(e,t,r),r},Mo;(function(n){n[n.Skybox=1]="Skybox",n[n.SolidColor=2]="SolidColor",n[n.Uninitialized=4]="Uninitialized"})(Mo||(Mo={}));const jc=re("debugcam"),OO=re("debugscreenpointtoray"),qf=class extends Te{constructor(){super(...arguments);u(this,"_nearClipPlane",.1);u(this,"_farClipPlane",1e3);u(this,"orthographic",!1);u(this,"orthographicSize",5);u(this,"ARBackgroundAlpha",0);u(this,"_cullingMask",4294967295);u(this,"_backgroundBlurriness",0);u(this,"_backgroundIntensity",1);u(this,"_environmentIntensity");u(this,"_targetTexture",null);u(this,"_backgroundColor");u(this,"_fov");u(this,"_cam",null);u(this,"_clearFlags",Mo.SolidColor);u(this,"_skybox")}get isCamera(){return!0}get aspect(){return this._cam instanceof Wt?this._cam.aspect:this.context.domWidth/this.context.domHeight}get fieldOfView(){return this._cam instanceof Wt?this._cam.fov:this._fov}set fieldOfView(t){const i=this.fieldOfView!=t;if(this._fov=t,i&&this._cam&&this._cam instanceof Wt){if(this._fov===void 0){console.warn("Can not set undefined fov on PerspectiveCamera");return}this._cam.fov=this._fov,this._cam.updateProjectionMatrix()}}get nearClipPlane(){return this._nearClipPlane}set nearClipPlane(t){const i=this._nearClipPlane!=t;this._nearClipPlane=t,this._cam&&i&&(this._cam.near=t,this._cam.updateProjectionMatrix())}get farClipPlane(){return this._farClipPlane}set farClipPlane(t){const i=this._farClipPlane!=t;this._farClipPlane=t,this._cam&&i&&(this._cam.far=t,this._cam.updateProjectionMatrix())}get clearFlags(){return this._clearFlags}set clearFlags(t){t!==this._clearFlags&&(this._clearFlags=t,this.applyClearFlagsIfIsActiveCamera())}set cullingMask(t){this._cullingMask=t,this._cam&&(this._cam.layers.mask=t)}get cullingMask(){return this._cam?this._cam.layers.mask:this._cullingMask}set cullingLayer(t){this.cullingMask=(1<<t|0)>>>0}set backgroundBlurriness(t){t!==this._backgroundBlurriness&&(t===void 0?this._backgroundBlurriness=void 0:this._backgroundBlurriness=Math.min(Math.max(t,0),1),this.applyClearFlagsIfIsActiveCamera())}get backgroundBlurriness(){return this._backgroundBlurriness}set backgroundIntensity(t){t!==this._backgroundIntensity&&(t===void 0?this._backgroundIntensity=void 0:this._backgroundIntensity=Math.min(Math.max(t,0),10),this.applyClearFlagsIfIsActiveCamera())}get backgroundIntensity(){return this._backgroundIntensity}set environmentIntensity(t){this._environmentIntensity=t}get environmentIntensity(){return this._environmentIntensity}get backgroundColor(){return this._backgroundColor??null}set backgroundColor(t){if(t){if(this._backgroundColor)this._backgroundColor.copy(t);else{if(!t.clone)return;this._backgroundColor=t.clone()}t.alpha===void 0&&(this._backgroundColor.alpha=1),this.applyClearFlagsIfIsActiveCamera()}}set targetTexture(t){this._targetTexture=t}get targetTexture(){return this._targetTexture}get cam(){return this.activeAndEnabled&&this.buildCamera(),this._cam}screenPointToRay(t,i,s){const r=this.cam,o=qf._origin;o.set(t,i,-1),this.context.input.convertScreenspaceToRaycastSpace(o),OO&&console.log("screenPointToRay",t.toFixed(2),i.toFixed(2),"now:",o.x.toFixed(2),o.y.toFixed(2),"isInXR:"+this.context.isInXR),o.z=-1,o.unproject(r);const a=qf._direction.set(o.x,o.y,o.z),c=Ht(r);return a.sub(c),a.normalize(),s?(s.set(c,a),s):new ro(c.clone(),a.clone())}awake(){OO&&window.addEventListener("pointerdown",t=>{const i=t.clientX,s=t.clientY;console.log("touch",i.toFixed(2),s.toFixed(2));const r=this.screenPointToRay(i,s),o="#"+Math.floor(Math.random()*16777215).toString(16);kt.DrawRay(r.origin,r.direction,o,10)})}onEnable(){jc&&console.log(`Camera enabled: "${this.name}". ClearFlags=${Mo[this._clearFlags]}`,this),this.buildCamera(),(this.tag=="MainCamera"||!this.context.mainCameraComponent)&&(this.context.setCurrentCamera(this),yte(this)),this.applyClearFlagsIfIsActiveCamera()}onDisable(){this.context.removeCamera(this)}onBeforeRender(){if(this._cam&&(this._clearFlags===Mo.SolidColor&&this.applyClearFlagsIfIsActiveCamera(),this._targetTexture)){this.context.isManagedExternally&&(this._warnedAboutExternalRenderer||(this._warnedAboutExternalRenderer=!0,console.warn("Rendering with external renderer is not supported yet. This may not work or throw errors. Please remove the the target texture from your camera: "+this.name,this.targetTexture))),this.context.composer;const t=this.context.renderer;if(t){const i=this.context.mainCameraComponent;this.applyClearFlags(),this._targetTexture.render(this.context.scene,this._cam,t),i==null||i.applyClearFlags()}}}buildCamera(){if(this._cam)return;const t=this.gameObject.isCamera;let i=null;if(t?(i=this.gameObject,i==null||i.layers.enableAll(),i instanceof Wt&&(this._fov=i.fov)):i=this.gameObject.children[0],i&&i.isCamera)i instanceof Wt&&(this._fov&&(i.fov=this._fov),i.near=this._nearClipPlane,i.far=this._farClipPlane,i.updateProjectionMatrix());else if(!this.orthographic)i=new Wt(this.fieldOfView,window.innerWidth/window.innerHeight,this._nearClipPlane,this._farClipPlane),this.fieldOfView&&(i.fov=this.fieldOfView),this.gameObject.add(i);else{const s=this.orthographicSize*100;i=new vc(window.innerWidth/-s,window.innerWidth/s,window.innerHeight/s,window.innerHeight/-s,this._nearClipPlane,this._farClipPlane),this.gameObject.add(i)}this._cam=i,this._cam.layers.mask=this._cullingMask,this.tag=="MainCamera"&&this.context.setCurrentCamera(this)}applyClearFlagsIfIsActiveCamera(){this.context.mainCameraComponent===this&&this.applyClearFlags()}applyClearFlags(){if(!this._cam){jc&&console.log("Camera does not exist (apply clear flags)");return}if(this.fieldOfView=this._fov,jc){const t=`Camera "${this.name}" clear flags: ${Mo[this._clearFlags]}`;console.log(t)}switch(this._clearFlags){case Mo.Skybox:if(qf.backgroundShouldBeTransparent(this.context)&&(!this.ARBackgroundAlpha||this.ARBackgroundAlpha<.001)){this.context.scene.background=null,this.context.renderer.setClearColor(0,0);return}this.enableSkybox(),this._backgroundBlurriness!==void 0?this.context.scene.backgroundBlurriness=this._backgroundBlurriness:jc&&console.warn(`Camera "${this.name}" has no background blurriness`),this._backgroundIntensity!==void 0?this.context.scene.backgroundIntensity=this._backgroundIntensity:jc&&console.warn(`Camera "${this.name}" has no background intensity`);break;case Mo.SolidColor:if(this._backgroundColor){let t=this._backgroundColor.alpha;qf.backgroundShouldBeTransparent(this.context)&&(t=this.ARBackgroundAlpha??0),this.context.scene.background=null,this.context.renderer.setClearColor(this._backgroundColor,t)}else jc&&console.warn(`Camera "${this.name}" has no background color`,this);break;case Mo.Uninitialized:this.context.scene.background=null,this.context.renderer.setClearColor(0,0);break}}enableSkybox(){this._skybox||(this._skybox=new vte(this)),this._skybox.enable()}static backgroundShouldBeTransparent(t){var o,a,c,l;const i=(o=t.renderer.xr)==null?void 0:o.getSession();if(!i)return!1;if(typeof i._transparent=="boolean")return i._transparent;const s=i.environmentBlendMode;jc&&Tn("Environment blend mode: "+s+" on "+navigator.userAgent);let r=s==="additive"||s==="alpha-blend";return t.isInAR&&s==="opaque"&&((a=navigator.userAgent)!=null&&a.includes("OculusBrowser")||(c=navigator.userAgent)!=null&&c.includes("Mozilla")&&((l=navigator.userAgent)!=null&&l.includes("Mobile WebXRViewer/v2")))&&(r=!0),i._transparent=r,r}};let Di=qf;u(Di,"_origin",new w),u(Di,"_direction",new w);oo([x()],Di.prototype,"fieldOfView",null);oo([x()],Di.prototype,"nearClipPlane",null);oo([x()],Di.prototype,"farClipPlane",null);oo([x()],Di.prototype,"clearFlags",null);oo([x()],Di.prototype,"orthographic",void 0);oo([x()],Di.prototype,"orthographicSize",void 0);oo([x()],Di.prototype,"ARBackgroundAlpha",void 0);oo([x()],Di.prototype,"cullingMask",null);oo([x()],Di.prototype,"backgroundBlurriness",null);oo([x()],Di.prototype,"backgroundIntensity",null);oo([x()],Di.prototype,"environmentIntensity",null);oo([x(Ii)],Di.prototype,"backgroundColor",null);oo([x(id)],Di.prototype,"targetTexture",null);class vte{constructor(e){u(this,"_camera");u(this,"_skybox");this._camera=e}get context(){var e;return(e=this._camera)==null?void 0:e.context}enable(){this._skybox=this.context.lightmaps.tryGetSkybox(this._camera.sourceId),this._skybox?this.context.scene.background!==this._skybox&&(jc&&console.log(`Camera "${this._camera.name}" set skybox`,this._camera,this._skybox),this._skybox.colorSpace=zt,this._skybox.mapping=Oo,this.context.scene.background=this._skybox):(this._did_log_failed_to_find_skybox||(this._did_log_failed_to_find_skybox=!0,console.warn(`Camera "${this._camera.name}" failed to load/find skybox texture`,this._camera.sourceId,this.context.lightmaps,"Current background: ",this.context.scene.background)),(jc||Tt())&&gn(`Camera "${this._camera.name}" has no skybox texture`))}}function yte(n){re("freecam")&&n.context.mainCameraComponent===n&&le.getOrAddComponent(n.gameObject,$i)}class sd extends Te{constructor(){super(...arguments);u(this,"_listener",null)}get listener(){return this._listener==null&&(this._listener=new $2),this._listener}awake(){Ti.registerWaitForAllowAudio(()=>{if(this.destroyed)return;const t=this.listener;if(t==null||t.parent)return;const i=this.context.mainCameraComponent||le.getComponentInParent(this.gameObject,Di);i!=null&&i.cam?i.cam.add(t):this.gameObject.add(t)})}}var Bx=globalThis&&globalThis.__decorate||function(n,e,t,i){var s=arguments.length,r=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(e,t,r):o(e,t))||r);return s>3&&r&&Object.defineProperty(e,t,r),r};const bte=re("debugsignals");class Dx{constructor(){u(this,"guid")}}Bx([x()],Dx.prototype,"guid",void 0);class cv{constructor(){u(this,"signal");u(this,"reaction")}}Bx([x(Dx)],cv.prototype,"signal",void 0);Bx([x(Cs)],cv.prototype,"reaction",void 0);const Ga=class extends Te{constructor(){super(...arguments);u(this,"events")}static invoke(t){if(Ga.receivers[t]){const i=Ga.receivers[t];if(!i)return;for(const s of i)s.invoke(t)}}awake(){bte&&console.log("SignalReceiver awake",this)}onEnable(){if(this.events)for(const t of this.events)Ga.receivers[t.signal.guid]||(Ga.receivers[t.signal.guid]=[]),Ga.receivers[t.signal.guid].push(this)}onDisable(){if(this.events){for(const t of this.events)if(Ga.receivers[t.signal.guid]){const i=Ga.receivers[t.signal.guid].indexOf(this);i>=0&&Ga.receivers[t.signal.guid].splice(i,1)}}}invoke(t){if(!this.events||!Array.isArray(this.events))return;const i=typeof t=="object"?t.guid:t;for(const s of this.events)if(s.signal.guid===i)try{if(s.reaction){if(!s.reaction.invoke){console.warn("Missing invoke - possibly a serialization error",s,this);continue}}else{console.warn("Missing reaction for signal",s,this);continue}s.reaction.invoke()}catch(r){console.error(r)}}};let kh=Ga;u(kh,"receivers",{});Bx([x(cv)],kh.prototype,"events",void 0);var qr;(function(n){n.Activation="ActivationTrack",n.Animation="AnimationTrack",n.Audio="AudioTrack",n.Control="ControlTrack",n.Marker="MarkerTrack",n.Signal="SignalTrack"})(qr||(qr={}));var Fa;(function(n){n[n.None=0]="None",n[n.Hold=1]="Hold",n[n.Loop=2]="Loop",n[n.PingPong=3]="PingPong",n[n.Continue=4]="Continue"})(Fa||(Fa={}));var MT;(function(n){n.Signal="SignalEmitter"})(MT||(MT={}));const rc=re("debugtimeline");class Ox{constructor(){u(this,"director");u(this,"track")}get muted(){return this.track.muted}set muted(e){var t;e!==this.track.muted&&(this.track.muted=e,(t=this.onMuteChanged)==null||t.call(this))}*forEachClip(e=!1){var t;if((t=this.track)!=null&&t.clips)if(e)for(let i=this.track.clips.length-1;i>=0;i--)yield this.track.clips[i];else for(const i of this.track.clips)yield i}getClipTime(e,t){return t.clipIn+(e-t.start)*t.timeScale}getClipTimeNormalized(e,t){return(e-t.start)/t.duration}evaluateWeight(e,t,i,s=!0){if(t<0||t>=i.length)return 0;const r=i[t];if(s||e>=r.start&&e<=r.end){let o=1;const a=!1;if(r.easeInDuration>0){const c=Math.min((e-r.start)/r.easeInDuration,1);o*=c}if(r.easeOutDuration>0&&!a){const c=Math.min((r.end-e)/r.easeOutDuration,1);o*=c}return o}return 0}}class _te{constructor(e){u(this,"clip");u(this,"rootPositionOffset");u(this,"rootQuaternionOffset");u(this,"rootStartPosition");u(this,"rootEndPosition");u(this,"rootStartQuaternion");u(this,"rootEndQuaternion");const t=e.getClip();this.clip=t;const i=e.getRoot(),s=i.name+".position",r=i.name+".quaternion";rc&&console.log(t.name,t.tracks,s);for(const o of t.tracks)if(!(o.times.length<=0)){if(o.name.endsWith(s))this.rootStartPosition=new w().fromArray(o.values,0),this.rootEndPosition=new w().fromArray(o.values,o.values.length-3),this.rootPositionOffset=this.rootEndPosition.clone().sub(this.rootStartPosition),rc&&console.log(this.rootPositionOffset);else if(o.name.endsWith(r)&&(this.rootStartQuaternion=new Me().fromArray(o.values,0),this.rootEndQuaternion=new Me().fromArray(o.values,o.values.length-4),this.rootQuaternionOffset=this.rootEndQuaternion.clone().multiply(this.rootStartQuaternion),rc)){const a=new ws().setFromQuaternion(this.rootQuaternionOffset);console.log("ROT",a)}}}get hasOffsets(){return this.rootPositionOffset!==void 0||this.rootQuaternionOffset!==void 0}}class fI extends Ox{constructor(){super(...arguments);u(this,"models",[]);u(this,"trackOffset");u(this,"target");u(this,"mixer");u(this,"clips",[]);u(this,"actions",[]);u(this,"_actionOffsets",[]);u(this,"_didBind",!1);u(this,"_animator",null);u(this,"_useclipOffsets",!0);u(this,"_totalOffsetPosition",new w);u(this,"_totalOffsetRotation",new Me);u(this,"_totalOffsetPosition2",new w);u(this,"_totalOffsetRotation2",new Me);u(this,"_summedPos",new w);u(this,"_tempPos",new w);u(this,"_summedRot",new Me);u(this,"_tempRot",new Me);u(this,"_clipRotQuat",new Me)}onStateChanged(){this._animator&&LO(this._animator.gameObject,this,this.director.isPlaying)}createHooks(t,i){var h,d;if(((h=i.tracks)==null?void 0:h.length)<=0){console.warn("No tracks in AnimationClip",i);return}const s=i.tracks[0].name.split("."),r=s[s.length-2],o=r+".position",a=r+".quaternion";let c=!1,l=!1;for(const f of i.tracks)f.name.endsWith(o)?(c=!0,this.createPositionInterpolant(i,t,f)):f.name.endsWith(a)&&(l=!0,this.createRotationInterpolant(i,t,f));if(!c||!l){const f=(d=this.mixer)==null?void 0:d.getRoot(),p=i.tracks[0],m=p.name.lastIndexOf("."),g=p.name.substring(0,m),y=g.substring(g.lastIndexOf(".")+1),A=f.getObjectByName(y);if(A)if(c){if(!l){const v=i.tracks[0].name.substring(0,m)+".quaternion";rc&&console.warn("Create quaternion track",y,A);const b=A.quaternion,_=new xl(v,[0,i.duration],[b.x,b.y,b.z,b.w,b.x,b.y,b.z,b.w]);i.tracks.push(_),this.createRotationInterpolant(i,t,_)}}else{const v=g+".position";rc&&console.warn("Create position track",y,A);const b=A.position,_=new Vh(v,[0,i.duration],[b.x,b.y,b.z,b.x,b.y,b.z]);i.tracks.push(_),this.createPositionInterpolant(i,t,_)}}}bind(){if(!this._didBind){this._didBind=!0,rc&&console.log(this.models),this.mixer?this.target=this.mixer.getRoot():console.warn("No mixer was assigned to animation track");for(const t of this.actions){const i=new _te(t);this._actionOffsets.push(i)}this.target&&(this._animator=le.getComponent(this.target,Xs)??null,this._animator&&LO(this._animator.gameObject,this,!0));for(const t of this.models){const i=t.asset,s=i.position,r=i.rotation;s&&s.x!==void 0&&(s.isVector3||(i.position=new w(s.x,s.y,s.z)),r.isQuaternion||(i.rotation=new Me(r.x,r.y,r.z,r.w)))}this.ensureTrackOffsets()}}ensureTrackOffsets(){if(this.trackOffset){const t=this.trackOffset.position;t&&(t.isVector3||(this.trackOffset.position=new w(t.x,t.y,t.z)));const i=this.trackOffset.rotation;i&&(i.isQuaternion||(this.trackOffset.rotation=new Me(i.x,i.y,i.z,i.w)))}}evaluate(t){var c,l,h,d,f,p,m;if(this.track.muted||!this.mixer)return;this.bind(),this._totalOffsetPosition.set(0,0,0),this._totalOffsetRotation.set(0,0,0,1),this._totalOffsetPosition2.set(0,0,0),this._totalOffsetRotation2.set(0,0,0,1);let i=0,s=0,r=!1,o=!1,a=0;for(let g=0;g<this.clips.length;g++){const y=this.models[g],A=this.actions[g],v=y.asset;A.weight=0;const b=t>=y.start&&t<=y.end,_=y.preExtrapolationMode,T=y.postExtrapolationMode,E=g<this.clips.length-1?this.models[g+1]:null;let M=b,I=!1;if(!M&&!r&&y.end<t&&T!==Fa.None?(!E||E.start>t)&&(M=!0,r=!0):g==0&&!M&&!o&&y.start>t&&_!==Fa.None&&(!E||E.start<t)&&(M=!0,I=!0,o=!0),M){let S=1;S*=this.evaluateWeight(t,g,this.models,M),S*=this.director.weight;let C=b;if(I)switch(_){case Fa.Hold:break;case Fa.Loop:t+=y.start,C=!0;break;default:t+=y.start,C=!0;break}let D=this.getClipTime(t,y),G=0;const Q=v.duration;if(I&&_===Fa.Hold&&(D=0),C){if(v.loop)for(G+=Math.floor(D/(Q+1e-6));D>Q;)D-=Q}else if(!b&&r)switch(T){case Fa.Hold:D=this.getClipTime(y.end,y);break;case Fa.Loop:D%=Q;break;case Fa.PingPong:const O=Math.floor(D/Q)%2!==0;D%=Q,O&&(D=Q-D);break}y.reversed===!0?A.time=A.getClip().duration-D:A.time=D,A.timeScale=0;const L=Math.max(0,S);if(A.weight=L,a+=L,A.clampWhenFinished=!1,A.isRunning()||A.play(),this._useclipOffsets){const V=i==0?this._totalOffsetPosition:this._totalOffsetPosition2,O=i==0?this._totalOffsetRotation:this._totalOffsetRotation2;i<1&&(s=1-S),i+=1;const U=this._summedPos.set(0,0,0),H=this._tempPos.set(0,0,0),Y=this._summedRot.identity(),J=this._tempRot.identity(),se=v.rotation;se&&(this._clipRotQuat.identity(),this._clipRotQuat.slerp(se,S));const fe=this._actionOffsets[g];if(fe.hasOffsets)for(let _e=0;_e<G;_e++)fe.rootPositionOffset?H.copy(fe.rootPositionOffset):H.set(0,0,0),H.applyQuaternion(Y),this._clipRotQuat&&H.applyQuaternion(this._clipRotQuat),fe.rootQuaternionOffset&&(J.copy(fe.rootQuaternionOffset),Y.multiply(J)),U.add(H);this._clipRotQuat&&O.multiply(this._clipRotQuat),O.multiply(Y),v.position&&U.add(v.position),V.add(U)}}}if(this._useclipOffsets&&(this._totalOffsetPosition.lerp(this._totalOffsetPosition2,s),this._totalOffsetRotation.slerp(this._totalOffsetRotation2,s)),this.__mixerError===void 0&&(rc||Tt())&&((l=(c=this._animator)==null?void 0:c.runtimeAnimatorController)!=null&&l.mixer)&&this.mixer!==((d=(h=this._animator)==null?void 0:h.runtimeAnimatorController)==null?void 0:d.mixer)&&(this.__mixerError=!0,console.error("AnimationTrack mixer is not shared with the animator controller - this might result in the timeline to not animate properly. Please report a bug to the Needle Engine team!",this)),(f=this._animator)!=null&&f.runtimeAnimatorController){const g=Math.max(0,1-a);(m=(p=this._animator)==null?void 0:p.runtimeAnimatorController)==null||m.update(g)}else this.mixer.update(t)}createRotationInterpolant(t,i,s){var c;const r=s.createInterpolant.bind(s),o=new Me;this.ensureTrackOffsets();const a=(c=this.trackOffset)==null?void 0:c.rotation;s.createInterpolant=()=>{const l=r(),h=l.evaluate.bind(l);return l.evaluate=d=>{var p;const f=h(d);if(o.set(f[0],f[1],f[2],f[3]),o.premultiply(this._totalOffsetRotation),a&&o.premultiply(a),this.director.animationCallbackReceivers)for(const m of this.director.animationCallbackReceivers)(p=m==null?void 0:m.onTimelineRotation)==null||p.call(m,this.director,this.target,d,o);return f[0]=o.x,f[1]=o.y,f[2]=o.z,f[3]=o.w,f},l}}createPositionInterpolant(t,i,s){var h,d;const r=s.createInterpolant.bind(s),o=new w;this.ensureTrackOffsets();const a=(h=this.trackOffset)==null?void 0:h.rotation,c=(d=this.trackOffset)==null?void 0:d.position;let l;s.createInterpolant=()=>{const f=r(),p=f.evaluate.bind(f);return f.evaluate=m=>{var y,A,v;const g=p(m);if(o.set(g[0],g[1],g[2]),i.removeStartOffset&&(l===void 0?(l=null,l=(A=(y=this._actionOffsets.find(b=>b.clip===t))==null?void 0:y.rootStartPosition)==null?void 0:A.clone()):l!=null&&l.isVector3&&o.sub(l)),o.applyQuaternion(this._totalOffsetRotation),o.add(this._totalOffsetPosition),a&&o.applyQuaternion(a),c&&(o.x-=c.x,o.y+=c.y,o.z+=c.z),this.director.animationCallbackReceivers)for(const b of this.director.animationCallbackReceivers)(v=b==null?void 0:b.onTimelinePosition)==null||v.call(b,this.director,this.target,m,o);return g[0]=o.x,g[1]=o.y,g[2]=o.z,g},f}}}const xte=re("mutetimeline"),Xf=class extends Ox{constructor(){super(...arguments);u(this,"models",[]);u(this,"listener");u(this,"audio",[]);u(this,"audioContextTimeOffset",[]);u(this,"lastTime",0);u(this,"audioSource");u(this,"_audioLoader",null);u(this,"_playableDirectorResumed",!1)}getAudioFilePath(t){const i=this.director.sourceId;return Bp(i,t)}onAllowAudioChanged(t){for(let i=0;i<this.models.length;i++){const s=this.models[i];this.audio[i].setVolume(t?s.asset.volume:0)}}addModel(t){const i=new XM(this.listener);this.audio.push(i);const s=t;s._didTriggerPlay=!1,this.models.push(s)}onDisable(){for(const t of this.audio)t.isPlaying&&t.stop();for(const t of this.models)t._didTriggerPlay=!1}onDestroy(){for(const t of this.audio)t.source&&(t==null||t.disconnect());this.audio.length=0}onMuteChanged(){if(this.muted)for(let t=0;t<this.audio.length;t++){const i=this.audio[t];i!=null&&i.isPlaying&&i.stop()}}stop(){for(let t=0;t<this.audio.length;t++){const i=this.audio[t];i!=null&&i.isPlaying&&i.stop()}for(const t of this.models)t._didTriggerPlay=!1}onPauseChanged(){for(let t=0;t<this.audio.length;t++){const i=this.audio[t];i!=null&&i.isPlaying&&i.stop()}this._playableDirectorResumed=this.director.isPlaying}evaluate(t){if(xte||this.track.muted||this.director.speed<0)return;const i=this.director.context.application.muted,s=this._playableDirectorResumed;this._playableDirectorResumed=!1;const r=i?.1:0;for(let o=0;o<this.models.length;o++){const a=this.models[o],c=this.audio[o],l=a.asset;if((!c||!c.buffer)&&this.isInTimeRange(a,t-1,t+1)&&this.handleAudioLoading(a,c),Ti.userInteractionRegistered!==!1&&!(c===null||!c.buffer))if(c.playbackRate=this.director.context.time.timeScale*this.director.speed,c.loop=l.loop,t>=a.start&&t<=a.end&&t<this.director.duration){if(!c.isPlaying||!this.director.isPlaying)(s||!a._didTriggerPlay&&this.lastTime<t)&&(a.duration*a.timeScale>.3?c.offset=a.clipIn+(t-a.start)*a.timeScale:c.offset=0,rc&&console.log("Timeline Audio ("+this.track.name+") play with offset "+c.offset+" - "+a.asset.clip),c.play(r),a._didTriggerPlay=!0);else{const d=a.clipIn+(t-a.start)*a.timeScale,f=c.context.currentTime-c._startedAt+c.offset;Math.abs(d-f)>.3&&(c.offset=d,c.stop(),c.play(r))}let h=l.volume;if(this.track.volume!==void 0&&(h*=this.track.volume),i&&(h=0),a.easeInDuration>0){const d=Math.min((t-a.start)/a.easeInDuration,1);h*=d}if(a.easeOutDuration>0){const d=Math.min((a.end-t)/a.easeOutDuration,1);h*=d}c.setVolume(h*this.director.weight)}else a._didTriggerPlay=!1,this.director.isPlaying&&c.isPlaying&&c.stop()}this.lastTime=t}loadAudio(t,i=0,s=0){let r=null;const o=t-s,a=t+i;for(const c of this.models)if(this.isInTimeRange(c,o,a)){const l=this.audio[this.models.indexOf(c)],h=this.handleAudioLoading(c,l);h!==null&&(r===null&&(r=[]),r.push(h))}return r!==null?Promise.all(r):null}isInTimeRange(t,i,s){return i<=t.start&&s>=t.end||i>=t.start&&i<=t.end||s>=t.start&&s<=t.end}static dispose(){Xf._audioBuffers.clear()}handleAudioLoading(t,i){this._audioLoader||(this._audioLoader=new ub);const s=this.getAudioFilePath(t.asset.clip);if(Xf._audioBuffers.get(s)){const o=Xf._audioBuffers.get(s);return o.then(a=>{a&&i.setBuffer(a)}),o}rc&&console.warn("LOAD audio track",s,this.director.sourceId);const r=new Promise((o,a)=>{this._audioLoader.load(s,c=>{i.setBuffer(c),o(c)},void 0,c=>{console.error("Error loading audio",c),o(null)})});return Xf._audioBuffers.set(s,r),r}};let np=Xf;u(np,"_audioBuffers",new Map);class jb extends Ox{constructor(){super(...arguments);u(this,"models",[]);u(this,"didTrigger",[]);u(this,"receivers",[])}evaluate(t){var s;if(this.track.muted)return;const i=this.director.context.time.deltaTime*1.5;for(let r=0;r<this.models.length;r++){const o=this.models[r],a=this.didTrigger[r],c=o.time-t;let l=!1;if(o.retroActive)l=c<=1e-6;else{const h=Math.abs(c);(h===0||h>=1e-5&&h<i)&&(l=!0)}if(l){if(!a)if(rc&&console.log("Trigger signal",t,o.time,o),this.didTrigger[r]=!0,((s=this.receivers)==null?void 0:s.length)<=0)kh.invoke(o.asset);else for(const h of this.receivers)h&&h.invoke(o.asset)}else o.emitOnce||(this.didTrigger[r]=!1)}}}class pI extends Ox{constructor(){super(...arguments);u(this,"models",[]);u(this,"timelines",[]);u(this,"_previousActiveModel",null)}resolveSourceObjects(t){for(let i=this.models.length-1;i>=0;i--){const r=this.models[i].asset;if(!r.sourceObject||typeof r.sourceObject!="object"){console.log("no source object, removing model",i,r),this.models.splice(i,1);continue}else{const o=le.getComponent(r.sourceObject,Lh);this.timelines.push(o),o&&r.updateDirector&&(o.playOnAwake=!1)}}}evaluate(t){var i;this._previousActiveModel=null;for(let s=0;s<this.models.length;s++){const r=this.models[s],o=r.asset;if(t>=r.start&&t<=r.end){this._previousActiveModel=r;const a=this.getClipTime(t,r);if(o.controlActivation){const c=o.sourceObject;c.visible=!0}if(o.updateDirector){const c=this.timelines[s];c&&(c.isPlaying&&c.pause(),c.time=a,c.evaluate())}}else{const a=(i=this._previousActiveModel)==null?void 0:i.asset;if(o.controlActivation){const c=o.sourceObject;(a==null?void 0:a.sourceObject)!==c&&(c.visible=!1)}}}}}const uf=re("debugtimeline");var Ff;(function(n){n[n.Hold=0]="Hold",n[n.Loop=1]="Loop",n[n.None=2]="None"})(Ff||(Ff={}));var kO;(function(n){n[n.None=0]="None",n[n.Hold=1]="Hold",n[n.Loop=2]="Loop",n[n.PingPong=3]="PingPong",n[n.Continue=4]="Continue"})(kO||(kO={}));const p_=class extends Te{constructor(){super(...arguments);u(this,"playableAsset");u(this,"playOnAwake");u(this,"extrapolationMode",Ff.Loop);u(this,"waitForAudio",!0);u(this,"_visibilityChangeEvt");u(this,"_clonedPlayableAsset",!1);u(this,"_speed",1);u(this,"_guidsMap");u(this,"_isPlaying",!1);u(this,"_internalUpdateRoutine");u(this,"_isPaused",!1);u(this,"_isStopping",!1);u(this,"_time",0);u(this,"_duration",0);u(this,"_weight",1);u(this,"_animationTracks",[]);u(this,"_audioTracks",[]);u(this,"_signalTracks",[]);u(this,"_controlTracks",[]);u(this,"_customTracks",[]);u(this,"_allTracks",[this._animationTracks,this._audioTracks,this._signalTracks,this._controlTracks,this._customTracks]);u(this,"animationCallbackReceivers",[])}static registerCreateTrack(t,i){this.createTrackFunctions[t]=i}get isPlaying(){return this._isPlaying}get isPaused(){return this._isPaused}get time(){return this._time}set time(t){typeof t=="number"&&!Number.isNaN(t)?this._time=t:(uf||zr())&&console.error("INVALID TIMELINE.TIME VALUE",t,this.name)}get duration(){return this._duration}set duration(t){this._duration=t}get weight(){return this._weight}set weight(t){this._weight=t}get speed(){return this._speed}set speed(t){this._speed=t}awake(){var t,i,s;uf&&console.log(this,(t=this.playableAsset)==null?void 0:t.tracks),this.rebuildGraph(),this.isValid()||console.warn("PlayableDirector is not valid",this.playableAsset,(i=this.playableAsset)==null?void 0:i.tracks,Array.isArray((s=this.playableAsset)==null?void 0:s.tracks),this)}onEnable(){var t,i,s;for(const r of this._audioTracks)(t=r.onEnable)==null||t.call(r);for(const r of this._customTracks)(i=r.onEnable)==null||i.call(r);for(const r of this._animationTracks)(s=r.onEnable)==null||s.call(r);this.playOnAwake&&this.play(),this._visibilityChangeEvt||(this._visibilityChangeEvt=()=>{switch(document.visibilityState){case"hidden":this.setAudioTracksAllowPlaying(!1);break;case"visible":this.setAudioTracksAllowPlaying(!0);break}}),window.addEventListener("visibilitychange",this._visibilityChangeEvt)}onDisable(){var t,i,s;this.stop();for(const r of this._audioTracks)(t=r.onDisable)==null||t.call(r);for(const r of this._customTracks)(i=r.onDisable)==null||i.call(r);for(const r of this._animationTracks)(s=r.onDisable)==null||s.call(r);this._visibilityChangeEvt&&window.removeEventListener("visibilitychange",this._visibilityChangeEvt)}onDestroy(){var t;for(const i of this._allTracks)for(const s of i)(t=s.onDestroy)==null||t.call(s)}rebuildGraph(){this.isValid()&&(this.resolveBindings(),this.updateTimelineDuration(),this.setupAndCreateTrackHandlers())}async play(){if(!this.isValid())return;const t=this._isPaused==!0;if(this._isPaused=!1,!this._isPlaying){if(this._isPlaying=!0,t&&this.invokePauseChangedMethodsOnTracks(),this.waitForAudio){const i=[];for(const s of this._audioTracks){const r=s.loadAudio(this._time,1,0);r&&i.push(r)}if(i.length>0&&(await Promise.all(i),!this._isPlaying))return;for(;this._audioTracks.length>0&&this._isPlaying&&!Ti.userInteractionRegistered&&this.waitForAudio;)await ha(200)}this.invokeStateChangedMethodsOnTracks(),this._internalUpdateRoutine=this.startCoroutine(this.internalUpdate(),jt.LateUpdate)}}pause(){this.isValid()&&(this._isPlaying=!1,!this._isPaused&&(this._isPaused=!0,this.internalEvaluate(),this.invokePauseChangedMethodsOnTracks(),this.invokeStateChangedMethodsOnTracks()))}stop(){this._isStopping=!0;for(const s of this._audioTracks)s.stop();const t=this._isPaused==!0,i=this._isPlaying;this._isPlaying&&(this._time=0,this._isPlaying=!1,this._isPaused=!1,this.internalEvaluate(),t&&this.invokePauseChangedMethodsOnTracks()),this._isPlaying=!1,this._isPaused=!1,t&&!i&&this.invokePauseChangedMethodsOnTracks(),i&&this.invokeStateChangedMethodsOnTracks(),this._internalUpdateRoutine&&this.stopCoroutine(this._internalUpdateRoutine),this._internalUpdateRoutine=null,this._isStopping=!1}evaluate(){this.internalEvaluate(!0)}isValid(){return this.playableAsset&&this.playableAsset.tracks&&Array.isArray(this.playableAsset.tracks)}*forEachTrack(){for(const t of this._allTracks)for(const i of t)yield i}get audioTracks(){return this._audioTracks}resolveGuids(t){this._guidsMap=t}invokePauseChangedMethodsOnTracks(){var t;for(const i of this.forEachTrack())(t=i.onPauseChanged)==null||t.call(i)}invokeStateChangedMethodsOnTracks(){var t;for(const i of this.forEachTrack())(t=i.onStateChanged)==null||t.call(i,this._isPlaying)}*internalUpdate(){for(;this._isPlaying&&this.activeAndEnabled;)!this._isPaused&&this._isPlaying&&(this._time+=this.context.time.deltaTime*this.speed,this.internalEvaluate()),yield}internalEvaluate(t=!1){if(!this.isValid())return;let i=this._time;switch(this.extrapolationMode){case Ff.Hold:this._speed>0?i=Math.min(i,this._duration):this._speed<0&&(i=Math.max(i,0)),this._time=i;break;case Ff.Loop:i%=this._duration,this._time=i;break;case Ff.None:if(i>this._duration){this.stop();return}break}const s=this._time;for(const r of this.playableAsset.tracks)if(!r.muted)switch(r.type){case qr.Activation:if(!t&&!this._isPlaying)continue;for(let o=0;o<r.outputs.length;o++){const a=r.outputs[o];if(typeof a=="object"){let c=!1;if(r.clips)for(const h of r.clips)h.start<=s&&s<=h.end&&(c=!0);const l=a;l.visible!==void 0&&l.visible!==c&&(l.visible=c,uf&&console.warn(this.name,"set ActivationTrack-"+o,l.name,c,s))}}break}if(!this._isStopping)for(const r of this._animationTracks)r.evaluate(s);for(const r of this._audioTracks)r.evaluate(s);for(const r of this._signalTracks)r.evaluate(s);for(const r of this._controlTracks)r.evaluate(s);for(const r of this._customTracks)r.evaluate(s)}resolveBindings(){if(this._clonedPlayableAsset||(this._clonedPlayableAsset=!0,this.playableAsset=tx(this.playableAsset)),!this.playableAsset||!this.playableAsset.tracks)return;const t=this.findRoot(this.gameObject);for(const i of this.playableAsset.tracks){for(let s=i.outputs.length-1;s>=0;s--){let r=i.outputs[s];if(typeof r=="string"){this._guidsMap&&this._guidsMap[r]&&(r=this._guidsMap[r]);const o=le.findByGuid(r,t);o===null||typeof o!="object"?(i.outputs.splice(s,1),console.warn("Failed to resolve binding",r,i.name,i.type)):(uf&&console.log("Resolved binding",r,"to",o),i.outputs[s]=o)}else if(r===null){if(i.outputs.splice(s,1),p_.createTrackFunctions[i.type])continue;i.type!==qr.Audio&&i.type!==qr.Control&&i.type!==qr.Marker&&i.type!==qr.Signal&&console.warn("Missing binding",r,i.name,i.type,this.name,this.playableAsset.name)}}if(i.type===qr.Control&&i.clips)for(let s=0;s<i.clips.length;s++){const r=i.clips[s];let o=r.asset.sourceObject;if(typeof o=="string"){this._guidsMap&&this._guidsMap[o]&&(o=this._guidsMap[o]);const a=le.findByGuid(o,t);a===null||typeof a!="object"?console.warn("Failed to resolve sourceObject binding",o,i.name,r):(uf&&console.log("Resolved binding",o,"to",a),r.asset.sourceObject=a)}}}}findRoot(t){return t.parent?this.findRoot(t.parent):t}updateTimelineDuration(){if(this._duration=0,!(!this.playableAsset||!this.playableAsset.tracks)){for(const t of this.playableAsset.tracks)if(t.muted!==!0){if(t.clips)for(const i of t.clips)i.end>this._duration&&(this._duration=i.end);if(t.markers)for(const i of t.markers)i.time>this._duration&&(this._duration=i.time+.001)}}}setupAndCreateTrackHandlers(){var i,s,r;if(this._animationTracks.length=0,this._audioTracks.length=0,this._signalTracks.length=0,!this.playableAsset)return;let t=le.findObjectOfType(sd,this.context);for(const o of this.playableAsset.tracks){const a=o.type,c=p_.createTrackFunctions[a];if(c!=null){const l=c(this,o);if(typeof l.evaluate=="function"){l.director=this,l.track=o,this._customTracks.push(l);continue}}if(o.type===qr.Animation){if(!o.clips||o.clips.length<=0){uf&&console.warn("Animation track has no clips",o);continue}for(let l=o.outputs.length-1;l>=0;l--){let h=o.outputs[l];if(h instanceof ge){const f=le.getOrAddComponent(h,Xs);f&&(h=f)}const d=(i=h==null?void 0:h.gameObject)==null?void 0:i.animations;if(d){const f=new fI;f.trackOffset=o.trackOffset,f.director=this,f.track=o;for(let p=0;p<o.clips.length;p++){const m=o.clips[p],g=m.asset;if(!g){console.error(`Timeline ${this.name}: clip #${p} on track "${o.name}" has no animation data`);continue}const y=g.clip;let A=y;if((typeof A=="string"||typeof A=="number")&&(A=d.find(b=>b.name===y)),!A){console.warn("Could not find animationClip for model",m,o.name,this.name,(s=this.playableAsset)==null?void 0:s.name);continue}h instanceof Xs&&h.runtimeAnimatorController&&(h.__internalDidAwakeAndStart||h.initializeRuntimeAnimatorController(),h.runtimeAnimatorController.mixer||h.runtimeAnimatorController.bind(h),f.mixer=h.runtimeAnimatorController.mixer),f.mixer||(f.mixer=new $_(h.gameObject)),f.clips.push(A),f.mixer.uncacheAction(A),f.createHooks(m.asset,A);const v=f.mixer.clipAction(A);f.actions.push(v),f.models.push(m)}this._animationTracks.push(f)}}}else if(o.type===qr.Audio){if(!o.clips||o.clips.length<=0)continue;const l=new np;l.director=this,l.track=o,l.audioSource=o.outputs.find(h=>h instanceof Ti),this._audioTracks.push(l),t||(t=(r=this.context.mainCameraComponent)==null?void 0:r.gameObject.addNewComponent(sd)),l.listener=t.listener;for(let h=0;h<o.clips.length;h++){const d=o.clips[h];l.addModel(d)}}else if(o.type===qr.Marker){const l=new jb;if(l.director=this,l.track=o,o.markers)for(const h of o.markers)switch(h.type){case MT.Signal:l.models.push(h),l.didTrigger.push(!1);break}if(l!==null&&l.models.length>0){const h=le.getComponent(this.gameObject,kh);h&&(l.receivers.push(h),this._signalTracks.push(l))}}else if(o.type===qr.Signal){const l=new jb;if(l.director=this,l.track=o,o.markers)for(const h of o.markers)l.models.push(h),l.didTrigger.push(!1);for(const h of o.outputs)l.receivers.push(h);this._signalTracks.push(l)}else if(o.type===qr.Control){const l=new pI;if(l.director=this,l.track=o,o.clips)for(const h of o.clips)l.models.push(h);l.resolveSourceObjects(this.context),this._controlTracks.push(l)}}}setAudioTracksAllowPlaying(t){for(const i of this._audioTracks)i.onAllowAudioChanged(t)}registerAnimationCallback(t){this.animationCallbackReceivers.push(t)}unregisterAnimationCallback(t){const i=this.animationCallbackReceivers.indexOf(t);i!==-1&&this.animationCallbackReceivers.splice(i,1)}};let Lh=p_;u(Lh,"createTrackFunctions",{});const W0=Symbol("objectIsAnimatedData");function LO(n,e,t){if(!n)return;if(n[W0]===void 0){if(!t)return;n[W0]=new Set}const i=n[W0];t?i.add(e):i.has(e)&&i.delete(e)}function wte(n){if(!n)return!1;const e=n[W0];return e!==void 0&&e.size>0}zi.registerCallback(Cn.ContextCreated,n=>{const e=n.context.domElement.getAttribute("autoplay");if(e!==void 0&&(e===""||e==="true")&&n.files)for(const t of n.files)le.foreachComponent(t.file.scene,s=>{if(s.enabled!==!1){if(s instanceof Uo&&s.playAutomatically||s instanceof Xs||s instanceof Lh&&s.playOnAwake===!0)return!0;if(s instanceof Uo)return s.playAutomatically=!0,!0;if(s instanceof Lh)return s.playOnAwake=!0,!0}},!0)!==!0&&Ste(t.file)});function Ste(n){if(!n||!n.animations)return;for(let t=0;t<n.animations.length;t++){const i=n.animations[t];if(!(!i.tracks||i.tracks.length<=0))for(const s in i.tracks){const r=i.tracks[s],o=r.__objectName??r.name.substring(0,r.name.indexOf("."));let a=n.scene.getObjectByName(o);if(!a&&(a=n.scene.getObjectByProperty("uuid",o),!a))continue;let c=e(a);c||(c=wd(n.scene,new Uo));const l=c.animations=c.animations||[];i.name_animator=c.name,l.indexOf(i)<0&&l.push(i)}}function e(t){var s;if(!t)return;const i=(s=t.userData)==null?void 0:s.components;if(i&&i.length>0)for(let r=0;r<i.length;r++){const o=i[r];if(o instanceof Xs||o instanceof Uo)return t}return e(t.parent)}}class fC{constructor(e,t,i,s){u(this,"_name");u(this,"_nameHash");u(this,"_normalizedTime");u(this,"_length");u(this,"_speed");this._name=e.name,this._nameHash=e.hash,this._normalizedTime=t,this._length=i,this._speed=s}get name(){return this._name}get nameHash(){return this._nameHash}get normalizedTime(){return this._normalizedTime}get length(){return this._length}get speed(){return this._speed}}function Cte(n,e){return{name:"",isLooping:!1,guid:(e==null?void 0:e.generateUUID())??Vn.generateUUID(),index:-1,clip:new Nr(n,1,[])}}var fh;(function(n){n[n.If=1]="If",n[n.IfNot=2]="IfNot",n[n.Greater=3]="Greater",n[n.Less=4]="Less",n[n.Equals=6]="Equals",n[n.NotEqual=7]="NotEqual"})(fh||(fh={}));var IT;(function(n){n[n.Float=1]="Float",n[n.Int=3]="Int",n[n.Bool=4]="Bool",n[n.Trigger=9]="Trigger"})(IT||(IT={}));const or=re("debuganimatorcontroller"),Ky=re("debugrootmotion");class ko{constructor(e){u(this,"normalizedStartOffset",0);u(this,"_speed",1);u(this,"animator");u(this,"model");u(this,"_mixer");u(this,"_activeState");u(this,"_activeStates",[]);u(this,"rootMotionHandler");this.model=e,or&&console.log(this)}static createFromClips(e,t={looping:!1,autoTransition:!0,transitionDuration:0}){const i=[];for(let o=0;o<e.length;o++){const a=e[o],c=[];if(t.autoTransition!==!1){const h=t.transitionDuration??0,d=h/a.duration;let f=o;(t.autoTransition===void 0||t.autoTransition===!0)&&(f=(o+1)%e.length),c.push({exitTime:1-d,offset:0,duration:h,hasExitTime:!0,destinationState:f,conditions:[]})}const l={name:a.name,hash:o,motion:{name:a.name,clip:a,isLooping:(t==null?void 0:t.looping)??!1},transitions:c,behaviours:[]};i.push(l)}const s={name:"AnimatorController",guid:new Ss(Date.now()).generateUUID(),parameters:[],layers:[{name:"Base Layer",stateMachine:{defaultState:0,states:i}}]};return new ko(s)}play(e,t=-1,i=Number.NEGATIVE_INFINITY,s=0){if(t<0)t=0;else if(t>=this.model.layers.length){console.warn("invalid layer");return}const o=this.model.layers[t].stateMachine;for(const a of o.states)if(a.name===e||a.hash===e){or&&console.log("transition to ",a),this.transitionTo(a,s,i);return}console.warn("Could not find "+e+" to play")}reset(){this.setStartTransition()}setBool(e,t){var s,r;const i=typeof e=="string"?"name":"hash";return(r=(s=this.model)==null?void 0:s.parameters)==null?void 0:r.filter(o=>o[i]===e).forEach(o=>o.value=t)}getBool(e){var i,s,r;const t=typeof e=="string"?"name":"hash";return((r=(s=(i=this.model)==null?void 0:i.parameters)==null?void 0:s.find(o=>o[t]===e))==null?void 0:r.value)??!1}setFloat(e,t){var r,o;const i=typeof e=="string"?"name":"hash",s=(o=(r=this.model)==null?void 0:r.parameters)==null?void 0:o.filter(a=>a[i]===e);return s.forEach(a=>a.value=t),(s==null?void 0:s.length)>0}getFloat(e){var i,s,r;const t=typeof e=="string"?"name":"hash";return((r=(s=(i=this.model)==null?void 0:i.parameters)==null?void 0:s.find(o=>o[t]===e))==null?void 0:r.value)??0}setInteger(e,t){var s,r;const i=typeof e=="string"?"name":"hash";return(r=(s=this.model)==null?void 0:s.parameters)==null?void 0:r.filter(o=>o[i]===e).forEach(o=>o.value=t)}getInteger(e){var i,s,r;const t=typeof e=="string"?"name":"hash";return((r=(s=(i=this.model)==null?void 0:i.parameters)==null?void 0:s.find(o=>o[t]===e))==null?void 0:r.value)??0}setTrigger(e){var i,s;or&&console.log("SET TRIGGER",e);const t=typeof e=="string"?"name":"hash";return(s=(i=this.model)==null?void 0:i.parameters)==null?void 0:s.filter(r=>r[t]===e).forEach(r=>r.value=!0)}resetTrigger(e){var i,s;const t=typeof e=="string"?"name":"hash";return(s=(i=this.model)==null?void 0:i.parameters)==null?void 0:s.filter(r=>r[t]===e).forEach(r=>r.value=!1)}getTrigger(e){var i,s,r;const t=typeof e=="string"?"name":"hash";return((r=(s=(i=this.model)==null?void 0:i.parameters)==null?void 0:s.find(o=>o[t]===e))==null?void 0:r.value)??!1}isInTransition(){return this._activeStates.length>1}setSpeed(e){this._speed=e}FindState(e){return this.findState(e)}findState(e){if(!e)return null;if(Array.isArray(this.model.layers)){for(const t of this.model.layers)for(const i of t.stateMachine.states)if(i.name===e||i.hash==e)return i}return null}get context(){var e;return(e=this.animator)==null?void 0:e.context}get mixer(){return this._mixer}bind(e){e?this.animator!==e&&(this.animator=e,this._mixer=new $_(this.animator.gameObject),this.createActions(this.animator)):console.error("AnimatorController.bind: animator is null")}clone(){if(typeof this.model=="string")return console.warn("AnimatorController has not been resolved, can not create model from string",this.model),null;or&&console.warn("AnimatorController clone()",this.model);const e=tx(this.model,(i,s,r)=>r==null?!0:!(r.type==="Object3D"||r.isObject3D===!0||iZ(r)||r.tracks!==void 0||r instanceof ko));return console.assert(e!==this.model),new ko(e)}update(e){var i,s;if(!this.animator)return;this.evaluateTransitions(),this.updateActiveStates(e);const t=this.animator.context.time.deltaTime;this.animator.applyRootMotion&&((i=this.rootMotionHandler)==null||i.onBeforeUpdate(e)),this._mixer.update(t),this.animator.applyRootMotion&&((s=this.rootMotionHandler)==null||s.onAfterUpdate(e))}get activeState(){return this._activeState}updateActiveStates(e){for(let t=0;t<this._activeStates.length;t++){const i=this._activeStates[t],s=i.motion;if(!s.action)this._activeStates.splice(t,1),t--;else{const r=s.action;r.weight=e,r.getEffectiveWeight()<=0&&!r.isRunning()&&(or&&console.debug("REMOVE",i.name,r.getEffectiveWeight(),r.isRunning(),r.isScheduled()),this._activeStates.splice(t,1),t--)}}}setStartTransition(){for(const e of this.model.layers){const t=e.stateMachine;t.defaultState===void 0&&(or&&console.warn("AnimatorController default state is undefined, will assign state 0 as default",e),t.defaultState=0);const i=t.states[t.defaultState];this.transitionTo(i,0,this.normalizedStartOffset)}}evaluateTransitions(){var r;let e=!1;if(!this._activeState){if(this.setStartTransition(),!this._activeState)return;e=!0}const t=this._activeState,i=t.motion.action;for(const o of t.transitions){if(!o.hasExitTime&&o.conditions.length<=0)continue;let a=!0;for(const c of o.conditions)if(!this.evaluateCondition(c)){a=!1;break}if(a)if(i){const c=t.motion.clip.duration,l=c<=0?1:Math.abs(i.time/c);let h=!1;if(o.hasExitTime?i.timeScale>0?h=l>=o.exitTime:i.timeScale<0&&(h=1-l>=o.exitTime):h=!0,h){for(const d of o.conditions){const f=this.model.parameters.find(p=>p.name===d.parameter);(f==null?void 0:f.type)===IT.Trigger&&f.value&&(f.value=!1)}i.clampWhenFinished=!0,or&&console.log("transition to "+o.destinationState,o,l,o.exitTime,o.hasExitTime),this.transitionTo(o.destinationState,o.duration,o.offset);return}}else{this.transitionTo(o.destinationState,o.duration,o.offset);return}}if(i){let o=t.speed??1;t.speedParameter&&(o*=this.getFloat(t.speedParameter)),o!==void 0&&(i.timeScale=o*this._speed)}let s=!1;if(t.motion.isLooping&&i&&(i.time>=i.getClip().duration?(s=!0,i.reset(),i.time=0,i.play()):i.time<=0&&i.timeScale<0&&(s=!0,i.reset(),i.time=i.getClip().duration,i.play())),!s&&t&&!e&&i&&this.animator&&t.behaviours){const o=i==null?void 0:i.getClip().duration,a=i.time/o,c=new fC(this._activeState,a,o,this._speed);for(const l of t.behaviours)l.instance&&((r=l.instance.onStateUpdate)==null||r.call(l.instance,this.animator,c,0))}}getState(e,t){return typeof e=="number"&&(e==-1&&(e=this.model.layers[t].stateMachine.defaultState,e===void 0&&(or&&console.warn("AnimatorController default state is undefined: ",this.model,"Layer: "+t),e=0)),e=this.model.layers[t].stateMachine.states[e]),e}transitionTo(e,t,i){var l,h,d,f,p,m,g,y;if(!this.animator)return;const s=0;if(e=this.getState(e,s),!(e!=null&&e.motion)||!e.motion.clip||!(e.motion.clip instanceof Nr))return;const r=this._activeState===e;if(r){const A=e.motion;if(!A.action_loopback&&A.clip){const v=this.rootMotionHandler?this.animator.gameObject.matrix.clone():null;this._mixer.uncacheAction(A.clip,this.animator.gameObject),v&&v.decompose(this.animator.gameObject.position,this.animator.gameObject.quaternion,this.animator.gameObject.scale),A.action_loopback=this.createAction(A.clip)}}if((l=this._activeState)!=null&&l.behaviours&&this._activeState.motion.action){const A=(h=this._activeState)==null?void 0:h.motion.clip.duration,v=this._activeState.motion.action.time/A,b=new fC(this._activeState,v,A,this._speed);for(const _ of this._activeState.behaviours)(f=(d=_.instance)==null?void 0:d.onStateExit)==null||f.call(_.instance,this.animator,b,s)}const o=(p=this._activeState)==null?void 0:p.motion.action;o&&o.fadeOut(t),r&&(e.motion.action=e.motion.action_loopback,e.motion.action_loopback=o);const a=this._activeState;this._activeState=e;const c=(m=e.motion)==null?void 0:m.action;if(c){if(i=Math.max(0,Math.min(1,i)),e.cycleOffsetParameter){let v=this.getFloat(e.cycleOffsetParameter);typeof v=="number"?(v<0&&(v+=1),i+=v,i%=1):or&&console.warn("AnimatorController cycle offset parameter is not a number",e.cycleOffsetParameter)}else typeof e.cycleOffset=="number"&&(i+=e.cycleOffset,i%=1);c.isRunning()&&c.stop(),c.reset(),c.enabled=!0;const A=e.motion.clip.duration;if(c.time=r?0:i*A,c.timeScale<0&&(c.time=A-c.time),c.clampWhenFinished=!0,c.setLoop(jg,0),t>0?c.fadeIn(t):c.weight=1,c.play(),this.rootMotionHandler&&this.rootMotionHandler.onStart(c),this._activeStates.includes(e)||this._activeStates.push(e),this._activeState.behaviours){const v=new fC(e,i,A,this._speed);for(const b of this._activeState.behaviours)(y=(g=b.instance)==null?void 0:g.onStateEnter)==null||y.call(b.instance,this.animator,v,s)}}else or&&(e.__warned_no_motion||(e.__warned_no_motion=!0,console.warn("No action",e.motion,this)));or&&console.log("TRANSITION FROM "+(a==null?void 0:a.name)+" TO "+e.name,t,o,c,c==null?void 0:c.getEffectiveTimeScale(),c==null?void 0:c.getEffectiveWeight(),c==null?void 0:c.isRunning(),c==null?void 0:c.isScheduled(),c==null?void 0:c.paused)}createAction(e){var i,s;if(this._mixer.existingAction(e)&&this._mixer.uncacheAction(e,(i=this.animator)==null?void 0:i.gameObject),(s=this.animator)!=null&&s.applyRootMotion){this.rootMotionHandler||(this.rootMotionHandler=new Ete(this));const r=this.animator.gameObject;return this.rootMotionHandler.createClip(this._mixer,r,e)}else return this._mixer.clipAction(e)}evaluateCondition(e){const t=this.model.parameters.find(i=>i.name===e.parameter);if(!t)return!1;switch(e.mode){case fh.If:return t.value===!0;case fh.IfNot:return t.value===!1;case fh.Greater:return t.value>e.threshold;case fh.Less:return t.value<e.threshold;case fh.Equals:return t.value===e.threshold;case fh.NotEqual:return t.value!==e.threshold}return!1}createActions(e){var t,i,s,r;or&&console.log("AnimatorController createActions",this.model);for(const o of this.model.layers){const a=o.stateMachine;for(let c=0;c<a.states.length;c++){const l=a.states[c];l.transitions||(l.transitions=[]);for(const h of l.transitions)h.conditions||(h.conditions=[]);if(l.motion||(l.motion=Cte(l.name)),this.animator&&l.motion.clips){const h=(t=l.motion.clips)==null?void 0:t.find(d=>{var f,p;return d.node.name===((p=(f=this.animator)==null?void 0:f.gameObject)==null?void 0:p.name)});h?l.motion.clip=h.clip:(or||Tt())&&console.warn('Could not find clip for animator "'+((s=(i=this.animator)==null?void 0:i.gameObject)==null?void 0:s.name)+'"',l.motion.clips.map(d=>d.node.name))}if(!l.motion.clip){const h=new Nr(void 0,void 0,[]);l.motion.clip=h}if((r=l.motion)!=null&&r.clip){const h=l.motion.clip;if(h instanceof Nr){const d=this.createAction(h);l.motion.action=d}else(or||Tt())&&console.warn("No valid animationclip assigned",l)}if(l.behaviours&&Array.isArray(l.behaviours))for(const h of l.behaviours){if(!(h!=null&&h.typeName))continue;const d=ee.get(h.typeName),f=new d;f.isStateMachineBehaviour&&(f._context=this.context??void 0,gp(f,h.properties),h.instance=f),or&&console.log("Created animator controller behaviour",l.name,h.typeName,h.properties,f)}}}}*enumerateActions(){if(this.model.layers)for(const e of this.model.layers){const t=e.stateMachine;for(let i=0;i<t.states.length;i++){const s=t.states[i];s!=null&&s.motion&&(s.motion.action&&(yield s.motion.action),s.motion.action_loopback&&(yield s.motion.action_loopback))}}}}class FO{constructor(e,t){u(this,"track");u(this,"createdInterpolant");u(this,"originalEvaluate");u(this,"customEvaluate");this.track=e;const i=e,s=i.createInterpolant.bind(e);i.createInterpolant=()=>(i.createInterpolant=s,this.createdInterpolant=s(),this.originalEvaluate=this.createdInterpolant.evaluate.bind(this.createdInterpolant),this.customEvaluate=r=>{if(!this.originalEvaluate)return;const o=this.originalEvaluate(r);return t(r,o)},this.createdInterpolant.evaluate=this.customEvaluate,this.createdInterpolant)}dispose(){this.createdInterpolant&&this.originalEvaluate&&(this.createdInterpolant.evaluate=this.originalEvaluate),this.track=void 0,this.createdInterpolant=null,this.originalEvaluate=void 0,this.customEvaluate=void 0}}const zn=class{constructor(e,t,i,s,r){u(this,"_action");u(this,"root");u(this,"clip");u(this,"positionWrapper",null);u(this,"rotationWrapper",null);u(this,"context");u(this,"positionChange",new w);u(this,"rotationChange",new Me);u(this,"_prevTime",0);if(this.context=e,this.root=t,this.clip=i,zn.firstKeyframeRotation[this.cacheId]||(zn.firstKeyframeRotation[this.cacheId]=new Me),r){const o=r.values;zn.firstKeyframeRotation[this.cacheId].set(o[0],o[1],o[2],o[3])}zn.spaceRotation[this.cacheId]||(zn.spaceRotation[this.cacheId]=new Me),zn.effectiveSpaceRotation[this.cacheId]||(zn.effectiveSpaceRotation[this.cacheId]=new Me),zn.clipOffsetRotation[this.cacheId]=new Me,r&&zn.clipOffsetRotation[this.cacheId].set(r.values[0],r.values[1],r.values[2],r.values[3]).invert(),this.handlePosition(i,s),this.handleRotation(i,r)}set action(e){this._action=e}get action(){return this._action}get cacheId(){return this.root.uuid}onStart(e){if(e.getClip()!==this.clip)return;zn.lastObjRotation[this.cacheId]||(zn.lastObjRotation[this.cacheId]=this.root.quaternion.clone());const t=zn.lastObjRotation[this.cacheId];if(zn.spaceRotation[this.cacheId].copy(t),Ky){const i=new ws().setFromQuaternion(t);console.log("START",this.clip.name,nt.toDegrees(i.y),this.root.position.z)}}getClipRotationOffset(){return zn.clipOffsetRotation[this.cacheId]}handlePosition(e,t){if(t){const i=this.root;Ky&&i.add(new Fo),zn.lastObjPosition[this.cacheId]||(zn.lastObjPosition[this.cacheId]=this.root.position.clone());const s=new w,r=new w;this.positionWrapper=new FO(t,(o,a)=>{const c=this.action.getEffectiveWeight();return Ky&&i.position.length()>8&&i.position.set(0,i.position.y,0),o>this._prevTime&&(s.set(a[0],a[1],a[2]),s.sub(r),s.multiplyScalar(c),s.applyQuaternion(this.getClipRotationOffset()),s.applyQuaternion(i.quaternion),this.positionChange.copy(s)),r.fromArray(a),this._prevTime=o,a[0]=0,a[1]=0,a[2]=0,a})}}handleRotation(e,t){if(t){if(Ky){const o=t.values,a=new ws().setFromQuaternion(new Me(o[0],o[1],o[2],o[3]));console.log(e.name,t.name,"FIRST ROTATION IN TRACK",nt.toDegrees(a.y));const c=t.values.length-4,l=new Me().set(o[c],o[c+1],o[c+2],o[c+3]),h=new ws().setFromQuaternion(l);console.log(e.name,t.name,"LAST ROTATION IN TRACK",nt.toDegrees(h.y))}let i=0;const s=new Me,r=new Me;this.rotationWrapper=new FO(t,(o,a)=>(o>i&&(r.set(a[0],a[1],a[2],a[3]),s.invert(),r.multiply(s),this.rotationChange.copy(r)),s.fromArray(a),i=o,a[0]=0,a[1]=0,a[2]=0,a[3]=1,a))}}onBeforeUpdate(e){this.positionChange.set(0,0,0),this.rotationChange.set(0,0,0,1)}onAfterUpdate(e){return!this.action||(e*=this.action.getEffectiveWeight(),e<=0)?!1:(this.positionChange.multiplyScalar(e),this.rotationChange.slerp(zn.identityQuaternion,1-e),!0)}};let Da=zn;u(Da,"lastObjPosition",{}),u(Da,"lastObjRotation",{}),u(Da,"firstKeyframeRotation",{}),u(Da,"spaceRotation",{}),u(Da,"effectiveSpaceRotation",{}),u(Da,"clipOffsetRotation",{}),u(Da,"identityQuaternion",new Me);class Ete{constructor(e){u(this,"controller");u(this,"handler",[]);u(this,"root");u(this,"basePosition",new w);u(this,"baseQuaternion",new Me);u(this,"baseRotation",new ws);u(this,"summedPosition",new w);u(this,"summedRotation",new Me);this.controller=e}createClip(e,t,i){this.root=t,t&&"name"in t&&t.name;const s=this.findRootTrack(i,".position"),r=this.findRootTrack(i,".quaternion"),o=new Da(this.controller.context,t,i,s,r);this.handler.push(o);const a=e.clipAction(i);return o.action=a,a}onStart(e){for(const t of this.handler)t.onStart(e)}onBeforeUpdate(e){this.basePosition.copy(this.root.position),this.baseQuaternion.copy(this.root.quaternion);for(const t of this.handler)t.onBeforeUpdate(e)}onAfterUpdate(e){if(!(e<=0)){this.root.position.copy(this.basePosition),this.root.quaternion.copy(this.baseQuaternion),this.summedPosition.set(0,0,0),this.summedRotation.set(0,0,0,1);for(const t of this.handler)t.onAfterUpdate(e)&&(this.summedPosition.add(t.positionChange),this.summedRotation.multiply(t.rotationChange));this.root.position.add(this.summedPosition),this.root.quaternion.multiply(this.summedRotation)}}findRootTrack(e,t){const i=e.tracks;if(!i)return null;for(const s of i)if(s.name.endsWith(t))return s;return null}}class Tte extends Bl{onSerialize(e,t){}onDeserialize(e,t){if(t.type===ko&&(e==null?void 0:e.__type)==="AnimatorController")return new ko(e)}}new Tte(ko);var kx=globalThis&&globalThis.__decorate||function(n,e,t,i){var s=arguments.length,r=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(e,t,r):o(e,t))||r);return s>3&&r&&Object.defineProperty(e,t,r),r};const vo=re("debuganimator");class Xs extends Te{constructor(){super(...arguments);u(this,"applyRootMotion",!1);u(this,"hasRootMotion",!1);u(this,"keepAnimatorControllerStateOnDisable",!1);u(this,"_parametersAreDirty",!1);u(this,"_isDirty",!1);u(this,"speed",1);u(this,"normalizedStartOffset",0);u(this,"_animatorController",null);u(this,"_initializeWithRuntimeAnimatorController")}set runtimeAnimatorController(t){var i;this._animatorController&&this._animatorController.model===t||(t?t instanceof ko?(t.animator&&t.animator!==this&&(console.warn("AnimatorController can not be bound to multiple animators",(i=t.model)==null?void 0:i.name),t.model||console.error("AnimatorController has no model"),t=new ko(t.model)),this._animatorController=t,this._animatorController.bind(this)):(vo&&console.log("Assign animator controller",t,this),this._animatorController=new ko(t),this.__didAwake&&this._animatorController.bind(this)):this._animatorController=null)}get runtimeAnimatorController(){return this._animatorController}get parametersAreDirty(){return this._parametersAreDirty}get isDirty(){return this._isDirty}Play(t,i=-1,s=Number.NEGATIVE_INFINITY,r=0){this.play(t,i,s,r)}play(t,i=-1,s=Number.NEGATIVE_INFINITY,r=0){var o;(o=this.runtimeAnimatorController)==null||o.play(t,i,s,r),this._isDirty=!0}Reset(){this.reset()}reset(){var t;(t=this._animatorController)==null||t.reset(),this._isDirty=!0}SetBool(t,i){this.setBool(t,i)}setBool(t,i){var s,r;vo&&console.log("setBool",t,i),((s=this.runtimeAnimatorController)==null?void 0:s.getBool(t))!==i&&(this._parametersAreDirty=!0),(r=this.runtimeAnimatorController)==null||r.setBool(t,i)}GetBool(t){return this.getBool(t)}getBool(t){var s;const i=((s=this.runtimeAnimatorController)==null?void 0:s.getBool(t))??!1;return vo&&console.log("getBool",t,i),i}toggleBool(t){this.setBool(t,!this.getBool(t))}SetFloat(t,i){this.setFloat(t,i)}setFloat(t,i){var s,r;((s=this.runtimeAnimatorController)==null?void 0:s.getFloat(t))!==i&&(this._parametersAreDirty=!0),vo&&console.log("setFloat",t,i),(r=this.runtimeAnimatorController)==null||r.setFloat(t,i)}GetFloat(t){return this.getFloat(t)}getFloat(t){var s;const i=((s=this.runtimeAnimatorController)==null?void 0:s.getFloat(t))??-1;return vo&&console.log("getFloat",t,i),i}SetInteger(t,i){this.setInteger(t,i)}setInteger(t,i){var s,r;((s=this.runtimeAnimatorController)==null?void 0:s.getInteger(t))!==i&&(this._parametersAreDirty=!0),vo&&console.log("setInteger",t,i),(r=this.runtimeAnimatorController)==null||r.setInteger(t,i)}GetInteger(t){return this.getInteger(t)}getInteger(t){var s;const i=((s=this.runtimeAnimatorController)==null?void 0:s.getInteger(t))??-1;return vo&&console.log("getInteger",t,i),i}SetTrigger(t){this.setTrigger(t)}setTrigger(t){var i;this._parametersAreDirty=!0,vo&&console.log("setTrigger",t),(i=this.runtimeAnimatorController)==null||i.setTrigger(t)}ResetTrigger(t){this.resetTrigger(t)}resetTrigger(t){var i;this._parametersAreDirty=!0,vo&&console.log("resetTrigger",t),(i=this.runtimeAnimatorController)==null||i.resetTrigger(t)}GetTrigger(t){this.getTrigger(t)}getTrigger(t){var s;const i=(s=this.runtimeAnimatorController)==null?void 0:s.getTrigger(t);return vo&&console.log("getTrigger",t,i),i}IsInTransition(){return this.isInTransition()}isInTransition(){var t;return((t=this.runtimeAnimatorController)==null?void 0:t.isInTransition())??!1}SetSpeed(t){return this.setSpeed(t)}setSpeed(t){var i;t!==this.speed&&(vo&&console.log("setSpeed",t),this.speed=t,(i=this._animatorController)==null||i.setSpeed(t))}set minMaxSpeed(t){this.speed=nt.lerp(t.x,t.y,Math.random())}set minMaxOffsetNormalized(t){this.normalizedStartOffset=nt.lerp(t.x,t.y,Math.random()),this.runtimeAnimatorController&&(this.runtimeAnimatorController.normalizedStartOffset=this.normalizedStartOffset)}awake(){vo&&console.log("ANIMATOR",this.name,this),this.gameObject&&this.initializeRuntimeAnimatorController()}initializeRuntimeAnimatorController(t=!1){const i=t||this.runtimeAnimatorController!==this._initializeWithRuntimeAnimatorController;if(this.runtimeAnimatorController&&i){const s=this.runtimeAnimatorController.clone();this._initializeWithRuntimeAnimatorController=s,s?(console.assert(this.runtimeAnimatorController!==s),this.runtimeAnimatorController=s,console.assert(this.runtimeAnimatorController===s),this.runtimeAnimatorController.bind(this),this.runtimeAnimatorController.setSpeed(this.speed),this.runtimeAnimatorController.normalizedStartOffset=this.normalizedStartOffset):console.warn("Could not clone animator controller",this.runtimeAnimatorController)}}onDisable(){var t;this.keepAnimatorControllerStateOnDisable||(t=this._animatorController)==null||t.reset()}onBeforeRender(){this._isDirty=!1,this._parametersAreDirty=!1,!wte(this.gameObject)&&this._animatorController&&this._animatorController.update(1)}}kx([x()],Xs.prototype,"applyRootMotion",void 0);kx([x()],Xs.prototype,"hasRootMotion",void 0);kx([x()],Xs.prototype,"keepAnimatorControllerStateOnDisable",void 0);kx([x()],Xs.prototype,"runtimeAnimatorController",null);const sp=re("debugusdzanimation"),RT=re("debugusdzanimationserialization");class mI{constructor(e,t,i){u(this,"_start");u(this,"ext");u(this,"root");u(this,"clip");this.ext=e,this.root=t,this.clip=i}get start(){return this._start===void 0&&(this._start=this.ext.getStartTime01(this.root,this.clip)),this._start}get duration(){return this.clip.duration}}class oa{constructor(e,t,i){u(this,"clip");u(this,"pos");u(this,"rot");u(this,"scale");u(this,"root");u(this,"target");u(this,"duration",0);u(this,"useRootMotion",!1);this.root=e,this.target=t,this.clip=i,i?this.duration=i.duration:this.duration=1/this.frameRate;const s=le.getComponent(e,Xs);s&&(this.useRootMotion=s.applyRootMotion)}get frameRate(){return 60}addTrack(e){if(!this.clip){console.error("This is a rest clip but you're trying to add tracks to it  this is likely a bug");return}e.name.endsWith("position")&&(this.pos=e),e.name.endsWith("quaternion")&&(this.rot=e),e.name.endsWith("scale")&&(this.scale=e)}getFrames(){var e,t,i,s,r,o;return this.clip?Math.max(((t=(e=this.pos)==null?void 0:e.times)==null?void 0:t.length)??0,((s=(i=this.rot)==null?void 0:i.times)==null?void 0:s.length)??0,((o=(r=this.scale)==null?void 0:r.times)==null?void 0:o.length)??0):2}getDuration(){return this.duration}getSortedTimesArray(e=!0,t=!0,i=!0){var c,l,h;if(!this.clip)return[0,this.duration];const s=(c=this.pos)==null?void 0:c.times,r=(l=this.rot)==null?void 0:l.times,o=(h=this.scale)==null?void 0:h.times,a=[];if(e&&s)for(const d of s)a.push(d);if(t&&r)for(const d of r)a.push(d);if(i&&o)for(const d of o)a.push(d);return a.includes(0)||a.push(0),a.sort((d,f)=>d-f),[...new Set(a)]}*getValues(e,t=!0,i=!0,s=!0){var f,p,m;const r=new w,o=new Me,a=new w(1,1,1),c=this.target,l=t?(f=this.pos)==null?void 0:f.createInterpolant():void 0,h=i?(p=this.rot)==null?void 0:p.createInterpolant():void 0,d=s?(m=this.scale)==null?void 0:m.createInterpolant():void 0;l||r.set(c.position.x,c.position.y,c.position.z),h||o.set(c.quaternion.x,c.quaternion.y,c.quaternion.z,c.quaternion.w),d||a.set(c.scale.x,c.scale.y,c.scale.z);for(let g=0;g<e.length;g++){const y=e[g];if(l){const A=l.evaluate(y);r.set(A[0],A[1],A[2])}if(h){const A=h.evaluate(y);o.set(A[0],A[1],A[2],A[3])}if(d){const A=d.evaluate(y);a.set(A[0],A[1],A[2])}if(this.useRootMotion&&c===this.root){const A=new Ce;A.compose(r,o,a),A.multiply(c.matrix),A.decompose(r,o,a)}yield{time:y,translation:r,rotation:o,scale:a,index:g}}}}u(oa,"animationDurationPadding",1);class Lx{constructor(e){u(this,"dict",new Map);u(this,"rootTargetMap",new Map);u(this,"rootAndClipToRegisteredAnimationMap",new Map);u(this,"rootToRegisteredClipCount",new Map);u(this,"serializers",[]);u(this,"injectRestPoses",!1);u(this,"injectImplicitBehaviours",!1);this.injectRestPoses=e,this.injectImplicitBehaviours=e}get extensionName(){return"animation"}getClipCount(e){let t=this.rootToRegisteredClipCount.get(e);return this.injectRestPoses&&(t=t?t-1:0),t??0}getStartTime01(e,t){const i=this.rootTargetMap.get(e);if(!i)return 0;const s=this.dict.get(i[0]);if(!s)return console.error("Trying to get start time for root that has no animation data",e,t,...this.dict),0;let r=0;for(let o=0;o<s.length&&s[o].clip!==t;o++)r+=s[o].getDuration()+oa.animationDurationPadding;return r}registerAnimation(e,t){if(!t||!e)return null;this.rootTargetMap.has(e)||this.rootTargetMap.set(e,[]);const i=e.uuid+t.uuid;if(this.rootAndClipToRegisteredAnimationMap.has(i))return this.rootAndClipToRegisteredAnimationMap.get(i);sp&&console.log("registerAnimation",e,t);const s=this.injectRestPoses?1:0,r=this.rootToRegisteredClipCount.get(e)??s,o=this.rootTargetMap.get(e),a=new Set(o);if(t.tracks)for(const l of t.tracks){const h=qt.parseTrackName(l.name),d=qt.findNode(e,h.nodeName);if(!d){console.warn("no object found for track",l.name,"using "+e.name+" instead");continue}this.dict.has(d)||this.dict.set(d,[]);const f=this.dict.get(d);if(!f)continue;if(a.delete(d),this.injectRestPoses&&!f[0]){const m=new oa(null,d,void 0);f[0]=m}let p=f[r];p||(p=new oa(e,d,t),f[r]=p),p.addTrack(l),o!=null&&o.includes(d)||o==null||o.push(d)}for(const l of a){const h=this.dict.get(l);if(!h)continue;if(this.injectRestPoses&&!h[0]){const f=new oa(null,l,void 0);h[0]=f}let d=h[r];d||(sp&&console.log("Adding padding clip for ",l,t),d=new oa(e,l,t),h[r]=d)}const c=new mI(this,e,t);return this.rootAndClipToRegisteredAnimationMap.set(i,c),this.rootToRegisteredClipCount.set(e,r+1),c}onAfterHierarchy(e){sp&&console.log("Animation clips per animation target node",this.dict)}onAfterBuildDocument(e){var t,i;for(const s of this.serializers){const r=(t=s.model)==null?void 0:t.parent,o=(r==null?void 0:r.isDynamic)===!0;RT&&console.log(o,(i=s.model)==null?void 0:i.parent),o&&s.registerCallback(r)}}onExportObject(e,t,i){le.foreachComponent(e,r=>{const o=r;typeof o.createAnimation=="function"&&o.createAnimation(this,t,i)},!1);const s=new Mte(e,this.dict);this.serializers.push(s),s.registerCallback(t)}}class Mte{constructor(e,t){u(this,"object");u(this,"dict");u(this,"model");u(this,"callback");this.object=e,this.dict=t}registerCallback(e){this.model&&this.callback&&this.model.removeEventListener("serialize",this.callback),this.callback||(this.callback=this.onSerialize.bind(this)),RT&&console.log("REPARENT",e),this.model=e,this.model.addEventListener("serialize",this.callback)}skinnedMeshExport(e,t){const i=this.model,s=this.dict;if(i&&i.skinnedMesh){let c=function(M){const I=[];for(const[S,C]of M){let D=`${S} : [`;const G=[];for(const Q of C)G.push(`(${Zn(Q.x)}, ${Zn(Q.y)}, ${Zn(Q.z)})`);D=D.concat(G.join(", ")),D=D.concat("],"),I.push(D)}return I},l=function(M){const I=[];for(const[S,C]of M){let D=`${S} : [`;const G=[];for(const Q of C)G.push(`(${Zn(Q.w)}, ${Zn(Q.x)}, ${Zn(Q.y)}, ${Zn(Q.z)})`);D=D.concat(G.join(", ")),D=D.concat("],"),I.push(D)}return I},h=function(M){let I=!0,S;for(const[D,G]of M)if(S===void 0&&(S=G.length),S!==G.length){I=!1;break}sp&&console.log("Bone count: ",M.size,"TransformData entries per bone: ",S),console.assert(I,"All bones should have the same number of TransformData entries",M);const C=[];for(const[D,G]of M){const Q=new Array;let L=0;for(let V=0;V<G.length;V++)Q.push(L),L+=G[V].getDuration()+oa.animationDurationPadding;for(let V=0;V<G.length;V++){const O=G[V],U=Q[V];C.length<=V&&C.push({pos:[],rot:[],scale:[],timeOffset:U});const H=C[V];H.pos.push(...O.getSortedTimesArray(!0,!1,!1)),H.rot.push(...O.getSortedTimesArray(!1,!0,!1)),H.scale.push(...O.getSortedTimesArray(!1,!1,!0))}}for(const D of C)D.pos.sort((G,Q)=>G-Q),D.rot.sort((G,Q)=>G-Q),D.scale.sort((G,Q)=>G-Q),D.pos=[...new Set(D.pos)],D.rot=[...new Set(D.rot)],D.scale=[...new Set(D.scale)];return C},d=function(M,I,S){const C=new Map,D=new Map,G=new Map,Q=I.length;for(const L of S){const V=M.get(L);let O;V?console.assert(V.length===Q,"We should have the same number of TransformData entries for each bone",V,I):O=new oa(null,L,void 0);for(let U=0;U<Q;U++){const H=V?V[U]:O,Y=I[U];for(const{time:J,translation:se}of H.getValues(Y.pos,!0,!1,!1)){const _e=(J+Y.timeOffset)*60;C.has(_e)||C.set(_e,new Array),C.get(_e).push(se.clone())}for(const{time:J,rotation:se}of H.getValues(Y.rot,!1,!0,!1)){const _e=(J+Y.timeOffset)*60;D.has(_e)||D.set(_e,new Array),D.get(_e).push(se.clone())}for(const{time:J,scale:se}of H.getValues(Y.scale,!1,!1,!0)){const _e=(J+Y.timeOffset)*60;G.has(_e)||G.set(_e,new Array),G.get(_e).push(se.clone())}}}return{position:C.size==0?void 0:C,quaternion:D.size==0?void 0:D,scale:G.size==0?void 0:G}},f=function(M){const I=[];for(const S of M)I.push(`(${Zn(S.x)}, ${Zn(S.y)}, ${Zn(S.z)})`);return I.join(", ")},p=function(M){const I=[];for(const S of M)I.push(`(${Zn(S.w)}, ${Zn(S.x)}, ${Zn(S.y)}, ${Zn(S.z)})`);return I.join(", ")},m=function(M){const I=new Map;if(sp){const S=new Array;for(const[C,D]of s)S.push(C.uuid+": "+D.length+" "+D.map(G=>{var Q;return(Q=G.clip)==null?void 0:Q.uuid.substring(0,6)}).join(" "));console.log(`getPerBoneTransformData
`+S.join(`
`))}for(const S of M){const C=s.get(S);C&&I.set(S,C)}return I},g=function(M){const I=m(M),S=h(I);return d(I,S,M)};const r=i.skinnedMesh.skeleton,o=new Array;for(const M in r.bones){const I=r.bones[M],S=r.boneInverses[M];o.push({bone:I,inverse:S})}for(const M of pz(r.bones))o.push({bone:M,inverse:M.matrixWorld.clone().invert()});const a=o[0].bone.parent;a||console.error("No bone parent found for skinned mesh during USDZ export",i.skinnedMesh),o.sort((M,I)=>ip(M.bone,a)>ip(I.bone,a)?1:-1);const y=[],A=[],v=[],b=[];for(const{bone:M}of o)y.push(M.matrix.clone()),A.push(M.position),v.push(M.quaternion),b.push(M.scale);const _=o.map(M=>'"'+ip(M.bone,a)+'"').join(", "),T=o.map(M=>Of(M.inverse.clone().invert())).join(", ");e.beginBlock('def Skeleton "Rig"'),e.appendLine(`uniform matrix4d[] bindTransforms = [${T}]`),e.appendLine(`uniform token[] joints = [${_}]`),e.appendLine('uniform token purpose = "guide"'),e.appendLine(`uniform matrix4d[] restTransforms = [${y.map(M=>Of(M)).join(", ")}]`),e.appendLine(`matrix4d xformOp:transform = ${Of(new Ce)}`),e.appendLine('uniform token[] xformOpOrder = ["xformOp:transform"]');const E=g(o.map(M=>M.bone));if(e.beginBlock('def SkelAnimation "_anim"'),e.appendLine(`uniform token[] joints = [${_}]`),e.appendLine(`quatf[] rotations = [${p(v)}]`),E&&E.quaternion){e.beginBlock("quatf[] rotations.timeSamples = {","");const M=l(E.quaternion);for(const I of M)e.appendLine(I);e.closeBlock()}if(e.appendLine(`half3[] scales = [${f(b)}]`),E&&E.scale){e.beginBlock("half3[] scales.timeSamples = {","");const M=c(E.scale);for(const I of M)e.appendLine(I);e.closeBlock()}if(e.appendLine(`float3[] translations = [${f(A)}]`),E&&E.position){e.beginBlock("float3[] translations.timeSamples = {","");const M=c(E.position);for(const I of M)e.appendLine(I);e.closeBlock()}e.closeBlock(),e.closeBlock()}}onSerialize(e,t){var c;if(!this.model)return;this.skinnedMeshExport(e,t);const i=this.object,s=this.dict.get(i);if(!s||i.isSkinnedMesh)return;RT&&console.log("SERIALIZE",this.model.name,this.object.type,s);const r=new Ce;e.appendLine("matrix4d xformOp:transform.timeSamples = {"),e.indent++;const o=new Array;let a=0;for(let l=0;l<s.length;l++)o.push(a),a+=s[l].getDuration()+oa.animationDurationPadding;for(let l=0;l<s.length;l++){const h=s[l];if(!h)continue;const d=o[l];{const f=h.getSortedTimesArray();if(!f||f.length===0){console.error("got an animated object but no time values?",i,h);continue}if(sp){const p=((c=h.clip)==null?void 0:c.name)??"rest",m=h.getDuration();console.log("Write .timeSamples:",p,d,m,s),e.appendLine("# "+p+": start="+(d*h.frameRate).toFixed(3)+", length="+(m*h.frameRate).toFixed(3)+", frames="+h.getFrames())}for(const{time:p,translation:m,rotation:g,scale:y}of h.getValues(f)){r.compose(m,g,y);const A=`${(d+p)*h.frameRate}: ${Of(r)},`;e.appendLine(A)}}}e.indent--,e.appendLine("}")}}var Tz=globalThis&&globalThis.__decorate||function(n,e,t,i){var s=arguments.length,r=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(e,t,r):o(e,t))||r);return s>3&&r&&Object.defineProperty(e,t,r),r};const UO=re("debugpost");class It{constructor(e){u(this,"_active",!0);u(this,"_value");u(this,"_valueRaw");u(this,"_defaultValue");u(this,"valueProcessor");u(this,"onValueChanged");this._value=e,this._defaultValue=e,this._valueRaw=e}get overrideState(){return this._active}set overrideState(e){if(this._active===e)return;this._active=e;const t=e?this._valueRaw:this._defaultValue;this.processValue(t,!0)}get value(){return this._valueRaw}set value(e){this.processValue(e,!1)}set defaultValue(e){this._defaultValue=e}__init(){this.processValue(this._valueRaw,!0)}processValue(e,t){if(e==null||!t&&this.testIfValueChanged(e)===!1)return;const i=this._value;UO&&console.log("VolumeParameter: value changed from",i,"to",e),!this._active&&this._defaultValue!==void 0?(this._value=this._defaultValue,e=this._defaultValue,this._valueRaw=e):(this._valueRaw=e,this._active&&this.valueProcessor&&(e=this.valueProcessor(e)),this._value=e),this.onValueChanged?this.onValueChanged(e,i,this):UO&&console.log("VolumeParameter: onValueChanged not set")}testIfValueChanged(e){return this._valueRaw!==e}}Tz([x()],It.prototype,"overrideState",null);Tz([x()],It.prototype,"value",null);var Ite=globalThis&&globalThis.__decorate||function(n,e,t,i){var s=arguments.length,r=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(e,t,r):o(e,t))||r);return s>3&&r&&Object.defineProperty(e,t,r),r};const Rte=re("debugpost");class xr extends Te{constructor(t=void 0){super();u(this,"active",!0);u(this,"_result");u(this,"_didCreateVolumeParameters",!1);if(t){this.ensureVolumeParameters();for(const i of Object.keys(t)){const s=t[i],r=this[i];r instanceof It&&(r.value=s)}}}onEnable(){this.__internalDidAwakeAndStart&&(this.active=!0)}onDisable(){this.active=!1}init(){}apply(){var t;return this.ensureVolumeParameters(),this._result||(this._result=(t=this.onCreateEffect)==null?void 0:t.call(this)),this._result&&this.initParameters(),this._result}unapply(){}dispose(){Rte&&console.warn("DISPOSE",this),this._result&&(Array.isArray(this._result)?this._result.forEach(t=>t.dispose()):this._result.dispose()),this._result=void 0}initParameters(){const t=Object.keys(this);for(const i of t){const s=this[i];s instanceof It&&s.__init()}}onAfterDeserialize(t,i){if(typeof t=="object"){const s=this.$serializedTypes;if(s){for(const r of Object.keys(s))if(s[r]===It){const a=t[r];if(a!==void 0){const c=this[r];c.value=a}}}}}onEditorModification(t){const i=t.propertyName;if(this[i]instanceof It){const s=t.value;return this[i].value=s,!0}}ensureVolumeParameters(){if(this._didCreateVolumeParameters)return;this._didCreateVolumeParameters=!0;const t=this.$serializedTypes;if(t)for(const i of Object.keys(t))t[i]===It&&(this[i]||(this[i]=new It))}}Ite([x()],xr.prototype,"active",void 0);var Pte=globalThis&&globalThis.__decorate||function(n,e,t,i){var s=arguments.length,r=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(e,t,r):o(e,t))||r);return s>3&&r&&Object.defineProperty(e,t,r),r};const Bte=re("debugpost"),PT={};function _a(n,e){PT[n]=e}function Dte(n){return n.__type in PT?PT[n.__type]:(Bte&&n.__type&&console.warn("Unknown postprocessing type",n.__type,n),xr)}class Fx{constructor(){u(this,"components",[])}init(){var e;(e=this.components)==null||e.forEach(t=>t.init())}}Pte([sv([n=>Dte(n),xr])],Fx.prototype,"components",void 0);var Ote=globalThis&&globalThis.__decorate||function(n,e,t,i){var s=arguments.length,r=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(e,t,r):o(e,t))||r);return s>3&&r&&Object.defineProperty(e,t,r),r},NO;(function(n){n[n.LOW=0]="LOW",n[n.MEDIUM=1]="MEDIUM",n[n.HIGH=2]="HIGH",n[n.ULTRA=3]="ULTRA"})(NO||(NO={}));class Ux extends xr{constructor(){super(...arguments);u(this,"preset")}get typeName(){return"Antialiasing"}onCreateEffect(){const t=new Y6({preset:yf.HIGH,edgeDetectionMode:a1.DEPTH});return this.preset.onValueChanged=i=>{t.applyPreset(i)},t}}Ote([x(It)],Ux.prototype,"preset",void 0);_a("Antialiasing",Ux);class gI{constructor(){u(this,"files",[])}get extensionName(){return"Audio"}onExportObject(e,t,i){const s=le.getComponents(e,Ti);if(s.length)for(const r of s){if(!r.clip||typeof r.clip!="string"||!r.playOnAwake)continue;const o=r.clip.split("/").pop();this.files.includes(r.clip)||this.files.push(r.clip),t.addEventListener("serialize",(a,c)=>{a.appendLine(),a.beginBlock(`def SpatialAudio "${t.name}"`),a.appendLine(`uniform asset filePath = @audio/${o}@`),a.appendLine(`uniform token auralMode = "${r.spatialBlend>0?"spatial":"nonSpatial"}"`),a.appendLine(`uniform token playbackMode = "${r.loop?"loopFromStage":"onceFromStart"}"`),a.appendLine(`uniform float gain = ${r.volume}`),a.closeBlock()})}}async onAfterSerialize(e){for(const t of this.files){const i=t.split("/").pop(),o=await(await(await fetch(t)).blob()).arrayBuffer(),a=new Uint8Array(o);e.files["audio/"+i]=a}}}const Qu=re("debugautosync"),pC=Symbol("syncerId");class kte{constructor(){u(this,"_syncers",{})}getOrCreateSyncer(e){if(!e.guid)return null;if(this._syncers[e.guid])return this._syncers[e.guid];const t=new Lte(e);return t[pC]=e.guid,this._syncers[t[pC]]=t,t}removeSyncer(e){delete this._syncers[e[pC]]}}const AI=new kte;class Lte{constructor(e){u(this,"comp");u(this,"hasChanges",!1);u(this,"changedProperties",{});u(this,"data",{});u(this,"_boundEvent");u(this,"_handleReceivingMethod");u(this,"_isReceiving",!1);u(this,"_isInit",!1);this.comp=e}get networkingKey(){return this.comp.guid}init(e){if(this._isInit)return;this._isInit=!0,this.comp=e,this._boundEvent=this.onHandleSending.bind(this),this.comp.context.post_render_callbacks.push(this._boundEvent),this._handleReceivingMethod=this.onHandleReceiving.bind(this),this.comp.context.connection.beginListen(this.networkingKey,this._handleReceivingMethod);const t=this.comp.context.connection.tryGetState(this.comp.guid);t&&this.onHandleReceiving(t)}destroy(){this._isInit&&(this._boundEvent&&this.comp.context.post_render_callbacks.splice(this.comp.context.post_render_callbacks.indexOf(this._boundEvent),1),this._handleReceivingMethod&&this.comp.context.connection.stopListen(this.networkingKey,this._handleReceivingMethod),this.comp=null,this._isInit=!1)}notifyChanged(e,t){this._isReceiving||(Qu&&console.log("Property changed: "+e,t),this.hasChanges=!0,this.changedProperties[e]=t)}onHandleSending(){if(!this.hasChanges)return;this.hasChanges=!1;const e=this.comp.context.connection;if(!e||!e.isConnected){for(const t in this.changedProperties)delete this.changedProperties[t];return}for(const t in this.data)delete this.data[t];this.data.guid=this.comp.guid;for(const t in this.changedProperties){const i=this.changedProperties[t];delete this.changedProperties[t],this.data[t]=i}e.send(this.networkingKey,this.data)}onHandleReceiving(e){if(Qu&&console.log("RECEIVE",this.comp.name,this.comp.guid,e),!this._isInit||!this.comp)return;const t=e.guid;if(!(t&&t!==this.comp.guid)){Qu&&console.log("RECEIVED",this.comp.name,this.comp.guid,e);try{this._isReceiving=!0;for(const i in e){if(i==="guid")continue;const s=e[i];this.comp[i]=s,Qu&&console.log("SET",i,s)}}catch(i){console.error(i)}finally{this._isReceiving=!1}}}}function Fte(n,e){let t=e!==n;return!t&&n&&e&&(Array.isArray(n)&&Array.isArray(e)||typeof n=="object"&&typeof e=="object")&&(t=!0),t}const _g=Symbol("AutoSyncHandler");function Ute(n){if(n[_g])return n[_g];const e=AI.getOrCreateSyncer(n);return e==null||e.init(n),n[_g]=e,e}function Nte(n){const e=n[_g];e&&(AI.removeSyncer(e),e.destroy(),delete n[_g])}const Mz=function(n){return function(e,t){var h;let i="";typeof t=="string"?i=t:i=t.name;let s=null,r;typeof n=="string"?r=e[n]:typeof n=="function"&&(r=n);const o=e,a=o.__internalAwake;if(typeof a!="function"){(Qu||Tt())&&console.error('@syncField can currently only used on Needle Engine Components, custom object of type "'+((h=e==null?void 0:e.constructor)==null?void 0:h.name)+'" is not supported',e);return}Qu&&console.log(i);const c=Symbol(i);o.__internalAwake=function(){if(this[c]!==void 0)return;this[c]=this[i],s=AI.getOrCreateSyncer(this);const d=Object.getOwnPropertyDescriptor(this,i);if((d==null?void 0:d.set)===void 0){let f=!1;Object.defineProperty(this,i,{set:function(p){var g;const m=this[c];if(this[c]=p,f){Tt()&&console.warn("Recursive call detected",i);return}f=!0;try{const y=Fte(p,m);Qu&&console.log("SyncField assignment",i,"changed?",y,p),y&&(r==null?void 0:r.call(this,p,m))!==!1&&((g=Ute(this))==null||g.notifyChanged(i,p))}finally{f=!1}},get:function(){return this[c]},configurable:!0,enumerable:!0})}s==null||s.init(this),a.call(this)};const l=o.__internalDestroy;o.__internalDestroy=function(){Nte(this),l.call(this)}}};var Nx=globalThis&&globalThis.__decorate||function(n,e,t,i){var s=arguments.length,r=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(e,t,r):o(e,t))||r);return s>3&&r&&Object.defineProperty(e,t,r),r};const So=re("debugplayersync");class lv extends Te{constructor(){super(...arguments);u(this,"autoSync",!0);u(this,"asset");u(this,"onPlayerSpawned");u(this,"_localInstance");u(this,"onJoinedRoom",()=>{So&&console.log("PlayerSync.joinedRoom. autoSync is set to "+this.autoSync),this.autoSync&&this.getInstance()})}awake(){this.watchTabVisible(),this.onPlayerSpawned||(this.onPlayerSpawned=new Cs)}onEnable(){this.context.connection.beginListen(Xt.RoomStateSent,this.onJoinedRoom),this.context.connection.beginListen(Xt.JoinedRoom,this.onJoinedRoom),this.context.connection.isInRoom&&this.onJoinedRoom()}onDisable(){this.context.connection.stopListen(Xt.RoomStateSent,this.onJoinedRoom),this.context.connection.stopListen(Xt.JoinedRoom,this.onJoinedRoom)}async getInstance(){var i,s,r,o,a,c;if(this._localInstance)return this._localInstance;if(So&&console.log("PlayerSync.createInstance",(i=this.asset)==null?void 0:i.uri),!((s=this.asset)!=null&&s.asset)&&!((r=this.asset)!=null&&r.uri))return console.error('PlayerSync: can not create an instance because "asset" is not set!'),null;this._localInstance=(o=this.asset)==null?void 0:o.instantiateSynced({parent:this.gameObject},!0);const t=await this._localInstance;if(t){const l=le.getComponent(t,Hs);l?(l.owner=this.context.connection.connectionId,(a=this.onPlayerSpawned)==null||a.invoke(t)):(this._localInstance=void 0,console.error("<strong>Failed finding PlayerState on "+((c=this.asset)==null?void 0:c.uri)+"</strong>: please make sure the asset has a PlayerState component!"),le.destroySynced(t))}else this._localInstance=void 0,console.warn("PlayerSync: failed instantiating asset!");return this._localInstance}destroyInstance(){var t;(t=this._localInstance)==null||t.then(i=>(So&&console.log("PlayerSync.destroyInstance",i),le.destroySynced(i))),this._localInstance=void 0}watchTabVisible(){window.addEventListener("visibilitychange",t=>{if(document.visibilityState==="visible")for(let i=Hs.all.length-1;i>=0;i--){const s=Hs.all[i];(!s.owner||!this.context.connection.userIsInRoom(s.owner))&&s.doDestroy()}})}}Nx([x()],lv.prototype,"autoSync",void 0);Nx([x(ii)],lv.prototype,"asset",void 0);Nx([x(Cs)],lv.prototype,"onPlayerSpawned",void 0);var BT;(function(n){n.OwnerChanged="ownerChanged"})(BT||(BT={}));const Kn=class extends Te{constructor(){super(...arguments);u(this,"onOwnerChangeEvent",new Cs);u(this,"onFirstOwnerChangeEvent",new Cs);u(this,"hasOwner",!1);u(this,"owner");u(this,"dontDestroy",!1);u(this,"onUserLeftRoom",t=>{if(t.userId===this.owner){So&&console.log("PLAYERSYNC LEFT",this.owner),this.doDestroy();return}})}static get all(){return Kn._all}static get local(){return Kn._local}static getFor(t){if(t instanceof ge)return le.getComponentInParent(t,Kn);if(t instanceof Te)return le.getComponentInParent(t.gameObject,Kn)}static isLocalPlayer(t){const i=Kn.getFor(t);return(i==null?void 0:i.isLocalPlayer)??!1}static addEventListener(t,i){return this._callbacks[t]||(this._callbacks[t]=[]),this._callbacks[t].push(i),i}static removeEventListener(t,i){if(!this._callbacks[t])return;const s=this._callbacks[t].indexOf(i);s>=0&&this._callbacks[t].splice(s,1)}static dispatchEvent(t,i){if(this._callbacks[t])for(const s of this._callbacks[t])s(i)}get isLocalPlayer(){return this.owner===this.context.connection.connectionId}onOwnerChange(t,i){var a,c;So&&console.log("PlayerSync.onOwnerChange",this,"newOwner",t,"oldOwner",i);const s=Kn._local.indexOf(this);s>=0&&Kn._local.splice(s,1);const r={playerState:this,oldValue:i,newValue:t};if(this.hasOwner||(this.hasOwner=!0,(a=this.onFirstOwnerChangeEvent)==null||a.invoke(r)),(c=this.onOwnerChangeEvent)==null||c.invoke(r),this.owner===this.context.connection.connectionId){Kn._local.push(this);const l=new CustomEvent("local-owner-changed",{detail:r});this.dispatchEvent(l)}const o=new CustomEvent("owner-changed",{detail:r});this.dispatchEvent(o),Kn.dispatchEvent(BT.OwnerChanged,o)}awake(){Kn.all.push(this),So&&console.log("Registered new PlayerState",this.guid,Kn.all.length-1,Kn.all),this.context.connection.beginListen(Xt.UserLeftRoom,this.onUserLeftRoom)}async start(){So&&console.log("PLAYERSTATE.START, owner: "+this.owner,this.context.connection.usersInRoom([])),this.owner?(this.context.connection.isInRoom||await ha(300),this.context.connection.userIsInRoom(this.owner)==!1&&(So&&console.log(`PlayerSync.start  doDestroy "${this.name}" because user "${this.owner}" is not in room anymore...`,"Currently in room:",...this.context.connection.usersInRoom()),this.doDestroy())):this.owner||(So&&console.warn("PlayerState.start  owner is undefined!",this.name),setTimeout(()=>{!this.destroyed&&!this.owner?this.dontDestroy?So&&console.warn("PlayerState.start  owner is still undefined but dontDestroy is set to true",this.name):(So&&console.warn(`PlayerState.start  owner is still undefined: destroying "${this.name}" instance now`),this.doDestroy()):console.log("PlayerState.start  owner is assigned",this.owner)},2e3))}doDestroy(){So&&console.log("PlayerSync.doDestroy  syncDestroy",this.name),iI(this.gameObject,this.context.connection)}onDestroy(){if(this.context.connection.stopListen(Xt.UserLeftRoom,this.onUserLeftRoom),Kn.all.splice(Kn.all.indexOf(this),1),this.isLocalPlayer){const t=Kn._local.indexOf(this);t>=0&&Kn._local.splice(t,1)}}};let Hs=Kn;u(Hs,"_all",[]),u(Hs,"_local",[]),u(Hs,"_callbacks",{});Nx([Mz(Hs.prototype.onOwnerChange)],Hs.prototype,"owner",void 0);const zte=re("debugavatar"),$o=class extends Te{constructor(){super(...arguments);u(this,"connectionId");u(this,"avatar")}static getAvatar(t){return t>=0&&t<$o.instances.length?$o.instances[t]:null}static onAvatarMarkerCreated(t){return $o._onNewAvatarMarkerAdded.push(t),t}static onAvatarMarkerDestroyed(t){return $o._onAvatarMarkerDestroyed.push(t),t}awake(){$o.instances.push(this),zte&&console.log(this);for(const t of $o._onNewAvatarMarkerAdded)t({avatarMarker:this,gameObject:this.gameObject})}onDestroy(){$o.instances.splice($o.instances.indexOf(this),1);for(const t of $o._onAvatarMarkerDestroyed)t({avatarMarker:this,gameObject:this.gameObject})}isLocalAvatar(){return this.connectionId===this.context.connection.connectionId}};let ns=$o;u(ns,"instances",[]),u(ns,"_onNewAvatarMarkerAdded",[]),u(ns,"_onAvatarMarkerDestroyed",[]);var Gte=globalThis&&globalThis.__decorate||function(n,e,t,i){var s=arguments.length,r=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(e,t,r):o(e,t))||r);return s>3&&r&&Object.defineProperty(e,t,r),r};const Sf=re("debugxrflags"),Iz=re("disablexrflags");Iz&&console.warn("XRFlags are disabled");var Do;(function(n){n[n.Never=0]="Never",n[n.Browser=1]="Browser",n[n.AR=2]="AR",n[n.VR=4]="VR",n[n.FirstPerson=8]="FirstPerson",n[n.ThirdPerson=16]="ThirdPerson",n[n.All=4294967295]="All"})(Do||(Do={}));const fR=class{constructor(){u(this,"Mask",Do.Browser|Do.ThirdPerson)}Has(e){return(this.Mask&e)!==0}Set(e){Sf&&console.warn("Set XR flag state to",e),this.Mask=e,bs.Apply()}Enable(e){this.Mask|=e,bs.Apply()}Disable(e){this.Mask&=~e,bs.Apply()}Toggle(e){this.Mask^=e,bs.Apply()}EnableAll(){this.Mask=-1,bs.Apply()}DisableAll(){this.Mask=0,bs.Apply()}};let Qs=fR;u(Qs,"Global",new fR);const Va=class extends Te{constructor(){super(...arguments);u(this,"visibleIn")}static Apply(){for(const t of this.registry)t.UpdateVisible(Qs.Global)}awake(){Va.registry.push(this)}onEnable(){Va.firstApply?this.UpdateVisible(Qs.Global):(Va.firstApply=!0,Va.Apply())}onDestroy(){const t=Va.registry.indexOf(this);t>=0&&Va.registry.splice(t,1)}get isOn(){return this.gameObject.visible}UpdateVisible(t=null){if(Iz)return;let i;const s=t;if(s&&typeof s=="number"&&(console.assert(typeof s=="number","XRFlag.UpdateVisible: state must be a number",s),Sf&&console.log(s),Va.buffer.Mask=s,t=Va.buffer),t instanceof Qs?(Sf&&console.warn(this.name,"use passed in mask",t.Mask,this.visibleIn),i=t.Has(this.visibleIn)):(Sf&&console.log(this.name,"use global mask"),Qs.Global.Has(this.visibleIn)),i!==void 0)if(i)Sf&&console.log(this.name,"is visible",this.gameObject.uuid),le.setActive(this.gameObject,!0);else{if(Sf&&console.log(this.name,"is not visible",this.gameObject.uuid),!this.gameObject.visible)return;this.gameObject.visible=!1}}};let bs=Va;u(bs,"registry",[]),u(bs,"firstApply"),u(bs,"buffer",new Qs);Gte([x()],bs.prototype,"visibleIn",void 0);var vI=globalThis&&globalThis.__decorate||function(n,e,t,i){var s=arguments.length,r=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(e,t,r):o(e,t))||r);return s>3&&r&&Object.defineProperty(e,t,r),r};const Om=re("debugwebxr"),zO=new Me().setFromAxisAngle(new w(0,1,0),Math.PI);class Vp extends Te{constructor(){super(...arguments);u(this,"head");u(this,"leftHand");u(this,"rightHand");u(this,"_syncTransforms")}async onEnterXR(t){if(!this.activeAndEnabled)return;Om&&console.warn("AVATAR ENTER XR",this.guid,this.sourceId,this,this.activeAndEnabled),this._syncTransforms&&(this._syncTransforms.length=0),await this.prepareAvatar();const i=Hs.getFor(this);if(i!=null&&i.owner){const s=this.gameObject.addNewComponent(ns);s.avatar=this.gameObject,s.connectionId=i.owner}else this.context.connection.isConnected?console.error("No player state found for avatar",this):i&&!this.context.connection.isConnected&&(i.dontDestroy=!0)}onLeaveXR(t){const i=this.gameObject.getComponent(ns);i&&i.destroy()}onUpdateXR(t){var c,l;if(!this.activeAndEnabled)return;const i=Hs.isLocalPlayer(this);if(!i)return;const s=t.xr;if(s.rig&&s.rig.gameObject!==this.gameObject.parent&&(this.gameObject.position.set(0,0,0),this.gameObject.rotation.set(0,0,0),this.gameObject.scale.set(1,1,1),s.rig.gameObject.add(this.gameObject)),this._syncTransforms&&i)for(const h of this._syncTransforms)h.fastMode=!0,h.isOwned()||h.requestOwnership();if(this.head&&this.context.mainCamera){const h=this.head.asset;if(h.position.copy(this.context.mainCamera.position),h.quaternion.copy(this.context.mainCamera.quaternion),h.quaternion.x*=-1,this.context.time.frameCount%10===0){const d=le.getComponentsInChildren(this.head.asset,bs);for(const f of d)f.enabled=!1,f.gameObject.visible=!1}}const r=t.xr.leftController,o=(c=this.leftHand)==null?void 0:c.asset;r&&o&&(o.position.copy(r.gripPosition),o.quaternion.copy(r.gripQuaternion),o.quaternion.multiply(zO),o.visible=r.isTracking);const a=t.xr.rightController;if(a&&((l=this.rightHand)!=null&&l.asset)){const h=this.rightHand.asset;h.position.copy(a.gripPosition),h.quaternion.copy(a.gripQuaternion),h.quaternion.multiply(zO),h.visible=a.isTracking}}onBeforeRender(){this.context.time.frame%10===0&&this.updateRemoteAvatarVisibility()}updateRemoteAvatarVisibility(){var t,i,s;if(this.context.connection.isConnected){const r=Hs.getFor(this);if(r&&r.isLocalPlayer==!1){const o=mt.getXRSync(this.context);if(o&&o.hasState(r.owner)){this.tryFindAvatarObjectsIfMissing();const a=(t=this.leftHand)==null?void 0:t.asset;a&&(a.visible=(o==null?void 0:o.isTracking(r.owner,"left"))??!1);const c=(i=this.rightHand)==null?void 0:i.asset;c&&(c.visible=(o==null?void 0:o.isTracking(r.owner,"right"))??!1)}if((s=this.head)!=null&&s.asset){const a=le.getComponentsInChildren(this.head.asset,bs);for(const c of a)c.enabled=!1,c.gameObject.visible=!0}}}}tryFindAvatarObjectsIfMissing(){if(!this.head||!this.leftHand||!this.rightHand){const t={head:this.head,leftHand:this.leftHand,rightHand:this.rightHand};xZ.tryFindAvatarObjects(this.gameObject,this.sourceId||"",t),t.head&&(this.head=t.head),t.leftHand&&(this.leftHand=t.leftHand),t.rightHand&&(this.rightHand=t.rightHand)}}async prepareAvatar(){if(this.tryFindAvatarObjectsIfMissing(),this.head)this.head instanceof ge&&(this.head=new ii("",this.sourceId,this.head));else{const t=new ge;t.name="Head";const i=yA.createPrimitive(fc.Cube);t.add(i),this.gameObject.add(t),this.head=new ii("",this.sourceId,t),Om&&console.log("Create head",t)}if(this.rightHand)this.rightHand instanceof ge&&(this.rightHand=new ii("",this.sourceId,this.rightHand));else{const t=new ge;t.name="Right Hand",this.gameObject.add(t),this.rightHand=new ii("",this.sourceId,t),Om&&console.log("Create right hand",t)}if(this.leftHand)this.leftHand instanceof ge&&(this.leftHand=new ii("",this.sourceId,this.leftHand));else{const t=new ge;t.name="Left Hand",this.gameObject.add(t),this.leftHand=new ii("",this.sourceId,t),Om&&console.log("Create left hand",t)}await this.loadAvatarObjects(this.head,this.leftHand,this.rightHand),Hs.isLocalPlayer(this.gameObject)&&(this._syncTransforms=le.getComponentsInChildren(this.gameObject,Ad))}async loadAvatarObjects(t,i,s){const r=t.loadAssetAsync(),o=i.loadAssetAsync(),a=s.loadAssetAsync(),c=new Array;r&&c.push(r),o&&c.push(o),a&&c.push(a);const l=await ix(c);Om&&console.log("Avatar loaded results:",l)}}vI([x(ii)],Vp.prototype,"head",void 0);vI([x(ii)],Vp.prototype,"leftHand",void 0);vI([x(ii)],Vp.prototype,"rightHand",void 0);class Al{static Add(e,t,i=null){if(t){for(const s of this.Pois)if(s.obj===t)return;this.Pois.push({obj:t,avatar:i}),this.LastChangeTime=e.time.time}}static Remove(e,t){var i;if(t){for(const s of this.Pois)if(s.obj===t){this.Pois.splice(this.Pois.indexOf(s),1),this.LastChangeTime=(e==null?void 0:e.time.time)??((i=Lt.Current)==null?void 0:i.time.time);return}}}}u(Al,"Pois",[]),u(Al,"LastChangeTime",0);var Wb;(function(n){n.TargetChanged="avatar-look-target-changed"})(Wb||(Wb={}));class Vte{constructor(){u(this,"guid");u(this,"position",new w)}}class qb extends Te{constructor(){super(...arguments);u(this,"target",null);u(this,"avatar",null);u(this,"_model",null);u(this,"_targetModel",new Vte);u(this,"_currentTargetObject",null);u(this,"_lastUpdateTime",0);u(this,"_lookDuration",0);u(this,"_lastPoiChangedTime",0)}set controlledTarget(t){this.target=t;const i=ee.get("MoveRandom");if(i&&this.target){const s=le.getComponent(this.target,i);s&&s.destroy()}}awake(){if(this.avatar=le.getComponentInParent(this.gameObject,ns),this.avatar){const t=le.getComponentInParent(this.gameObject,ns);this._model=new ZU(this.context.connection,this.guid),t!=null&&t.isLocalAvatar&&this._model.requestOwnership()}this.context.connection.beginListen(Wb.TargetChanged,t=>{var i;this.target&&t&&t.guid===((i=this.avatar)==null?void 0:i.guid)&&vr(this.target,t.position)})}update(){var i;if((!this.context.connection.isConnected||(i=this._model)!=null&&i.hasOwnership)&&(Al.LastChangeTime!==this._lastPoiChangedTime&&(this._lastPoiChangedTime=Al.LastChangeTime,this._lookDuration=0),this.selectTarget(),this._currentTargetObject&&this.context.time.frameCount%10===0&&this.target)){const s=Ht(this._currentTargetObject);vr(this.target,s),this.context.connection.isConnected&&this.avatar&&(this.context.connection.send(Wb.TargetChanged,this._targetModel),this._targetModel.guid=this.avatar.guid,this._targetModel.position.copy(s))}}selectTarget(){if(this.context.time.time-this._lastUpdateTime>this._lookDuration){this._lastUpdateTime=this.context.time.time,this._lookDuration=Math.random()*.5+.2;const i=Al.Pois;if(i.length>0){const s=i[Math.floor(Math.random()*i.length)];if(s&&s.obj){if(s.avatar&&s.avatar===this.avatar)return;this._currentTargetObject=s.obj}}}}}const Uf=re("debugnetworkingstreams");var fn;(function(n){n.Connected="peer-user-connected",n.StreamReceived="receive-stream",n.StreamEnded="call-ended",n.Disconnected="peer-user-disconnected",n.UserJoined="user-joined"})(fn||(fn={}));class Hte{constructor(e,t){u(this,"type",fn.StreamEnded);u(this,"userId");u(this,"direction");this.userId=e,this.direction=t}}class Qte{constructor(e,t){u(this,"type",fn.StreamReceived);u(this,"stream");u(this,"target");this.stream=e,this.target=t}}class jte{constructor(e,t){u(this,"guid");u(this,"peerId");u(this,"dontSave",!0);this.guid=e.id,this.peerId=t}}var _h;(function(n){n.Incoming="incoming",n.Outgoing="outgoing"})(_h||(_h={}));class Wte extends ls{constructor(t,i,s){super();u(this,"userId");u(this,"direction");u(this,"call");u(this,"_stream",null);u(this,"_isDisposed",!1);this.userId=t,this.call=i,this.direction=s,this._stream=null,i.on("stream",r=>{if(Uf&&console.log("Receive video",r.getAudioTracks(),r.getVideoTracks()),this._stream=r,s===_h.Incoming){const o=new Qte(r,this);this.dispatchEvent(o)}}),i.on("close",()=>{this.dispatchEvent(new Hte(t,s))})}get stream(){return this._stream}close(){this._isDisposed||(this._isDisposed=!0,this.call.close(),Eh(this._stream))}get isOpen(){var t;return((t=this.call.peerConnection)==null?void 0:t.connectionState)==="connected"}get isOpening(){var t;return((t=this.call.peerConnection)==null?void 0:t.connectionState)==="connecting"}get isClosed(){return!this.isOpen}}const Yf=class extends ls{constructor(t,i){super();u(this,"id");u(this,"context");u(this,"_peer");u(this,"_incomingCalls",[]);u(this,"_outgoingCalls",[]);u(this,"_enabled",!1);u(this,"_enabledPeer",!1);u(this,"onConnectRoomFn",this.onConnectRoom.bind(this));u(this,"onPeerConnectFn",this.onPeerConnect.bind(this));u(this,"onPeerReceiveCallFn",this.onPeerReceivingCall.bind(this));this.context=t,this.id=i,this.setupPeer(),navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia}static getOrCreate(t,i){if(Yf.instances.has(i))return Yf.instances.get(i);const s=new Yf(t,i);return Yf.instances.set(i,s),s}getMyPeerId(){if(this.context.connection.connectionId)return this.getPeerIdFromUserId(this.context.connection.connectionId)}getPeerIdFromUserId(t){return this.id+"-"+t}getUserIdFromPeerId(t){return t.substring(this.id.length+1)}makeCall(t,i){var o;const s={metadata:{userId:this.context.connection.connectionId}},r=(o=this._peer)==null?void 0:o.call(t,i,s);if(r)return this.registerCall(r,_h.Outgoing)}get peer(){return this._peer}enable(){this._enabled||(this._enabled=!0,this.context.connection.beginListen(Xt.JoinedRoom,this.onConnectRoomFn),this.subscribePeerEvents())}disable(){this._enabled&&(this._enabled=!1,this.context.connection.stopListen(Xt.JoinedRoom,this.onConnectRoomFn),this.unsubscribePeerEvents())}onConnectRoom(){this.setupPeer()}setupPeer(){if(this.context.connection.connectionId&&!this._enabledPeer){if(this._enabledPeer=!0,!this._peer){const t=this.getMyPeerId();t?this._peer=UX(t):console.error("Failed to setup peerjs because we dont have a connection id",this.context.connection.connectionId)}this._enabled&&this.subscribePeerEvents()}}subscribePeerEvents(){this._peer&&(this._peer.on("open",this.onPeerConnectFn),this._peer.on("call",this.onPeerReceiveCallFn))}unsubscribePeerEvents(){this._peer&&(this._peer.off("open",this.onPeerConnectFn),this._peer.off("call",this.onPeerReceiveCallFn))}onPeerConnect(t){Uf&&console.log("Peer connected as",t),this.context.connection.send(fn.Connected,new jte(this,t))}onPeerReceivingCall(t){t.answer(),this.registerCall(t,_h.Incoming)}registerCall(t,i){const s=t.metadata;(!s||!s.userId)&&console.error("Missing call metadata",t);const r=s.userId;i===_h.Incoming&&Uf?console.log("Receive call from",t.metadata):Uf&&console.log("Make call to",t.metadata);const o=i===_h.Incoming?this._incomingCalls:this._outgoingCalls,a=new Wte(r,t,i);return o.push(a),t.on("error",c=>{console.error("Call error",c)}),t.on("close",()=>{Uf&&console.log("Call ended",t.metadata),t.close();const c=o.indexOf(a);c!==-1&&o.splice(c,1)}),a.addEventListener(fn.StreamEnded,c=>{this.dispatchEvent(c)}),i===_h.Incoming&&(a.addEventListener(fn.StreamReceived,c=>{this.dispatchEvent(c)}),t.on("stream",()=>{let c=0;const l=setInterval(()=>{const h=c===0;!a.isOpen&&h&&(c+=1,clearInterval(l),a.close())},2e3)})),a}};let xg=Yf;u(xg,"instances",new Map);class zx extends ls{constructor(t,i){super();u(this,"context");u(this,"peer");u(this,"_sendingStreams",new Map);u(this,"debug",!1);u(this,"onJoinedRoom",t=>{this.debug&&console.log(`${t.userId} joined room and I'm currently sending ${this._sendingStreams.size} streams`),this._sendingStreams.size>0&&this.updateSendingCalls()});u(this,"onReceiveStream",t=>{this.debug&&console.log("RECEIVE STREAM",t),this.dispatchEvent({type:fn.StreamReceived,target:this,stream:t.stream,userId:t.userId})});u(this,"onCallEnded",t=>{this.dispatchEvent(t)});u(this,"onUserConnected",t=>{if(this.peer.id===t.guid){this.debug&&console.log("USER CONNECTED",t.guid,t);const i=this._sendingStreams.keys().next().value;this.peer.makeCall(t.peerId,i)}});u(this,"onUserLeft",t=>{this.stopCallsToUsersThatAreNotInTheRoomAnymore()});this.context=t,this.peer=i,Uf&&(this.debug=!0)}static create(t){const i=xg.getOrCreate(t.context,t.context.connection.connectionId);return new zx(t.context,i)}startSendingStream(t){this._sendingStreams.has(t)?console.warn("Received start sending stream with stream that is already being sent"):(this._sendingStreams.set(t,[]),this.updateSendingCalls())}stopSendingStream(t){if(t){const i=this._sendingStreams.get(t);if(i){this.debug&&console.log("Closing calls",i);for(const s of i)s.close()}this._sendingStreams.delete(t),i&&this.debug&&console.log("Currently sending",this._sendingStreams)}}enable(){this.peer.enable(),this.peer.addEventListener(fn.StreamReceived,this.onReceiveStream),this.peer.addEventListener(fn.StreamEnded,this.onCallEnded),this.context.connection.beginListen(fn.Connected,this.onUserConnected),this.context.connection.beginListen(Xt.JoinedRoom,this.onJoinedRoom),this.context.connection.beginListen(Xt.UserJoinedRoom,this.onJoinedRoom),this.context.connection.beginListen(Xt.UserLeftRoom,this.onUserLeft)}disable(){this.peer.disable(),this.peer.removeEventListener(fn.StreamReceived,this.onReceiveStream),this.peer.removeEventListener(fn.StreamEnded,this.onCallEnded),this.context.connection.stopListen(fn.Connected,this.onUserConnected),this.context.connection.stopListen(Xt.JoinedRoom,this.onJoinedRoom),this.context.connection.stopListen(Xt.UserJoinedRoom,this.onJoinedRoom),this.context.connection.stopListen(Xt.UserLeftRoom,this.onUserLeft)}updateSendingCalls(){var s;let t=!1;const i=this.context.connection.connectionId;for(const r of this._sendingStreams.keys()){const o=this._sendingStreams.get(r)||[];for(const a of this.context.connection.usersInRoom()){if(a===i)continue;const c=o.find(l=>l.userId===a);if(!c||((s=c.stream)==null?void 0:s.active)===!1){this.debug&&console.log("Starting call to",a,i);const l=this.peer.makeCall(this.peer.getPeerIdFromUserId(a),r);l&&(t=!0,o.push(l))}}this._sendingStreams.set(r,o)}this.stopCallsToUsersThatAreNotInTheRoomAnymore(),t&&this.debug&&console.log("Currently sending",this._sendingStreams)}stopCallsToUsersThatAreNotInTheRoomAnymore(){for(const t of this._sendingStreams.keys()){const i=this._sendingStreams.get(t);if(i)for(let s=i.length-1;s>=0;s--){const r=i[s];this.context.connection.userIsInRoom(r.userId)||(r.close(),i.splice(s,1))}}}}function Eh(n){if(n&&n instanceof MediaStream)for(const e of n.getTracks())e.stop()}var Rz=globalThis&&globalThis.__decorate||function(n,e,t,i){var s=arguments.length,r=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(e,t,r):o(e,t))||r);return s>3&&r&&Object.defineProperty(e,t,r),r};const qte="noVoip",Xte=re("debugvoip");class Hp extends Te{constructor(){super(...arguments);u(this,"autoConnect",!1);u(this,"runInBackground",!0);u(this,"debug",!1);u(this,"_net");u(this,"_outputStream",null);u(this,"onJoinedRoom",async()=>{await ha(300),this.autoConnect&&!this.isSending&&this.connect()});u(this,"_incomingStreams",new Map);u(this,"onReceiveStream",t=>{const i=t.target.userId,s=t.stream,r=this._incomingStreams.get(i);if(r)r.srcObject=s,r.setAttribute("autoplay","true");else{const o=new Audio;this._incomingStreams.set(i,o),o.setAttribute("autoplay","true"),o.srcObject=s}});u(this,"onStreamEnded",t=>{const i=this._incomingStreams.get(t.userId);Eh(i==null?void 0:i.srcObject),this._incomingStreams.delete(t.userId)});u(this,"onEnabledChanged",()=>{for(const t of this._incomingStreams){const i=t[1];i.muted=!this.enabled}});u(this,"onVisibilityChanged",()=>{if(this.runInBackground)return;const i=!(document.visibilityState==="visible");this.setMuted(i);for(const s of this._incomingStreams){const r=s[1];r.muted=i}})}awake(){Xte&&(this.debug=!0),this.debug&&window.addEventListener("keydown",async t=>{t.key==="v"&&(console.log("MUTE?",!this.isMuted),this.setMuted(!this.isMuted))})}onEnable(){this._net||(this._net=zx.create(this)),this._net.addEventListener(fn.StreamReceived,this.onReceiveStream),this._net.addEventListener(fn.StreamEnded,this.onStreamEnded),this._net.enable(),this.autoConnect&&(this.context.connection.isConnected?this.connect():this.context.connection.beginListen(Xt.JoinedRoom,this.onJoinedRoom)),this.onEnabledChanged(),window.addEventListener("visibilitychange",this.onVisibilityChanged)}onDisable(){var t;this._net.stopSendingStream(this._outputStream),this._net.removeEventListener(fn.StreamReceived,this.onReceiveStream),this._net.removeEventListener(fn.StreamEnded,this.onStreamEnded),(t=this._net)==null||t.disable(),this.context.connection.stopListen(Xt.JoinedRoom,this.onJoinedRoom),this.onEnabledChanged(),window.removeEventListener("visibilitychange",this.onVisibilityChanged)}get isSending(){return this._outputStream!=null&&this._outputStream.active}async connect(t){if(this.context.connection.isConnected){if(!await tB())return console.error("Cannot connect to voice chat - microphone permissions not granted"),!1}else return console.error("Cannot connect to voice chat - not connected to server"),!1;return this._net.stopSendingStream(this._outputStream),Eh(this._outputStream),this._outputStream=await this.getAudioStream(t),this._outputStream?(this._net.startSendingStream(this._outputStream),!0):(await tB()?console.error("VOIP: Could not get audio stream - please make sure to connect an audio device and grant microphone permissions"):S8("Microphone permissions not granted: Please grant microphone permissions to use voice chat"),!1)}disconnect(){this._net.stopSendingStream(this._outputStream),Eh(this._outputStream),this._outputStream=null}setMuted(t){var s;const i=(s=this._outputStream)==null?void 0:s.getAudioTracks();if(i)for(const r of i)r.enabled=!t}get isMuted(){var i;if(this._outputStream===null)return!1;const t=(i=this._outputStream)==null?void 0:i.getAudioTracks();if(t){for(const s of t)if(!s.enabled)return!0}return!1}getFrequency(t){return this.unsupported_getfrequency||(this.unsupported_getfrequency=!0,Tt()&&gn("VOIP: getFrequency is currently not supported"),console.warn("VOIP: getFrequency is currently not supported")),null}async getAudioStream(t){return navigator.mediaDevices.getUserMedia?await navigator.mediaDevices.getUserMedia({audio:t??!0,video:!1}).catch(s=>(console.warn("VOIP failed getting audio stream",s),null)):(console.error("No getDisplayMedia support"),null)}}Rz([x()],Hp.prototype,"autoConnect",void 0);Rz([x()],Hp.prototype,"runInBackground",void 0);var Pz=globalThis&&globalThis.__decorate||function(n,e,t,i){var s=arguments.length,r=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(e,t,r):o(e,t))||r);return s>3&&r&&Object.defineProperty(e,t,r),r};const Yte=re("debugmouth");class Gx extends Te{constructor(){super(...arguments);u(this,"idle",[]);u(this,"talking",[]);u(this,"marker",null);u(this,"voip",null);u(this,"lastMouthChangeTime",0);u(this,"mouthChangeLength",0)}awake(){setTimeout(()=>{this.voip=le.findObjectOfType(Hp,this.context),this.marker||(this.marker=le.getComponentInParent(this.gameObject,ns))},3e3)}update(){var s;if(!this.voip||this.context.time.frameCount%10!==0)return;let t=((s=this.marker)==null?void 0:s.connectionId)??null;if(!t){Yte&&(t=null);return}const i=this.voip.getFrequency(t)??0;this.updateLips(i)}updateLips(t){if(this.context.time.time-this.lastMouthChangeTime>this.mouthChangeLength){if(this.mouthChangeLength=.05+Math.random()*.1,this.talking&&this.talking.length>0&&t>30){this.lastMouthChangeTime=this.context.time.time;const i=Math.floor(Math.random()*this.talking.length);this.setMouthShapeActive(this.talking,i)}else if(this.idle.length>0&&this.context.time.time-this.lastMouthChangeTime>.5){this.lastMouthChangeTime=this.context.time.time;const i=Math.floor(Math.random()*this.idle.length);this.setMouthShapeActive(this.idle,i)}}}setMouthShapeActive(t,i){if(t){t!=this.idle?this.idle.map(s=>s.visible=!1):this.talking.map(s=>s.visible=!1);for(let s=0;s<t.length;s++){const r=t[s];r&&(r.visible=s===i)}}}}Pz([x(ge)],Gx.prototype,"idle",void 0);Pz([x(ge)],Gx.prototype,"talking",void 0);class Bz extends Te{constructor(){super(...arguments);u(this,"voip",null);u(this,"marker",null);u(this,"_startPosition",null)}awake(){this.voip=le.findObjectOfType(Hp,this.context),this.marker=le.getComponentInParent(this.gameObject,ns)}update(){if(!this.voip||!this.marker||this.context.time.frameCount%10!==0)return;const t=this.marker.connectionId,i=this.voip.getFrequency(t);if(i==null)return;this._startPosition||(this._startPosition=this.gameObject.position.clone());const s=i/100;this.gameObject.position.y=this._startPosition.y+s*.07}}var Vx=globalThis&&globalThis.__decorate||function(n,e,t,i){var s=arguments.length,r=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(e,t,r):o(e,t))||r);return s>3&&r&&Object.defineProperty(e,t,r),r};class Qp extends Te{constructor(){super(...arguments);u(this,"eyes",[]);u(this,"lastBlinkTime",0);u(this,"blinkLength",0);u(this,"eyesOpen",!0);u(this,"state",null)}awake(){this.state=le.getComponentInParent(this.gameObject,bs)}update(){if(!this.gameObject||!this.gameObject.visible||!this.eyes||!Array.isArray(this.eyes)||this.eyes.length===0)return;if(this.context.time.time-this.lastBlinkTime>this.blinkLength){if(this.lastBlinkTime=this.context.time.time,this.state&&!this.state.isOn||!this.activeAndEnabled)return;if(this.eyesOpen=!this.eyesOpen,this.blinkLength=Math.random(),this.eyesOpen?(this.blinkLength*=3,this.blinkLength+=.5,Math.random()<.1&&(this.blinkLength=.1+Math.random()*.2)):(this.blinkLength*=Math.random()*.2,this.blinkLength+=.1),Math.random()<.1&&(this.blinkLength*=3),this.blinkLength=Math.max(.2,this.blinkLength),this.blinkLength=Math.min(3,this.blinkLength),this.eyes)for(const i of this.eyes)i&&(i.visible=this.eyesOpen)}}}Vx([x(ge)],Qp.prototype,"eyes",void 0);Vx([x()],Qp.prototype,"lastBlinkTime",void 0);Vx([x()],Qp.prototype,"blinkLength",void 0);Vx([x()],Qp.prototype,"eyesOpen",void 0);var yI=globalThis&&globalThis.__decorate||function(n,e,t,i){var s=arguments.length,r=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(e,t,r):o(e,t))||r);return s>3&&r&&Object.defineProperty(e,t,r),r};const pR=class extends Te{constructor(){super(...arguments);u(this,"head",null);u(this,"eyes",null);u(this,"target",null);u(this,"brain",null);u(this,"vec",new w);u(this,"currentTargetPoint",new w)}awake(){this.brain||(this.brain=le.getComponentInParent(this.gameObject,qb)),this.brain||(console.log("No look at brain found, adding it now"),this.brain=le.addNewComponent(this.gameObject,qb)),this.brain&&this.target&&(this.brain.controlledTarget=this.target)}update(){const t=this.target;if(t&&this.head){const i=this.eyes;if(i){const s=Ht(t);this.currentTargetPoint.lerp(s,this.context.time.deltaTime/.1);const r=Ht(this.head),o=this.vec.copy(this.currentTargetPoint).sub(r).normalize();if(o.length()<.1)return;const a=pR.forward;if(a.set(0,0,1),a.applyQuaternion(In(this.head)),a.dot(o)>.45)for(let l=0;l<i.length;l++)i[l].lookAt(this.currentTargetPoint)}}}};let Fh=pR;u(Fh,"forward",new w(0,0,1));yI([x(ge)],Fh.prototype,"head",void 0);yI([x(ge)],Fh.prototype,"eyes",void 0);yI([x(ge)],Fh.prototype,"target",void 0);const km=re("debugavatar");class bI{constructor(e,t,i,s){u(this,"root");u(this,"head");u(this,"leftHand");u(this,"rigthHand");var r;this.root=e,this.head=t,this.leftHand=i,this.rigthHand=s,(r=this.root)==null||r.traverse(o=>o.layers.set(2))}get isValid(){return this.head!==null&&this.head!==void 0}}class Dz{constructor(){u(this,"avatarRegistryUrl",null)}async getOrCreateNewAvatarInstance(e,t){if(!t)return console.error("Can not create avatar: failed to provide id or root object"),null;let i=null;if(typeof t=="string"){if(i=await this.loadAvatar(e,t),!i){const r=new _c;i=le.instantiate(sA(t,e.scene),r)}}else i=t;if(!i)return null;const s=this.findAvatar(i);return s.isValid?(km&&console.log("[Custom Avatar] valid config",t,km?s:""),s):(console.warn("[Custom Avatar] config isn't valid",t,km?s:""),null)}async loadAvatar(e,t){if(console.assert(t!=null&&typeof t=="string","Avatar id must not be null"),t.length<=0||!t)return null;if(km&&console.log("[Custom Avatar] "+t+", loading..."),t.endsWith(".glb")||(t+=".glb"),this.avatarRegistryUrl===null){const s=await fetch("./"+t);let r=null;if(s.ok){const a=await s.blob();a&&(r=await a.arrayBuffer())}if(!r&&(r=await ZF(t,t,0,"no url here go away",!0),!r))return null;const o=await mc().parseSync(e,r,null,0);return(o==null?void 0:o.scene)??null}const i=new Gp;return nv(i,e),new Promise((s,r)=>{const o=this.avatarRegistryUrl+"/"+t;i.load(o,async a=>{await mc().createBuiltinComponents(e,o,a,null,void 0),s(a.scene)},a=>{km&&console.log("[Custom Avatar] "+a.loaded/a.total*100+"% loaded of "+a.total/1024+"kB")},a=>{console.error("[Custom Avatar] Error when loading: "+a),s(null)})})}cacheModel(e,t){}findAvatar(e){const t=e;let i=t;i.children.length==1&&(i=e.children[0]);let s=this.findAvatarPart(i,["head"]);const r=this.findAvatarPart(i,["left","hand"]),o=this.findAvatarPart(i,["right","hand"]);if(!s){s=t;const c=new w;new Mi().setFromObject(s).getSize(c);const l=Math.max(c.x,c.y,c.z);console.warn("[Custom Avatar] Normalizing head scale, it's too big: "+l+" meters! Should be < 0.3m"),l>.3&&s.scale.multiplyScalar(1/l*.3)}return new bI(t,s,r,o)}findAvatarPart(e,t){const i=e.name.toLowerCase();let s=!0;for(const r of t){if(!s)break;i.indexOf(r)===-1&&(s=!1)}if(s)return e;if(e.children)for(const r of e.children){const o=this.findAvatarPart(r,t);if(o)return o}return null}handleCustomAvatarErrors(e){if(!e.ok)throw Error(e.statusText);return e}}var _I=globalThis&&globalThis.__decorate||function(n,e,t,i){var s=arguments.length,r=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(e,t,r):o(e,t))||r);return s>3&&r&&Object.defineProperty(e,t,r),r};class hv extends Te{constructor(){super(...arguments);u(this,"length",1);u(this,"depthTest",!0);u(this,"isGizmo",!0);u(this,"_axes",null)}onEnable(){if(this.isGizmo&&!jA)return;this._axes||(this._axes=new Fo(this.length)),this._axes.layers.disableAll(),this._axes.layers.set(this.layer),this.gameObject.add(this._axes);const t=this._axes.material;t&&t.depthTest!==void 0&&(t.depthTest=this.depthTest)}onDisable(){this._axes&&this.gameObject.remove(this._axes)}}_I([x()],hv.prototype,"length",void 0);_I([x()],hv.prototype,"depthTest",void 0);_I([x()],hv.prototype,"isGizmo",void 0);class Oz extends Te{constructor(){super(...arguments);u(this,"from");u(this,"to");u(this,"hint");u(this,"desiredDistance",1)}onEnable(){}update(){if(!this.from||!this.to||!this.hint)return;const t=Ht(this.to).clone(),i=Ht(this.from).clone(),s=t.distanceTo(i),r=t.clone();r.sub(i);const o=i.clone();o.add(t),o.multiplyScalar(.5);const a=Ht(this.hint).clone();a.sub(o);const c=new w;c.crossVectors(a,r),c.crossVectors(r,c),c.normalize();const l=s*.5,h=Math.max(this.desiredDistance,l),d=Math.sqrt(h*h-l*l),f=c.clone();f.multiplyScalar(d),f.add(o),vr(this.gameObject,f);const p=o.clone();p.sub(c),this.gameObject.lookAt(p)}}const Jte=re("debugusdz");class xI{constructor(){u(this,"behaviours",[]);u(this,"behaviourComponents",[]);u(this,"behaviourComponentsCopy",[])}get extensionName(){return"Behaviour"}addBehavior(e){this.behaviours.push(e)}onBeforeBuildDocument(e){const t=[];return e.root.traverse(i=>{le.foreachComponent(i,s=>{var o;const r=s;if(typeof r.createBehaviours=="function"||typeof r.beforeCreateDocument=="function"||typeof r.afterCreateDocument=="function"||typeof r.afterSerialize=="function"){this.behaviourComponents.push(r);const a=(o=r.beforeCreateDocument)==null?void 0:o.call(r,this,e);a instanceof Promise&&t.push(a)}},!1)}),Promise.all(t)}onExportObject(e,t,i){var s;for(const r of this.behaviourComponents)(s=r.createBehaviours)==null||s.call(r,this,t,i)}onAfterBuildDocument(e){for(const t of this.behaviourComponents)typeof t.afterCreateDocument=="function"&&t.afterCreateDocument(this,e);this.behaviourComponentsCopy=this.behaviourComponents.slice(),this.behaviourComponents.length=0}onAfterHierarchy(e,t){var i;if((i=this.behaviours)!=null&&i.length){t.beginBlock('def Scope "Behaviors"');for(const s of this.behaviours)s.writeTo(this,e.document,t);t.closeBlock()}}async onAfterSerialize(e){Jte&&console.log("onAfterSerialize behaviours",this.behaviourComponentsCopy);for(const t of this.behaviourComponentsCopy)typeof t.afterSerialize=="function"&&(t.afterSerialize.constructor.name==="AsyncFunction"?await t.afterSerialize(this,e):t.afterSerialize(this,e));this.behaviours.length=0}}var wI=globalThis&&globalThis.__decorate||function(n,e,t,i){var s=arguments.length,r=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(e,t,r):o(e,t))||r);return s>3&&r&&Object.defineProperty(e,t,r),r};class jp extends xr{constructor(){super(...arguments);u(this,"threshold");u(this,"intensity");u(this,"scatter");u(this,"selectiveBloom",!0)}get typeName(){return"Bloom"}init(){this.threshold.defaultValue=1,this.intensity.defaultValue=0,this.scatter.defaultValue=.2,this.selectiveBloom?(this.threshold.valueProcessor=t=>t,this.intensity.valueProcessor=t=>t,this.scatter.valueProcessor=t=>1*Math.PI*(1-t)):(this.threshold.valueProcessor=t=>t,this.intensity.valueProcessor=t=>t,this.scatter.valueProcessor=t=>100*(1-t))}onCreateEffect(){let t;if(this.selectiveBloom){const i=t=new HF(this.context.scene,this.context.mainCamera,{blendFunction:Gt.ADD,mipmapBlur:!0,luminanceThreshold:this.threshold.value,luminanceSmoothing:this.scatter.value,intensity:this.intensity.value});i.inverted=!0}else t=new u1;return this.intensity.onValueChanged=i=>{t.intensity=i},this.threshold.onValueChanged=i=>{t.luminanceMaterial.threshold=i},this.scatter.onValueChanged=i=>{t.luminancePass.enabled=!0,t.luminanceMaterial.smoothing=i},t}}wI([x(It)],jp.prototype,"threshold",void 0);wI([x(It)],jp.prototype,"intensity",void 0);wI([x(It)],jp.prototype,"scatter",void 0);_a("Bloom",jp);var Gr=globalThis&&globalThis.__decorate||function(n,e,t,i){var s=arguments.length,r=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(e,t,r):o(e,t))||r);return s>3&&r&&Object.defineProperty(e,t,r),r};class xa extends Te{constructor(){super(...arguments);u(this,"attachedRigidbody",null);u(this,"isTrigger",!1);u(this,"sharedMaterial");u(this,"membership",[0]);u(this,"filter");u(this,"updateProperties",()=>{var t;(t=this.context.physics.engine)==null||t.updateProperties(this)})}get isCollider(){return!0}awake(){super.awake(),this.attachedRigidbody||(this.attachedRigidbody=this.gameObject.getComponentInParent(ki))}start(){this.attachedRigidbody||(this.attachedRigidbody=this.gameObject.getComponentInParent(ki))}onEnable(){this.attachedRigidbody||(this.attachedRigidbody=this.gameObject.getComponentInParent(ki))}onDisable(){var t;(t=this.context.physics.engine)==null||t.removeBody(this)}get body(){var t;return(t=this.context.physics.engine)==null?void 0:t.getBody(this)}updatePhysicsMaterial(){var t;(t=this.context.physics.engine)==null||t.updatePhysicsMaterial(this)}}Gr([x(ki)],xa.prototype,"attachedRigidbody",void 0);Gr([x()],xa.prototype,"isTrigger",void 0);Gr([x()],xa.prototype,"sharedMaterial",void 0);Gr([x()],xa.prototype,"membership",void 0);Gr([x()],xa.prototype,"filter",void 0);class Hx extends xa{constructor(){super(...arguments);u(this,"radius",.5);u(this,"center",new w(0,0,0))}onEnable(){var t;super.onEnable(),(t=this.context.physics.engine)==null||t.addSphereCollider(this),t1(this.gameObject.scale,this.updateProperties)}onDisable(){super.onDisable(),aF(this.gameObject.scale,this.updateProperties)}onValidate(){this.updateProperties()}}Gr([Ks(),x()],Hx.prototype,"radius",void 0);Gr([x(w)],Hx.prototype,"center",void 0);class Qx extends xa{constructor(){super(...arguments);u(this,"size",new w(1,1,1));u(this,"center",new w(0,0,0))}onEnable(){var t;super.onEnable(),(t=this.context.physics.engine)==null||t.addBoxCollider(this,this.size),t1(this.gameObject.scale,this.updateProperties)}onDisable(){super.onDisable(),aF(this.gameObject.scale,this.updateProperties)}onValidate(){this.updateProperties()}}Gr([Ks(),x(w)],Qx.prototype,"size",void 0);Gr([x(w)],Qx.prototype,"center",void 0);class uv extends xa{constructor(){super(...arguments);u(this,"sharedMesh");u(this,"convex",!1)}onEnable(){var t,i,s,r,o;if(super.onEnable(),(t=this.sharedMesh)!=null&&t.isMesh||this.gameObject instanceof me&&(this.sharedMesh=this.gameObject),(i=this.sharedMesh)!=null&&i.isMesh)(s=this.context.physics.engine)==null||s.addMeshCollider(this,this.sharedMesh,this.convex,br(this.gameObject));else{const a=this.sharedMesh;if(a!=null&&a.isGroup){console.warn(`MeshCollider mesh is a group "${((r=this.sharedMesh)==null?void 0:r.name)||this.gameObject.name}", adding all children as colliders. This is currently not fully supported (colliders can not be removed from world again)`,this);for(const c in a.children){const l=a.children[c];l.isMesh&&((o=this.context.physics.engine)==null||o.addMeshCollider(this,l,this.convex,br(this.gameObject)))}}}}}Gr([x()],uv.prototype,"sharedMesh",void 0);Gr([x()],uv.prototype,"convex",void 0);class vd extends xa{constructor(){super(...arguments);u(this,"center",new w(0,0,0));u(this,"radius",.5);u(this,"height",2)}onEnable(){var t;super.onEnable(),(t=this.context.physics.engine)==null||t.addCapsuleCollider(this,this.height,this.radius)}}Gr([x(w)],vd.prototype,"center",void 0);Gr([x()],vd.prototype,"radius",void 0);Gr([x()],vd.prototype,"height",void 0);var SI=globalThis&&globalThis.__decorate||function(n,e,t,i){var s=arguments.length,r=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(e,t,r):o(e,t))||r);return s>3&&r&&Object.defineProperty(e,t,r),r};class Wp extends Te{constructor(){super(...arguments);u(this,"objectBounds",!1);u(this,"color");u(this,"isGizmo",!0);u(this,"_gizmoObject",null);u(this,"_boxHelper",null)}onEnable(){this.isGizmo&&!jA||(this._gizmoObject||(this.objectBounds?this._gizmoObject=new ZM(this.gameObject,this.color??16776960):(this.objectBounds=!1,this._gizmoObject=eI(this.color??16776960))),this.objectBounds?(this.scene.add(this._gizmoObject),this._boxHelper=this._gizmoObject,this.startCoroutine(this.syncObjectBounds(),jt.OnBeforeRender)):this.gameObject.add(this._gizmoObject))}onDisable(){this._gizmoObject&&this.gameObject.remove(this._gizmoObject)}*syncObjectBounds(){var t;for(;this._boxHelper;)(t=this._boxHelper)==null||t.update(),yield}}SI([x()],Wp.prototype,"objectBounds",void 0);SI([x(ye)],Wp.prototype,"color",void 0);SI([x()],Wp.prototype,"isGizmo",void 0);class Kte extends y3{constructor(e,t={}){super(e),e._simpleState__activeStates=[],e._simpleState__normalStyles={},e._simpleState__states=t,e._simpleState__statesProperties={};for(const i in t)for(const s in t[i])e._simpleState__statesProperties[s]||(e._simpleState__statesProperties[s]=[]),e._simpleState__statesProperties[s].push(i);for(const i of e._components)e._simpleState__statesProperties[i.id]&&(e._simpleState__normalStyles[i.id]=i.inline?i.inline:i._value);e.__overridedSet=e.set,e.set=this.storeSet.bind(e),e.renderStates=this.renderStates.bind(e),e.setupState=this.setupState.bind(e),e.setState=this.setState.bind(e),e.activatePseudoState=this.activatePseudoState.bind(e),e.deactivatePseudoState=this.deactivatePseudoState.bind(e),e.togglePseudoState=this.togglePseudoState.bind(e)}act(){}attach(){}detach(){}setupState(e,t){this._simpleState__states[e]=t;const i=[];for(const s in t)this._simpleState__statesProperties[s]||(this._simpleState__statesProperties[s]=[],i.push(s)),this._simpleState__statesProperties[s].push(e);for(const s of this._components)i.indexOf(s.id)>-1&&(this._simpleState__normalStyles[s.id]=s.inline?s.inline:s._value)}renderStates(){let e={...this._simpleState__normalStyles};for(const t in this._simpleState__states)this._simpleState__activeStates.indexOf(t)>-1&&(e={...e,...this._simpleState__states[t]});this.set(e,!1)}storeSet(e,t=!0){if(t)for(const i in e)this._simpleState__statesProperties[i]&&(this._simpleState__normalStyles[i]=e[i]);this.__overridedSet(e)}activatePseudoState(e){this._simpleState__activeStates.indexOf(e)===-1&&(this._simpleState__activeStates.push(e),this.renderStates())}deactivatePseudoState(e){const t=this._simpleState__activeStates.indexOf(e);t>-1&&(this._simpleState__activeStates.splice(t,1),this.renderStates())}togglePseudoState(e){const t=this._simpleState__activeStates.indexOf(e);t>-1?this._simpleState__activeStates.splice(t,1):this._simpleState__activeStates.push(e),this.renderStates()}setState(e){Array.isArray(e)?this._simpleState__activeStates=e:this._simpleState__activeStates=[e],this.renderStates()}}var kz=globalThis&&globalThis.__decorate||function(n,e,t,i){var s=arguments.length,r=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(e,t,r):o(e,t))||r);return s>3&&r&&Object.defineProperty(e,t,r),r};class dv extends Te{constructor(){super(...arguments);u(this,"effectColor");u(this,"effectDistance")}}kz([x(Ii)],dv.prototype,"effectColor",void 0);kz([x(ie)],dv.prototype,"effectDistance",void 0);var fv=globalThis&&globalThis.__decorate||function(n,e,t,i){var s=arguments.length,r=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(e,t,r):o(e,t))||r);return s>3&&r&&Object.defineProperty(e,t,r),r};const mC=re("debugui"),gC=re("debuguilayout");class Lz{constructor(){u(this,"width");u(this,"height")}}class Fz{constructor(){u(this,"x");u(this,"y");u(this,"width");u(this,"height")}}const Jo=new w,Lm=new Ce,Zy=new Me;class Ys extends Ac{constructor(){super(...arguments);u(this,"_anchoredPosition");u(this,"sizeDelta",new ie(100,100));u(this,"pivot",new ie(.5,.5));u(this,"anchorMin",new ie(0,0));u(this,"anchorMax",new ie(1,1));u(this,"minWidth");u(this,"minHeight");u(this,"lastMatrix");u(this,"rectBlock");u(this,"_transformNeedsUpdate",!1);u(this,"_initialPosition");u(this,"_parentRectTransform");u(this,"_lastUpdateFrame",-1);u(this,"_lastAnchoring");u(this,"_createdBlocks",[]);u(this,"_createdTextBlocks",[])}get parent(){return this._parentRectTransform}get translation(){return this.gameObject.position}get rotation(){return this.gameObject.quaternion}get scale(){return this.gameObject.scale}get anchoredPosition(){return this._anchoredPosition||(this._anchoredPosition=new ie),this._anchoredPosition}set anchoredPosition(t){this._anchoredPosition=t}get width(){let t=this.sizeDelta.x;if(this.anchorMin.x!==this.anchorMax.x&&this._parentRectTransform){const i=this._parentRectTransform.width,s=this.anchorMax.x-this.anchorMin.x;t=i*s,t+=this.sizeDelta.x}return this.minWidth!==void 0&&t<this.minWidth?this.minWidth:t}get height(){let t=this.sizeDelta.y;if(this.anchorMin.y!==this.anchorMax.y&&this._parentRectTransform){const i=this._parentRectTransform.height,s=this.anchorMax.y-this.anchorMin.y;t=i*s,t+=this.sizeDelta.y}return this.minHeight!==void 0&&t<this.minHeight?this.minHeight:t}awake(){super.awake(),this._anchoredPosition||(this._anchoredPosition=new ie),this.lastMatrix=new Ce,this.rectBlock=new ge,this.rectBlock.name=this.name,this._initialPosition=this.gameObject.position.clone(),this._initialPosition.z=0,wf(this,"_anchoredPosition",()=>{this.markDirty()}),wf(this,"sizeDelta",()=>{this.markDirty()}),wf(this,"pivot",()=>{this.markDirty()}),wf(this,"anchorMin",()=>{this.markDirty()}),wf(this,"anchorMax",()=>{this.markDirty()})}onEnable(){var t;super.onEnable(),this.addShadowComponent(this.rectBlock),this._transformNeedsUpdate=!0,(t=this.Canvas)==null||t.registerTransform(this)}onDisable(){var t;super.onDisable(),this.removeShadowComponent(),(t=this.Canvas)==null||t.unregisterTransform(this)}onParentRectTransformChanged(t){this._transformNeedsUpdate||this.onApplyTransform(gC?`${t.name} changed`:void 0)}get isDirty(){return this._transformNeedsUpdate||(this._transformNeedsUpdate=!this.lastMatrix.equals(this.gameObject.matrix)),this._transformNeedsUpdate}markDirty(){this._transformNeedsUpdate||(gC&&console.warn("RectTransform markDirty()",this.name),this._transformNeedsUpdate=!0,this._lastUpdateFrame=-1)}updateTransform(){(this._transformNeedsUpdate||!this.lastMatrix.equals(this.gameObject.matrix))&&this.canUpdate()&&this.onApplyTransform(this._transformNeedsUpdate?"Marked dirty":"Matrix changed")}canUpdate(){return this._transformNeedsUpdate&&this.activeAndEnabled&&this._lastUpdateFrame!==this.context.time.frame}onApplyTransform(t){var r;if(this.context.time.frameCount===this._lastUpdateFrame)return;this._lastUpdateFrame=this.context.time.frameCount;const i=this.shadowComponent;if(!i)return;this.gameObject.parent?this._parentRectTransform=le.getComponentInParent(this.gameObject.parent,Ys):this._parentRectTransform=void 0,this._transformNeedsUpdate=!1,gC&&console.warn("RectTransform  ApplyTransform",this.name+" because "+t),this.isRoot()?this.Root.screenspace||(i.rotation.y=Math.PI):(i.matrix.identity(),i.matrixAutoUpdate=!1,Jo.set(0,0,0),this.applyPivot(Jo),i.matrix.setPosition(Jo.x,Jo.y,0),(this.gameObject.quaternion.x||this.gameObject.quaternion.y||this.gameObject.quaternion.z)&&(Zy.copy(this.gameObject.quaternion),Zy.x*=-1,Zy.z*=-1,Lm.makeRotationFromQuaternion(Zy),i.matrix.premultiply(Lm)),Jo.set(0,0,0),this.applyAnchoring(Jo),(r=this.Canvas)!=null&&r.screenspace?Jo.z+=.1:Jo.z+=.01,Lm.identity(),Lm.setPosition(Jo.x,Jo.y,Jo.z),i.matrix.premultiply(Lm),i.matrix.scale(this.gameObject.scale)),this.lastMatrix.copy(this.gameObject.matrix);const s=!0;for(const o of O3(this.gameObject,Ac,s,1)){if(o===this||!o.activeAndEnabled)continue;const a=o;a.onParentRectTransformChanged&&a.onParentRectTransformChanged(this)}}applyAnchoring(t){this._lastAnchoring||(this._lastAnchoring=new ie);const i=this._lastAnchoring.sub(this._anchoredPosition);this.gameObject.position.x+=i.x,this.gameObject.position.y+=i.y,this._lastAnchoring.copy(this._anchoredPosition),t.x+=this._initialPosition.x-this.gameObject.position.x,t.y+=this._initialPosition.y-this.gameObject.position.y,t.z+=this._initialPosition.z-this.gameObject.position.z;const s=this._parentRectTransform;if(s){let r=0;const o=1-this.anchorMax.y-this.anchorMin.y;r-=s.height*.5*o,t.y+=r;let a=0;const c=1-this.anchorMax.x-this.anchorMin.x;a-=s.width*.5*c,t.x+=a}}applyPivot(t){if(this.pivot&&!this.isRoot()){const i=this.pivot.x-.5;t.x-=i*this.sizeDelta.x*this.gameObject.scale.x;const s=this.pivot.y-.5;t.y-=s*this.sizeDelta.y*this.gameObject.scale.y}}getBasicOptions(){const t={width:this.sizeDelta.x,height:this.sizeDelta.y,offset:0,backgroundOpacity:0,borderWidth:0,borderRadius:0,borderOpacity:0,letterSpacing:-.03};return this.ensureValidSize(t),t}ensureValidSize(t,i=1e-4){return t.width<=0&&(t.width=i),t.height<=0&&(t.height=1e-4),t}createNewBlock(t){t={...this.getBasicOptions(),...t},mC&&console.log(this.name,t);const i=new K1(t);return this._createdBlocks.push(i),i}createNewText(t){mC&&console.log(t),t={...this.getBasicOptions(),...t},mC&&console.log(this.name,t);const i=new Z1(t);return this._createdTextBlocks.push(i),i}}fv([x(ie)],Ys.prototype,"anchoredPosition",null);fv([x(ie)],Ys.prototype,"sizeDelta",void 0);fv([x(ie)],Ys.prototype,"pivot",void 0);fv([x(ie)],Ys.prototype,"anchorMin",void 0);fv([x(ie)],Ys.prototype,"anchorMax",void 0);var Uz=globalThis&&globalThis.__decorate||function(n,e,t,i){var s=arguments.length,r=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(e,t,r):o(e,t))||r);return s>3&&r&&Object.defineProperty(e,t,r),r};const $y={backgroundColor:new ye(1,1,1),backgroundOpacity:1,borderColor:new ye(1,1,1),borderOpacity:1},Ng=class extends Ac{constructor(){super(...arguments);u(this,"_alphaFactor",1);u(this,"sRGBColor",new ye(1,0,1));u(this,"raycastTarget",!0);u(this,"uiObject",null);u(this,"_color",null);u(this,"_rect",null);u(this,"_stateManager",null);u(this,"_currentlyCreatingPanel",!1)}get isGraphic(){return!0}get color(){return this._color||(this._color=new Ii(1,1,1,1)),this._color}set color(t){(!this._color||this._color.r!==t.r||this._color.g!==t.g||this._color.b!==t.b||this._color.alpha!==t.alpha)&&(this._color||(this._color=new Ii(1,1,1,1)),this._color.copy(t),this.onColorChanged())}setAlphaFactor(t){this._alphaFactor=t,this.onColorChanged()}get alphaFactor(){return this._alphaFactor}onColorChanged(){this.uiObject&&(this.sRGBColor.copy(this._color),this.sRGBColor.convertLinearToSRGB(),$y.backgroundColor=this.sRGBColor,$y.backgroundOpacity=this._color.alpha*this._alphaFactor,this.applyEffects($y,this._alphaFactor),this.uiObject.set($y),this.markDirty())}get m_Color(){return this._color}get rectTransform(){if(this._rect||(this._rect=le.getComponent(this.gameObject,Ys)),!this._rect)throw new Error("Not Supported: Make sure to add a RectTransform component before adding a UI Graphic component.");return this._rect}onParentRectTransformChanged(){var t;(t=this.uiObject)==null||t.set({width:this.rectTransform.width,height:this.rectTransform.height}),this.markDirty()}__internalNewInstanceCreated(){super.__internalNewInstanceCreated(),this._rect=null,this.uiObject=null,this._color&&(this._color=this._color.clone())}setState(t){this.makePanel(),this.uiObject&&(this.uiObject.setState(t),this==null||this.markDirty())}setupState(t){this.makePanel(),this.uiObject&&(this._stateManager||(this._stateManager=new Kte(this.uiObject)),this.uiObject.setupState(t.state,t.attributes))}setOptions(t){this.makePanel(),this.uiObject&&this.uiObject.set(t)}awake(){super.awake(),this.makePanel(),wf(this,"_color",()=>mte(this,this.onColorChanged))}onEnable(){var t;super.onEnable(),this.uiObject&&((t=this.rectTransform.shadowComponent)==null||t.add(this.uiObject),this.addShadowComponent(this.uiObject,this.rectTransform))}onDisable(){super.onDisable(),this.uiObject&&this.removeShadowComponent()}makePanel(){if(this.uiObject||this._currentlyCreatingPanel)return;this._currentlyCreatingPanel=!0;const t=.015,i={backgroundColor:this.color,backgroundOpacity:this.color.alpha,offset:t};this.onBeforeCreate(i),this.applyEffects(i),this.onCreate(i),this.controlsChildLayout=!1,this._currentlyCreatingPanel=!1,this.onAfterCreated(),this.onColorChanged()}onBeforeCreate(t){}onCreate(t){this.uiObject=this.rectTransform.createNewBlock(t),this.uiObject.name=this.name}onAfterCreated(){}applyEffects(t,i=1){var r;const s=(r=this.gameObject)==null?void 0:r.getComponent(dv);s&&(s.effectDistance&&(t.borderWidth=Math.max(Math.abs(s.effectDistance.x),Math.abs(s.effectDistance.y))),s.effectColor&&(t.borderColor=s.effectColor,t.borderOpacity=s.effectColor.alpha*i))}async setTexture(t){if(this.setOptions({backgroundOpacity:0}),t){if(Ng.textureCache.has(t))t=Ng.textureCache.get(t);else if(!t.isRenderTargetTexture){const i=t.clone();i.colorSpace=Ri,Ng.textureCache.set(t,i),t=i}this.setOptions({backgroundImage:t,borderRadius:0,backgroundOpacity:this.color.alpha,backgroundSize:"stretch"})}else this.setOptions({backgroundImage:null,borderRadius:0,backgroundOpacity:this.color.alpha});this.markDirty()}onAfterAddedToScene(){super.onAfterAddedToScene(),this.shadowComponent&&(this.shadowComponent.offset=this.shadowComponent.position.z)}};let vl=Ng;u(vl,"textureCache",new Map);Uz([x(Ii)],vl.prototype,"color",null);Uz([x()],vl.prototype,"raycastTarget",void 0);class jx extends vl{constructor(){super(...arguments);u(this,"_flippedObject",!1)}onAfterCreated(){this.uiObject&&!this._flippedObject&&(this._flippedObject=!0,this.uiObject.scale.y*=-1)}}var Wx=globalThis&&globalThis.__decorate||function(n,e,t,i){var s=arguments.length,r=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(e,t,r):o(e,t))||r);return s>3&&r&&Object.defineProperty(e,t,r),r};let CI=class{constructor(){u(this,"texture",null);u(this,"rect")}};Wx([x(Ft)],CI.prototype,"texture",void 0);let Ll=class extends jx{constructor(){super(...arguments);u(this,"_sprite");u(this,"pixelsPerUnitMultiplier",1)}set image(t){this.sprite||(this.sprite=new CI),this.sprite.texture=t,this.onAfterCreated()}get image(){return this.sprite?this.sprite.texture:null}get sprite(){return this._sprite}set sprite(t){this._sprite!==t&&(this._sprite=t,this.onAfterCreated())}isBuiltinSprite(){var t,i,s,r,o,a,c,l,h,d,f;switch((i=(t=this.sprite)==null?void 0:t.texture)==null?void 0:i.name){case"InputFieldBackground":case"UISprite":case"Background":case"Knob":return!0}return!((o=(r=(s=this.sprite)==null?void 0:s.texture)==null?void 0:r.name)!=null&&o.length)&&((l=(c=(a=this.sprite)==null?void 0:a.texture)==null?void 0:c.image)==null?void 0:l.width)===32&&((f=(d=(h=this.sprite)==null?void 0:h.texture)==null?void 0:d.image)==null?void 0:f.height)===32}onBeforeCreate(t){var i,s;super.onBeforeCreate(t),this.isBuiltinSprite()&&(t.borderRadius=5/this.pixelsPerUnitMultiplier,((s=(i=this.sprite)==null?void 0:i.texture)==null?void 0:s.name)==="Knob"&&(t.borderRadius=999))}onAfterCreated(){var t;this.__didAwake&&(super.onAfterCreated(),!this.isBuiltinSprite()&&this.setTexture((t=this.sprite)==null?void 0:t.texture))}};Wx([x(CI)],Ll.prototype,"sprite",null);Wx([x()],Ll.prototype,"pixelsPerUnitMultiplier",void 0);class EI extends jx{constructor(){super(...arguments);u(this,"_mainTexture")}get mainTexture(){return this._mainTexture}set mainTexture(t){this._mainTexture!==t&&(this._mainTexture=t,this.onAfterCreated())}onAfterCreated(){this.__didAwake&&(super.onAfterCreated(),this.setTexture(this.mainTexture))}}Wx([x(Ft)],EI.prototype,"mainTexture",null);var ao=globalThis&&globalThis.__decorate||function(n,e,t,i){var s=arguments.length,r=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(e,t,r):o(e,t))||r);return s>3&&r&&Object.defineProperty(e,t,r),r};const bu=re("debugbutton");var Ua;(function(n){n[n.None=0]="None",n[n.ColorTint=1]="ColorTint",n[n.SpriteSwap=2]="SpriteSwap",n[n.Animation=3]="Animation"})(Ua||(Ua={}));class Sd{constructor(){u(this,"colorMultiplier");u(this,"disabledColor");u(this,"fadeDuration");u(this,"highlightedColor");u(this,"normalColor");u(this,"pressedColor");u(this,"selectedColor")}}ao([x()],Sd.prototype,"colorMultiplier",void 0);ao([x(Ii)],Sd.prototype,"disabledColor",void 0);ao([x()],Sd.prototype,"fadeDuration",void 0);ao([x(Ii)],Sd.prototype,"highlightedColor",void 0);ao([x(Ii)],Sd.prototype,"normalColor",void 0);ao([x(Ii)],Sd.prototype,"pressedColor",void 0);ao([x(Ii)],Sd.prototype,"selectedColor",void 0);class $h extends Te{constructor(){super(...arguments);u(this,"onClick");u(this,"_isHovered",0);u(this,"colors");u(this,"transition");u(this,"animationTriggers");u(this,"animator");u(this,"_interactable",!0);u(this,"_requestedAnimatorTrigger");u(this,"_isInit",!1);u(this,"_image")}onPointerEnter(t){var i,s;this._isHovered+=1,bu&&console.warn("Button Enter",this._isHovered,(i=this.animationTriggers)==null?void 0:i.highlightedTrigger,this.animator),this.interactable&&(this.transition==Ua.Animation&&this.animationTriggers&&this.animator?this.animator.setTrigger(this.animationTriggers.highlightedTrigger):this.transition===Ua.ColorTint&&this.colors&&((s=this._image)==null||s.setState("hovered")),this.context.input.setCursorPointer())}onPointerExit(){var t,i;this._isHovered-=1,bu&&console.log("Button Exit",this._isHovered,(t=this.animationTriggers)==null?void 0:t.highlightedTrigger,this.animator),this.interactable&&(this._isHovered>0||(this._isHovered=0,this.transition==Ua.Animation&&this.animationTriggers&&this.animator?this.animator.setTrigger(this.animationTriggers.normalTrigger):this.transition===Ua.ColorTint&&this.colors&&((i=this._image)==null||i.setState("normal")),this.context.input.setCursorNormal()))}onPointerDown(t){var i,s;bu&&console.log("Button Down",(i=this.animationTriggers)==null?void 0:i.highlightedTrigger,this.animator),this.interactable&&(this.transition==Ua.Animation&&this.animationTriggers&&this.animator?this.animator.setTrigger(this.animationTriggers.pressedTrigger):this.transition===Ua.ColorTint&&this.colors&&((s=this._image)==null||s.setState("pressed")))}onPointerUp(t){var i,s;bu&&console.warn("Button Up",(i=this.animationTriggers)==null?void 0:i.highlightedTrigger,this.animator,this._isHovered),this.interactable&&(this.transition==Ua.Animation&&this.animationTriggers&&this.animator?this.animator.setTrigger(this._isHovered?this.animationTriggers.highlightedTrigger:this.animationTriggers.normalTrigger):this.transition===Ua.ColorTint&&this.colors&&((s=this._image)==null||s.setState(this._isHovered?"hovered":"normal")))}onPointerClick(t){if(this.interactable&&!(t.button!==0&&t.event.pointerType===zs.Mouse)&&(bu&&(console.warn("Button Click",this.onClick),Tn("CLICKED button "+this.name+" at "+this.context.time.frameCount)),this.onClick&&this.onClick.listenerCount>0&&(this.onClick.invoke(),t.use(),bu))){const i=this.gameObject.worldPosition;i.add(this.gameObject.worldUp.multiplyScalar(1+Math.random()*.5)),kt.DrawLabel(i,"CLICK:"+Date.now(),.1,1+Math.random()*.5)}}set interactable(t){this._interactable=t,this._image&&(this._image.setInteractable(t),t?this._image.setState("normal"):this._image.setState("disabled"))}get interactable(){return this._interactable}set_interactable(t){this.interactable=t}awake(){super.awake(),bu&&console.log(this),this._isInit=!1,this.init()}start(){var t;(t=this._image)==null||t.setInteractable(this.interactable),this.gameObject.getComponentInParent(av)||this.gameObject.addComponent(hI)}onEnable(){super.onEnable()}onDestroy(){this._isHovered&&this.context.input.setCursorNormal()}*setAnimatorTriggerAtEndOfFrame(t){var i;this._requestedAnimatorTrigger=t,yield,yield,this._requestedAnimatorTrigger==t&&((i=this.animator)==null||i.SetTrigger(t))}init(){this._isInit||(this._isInit=!0,this._image=le.getComponent(this.gameObject,Ll),this._image&&(this.stateSetup(this._image),this.interactable?this._image.setState("normal"):this._image.setState("disabled")))}stateSetup(t){var p,m,g,y,A;t.setInteractable(this.interactable);const i=this.getFinalColor(t.color,(p=this.colors)==null?void 0:p.normalColor),s={state:"normal",attributes:{backgroundColor:i,backgroundOpacity:i.alpha}};t.setupState(s);const r=this.getFinalColor(t.color,(m=this.colors)==null?void 0:m.highlightedColor),o={state:"hovered",attributes:{backgroundColor:r,backgroundOpacity:r.alpha}};t.setupState(o);const a=this.getFinalColor(t.color,(g=this.colors)==null?void 0:g.pressedColor),c={state:"pressed",attributes:{backgroundColor:a,backgroundOpacity:a.alpha}};t.setupState(c);const l=this.getFinalColor(t.color,(y=this.colors)==null?void 0:y.selectedColor),h={state:"selected",attributes:{backgroundColor:l,backgroundOpacity:l.alpha}};t.setupState(h);const d=this.getFinalColor(t.color,(A=this.colors)==null?void 0:A.disabledColor),f={state:"disabled",attributes:{backgroundColor:d,backgroundOpacity:d.alpha}};t.setupState(f)}getFinalColor(t,i){return i?t.clone().multiply(i).convertLinearToSRGB():t.clone().convertLinearToSRGB()}}ao([x(Cs)],$h.prototype,"onClick",void 0);ao([x()],$h.prototype,"colors",void 0);ao([x()],$h.prototype,"transition",void 0);ao([x()],$h.prototype,"animationTriggers",void 0);ao([x(Xs)],$h.prototype,"animator",void 0);ao([x()],$h.prototype,"interactable",null);var Un=globalThis&&globalThis.__decorate||function(n,e,t,i){var s=arguments.length,r=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(e,t,r):o(e,t))||r);return s>3&&r&&Object.defineProperty(e,t,r),r};const GO=re("debuguilayout");class Cd{constructor(){u(this,"left",0);u(this,"right",0);u(this,"top",0);u(this,"bottom",0)}get vertical(){return this.top+this.bottom}get horizontal(){return this.left+this.right}}Un([x()],Cd.prototype,"left",void 0);Un([x()],Cd.prototype,"right",void 0);Un([x()],Cd.prototype,"top",void 0);Un([x()],Cd.prototype,"bottom",void 0);var DT;(function(n){n[n.UpperLeft=0]="UpperLeft",n[n.UpperCenter=1]="UpperCenter",n[n.UpperRight=2]="UpperRight",n[n.MiddleLeft=3]="MiddleLeft",n[n.MiddleCenter=4]="MiddleCenter",n[n.MiddleRight=5]="MiddleRight",n[n.LowerLeft=6]="LowerLeft",n[n.LowerCenter=7]="LowerCenter",n[n.LowerRight=8]="LowerRight",n[n.Custom=9]="Custom"})(DT||(DT={}));var rd;(function(n){n.Horizontal="x",n.Vertical="y"})(rd||(rd={}));class co extends Te{constructor(){super(...arguments);u(this,"_rectTransform",null);u(this,"_needsUpdate",!1);u(this,"childAlignment",DT.UpperLeft);u(this,"reverseArrangement",!1);u(this,"spacing",0);u(this,"padding");u(this,"minWidth",0);u(this,"minHeight",0);u(this,"flexibleHeight",0);u(this,"flexibleWidth",0);u(this,"preferredHeight",0);u(this,"preferredWidth",0)}get rectTransform(){return this._rectTransform}onParentRectTransformChanged(t){this._needsUpdate=!0}get isDirty(){return this._needsUpdate}get isLayoutGroup(){return!0}updateLayout(){this._rectTransform&&(GO&&console.warn("Layout Update",this.context.time.frame,this.name),this._needsUpdate=!1,this.onCalculateLayout(this._rectTransform))}start(){this._needsUpdate=!0}onEnable(){GO&&console.log(this.name,this),this._rectTransform=this.gameObject.getComponent(Ys);const t=this.gameObject.getComponentInParent(as);t&&t.registerLayoutGroup(this),this._needsUpdate=!0}onDisable(){const t=this.gameObject.getComponentInParent(as);t&&t.unregisterLayoutGroup(this)}set m_Spacing(t){t!==this.spacing&&(this._needsUpdate=!0,this.spacing=t)}get m_Spacing(){return this.spacing}}Un([x()],co.prototype,"childAlignment",void 0);Un([x()],co.prototype,"reverseArrangement",void 0);Un([x()],co.prototype,"spacing",void 0);Un([x(Cd)],co.prototype,"padding",void 0);Un([x()],co.prototype,"minWidth",void 0);Un([x()],co.prototype,"minHeight",void 0);Un([x()],co.prototype,"flexibleHeight",void 0);Un([x()],co.prototype,"flexibleWidth",void 0);Un([x()],co.prototype,"preferredHeight",void 0);Un([x()],co.prototype,"preferredWidth",void 0);class eu extends co{constructor(){super(...arguments);u(this,"childControlHeight",!0);u(this,"childControlWidth",!0);u(this,"childForceExpandHeight",!1);u(this,"childForceExpandWidth",!1);u(this,"childScaleHeight",!1);u(this,"childScaleWidth",!1)}onCalculateLayout(t){var I;const i=this.primaryAxis,s=t.width;let r=s;const o=t.height;let a=o;r-=this.padding.horizontal,a-=this.padding.vertical,i===rd.Horizontal?this.padding.horizontal:this.padding.vertical;const c=i===rd.Horizontal,l=c?"y":"x",h=c?this.childControlWidth:this.childControlHeight,d=c?this.childControlHeight:this.childControlWidth,f=c?this.childForceExpandWidth:this.childForceExpandHeight,p=c?this.childForceExpandHeight:this.childForceExpandWidth,m=c?a:r,g=c?s:o,y=.5*(c?this.childAlignment%3:Math.floor(this.childAlignment/3));let A=0;c?A+=this.padding.left:A+=this.padding.top;let v=0,b=0;for(let S=0;S<this.gameObject.children.length;S++){const C=this.gameObject.children[S],D=le.getComponent(C,Ys);D!=null&&D.activeAndEnabled&&(b+=1,c?v+=D.width:v+=D.height)}let _=0;const T=this.spacing*(b-1);if(f||h){let S=0;c?S=r-=T:S=a-=T,b>0&&(_=S/b)}let E=0;E+=this.padding.left,E-=this.padding.right,y!==0&&(A=g-v,A*=y,A-=T*y,c?(A-=this.padding.right*y,A+=this.padding.left*(1-y),A<this.padding.left&&(A=this.padding.left)):(A-=this.padding.bottom*y,A+=this.padding.top*(1-y),A<this.padding.top&&(A=this.padding.top)));let M=1;for(let S=0;S<this.gameObject.children.length;S++){const C=this.gameObject.children[S],D=le.getComponent(C,Ys);if(D!=null&&D.activeAndEnabled){(I=D.pivot)==null||I.set(.5,.5),D.anchorMin.set(0,1),D.anchorMax.set(0,1);const G=s*.5+E*.5;D.anchoredPosition.x!==G&&(D.anchoredPosition.x=G);const Q=o*-.5;D.anchoredPosition.y!==Q&&(D.anchoredPosition.y=Q),p&&d&&D.sizeDelta[l]!==m&&(D.sizeDelta[l]=m),f&&h&&D.sizeDelta[i]!==_&&(D.sizeDelta[i]=_);const L=c?D.width:D.height,V=L*.5;if(A+=V,f){const U=_*M-_*.5;U>A&&(A=U-_*.5+L+this.padding.left,A-=V)}let O=A;i===rd.Vertical&&(O=-O),D.anchoredPosition[i]!==O&&(D.anchoredPosition[i]=O),A+=V,A+=this.spacing,M+=1}}}}Un([x()],eu.prototype,"childControlHeight",void 0);Un([x()],eu.prototype,"childControlWidth",void 0);Un([x()],eu.prototype,"childForceExpandHeight",void 0);Un([x()],eu.prototype,"childForceExpandWidth",void 0);Un([x()],eu.prototype,"childScaleHeight",void 0);Un([x()],eu.prototype,"childScaleWidth",void 0);class Nz extends eu{get primaryAxis(){return rd.Vertical}}class zz extends eu{get primaryAxis(){return rd.Horizontal}}class Gz extends co{onCalculateLayout(){}}var wc=globalThis&&globalThis.__decorate||function(n,e,t,i){var s=arguments.length,r=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(e,t,r):o(e,t))||r);return s>3&&r&&Object.defineProperty(e,t,r),r},Qa;(function(n){n[n.ScreenSpaceOverlay=0]="ScreenSpaceOverlay",n[n.ScreenSpaceCamera=1]="ScreenSpaceCamera",n[n.WorldSpace=2]="WorldSpace",n[n.Undefined=-1]="Undefined"})(Qa||(Qa={}));const AC=re("debuguilayout");class as extends Px{constructor(){super(...arguments);u(this,"_renderOnTop");u(this,"_depthWrite",!1);u(this,"_doubleSided",!0);u(this,"_castShadows",!1);u(this,"_receiveShadows",!1);u(this,"_renderMode",Qa.Undefined);u(this,"_rootCanvas");u(this,"_scaleFactor",1);u(this,"worldCamera");u(this,"planeDistance",-1);u(this,"_boundRenderSettingsChanged",this.onRenderSettingsChanged.bind(this));u(this,"previousParent",null);u(this,"_lastMatrixWorld",null);u(this,"_rectTransforms",[]);u(this,"_layoutGroups",new Map);u(this,"_receivers",[]);u(this,"onBeforeRenderRoutine",()=>{var t,i,s,r;if(this.previousParent=this.gameObject.parent,((t=this.context.xr)!=null&&t.isVR||(i=this.context.xr)!=null&&i.isPassThrough)&&this.screenspace){this.gameObject.visible=!1,this.gameObject.removeFromParent();return}this.renderOnTop||this.screenspace?this.gameObject.removeFromParent():(this.onUpdateRenderMode(),this.handleLayoutUpdates(),(s=this.shadowComponent)==null||s.updateMatrixWorld(!0),(r=this.shadowComponent)==null||r.updateWorldMatrix(!0,!0),this.invokeBeforeRenderEvents(),$r.ensureUpdateMeshUI(ID,this.context))});u(this,"onAfterRenderRoutine",()=>{var t,i,s,r,o;if(((t=this.context.xr)!=null&&t.isVR||(i=this.context.xr)!=null&&i.isPassThrough)&&this.screenspace){(s=this.previousParent)==null||s.add(this.gameObject);return}if((this.screenspace||this.renderOnTop)&&this.previousParent&&this.context.mainCamera){if(this.screenspace){const l=this.context.mainCamera;l==null||l.add(this.gameObject)}else this.previousParent.add(this.gameObject);const a=this.context.renderer.autoClear,c=this.context.renderer.autoClearColor;this.context.renderer.autoClear=!1,this.context.renderer.autoClearColor=!1,this.context.renderer.clearDepth(),this.onUpdateRenderMode(!0),this.handleLayoutUpdates(),(r=this.shadowComponent)==null||r.updateMatrixWorld(!0),this.invokeBeforeRenderEvents(),$r.ensureUpdateMeshUI(ID,this.context,!0),this.context.renderer.render(this.gameObject,this.context.mainCamera),this.context.renderer.autoClear=a,this.context.renderer.autoClearColor=c,this.previousParent.add(this.gameObject)}(o=this._lastMatrixWorld)==null||o.copy(this.gameObject.matrixWorld)});u(this,"_updateRenderSettingsRoutine");u(this,"_activeRenderMode",-1);u(this,"_lastWidth",-1);u(this,"_lastHeight",-1)}get isCanvas(){return!0}get screenspace(){return this.renderMode!==Qa.WorldSpace}set renderOnTop(t){t!==this._renderOnTop&&(this._renderOnTop=t,this.onRenderSettingsChanged())}get renderOnTop(){return this._renderOnTop!==void 0?this._renderOnTop:!!(this.screenspace&&this._renderMode===Qa.ScreenSpaceOverlay)}set depthWrite(t){this._depthWrite!==t&&(this._depthWrite=t,this.onRenderSettingsChanged())}get depthWrite(){return this._depthWrite}set doubleSided(t){this._doubleSided!==t&&(this._doubleSided=t,this.onRenderSettingsChanged())}get doubleSided(){return this._doubleSided}set castShadows(t){this._castShadows!==t&&(this._castShadows=t,this.onRenderSettingsChanged())}get castShadows(){return this._castShadows}set receiveShadows(t){this._receiveShadows!==t&&(this._receiveShadows=t,this.onRenderSettingsChanged())}get receiveShadows(){return this._receiveShadows}get renderMode(){return this._renderMode}set renderMode(t){this._renderMode!==t&&(this._renderMode=t,this.onRenderSettingsChanged())}set rootCanvas(t){this._rootCanvas instanceof as||(this._rootCanvas=t)}get rootCanvas(){return this._rootCanvas}get scaleFactor(){return this._scaleFactor}set scaleFactor(t){this._scaleFactor=t}awake(){var t;this.shadowComponent=this.gameObject,this.previousParent=this.gameObject.parent,AC&&console.log("Canvas.Awake()",((t=this.previousParent)==null?void 0:t.name)+"/"+this.gameObject.name),super.awake()}start(){this.onUpdateRenderMode()}onEnable(){super.onEnable(),this._updateRenderSettingsRoutine=void 0,this._lastMatrixWorld=new Ce,this.onUpdateRenderMode(),document.addEventListener("resize",this._boundRenderSettingsChanged),this.context.pre_render_callbacks.push(this.onBeforeRenderRoutine),this.context.post_render_callbacks.push(this.onAfterRenderRoutine)}onDisable(){super.onDisable(),document.removeEventListener("resize",this._boundRenderSettingsChanged);const t=this.context.pre_render_callbacks.indexOf(this.onBeforeRenderRoutine);t!==-1&&this.context.pre_render_callbacks.splice(t,1);const i=this.context.post_render_callbacks.indexOf(this.onAfterRenderRoutine);i!==-1&&this.context.post_render_callbacks.splice(i,1)}registerTransform(t){this._rectTransforms.push(t)}unregisterTransform(t){const i=this._rectTransforms.indexOf(t);i!==-1&&this._rectTransforms.splice(i,1)}registerLayoutGroup(t){const i=t.gameObject;this._layoutGroups.set(i,t)}unregisterLayoutGroup(t){const i=t.gameObject;this._layoutGroups.delete(i)}registerEventReceiver(t){this._receivers.push(t)}unregisterEventReceiver(t){const i=this._receivers.indexOf(t);i!==-1&&this._receivers.splice(i,1)}async onEnterXR(t){this.screenspace?(t.xr.isVR||t.xr.isPassThrough)&&(this.gameObject.visible=!1):(this.gameObject.visible=!1,await $W(1).then(()=>{this.gameObject.visible=!0}))}onLeaveXR(t){this.screenspace&&(t.xr.isVR||t.xr.isPassThrough)&&(this.gameObject.visible=!0)}invokeBeforeRenderEvents(){var t;for(const i of this._receivers)(t=i.onBeforeCanvasRender)==null||t.call(i,this)}handleLayoutUpdates(){this._lastMatrixWorld===null&&(this._lastMatrixWorld=new Ce);const t=!this._lastMatrixWorld.equals(this.gameObject.matrixWorld);AC&&t&&console.log("Canvas Layout changed",this.context.time.frameCount,this.name);const i=!1;for(const s of this._rectTransforms){t&&s.markDirty();let r=this._layoutGroups.get(s.gameObject);s.isDirty&&!r&&(r=s.gameObject.getComponentInParent(co)),(s.isDirty||r!=null&&r.isDirty)&&(AC&&!i&&console.log("CANVAS UPDATE ### "+s.name+" ##################################### "+this.context.time.frame),r==null||r.updateLayout(),s.updateTransform())}}applyRenderSettings(){this.onRenderSettingsChanged()}onRenderSettingsChanged(){this._updateRenderSettingsRoutine||(this._updateRenderSettingsRoutine=this.startCoroutine(this._updateRenderSettingsDelayed(),jt.OnBeforeRender))}*_updateRenderSettingsDelayed(){if(yield,this._updateRenderSettingsRoutine=void 0,this.shadowComponent){this.onUpdateRenderMode(),Hb(this.shadowComponent,this);for(const t of le.getComponentsInChildren(this.gameObject,Ac))Hb(t.shadowComponent,this)}}onUpdateRenderMode(t=!1){if(!t&&this._renderMode===this._activeRenderMode&&this._lastWidth===this.context.domWidth&&this._lastHeight===this.context.domHeight)return;this._activeRenderMode=this._renderMode;let i=this.context.mainCameraComponent,s=10;switch(i&&i.nearClipPlane>0&&i.farClipPlane>0&&(s=nt.lerp(i.nearClipPlane,i.farClipPlane,.01)),this._renderMode===Qa.ScreenSpaceCamera&&(this.worldCamera&&(i=this.worldCamera),this.planeDistance>0&&(s=this.planeDistance)),this._renderMode){case Qa.ScreenSpaceOverlay:case Qa.ScreenSpaceCamera:if(this._lastWidth=this.context.domWidth,this._lastHeight=this.context.domHeight,!i)return;const r=s+.01;this.gameObject.position.x=0,this.gameObject.position.y=0,this.gameObject.position.z=-r,this.gameObject.quaternion.identity();const o=this.gameObject.getComponent(Ys);let a=!1;o.sizeDelta.x!==this.context.domWidth&&(a=!0),o.sizeDelta.y!==this.context.domHeight&&(a=!0);const c=i.fieldOfView*Math.PI/180,l=2*Math.tan(c/2)*Math.abs(r);this.gameObject.scale.x=l/this.context.domHeight,this.gameObject.scale.y=l/this.context.domHeight,this.gameObject.scale.z=.01,a&&(o.sizeDelta.x=this.context.domWidth,o.sizeDelta.y=this.context.domHeight,o==null||o.markDirty());break;case Qa.WorldSpace:this._lastWidth=-1,this._lastHeight=-1;break}}}wc([x()],as.prototype,"renderOnTop",null);wc([x()],as.prototype,"depthWrite",null);wc([x()],as.prototype,"doubleSided",null);wc([x()],as.prototype,"castShadows",null);wc([x()],as.prototype,"receiveShadows",null);wc([x()],as.prototype,"renderMode",null);wc([x(as)],as.prototype,"rootCanvas",null);wc([x()],as.prototype,"scaleFactor",null);wc([x(Di)],as.prototype,"worldCamera",void 0);wc([x()],as.prototype,"planeDistance",void 0);var TI=globalThis&&globalThis.__decorate||function(n,e,t,i){var s=arguments.length,r=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(e,t,r):o(e,t))||r);return s>3&&r&&Object.defineProperty(e,t,r),r};class yd extends Te{constructor(){super(...arguments);u(this,"_alpha",1);u(this,"interactable",!0);u(this,"blocksRaycasts",!0);u(this,"_isDirty",!1);u(this,"_buffer",[])}get alpha(){return this._alpha}set alpha(t){t!==this._alpha&&(this._alpha=t,this.markDirty())}get isCanvasGroup(){return!0}markDirty(){this._isDirty||(this._isDirty=!0,this.startCoroutine(this.applyChangesDelayed(),jt.OnBeforeRender))}*applyChangesDelayed(){this._isDirty=!1,this.applyChangesNow()}applyChangesNow(){this._buffer.length=0;for(const t of le.getComponentsInChildren(this.gameObject,Ac,this._buffer)){const i=t;i.setAlphaFactor&&i.setAlphaFactor(this._alpha)}}}TI([x()],yd.prototype,"alpha",null);TI([x()],yd.prototype,"interactable",void 0);TI([x()],yd.prototype,"blocksRaycasts",void 0);var cn=globalThis&&globalThis.__decorate||function(n,e,t,i){var s=arguments.length,r=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(e,t,r):o(e,t))||r);return s>3&&r&&Object.defineProperty(e,t,r),r};function pv(n){n&&(n.getComponentInParent(av)||(Tt()&&console.warn("Create Raycaster on "+n.name+" because no raycaster was found in the hierarchy"),n.addNewComponent(No)))}class qp extends Te{constructor(){super(...arguments);u(this,"object");u(this,"target");u(this,"duration",1);u(this,"relativeMotion",!1);u(this,"coroutine",null);u(this,"targetPos",new w);u(this,"targetRot",new Me);u(this,"targetScale",new w)}start(){pv(this.gameObject)}onPointerClick(t){t.use(),this.coroutine&&this.stopCoroutine(this.coroutine),this.relativeMotion?this.coroutine=this.startCoroutine(this.moveRelative()):this.coroutine=this.startCoroutine(this.moveToTarget())}*moveToTarget(){if(!this.target||!this.object)return;const t=Ht(this.object).clone(),i=Ht(this.target).clone(),s=In(this.object).clone(),r=In(this.target).clone(),o=br(this.object).clone(),a=br(this.target).clone(),c=t.distanceTo(i),l=s.angleTo(r),h=o.distanceTo(a);if(c<.01&&l<.01&&h<.01){vr(this.object,i),fa(this.object,r),Pb(this.object,a),this.coroutine=null;return}let d=0,f=0;for(;d<1;)d+=this.context.time.deltaTime/this.duration,d>1&&(d=1),f=d<.5?4*d*d*d:1-Math.pow(-2*d+2,3)/2,this.targetPos.lerpVectors(t,i,f),this.targetRot.slerpQuaternions(s,r,f),this.targetScale.lerpVectors(o,a,f),vr(this.object,this.targetPos),fa(this.object,this.targetRot),Pb(this.object,this.targetScale),yield;this.coroutine=null}*moveRelative(){if(!this.target||!this.object)return;const t=this.object.position.clone(),i=this.object.quaternion.clone(),s=this.object.scale.clone(),r=this.target.position.clone(),o=this.target.quaternion.clone(),a=this.target.scale.clone();r.applyQuaternion(this.object.quaternion),this.targetPos.copy(this.object.position).add(r),this.targetRot.copy(this.object.quaternion).multiply(o),this.targetScale.copy(this.object.scale).multiply(a);let c=0,l=0;for(;c<1;)c+=this.context.time.deltaTime/this.duration,c>1&&(c=1),l=c<.5?4*c*c*c:1-Math.pow(-2*c+2,3)/2,this.object.position.lerpVectors(t,this.targetPos,l),this.object.quaternion.slerpQuaternions(i,this.targetRot,l),this.object.scale.lerpVectors(s,this.targetScale,l),yield;this.coroutine=null}beforeCreateDocument(t){var i;if(this.target&&this.object&&this.gameObject){const s=new ss("Move to "+((i=this.target)==null?void 0:i.name),js.tapTrigger(this.gameObject),di.transformAction(this.object,this.target,this.duration,this.relativeMotion?Nb.Relative:Nb.Absolute));t.addBehavior(s)}}}cn([x(ge)],qp.prototype,"object",void 0);cn([x(ge)],qp.prototype,"target",void 0);cn([x()],qp.prototype,"duration",void 0);cn([x()],qp.prototype,"relativeMotion",void 0);const Ha=class extends Te{constructor(){super(...arguments);u(this,"materialToSwitch");u(this,"variantMaterial");u(this,"fadeDuration",0);u(this,"_objectsWithThisMaterial",[]);u(this,"selfModel");u(this,"targetModels")}awake(){if(this.variantMaterial&&this.materialToSwitch){const t=le.findObjectsOfType(an);for(const i of t)for(let s=0;s<i.sharedMaterials.length;s++){const r=i.sharedMaterials[s];if(r===this.materialToSwitch){if(i.gameObject instanceof me)this._objectsWithThisMaterial.push(i.gameObject);else if(i.gameObject instanceof fr)for(const o of i.gameObject.children)o instanceof me&&o.material===r&&this._objectsWithThisMaterial.push(o);break}}}}start(){pv(this.gameObject)}onPointerClick(t){if(t.use(),!!this.variantMaterial)for(let i=0;i<this._objectsWithThisMaterial.length;i++){const s=this._objectsWithThisMaterial[i];s.material=this.variantMaterial}}async beforeCreateDocument(t,i){this.targetModels=[],Ha._materialTriggersPerId={},Ha.variantSwitchIndex=0,this.materialToSwitch&&await Eo.assignTextureLOD(this.context,this.sourceId,this.materialToSwitch,0),this.variantMaterial&&await Eo.assignTextureLOD(this.context,this.sourceId,this.variantMaterial,0)}createBehaviours(t,i,s){this._objectsWithThisMaterial.find(o=>o.uuid===i.uuid)&&this.targetModels.push(i),this.gameObject.uuid===i.uuid&&(this.selfModel=i,this.materialToSwitch&&(Ha._materialTriggersPerId[this.materialToSwitch.uuid]||(Ha._materialTriggersPerId[this.materialToSwitch.uuid]=[]),Ha._materialTriggersPerId[this.materialToSwitch.uuid].push(this)))}afterCreateDocument(t,i){if(!this.materialToSwitch)return;const s=Ha._materialTriggersPerId[this.materialToSwitch.uuid];if(s){const r={};for(const o of s){const a=o.createVariants();a&&a.length>0&&(r[o.selfModel.uuid]=a)}for(const o of s){const a=[];for(const c in r)c!==o.selfModel.uuid&&a.push(...r[c]);o.createAndAttachBehaviors(t,r[o.selfModel.uuid],a)}}delete Ha._materialTriggersPerId[this.materialToSwitch.uuid]}createAndAttachBehaviors(t,i,s){const r=[],o=[],a=Math.max(0,this.fadeDuration);o.push(di.fadeAction([...this.targetModels,...s],a,!1)),r.push(di.fadeAction(i,a,!1)),o.push(di.fadeAction(i,a,!0)),t.addBehavior(new ss("Select_"+this.selfModel.name,js.tapTrigger(this.selfModel),di.parallel(...o))),t.addBehavior(new ss("StartHidden_"+this.selfModel.name,js.sceneStartTrigger(),di.parallel(...r)))}createVariants(){if(!this.variantMaterial)return null;const t=[];for(const i of this.targetModels){const s=i.clone();s.name+=" variant_"+this.variantMaterial.name+"_"+Ha.variantSwitchIndex++,s.name=s.name.replace(/\s/g,"_"),s.material=this.variantMaterial,s.geometry=i.geometry,s.matrix=i.matrix,(!i.parent||!i.parent.isEmpty())&&Zr.createEmptyParent(i),i.parent&&i.parent.add(s),t.push(s)}return t}};let ll=Ha;u(ll,"_materialTriggersPerId",{}),u(ll,"variantSwitchIndex",0);cn([x(Ot)],ll.prototype,"materialToSwitch",void 0);cn([x(Ot)],ll.prototype,"variantMaterial",void 0);cn([x()],ll.prototype,"fadeDuration",void 0);const qi=class extends Te{constructor(){super(...arguments);u(this,"target");u(this,"toggleOnClick",!1);u(this,"targetState",!0);u(this,"hideSelf",!0);u(this,"selfModel");u(this,"selfModelClone");u(this,"targetModel");u(this,"toggleModel");u(this,"stateBeforeCreatingDocument",!1);u(this,"targetStateBeforeCreatingDocument",!1)}start(){pv(this.gameObject)}onPointerClick(t){t.use(),!this.toggleOnClick&&this.hideSelf&&(this.gameObject.visible=!1),this.target&&(this.target.visible=this.toggleOnClick?!this.target.visible:this.targetState)}createBehaviours(t,i,s){i.uuid===this.gameObject.uuid&&(this.selfModel=i,this.selfModelClone=i.clone())}beforeCreateDocument(){this.target&&(this.gameObject[qi.wasVisible]===void 0&&(this.gameObject[qi.wasVisible]=this.gameObject.activeSelf),this.target[qi.wasVisible]===void 0&&(this.target[qi.wasVisible]=this.target.activeSelf),this.stateBeforeCreatingDocument=this.gameObject[qi.wasVisible],this.targetStateBeforeCreatingDocument=this.target[qi.wasVisible],this.gameObject.visible=!0,this.target.visible=!0)}afterCreateDocument(t,i){if(!this.target)return;this.targetModel=i.document.findById(this.target.uuid);const s=this.selfModel;if(this.selfModel&&this.targetModel){let r=this.selfModel,o=this.targetState;if(this.toggleOnClick)if(o=!this.targetStateBeforeCreatingDocument,!this.selfModelClone.geometry)(!this.selfModel.parent||this.selfModel.parent.isEmpty())&&mz.createEmptyParent(this.selfModel),this.toggleModel=this.selfModel.deepClone(),this.toggleModel.name+="_toggle",this.selfModel.parent.add(this.toggleModel);else{if(!this.gameObject[qi.toggleClone]){const l=this.selfModelClone.clone();l.matrix.identity(),l.name+="_toggle"+qi.clonedToggleIndex++,s.add(l),this.gameObject[qi.toggleClone]=l,console.warn("USDZExport: Toggle "+this.gameObject.name+" doesn't have geometry. It will be deep cloned and nested behaviours will likely not work.")}const c=this.gameObject[qi.toggleClone];if(!this.gameObject[qi.reverseToggleClone]){const l=this.selfModelClone.clone();l.matrix.identity(),l.name+="_toggleReverse"+qi.clonedToggleIndex++,s.add(l),this.gameObject[qi.reverseToggleClone]=l}this.toggleModel=this.gameObject[qi.reverseToggleClone],(!this.toggleModel.geometry||!c.geometry)&&console.error("triggers without childs and without geometry won't work!",this,s.geometry),r=c,s.geometry=null,s.material=null}if(this.toggleModel){if(this.toggleOnClick){const c=[];c.push(di.fadeAction(r,0,!1)),c.push(di.fadeAction(this.toggleModel,0,!0)),c.push(di.fadeAction(this.targetModel,0,o)),t.addBehavior(new ss("Toggle_"+r.name+"_toggleTo"+(o?"On":"Off"),js.tapTrigger(r),di.parallel(...c)));const l=[];l.push(di.fadeAction(this.toggleModel,0,!1)),l.push(di.fadeAction(r,0,!0)),l.push(di.fadeAction(this.targetModel,0,!o)),t.addBehavior(new ss("Toggle_"+r.name+"_toggleTo"+(o?"Off":"On"),js.tapTrigger(this.toggleModel),di.parallel(...l)))}}else{const c=[];this.hideSelf&&c.push(di.fadeAction(r,0,!1)),c.push(di.fadeAction(this.targetModel,0,o)),t.addBehavior(new ss("Toggle_"+r.name+"_toggleTo"+(o?"On":"Off"),js.tapTrigger(r),di.parallel(...c)))}const a=new Array;this.targetStateBeforeCreatingDocument||a.push(this.targetModel),this.stateBeforeCreatingDocument||a.push(s),this.toggleModel&&a.push(this.toggleModel),t.addBehavior(new ss("HideOnStart_"+this.gameObject.name,js.sceneStartTrigger(),di.fadeAction(a,0,!1)))}}afterSerialize(t,i){this.gameObject[qi.wasVisible]!==void 0&&(this.gameObject.visible=this.gameObject[qi.wasVisible],delete this.gameObject[qi.wasVisible]),this.target&&this.target[qi.wasVisible]!==void 0&&(this.target.visible=this.target[qi.wasVisible],delete this.target[qi.wasVisible]),delete this.gameObject[qi.toggleClone],delete this.gameObject[qi.reverseToggleClone]}};let Ro=qi;u(Ro,"clonedToggleIndex",0),u(Ro,"wasVisible",Symbol("usdz_SetActiveOnClick_wasVisible")),u(Ro,"toggleClone",Symbol("clone for toggling")),u(Ro,"reverseToggleClone",Symbol("clone for reverse toggling"));cn([x(ge)],Ro.prototype,"target",void 0);cn([x()],Ro.prototype,"toggleOnClick",void 0);cn([x()],Ro.prototype,"targetState",void 0);cn([x()],Ro.prototype,"hideSelf",void 0);class Vz extends Te{start(){this.gameObject.visible=!1}createBehaviours(e,t,i){t.uuid===this.gameObject.uuid&&e.addBehavior(new ss("HideOnStart_"+this.gameObject.name,js.sceneStartTrigger(),di.fadeAction(t,0,!1)))}beforeCreateDocument(){this.gameObject.visible=!0}afterCreateDocument(){this.gameObject.visible=!1}}class mv extends Te{constructor(){super(...arguments);u(this,"target");u(this,"duration",.5);u(this,"motionType",xA.bounce)}beforeCreateDocument(){}createBehaviours(t,i,s){if(this.target&&i.uuid===this.gameObject.uuid){const r=new ss("emphasize "+this.name,js.tapTrigger(this.gameObject),di.emphasize(this.target,this.duration,this.motionType,void 0,"basic"));t.addBehavior(r)}}afterCreateDocument(t,i){}}cn([x()],mv.prototype,"target",void 0);cn([x()],mv.prototype,"duration",void 0);cn([x()],mv.prototype,"motionType",void 0);class gv extends Te{constructor(){super(...arguments);u(this,"target");u(this,"clip","");u(this,"toggleOnClick",!1)}start(){pv(this.gameObject)}ensureAudioSource(){if(!this.target){const t=this.gameObject.addNewComponent(Ti);t&&(this.target=t,t.spatialBlend=1,t.volume=1,t.loop=!1)}}onPointerClick(t){var i;t.use(),!(!((i=this.target)!=null&&i.clip)&&!this.clip)&&(this.ensureAudioSource(),this.target&&(this.target.isPlaying&&this.toggleOnClick?this.target.stop():(!this.toggleOnClick&&this.target.isPlaying&&this.target.stop(),this.clip?this.target.play(this.clip):this.target.play())))}createBehaviours(t,i,s){if(!(!this.target&&!this.clip)&&i.uuid===this.gameObject.uuid){const r=this.clip?this.clip:this.target?this.target.clip:void 0;if(!r||typeof r!="string")return;const o=this.target?this.target.gameObject:this.gameObject,a=r.split("/").pop(),c=this.target?this.target.volume:1,l=this.target&&this.target.spatialBlend==0?CA.NonSpatial:CA.Spatial;{let h=di.playAudioAction(o,"audio/"+a,SA.Play,c,l);this.toggleOnClick&&(h.multiplePerformOperation=wA.Stop),this.target&&this.target.loop&&(h=di.sequence(h).makeLooping());const d=new ss("playAudio "+this.name,js.tapTrigger(this.gameObject),h);t.addBehavior(d)}if(this.target&&this.target.playOnAwake&&this.target.enabled){let h=di.playAudioAction(o,"audio/"+a,SA.Play,c,l);this.target.loop&&(h=di.sequence(h).makeLooping());const d=new ss("playAudioOnStart "+this.name,js.sceneStartTrigger(),h);t.addBehavior(d)}}}async afterSerialize(t,i){if(!this.target&&!this.clip)return;const s=this.clip?this.clip:this.target?this.target.clip:void 0;if(!s||typeof s!="string")return;const r=s.split("/").pop(),c=await(await(await fetch(s)).blob()).arrayBuffer(),l=new Uint8Array(c);i.files["audio/"+r]=l}}cn([x(Ti)],gv.prototype,"target",void 0);cn([x(URL)],gv.prototype,"clip",void 0);cn([x()],gv.prototype,"toggleOnClick",void 0);const Jc=class extends Te{constructor(){super(...arguments);u(this,"animator");u(this,"stateName");u(this,"trigger","tap");u(this,"selfModel");u(this,"stateAnimationModel");u(this,"animationSequence",new Array);u(this,"animationLoopAfterSequence",new Array)}get target(){var t;return(t=this.animator)==null?void 0:t.gameObject}start(){pv(this.gameObject)}onPointerClick(t){var i;t.use(),this.target&&this.stateName&&((i=this.animator)==null||i.play(this.stateName,0,0,.1))}createBehaviours(t,i,s){i.uuid===this.gameObject.uuid&&(this.selfModel=i)}afterSerialize(){if(Jc.rootsWithExclusivePlayback.size>1){const t='Multiple root objects targeted by more than one animation. To work around QuickLook bug FB13410767, animations will be set as "exclusive" and activating them will stop other animations being marked as exclusive.';Tt()&&gn(t),console.warn(t,...Jc.rootsWithExclusivePlayback)}Jc.animationActions=[],Jc.rootsWithExclusivePlayback=new Set}afterCreateDocument(t,i){if(!this.animationSequence||!this.stateAnimationModel||!this.target)return;const s=i.document,r=i.extensions.find(c=>c instanceof Lx);if(!r)return;const o=r.getClipCount(this.target)>1;o&&(Tt()&&console.warn("Setting exclusive playback for "+this.target.name+"@"+this.stateName+" because it has "+r.getClipCount(this.target)+" animations. This works around QuickLook bug FB13410767."),Jc.rootsWithExclusivePlayback.add(this.target));const a=(c,l)=>{let h=Jc.animationActions.find(d=>d.affectedObjects==c&&d.start==l.start&&d.duration==l.duration);return h||(h=di.startAnimationAction(c,l.start,l.duration),Jc.animationActions.push(h)),h};s.traverse(c=>{var l,h;if(c.uuid===((l=this.target)==null?void 0:l.uuid)){const d=di.sequence();if(this.animationSequence!==void 0)for(const p of this.animationSequence)d.addAction(a(c,p));if(this.animationLoopAfterSequence!==void 0){const p=d.actions.length==0?d:di.sequence();for(const m of this.animationLoopAfterSequence)p.addAction(a(c,m));p.makeLooping(),d!==p&&d.addAction(p)}const f=new ss("tap "+this.name+" for "+this.stateName+" on "+((h=this.target)==null?void 0:h.name),this.trigger=="tap"?js.tapTrigger(this.selfModel):js.sceneStartTrigger(),d);o&&f.makeExclusive(!0),t.addBehavior(f)}})}createAnimation(t,i,s){var l,h,d,f;if(!this.target||!this.animator)return;const r=(l=this.animator)==null?void 0:l.runtimeAnimatorController;let o=r==null?void 0:r.findState(this.stateName),a=[],c=[];if(r&&o){const p=new Array;p.push(o);let m=!1;for(;p.length<100;){if(!o||o===null||!o.transitions||o.transitions.length===0){(h=o.motion)!=null&&h.isLooping&&(m=!0);break}const g=o.transitions.find(A=>A.conditions.length===0),y=g?r.getState(g.destinationState,0):null;if(y&&p.includes(y)){o=y,m=!0;break}else if(g){if(o=y,!o)break;p.push(o)}else{m=((d=o.motion)==null?void 0:d.isLooping)??!1;break}}if(m&&o){const g=p.indexOf(o);a=p.slice(0,g),c=p.slice(g),console.log("found loop from "+this.stateName,"states until loop",a,"states looping",c)}else a=p,c=[],console.log("found no loop from "+this.stateName,"states",a)}if(a=a.filter(p=>{var m,g,y;return((m=p.motion)==null?void 0:m.clip)&&((y=(g=p.motion)==null?void 0:g.clip.tracks)==null?void 0:y.length)>0}),c=c.filter(p=>{var m,g,y;return((m=p.motion)==null?void 0:m.clip)&&((y=(g=p.motion)==null?void 0:g.clip.tracks)==null?void 0:y.length)>0}),a.length===0&&c.length===0){console.warn("No clips found for state "+this.stateName+" on "+((f=this.animator)==null?void 0:f.name)+", can't export animation data");return}if(this.stateAnimationModel=i,a.length>0){this.animationSequence=new Array;for(const p of a)this.animationSequence.push(t.registerAnimation(this.target,p.motion.clip))}if(c.length>0){this.animationLoopAfterSequence=new Array;for(const p of c)this.animationLoopAfterSequence.push(t.registerAnimation(this.target,p.motion.clip))}}};let hl=Jc;u(hl,"animationActions",[]),u(hl,"rootsWithExclusivePlayback",new Set);cn([x(Xs)],hl.prototype,"animator",void 0);cn([x()],hl.prototype,"stateName",void 0);class Av extends Te{constructor(){super(...arguments);u(this,"target")}getType(){}getDuration(){}}cn([x(ge)],Av.prototype,"target",void 0);class qx extends Te{constructor(){super(...arguments);u(this,"target")}}cn([x(Av)],qx.prototype,"target",void 0);class Xx extends Av{constructor(){super(...arguments);u(this,"type",wg.Hide);u(this,"duration",1)}getType(){switch(this.type){case wg.Hide:return"hide";case wg.Show:return"show"}}getDuration(){return this.duration}}cn([x()],Xx.prototype,"type",void 0);cn([x()],Xx.prototype,"duration",void 0);class Hz extends qx{}var wg;(function(n){n[n.Show=0]="Show",n[n.Hide=1]="Hide"})(wg||(wg={}));var Fl=globalThis&&globalThis.__decorate||function(n,e,t,i){var s=arguments.length,r=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(e,t,r):o(e,t))||r);return s>3&&r&&Object.defineProperty(e,t,r),r};const VO=re("debugcharactercontroller");class Xp extends Te{constructor(){super(...arguments);u(this,"center",new w(0,0,0));u(this,"radius",.5);u(this,"height",2);u(this,"_rigidbody",null);u(this,"_activeGroundCollisions");u(this,"_contactVelocity",new w)}get rigidbody(){return this._rigidbody?this._rigidbody:(this._rigidbody=this.gameObject.getComponent(ki),this._rigidbody||(this._rigidbody=this.gameObject.addNewComponent(ki)),this.rigidbody)}awake(){this._activeGroundCollisions=new Set}onEnable(){const t=this.rigidbody;let i=this.gameObject.getComponent(vd);i||(i=this.gameObject.addNewComponent(vd)),i.center.copy(this.center),i.radius=this.radius,i.height=this.height;const s=new w(0,0,1),r=new w(1,0,0),o=new w(0,1,0),a=this.gameObject.getWorldDirection(new w);a.y=0;const c=r.dot(a)<0?-1:1,l=s.angleTo(a)*c;this.gameObject.setRotationFromAxisAngle(o,l),t.lockRotationX=!0,t.lockRotationY=!0,t.lockRotationZ=!0}move(t){this.gameObject.position.add(t)}onCollisionEnter(t){(t.contacts.length==0||t.contacts.some(i=>i.normal.y>.2))&&(this._activeGroundCollisions.add(t),VO&&console.log(`Collision(${this._activeGroundCollisions.size}): ${t.contacts.map(i=>i.normal.y.toFixed(2)).join(", ")} - ${this.isGrounded}`))}onCollisionExit(t){this._activeGroundCollisions.delete(t),VO&&console.log(`Collision(${this._activeGroundCollisions.size}) - ${this.isGrounded}`)}get isGrounded(){return this._activeGroundCollisions.size>0}get contactVelocity(){var t;this._contactVelocity.set(0,0,0);for(const i of this._activeGroundCollisions){const s=(t=this.context.physics.engine)==null?void 0:t.getLinearVelocity(i.collider);s&&(this._contactVelocity.x+=s.x,this._contactVelocity.y+=s.y,this._contactVelocity.z+=s.z)}return this._contactVelocity}}Fl([x(w)],Xp.prototype,"center",void 0);Fl([x()],Xp.prototype,"radius",void 0);Fl([x()],Xp.prototype,"height",void 0);class tu extends Te{constructor(){super(...arguments);u(this,"controller");u(this,"movementSpeed",2);u(this,"rotationSpeed",2);u(this,"jumpForce",1);u(this,"doubleJumpForce",2);u(this,"animator");u(this,"lookForward",!0);u(this,"lookInput",new ie(0,0));u(this,"moveInput",new ie(0,0));u(this,"jumpInput",!1);u(this,"_currentSpeed",new w(0,0,0));u(this,"_currentAngularSpeed",new w(0,0,0));u(this,"_temp",new w(0,0,0));u(this,"_jumpCount",0);u(this,"_currentRotation");u(this,"_raycastOptions",new pa)}awake(){this._currentRotation=new Me}update(){const t=this.context.input;t.isKeyPressed("KeyW")?this.moveInput.y+=1:t.isKeyPressed("KeyS")&&(this.moveInput.y-=1),t.isKeyPressed("KeyD")?this.lookInput.x+=1:t.isKeyPressed("KeyA")&&(this.lookInput.x-=1),this.jumpInput||(this.jumpInput=t.isKeyDown("Space"))}move(t){this.moveInput.add(t)}look(t){this.lookInput.add(t)}jump(){this.jumpInput=!0}onBeforeRender(){this.handleInput(this.moveInput,this.lookInput,this.jumpInput),this.lookInput.set(0,0),this.moveInput.set(0,0),this.jumpInput=!1}handleInput(t,i,s){var r,o,a,c,l,h,d,f,p,m,g;if((r=this.controller)!=null&&r.isGrounded&&(this._jumpCount=0,this.doubleJumpForce>0&&((o=this.animator)==null||o.setBool("doubleJump",!1))),this._currentSpeed.z+=t.y*this.movementSpeed*this.context.time.deltaTime,(a=this.animator)==null||a.setBool("running",t.length()>.01),(l=this.animator)==null||l.setBool("jumping",((c=this.controller)==null?void 0:c.isGrounded)===!0&&s),this._temp.copy(this._currentSpeed),this._temp.applyQuaternion(this.gameObject.quaternion),this.controller?this.controller.move(this._temp):this.gameObject.position.add(this._temp),this._currentAngularSpeed.y+=nt.toRadians(-i.x*this.rotationSpeed)*this.context.time.deltaTime,this.lookForward&&Math.abs(this._currentAngularSpeed.y)<.01){const y=this.context.mainCameraComponent.forward;y.y=0,y.normalize(),this._currentRotation.setFromUnitVectors(new w(0,0,1),y),this.gameObject.quaternion.slerp(this._currentRotation,this.context.time.deltaTime*10)}if(this.gameObject.rotateY(this._currentAngularSpeed.y),this._currentSpeed.multiplyScalar(1-this.context.time.deltaTime*10),this._currentAngularSpeed.y*=1-this.context.time.deltaTime*10,this.controller&&s&&this.jumpForce>0){let y=(h=this.controller)==null?void 0:h.isGrounded;if(this.doubleJumpForce>0&&!((d=this.controller)!=null&&d.isGrounded)&&this._jumpCount===1&&(y=!0,(f=this.animator)==null||f.setBool("doubleJump",!0)),y){this._jumpCount+=1;const A=this.controller.rigidbody,v=this._jumpCount===2?this.doubleJumpForce:this.jumpForce;A.applyImpulse(new w(0,1,0).multiplyScalar(v))}}if(this.controller){const y=(p=this.controller)==null?void 0:p.rigidbody.getVelocity().y;if(y<-1){this._raycastOptions.ray||(this._raycastOptions.ray=new ro),this._raycastOptions.ray.origin.copy(Ht(this.gameObject)),this._raycastOptions.ray.direction.set(0,-1,0);const A=this.layer;this.gameObject.layers.disableAll(),this.gameObject.layers.set(2);const v=this.context.physics.raycast(this._raycastOptions);this.gameObject.layers.set(A),(v.length&&v[0].distance>2||y<-10)&&((m=this.animator)==null||m.setBool("falling",!0))}else(g=this.animator)==null||g.setBool("falling",!1)}}}Fl([x(Xp)],tu.prototype,"controller",void 0);Fl([x()],tu.prototype,"movementSpeed",void 0);Fl([x()],tu.prototype,"rotationSpeed",void 0);Fl([x()],tu.prototype,"jumpForce",void 0);Fl([x()],tu.prototype,"doubleJumpForce",void 0);Fl([x(Xs)],tu.prototype,"animator",void 0);var Zte=globalThis&&globalThis.__decorate||function(n,e,t,i){var s=arguments.length,r=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(e,t,r):o(e,t))||r);return s>3&&r&&Object.defineProperty(e,t,r),r};class Yx extends xr{constructor(){super(...arguments);u(this,"intensity")}get typeName(){return"ChromaticAberration"}init(){this.intensity.defaultValue=0}onCreateEffect(){const t=new NF;return t.offset=new ie(0,0),t.radialModulation=!0,t.modulationOffset=.15,this.intensity.valueProcessor=i=>i*.02,this.intensity.onValueChanged=i=>{t.offset.x=-i,t.offset.y=i},t}}Zte([x(It)],Yx.prototype,"intensity",void 0);_a("ChromaticAberration",Yx);var Jx=globalThis&&globalThis.__decorate||function(n,e,t,i){var s=arguments.length,r=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(e,t,r):o(e,t))||r);return s>3&&r&&Object.defineProperty(e,t,r),r};class Ed extends xr{constructor(){super(...arguments);u(this,"postExposure");u(this,"contrast");u(this,"hueShift");u(this,"saturation")}get typeName(){return"ColorAdjustments"}init(){this.postExposure.valueProcessor=t=>(t=Math.pow(2,t),t),this.postExposure.defaultValue=0,this.contrast.valueProcessor=t=>{let i=1;return t>0?i=200:t<0&&(i=100),t/i},this.contrast.defaultValue=0,this.hueShift.valueProcessor=t=>Math.PI*t/180,this.hueShift.defaultValue=0,this.saturation.valueProcessor=t=>t<0?t/100:t/(100*Math.PI),this.saturation.defaultValue=0}unapply(){this.context.renderer.toneMappingExposure=1}onCreateEffect(){this.context.renderer.toneMapping===Fr&&this.postExposure.overrideState&&(this.context.renderer.toneMapping=Hg);const t=new UF;this.postExposure.onValueChanged=s=>{this.context.renderer.toneMapping===Fr&&(this.context.renderer.toneMapping=Hg),this.postExposure.overrideState&&(this.context.renderer.toneMappingExposure=s)},this.contrast.onValueChanged=s=>{t.contrast=s};const i=new GF;return this.hueShift.onValueChanged=s=>i.hue=s,this.saturation.onValueChanged=s=>i.saturation=s,[i,t]}}Jx([x(It)],Ed.prototype,"postExposure",void 0);Jx([x(It)],Ed.prototype,"contrast",void 0);Jx([x(It)],Ed.prototype,"hueShift",void 0);Jx([x(It)],Ed.prototype,"saturation",void 0);_a("ColorAdjustments",Ed);const $te=(Math.sqrt(5)-1)/4,us=(5-Math.sqrt(5))/20,e0=n=>Math.floor(n)|0,t0=new Float64Array([0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0]);function eie(n=Math.random){const e=tie(n),t=new Float64Array(e).map(o=>t0[o%32*4]),i=new Float64Array(e).map(o=>t0[o%32*4+1]),s=new Float64Array(e).map(o=>t0[o%32*4+2]),r=new Float64Array(e).map(o=>t0[o%32*4+3]);return function(a,c,l,h){let d,f,p,m,g;const y=(a+c+l+h)*$te,A=e0(a+y),v=e0(c+y),b=e0(l+y),_=e0(h+y),T=(A+v+b+_)*us,E=A-T,M=v-T,I=b-T,S=_-T,C=a-E,D=c-M,G=l-I,Q=h-S;let L=0,V=0,O=0,U=0;C>D?L++:V++,C>G?L++:O++,C>Q?L++:U++,D>G?V++:O++,D>Q?V++:U++,G>Q?O++:U++;const H=L>=3?1:0,Y=V>=3?1:0,J=O>=3?1:0,se=U>=3?1:0,fe=L>=2?1:0,_e=V>=2?1:0,Oe=O>=2?1:0,qe=U>=2?1:0,ae=L>=1?1:0,ve=V>=1?1:0,Ue=O>=1?1:0,Ge=U>=1?1:0,Xe=C-H+us,ze=D-Y+us,Pe=G-J+us,X=Q-se+us,Ae=C-fe+2*us,ke=D-_e+2*us,be=G-Oe+2*us,je=Q-qe+2*us,ct=C-ae+3*us,F=D-ve+3*us,B=G-Ue+3*us,ce=Q-Ge+3*us,Se=C-1+4*us,xe=D-1+4*us,Ie=G-1+4*us,et=Q-1+4*us,Fe=A&255,Ke=v&255,rt=b&255,At=_&255;let Ee=.6-C*C-D*D-G*G-Q*Q;if(Ee<0)d=0;else{const Ve=Fe+e[Ke+e[rt+e[At]]];Ee*=Ee,d=Ee*Ee*(t[Ve]*C+i[Ve]*D+s[Ve]*G+r[Ve]*Q)}let Rt=.6-Xe*Xe-ze*ze-Pe*Pe-X*X;if(Rt<0)f=0;else{const Ve=Fe+H+e[Ke+Y+e[rt+J+e[At+se]]];Rt*=Rt,f=Rt*Rt*(t[Ve]*Xe+i[Ve]*ze+s[Ve]*Pe+r[Ve]*X)}let dt=.6-Ae*Ae-ke*ke-be*be-je*je;if(dt<0)p=0;else{const Ve=Fe+fe+e[Ke+_e+e[rt+Oe+e[At+qe]]];dt*=dt,p=dt*dt*(t[Ve]*Ae+i[Ve]*ke+s[Ve]*be+r[Ve]*je)}let ft=.6-ct*ct-F*F-B*B-ce*ce;if(ft<0)m=0;else{const Ve=Fe+ae+e[Ke+ve+e[rt+Ue+e[At+Ge]]];ft*=ft,m=ft*ft*(t[Ve]*ct+i[Ve]*F+s[Ve]*B+r[Ve]*ce)}let Ze=.6-Se*Se-xe*xe-Ie*Ie-et*et;if(Ze<0)g=0;else{const Ve=Fe+1+e[Ke+1+e[rt+1+e[At+1]]];Ze*=Ze,g=Ze*Ze*(t[Ve]*Se+i[Ve]*xe+s[Ve]*Ie+r[Ve]*et)}return 27*(d+f+p+m+g)}}function tie(n){const t=new Uint8Array(512);for(let i=0;i<512/2;i++)t[i]=i;for(let i=0;i<512/2-1;i++){const s=i+~~(n()*(256-i)),r=t[i];t[i]=t[s],t[s]=r}for(let i=256;i<512;i++)t[i]=t[i-256];return t}var oe=globalThis&&globalThis.__decorate||function(n,e,t,i){var s=arguments.length,r=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(e,t,r):o(e,t))||r);return s>3&&r&&Object.defineProperty(e,t,r),r};const i0=re("debugparticles");var Wa;(function(n){n[n.Billboard=0]="Billboard",n[n.Stretch=1]="Stretch",n[n.HorizontalBillboard=2]="HorizontalBillboard",n[n.VerticalBillboard=3]="VerticalBillboard",n[n.Mesh=4]="Mesh"})(Wa||(Wa={}));let Td=class{constructor(){u(this,"alphaKeys");u(this,"colorKeys")}get duration(){return 1}evaluate(e,t){let i,s=0,r=null,o=0;for(let a=0;a<this.alphaKeys.length;a++){const c=this.alphaKeys[a];(c.time<e||!i)&&(i=c,s=a)}for(let a=0;a<this.colorKeys.length;a++){const c=this.colorKeys[a];(c.time<e||!r)&&(r=c,o=a)}if(r)if(o+1<this.colorKeys.length){const c=this.colorKeys[o+1],l=nt.remap(e,r.time,c.time,0,1);t.r=nt.lerp(r.color.r,c.color.r,l),t.g=nt.lerp(r.color.g,c.color.g,l),t.b=nt.lerp(r.color.b,c.color.b,l)}else t.r=r.color.r,t.g=r.color.g,t.b=r.color.b;if(i)if(s+1<this.alphaKeys.length){const c=this.alphaKeys[s+1],l=nt.remap(e,i.time,c.time,0,1);t.alpha=nt.lerp(i.alpha,c.alpha,l)}else t.alpha=i.alpha;return t}};oe([x()],Td.prototype,"alphaKeys",void 0);oe([x()],Td.prototype,"colorKeys",void 0);var es;(function(n){n[n.Constant=0]="Constant",n[n.Curve=1]="Curve",n[n.TwoCurves=2]="TwoCurves",n[n.TwoConstants=3]="TwoConstants"})(es||(es={}));var Nf;(function(n){n[n.Color=0]="Color",n[n.Gradient=1]="Gradient",n[n.TwoColors=2]="TwoColors",n[n.TwoGradients=3]="TwoGradients",n[n.RandomColor=4]="RandomColor"})(Nf||(Nf={}));var da;(function(n){n[n.Local=0]="Local",n[n.World=1]="World",n[n.Custom=2]="Custom"})(da||(da={}));var lr;(function(n){n[n.Sphere=0]="Sphere",n[n.SphereShell=1]="SphereShell",n[n.Hemisphere=2]="Hemisphere",n[n.HemisphereShell=3]="HemisphereShell",n[n.Cone=4]="Cone",n[n.Box=5]="Box",n[n.Mesh=6]="Mesh",n[n.ConeShell=7]="ConeShell",n[n.ConeVolume=8]="ConeVolume",n[n.ConeVolumeShell=9]="ConeVolumeShell",n[n.Circle=10]="Circle",n[n.CircleEdge=11]="CircleEdge",n[n.SingleSidedEdge=12]="SingleSidedEdge",n[n.MeshRenderer=13]="MeshRenderer",n[n.SkinnedMeshRenderer=14]="SkinnedMeshRenderer",n[n.BoxShell=15]="BoxShell",n[n.BoxEdge=16]="BoxEdge",n[n.Donut=17]="Donut",n[n.Rectangle=18]="Rectangle",n[n.Sprite=19]="Sprite",n[n.SpriteRenderer=20]="SpriteRenderer"})(lr||(lr={}));var Bu;(function(n){n[n.Random=0]="Random",n[n.Loop=1]="Loop",n[n.PingPong=2]="PingPong",n[n.BurstSpread=3]="BurstSpread"})(Bu||(Bu={}));class ht{constructor(){u(this,"mode");u(this,"constant");u(this,"constantMin");u(this,"constantMax");u(this,"curve");u(this,"curveMin");u(this,"curveMax");u(this,"curveMultiplier")}clone(){var t,i,s;const e=new ht;return e.mode=this.mode,e.constant=this.constant,e.constantMin=this.constantMin,e.constantMax=this.constantMax,e.curve=(t=this.curve)==null?void 0:t.clone(),e.curveMin=(i=this.curveMin)==null?void 0:i.clone(),e.curveMax=(s=this.curveMax)==null?void 0:s.clone(),e.curveMultiplier=this.curveMultiplier,e}evaluate(e,t){const i=t===void 0?Math.random():t;switch(this.mode){case es.Constant:return this.constant;case es.Curve:return e=nt.clamp01(e),this.curve.evaluate(e)*this.curveMultiplier;case es.TwoCurves:const s=e*this.curveMin.duration,r=e*this.curveMax.duration;return nt.lerp(this.curveMin.evaluate(s),this.curveMax.evaluate(r),i%1)*this.curveMultiplier;case es.TwoConstants:return nt.lerp(this.constantMin,this.constantMax,i%1);default:this.curveMax.evaluate(e)*this.curveMultiplier;break}return 0}getMax(){switch(this.mode){case es.Constant:return this.constant;case es.Curve:return this.getMaxFromCurve(this.curve)*this.curveMultiplier;case es.TwoCurves:return Math.max(this.getMaxFromCurve(this.curveMin),this.getMaxFromCurve(this.curveMax))*this.curveMultiplier;case es.TwoConstants:return Math.max(this.constantMin,this.constantMax);default:return 0}}getMaxFromCurve(e){if(!e)return 0;let t=Number.MIN_VALUE;for(let i=0;i<e.keys.length;i++){const s=e.keys[i];s.value>t&&(t=s.value)}return t}}oe([x()],ht.prototype,"mode",void 0);oe([x()],ht.prototype,"constant",void 0);oe([x()],ht.prototype,"constantMin",void 0);oe([x()],ht.prototype,"constantMax",void 0);oe([x(Tl)],ht.prototype,"curve",void 0);oe([x(Tl)],ht.prototype,"curveMin",void 0);oe([x(Tl)],ht.prototype,"curveMax",void 0);oe([x()],ht.prototype,"curveMultiplier",void 0);const _o=class{constructor(){u(this,"mode");u(this,"color");u(this,"colorMin");u(this,"colorMax");u(this,"gradient");u(this,"gradientMin");u(this,"gradientMax")}evaluate(e,t){const i=t===void 0?Math.random():t;switch(this.mode){case Nf.Color:return this.color;case Nf.Gradient:return this.gradient.evaluate(e,_o._temp),_o._temp;case Nf.TwoColors:return _o._temp.lerpColors(this.colorMin,this.colorMax,i);case Nf.TwoGradients:return this.gradientMin.evaluate(e,_o._temp),this.gradientMax.evaluate(e,_o._temp2),_o._temp.lerp(_o._temp2,i)}return _o._temp.set(16711935),_o._temp.alpha=1,_o._temp}};let xs=_o;u(xs,"_temp",new Ii(0,0,0,1)),u(xs,"_temp2",new Ii(0,0,0,1));oe([x(Ii)],xs.prototype,"color",void 0);oe([x(Ii)],xs.prototype,"colorMin",void 0);oe([x(Ii)],xs.prototype,"colorMax",void 0);oe([x(Td)],xs.prototype,"gradient",void 0);oe([x(Td)],xs.prototype,"gradientMin",void 0);oe([x(Td)],xs.prototype,"gradientMax",void 0);var Xb;(function(n){n[n.Hierarchy=0]="Hierarchy",n[n.Local=1]="Local",n[n.Shape=2]="Shape"})(Xb||(Xb={}));class Zs{constructor(){u(this,"cullingMode");u(this,"duration");u(this,"emitterVelocityMode");u(this,"flipRotation");u(this,"gravityModifier");u(this,"gravityModifierMultiplier");u(this,"loop");u(this,"maxParticles");u(this,"playOnAwake");u(this,"prewarm");u(this,"ringBufferLoopRange");u(this,"ringBufferMode");u(this,"scalingMode");u(this,"simulationSpace");u(this,"simulationSpeed");u(this,"startColor");u(this,"startDelay");u(this,"startDelayMultiplier");u(this,"startLifetime");u(this,"startLifetimeMultiplier");u(this,"startRotation");u(this,"startRotationMultiplier");u(this,"startRotation3D");u(this,"startRotationX");u(this,"startRotationXMultiplier");u(this,"startRotationY");u(this,"startRotationYMultiplier");u(this,"startRotationZ");u(this,"startRotationZMultiplier");u(this,"startSize");u(this,"startSize3D");u(this,"startSizeMultiplier");u(this,"startSizeX");u(this,"startSizeXMultiplier");u(this,"startSizeY");u(this,"startSizeYMultiplier");u(this,"startSizeZ");u(this,"startSizeZMultiplier");u(this,"startSpeed");u(this,"startSpeedMultiplier");u(this,"stopAction");u(this,"useUnscaledTime")}}oe([x(ht)],Zs.prototype,"gravityModifier",void 0);oe([x(xs)],Zs.prototype,"startColor",void 0);oe([x(ht)],Zs.prototype,"startDelay",void 0);oe([x(ht)],Zs.prototype,"startLifetime",void 0);oe([x(ht)],Zs.prototype,"startRotation",void 0);oe([x(ht)],Zs.prototype,"startRotationX",void 0);oe([x(ht)],Zs.prototype,"startRotationY",void 0);oe([x(ht)],Zs.prototype,"startRotationZ",void 0);oe([x(ht)],Zs.prototype,"startSize",void 0);oe([x(ht)],Zs.prototype,"startSizeX",void 0);oe([x(ht)],Zs.prototype,"startSizeY",void 0);oe([x(ht)],Zs.prototype,"startSizeZ",void 0);oe([x(ht)],Zs.prototype,"startSpeed",void 0);class Yb{constructor(){u(this,"cycleCount");u(this,"maxCount");u(this,"minCount");u(this,"probability");u(this,"repeatInterval");u(this,"time");u(this,"count");u(this,"_performed",0)}reset(){this._performed=0}run(e){if(e<=this.time)return 0;let t=0;if(this.cycleCount===0||this._performed<this.cycleCount){const i=this.time+this.repeatInterval*this._performed;if(e>=i&&(this._performed+=1,Math.random()<this.probability))switch(this.count.mode){case es.Constant:t=this.count.constant;break;case es.TwoConstants:t=nt.lerp(this.count.constantMin,this.count.constantMax,Math.random());break;case es.Curve:t=this.count.curve.evaluate(Math.random());break;case es.TwoCurves:const s=Math.random();t=nt.lerp(this.count.curveMin.evaluate(s),this.count.curveMax.evaluate(s),Math.random());break}}return t}}class Ul{constructor(){u(this,"enabled");u(this,"bursts");u(this,"rateOverTime");u(this,"rateOverTimeMultiplier");u(this,"rateOverDistance");u(this,"rateOverDistanceMultiplier");u(this,"system")}get burstCount(){var e;return((e=this.bursts)==null?void 0:e.length)??0}reset(){var e;(e=this.bursts)==null||e.forEach(t=>t.reset())}getBurst(){let e=0;if(this.burstCount>0)for(let t=0;t<this.burstCount;t++){const i=this.bursts[t];this.system.main.loop&&i.time>=this.system.time&&i.reset(),e+=Math.round(i.run(this.system.time))}return e}}oe([x()],Ul.prototype,"enabled",void 0);oe([x()],Ul.prototype,"bursts",void 0);oe([x(ht)],Ul.prototype,"rateOverTime",void 0);oe([x()],Ul.prototype,"rateOverTimeMultiplier",void 0);oe([x(ht)],Ul.prototype,"rateOverDistance",void 0);oe([x()],Ul.prototype,"rateOverDistanceMultiplier",void 0);class Kx{constructor(){u(this,"enabled");u(this,"color")}}oe([x(xs)],Kx.prototype,"color",void 0);class Md{constructor(){u(this,"enabled");u(this,"separateAxes");u(this,"size");u(this,"sizeMultiplier");u(this,"x");u(this,"xMultiplier");u(this,"y");u(this,"yMultiplier");u(this,"z");u(this,"zMultiplier");u(this,"_time",0);u(this,"_temp",new w)}evaluate(e,t,i){if(t||(t=this._temp),!this.enabled)return t.x=t.y=t.z=1,t;if(this.separateAxes)t.x=this.x.evaluate(e,i)*this.xMultiplier,t.y=this.y.evaluate(e,i)*this.yMultiplier,t.z=this.z.evaluate(e,i)*this.zMultiplier;else{const s=this.size.evaluate(e,i)*this.sizeMultiplier;t.x=s}return t}}oe([x(ht)],Md.prototype,"size",void 0);oe([x(ht)],Md.prototype,"x",void 0);oe([x(ht)],Md.prototype,"y",void 0);oe([x(ht)],Md.prototype,"z",void 0);var ph;(function(n){n[n.Vertex=0]="Vertex",n[n.Edge=1]="Edge",n[n.Triangle=2]="Triangle"})(ph||(ph={}));const Jf=class{constructor(){u(this,"shapeType",lr.Box);u(this,"enabled",!0);u(this,"alignToDirection",!1);u(this,"angle",0);u(this,"arc",360);u(this,"arcSpread");u(this,"arcSpeedMultiplier");u(this,"arcMode");u(this,"boxThickness");u(this,"position");u(this,"rotation");u(this,"_rotation",new ws);u(this,"scale");u(this,"radius");u(this,"radiusThickness");u(this,"sphericalDirectionAmount");u(this,"randomDirectionAmount");u(this,"randomPositionAmount");u(this,"meshShapeType");u(this,"meshRenderer");u(this,"_meshObj");u(this,"_meshGeometry");u(this,"system");u(this,"_space");u(this,"_worldSpaceMatrix",new Ce);u(this,"_worldSpaceMatrixInverse",new Ce);u(this,"_vector",new w(0,0,0));u(this,"_temp",new w(0,0,0));u(this,"_triangle",new dr);u(this,"_dir",new w);u(this,"_loopTime",0);u(this,"_loopDirection",1);i0&&console.log(this)}get type(){return lr[this.shapeType]}initialize(e){this.onInitialize(e),e.position.copy(this._vector)}toJSON(){return this}clone(){return new Jf}setMesh(e){this.meshRenderer=e,e?(this._meshObj=e.sharedMeshes[Math.floor(Math.random()*e.sharedMeshes.length)],this._meshGeometry=this._meshObj.geometry):(this._meshObj=void 0,this._meshGeometry=void 0)}update(e,t,i,s){this.system=e,this._space=i,i===da.World&&(this._worldSpaceMatrix.copy(s.matrixWorld),this._worldSpaceMatrix.elements[0]=1,this._worldSpaceMatrix.elements[5]=1,this._worldSpaceMatrix.elements[10]=1,this._worldSpaceMatrixInverse.copy(this._worldSpaceMatrix).invert())}applyRotation(e){const t=this.rotation.x!==0||this.rotation.y!==0||this.rotation.z!==0;return t&&(this._rotation.x=nt.toRadians(this.rotation.x),this._rotation.y=nt.toRadians(this.rotation.y),this._rotation.z=nt.toRadians(this.rotation.z),this._rotation.order="ZYX",e.applyEuler(this._rotation)),t}onInitialize(e){this._vector.set(0,0,0),e.mesh=void 0,e.mesh_geometry=void 0;const t=this._temp.copy(this.position),i=this._space===da.World;i&&t.applyQuaternion(this.system.worldQuaternion);let s=this.radius;if(i&&(s*=this.system.worldScale.x),this.enabled){switch(this.shapeType){case lr.Box:i0&&kt.DrawWireBox(this.position,this.scale,14540253,1),this._vector.x=Math.random()*this.scale.x-this.scale.x/2,this._vector.y=Math.random()*this.scale.y-this.scale.y/2,this._vector.z=Math.random()*this.scale.z-this.scale.z/2,this._vector.add(t);break;case lr.Cone:this.randomConePoint(this.position,this.angle,s,this.radiusThickness,this.arc,this.arcMode,this._vector);break;case lr.Sphere:this.randomSpherePoint(this.position,s,this.radiusThickness,this.arc,this._vector);break;case lr.Circle:this.randomCirclePoint(this.position,s,this.radiusThickness,this.arc,this._vector);break;case lr.MeshRenderer:const r=this.meshRenderer;(r==null?void 0:r.destroyed)==!1&&this.setMesh(r);const o=e.mesh=this._meshObj,a=e.mesh_geometry=this._meshGeometry;if(o&&a)switch(this.meshShapeType){case ph.Vertex:{const c=a.getAttribute("position"),l=Math.floor(Math.random()*c.count);this._vector.fromBufferAttribute(c,l),this._vector.applyMatrix4(o.matrixWorld),e.mesh_normal=l}break;case ph.Edge:break;case ph.Triangle:{const c=a.index;if(c){let l=Math.random(),h=Math.random();l+h>1&&(l=1-l,h=1-h);const d=Math.floor(Math.random()*(c.count/3));let f=d*3,p=d*3+1,m=d*3+2;f=c.getX(f),p=c.getX(p),m=c.getX(m);const g=a.getAttribute("position");this._triangle.a.fromBufferAttribute(g,f),this._triangle.b.fromBufferAttribute(g,p),this._triangle.c.fromBufferAttribute(g,m),this._vector.set(0,0,0).addScaledVector(this._triangle.a,l).addScaledVector(this._triangle.b,h).addScaledVector(this._triangle.c,1-(l+h)),this._vector.applyMatrix4(o.matrixWorld),e.mesh_normal=d}}break}break;default:this._vector.set(0,0,0),Tt()&&!globalThis.__particlesystem_shapetype_unsupported&&(console.warn("ParticleSystem ShapeType is not supported:",lr[this.shapeType]),globalThis.__particlesystem_shapetype_unsupported=!0);break}this.randomizePosition(this._vector,this.randomPositionAmount)}this.applyRotation(this._vector),i&&(this._vector.applyQuaternion(this.system.worldQuaternion),this._vector.add(this.system.worldPos)),i0&&kt.DrawSphere(this._vector,.03,16711680,.5,!0)}getDirection(e,t){var i;if(!this.enabled)return this._dir.set(0,0,1),this._dir;switch(this.shapeType){case lr.Box:this._dir.set(0,0,1);break;case lr.Cone:this._dir.set(0,0,1);break;case lr.Circle:case lr.Sphere:const s=t.x,r=t.y,o=t.z;this._dir.set(s,r,o),(i=this.system)!=null&&i.worldspace?this._dir.sub(this.system.worldPos):this._dir.sub(this.position);break;case lr.MeshRenderer:const a=e.mesh,c=e.mesh_geometry;if(a&&c)switch(this.meshShapeType){case ph.Vertex:{const l=c.getAttribute("normal"),h=e.mesh_normal;this._dir.fromBufferAttribute(l,h)}break;case ph.Edge:break;case ph.Triangle:{const l=c.index;if(l){const h=e.mesh_normal,d=l.getX(h*3),f=l.getX(h*3+1),p=l.getX(h*3+2),m=c.getAttribute("position"),g=Gn(),y=Gn(),A=Gn();g.fromBufferAttribute(m,d),y.fromBufferAttribute(m,f),A.fromBufferAttribute(m,p),g.sub(y),A.sub(y),g.cross(A),this._dir.copy(g).multiplyScalar(-1);const v=In(a);this._dir.applyQuaternion(v)}}break}break;default:this._dir.set(0,0,1);break}return this._space===da.World&&this._dir.applyQuaternion(this.system.worldQuaternion),this.applyRotation(this._dir),this._dir.normalize(),this.spherizeDirection(this._dir,this.sphericalDirectionAmount),this.randomizeDirection(this._dir,this.randomDirectionAmount),i0&&(kt.DrawSphere(t,.01,8925952,.5,!0),kt.DrawDirection(t,this._dir,8925952,.5,!0)),this._dir}randomizePosition(e,t){if(t<=0)return;const i=Jf._tempVec;i.set(Math.random()*2-1,Math.random()*2-1,Math.random()*2-1),i.x*=t*this.scale.x,i.y*=t*this.scale.y,i.z*=t*this.scale.z,e.add(i)}randomizeDirection(e,t){if(t===0)return;const i=Jf._randomQuat,s=Jf._tempVec;s.set(Math.random()-.5,Math.random()-.5,Math.random()-.5).normalize(),i.setFromAxisAngle(s,t*Math.random()*Math.PI),e.applyQuaternion(i)}spherizeDirection(e,t){if(t===0)return;const i=Math.random()*Math.PI*2,s=Math.acos(1-Math.random()*2),r=Math.sin(s)*Math.cos(i),o=Math.sin(s)*Math.sin(i),a=Math.cos(s),c=new w(r,o,a);e.lerp(c,t)}randomSpherePoint(e,t,i,s,r){const o=Math.random(),a=Math.random(),c=2*Math.PI*o*(s/360),l=Math.acos(2*a-1),h=nt.lerp(1,1-Math.pow(1-Math.random(),Math.PI),i)*t,d=e.x+this.scale.x*(-h*Math.sin(l)*Math.cos(c)),f=e.y+this.scale.y*(h*Math.sin(l)*Math.sin(c)),p=e.z+this.scale.z*(h*Math.cos(l));r.x=d,r.y=f,r.z=p}randomCirclePoint(e,t,i,s,r){const o=Math.random(),a=2*Math.PI*o*(s/360),c=nt.lerp(1,1-Math.pow(1-Math.random(),Math.PI),i)*t,l=e.x+this.scale.x*c*Math.cos(a),h=e.y+this.scale.y*c*Math.sin(a),d=e.z;r.x=l,r.y=h,r.z=d}randomConePoint(e,t,i,s,r,o,a){let c=0,l=0;switch(o){case Bu.Random:c=Math.random(),l=Math.random();break;case Bu.PingPong:this._loopTime>1&&(this._loopDirection=-1),this._loopTime<0&&(this._loopDirection=1);case Bu.Loop:c=.5,l=Math.random(),this._loopTime+=this.system.deltaTime*this._loopDirection;break}let h=2*Math.PI*c*(r/360);switch(o){case Bu.PingPong:case Bu.Loop:h+=Math.PI+.5,h+=this._loopTime*Math.PI*2,h%=nt.toRadians(r);break}const d=Math.acos(2*l-1),f=nt.lerp(1,1-Math.pow(1-Math.random(),Math.PI),s)*i,p=e.x+-f*Math.sin(d)*Math.cos(h),m=e.y+f*Math.sin(d)*Math.sin(h),g=e.z;a.x=p*this.scale.x,a.y=m*this.scale.y,a.z=g*this.scale.z}};let Vi=Jf;u(Vi,"_randomQuat",new Me),u(Vi,"_tempVec",new w);oe([x()],Vi.prototype,"shapeType",void 0);oe([x()],Vi.prototype,"enabled",void 0);oe([x()],Vi.prototype,"alignToDirection",void 0);oe([x()],Vi.prototype,"angle",void 0);oe([x()],Vi.prototype,"arc",void 0);oe([x()],Vi.prototype,"arcSpread",void 0);oe([x()],Vi.prototype,"arcSpeedMultiplier",void 0);oe([x()],Vi.prototype,"arcMode",void 0);oe([x(w)],Vi.prototype,"boxThickness",void 0);oe([x(w)],Vi.prototype,"position",void 0);oe([x(w)],Vi.prototype,"rotation",void 0);oe([x(w)],Vi.prototype,"scale",void 0);oe([x()],Vi.prototype,"radius",void 0);oe([x()],Vi.prototype,"radiusThickness",void 0);oe([x()],Vi.prototype,"sphericalDirectionAmount",void 0);oe([x()],Vi.prototype,"randomDirectionAmount",void 0);oe([x()],Vi.prototype,"randomPositionAmount",void 0);oe([x()],Vi.prototype,"meshShapeType",void 0);oe([x(Tx)],Vi.prototype,"meshRenderer",void 0);class Pi{constructor(){u(this,"damping");u(this,"enabled");u(this,"frequency");u(this,"octaveCount");u(this,"octaveMultiplier");u(this,"octaveScale");u(this,"positionAmount");u(this,"quality");u(this,"remap");u(this,"remapEnabled");u(this,"remapMultiplier");u(this,"remapX");u(this,"remapXMultiplier");u(this,"remapY");u(this,"remapYMultiplier");u(this,"remapZ");u(this,"remapZMultiplier");u(this,"scrollSpeedMultiplier");u(this,"separateAxes");u(this,"strengthMultiplier");u(this,"strengthX");u(this,"strengthXMultiplier");u(this,"strengthY");u(this,"strengthYMultiplier");u(this,"strengthZ");u(this,"strengthZMultiplier");u(this,"_noise");u(this,"_time",0);u(this,"_temp",new w)}update(e){this._time+=e.time.deltaTime*this.scrollSpeedMultiplier}apply(e,t,i,s,r,o){if(!this.enabled)return;this._noise||(this._noise=eie(()=>0));const a=this._temp.set(t.x,t.y,t.z).multiplyScalar(this.frequency),c=this._noise(a.x,a.y,a.z,this._time),l=this._noise(a.x,a.y,a.z,this._time+1e3*this.frequency),h=this._noise(a.x,a.y,a.z,this._time+2e3*this.frequency);this._temp.set(c,l,h).normalize();const d=r/o;let f=this.positionAmount.evaluate(d);this.separateAxes?(this._temp.x*=f*this.strengthXMultiplier,this._temp.y*=f*this.strengthYMultiplier,this._temp.z*=f*this.strengthZMultiplier):(this.strengthX&&(f*=this.strengthX.evaluate(d)*1.5),this._temp.multiplyScalar(f)),i.x+=this._temp.x,i.y+=this._temp.y,i.z+=this._temp.z}}oe([x()],Pi.prototype,"damping",void 0);oe([x()],Pi.prototype,"enabled",void 0);oe([x()],Pi.prototype,"frequency",void 0);oe([x()],Pi.prototype,"octaveCount",void 0);oe([x()],Pi.prototype,"octaveMultiplier",void 0);oe([x()],Pi.prototype,"octaveScale",void 0);oe([x(ht)],Pi.prototype,"positionAmount",void 0);oe([x()],Pi.prototype,"quality",void 0);oe([x(ht)],Pi.prototype,"remap",void 0);oe([x()],Pi.prototype,"remapEnabled",void 0);oe([x()],Pi.prototype,"remapMultiplier",void 0);oe([x(ht)],Pi.prototype,"remapX",void 0);oe([x()],Pi.prototype,"remapXMultiplier",void 0);oe([x(ht)],Pi.prototype,"remapY",void 0);oe([x()],Pi.prototype,"remapYMultiplier",void 0);oe([x(ht)],Pi.prototype,"remapZ",void 0);oe([x()],Pi.prototype,"remapZMultiplier",void 0);oe([x()],Pi.prototype,"scrollSpeedMultiplier",void 0);oe([x()],Pi.prototype,"separateAxes",void 0);oe([x()],Pi.prototype,"strengthMultiplier",void 0);oe([x(ht)],Pi.prototype,"strengthX",void 0);oe([x()],Pi.prototype,"strengthXMultiplier",void 0);oe([x(ht)],Pi.prototype,"strengthY",void 0);oe([x()],Pi.prototype,"strengthYMultiplier",void 0);oe([x(ht)],Pi.prototype,"strengthZ",void 0);oe([x()],Pi.prototype,"strengthZMultiplier",void 0);var OT;(function(n){n[n.PerParticle=0]="PerParticle",n[n.Ribbon=1]="Ribbon"})(OT||(OT={}));var kT;(function(n){n[n.Stretch=0]="Stretch",n[n.Tile=1]="Tile",n[n.DistributePerSegment=2]="DistributePerSegment",n[n.RepeatPerSegment=3]="RepeatPerSegment"})(kT||(kT={}));class ln{constructor(){u(this,"enabled");u(this,"attachRibbonToTransform",!1);u(this,"colorOverLifetime");u(this,"colorOverTrail");u(this,"dieWithParticles",!0);u(this,"inheritParticleColor",!0);u(this,"lifetime");u(this,"lifetimeMultiplier");u(this,"minVertexDistance",.2);u(this,"mode",OT.PerParticle);u(this,"ratio",1);u(this,"ribbonCount",1);u(this,"shadowBias",0);u(this,"sizeAffectsLifetime",!1);u(this,"sizeAffectsWidth",!1);u(this,"splitSubEmitterRibbons",!1);u(this,"textureMode",kT.Stretch);u(this,"widthOverTrail");u(this,"widthOverTrailMultiplier");u(this,"worldSpace",!1)}getWidth(e,t,i,s){const r=this.widthOverTrail.evaluate(i,s);return e*=r,e}getColor(e,t,i){const s=this.colorOverTrail.evaluate(i),r=this.colorOverLifetime.evaluate(t);e.x*=s.r*r.r,e.y*=s.g*r.g,e.z*=s.b*r.b,e.w*=s.alpha*r.alpha}}oe([x()],ln.prototype,"enabled",void 0);oe([x()],ln.prototype,"attachRibbonToTransform",void 0);oe([x(xs)],ln.prototype,"colorOverLifetime",void 0);oe([x(xs)],ln.prototype,"colorOverTrail",void 0);oe([x()],ln.prototype,"dieWithParticles",void 0);oe([x()],ln.prototype,"inheritParticleColor",void 0);oe([x(ht)],ln.prototype,"lifetime",void 0);oe([x()],ln.prototype,"lifetimeMultiplier",void 0);oe([x()],ln.prototype,"minVertexDistance",void 0);oe([x()],ln.prototype,"mode",void 0);oe([x()],ln.prototype,"ratio",void 0);oe([x()],ln.prototype,"ribbonCount",void 0);oe([x()],ln.prototype,"shadowBias",void 0);oe([x()],ln.prototype,"sizeAffectsLifetime",void 0);oe([x()],ln.prototype,"sizeAffectsWidth",void 0);oe([x()],ln.prototype,"splitSubEmitterRibbons",void 0);oe([x()],ln.prototype,"textureMode",void 0);oe([x(ht)],ln.prototype,"widthOverTrail",void 0);oe([x()],ln.prototype,"widthOverTrailMultiplier",void 0);oe([x()],ln.prototype,"worldSpace",void 0);class An{constructor(){u(this,"enabled");u(this,"space",da.Local);u(this,"orbitalX");u(this,"orbitalY");u(this,"orbitalZ");u(this,"orbitalXMultiplier");u(this,"orbitalYMultiplier");u(this,"orbitalZMultiplier");u(this,"orbitalOffsetX");u(this,"orbitalOffsetY");u(this,"orbitalOffsetZ");u(this,"speedModifier");u(this,"speedModifierMultiplier");u(this,"x");u(this,"xMultiplier");u(this,"y");u(this,"yMultiplier");u(this,"z");u(this,"zMultiplier");u(this,"_system");u(this,"_temp",new w);u(this,"_temp2",new w);u(this,"_temp3",new w);u(this,"_hasOrbital",!1);u(this,"_index",0);u(this,"_orbitalMatrix",new Ce)}update(e){this._system=e}init(e){this._index==0&&(e.debug=!0),this._index+=1,e.orbitx=this.orbitalX.evaluate(Math.random()),e.orbity=this.orbitalY.evaluate(Math.random()),e.orbitz=this.orbitalZ.evaluate(Math.random()),this._hasOrbital=e.orbitx!=0||e.orbity!=0||e.orbitz!=0}apply(e,t,i,s,r,o,a){var p;if(!this.enabled)return;const c=o/a,l=this.speedModifier.evaluate(c)*this.speedModifierMultiplier,h=this.x.evaluate(c),d=this.y.evaluate(c),f=this.z.evaluate(c);if(this._temp.set(-h,d,f),this._system&&this._system.main.simulationSpace===da.World&&this._temp.applyQuaternion(this._system.worldQuaternion),this._hasOrbital&&((p=this._system)==null?void 0:p.worldPos)){const g=this._temp2.set(i.x,i.y,i.z),y=this.orbitalXMultiplier,A=this.orbitalYMultiplier,v=this.orbitalZMultiplier,b=l*Math.PI*2*10,_=Math.cos(b*y),T=Math.sin(b*y),E=Math.cos(b*A),M=Math.sin(b*A),I=Math.cos(b*v),S=Math.sin(b*v),C=g.x*(E*I)+g.y*(E*S)+g.z*-M,D=g.x*(T*M*I-_*S)+g.y*(T*M*S+_*I)+g.z*(T*E),G=g.x*(_*M*I+T*S)+g.y*(_*M*S-T*I)+g.z*(_*E),Q=this._temp3.set(g.x-C,g.y-D,g.z-G);Q.normalize(),Q.multiplyScalar(.2/r*Math.max(this.orbitalXMultiplier,this.orbitalYMultiplier,this.orbitalZMultiplier)),s.x+=Q.x,s.y+=Q.y,s.z+=Q.z}s.x+=this._temp.x,s.y+=this._temp.y,s.z+=this._temp.z,s.x*=l,s.y*=l,s.z*=l}}oe([x()],An.prototype,"enabled",void 0);oe([x()],An.prototype,"space",void 0);oe([x(ht)],An.prototype,"orbitalX",void 0);oe([x(ht)],An.prototype,"orbitalY",void 0);oe([x(ht)],An.prototype,"orbitalZ",void 0);oe([x()],An.prototype,"orbitalXMultiplier",void 0);oe([x()],An.prototype,"orbitalYMultiplier",void 0);oe([x()],An.prototype,"orbitalZMultiplier",void 0);oe([x()],An.prototype,"orbitalOffsetX",void 0);oe([x()],An.prototype,"orbitalOffsetY",void 0);oe([x()],An.prototype,"orbitalOffsetZ",void 0);oe([x(ht)],An.prototype,"speedModifier",void 0);oe([x()],An.prototype,"speedModifierMultiplier",void 0);oe([x(ht)],An.prototype,"x",void 0);oe([x()],An.prototype,"xMultiplier",void 0);oe([x(ht)],An.prototype,"y",void 0);oe([x()],An.prototype,"yMultiplier",void 0);oe([x(ht)],An.prototype,"z",void 0);oe([x()],An.prototype,"zMultiplier",void 0);var LT;(function(n){n[n.Lifetime=0]="Lifetime",n[n.Speed=1]="Speed",n[n.FPS=2]="FPS"})(LT||(LT={}));var HO;(function(n){n[n.Grid=0]="Grid",n[n.Sprites=1]="Sprites"})(HO||(HO={}));var QO;(function(n){n[n.Custom=0]="Custom",n[n.Random=1]="Random",n[n.MeshIndex=2]="MeshIndex"})(QO||(QO={}));var jO;(function(n){n[n.WholeSheet=0]="WholeSheet",n[n.SingleRow=1]="SingleRow"})(jO||(jO={}));class $s{constructor(){u(this,"animation");u(this,"enabled");u(this,"cycleCount");u(this,"frameOverTime");u(this,"frameOverTimeMultiplier");u(this,"numTilesX");u(this,"numTilesY");u(this,"startFrame");u(this,"startFrameMultiplier");u(this,"rowMode");u(this,"rowIndex");u(this,"spriteCount");u(this,"timeMode")}sampleOnceAtStart(){if(this.timeMode===LT.Lifetime)switch(this.frameOverTime.mode){case es.Constant:case es.TwoConstants:case es.TwoCurves:case es.Curve:return!0}return!1}getStartIndex(){return this.sampleOnceAtStart()?Math.random()*(this.numTilesX*this.numTilesY):0}evaluate(e){if(!this.sampleOnceAtStart())return this.getIndex(e)}getIndex(e){const t=this.numTilesX*this.numTilesY;e=e*this.cycleCount;let i=this.frameOverTime.evaluate(e%1);return i*=this.frameOverTimeMultiplier,i*=t,i=i%t,i=Math.floor(i),i}}oe([x()],$s.prototype,"animation",void 0);oe([x()],$s.prototype,"enabled",void 0);oe([x()],$s.prototype,"cycleCount",void 0);oe([x(ht)],$s.prototype,"frameOverTime",void 0);oe([x()],$s.prototype,"frameOverTimeMultiplier",void 0);oe([x()],$s.prototype,"numTilesX",void 0);oe([x()],$s.prototype,"numTilesY",void 0);oe([x(ht)],$s.prototype,"startFrame",void 0);oe([x()],$s.prototype,"startFrameMultiplier",void 0);oe([x()],$s.prototype,"rowMode",void 0);oe([x()],$s.prototype,"rowIndex",void 0);oe([x()],$s.prototype,"spriteCount",void 0);oe([x()],$s.prototype,"timeMode",void 0);class wa{constructor(){u(this,"enabled");u(this,"separateAxes");u(this,"x");u(this,"xMultiplier");u(this,"y");u(this,"yMultiplier");u(this,"z");u(this,"zMultiplier")}evaluate(e,t){return this.enabled?this.separateAxes?0:this.z.evaluate(e,t)*-1:0}}oe([x()],wa.prototype,"enabled",void 0);oe([x()],wa.prototype,"separateAxes",void 0);oe([x(ht)],wa.prototype,"x",void 0);oe([x()],wa.prototype,"xMultiplier",void 0);oe([x(ht)],wa.prototype,"y",void 0);oe([x()],wa.prototype,"yMultiplier",void 0);oe([x(ht)],wa.prototype,"z",void 0);oe([x()],wa.prototype,"zMultiplier",void 0);class Qo{constructor(){u(this,"enabled");u(this,"range");u(this,"separateAxes");u(this,"x");u(this,"xMultiplier");u(this,"y");u(this,"yMultiplier");u(this,"z");u(this,"zMultiplier")}evaluate(e,t){if(!this.enabled)return 0;if(!this.separateAxes){const i=nt.lerp(this.range.x,this.range.y,t);return this.z.evaluate(i)*-1}return 0}}oe([x()],Qo.prototype,"enabled",void 0);oe([x()],Qo.prototype,"range",void 0);oe([x()],Qo.prototype,"separateAxes",void 0);oe([x(ht)],Qo.prototype,"x",void 0);oe([x()],Qo.prototype,"xMultiplier",void 0);oe([x(ht)],Qo.prototype,"y",void 0);oe([x()],Qo.prototype,"yMultiplier",void 0);oe([x(ht)],Qo.prototype,"z",void 0);oe([x()],Qo.prototype,"zMultiplier",void 0);class qn{constructor(){u(this,"enabled");u(this,"dampen");u(this,"drag");u(this,"dragMultiplier");u(this,"limit");u(this,"limitMultiplier");u(this,"separateAxes");u(this,"limitX");u(this,"limitXMultiplier");u(this,"limitY");u(this,"limitYMultiplier");u(this,"limitZ");u(this,"limitZMultiplier");u(this,"multiplyDragByParticleSize",!1);u(this,"multiplyDragByParticleVelocity",!1);u(this,"space");u(this,"_temp",new w);u(this,"_temp2",new w)}apply(e,t,i,s,r,o,a){if(this.enabled){const c=this.limit.evaluate(r)*this.limitMultiplier;if(t.length()>c){this._temp.copy(t).normalize().multiplyScalar(c);const h=this.dampen*.5;t.x=nt.lerp(t.x,this._temp.x,h),t.y=nt.lerp(t.y,this._temp.y,h),t.z=nt.lerp(t.z,this._temp.z,h),i.x=nt.lerp(i.x,this._temp.x,h),i.y=nt.lerp(i.y,this._temp.y,h),i.z=nt.lerp(i.z,this._temp.z,h)}}}}oe([x()],qn.prototype,"enabled",void 0);oe([x()],qn.prototype,"dampen",void 0);oe([x(ht)],qn.prototype,"drag",void 0);oe([x()],qn.prototype,"dragMultiplier",void 0);oe([x(ht)],qn.prototype,"limit",void 0);oe([x()],qn.prototype,"limitMultiplier",void 0);oe([x()],qn.prototype,"separateAxes",void 0);oe([x(ht)],qn.prototype,"limitX",void 0);oe([x()],qn.prototype,"limitXMultiplier",void 0);oe([x(ht)],qn.prototype,"limitY",void 0);oe([x()],qn.prototype,"limitYMultiplier",void 0);oe([x(ht)],qn.prototype,"limitZ",void 0);oe([x()],qn.prototype,"limitZMultiplier",void 0);oe([x()],qn.prototype,"multiplyDragByParticleSize",void 0);oe([x()],qn.prototype,"multiplyDragByParticleVelocity",void 0);oe([x()],qn.prototype,"space",void 0);var Jb;(function(n){n[n.Initial=0]="Initial",n[n.Current=1]="Current"})(Jb||(Jb={}));class Nl{constructor(){u(this,"enabled");u(this,"curve");u(this,"curveMultiplier");u(this,"mode");u(this,"system");u(this,"_temp",new w);u(this,"_firstUpdate",!0);u(this,"_frames",0)}clone(){var t;const e=new Nl;return e.enabled=this.enabled,e.curve=(t=this.curve)==null?void 0:t.clone(),e.curveMultiplier=this.curveMultiplier,e.mode=this.mode,e}get _lastWorldPosition(){return this.system._iv_lastWorldPosition||(this.system._iv_lastWorldPosition=new w),this.system._iv_lastWorldPosition}get _velocity(){return this.system._iv_velocity||(this.system._iv_velocity=new w),this.system._iv_velocity}awake(e){this.system=e,this.reset()}reset(){this._firstUpdate=!0}update(e){this.enabled&&this.system.worldspace!==!1&&(this._firstUpdate?(this._firstUpdate=!1,this._velocity.set(0,0,0),this._lastWorldPosition.copy(this.system.worldPos)):this._lastWorldPosition&&(this._velocity.copy(this.system.worldPos).sub(this._lastWorldPosition).multiplyScalar(1/this.system.deltaTime),this._lastWorldPosition.copy(this.system.worldPos)))}applyInitial(e){if(this.enabled&&this.system.worldspace!==!1&&this.mode===Jb.Initial){const t=this.curve.evaluate(Math.random(),Math.random());this._temp.copy(this._velocity).multiplyScalar(t),e.add(this._temp)}}applyCurrent(e,t,i){if(this.enabled&&this.system&&this.system.worldspace!==!1&&this.mode===Jb.Current){const s=this.curve.evaluate(t,i);this._temp.copy(this._velocity).multiplyScalar(s),e.add(this._temp)}}}oe([x()],Nl.prototype,"enabled",void 0);oe([x(ht)],Nl.prototype,"curve",void 0);oe([x()],Nl.prototype,"curveMultiplier",void 0);oe([x()],Nl.prototype,"mode",void 0);class Vr{constructor(){u(this,"enabled");u(this,"range");u(this,"separateAxes");u(this,"size");u(this,"sizeMultiplier");u(this,"x");u(this,"xMultiplier");u(this,"y");u(this,"yMultiplier");u(this,"z");u(this,"zMultiplier")}evaluate(e,t,i,s){const r=e.length(),o=nt.remap(r,this.range.x,this.range.y,0,1),a=this.size.evaluate(o,i);return s*a}}oe([x()],Vr.prototype,"enabled",void 0);oe([x(ie)],Vr.prototype,"range",void 0);oe([x()],Vr.prototype,"separateAxes",void 0);oe([x(ht)],Vr.prototype,"size",void 0);oe([x()],Vr.prototype,"sizeMultiplier",void 0);oe([x(ht)],Vr.prototype,"x",void 0);oe([x()],Vr.prototype,"xMultiplier",void 0);oe([x(ht)],Vr.prototype,"y",void 0);oe([x()],Vr.prototype,"yMultiplier",void 0);oe([x(ht)],Vr.prototype,"z",void 0);oe([x()],Vr.prototype,"zMultiplier",void 0);class Yp{constructor(){u(this,"enabled");u(this,"range");u(this,"color")}evaluate(e,t,i){const s=e.length(),r=nt.remap(s,this.range.x,this.range.y,0,1),o=this.color.evaluate(r,t);i.x*=o.r,i.y*=o.g,i.z*=o.b,i.w*=o.alpha}}oe([x()],Yp.prototype,"enabled",void 0);oe([x(ie)],Yp.prototype,"range",void 0);oe([x(xs)],Yp.prototype,"color",void 0);const iie={name:"HorizontalBlurShader",uniforms:{tDiffuse:{value:null},h:{value:1/512}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform sampler2D tDiffuse;
		uniform float h;

		varying vec2 vUv;

		void main() {

			vec4 sum = vec4( 0.0 );

			sum += texture2D( tDiffuse, vec2( vUv.x - 4.0 * h, vUv.y ) ) * 0.051;
			sum += texture2D( tDiffuse, vec2( vUv.x - 3.0 * h, vUv.y ) ) * 0.0918;
			sum += texture2D( tDiffuse, vec2( vUv.x - 2.0 * h, vUv.y ) ) * 0.12245;
			sum += texture2D( tDiffuse, vec2( vUv.x - 1.0 * h, vUv.y ) ) * 0.1531;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;
			sum += texture2D( tDiffuse, vec2( vUv.x + 1.0 * h, vUv.y ) ) * 0.1531;
			sum += texture2D( tDiffuse, vec2( vUv.x + 2.0 * h, vUv.y ) ) * 0.12245;
			sum += texture2D( tDiffuse, vec2( vUv.x + 3.0 * h, vUv.y ) ) * 0.0918;
			sum += texture2D( tDiffuse, vec2( vUv.x + 4.0 * h, vUv.y ) ) * 0.051;

			gl_FragColor = sum;

		}`},nie={name:"VerticalBlurShader",uniforms:{tDiffuse:{value:null},v:{value:1/512}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform sampler2D tDiffuse;
		uniform float v;

		varying vec2 vUv;

		void main() {

			vec4 sum = vec4( 0.0 );

			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 4.0 * v ) ) * 0.051;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 3.0 * v ) ) * 0.0918;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 2.0 * v ) ) * 0.12245;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 1.0 * v ) ) * 0.1531;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 1.0 * v ) ) * 0.1531;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 2.0 * v ) ) * 0.12245;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 3.0 * v ) ) * 0.0918;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 4.0 * v ) ) * 0.051;

			gl_FragColor = sum;

		}`};var vv=globalThis&&globalThis.__decorate||function(n,e,t,i){var s=arguments.length,r=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(e,t,r):o(e,t))||r);return s>3&&r&&Object.defineProperty(e,t,r),r};const vC=re("debugcontactshadows");class Id extends Te{constructor(){super(...arguments);u(this,"darkness",.5);u(this,"opacity",.5);u(this,"blur",4);u(this,"occludeBelowGround",!0);u(this,"backfaceShadows",!0);u(this,"shadowCamera");u(this,"shadowGroup");u(this,"renderTarget");u(this,"renderTargetBlur");u(this,"plane");u(this,"occluderMesh");u(this,"blurPlane");u(this,"depthMaterial");u(this,"horizontalBlurMaterial");u(this,"verticalBlurMaterial")}awake(){vC&&console.log("Create ContactShadows on "+this.gameObject.name,this);const t=512;this.shadowGroup=new fr,this.gameObject.add(this.shadowGroup),this.renderTarget=new Zt(t,t),this.renderTarget.texture.generateMipmaps=!1,this.renderTargetBlur=new Zt(t,t),this.renderTargetBlur.texture.generateMipmaps=!1;const i=new Wn(1,1).rotateX(Math.PI/2);if(this.gameObject instanceof me){vC&&console.log("ContactShadows: use existing mesh",this.gameObject),this.plane=this.gameObject;const s=this.plane.material=this.plane.material.clone();s.map=this.renderTarget.texture,s.opacity=this.opacity}else{const s=new ri({map:this.renderTarget.texture,opacity:this.opacity,color:0,transparent:!0,depthWrite:!1});this.plane=new me(i,s),this.plane.scale.y=-1,this.gameObject.add(this.plane)}this.plane&&(this.plane.renderOrder=1),this.occludeBelowGround&&(this.occluderMesh=new me(this.plane.geometry,new ri({depthWrite:!0,stencilWrite:!0,colorWrite:!1})).translateY(-1e-4),this.occluderMesh.renderOrder=-100,this.gameObject.add(this.occluderMesh)),this.blurPlane=new me(i),this.blurPlane.visible=!1,this.shadowGroup.add(this.blurPlane),this.shadowCamera=new vc(-1/2,1/2,1/2,-1/2,0,1),this.shadowCamera.rotation.x=Math.PI/2,this.shadowGroup.add(this.shadowCamera),this.depthMaterial=new NA,this.depthMaterial.userData.darkness={value:this.darkness},this.depthMaterial.blending=nM,this.depthMaterial.blendEquation=K0,this.backfaceShadows&&(this.depthMaterial.side=Ai),this.depthMaterial.onBeforeCompile=s=>{this.depthMaterial&&(s.uniforms.darkness=this.depthMaterial.userData.darkness,s.fragmentShader=`
                uniform float darkness;
                ${s.fragmentShader.replace("gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );","gl_FragColor = vec4( vec3( 1.0 ), ( 1.0 - fragCoordZ ) * darkness * opacity * (gl_FrontFacing ? 1.0 : 0.66) );")}
            `)},this.depthMaterial.depthTest=!1,this.depthMaterial.depthWrite=!1,this.horizontalBlurMaterial=new Et(iie),this.horizontalBlurMaterial.depthTest=!1,this.verticalBlurMaterial=new Et(nie),this.verticalBlurMaterial.depthTest=!1,this.shadowGroup.visible=!1}onDestroy(){var t,i,s,r,o,a,c,l;(t=this.renderTarget)==null||t.dispose(),(i=this.renderTargetBlur)==null||i.dispose(),(s=this.depthMaterial)==null||s.dispose(),(r=this.horizontalBlurMaterial)==null||r.dispose(),(o=this.verticalBlurMaterial)==null||o.dispose(),(a=this.blurPlane)==null||a.geometry.dispose(),(c=this.plane)==null||c.geometry.dispose(),(l=this.occluderMesh)==null||l.geometry.dispose()}onBeforeRender(t){const i=this.context.scene,s=this.context.renderer,r=s.getRenderTarget();if(!this.renderTarget||!this.renderTargetBlur||!this.depthMaterial||!this.shadowCamera||!this.blurPlane||!this.shadowGroup||!this.plane||!this.horizontalBlurMaterial||!this.verticalBlurMaterial){vC&&console.error("ContactShadows: not initialized yet");return}this.shadowGroup.visible=!0,this.occluderMesh&&(this.occluderMesh.visible=!1);const o=this.plane.visible;this.plane.visible=!1,this.gameObject instanceof me&&(this.gameObject.visible=!1,_f(this.gameObject,!1));const a=i.background;i.background=null,i.overrideMaterial=this.depthMaterial;const c=s.getClearAlpha();s.setClearAlpha(0),s.setRenderTarget(this.renderTarget),s.render(i,this.shadowCamera),i.overrideMaterial=null,this.blurShadow(this.blur),this.blurShadow(this.blur*.4),this.shadowGroup.visible=!1,this.occluderMesh&&(this.occluderMesh.visible=!0),this.plane.visible=o,s.setRenderTarget(r),s.setClearAlpha(c),i.background=a}blurShadow(t){if(!this.blurPlane||!this.shadowCamera||!this.renderTarget||!this.renderTargetBlur||!this.horizontalBlurMaterial||!this.verticalBlurMaterial)return;this.blurPlane.visible=!0,this.blurPlane.material=this.horizontalBlurMaterial,this.blurPlane.material.uniforms.tDiffuse.value=this.renderTarget.texture,this.horizontalBlurMaterial.uniforms.h.value=t*1/256;const i=this.context.renderer,s=i.getRenderTarget();i.setRenderTarget(this.renderTargetBlur),i.render(this.blurPlane,this.shadowCamera),this.blurPlane.material=this.verticalBlurMaterial,this.blurPlane.material.uniforms.tDiffuse.value=this.renderTargetBlur.texture,this.verticalBlurMaterial.uniforms.v.value=t*1/256,i.setRenderTarget(this.renderTarget),i.render(this.blurPlane,this.shadowCamera),this.blurPlane.visible=!1,i.setRenderTarget(s)}}vv([x()],Id.prototype,"darkness",void 0);vv([x()],Id.prototype,"opacity",void 0);vv([x()],Id.prototype,"blur",void 0);vv([x()],Id.prototype,"occludeBelowGround",void 0);vv([x()],Id.prototype,"backfaceShadows",void 0);var yv=globalThis&&globalThis.__decorate||function(n,e,t,i){var s=arguments.length,r=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(e,t,r):o(e,t))||r);return s>3&&r&&Object.defineProperty(e,t,r),r};const WO=re("debugwebxr"),sie=new Ce().makeRotationY(Math.PI);class zo extends Te{constructor(){super(...arguments);u(this,"_arScale",1);u(this,"invertForward",!1);u(this,"customReticle");u(this,"useXRAnchor",!1);u(this,"arTouchTransform",!1);u(this,"_isPlacing",!0);u(this,"_startOffset",new Ce);u(this,"_createdPlacementObject",null);u(this,"_reparentedComponents",[]);u(this,"_placementScene",new Ws);u(this,"_reticle",[]);u(this,"_hits",[]);u(this,"_placementStartTime",-1);u(this,"_rigPlacementMatrix");u(this,"_anchor",null);u(this,"userInput");u(this,"onPlaceScene",t=>{var r;if(this._isPlacing==!1)return;let i=this._reticle[0],s=this._hits[0];if(t.origin instanceof T3){const o=this._reticle[t.origin.index];o&&(i=o,s=this._hits[t.origin.index])}if(!i){console.warn("No reticle to place...");return}if(!i.visible){console.warn("Reticle is not visible (can not place)");return}if((r=mt.active)!=null&&r.isTrackingImages){console.warn("Scene Placement is disabled while images are being tracked");return}t.stopImmediatePropagation(),this._isPlacing=!1,this.context.input.removeEventListener("pointerup",this.onPlaceScene),this.onRevertSceneChanges(),this.onApplyPose(i),this.useXRAnchor&&this.onCreateAnchor(mt.active,s)})}get arScale(){return this._arScale}set arScale(t){t!==this._arScale&&(this._arScale=t,this.onScaleChanged())}onEnable(){var t;(t=this.customReticle)==null||t.preload()}supportsXR(t){return t==="immersive-ar"}onEnterXR(t){WO&&console.log("ENTER WEBXR: SessionRoot start..."),this._anchor=null,this.gameObject.updateMatrixWorld(),this._startOffset.copy(this.gameObject.matrixWorld);const i=new ge;this._createdPlacementObject=i,i.name="AR Session Root",this._placementScene.name="AR Placement Scene",this._placementScene.children.length=0;for(let s=this.context.scene.children.length-1;s>=0;s--){const r=this.context.scene.children[s];this._placementScene.add(r)}this.context.scene.add(i),this._reparentedComponents.length=0,this._reparentedComponents.push({comp:this,originalObject:this.gameObject}),le.addComponent(i,this);for(const s of this._reticle)gc(s);this._reticle.length=0,this._isPlacing=!0,this.context.input.addEventListener("pointerup",this.onPlaceScene)}onLeaveXR(){this.context.input.removeEventListener("pointerup",this.onPlaceScene),this.onRevertSceneChanges(),this._anchor=null,this._rigPlacementMatrix=void 0}onUpdateXR(t){var i,s,r,o;if(t.xr.isTrackingImages){for(const a of this._reticle)a.visible=!1;return}if(this._isPlacing){const a=(i=t.xr.rig)==null?void 0:i.gameObject;a&&a.parent!==this.context.scene&&this.context.scene.add(a);let c=!1;if(t.xr.isPassThrough&&t.xr.controllers.length>0)for(const l of t.xr.controllers){const h=l.getHitTest();h&&(c=!0,this.updateReticleAndHits(t.xr,l.index,h,t.xr.rigScale))}if(!c){const l=t.xr.getHitTest();l&&this.updateReticleAndHits(t.xr,0,l,t.xr.rigScale)}}else{if(this._anchor&&t.xr.referenceSpace){const a=t.xr.frame.getPose(this._anchor.anchorSpace,t.xr.referenceSpace);if(a&&this.context.time.frame%20===0){const c=t.xr.convertSpace(a.transform),l=this._reticle[0];l&&(l.position.copy(c.position),l.quaternion.copy(c.quaternion),this.onApplyPose(l))}}if(this.arTouchTransform?(this.userInput||(this.userInput=new Cf(this.context)),(s=this.userInput)==null||s.enable()):(r=this.userInput)==null||r.disable(),this.arTouchTransform&&((o=this.userInput)!=null&&o.hasChanged)){if(t.xr.rig){const a=t.xr.rig.gameObject;this.userInput.applyMatrixTo(a.matrix,!0),a.matrix.decompose(a.position,a.quaternion,a.scale),this.userInput.factor=a.scale.x}this.userInput.reset()}}}updateReticleAndHits(t,i,s,r){this._hits[i]=s.hit;let o=this._reticle[i];if(!o){if(this.customReticle)if(this.customReticle.asset)o=tv(this.customReticle.asset);else{this.customReticle.loadAssetAsync();return}else o=new me(new fd(.07,.09,32).rotateX(-Math.PI/2),new ri({side:Ai})),o.name="AR Placement Reticle";if(WO){const a=new Fo(1);a.position.y+=.01,o.add(a)}this._reticle[i]=o,o.matrixAutoUpdate=!1,o.visible=!1}o.position.lerp(s.position,this.context.time.deltaTime/.1),o.quaternion.slerp(s.quaternion,this.context.time.deltaTime/.05),o.scale.set(r,r,r),this.customReticle&&this.applyViewBasedTransform(o),o.updateMatrix(),o.visible=!0,o.parent!==this.context.scene&&this.context.scene.add(o),this._placementStartTime<0&&(this._placementStartTime=this.context.time.realtimeSinceStartup)}onScaleChanged(){}onRevertSceneChanges(){var t;for(const i of this._reticle)i&&(i.visible=!1,i==null||i.removeFromParent());this._reticle.length=0;for(let i=this._placementScene.children.length-1;i>=0;i--){const s=this._placementScene.children[i];this.context.scene.add(s)}(t=this._createdPlacementObject)==null||t.removeFromParent();for(const i of this._reparentedComponents)le.addComponent(i.originalObject,i.comp)}async onCreateAnchor(t,i){if(i.createAnchor===void 0){console.warn("Hit does not support creating an anchor",i),Tt()&&gn("Hit does not support creating an anchor");return}else{const s=await i.createAnchor(t.viewerPose.transform);t.running&&s&&(this._anchor=s)}}applyViewBasedTransform(t){const i=this.context.mainCamera,s=t,r=i.worldPosition,o=s.worldPosition;r.y=o.y,t.lookAt(r)}onApplyPose(t){var s,r,o,a;const i=(r=(s=mt.active)==null?void 0:s.rig)==null?void 0:r.gameObject;if((o=mt.active)!=null&&o.rigScale,i){const c=i.parent||this.context.scene;this._rigPlacementMatrix?(a=this._rigPlacementMatrix)==null||a.decompose(i.position,i.quaternion,i.scale):this._rigPlacementMatrix=i.matrix.clone(),this.applyViewBasedTransform(t),t.updateMatrix(),this.context.scene.add(t),t.attach(i),t.removeFromParent(),i.scale.set(this.arScale,this.arScale,this.arScale),i.position.multiplyScalar(this.arScale),i.updateMatrix(),this.invertForward&&i.matrix.premultiply(sie),i.matrix.premultiply(this._startOffset),i.matrix.decompose(i.position,i.quaternion,i.scale),c.add(i)}}}yv([x()],zo.prototype,"arScale",null);yv([x()],zo.prototype,"invertForward",void 0);yv([x(ii)],zo.prototype,"customReticle",void 0);yv([x()],zo.prototype,"useXRAnchor",void 0);yv([x()],zo.prototype,"arTouchTransform",void 0);const m_=class{constructor(e){u(this,"oneFingerDrag",!0);u(this,"twoFingerRotate",!0);u(this,"twoFingerScale",!0);u(this,"factor",1);u(this,"context");u(this,"offset");u(this,"plane");u(this,"_scale",1);u(this,"_hasChanged",!1);u(this,"_enabled",!1);u(this,"prev",new Map);u(this,"_didMultitouch",!1);u(this,"touchStart",e=>{for(let t=0;t<e.changedTouches.length;t++){const i=e.changedTouches[t];this.prev.has(i.identifier)||this.prev.set(i.identifier,{x:0,z:0,screenx:0,screeny:0});const s=this.prev.get(i.identifier);if(s){const r=this.getPositionOnPlane(i.clientX,i.clientY);s.x=r.x,s.z=r.z,s.screenx=i.clientX,s.screeny=i.clientY}}});u(this,"touchEnd",e=>{e.touches.length<=0&&(this._didMultitouch=!1)});u(this,"touchMove",e=>{if(!e.defaultPrevented){if(e.touches.length===1){if(this._didMultitouch)return;const t=e.touches[0],i=this.prev.get(t.identifier);if(!i)return;const s=this.getPositionOnPlane(t.clientX,t.clientY),r=s.x-i.x,o=s.z-i.z;if(r===0&&o===0)return;this.oneFingerDrag&&this.addMovement(r,o),i.x=s.x,i.z=s.z,i.screenx=t.clientX,i.screeny=t.clientY;return}else if(e.touches.length===2){this._didMultitouch=!0;const t=e.touches[0],i=e.touches[1],s=this.prev.get(t.identifier),r=this.prev.get(i.identifier);if(!s||!r)return;if(this.twoFingerRotate){const o=Math.atan2(t.clientY-i.clientY,t.clientX-i.clientX),a=Math.atan2(s.screeny-r.screeny,s.screenx-r.screenx),c=o-a;Math.abs(c)>.001&&this.addRotation(c)}if(this.twoFingerScale){const o=t.clientX-i.clientX,a=t.clientY-i.clientY,c=Math.sqrt(o*o+a*a),l=s.screenx-r.screenx,h=s.screeny-r.screeny,d=Math.sqrt(l*l+h*h),f=c-d;Math.abs(f)>2&&this.addScale(f)}s.screenx=t.clientX,s.screeny=t.clientY,r.screenx=i.clientX,r.screeny=i.clientY}}});u(this,"_raycaster",new Pp);u(this,"_intersection",new w);u(this,"_screenPos",new w);u(this,"_tempMatrix",new Ce);this.context=e,this.offset=new Ce,this.plane=new hr,this.plane.setFromNormalAndCoplanarPoint(m_.up,m_.zero)}enable(){this._enabled||(this._enabled=!0,window.addEventListener("touchstart",this.touchStart,{passive:!1}),window.addEventListener("touchmove",this.touchMove,{passive:!1}),window.addEventListener("touchend",this.touchEnd,{passive:!1}))}disable(){this._enabled&&(this._enabled=!1,window.removeEventListener("touchstart",this.touchStart),window.removeEventListener("touchmove",this.touchMove),window.removeEventListener("touchend",this.touchEnd))}reset(){this._scale=1,this.offset.identity()}get hasChanged(){return this._hasChanged}applyMatrixTo(e,t){this._hasChanged=!1,t?(this.offset.invert(),e.premultiply(this.offset)):e.multiply(this.offset)}getPositionOnPlane(e,t){const i=this.context.mainCamera;return this._screenPos.x=e/window.innerWidth*2-1,this._screenPos.y=-(t/window.innerHeight)*2+1,this._screenPos.z=1,this._screenPos.unproject(i),this._raycaster.set(i.position,this._screenPos.sub(i.position)),this._raycaster.ray.intersectPlane(this.plane,this._intersection),this._intersection}addMovement(e,t){e/=this._scale,t/=this._scale,e*=this.factor,t*=this.factor,this.offset.elements[12]+=e,this.offset.elements[14]+=t,(e!==0||t!==0)&&(this._hasChanged=!0)}addScale(e){e/=window.innerWidth,e*=-1,this._scale*=1+e,this._tempMatrix.makeScale(1-e,1-e,1-e),this.offset.premultiply(this._tempMatrix),e!==0&&(this._hasChanged=!0)}addRotation(e){e*=-1,this._tempMatrix.makeRotationY(e),this.offset.premultiply(this._tempMatrix),e!==0&&(this._hasChanged=!0)}};let Cf=m_;u(Cf,"up",new w(0,1,0)),u(Cf,"zero",new w(0,0,0)),u(Cf,"one",new w(1,1,1));const Kb="needle-webxr-buttons";class Rd extends HTMLElement{constructor(){super();u(this,"root");this.attachShadow({mode:"open"});const t=document.createElement("template");t.innerHTML=`<style>
        :host {
            position: absolute;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            /** increase z-index (nipplejs has 999 as default) */
            z-index: 5000;
            width: 100%;
            bottom: 100px;
            left: 50%;
            transform: translateX(-50%);
        }
        :host button {
            font-family: Roboto, sans-serif, Arial;
            border: none;
            color: black;
            background: rgba(255, 255, 255, 1);            
            margin: 5px 5px;
            padding: 0.5rem .7rem;
            font-size: 1rem;
            white-space: nowrap;
            transition: all 0.2s ease-in-out;
            border-radius: .2rem;
            border: rgba(255, 255, 255, 0.2) solid 1px;
            box-shadow: 0 0 12px rgba(0, 0, 0, 0.2);
            font-weight: normal;
        }
        :host button:hover {
            cursor: pointer;
            background: rgba(255, 255, 255, 1);
            box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.1), 0 0 15px rgba(255, 255, 255, 0.2);
            transition: all 0.1s ease-in-out;
        }
        :host button:disabled {
            background: rgba(200, 200, 200, 1);
            color: rgba(100, 100, 100, 1);
            border: rgba(0,0,0,0) 1px solid;
            box-shadow: none;
            cursor: initial;
        }
        :host button.this-mode-is-requested {
            font-weight: bold;
            background: repeating-linear-gradient(to right, #fff 0%, #fff 40%, #aaffff 55%, #fff 80%);
            background-size: 200% auto;
            background-position: 0 100%;
            animation: AnimationName .7s ease infinite forwards;
        }
        :host button.other-mode-is-requested {
        }
        
        @keyframes AnimationName {
            0% { background-position: 0% 0 }
            100% { background-position: -200% 0 }
        }

        :host .qr-code-container {
            position: absolute;
            display: initial;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%) translateY(-10px);
            background-color: white;
            padding: 1.2rem;
            border-radius: 0.4rem;
            pointer-events: all;
            opacity: 1;
            transition: opacity 0.2s ease-in-out;
            box-shadow: 0 0 12px rgba(0, 0, 0, 0.2);
        }

        :host .qr-code-container img {
            max-width: calc(min(100vw, 300px) - 20px);
        }

        :host .qr-code-container.hidden {
            opacity: 0;
            display: none; /* prevents the QR code from overflowing the body when it's actually disabled but breaks animation */
            pointer-events: none;
        }
        </style>
        `,this.root=document.createElement("div"),window.location.protocol!=="https:"&&this.root.classList.add("needs-https"),this.shadowRoot&&(this.shadowRoot.appendChild(t.content.cloneNode(!0)),this.shadowRoot.appendChild(this.root))}static create(){return document.createElement(Kb)}static getOrCreate(t){const i=t.domElement;let s=i.querySelector(Kb);return s||(s=Rd.create(),i.appendChild(s)),s}get isSecureConnection(){return window.location.protocol==="https:"}get quicklookButton(){var t;return(t=this.shadowRoot)==null?void 0:t.querySelector("[data-needle='quicklook-button']")}createQuicklookButton(){var s,r;const t=(s=this.shadowRoot)==null?void 0:s.querySelector("[data-needle='quicklook-button']");if(t)return t;const i=document.createElement("button");return i.dataset.needle="quicklook-button",i.innerText="Open in Quicklook",i.addEventListener("click",()=>{const o=le.findObjectOfType(kn);o?o.exportAsync():console.warn("No USDZExporter component found in the scene")}),this.hideElementDuringXRSession(i),(r=this.root)==null||r.appendChild(i),i}get arButton(){var t;return(t=this.shadowRoot)==null?void 0:t.querySelector("[data-needle='webxr-ar-button']")}createARButton(t){var o,a,c;const i=(o=this.shadowRoot)==null?void 0:o.querySelector("[data-needle='webxr-ar-button']");if(i)return i;const s="immersive-ar",r=document.createElement("button");return r.classList.add("webxr-button"),r.dataset.needle="webxr-ar-button",r.innerText="Enter AR",r.title="Click to start a WebXR session in AR",r.addEventListener("click",()=>mt.start(s,t)),this.updateSessionSupported(r,s),this.listenToXRSessionState(r,s),this.hideElementDuringXRSession(r),(a=this.root)==null||a.appendChild(r),this.isSecureConnection||(r.disabled=!0,r.title="WebXR requires a secure connection (HTTPS)"),$f()||(c=navigator.xr)==null||c.addEventListener("devicechange",()=>this.updateSessionSupported(r,s)),r}get vrButton(){var t;return(t=this.shadowRoot)==null?void 0:t.querySelector("[data-needle='webxr-vr-button']")}createVRButton(t){var o,a,c;const i=(o=this.shadowRoot)==null?void 0:o.querySelector("[data-needle='webxr-vr-button']");if(i)return i;const s="immersive-vr",r=document.createElement("button");return r.classList.add("webxr-button"),r.dataset.needle="webxr-vr-button",r.innerText="Enter VR",r.title="Click to start a WebXR session in VR",r.addEventListener("click",()=>mt.start(s,t)),this.updateSessionSupported(r,s),this.listenToXRSessionState(r,s),this.hideElementDuringXRSession(r),(a=this.root)==null||a.appendChild(r),this.isSecureConnection||(r.disabled=!0,r.title="WebXR requires a secure connection (HTTPS)"),$f()||(c=navigator.xr)==null||c.addEventListener("devicechange",()=>this.updateSessionSupported(r,s)),r}get sendToQuestButton(){var t;return(t=this.shadowRoot)==null?void 0:t.querySelector("[data-needle='webxr-sendtoquest-button']")}createSendToQuestButton(){var r,o,a;const t=(r=this.shadowRoot)==null?void 0:r.querySelector("[data-needle='webxr-sendtoquest-button']");if(t)return t;const i="https://oculus.com/open_url/?url=",s=document.createElement("button");return s.dataset.needle="webxr-sendtoquest-button",s.innerText="Open on Quest",s.title="Click to send this page to the Oculus Browser on your Quest",s.addEventListener("click",()=>{const c=encodeURIComponent(window.location.href);window.open(i+c)}),this.listenToXRSessionState(s),this.hideElementDuringXRSession(s),$f()||(o=navigator.xr)==null||o.addEventListener("devicechange",()=>{var c;(c=navigator.xr)!=null&&c.isSessionSupported("immersive-vr")?s.style.display="none":s.style.display=""}),(a=this.root)==null||a.appendChild(s),s}async createQRCode(){var o;const t=document.createElement("div");t.style.position="relative",t.style.display="inline-block",this.hideElementDuringXRSession(t);const i=document.createElement("div");i.classList.add("qr-code-container"),i.classList.add("hidden"),r();const s=document.createElement("button");s.innerText="QR Code",s.title="Scan this QR code with your phone to open this page",s.addEventListener("click",()=>{i.classList.toggle("hidden"),!i.classList.contains("hidden")&&r()});async function r(){const c=await o8({text:window.location.href,width:200,height:200});i.innerHTML="",i.appendChild(c)}t.appendChild(s),t.appendChild(i),(o=this.root)==null||o.appendChild(t)}updateSessionSupported(t,i){if(!("xr"in navigator)){t.style.display="none";return}mt.isSessionSupported(i).then(s=>{t.style.display=s?"":"none",Tt()&&!s&&console.warn(i+" is not supported on this device - make sure your server runs using HTTPS and you have a device connected that supports "+i)})}hideElementDuringXRSession(t){mt.onXRSessionStart(i=>{t["previous-display"]=t.style.display,t.style.display="none"}),mt.onXRSessionEnd(i=>{t["previous-display"]!=null&&(t.style.display=t["previous-display"])})}listenToXRSessionState(t,i){i&&(mt.onSessionRequestStart(s=>{s.mode===i?t.classList.add("this-mode-is-requested"):(t["was-disabled"]=t.disabled,t.disabled=!0,t.classList.add("other-mode-is-requested"))}),mt.onSessionRequestEnd(s=>{t.classList.remove("this-mode-is-requested"),t.classList.remove("other-mode-is-requested"),t.disabled=t["was-disabled"]}))}}customElements.get(Kb)||customElements.define(Kb,Rd);var zl=globalThis&&globalThis.__decorate||function(n,e,t,i){var s=arguments.length,r=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(e,t,r):o(e,t))||r);return s>3&&r&&Object.defineProperty(e,t,r),r};const _u=re("debugtext");var Jt;(function(n){n[n.UpperLeft=0]="UpperLeft",n[n.UpperCenter=1]="UpperCenter",n[n.UpperRight=2]="UpperRight",n[n.MiddleLeft=3]="MiddleLeft",n[n.MiddleCenter=4]="MiddleCenter",n[n.MiddleRight=5]="MiddleRight",n[n.LowerLeft=6]="LowerLeft",n[n.LowerCenter=7]="LowerCenter",n[n.LowerRight=8]="LowerRight"})(Jt||(Jt={}));var Sg;(function(n){n[n.Truncate=0]="Truncate",n[n.Overflow=1]="Overflow"})(Sg||(Sg={}));var Cg;(function(n){n[n.Wrap=0]="Wrap",n[n.Overflow=1]="Overflow"})(Cg||(Cg={}));var Br;(function(n){n[n.Normal=0]="Normal",n[n.Bold=1]="Bold",n[n.Italic=2]="Italic",n[n.BoldAndItalic=3]="BoldAndItalic"})(Br||(Br={}));class er extends vl{constructor(){super(...arguments);u(this,"alignment",Jt.UpperLeft);u(this,"verticalOverflow",Sg.Truncate);u(this,"horizontalOverflow",Cg.Wrap);u(this,"lineSpacing",1);u(this,"supportRichText",!1);u(this,"font");u(this,"fontStyle",Br.Normal);u(this,"sRGBTextColor",new ye(1,0,1));u(this,"_text","");u(this,"_fontSize",12);u(this,"_textMeshUi",null);u(this,"_didHandleTextRenderOnTop",!1)}setAlphaFactor(t){var i;super.setAlphaFactor(t),(i=this.uiObject)==null||i.set({fontOpacity:this.color.alpha*this.alphaFactor}),this.markDirty()}get text(){return this._text}set text(t){t!==this._text&&(this._text=t,this.feedText(this.text,this.supportRichText),this.markDirty())}set_text(t){this.text=t}get fontSize(){return this._fontSize}set fontSize(t){var i;this._fontSize=t,(i=this.uiObject)==null||i.set({fontSize:t})}onColorChanged(){var t;this.sRGBTextColor.copy(this.color),this.sRGBTextColor.convertLinearToSRGB(),(t=this.uiObject)==null||t.set({color:this.sRGBTextColor,fontOpacity:this.color.alpha})}onParentRectTransformChanged(){super.onParentRectTransformChanged(),this.uiObject&&this.updateOverflow()}onBeforeCanvasRender(t){this.updateOverflow()}updateOverflow(){var i;const t=(i=this.uiObject)==null?void 0:i._overflow;t&&(t._needsUpdate=!0,this.markDirty())}onCreate(t){_u&&console.log(this),this.horizontalOverflow==Cg.Overflow&&(t.whiteSpace="pre"),this.verticalOverflow==Sg.Truncate&&(this.context.renderer.localClippingEnabled=!0,t.overflow="hidden"),this.horizontalOverflow==Cg.Overflow&&this.verticalOverflow==Sg.Truncate,t.lineHeight=this.lineSpacing,delete t.backgroundOpacity,delete t.backgroundColor,_u&&(t.backgroundColor=16750848,t.backgroundOpacity=.5);const i=this.rectTransform;t={...t,...this.getTextOpts()},this.getAlignment(t),_u&&(t.backgroundColor=Math.random()*16777215,t.backgroundOpacity=.1),this.uiObject=i.createNewText(t),this.feedText(this.text,this.supportRichText)}onAfterAddedToScene(){super.onAfterAddedToScene(),this.handleTextRenderOnTop()}getTextOpts(){const t=this.fontSize,i={color:this.color,fontOpacity:this.color.alpha,fontSize:t,fontKerning:"normal"};return this.setFont(i,this.fontStyle),i}onEnable(){var t;super.onEnable(),this._didHandleTextRenderOnTop=!1,this.uiObject&&this.uiObject.addAfterUpdate(()=>{this.setShadowComponentOwner(this.uiObject),this.markDirty()}),setTimeout(()=>this.markDirty(),10),(t=this.canvas)==null||t.registerEventReceiver(this)}onDisable(){var t;super.onDisable(),(t=this.canvas)==null||t.unregisterEventReceiver(this)}getAlignment(t){switch(t.flexDirection="column",this.alignment){case Jt.UpperLeft:case Jt.MiddleLeft:case Jt.LowerLeft:t.textAlign="left";break;case Jt.UpperCenter:case Jt.MiddleCenter:case Jt.LowerCenter:t.textAlign="center";break;case Jt.UpperRight:case Jt.MiddleRight:case Jt.LowerRight:t.textAlign="right";break}switch(this.alignment){default:case Jt.UpperLeft:case Jt.UpperCenter:case Jt.UpperRight:t.alignItems="start";break;case Jt.MiddleLeft:case Jt.MiddleCenter:case Jt.MiddleRight:t.alignItems="center";break;case Jt.LowerLeft:case Jt.LowerCenter:case Jt.LowerRight:t.alignItems="end";break}return t}feedText(t,i){var s,r,o;if(_u&&console.log("feedText",this.uiObject,t,i),!!this.uiObject)if(this._textMeshUi||(this._textMeshUi=[]),this.uiObject.children.length=0,!i||t.length===0)this.uiObject.textContent=t;else{let a=this.getNextTag(t);if(a){if(a.startIndex>0){for(let h=this.uiObject.children.length-1;h>=0;h--){const d=this.uiObject.children[h];d.isUI&&(this.uiObject.remove(d),d.clear())}const l=new O0({textContent:t.substring(0,a.startIndex),color:"inherit"});this.uiObject.add(l)}}else{this.uiObject.textContent="",this.setOptions({textContent:t});return}const c=[];for(;a;){const l=this.getNextTag(t,a.endIndex),h={fontFamily:(s=this.uiObject)==null?void 0:s.get("fontFamily"),color:"inherit",textContent:""};if(l){h.textContent=this.getText(t,a,l),this.handleTag(a,h,c);const d=new O0(h);(r=this.uiObject)==null||r.add(d)}else{h.textContent=t.substring(a.endIndex),this.handleTag(a,h,c);const d=new O0(h);(o=this.uiObject)==null||o.add(d)}a=l}}}handleTextRenderOnTop(){this._didHandleTextRenderOnTop||(this._didHandleTextRenderOnTop=!0,this.startCoroutine(this.renderOnTopCoroutine()))}*renderOnTopCoroutine(){if(!this.canvas)return;const t=[],i=this.canvas,s={renderOnTop:i.renderOnTop,depthWrite:i.depthWrite,doubleSided:i.doubleSided};for(;;){let r=!1;if(this._textMeshUi)for(let o=0;o<this._textMeshUi.length;o++){if(t[o]===!0)continue;r=!0;const a=this._textMeshUi[o];a.textContent&&(Hb(a,s),t[o]=!0)}if(!r)break;yield}}handleTag(t,i,s){if(!t.isEndTag){if(t.type.includes("color")){const r=new yC(t,{color:i.color});if(s.push(r),t.type.length>6){const o=parseInt("0x"+t.type.substring(7));i.color=o}else i.color=new ye(1,1,1)}else if(t.type=="b"){this.setFont(i,Br.Bold);const r=new yC(t,{fontWeight:700});s.push(r)}else if(t.type=="i"){this.setFont(i,Br.Italic);const r=new yC(t,{fontStyle:"italic"});s.push(r)}}}getText(t,i,s){return t.substring(i.endIndex,s.startIndex)}getNextTag(t,i=0){const s=t.indexOf("<",i),r=t.indexOf(">",s);if(s>=0&&r>=0){const o=t.substring(s+1,r);return{type:o,startIndex:s,endIndex:r+1,isEndTag:o.startsWith("/")}}return null}setFont(t,i){if(!this.font)return;const s=this.font,r=this.getFamilyNameWithCorrectSuffix(s,i);_u&&console.log("Selected font family:"+r);let o=lT.getFontFamily(r);switch(o||(o=lT.addFontFamily(r)),t.fontFamily=o,i){default:case Br.Normal:t.fontWeight=400,t.fontStyle="normal";break;case Br.Bold:t.fontWeight=700,t.fontStyle="normal";break;case Br.Italic:t.fontWeight=400,t.fontStyle="italic";break;case Br.BoldAndItalic:t.fontStyle="italic",t.fontWeight=400}let a=o.getVariant(t.fontWeight,t.fontStyle);if(!a){let c=r;c!=null&&c.endsWith("-msdf.json")||(c+="-msdf.json");let l=r;l!=null&&l.endsWith(".png")||(l+=".png"),a=o.addVariant(t.fontWeight,t.fontStyle,c,l),a==null||a.addEventListener("ready",()=>{this.markDirty()})}}getFamilyNameWithCorrectSuffix(t,i){var h;const s=t.lastIndexOf("-");if(s<0)return t;const r=(h=t.substring(s+1))==null?void 0:h.toLowerCase();if(rie.includes(r))return _u&&console.warn("Unsupported font style: "+r),t;const o=t.lastIndexOf("/");let a=t;o>=0&&(a=a.substring(o+1));const c=a[0]===a[0].toUpperCase(),l=t.substring(0,s);switch(_u&&console.log("Select font: ",t,Br[i],a,c,l),i){case Br.Normal:return c?l+"-Regular":l+"-regular";case Br.Bold:return c?l+"-Bold":l+"-bold";case Br.Italic:return c?l+"-Italic":l+"-italic";case Br.BoldAndItalic:return c?l+"-BoldItalic":l+"-bolditalic";default:return t}}}zl([x()],er.prototype,"alignment",void 0);zl([x()],er.prototype,"verticalOverflow",void 0);zl([x()],er.prototype,"horizontalOverflow",void 0);zl([x()],er.prototype,"lineSpacing",void 0);zl([x()],er.prototype,"supportRichText",void 0);zl([x(URL)],er.prototype,"font",void 0);zl([x()],er.prototype,"fontStyle",void 0);zl([x()],er.prototype,"text",null);zl([x()],er.prototype,"fontSize",null);class yC{constructor(e,t){u(this,"tag");u(this,"previousValues");this.tag=e,this.previousValues=t}}const rie=["medium","mediumitalic","black","blackitalic","thin","thinitalic","extrabold","light","lightitalic","semibold"];var Eg;(function(n){n.singleLine="singleLine",n.hardBreaks="hardBreaks",n.flowing="flowing"})(Eg||(Eg={}));var zf;(function(n){n.left="left",n.center="center",n.right="right",n.justified="justified"})(zf||(zf={}));var Gf;(function(n){n.top="top",n.middle="middle",n.lowerMiddle="lowerMiddle",n.baseline="baseline",n.bottom="bottom"})(Gf||(Gf={}));class ju{constructor(e){u(this,"id");u(this,"content","");u(this,"font",[]);u(this,"pointSize",144);u(this,"width");u(this,"height");u(this,"depth");u(this,"wrapMode");u(this,"horizontalAlignment");u(this,"verticalAlignment");u(this,"material");this.id=e}static getId(){return this.global_id++}setDepth(e){return this.depth=e,this}setPointSize(e){return this.pointSize=e,this}setHorizontalAlignment(e){return this.horizontalAlignment=e,this}setVerticalAlignment(e){return this.verticalAlignment=e,this}writeTo(e,t){var s;t.beginBlock(`def Preliminary_Text "${this.id}"`,"(",!1),t.appendLine('prepend apiSchemas = ["MaterialBindingAPI"]'),t.closeBlock(")"),t.beginBlock(),this.content&&t.appendLine(`string content = "${this.content}"`),(!this.font||this.font.length<=0)&&(this.font||(this.font=[]),(s=this.font)==null||s.push("sans-serif"));const i=this.font.map(r=>`"${r}"`).join(", ");t.appendLine(`string[] font = [ ${i} ]`),t.appendLine(`double pointSize = ${this.pointSize}`),typeof this.width=="number"&&t.appendLine(`double width = ${this.width}`),typeof this.height=="number"&&t.appendLine(`double height = ${this.height}`),typeof this.depth=="number"&&t.appendLine(`double depth = ${this.depth}`),this.wrapMode&&t.appendLine(`token wrapMode = "${this.wrapMode}"`),this.horizontalAlignment&&t.appendLine(`token horizontalAlignment = "${this.horizontalAlignment}"`),this.verticalAlignment&&t.appendLine(`token verticalAlignment = "${this.verticalAlignment}"`),this.material!==void 0&&t.appendLine(`rel material:binding = </StageRoot/Materials/Material_${this.material.id}>`),t.closeBlock()}}u(ju,"global_id",0);class MI{static singleLine(e,t,i){const s=new ju("text_"+ju.getId());return s.content=e,t&&(s.pointSize=t),i&&(s.depth=i),s}static multiLine(e,t,i,s,r,o){const a=new ju("text_"+ju.getId());return a.content=e,a.width=t,a.height=i,a.horizontalAlignment=s,a.verticalAlignment=r,o!==void 0&&(a.wrapMode=o),a}}const oie=new Ce().makeRotationY(Math.PI),aie=new Ce().makeScale(-1,1,-1);class Zx{get extensionName(){return"text"}onExportObject(e,t,i){}exportText(e,t,i){const s=le.getComponent(e,er);if(!s)return;const r=le.getComponent(e,Ys);let o=100,a=100;r&&(o=r.width,a=r.height),t.matrix=oie.clone(),r&&t.matrix.premultiply(aie);const c=s.color.clone();t.material=new Ur({color:c,emissive:c}),t.addEventListener("serialize",(l,h)=>{let d=s.text;d=d.replace(/\r/g,""),d=d.replace(/\n/g,"\\n");const f=MI.multiLine(d,o,a,zf.center,Gf.bottom,Eg.flowing);this.setTextAlignment(f,s.alignment),this.setOverflow(f,s),t.material&&(f.material=t.material),f.pointSize=this.convertToTextSize(s.fontSize),f.depth=.001,f.writeTo(void 0,l)})}convertToTextSize(e){return 1/.0502*144*e}setOverflow(e,t){t.horizontalOverflow?e.wrapMode=Eg.singleLine:e.wrapMode=Eg.flowing}setTextAlignment(e,t){switch(t){case Jt.LowerLeft:case Jt.MiddleLeft:case Jt.UpperLeft:e.horizontalAlignment=zf.left;break;case Jt.LowerCenter:case Jt.MiddleCenter:case Jt.UpperCenter:e.horizontalAlignment=zf.center;break;case Jt.LowerRight:case Jt.MiddleRight:case Jt.UpperRight:e.horizontalAlignment=zf.right;break}switch(t){case Jt.LowerLeft:case Jt.LowerCenter:case Jt.LowerRight:e.verticalAlignment=Gf.bottom;break;case Jt.MiddleLeft:case Jt.MiddleCenter:case Jt.MiddleRight:e.verticalAlignment=Gf.middle;break;case Jt.UpperLeft:case Jt.UpperCenter:case Jt.UpperRight:e.verticalAlignment=Gf.top;break}}}class II{get extensionName(){return"tmui"}onExportObject(e,t,i){const s=le.getComponent(e,as);if(s&&s.activeAndEnabled&&s.renderMode===Qa.WorldSpace){const r=new Zx,o=le.getComponent(e,Ys),a=le.getComponent(e,yd);if(o){o.width,o.height;const c=Zr.createEmpty(),l=o.shadowComponent;if(t.add(c),l){const h=l.matrix;c.matrix.copy(h);const d=new Map,f=new Map;d.set(l,c),f.set(l,a?a.alpha:1),l.traverse(p=>{if(p===l)return;const m=Zr.createEmpty();m.matrix.copy(p.matrix);const g=p.parent,y=!!g&&typeof g.textContent=="string"&&g.textContent.length>0;let A=f.get(g)||1;const v=le.getComponent(p,yd);if(v&&(A*=v.alpha),p instanceof me&&y){const _=p[Bo];_?r.exportText(_.gameObject,m,i):console.error("Error when exporting UI: shadow component owner not found. This is likely a bug.",p)}if(p instanceof me&&!y){const _=p.geometry.clone();_.scale(1,1,-1),this.flipWindingOrder(_),m.geometry=_;const T=new ye,E=p.material.opacity;T.copy(p.material.color),m.material=new ri({color:T,opacity:E*A,map:p.material.map,transparent:!0})}d.set(p,m),f.set(p,A);const b=d.get(g);if(!b){console.error("Error when exporting UI: shadow component parent not found!",p,p.parent);return}b.add(m)})}}}}flipWindingOrder(e){const t=e.index.array;for(let i=0,s=t.length/3;i<s;i++){const r=t[i*3];t[i*3]=t[i*3+2],t[i*3+2]=r}e.index.needsUpdate=!0}}const n0=re("debugusdz");function cie(n,e){var o;const t=[],i=le.getComponentsInChildren(n,Xs),s=le.getComponentsInChildren(n,Uo),r=new Array;if(e.injectImplicitBehaviours)for(const a of i){if(!a||!a.runtimeAnimatorController)continue;const c=a.runtimeAnimatorController.activeState;if(!c||!c.motion||!c.motion.clip||((o=c.motion.clip.tracks)==null?void 0:o.length)<1)continue;const l=new hl;l.animator=a,l.stateName=c.name,l.trigger="start",l.name="PlayAnimationOnClick_implicitAtStart_"+l.stateName;const h=new ge;le.addComponent(h,l),r.push(h),n.add(h)}else for(const a of i){if(!a||!a.runtimeAnimatorController)continue;n0&&console.log(a);const c=[];for(const l of a.runtimeAnimatorController.enumerateActions()){n0&&console.log(l);const h=l.getClip();c.includes(h)||c.push(h)}t.push({root:a.gameObject,clips:c})}for(const a of s){n0&&console.log(a);const c=[];for(const l of a.animations)c.includes(l)||c.push(l);t.push({root:a.gameObject,clips:c})}n0&&console.log("USDZ Animation Clips",t);for(const a of t)for(const c of a.clips)e.registerAnimation(a.root,c);return r}function qO(n){const e=n.domElement.shadowRoot.querySelector("link[rel='ar']");if(e)return e;const t=document.createElement("div");t.classList.add("menu"),t.classList.add("quicklook-menu"),t.style.display="none",t.style.visibility="hidden";const i=document.createElement("button");i.id="open-in-ar",i.innerText="Open in QuickLook",t.appendChild(i);const s=document.createElement("a");s.id="needle-usdz-link",s.style.display="none",s.rel="ar",s.href="",t.appendChild(s);const r=document.createElement("img");return r.id="button",s.appendChild(r),n.domElement.shadowRoot.appendChild(t),s}function lie(){var n=new Date;const e=n.getMonth()+1,t=n.getDate(),i=n.getHours(),s=n.getMinutes(),r=n.getSeconds(),o=(e<10?"0":"")+e,a=(t<10?"0":"")+t,c=(i<10?"0":"")+i,l=(s<10?"0":"")+s,h=(r<10?"0":"")+r;return n.getFullYear()+o+a+"-"+c+l+h}var wr=globalThis&&globalThis.__decorate||function(n,e,t,i){var s=arguments.length,r=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(e,t,r):o(e,t))||r);return s>3&&r&&Object.defineProperty(e,t,r),r};const ar=re("debugusdz");class Pd{constructor(){u(this,"callToAction");u(this,"checkoutTitle");u(this,"checkoutSubtitle");u(this,"callToActionURL")}}wr([x()],Pd.prototype,"callToAction",void 0);wr([x()],Pd.prototype,"checkoutTitle",void 0);wr([x()],Pd.prototype,"checkoutSubtitle",void 0);wr([x()],Pd.prototype,"callToActionURL",void 0);const g_=class extends Te{constructor(){super(...arguments);u(this,"objectToExport");u(this,"autoExportAnimations",!1);u(this,"exportFileName");u(this,"customUsdzFile");u(this,"customBranding");u(this,"anchoringType","plane");u(this,"maxTextureSize",2048);u(this,"planeAnchoringAlignment","horizontal");u(this,"interactive",!0);u(this,"allowCreateQuicklookButton",!0);u(this,"quickLookCompatible",!0);u(this,"extensions",[]);u(this,"link");u(this,"button");u(this,"onClickedOpenInARElement",t=>{t.preventDefault(),this.exportAsync()});u(this,"lastCallback")}start(){var t,i,s;ar&&(console.log("USDZExporter",this),console.log("Debug USDZ Mode. Press 'T' to export"),window.addEventListener("keydown",r=>{switch(r.key){case"t":this.exportAsync();break}}),Pl()&&setTimeout(()=>{this.exportAsync()},2e3)),this.objectToExport||(this.objectToExport=this.gameObject),!((i=(t=this.objectToExport)==null?void 0:t.children)!=null&&i.length)&&!((s=this.objectToExport)!=null&&s.isMesh)&&(this.objectToExport=this.context.scene),this.interactive&&(this.extensions.push(new xI),this.extensions.push(new gI),this.extensions.push(new Zx),this.extensions.push(new II))}onEnable(){var s;const t=QA(),i=og();(ar||t&&i)&&(this.allowCreateQuicklookButton&&(this.button=this.createQuicklookButton()),this.lastCallback=this.quicklookCallback.bind(this),this.link=qO(this.context),this.link.addEventListener("message",this.lastCallback)),ar&&Tn("USDZ Exporter enabled: "+this.name),(s=document.getElementById("open-in-ar"))==null||s.addEventListener("click",this.onClickedOpenInARElement)}onDisable(){var t,i,s;(t=this.button)==null||t.remove(),(i=this.link)==null||i.removeEventListener("message",this.lastCallback),ar&&Tn("USDZ Exporter disabled: "+this.name),(s=document.getElementById("open-in-ar"))==null||s.removeEventListener("click",this.onClickedOpenInARElement)}async exportAsync(){var s;let t=this.exportFileName??((s=this.objectToExport)==null?void 0:s.name)??this.name;if(t+="-"+lie(),Ag()||(t!==""&&(t+="-"),t+="MadeWithNeedle"),this.link||(this.link=qO(this.context)),this.customUsdzFile){ar&&console.log("Exporting custom usdz",this.customUsdzFile),this.openInQuickLook(this.customUsdzFile,t);return}const i=await this.export(this.objectToExport);if(!i){console.warn("No object to export",this);return}ar&&console.log("USDZ generation done. Downloading as "+this.link.download),this.openInQuickLook(i,t)}async export(t){if(!t)return null;const i=le.getComponentsInChildren(t,an),s=new Array;for(const p of i)for(const m of p.sharedMaterials)if(m){const g=p.loadProgressiveTextures(m);g instanceof Promise&&s.push(g)}ar&&Tn("Load textures: "+s.length),await Promise.all(s),ar&&Tn("Load textures: done");const r=Qs.Global.Mask;Qs.Global.Set(Do.AR),this.applyWebARSessionRoot();const o=new jee,a=[...this.extensions],c=new Lx(this.quickLookCompatible);a.push(c);const l={self:this,exporter:o,extensions:a,object:t};this.dispatchEvent(new CustomEvent("before-export",{detail:l}));const h=new Array;this.autoExportAnimations&&h.push(...cie(t,c)),o.debug=ar,this.anchoringType!=="plane"&&this.anchoringType!=="none"&&this.anchoringType!=="image"&&this.anchoringType!=="face"&&(this.anchoringType="plane"),this.planeAnchoringAlignment!=="horizontal"&&this.planeAnchoringAlignment!=="vertical"&&this.planeAnchoringAlignment!=="any"&&(this.planeAnchoringAlignment="horizontal");const d=await o.parse(this.objectToExport,{ar:{anchoring:{type:this.anchoringType},planeAnchoring:{alignment:this.planeAnchoringAlignment}},extensions:a,quickLookCompatible:this.quickLookCompatible,maxTextureSize:this.maxTextureSize}),f=new Blob([d],{type:"application/octet-stream"});for(const p of h)le.destroy(p);return this.dispatchEvent(new CustomEvent("after-export",{detail:l})),Qs.Global.Set(r),f}openInQuickLook(t,i){const s=t instanceof Blob?URL.createObjectURL(t):t,r=this.buildQuicklookOverlay();ar&&console.log("QuickLook Overlay",r);const o=r.callToAction?encodeURIComponent(r.callToAction):"",a=r.checkoutTitle?encodeURIComponent(r.checkoutTitle):"",c=r.checkoutSubtitle?encodeURIComponent(r.checkoutSubtitle):"";this.link.href=s+`#callToAction=${o}&checkoutTitle=${a}&checkoutSubtitle=${c}&callToActionURL=${r.callToActionURL}`,this.lastCallback||(this.lastCallback=this.quicklookCallback.bind(this),this.link.addEventListener("message",this.lastCallback)),this.link.download=i+".usdz",this.link.click()}download(t,i){g_.save(t,i)}static save(t,i){const s=document.createElement("a");s.style.display="none",document.body.appendChild(s),typeof t=="string"?s.href=t:s.href=URL.createObjectURL(t),s.download=i,s.click(),s.remove()}quicklookCallback(t){if((t==null?void 0:t.data)=="_apple_ar_quicklook_button_tapped"){ar&&gn("Quicklook closed via call to action button");var i=new CustomEvent("quicklook-button-tapped",{detail:this});if(this.dispatchEvent(i),!i.defaultPrevented){const s=new URLSearchParams(this.link.href);if(s){const r=s.get("callToActionURL");ar&&Tn("Quicklook url: "+r),r&&(Ag()?globalThis.open(r,"_blank"):console.warn("Quicklook closed: custom redirects require a Needle Engine Pro license: https://needle.tools/pricing",r))}}}}buildQuicklookOverlay(){var s,r,o,a,c,l;const t={};return this.customBranding&&Object.assign(t,this.customBranding),Ag()||(console.log("Custom Quicklook banner text requires pro license: https://needle.tools/pricing"),t.callToAction="Close",t.checkoutTitle=" Made with Needle",t.checkoutSubtitle="_"),(((s=t.callToAction)==null?void 0:s.length)||((r=t.checkoutTitle)==null?void 0:r.length)||((o=t.checkoutSubtitle)==null?void 0:o.length))&&((a=t.callToAction)!=null&&a.length||(t.callToAction="\0"),(c=t.checkoutTitle)!=null&&c.length||(t.checkoutTitle="\0"),(l=t.checkoutSubtitle)!=null&&l.length||(t.checkoutSubtitle="\0")),this.dispatchEvent(new CustomEvent("quicklook-overlay",{detail:t})),t}applyWebARSessionRoot(){if(!this.objectToExport)return;let t=le.getComponentInParent(this.objectToExport,zo);const i=t!=null;if(t||(t=le.getComponentInChildren(this.objectToExport,zo)),ar&&console.log("applyWebARSessionRoot",t),!t){ar&&console.warn("No WebARSessionRoot found in parent hierarchy",this.objectToExport);return}const s=i?this.objectToExport:t.gameObject,r=1/t.arScale;ar&&console.log("AR Session Root scale",r,s),s.matrix.makeScale(r,r,r),t.invertForward&&s.matrix.multiply(g_.invertForwardMatrix)}createQuicklookButton(){const t=Rd.getOrCreate(this.context),i=t.createQuicklookButton();return i.parentNode||t.appendChild(i),i}};let kn=g_;u(kn,"invertForwardMatrix",new Ce().makeRotationY(Math.PI));wr([x(ge)],kn.prototype,"objectToExport",void 0);wr([x()],kn.prototype,"autoExportAnimations",void 0);wr([x()],kn.prototype,"exportFileName",void 0);wr([x(URL)],kn.prototype,"customUsdzFile",void 0);wr([x(Pd)],kn.prototype,"customBranding",void 0);wr([x()],kn.prototype,"anchoringType",void 0);wr([x()],kn.prototype,"maxTextureSize",void 0);wr([x()],kn.prototype,"planeAnchoringAlignment",void 0);wr([x()],kn.prototype,"interactive",void 0);wr([x()],kn.prototype,"allowCreateQuicklookButton",void 0);wr([x()],kn.prototype,"quickLookCompatible",void 0);class $x extends Te{constructor(){super(...arguments);u(this,"isUsed",!0);u(this,"usedBy",null)}}const XO=re("debugdeletable");class RI extends ra{}class Qz extends Te{constructor(){super(...arguments);u(this,"deleteBoxes",[])}awake(){this.deleteBoxes=le.findObjectsOfType(RI,this.context)}update(){for(const t of this.deleteBoxes){const i=this.gameObject;if(t.isInBox(i)===!0){const r=le.getComponentInParent(this.gameObject,$x);r?XO&&console.warn("Can not delete object with usage marker",this.guid,r):(XO&&console.log("DESTROY",this.gameObject),iI(this.gameObject,this.context.connection))}}}}var Bd=globalThis&&globalThis.__decorate||function(n,e,t,i){var s=arguments.length,r=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(e,t,r):o(e,t))||r);return s>3&&r&&Object.defineProperty(e,t,r),r},FT;(function(n){n[n.Off=0]="Off",n[n.Gaussian=1]="Gaussian",n[n.Bokeh=2]="Bokeh"})(FT||(FT={}));const YO=re("debugpost");class Sc extends xr{constructor(){super(...arguments);u(this,"mode");u(this,"focusDistance");u(this,"focalLength");u(this,"aperture");u(this,"gaussianMaxRadius");u(this,"resolutionScale");u(this,"bokehScale")}get typeName(){return"DepthOfField"}init(){YO&&console.log("DOF: INIT"),this.focalLength.valueProcessor=i=>{const s=i/300,r=2;return nt.lerp(r,.01,s)};const t=20;this.aperture.valueProcessor=i=>{const s=1-i/32;return nt.lerp(1,t,s)}}onCreateEffect(){if(this.mode===FT.Off){YO&&console.warn("DepthOfField: Mode is set to Off");return}const t=1/window.devicePixelRatio;if(this.resolutionScale===void 0){let s=1;Pl()&&(s=.6),this.resolutionScale=new It(s*t)}const i=new zF(this.context.mainCamera,{worldFocusRange:.2,focalLength:1,bokehScale:20,resolutionScale:this.resolutionScale.value});return this.focusDistance.onValueChanged=s=>{i.cocMaterial.worldFocusDistance=s},this.focalLength.onValueChanged=s=>i.cocMaterial.worldFocusRange=s,this.aperture.onValueChanged=s=>i.bokehScale=s,this.resolutionScale&&(this.resolutionScale.onValueChanged=s=>i.resolution.scale=s),[i]}unapply(){}}Bd([x()],Sc.prototype,"mode",void 0);Bd([x(It)],Sc.prototype,"focusDistance",void 0);Bd([x(It)],Sc.prototype,"focalLength",void 0);Bd([x(It)],Sc.prototype,"aperture",void 0);Bd([x(It)],Sc.prototype,"gaussianMaxRadius",void 0);Bd([x(It)],Sc.prototype,"resolutionScale",void 0);Bd([x(It)],Sc.prototype,"bokehScale",void 0);_a("DepthOfField",Sc);var hie=globalThis&&globalThis.__decorate||function(n,e,t,i){var s=arguments.length,r=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(e,t,r):o(e,t))||r);return s>3&&r&&Object.defineProperty(e,t,r),r},Zb;(function(n){n[n.Never=0]="Never",n[n.Desktop=1]="Desktop",n[n.Mobile=2]="Mobile"})(Zb||(Zb={}));class PI extends Te{constructor(){super(...arguments);u(this,"visibleOn")}onEnable(){this.apply()}apply(){this.test()||le.setActive(this.gameObject,!1)}test(){return this.visibleOn<0?!0:Pl()?(this.visibleOn&Zb.Mobile)!==0:(this.visibleOn&Zb.Desktop)!==0}}hie([x()],PI.prototype,"visibleOn",void 0);class jz{get extensionName(){return"DocumentExtension"}onAfterBuildDocument(e){}}var Dd=globalThis&&globalThis.__decorate||function(n,e,t,i){var s=arguments.length,r=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(e,t,r):o(e,t))||r);return s>3&&r&&Object.defineProperty(e,t,r),r};const oc=re("debugdrag");var qa;(function(n){n[n.XZPlane=0]="XZPlane",n[n.Attached=1]="Attached",n[n.HitNormal=2]="HitNormal",n[n.DynamicViewAngle=3]="DynamicViewAngle",n[n.SnapToSurfaces=4]="SnapToSurfaces"})(qa||(qa={}));const ea=class extends Te{constructor(){super(...arguments);u(this,"dragMode",qa.DynamicViewAngle);u(this,"snapGridResolution",0);u(this,"keepRotation",!0);u(this,"xrDragMode",qa.Attached);u(this,"xrKeepRotation",!1);u(this,"xrDistanceDragFactor",1);u(this,"showGizmo",!1);u(this,"targetObject",null);u(this,"orbit",null);u(this,"_dragHelper",null);u(this,"_draggingRigidbodies",[]);u(this,"_potentialDragStartEvt",null);u(this,"_dragHandlers",new Map);u(this,"_totalMovement",new w);u(this,"_marker",null);u(this,"_isDragging",!1);u(this,"_didDrag",!1)}static get HasAnySelected(){return this._active>0}setTargetObject(t){this.targetObject=t;for(const i of this._dragHandlers.values())i.setTargetObject(t)}awake(){this._potentialDragStartEvt=null,this._dragHandlers=new Map,this._totalMovement=new w,this._marker=null,this._isDragging=!1,this._didDrag=!1,this._dragHelper=null,this._draggingRigidbodies=[]}start(){this.orbit=le.findObjectOfType($i,this.context),this.gameObject.getComponentInParent(No)||this.gameObject.addNewComponent(No)}allowEdit(t=null){return this.context.connection.allowEditing}onPointerEnter(t){if(!this.allowEdit(this.gameObject)||t.mode!=="screen")return;const i=le.getComponentInParent(t.object,ea);!i||i!==this||(ea.lastHovered=t.object,this.context.domElement.style.cursor="pointer")}onPointerExit(t){this.allowEdit(this.gameObject)&&t.mode==="screen"&&ea.lastHovered===t.object&&(this.context.domElement.style.cursor="auto")}onPointerDown(t){if(this.allowEdit(this.gameObject)&&!t.used&&(ea.lastHovered=t.object,t.button===0)){this._dragHandlers.size===0&&(this._didDrag=!1,this._totalMovement.set(0,0,0),this._potentialDragStartEvt=t),ea._active+=1;const i=new die(this,this.targetObject||this.gameObject);if(this._dragHandlers.set(t.event.space,i),this.orbit&&(this.orbit.enabled=!1),i.onDragStart(t),this._dragHandlers.size===2){const s=this._dragHandlers.values(),r=s.next().value,o=s.next().value,a=new uie(this,this.targetObject||this.gameObject,r,o);this._dragHandlers.set(this.gameObject,a),a.onDragStart(t)}t.use()}}onPointerMove(t){(this._isDragging||this._potentialDragStartEvt!==null)&&t.use()}onPointerUp(t){if(oc&&kt.DrawLabel(t.point??this.gameObject.worldPosition,"POINTERUP:"+t.pointerId+", "+t.button,.03,3),!this.allowEdit(this.gameObject)||t.button!==0)return;this._potentialDragStartEvt=null;const i=this._dragHandlers.get(t.event.space),s=this._dragHandlers.get(this.gameObject);s&&(s.handlerA===i||s.handlerB===i)&&(this._dragHandlers.delete(this.gameObject),s.onDragEnd(t)),i&&(ea._active>0&&(ea._active-=1),i.onDragEnd&&i.onDragEnd(t),this._dragHandlers.delete(t.event.space),this._dragHandlers.size===0&&this.onLastDragEnd(t),t.use()),ea._active===0&&this.orbit&&(this.orbit.enabled=!0)}update(){for(const t of this._dragHandlers.values())t.collectMovementInfo&&t.collectMovementInfo(),t.getTotalMovement&&this._totalMovement.add(t.getTotalMovement());if(this._potentialDragStartEvt){if(!this._didDrag)if(this._totalMovement.length()>3e-4)this._didDrag=!0;else return;const t=this._potentialDragStartEvt;this._potentialDragStartEvt=null,this.onFirstDragStart(t)}for(const t of this._dragHandlers.values())t.onDragUpdate&&t.onDragUpdate(this._dragHandlers.size);this._dragHelper&&this._dragHelper.hasSelected&&this.onAnyDragUpdate()}onFirstDragStart(t){if(!this._dragHelper)if(this.context.mainCamera)this._dragHelper=new q0(this.context.mainCamera);else return;if(!t||!t.object)return;const i=le.getComponentInParent(t.object,ea);if(!i||i!==this)return;const s=this.targetObject||this.gameObject;if(!s)return;this._isDragging=!0,this._dragHelper.setSelected(s,this.context),this.orbit&&(this.orbit.enabled=!1);const r=le.getComponentInChildren(s,Ad);oc&&console.log("DRAG START",r,s),r&&(r.fastMode=!0,r==null||r.requestOwnership()),this._marker=le.addNewComponent(s,$x),this._draggingRigidbodies.length=0;const o=le.getComponentsInChildren(s,ki);o&&this._draggingRigidbodies.push(...o)}onAnyDragUpdate(){if(!this._dragHelper)return;this._dragHelper.showGizmo=this.showGizmo,this._dragHelper.onUpdate(this.context);for(const i of this._draggingRigidbodies)i.wakeUp(),i.resetVelocities(),i.resetForcesAndTorques();const t=this.targetObject||this.gameObject;uc.markDirty(t)}onLastDragEnd(t){if(!this||!this._isDragging||(this._isDragging=!1,!this._dragHelper))return;for(const s of this._draggingRigidbodies)s.setVelocity(s.smoothedVelocity);this._draggingRigidbodies.length=0;const i=this._dragHelper.selected;if(oc&&console.log("DRAG END",i,i==null?void 0:i.visible),this._dragHelper.setSelected(null,this.context),this.orbit&&(this.orbit.enabled=!0),t!=null&&t.object){const s=le.getComponentInChildren(t.object,Ad);s&&(s.fastMode=!1)}this._marker&&this._marker.destroy()}};let gr=ea;u(gr,"_active",0),u(gr,"lastHovered");Dd([x()],gr.prototype,"dragMode",void 0);Dd([x()],gr.prototype,"snapGridResolution",void 0);Dd([x()],gr.prototype,"keepRotation",void 0);Dd([x()],gr.prototype,"xrDragMode",void 0);Dd([x()],gr.prototype,"xrKeepRotation",void 0);Dd([x()],gr.prototype,"xrDistanceDragFactor",void 0);Dd([x()],gr.prototype,"showGizmo",void 0);class uie{constructor(e,t,i,s){u(this,"handlerA");u(this,"handlerB");u(this,"context");u(this,"settings");u(this,"gameObject");u(this,"_handlerAAttachmentPoint",new w);u(this,"_handlerBAttachmentPoint",new w);u(this,"_followObject");u(this,"_manipulatorObject");u(this,"_deviceMode");u(this,"_followObjectStartWorldQuaternion",new Me);u(this,"_manipulatorPosOffset",new w);u(this,"_manipulatorRotOffset",new Me);u(this,"_manipulatorScaleOffset",new w);u(this,"_tempVec1",new w);u(this,"_tempVec2",new w);u(this,"_tempVec3",new w);u(this,"tempLookMatrix",new Ce);u(this,"_initialScale",new w);u(this,"_initialDistance",0);var o,a;this.context=e.context,this.settings=e,this.gameObject=t,this.handlerA=i,this.handlerB=s,this._followObject=new ge,this._manipulatorObject=new ge,this.context.scene.add(this._manipulatorObject);const r=(a=(o=mt.active)==null?void 0:o.rig)==null?void 0:a.gameObject;if(!this.handlerA||!this.handlerB||!this.handlerA.hitPointInLocalSpace||!this.handlerB.hitPointInLocalSpace){console.error("Invalid: MultiTouchDragHandler needs two valid DragPointerHandlers with hitPointInLocalSpace set.");return}if(this._tempVec1.copy(this.handlerA.hitPointInLocalSpace),this._tempVec2.copy(this.handlerB.hitPointInLocalSpace),this.gameObject.localToWorld(this._tempVec1),this.gameObject.localToWorld(this._tempVec2),r&&(r.worldToLocal(this._tempVec1),r.worldToLocal(this._tempVec2)),this._initialDistance=this._tempVec1.distanceTo(this._tempVec2),this._initialDistance<.02?(oc&&console.log("Finding alternative drag attachment points since initial distance is too low: "+this._initialDistance.toFixed(2)),this.handlerA.followObject.parent.getWorldPosition(this._tempVec1),this.handlerB.followObject.parent.getWorldPosition(this._tempVec2),this._handlerAAttachmentPoint.copy(this._tempVec1),this._handlerBAttachmentPoint.copy(this._tempVec2),this.gameObject.worldToLocal(this._handlerAAttachmentPoint),this.gameObject.worldToLocal(this._handlerBAttachmentPoint),this._initialDistance=this._tempVec1.distanceTo(this._tempVec2),this._initialDistance<.001&&(console.warn("Not supported right now  controller drag points for multitouch are too close!"),this._initialDistance=1)):(this._handlerAAttachmentPoint.copy(this.handlerA.hitPointInLocalSpace),this._handlerBAttachmentPoint.copy(this.handlerB.hitPointInLocalSpace)),this._tempVec3.lerpVectors(this._tempVec1,this._tempVec2,.5),this._initialScale.copy(t.scale),oc){this._followObject.add(new Fo(2)),this._manipulatorObject.add(new Fo(5));const c=l=>`${l.x.toFixed(2)}, ${l.y.toFixed(2)}, ${l.z.toFixed(2)}`;kt.DrawLine(this._tempVec1,this._tempVec2,65535,0,!1),kt.DrawLabel(this._tempVec3,"A:B "+this._initialDistance.toFixed(2)+`
`+c(this._tempVec1)+`
`+c(this._tempVec2),.03,5)}}onDragStart(e){this.gameObject.add(this._followObject),this._followObject.matrixAutoUpdate=!1,this._followObject.matrix.identity(),this._deviceMode=e.mode,this._followObjectStartWorldQuaternion.copy(this._followObject.worldQuaternion),this.alignManipulator(),this._manipulatorObject.attach(this._followObject),this._manipulatorPosOffset.copy(this._followObject.position),this._manipulatorRotOffset.copy(this._followObject.quaternion),this._manipulatorScaleOffset.copy(this._followObject.scale)}onDragEnd(e){if(!this.handlerA||!this.handlerB){console.error("onDragEnd called on MultiTouchDragHandler without valid handlers. This is likely a bug.");return}this.handlerA.recenter(),this.handlerB.recenter(),this._manipulatorObject.removeFromParent(),this._followObject.removeFromParent(),this._manipulatorObject.destroy(),this._followObject.destroy()}alignManipulator(){if(!this.handlerA||!this.handlerB){console.error("alignManipulator called on MultiTouchDragHandler without valid handlers. This is likely a bug.",this);return}if(!this.handlerA.followObject||!this.handlerB.followObject){console.error("alignManipulator called on MultiTouchDragHandler without valid follow objects. This is likely a bug.",this.handlerA,this.handlerB);return}this._tempVec1.copy(this._handlerAAttachmentPoint),this._tempVec2.copy(this._handlerBAttachmentPoint),this.handlerA.followObject.localToWorld(this._tempVec1),this.handlerB.followObject.localToWorld(this._tempVec2),this._tempVec3.lerpVectors(this._tempVec1,this._tempVec2,.5),this._manipulatorObject.position.copy(this._tempVec3);const e=this.context.mainCamera;this.tempLookMatrix.lookAt(this._tempVec3,this._tempVec2,e.worldUp),this._manipulatorObject.quaternion.setFromRotationMatrix(this.tempLookMatrix);const t=this._tempVec1.distanceTo(this._tempVec2);this._manipulatorObject.scale.copy(this._initialScale).multiplyScalar(t/this._initialDistance),this._manipulatorObject.updateMatrix(),this._manipulatorObject.updateMatrixWorld(!0),oc&&(kt.DrawLabel(this._tempVec3.clone().add(new w(0,.2,0)),"A:B "+t.toFixed(2),.03),kt.DrawLine(this._tempVec1,this._tempVec2,65280,0,!1))}onDragUpdate(){this.alignManipulator();const e=30,t=1;this._followObject.position.copy(this._manipulatorPosOffset),this._followObject.quaternion.copy(this._manipulatorRotOffset),this._followObject.scale.copy(this._manipulatorScaleOffset);const i=this.gameObject,s=this._followObject;s.updateMatrix(),s.updateMatrixWorld(!0);const o=this._deviceMode==="tracked-pointer"?this.settings.xrKeepRotation:this.settings.keepRotation;if(this.settings.snapGridResolution>0){const d=this._followObject.worldPosition,f=this.settings.snapGridResolution;d.x=Math.round(d.x/f)*f,d.y=Math.round(d.y/f)*f,d.z=Math.round(d.z/f)*f,this._followObject.worldPosition=d,this._followObject.updateMatrix()}o&&(this._followObject.worldQuaternion=this._followObjectStartWorldQuaternion,this._followObject.updateMatrix());const a=nt.clamp01(this.context.time.deltaTime*e*t),c=i.worldPosition;c.lerp(s.worldPosition,a),i.worldPosition=c;const l=i.worldQuaternion;l.slerp(s.worldQuaternion,a),i.worldQuaternion=l;const h=i.worldScale;h.lerp(s.worldScale,a),i.worldScale=h}setTargetObject(e){this.gameObject=e}}class die{constructor(e,t){u(this,"context");u(this,"gameObject");u(this,"settings");u(this,"_lastRig");u(this,"_followObject");u(this,"_totalMovement",new w);u(this,"_totalMovementAlongRayDirection",0);u(this,"_grabStartDistance",0);u(this,"_deviceMode");u(this,"_followObjectStartPosition",new w);u(this,"_followObjectStartQuaternion",new Me);u(this,"_followObjectStartWorldQuaternion",new Me);u(this,"_lastDragPosRigSpace");u(this,"_tempVec",new w);u(this,"_tempMat",new Ce);u(this,"_hitPointInLocalSpace",new w);u(this,"_hitNormalInLocalSpace",new w);u(this,"_bottomCenter",new w);u(this,"_backCenter",new w);u(this,"_backBottomCenter",new w);u(this,"_bounds",new Mi);u(this,"_dragPlane",new hr(new w(0,1,0)));u(this,"_draggedOverObject",null);u(this,"_draggedOverObjectLastSetUp",null);u(this,"_draggedOverObjectLastNormal",new w);u(this,"_draggedOverObjectDuration",0);this.settings=e,this.context=e.context,this.gameObject=t,this._followObject=new ge}getTotalMovement(){return this._totalMovement}get followObject(){return this._followObject}get hitPointInLocalSpace(){return this._hitPointInLocalSpace}setTargetObject(e){this.gameObject=e}recenter(){var r,o;if(!this._followObject.parent){console.warn("Error: space follow object doesn't have parent but recenter() is called. This is likely a bug");return}const e=this._followObject.parent;this.gameObject.add(this._followObject),this._followObject.matrixAutoUpdate=!1,this._followObject.position.set(0,0,0),this._followObject.quaternion.set(0,0,0,1),this._followObject.scale.set(1,1,1),this._followObject.updateMatrix(),this._followObject.updateMatrixWorld(!0),e.attach(this._followObject),this._followObjectStartPosition.copy(this._followObject.position),this._followObjectStartQuaternion.copy(this._followObject.quaternion),this._followObjectStartWorldQuaternion.copy(this._followObject.worldQuaternion),this._followObject.updateMatrix(),this._followObject.updateMatrixWorld(!0);const t=this._hitPointInLocalSpace.clone();this.gameObject.localToWorld(t),this._grabStartDistance=t.distanceTo(e.worldPosition);const i=(o=(r=mt.active)==null?void 0:r.rig)==null?void 0:o.gameObject,s=(i==null?void 0:i.worldScale.x)||1;this._grabStartDistance/=s,this._totalMovementAlongRayDirection=0,this._lastDragPosRigSpace=void 0,oc&&(kt.DrawLine(t,e.worldPosition,65280,.5,!1),kt.DrawLabel(e.worldPosition.add(new w(0,.1,0)),this._grabStartDistance.toFixed(2),.03,.5))}onDragStart(e){if(e.event.space.add(this._followObject),this._lastDragPosRigSpace=void 0,e.point&&e.normal)this._hitPointInLocalSpace.copy(e.point),this.gameObject.worldToLocal(this._hitPointInLocalSpace),this._hitNormalInLocalSpace.copy(e.normal);else if(e){const m=e.event.space,g=m.worldPosition;this.gameObject.worldToLocal(g),this._hitPointInLocalSpace.copy(g);const y=m.worldUp;this._tempMat.copy(this.gameObject.matrixWorld).invert(),y.transformDirection(this._tempMat),this._hitNormalInLocalSpace.copy(y)}this.recenter(),this._totalMovement.set(0,0,0),this._deviceMode=e.mode;const i=this._followObject.parent.worldForward,r=this._deviceMode==="tracked-pointer"?this.settings.xrDragMode:this.settings.dragMode,o=this._hitPointInLocalSpace.clone();switch(this.gameObject.localToWorld(o),r){case qa.XZPlane:const m=new w(0,1,0);this.gameObject.parent&&m.transformDirection(this.gameObject.parent.matrixWorld.clone().invert()),this._dragPlane.setFromNormalAndCoplanarPoint(m,o);break;case qa.HitNormal:const g=this._hitNormalInLocalSpace.clone();g.transformDirection(this.gameObject.matrixWorld),this._dragPlane.setFromNormalAndCoplanarPoint(g,o);break;case qa.Attached:this._dragPlane.setFromNormalAndCoplanarPoint(i,o);break;case qa.DynamicViewAngle:const y=new w(0,1,0),A=i,v=y.angleTo(A),b=.5;v>Math.PI/2+b||v<Math.PI/2-b?this._dragPlane.setFromNormalAndCoplanarPoint(new w(0,1,0),o):this._dragPlane.setFromNormalAndCoplanarPoint(i,o);break}const a=new Mi,c=this.gameObject.parent,l=this.gameObject.position.clone(),h=this.gameObject.quaternion.clone(),d=this.gameObject.scale.clone();c&&c.remove(this.gameObject),this.gameObject.position.set(0,0,0),this.gameObject.quaternion.set(0,0,0,1),this.gameObject.scale.set(1,1,1),a.setFromObject(this.gameObject);const f=new w;a.getCenter(f);const p=new w;a.getSize(p),this._bottomCenter.copy(f.clone().add(new w(0,-p.y/2,0))),this._backCenter.copy(f.clone().add(new w(0,0,p.z/2))),this._backBottomCenter.copy(f.clone().add(new w(0,-p.y/2,p.z/2))),this._bounds.copy(a),c&&c.add(this.gameObject),this.gameObject.position.copy(l),this.gameObject.quaternion.copy(h),this.gameObject.scale.copy(d),this._draggedOverObject=null,this._draggedOverObjectLastSetUp=null,this._draggedOverObjectLastNormal.set(0,1,0),this._draggedOverObjectDuration=0}collectMovementInfo(){var r,o;if(!this._followObject.parent)return;const e=this._followObject.parent;this._followObject.updateMatrix();const t=e.worldPosition,i=(o=(r=mt.active)==null?void 0:r.rig)==null?void 0:o.gameObject;i&&i.worldToLocal(t),(this._lastDragPosRigSpace===void 0||i!=this._lastRig)&&(this._lastDragPosRigSpace=t.clone(),this._lastRig=i),this._tempVec.copy(t).sub(this._lastDragPosRigSpace);const s=e.worldForward;if(i&&(this._tempMat.copy(i.matrixWorld).invert(),s.transformDirection(this._tempMat)),this._totalMovementAlongRayDirection+=s.dot(this._tempVec),this._tempVec.x=Math.abs(this._tempVec.x),this._tempVec.y=Math.abs(this._tempVec.y),this._tempVec.z=Math.abs(this._tempVec.z),this._totalMovement.add(this._tempVec),this._lastDragPosRigSpace.copy(t),oc){let a=t;i&&(a=a.clone(),a.transformDirection(i.matrixWorld)),kt.DrawRay(a,s,255)}}onDragUpdate(e){if(e>1)return;const t=this.gameObject,i=this._followObject.parent;this._followObject.updateMatrix();const s=i.worldPosition,r=i.worldForward,o=this._deviceMode==="tracked-pointer",a=o?this.settings.xrKeepRotation:this.settings.keepRotation,c=o?this.settings.xrDragMode:this.settings.dragMode,l=10;a&&(this._followObject.worldQuaternion=this._followObjectStartWorldQuaternion),this._followObject.updateMatrix(),this._followObject.updateMatrixWorld(!0);let h=1,d=1;if(this._deviceMode==="tracked-pointer"&&this._grabStartDistance>.5){const y=1+this._totalMovementAlongRayDirection*(2*this.settings.xrDistanceDragFactor);h=Math.max(0,y),h=h*h*h}else this._grabStartDistance<=.5&&(d=3);this._followObject.position.copy(this._followObjectStartPosition),a||this._followObject.quaternion.copy(this._followObjectStartQuaternion),this._followObject.position.multiplyScalar(h),this._followObject.updateMatrix();const f=new ro(s,r);if(c==qa.SnapToSurfaces){const y=new pa;y.ignore=[t];const A=this.context.physics.raycastFromRay(f,y);if(A.length>0){const v=A[0];if(this._draggedOverObject===v.object?this._draggedOverObjectDuration+=this.context.time.deltaTime:(this._draggedOverObject=v.object,this._draggedOverObjectDuration=0),v.face&&this._draggedOverObjectDuration>.15&&(this._draggedOverObjectLastSetUp!==this._draggedOverObject||this._draggedOverObjectLastNormal.dot(v.face.normal)<.999999)){this._draggedOverObjectLastSetUp=this._draggedOverObject,this._draggedOverObjectLastNormal.copy(v.face.normal);const b=new w,_=new w;this._bounds.getCenter(b),this._bounds.getSize(_),b.sub(_.multiplyScalar(.5).multiply(v.face.normal)),this._hitPointInLocalSpace.copy(b),this._hitNormalInLocalSpace.copy(v.face.normal),this._bounds.getCenter(b),this._bounds.getSize(_),b.add(_.multiplyScalar(.5).multiply(v.face.normal));const T=this._hitPointInLocalSpace.clone().add(b);this._followObject.localToWorld(T);const E=this._followObject.worldPosition.sub(T);this._dragPlane.setFromNormalAndCoplanarPoint(v.face.normal,v.point.sub(E))}}}if(c!==qa.Attached&&f.intersectPlane(this._dragPlane,this._tempVec)){this._followObject.worldPosition=this._tempVec,this._followObject.updateMatrix(),this._followObject.updateMatrixWorld(!0);const y=this._hitPointInLocalSpace.clone();this._followObject.localToWorld(y),oc&&kt.DrawLine(y,this._tempVec,65535,0,!1),this._followObject.worldPosition=this._tempVec.multiplyScalar(2).sub(y),this._followObject.updateMatrix(),this._followObject.updateMatrix()}if(this.settings.snapGridResolution>0){const y=this._followObject.worldPosition,A=this.settings.snapGridResolution;y.x=Math.round(y.x/A)*A,y.y=Math.round(y.y/A)*A,y.z=Math.round(y.z/A)*A,this._followObject.worldPosition=y,this._followObject.updateMatrix()}a&&(this._followObject.worldQuaternion=this._followObjectStartWorldQuaternion,this._followObject.updateMatrix());const p=nt.clamp01(this.context.time.deltaTime*l*d),m=t.worldPosition;m.lerp(this._followObject.worldPosition,p),t.worldPosition=m;const g=t.worldQuaternion;if(g.slerp(this._followObject.worldQuaternion,p),t.worldQuaternion=g,oc){const y=this._hitPointInLocalSpace.clone();t.localToWorld(y),kt.DrawSphere(y,.02,16711680);const A=this._hitNormalInLocalSpace.clone();A.applyQuaternion(g),kt.DrawRay(y,A,16711680),kt.DrawLabel(m.add(new w(0,.25,0)),`Distance: ${this._totalMovement.length().toFixed(2)}

                Along Ray: ${this._totalMovementAlongRayDirection.toFixed(2)}

                Session: ${!!mt.active}

                Device: ${this._deviceMode}

                `,.03);const v=this._bottomCenter.clone(),b=this._backCenter.clone(),_=this._backBottomCenter.clone();t.localToWorld(v),t.localToWorld(b),t.localToWorld(_),kt.DrawSphere(v,.01,65280,0,!1),kt.DrawSphere(b,.01,255,0,!1),kt.DrawSphere(_,.01,16711935,0,!1),kt.DrawLine(v,_,65535,0,!1),kt.DrawLine(_,b,65535,0,!1)}}onDragEnd(e){console.assert(this._followObject.parent===e.event.space,"Drag end: _followObject is not parented to the space object"),this._followObject.removeFromParent(),this._followObject.destroy(),this._lastDragPosRigSpace=void 0}}const mR=class{constructor(e){u(this,"showGizmo",!0);u(this,"useViewAngle",!0);u(this,"_selected",null);u(this,"_context",null);u(this,"_camera");u(this,"_cameraPlane",new hr);u(this,"_hasGroundPlane",!1);u(this,"_groundPlane",new hr);u(this,"_groundOffset",new w);u(this,"_groundOffsetFactor",0);u(this,"_groundDistance",0);u(this,"_groundPlanePoint",new w);u(this,"_raycaster",new Pp);u(this,"_cameraPlaneOffset",new w);u(this,"_intersection",new w);u(this,"_worldPosition",new w);u(this,"_inverseMatrix",new Ce);u(this,"_rbs",[]);u(this,"_groundLine");u(this,"_groundMarker");u(this,"_groundOffsetVector",new w(0,1,0));u(this,"_requireUpdateGroundPlane",!0);u(this,"_didDragOnGroundPlaneLastFrame",!1);this._camera=e;const t=new Sn(mR.geometry),i=t.material;i.color=new ye(.4,.4,.4),t.layers.set(2),t.name="line",t.scale.y=1,this._groundLine=t;const s=new Aa(.5,22,22),r=new ri({color:i.color}),o=new me(s,r);o.visible=!1,o.layers.set(2),this._groundMarker=o}get hasSelected(){return this._selected!==null&&this._selected!==void 0}get selected(){return this._selected}setSelected(e,t){if(this._selected&&t)for(const i of this._rbs)i.wakeUp(),i.setVelocity(0,0,0);if(this._selected&&Al.Remove(t,this._selected),this._selected=e,this._context=t,this._rbs.length=0,e?(t.scene.add(this._groundLine),t.scene.add(this._groundMarker)):(this._groundLine.removeFromParent(),this._groundMarker.removeFromParent()),this._selected){if(!t){console.error("DragHelper: no context");return}Al.Add(t,this._selected,null),this._groundOffsetFactor=0,this._hasGroundPlane=!0,this._groundOffset.set(0,0,0),this._requireUpdateGroundPlane=!0,this.onUpdateScreenSpacePlane()}}onUpdate(e){if(!this._selected)return;const t=Ht(this._selected);this.onUpdateWorldPosition(t,this._groundPlanePoint,!1),this.onUpdateGroundPlane(),this._didDragOnGroundPlaneLastFrame=!0,this._hasGroundPlane=!0}onUpdateWorldPosition(e,t,i){if(this._selected){if(i){const s=Ht(this._selected);s.y=e.y,e=s}if(vr(this._selected,e),vr(this._groundLine,e),this._hasGroundPlane?this._groundLine.scale.y=this._groundDistance:this._groundLine.scale.y=1e3,this._groundLine.visible=this.showGizmo,this._groundMarker.visible=t!==null&&this.showGizmo,t){const s=Ht(this._camera).distanceTo(t)*.01;this._groundMarker.scale.set(s,s,s),vr(this._groundMarker,t)}}}onUpdateScreenSpacePlane(){if(!this._selected||!this._context)return;const e=this._context.input.getPointerPositionRC(0);e&&(this._raycaster.setFromCamera(e,this._camera),this._cameraPlane.setFromNormalAndCoplanarPoint(this._camera.getWorldDirection(this._cameraPlane.normal),this._worldPosition.setFromMatrixPosition(this._selected.matrixWorld)),this._raycaster.ray.intersectPlane(this._cameraPlane,this._intersection)&&this._selected.parent&&(this._inverseMatrix.copy(this._selected.parent.matrixWorld).invert(),this._cameraPlaneOffset.copy(this._intersection).sub(this._worldPosition.setFromMatrixPosition(this._selected.matrixWorld))))}onUpdateGroundPlane(){if(!this._selected||!this._context)return;const e=Ht(this._selected),t=new ro(new w(0,.1,0).add(e),new w(0,-1,0)),i=new pa;i.ignore=[this._selected];const s=this._context.physics.raycastFromRay(t,i);for(let r=0;r<s.length;r++){const o=s[r];if(!o.face||this.contains(this._selected,o.object))continue;const a=new w(0,1,0);this._groundPlane.setFromNormalAndCoplanarPoint(a,o.point);break}this._hasGroundPlane=!0,this._groundPlane.setFromNormalAndCoplanarPoint(t.direction.multiplyScalar(-1),t.origin),this._raycaster.ray.intersectPlane(this._groundPlane,this._intersection),this._groundDistance=this._intersection.distanceTo(e),this._groundOffset.copy(this._intersection).sub(e)}contains(e,t){if(e===t)return!0;if(e.children){for(const i of e.children)if(this.contains(i,t))return!0}return!1}};let q0=mR;u(q0,"geometry",new gt().setFromPoints([new w(0,0,0),new w(0,-1,0)]));function BI(n,e,t){console.warn("Adding components on object has been temporarily disabled")}var $b;(function(n){n.File_Spawned="file-spawned"})($b||($b={}));class fie{constructor(e,t,i,s,r,o,a,c){u(this,"guid");u(this,"file_name");u(this,"file_hash");u(this,"file_size");u(this,"position");u(this,"seed");u(this,"sender");u(this,"serverUrl");u(this,"parentGuid");u(this,"boundsSize");this.seed=t,this.guid=i,this.file_name=s,this.file_hash=r,this.file_size=o,this.position=a,this.sender=e,this.serverUrl=c}}async function pie(n,e,t){const i=n.name;return i.endsWith(".gltf")||i.endsWith(".glb")?new Promise((s,r)=>{const o=new FileReader;o.readAsArrayBuffer(n),o.onloadend=async a=>{const c=o.result,l=nI(),h=new Ss(l),d=await mc().parseSync(e,c,n.name,h);if(d&&d.scene){const f=d.scene;if(!f.guid){const p=new Ss(l);f.guid=p.generateUUID()}t&&Aie(e.connection,n,l,f,t),BI(),s(d)}}}):(console.warn("Unsupported file type: "+i,n),null)}async function mie(n,e){return new Promise(async(t,i)=>{const s=nI(),r=new Ss(s),o=n.toString(),a=await mc().loadSync(e,o,o,r);a&&a.scene?(a.scene,BI(),t(a)):console.warn("Unsupported file type: "+n.toString())})}zi.registerCallback(Cn.ContextCreated,n=>{gie(n.context)});function gie(n){n.connection.beginListen($b.File_Spawned,async e=>{if(e.sender!==n.connection.connectionId){console.log("received file event",e),vie(e,n);let t=null;try{t=await ZF(e.file_name,e.file_hash,e.file_size,e.serverUrl)}finally{yie(e)}if(t){const i=new Ss(e.seed),s=await mc().parseSync(n,t,e.file_name,i);if(s&&s.scene){const r=s.scene;if(BI(),e.parentGuid){const o=wx(e.parentGuid,n.scene);o&&"add"in o&&o.add(r)}r.parent||n.scene.add(r),e.position!==null&&r.position.copy(e.position)}}else console.error("download didnt return file")}})}async function Aie(n,e,t,i,s){if(!n.connectionId){console.error("Can not upload file - no connection id");return}if(!i.guid){console.error("Can not upload file - no guid",i,i.guid);return}const r=await xq(e,s);if(!r)return;if(!r.filename){console.error("Can not send upload event - no filename",e.name);return}if(!r.hash){console.error("Can not send upload event - no hash",e.name);return}const o=new fie(n.connectionId,t,i.guid,r.filename,r.hash,e.size,i.position,r.url??s);i.parent&&(o.parentGuid=i.parent.guid),n.send($b.File_Spawned,o)}const UT={};function vie(n,e){const t=new Ni,i=new me(t,new ri({color:65280})),s=new ZM(i,5592405);if(UT[n.guid]=s,e.scene.add(s),n.parentGuid){const r=wx(n.parentGuid,e.scene);r&&r.add(s)}n.position&&s.position.copy(n.position)}function yie(n,e){const t=n.guid,i=UT[t];i&&(delete UT[t],i.removeFromParent())}var DI=globalThis&&globalThis.__decorate||function(n,e,t,i){var s=arguments.length,r=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(e,t,r):o(e,t))||r);return s>3&&r&&Object.defineProperty(e,t,r),r};const bie=re("debugnet");class Ml extends Te{constructor(){super(...arguments);u(this,"url",null);u(this,"urlParameterName",null);u(this,"localhost",null)}awake(){bie&&console.log(this),this.context.connection.registerProvider(this)}getWebsocketUrl(){let t=this.url?Ml.GetUrl(this.url,this.localhost):null;if(this.urlParameterName){const o=re(this.urlParameterName);o&&typeof o=="string"&&(t=o)}if(!t)return null;const s=new RegExp("(((https?)|(?<socket_prefix>wss?))://)?(www.)?(?<url>.+)","gm").exec(t);return s!=null&&s.groups?(s==null?void 0:s.groups.socket_prefix)?t:"wss://"+(s==null?void 0:s.groups.url):null}static GetUrl(t,i){let s=t;const r=Ml.IsLocalNetwork()&&i;if(r&&(s=i),t!=null&&t.startsWith("/")){const o=r?s:window.location.origin;o!=null&&o.endsWith("/")&&t.startsWith("/")&&(t=t.substring(1)),s=o+t}return s}static IsLocalNetwork(t=window.location.hostname){return zr(t)}}DI([x()],Ml.prototype,"url",void 0);DI([x()],Ml.prototype,"urlParameterName",void 0);DI([x()],Ml.prototype,"localhost",void 0);var Wz=globalThis&&globalThis.__decorate||function(n,e,t,i){var s=arguments.length,r=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(e,t,r):o(e,t))||r);return s>3&&r&&Object.defineProperty(e,t,r),r};const df=re("debugdroplistener");var e_;(function(n){n.ObjectAdded="object-added",n.FileDropped="file-dropped"})(e_||(e_={}));class ew extends Te{constructor(){super(...arguments);u(this,"filesBackendUrl");u(this,"localhost");u(this,"onDrag",t=>{t.preventDefault()});u(this,"onDrop",async t=>{if(df&&console.log(t),!(t!=null&&t.dataTransfer))return;t.preventDefault();const i=t.dataTransfer.items;if(i)for(const s in i){const r=i[s];if(r.kind==="file"){const o=r.getAsFile();if(!o)continue;await this.addFiles(o)}else r.kind==="string"&&r.type=="text/plain"&&r.getAsString(async o=>{df&&console.log("dropped url",o);try{const a=new URL(o);if(!a)return;const c=await mie(a,this.context);c&&this.addObject(t,c)}catch{console.log("dropped string is not a valid URL!",o)}})}})}onEnable(){this.filesBackendUrl=Ml.GetUrl(this.filesBackendUrl,this.localhost)??this.filesBackendUrl,df&&console.log(this,this.filesBackendUrl),this.context.domElement.addEventListener("dragover",this.onDrag),this.context.domElement.addEventListener("drop",this.onDrop)}onDisable(){this.context.domElement.removeEventListener("dragover",this.onDrag),this.context.domElement.removeEventListener("drop",this.onDrop)}async addFiles(...t){if(df&&console.log("Add files",t),!!Array.isArray(t)&&t.length)for(const i of t){if(!i)continue;df&&console.log("Register file "+i.name+" to",this.filesBackendUrl,i);const s=await pie(i,this.context,this.filesBackendUrl);this.dispatchEvent(new CustomEvent(e_.FileDropped,{detail:i})),s&&this.addObject(void 0,s)}}async addObject(t,i){if(df&&console.log("Dropped",i),!(i!=null&&i.scene)){console.warn("No object specified to add to scene",i);return}const s=i.scene;if(t!==void 0){const r=new pa;r.setMask(16777215),r.screenPointFromOffset(t.offsetX,t.offsetY);const o=this.context.physics.raycast(r);if(o&&o.length>0)for(const a of o){s.position.copy(a.point);break}}this.gameObject.add(s),this.dispatchEvent(new CustomEvent(e_.ObjectAdded,{detail:i}))}}Wz([x()],ew.prototype,"filesBackendUrl",void 0);Wz([x()],ew.prototype,"localhost",void 0);var tw=globalThis&&globalThis.__decorate||function(n,e,t,i){var s=arguments.length,r=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(e,t,r):o(e,t))||r);return s>3&&r&&Object.defineProperty(e,t,r),r};class Jp extends Te{constructor(){super(...arguments);u(this,"parent",null);u(this,"object",null);u(this,"limitCount",10);u(this,"limitInterval",60);u(this,"_currentCount",0);u(this,"_startPosition",null);u(this,"_startQuaternion",null);u(this,"_forwardPointerEvents",new Map)}start(){var i,s;if(this.object){if(this.object===this.gameObject){console.error("Can not duplicate self");return}this.object.visible=!1,this._startPosition=((i=this.object.position)==null?void 0:i.clone())??new w(0,0,0),this._startQuaternion=((s=this.object.quaternion)==null?void 0:s.clone())??new Me(0,0,0,1)}const t=this.gameObject.getComponent(gr);t&&(Tt()&&console.warn(`Please remove DragControls from "${t.name}": it's not needed anymore when the object also has a Duplicatable component`),t.enabled=!1),this.gameObject.getComponentInParent(No)||this.gameObject.addNewComponent(No),this.cloneLimitIntervalFn()}onPointerDown(t){if(!this.object||!this.context.connection.allowEditing||t.button!==0)return;const i=this.handleDuplication();if(i){const s=le.getComponent(i,gr);s?(s.onPointerDown(t),this._forwardPointerEvents.set(t.event.space,s)):console.warn("Duplicated object does not have DragControls")}}onPointerUp(t){const i=this._forwardPointerEvents.get(t.event.space);i&&(i.onPointerUp(t),this._forwardPointerEvents.delete(t.event.space))}cloneLimitIntervalFn(){this.destroyed||(this._currentCount>0&&(this._currentCount-=1),setTimeout(()=>{this.cloneLimitIntervalFn()},this.limitInterval/this.limitCount*1e3))}handleDuplication(){var s;if(!this.object||this._currentCount>=this.limitCount||this.object===this.gameObject)return null;this.object.visible=!0,this._startPosition&&this.object.position.copy(this._startPosition),this._startQuaternion&&this.object.quaternion.copy(this._startQuaternion);const t=new _c;this.parent||(this.parent=this.gameObject.parent),this.parent&&(t.parent=this.parent.guid??((s=this.parent.userData)==null?void 0:s.guid),t.keepWorldPosition=!0),t.position=this.worldPosition,t.rotation=this.worldQuaternion,t.context=this.context,this._currentCount+=1;const i=le.instantiateSynced(this.object,t);return console.assert(i!==this.object,"Duplicated object is original"),this.object.visible=!1,this._startPosition&&this.object.position.clone().copy(this._startPosition),this._startQuaternion&&this.object.quaternion.clone().copy(this._startQuaternion),i}}tw([x(ge)],Jp.prototype,"parent",void 0);tw([x(ge)],Jp.prototype,"object",void 0);tw([x()],Jp.prototype,"limitCount",void 0);tw([x()],Jp.prototype,"limitInterval",void 0);var Du;(function(n){n[n.PointerEnter=0]="PointerEnter",n[n.PointerExit=1]="PointerExit",n[n.PointerDown=2]="PointerDown",n[n.PointerUp=3]="PointerUp",n[n.PointerClick=4]="PointerClick",n[n.Drag=5]="Drag",n[n.Drop=6]="Drop",n[n.Scroll=7]="Scroll",n[n.UpdateSelected=8]="UpdateSelected",n[n.Select=9]="Select",n[n.Deselect=10]="Deselect",n[n.Move=11]="Move",n[n.InitializePotentialDrag=12]="InitializePotentialDrag",n[n.BeginDrag=13]="BeginDrag",n[n.EndDrag=14]="EndDrag",n[n.Submit=15]="Submit",n[n.Cancel=16]="Cancel"})(Du||(Du={}));var OI=globalThis&&globalThis.__decorate||function(n,e,t,i){var s=arguments.length,r=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(e,t,r):o(e,t))||r);return s>3&&r&&Object.defineProperty(e,t,r),r};class kI{constructor(){u(this,"eventID");u(this,"callback")}}OI([x()],kI.prototype,"eventID",void 0);OI([x(Cs)],kI.prototype,"callback",void 0);class LI extends Te{constructor(){super(...arguments);u(this,"triggers")}invoke(t){if(this.triggers)for(const i of this.triggers)i.eventID===t&&i.callback.invoke()}onPointerClick(t){this.invoke(Du.PointerClick)}onPointerEnter(t){this.invoke(Du.PointerEnter)}onPointerExit(t){this.invoke(Du.PointerExit)}onPointerDown(t){this.invoke(Du.PointerDown)}onPointerUp(t){this.invoke(Du.PointerUp)}}OI([x(kI)],LI.prototype,"triggers",void 0);var FI=globalThis&&globalThis.__decorate||function(n,e,t,i){var s=arguments.length,r=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(e,t,r):o(e,t))||r);return s>3&&r&&Object.defineProperty(e,t,r),r};class UI extends Te{constructor(){super(...arguments);u(this,"connectedBody");u(this,"_rigidBody",null)}get rigidBody(){return this._rigidBody}onEnable(){this._rigidBody||(this._rigidBody=this.gameObject.getComponent(ki)),this.rigidBody&&this.connectedBody&&this.startCoroutine(this.create())}*create(){yield,this.rigidBody&&this.connectedBody&&this.createJoint(this.rigidBody,this.connectedBody)}}FI([x(ki)],UI.prototype,"connectedBody",void 0);class qz extends UI{createJoint(e,t){var i;(i=this.context.physics.engine)==null||i.addFixedJoint(e,t)}}class iw extends UI{constructor(){super(...arguments);u(this,"anchor");u(this,"axis")}createJoint(t,i){var s;this.axis&&this.anchor&&((s=this.context.physics.engine)==null||s.addHingeJoint(t,i,this.anchor,this.axis))}}FI([x(w)],iw.prototype,"anchor",void 0);FI([x(w)],iw.prototype,"axis",void 0);const _ie={type:"change"};let xie=class extends ls{constructor(e,t){super(),this.object=e,this.domElement=t,this.enabled=!0,this.movementSpeed=1,this.rollSpeed=.005,this.dragToLook=!1,this.autoForward=!1;const i=this,s=1e-6,r=new Me,o=new w;this.tmpQuaternion=new Me,this.status=0,this.moveState={up:0,down:0,left:0,right:0,forward:0,back:0,pitchUp:0,pitchDown:0,yawLeft:0,yawRight:0,rollLeft:0,rollRight:0},this.moveVector=new w(0,0,0),this.rotationVector=new w(0,0,0),this.keydown=function(m){if(!(m.altKey||this.enabled===!1)){switch(m.code){case"ShiftLeft":case"ShiftRight":this.movementSpeedMultiplier=.1;break;case"KeyW":this.moveState.forward=1;break;case"KeyS":this.moveState.back=1;break;case"KeyA":this.moveState.left=1;break;case"KeyD":this.moveState.right=1;break;case"KeyR":this.moveState.up=1;break;case"KeyF":this.moveState.down=1;break;case"ArrowUp":this.moveState.pitchUp=1;break;case"ArrowDown":this.moveState.pitchDown=1;break;case"ArrowLeft":this.moveState.yawLeft=1;break;case"ArrowRight":this.moveState.yawRight=1;break;case"KeyQ":this.moveState.rollLeft=1;break;case"KeyE":this.moveState.rollRight=1;break}this.updateMovementVector(),this.updateRotationVector()}},this.keyup=function(m){if(this.enabled!==!1){switch(m.code){case"ShiftLeft":case"ShiftRight":this.movementSpeedMultiplier=1;break;case"KeyW":this.moveState.forward=0;break;case"KeyS":this.moveState.back=0;break;case"KeyA":this.moveState.left=0;break;case"KeyD":this.moveState.right=0;break;case"KeyR":this.moveState.up=0;break;case"KeyF":this.moveState.down=0;break;case"ArrowUp":this.moveState.pitchUp=0;break;case"ArrowDown":this.moveState.pitchDown=0;break;case"ArrowLeft":this.moveState.yawLeft=0;break;case"ArrowRight":this.moveState.yawRight=0;break;case"KeyQ":this.moveState.rollLeft=0;break;case"KeyE":this.moveState.rollRight=0;break}this.updateMovementVector(),this.updateRotationVector()}},this.pointerdown=function(m){if(this.enabled!==!1)if(this.dragToLook)this.status++;else{switch(m.button){case 0:this.moveState.forward=1;break;case 2:this.moveState.back=1;break}this.updateMovementVector()}},this.pointermove=function(m){if(this.enabled!==!1&&(!this.dragToLook||this.status>0)){const g=this.getContainerDimensions(),y=g.size[0]/2,A=g.size[1]/2;this.moveState.yawLeft=-(m.pageX-g.offset[0]-y)/y,this.moveState.pitchDown=(m.pageY-g.offset[1]-A)/A,this.updateRotationVector()}},this.pointerup=function(m){if(this.enabled!==!1){if(this.dragToLook)this.status--,this.moveState.yawLeft=this.moveState.pitchDown=0;else{switch(m.button){case 0:this.moveState.forward=0;break;case 2:this.moveState.back=0;break}this.updateMovementVector()}this.updateRotationVector()}},this.pointercancel=function(){this.enabled!==!1&&(this.dragToLook?(this.status=0,this.moveState.yawLeft=this.moveState.pitchDown=0):(this.moveState.forward=0,this.moveState.back=0,this.updateMovementVector()),this.updateRotationVector())},this.contextMenu=function(m){this.enabled!==!1&&m.preventDefault()},this.update=function(m){if(this.enabled===!1)return;const g=m*i.movementSpeed,y=m*i.rollSpeed;i.object.translateX(i.moveVector.x*g),i.object.translateY(i.moveVector.y*g),i.object.translateZ(i.moveVector.z*g),i.tmpQuaternion.set(i.rotationVector.x*y,i.rotationVector.y*y,i.rotationVector.z*y,1).normalize(),i.object.quaternion.multiply(i.tmpQuaternion),(o.distanceToSquared(i.object.position)>s||8*(1-r.dot(i.object.quaternion))>s)&&(i.dispatchEvent(_ie),r.copy(i.object.quaternion),o.copy(i.object.position))},this.updateMovementVector=function(){const m=this.moveState.forward||this.autoForward&&!this.moveState.back?1:0;this.moveVector.x=-this.moveState.left+this.moveState.right,this.moveVector.y=-this.moveState.down+this.moveState.up,this.moveVector.z=-m+this.moveState.back},this.updateRotationVector=function(){this.rotationVector.x=-this.moveState.pitchDown+this.moveState.pitchUp,this.rotationVector.y=-this.moveState.yawRight+this.moveState.yawLeft,this.rotationVector.z=-this.moveState.rollRight+this.moveState.rollLeft},this.getContainerDimensions=function(){return this.domElement!=document?{size:[this.domElement.offsetWidth,this.domElement.offsetHeight],offset:[this.domElement.offsetLeft,this.domElement.offsetTop]}:{size:[window.innerWidth,window.innerHeight],offset:[0,0]}},this.dispose=function(){this.domElement.removeEventListener("contextmenu",a),this.domElement.removeEventListener("pointerdown",l),this.domElement.removeEventListener("pointermove",c),this.domElement.removeEventListener("pointerup",h),this.domElement.removeEventListener("pointercancel",d),window.removeEventListener("keydown",f),window.removeEventListener("keyup",p)};const a=this.contextMenu.bind(this),c=this.pointermove.bind(this),l=this.pointerdown.bind(this),h=this.pointerup.bind(this),d=this.pointercancel.bind(this),f=this.keydown.bind(this),p=this.keyup.bind(this);this.domElement.addEventListener("contextmenu",a),this.domElement.addEventListener("pointerdown",l),this.domElement.addEventListener("pointermove",c),this.domElement.addEventListener("pointerup",h),this.domElement.addEventListener("pointercancel",d),window.addEventListener("keydown",f),window.addEventListener("keyup",p),this.updateMovementVector(),this.updateRotationVector()}};class Xz extends Te{constructor(){super(...arguments);u(this,"_controls",null)}onEnable(){var i;const t=(i=le.getComponent(this.gameObject,Di))==null?void 0:i.cam;if(!t){console.warn("FlyControls: Requires a Camera component on the same object as this component.");return}this._controls=new xie(t,this.context.renderer.domElement),this._controls.rollSpeed=.5,this._controls.movementSpeed=3,this._controls.dragToLook=!0}onDisable(){var t;(t=this._controls)==null||t.dispose(),this._controls=null}update(){this._controls&&this._controls.update(this.context.time.deltaTime)}}var NI=globalThis&&globalThis.__decorate||function(n,e,t,i){var s=arguments.length,r=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(e,t,r):o(e,t))||r);return s>3&&r&&Object.defineProperty(e,t,r),r},NT;(function(n){n[n.Linear=1]="Linear",n[n.Exponential=2]="Exponential",n[n.ExponentialSquared=3]="ExponentialSquared"})(NT||(NT={}));class bv extends Te{constructor(){super(...arguments);u(this,"_fog")}get fog(){return this._fog||(this._fog=new CM(0,0,50)),this._fog}get mode(){return NT.Linear}set near(t){this.fog.near=t}get near(){return this.fog.near}set far(t){this.fog.far=t}get far(){return this.fog.far}set color(t){this.fog.color.copy(t)}get color(){return this.fog.color}onEnable(){this.scene.fog=this.fog}onDisable(){this.scene.fog===this._fog&&(this.scene.fog=null)}}NI([x()],bv.prototype,"near",null);NI([x()],bv.prototype,"far",null);NI([x(ye)],bv.prototype,"color",null);let Fm,bC,ff,s0;function _C(n,e=1/0,t=null){bC||(bC=new Wn(2,2,1,1)),ff||(ff=new Et({uniforms:{blitTexture:new we(n)},vertexShader:`
			varying vec2 vUv;
			void main(){
				vUv = uv;
				gl_Position = vec4(position.xy * 1.0,0.,.999999);
			}`,fragmentShader:`
			uniform sampler2D blitTexture; 
			varying vec2 vUv;

			void main(){ 
				gl_FragColor = vec4(vUv.xy, 0, 1);
				
				#ifdef IS_SRGB
				gl_FragColor = LinearTosRGB( texture2D( blitTexture, vUv) );
				#else
				gl_FragColor = texture2D( blitTexture, vUv);
				#endif
			}`})),ff.uniforms.blitTexture.value=n,ff.defines.IS_SRGB=n.colorSpace==zt,ff.needsUpdate=!0,s0||(s0=new me(bC,ff),s0.frustrumCulled=!1);const i=new Wt,s=new Ws;s.add(s0),t===null&&(t=Fm=new Rl({antialias:!1}));const r=Math.min(n.image.width,e),o=Math.min(n.image.height,e);t.setSize(r,o),t.clear(),t.render(s,i);const a=document.createElement("canvas"),c=a.getContext("2d");a.width=r,a.height=o,c.drawImage(t.domElement,0,0,r,o);const l=new RM(a);return l.minFilter=n.minFilter,l.magFilter=n.magFilter,l.wrapS=n.wrapS,l.wrapT=n.wrapT,l.name=n.name,Fm&&(Fm.forceContextLoss(),Fm.dispose(),Fm=null),l}const JO={POSITION:["byte","byte normalized","unsigned byte","unsigned byte normalized","short","short normalized","unsigned short","unsigned short normalized"],NORMAL:["byte normalized","short normalized"],TANGENT:["byte normalized","short normalized"],TEXCOORD:["byte","byte normalized","unsigned byte","short","short normalized","unsigned short"]};class zI{constructor(){this.pluginCallbacks=[],this.register(function(e){return new Bie(e)}),this.register(function(e){return new Die(e)}),this.register(function(e){return new Lie(e)}),this.register(function(e){return new Fie(e)}),this.register(function(e){return new Uie(e)}),this.register(function(e){return new Nie(e)}),this.register(function(e){return new Oie(e)}),this.register(function(e){return new kie(e)}),this.register(function(e){return new zie(e)}),this.register(function(e){return new Gie(e)}),this.register(function(e){return new Vie(e)}),this.register(function(e){return new Hie(e)}),this.register(function(e){return new Qie(e)})}register(e){return this.pluginCallbacks.indexOf(e)===-1&&this.pluginCallbacks.push(e),this}unregister(e){return this.pluginCallbacks.indexOf(e)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,i,s){const r=new Pie,o=[];for(let a=0,c=this.pluginCallbacks.length;a<c;a++)o.push(this.pluginCallbacks[a](r));r.setPlugins(o),r.write(e,t,s).catch(i)}parseAsync(e,t){const i=this;return new Promise(function(s,r){i.parse(e,s,r,t)})}}const ni={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126,ARRAY_BUFFER:34962,ELEMENT_ARRAY_BUFFER:34963,NEAREST:9728,LINEAR:9729,NEAREST_MIPMAP_NEAREST:9984,LINEAR_MIPMAP_NEAREST:9985,NEAREST_MIPMAP_LINEAR:9986,LINEAR_MIPMAP_LINEAR:9987,CLAMP_TO_EDGE:33071,MIRRORED_REPEAT:33648,REPEAT:10497},xC="KHR_mesh_quantization",eo={};eo[Nt]=ni.NEAREST;eo[dp]=ni.NEAREST_MIPMAP_NEAREST;eo[Zc]=ni.NEAREST_MIPMAP_LINEAR;eo[St]=ni.LINEAR;eo[Wu]=ni.LINEAR_MIPMAP_NEAREST;eo[kr]=ni.LINEAR_MIPMAP_LINEAR;eo[ts]=ni.CLAMP_TO_EDGE;eo[Lo]=ni.REPEAT;eo[hd]=ni.MIRRORED_REPEAT;const KO={scale:"scale",position:"translation",quaternion:"rotation",morphTargetInfluences:"weights"},wie=new ye,ZO=12,Sie=1179937895,Cie=2,$O=8,Eie=1313821514,Tie=5130562;function Zm(n,e){return n.length===e.length&&n.every(function(t,i){return t===e[i]})}function Mie(n){return new TextEncoder().encode(n).buffer}function Iie(n){return Zm(n.elements,[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}function Rie(n,e,t){const i={min:new Array(n.itemSize).fill(Number.POSITIVE_INFINITY),max:new Array(n.itemSize).fill(Number.NEGATIVE_INFINITY)};for(let s=e;s<e+t;s++)for(let r=0;r<n.itemSize;r++){let o;n.itemSize>4?o=n.array[s*n.itemSize+r]:(r===0?o=n.getX(s):r===1?o=n.getY(s):r===2?o=n.getZ(s):r===3&&(o=n.getW(s)),n.normalized===!0&&(o=Vn.normalize(o,n.array))),i.min[r]=Math.min(i.min[r],o),i.max[r]=Math.max(i.max[r],o)}return i}function Yz(n){return Math.ceil(n/4)*4}function wC(n,e=0){const t=Yz(n.byteLength);if(t!==n.byteLength){const i=new Uint8Array(t);if(i.set(new Uint8Array(n)),e!==0)for(let s=n.byteLength;s<t;s++)i[s]=e;return i.buffer}return n}function ek(){return typeof document>"u"&&typeof OffscreenCanvas<"u"?new OffscreenCanvas(1,1):document.createElement("canvas")}function tk(n,e){if(n.toBlob!==void 0)return new Promise(i=>n.toBlob(i,e));let t;return e==="image/jpeg"?t=.92:e==="image/webp"&&(t=.8),n.convertToBlob({type:e,quality:t})}class Pie{constructor(){this.plugins=[],this.options={},this.pending=[],this.buffers=[],this.byteOffset=0,this.buffers=[],this.nodeMap=new Map,this.skins=[],this.extensionsUsed={},this.extensionsRequired={},this.uids=new Map,this.uid=0,this.json={asset:{version:"2.0",generator:"THREE.GLTFExporter"}},this.cache={meshes:new Map,attributes:new Map,attributesNormalized:new Map,materials:new Map,textures:new Map,images:new Map}}setPlugins(e){this.plugins=e}async write(e,t,i={}){this.options=Object.assign({binary:!1,trs:!1,onlyVisible:!0,maxTextureSize:1/0,animations:[],includeCustomExtensions:!1},i),this.options.animations.length>0&&(this.options.trs=!0),this.processInput(e),await Promise.all(this.pending);const s=this,r=s.buffers,o=s.json;i=s.options;const a=s.extensionsUsed,c=s.extensionsRequired,l=new Blob(r,{type:"application/octet-stream"}),h=Object.keys(a),d=Object.keys(c);if(h.length>0&&(o.extensionsUsed=h),d.length>0&&(o.extensionsRequired=d),o.buffers&&o.buffers.length>0&&(o.buffers[0].byteLength=l.size),i.binary===!0){const f=new FileReader;f.readAsArrayBuffer(l),f.onloadend=function(){const p=wC(f.result),m=new DataView(new ArrayBuffer($O));m.setUint32(0,p.byteLength,!0),m.setUint32(4,Tie,!0);const g=wC(Mie(JSON.stringify(o)),32),y=new DataView(new ArrayBuffer($O));y.setUint32(0,g.byteLength,!0),y.setUint32(4,Eie,!0);const A=new ArrayBuffer(ZO),v=new DataView(A);v.setUint32(0,Sie,!0),v.setUint32(4,Cie,!0);const b=ZO+y.byteLength+g.byteLength+m.byteLength+p.byteLength;v.setUint32(8,b,!0);const _=new Blob([A,y,g,m,p],{type:"application/octet-stream"}),T=new FileReader;T.readAsArrayBuffer(_),T.onloadend=function(){t(T.result)}}}else if(o.buffers&&o.buffers.length>0){const f=new FileReader;f.readAsDataURL(l),f.onloadend=function(){const p=f.result;o.buffers[0].uri=p,t(o)}}else t(o)}serializeUserData(e,t){if(Object.keys(e.userData).length===0)return;const i=this.options,s=this.extensionsUsed;try{const r=JSON.parse(JSON.stringify(e.userData));if(i.includeCustomExtensions&&r.gltfExtensions){t.extensions===void 0&&(t.extensions={});for(const o in r.gltfExtensions)t.extensions[o]=r.gltfExtensions[o],s[o]=!0;delete r.gltfExtensions}Object.keys(r).length>0&&(t.extras=r)}catch(r){console.warn("THREE.GLTFExporter: userData of '"+e.name+"' won't be serialized because of JSON.stringify error - "+r.message)}}getUID(e,t=!1){if(this.uids.has(e)===!1){const s=new Map;s.set(!0,this.uid++),s.set(!1,this.uid++),this.uids.set(e,s)}return this.uids.get(e).get(t)}isNormalizedNormalAttribute(e){if(this.cache.attributesNormalized.has(e))return!1;const i=new w;for(let s=0,r=e.count;s<r;s++)if(Math.abs(i.fromBufferAttribute(e,s).length()-1)>5e-4)return!1;return!0}createNormalizedNormalAttribute(e){const t=this.cache;if(t.attributesNormalized.has(e))return t.attributesNormalized.get(e);const i=e.clone(),s=new w;for(let r=0,o=i.count;r<o;r++)s.fromBufferAttribute(i,r),s.x===0&&s.y===0&&s.z===0?s.setX(1):s.normalize(),i.setXYZ(r,s.x,s.y,s.z);return t.attributesNormalized.set(e,i),i}applyTextureTransform(e,t){let i=!1;const s={};(t.offset.x!==0||t.offset.y!==0)&&(s.offset=t.offset.toArray(),i=!0),t.rotation!==0&&(s.rotation=t.rotation,i=!0),(t.repeat.x!==1||t.repeat.y!==1)&&(s.scale=t.repeat.toArray(),i=!0),i&&(e.extensions=e.extensions||{},e.extensions.KHR_texture_transform=s,this.extensionsUsed.KHR_texture_transform=!0)}buildMetalRoughTexture(e,t){if(e===t)return e;function i(p){return p.colorSpace===zt?function(g){return g<.04045?g*.0773993808:Math.pow(g*.9478672986+.0521327014,2.4)}:function(g){return g}}console.warn("THREE.GLTFExporter: Merged metalnessMap and roughnessMap textures."),e instanceof lc&&(e=_C(e)),t instanceof lc&&(t=_C(t));const s=e?e.image:null,r=t?t.image:null,o=Math.max(s?s.width:0,r?r.width:0),a=Math.max(s?s.height:0,r?r.height:0),c=ek();c.width=o,c.height=a;const l=c.getContext("2d");l.fillStyle="#00ffff",l.fillRect(0,0,o,a);const h=l.getImageData(0,0,o,a);if(s){l.drawImage(s,0,0,o,a);const p=i(e),m=l.getImageData(0,0,o,a).data;for(let g=2;g<m.length;g+=4)h.data[g]=p(m[g]/256)*256}if(r){l.drawImage(r,0,0,o,a);const p=i(t),m=l.getImageData(0,0,o,a).data;for(let g=1;g<m.length;g+=4)h.data[g]=p(m[g]/256)*256}l.putImageData(h,0,0);const f=(e||t).clone();return f.source=new nl(c),f.colorSpace=is,f.channel=(e||t).channel,e&&t&&e.channel!==t.channel&&console.warn("THREE.GLTFExporter: UV channels for metalnessMap and roughnessMap textures must match."),f}processBuffer(e){const t=this.json,i=this.buffers;return t.buffers||(t.buffers=[{byteLength:0}]),i.push(e),0}processBufferView(e,t,i,s,r){const o=this.json;o.bufferViews||(o.bufferViews=[]);let a;switch(t){case ni.BYTE:case ni.UNSIGNED_BYTE:a=1;break;case ni.SHORT:case ni.UNSIGNED_SHORT:a=2;break;default:a=4}const c=Yz(s*e.itemSize*a),l=new DataView(new ArrayBuffer(c));let h=0;for(let p=i;p<i+s;p++)for(let m=0;m<e.itemSize;m++){let g;e.itemSize>4?g=e.array[p*e.itemSize+m]:(m===0?g=e.getX(p):m===1?g=e.getY(p):m===2?g=e.getZ(p):m===3&&(g=e.getW(p)),e.normalized===!0&&(g=Vn.normalize(g,e.array))),t===ni.FLOAT?l.setFloat32(h,g,!0):t===ni.INT?l.setInt32(h,g,!0):t===ni.UNSIGNED_INT?l.setUint32(h,g,!0):t===ni.SHORT?l.setInt16(h,g,!0):t===ni.UNSIGNED_SHORT?l.setUint16(h,g,!0):t===ni.BYTE?l.setInt8(h,g):t===ni.UNSIGNED_BYTE&&l.setUint8(h,g),h+=a}const d={buffer:this.processBuffer(l.buffer),byteOffset:this.byteOffset,byteLength:c};return r!==void 0&&(d.target=r),r===ni.ARRAY_BUFFER&&(d.byteStride=e.itemSize*a),this.byteOffset+=c,o.bufferViews.push(d),{id:o.bufferViews.length-1,byteLength:0}}processBufferViewImage(e){const t=this,i=t.json;return i.bufferViews||(i.bufferViews=[]),new Promise(function(s){const r=new FileReader;r.readAsArrayBuffer(e),r.onloadend=function(){const o=wC(r.result),a={buffer:t.processBuffer(o),byteOffset:t.byteOffset,byteLength:o.byteLength};t.byteOffset+=o.byteLength,s(i.bufferViews.push(a)-1)}})}processAccessor(e,t,i,s){const r=this.json,o={1:"SCALAR",2:"VEC2",3:"VEC3",4:"VEC4",9:"MAT3",16:"MAT4"};let a;if(e.array.constructor===Float32Array)a=ni.FLOAT;else if(e.array.constructor===Int32Array)a=ni.INT;else if(e.array.constructor===Uint32Array)a=ni.UNSIGNED_INT;else if(e.array.constructor===Int16Array)a=ni.SHORT;else if(e.array.constructor===Uint16Array)a=ni.UNSIGNED_SHORT;else if(e.array.constructor===Int8Array)a=ni.BYTE;else if(e.array.constructor===Uint8Array)a=ni.UNSIGNED_BYTE;else throw new Error("THREE.GLTFExporter: Unsupported bufferAttribute component type: "+e.array.constructor.name);if(i===void 0&&(i=0),(s===void 0||s===1/0)&&(s=e.count),s===0)return null;const c=Rie(e,i,s);let l;t!==void 0&&(l=e===t.index?ni.ELEMENT_ARRAY_BUFFER:ni.ARRAY_BUFFER);const h=this.processBufferView(e,a,i,s,l),d={bufferView:h.id,byteOffset:h.byteOffset,componentType:a,count:s,max:c.max,min:c.min,type:o[e.itemSize]};return e.normalized===!0&&(d.normalized=!0),r.accessors||(r.accessors=[]),r.accessors.push(d)-1}processImage(e,t,i,s="image/png"){if(e!==null){const r=this,o=r.cache,a=r.json,c=r.options,l=r.pending;o.images.has(e)||o.images.set(e,{});const h=o.images.get(e),d=s+":flipY/"+i.toString();if(h[d]!==void 0)return h[d];a.images||(a.images=[]);const f={mimeType:s},p=ek();p.width=Math.min(e.width,c.maxTextureSize),p.height=Math.min(e.height,c.maxTextureSize);const m=p.getContext("2d");if(i===!0&&(m.translate(0,p.height),m.scale(1,-1)),e.data!==void 0){t!==xi&&console.error("GLTFExporter: Only RGBAFormat is supported.",t),(e.width>c.maxTextureSize||e.height>c.maxTextureSize)&&console.warn("GLTFExporter: Image size is bigger than maxTextureSize",e);const y=new Uint8ClampedArray(e.height*e.width*4);for(let A=0;A<y.length;A+=4)y[A+0]=e.data[A+0],y[A+1]=e.data[A+1],y[A+2]=e.data[A+2],y[A+3]=e.data[A+3];m.putImageData(new ImageData(y,e.width,e.height),0,0)}else m.drawImage(e,0,0,p.width,p.height);c.binary===!0?l.push(tk(p,s).then(y=>r.processBufferViewImage(y)).then(y=>{f.bufferView=y})):p.toDataURL!==void 0?f.uri=p.toDataURL(s):l.push(tk(p,s).then(y=>new FileReader().readAsDataURL(y)).then(y=>{f.uri=y}));const g=a.images.push(f)-1;return h[d]=g,g}else throw new Error("THREE.GLTFExporter: No valid image data found. Unable to process texture.")}processSampler(e){const t=this.json;t.samplers||(t.samplers=[]);const i={magFilter:eo[e.magFilter],minFilter:eo[e.minFilter],wrapS:eo[e.wrapS],wrapT:eo[e.wrapT]};return t.samplers.push(i)-1}processTexture(e){const i=this.options,s=this.cache,r=this.json;if(s.textures.has(e))return s.textures.get(e);r.textures||(r.textures=[]),e instanceof lc&&(e=_C(e,i.maxTextureSize));let o=e.userData.mimeType;o==="image/webp"&&(o="image/png");const a={sampler:this.processSampler(e),source:this.processImage(e.image,e.format,e.flipY,o)};e.name&&(a.name=e.name),this._invokeAll(function(l){l.writeTexture&&l.writeTexture(e,a)});const c=r.textures.push(a)-1;return s.textures.set(e,c),c}processMaterial(e){var l,h,d,f,p;const t=this.cache,i=this.json;if(t.materials.has(e))return t.materials.get(e);if(e.isShaderMaterial)return console.warn("GLTFExporter: THREE.ShaderMaterial not supported."),null;i.materials||(i.materials=[]);const s={pbrMetallicRoughness:{}};e.isMeshStandardMaterial!==!0&&e.isMeshBasicMaterial!==!0&&console.warn("GLTFExporter: Use MeshStandardMaterial or MeshBasicMaterial for best results.");const r=e.color.toArray().concat([e.opacity]);Zm(r,[1,1,1,1])||(s.pbrMetallicRoughness.baseColorFactor=r),e.isMeshStandardMaterial?(s.pbrMetallicRoughness.metallicFactor=e.metalness,s.pbrMetallicRoughness.roughnessFactor=e.roughness):(s.pbrMetallicRoughness.metallicFactor=.5,s.pbrMetallicRoughness.roughnessFactor=.5);const o=(l=e.metalnessMap)!=null&&l.image?e.metalnessMap:void 0,a=(h=e.roughnessMap)!=null&&h.image?e.roughnessMap:void 0;if(o||a){const m=this.buildMetalRoughTexture(o,a),g={index:this.processTexture(m),channel:m.channel};this.applyTextureTransform(g,m),s.pbrMetallicRoughness.metallicRoughnessTexture=g}if(e.map){const m={index:this.processTexture(e.map),texCoord:e.map.channel};this.applyTextureTransform(m,e.map),s.pbrMetallicRoughness.baseColorTexture=m}if(e.emissive){const m=e.emissive;if(Math.max(m.r,m.g,m.b)>0&&(s.emissiveFactor=e.emissive.toArray()),(d=e.emissiveMap)!=null&&d.image){const y={index:this.processTexture(e.emissiveMap),texCoord:e.emissiveMap.channel};this.applyTextureTransform(y,e.emissiveMap),s.emissiveTexture=y}}if((f=e.normalMap)!=null&&f.image){const m={index:this.processTexture(e.normalMap),texCoord:e.normalMap.channel};e.normalScale&&e.normalScale.x!==1&&(m.scale=e.normalScale.x),this.applyTextureTransform(m,e.normalMap),s.normalTexture=m}if((p=e.aoMap)!=null&&p.image){const m={index:this.processTexture(e.aoMap),texCoord:e.aoMap.channel};e.aoMapIntensity!==1&&(m.strength=e.aoMapIntensity),this.applyTextureTransform(m,e.aoMap),s.occlusionTexture=m}e.transparent?s.alphaMode="BLEND":e.alphaTest>0&&(s.alphaMode="MASK",s.alphaCutoff=e.alphaTest),e.side===Ai&&(s.doubleSided=!0),e.name!==""&&(s.name=e.name),this.serializeUserData(e,s),this._invokeAll(function(m){m.writeMaterial&&m.writeMaterial(e,s)});const c=i.materials.push(s)-1;return t.materials.set(e,c),c}processMesh(e){const t=this.cache,i=this.json,s=[e.geometry.uuid];if(Array.isArray(e.material))for(let _=0,T=e.material.length;_<T;_++)s.push(e.material[_].uuid);else s.push(e.material.uuid);const r=s.join(":");if(t.meshes.has(r))return t.meshes.get(r);const o=e.geometry;let a;e.isLineSegments?a=ni.LINES:e.isLineLoop?a=ni.LINE_LOOP:e.isLine?a=ni.LINE_STRIP:e.isPoints?a=ni.POINTS:a=e.material.wireframe?ni.LINES:ni.TRIANGLES;const c={},l={},h=[],d=[],f={uv:"TEXCOORD_0",uv1:"TEXCOORD_1",uv2:"TEXCOORD_2",uv3:"TEXCOORD_3",color:"COLOR_0",skinWeight:"WEIGHTS_0",skinIndex:"JOINTS_0"},p=o.getAttribute("normal");p!==void 0&&!this.isNormalizedNormalAttribute(p)&&(console.warn("THREE.GLTFExporter: Creating normalized normal attribute from the non-normalized one."),o.setAttribute("normal",this.createNormalizedNormalAttribute(p)));let m=null;for(let _ in o.attributes){if(_.slice(0,5)==="morph")continue;const T=o.attributes[_];if(_=f[_]||_.toUpperCase(),/^(POSITION|NORMAL|TANGENT|TEXCOORD_\d+|COLOR_\d+|JOINTS_\d+|WEIGHTS_\d+)$/.test(_)||(_="_"+_),t.attributes.has(this.getUID(T))){l[_]=t.attributes.get(this.getUID(T));continue}m=null;const M=T.array;_==="JOINTS_0"&&!(M instanceof Uint16Array)&&!(M instanceof Uint8Array)&&(console.warn('GLTFExporter: Attribute "skinIndex" converted to type UNSIGNED_SHORT.'),m=new it(new Uint16Array(M),T.itemSize,T.normalized));const I=this.processAccessor(m||T,o);I!==null&&(_.startsWith("_")||this.detectMeshQuantization(_,T),l[_]=I,t.attributes.set(this.getUID(T),I))}if(p!==void 0&&o.setAttribute("normal",p),Object.keys(l).length===0)return null;if(e.morphTargetInfluences!==void 0&&e.morphTargetInfluences.length>0){const _=[],T=[],E={};if(e.morphTargetDictionary!==void 0)for(const M in e.morphTargetDictionary)E[e.morphTargetDictionary[M]]=M;for(let M=0;M<e.morphTargetInfluences.length;++M){const I={};let S=!1;for(const C in o.morphAttributes){if(C!=="position"&&C!=="normal"){S||(console.warn("GLTFExporter: Only POSITION and NORMAL morph are supported."),S=!0);continue}const D=o.morphAttributes[C][M],G=C.toUpperCase(),Q=o.attributes[C];if(t.attributes.has(this.getUID(D,!0))){I[G]=t.attributes.get(this.getUID(D,!0));continue}const L=D.clone();if(!o.morphTargetsRelative)for(let V=0,O=D.count;V<O;V++)for(let U=0;U<D.itemSize;U++)U===0&&L.setX(V,D.getX(V)-Q.getX(V)),U===1&&L.setY(V,D.getY(V)-Q.getY(V)),U===2&&L.setZ(V,D.getZ(V)-Q.getZ(V)),U===3&&L.setW(V,D.getW(V)-Q.getW(V));I[G]=this.processAccessor(L,o),t.attributes.set(this.getUID(Q,!0),I[G])}d.push(I),_.push(e.morphTargetInfluences[M]),e.morphTargetDictionary!==void 0&&T.push(E[M])}c.weights=_,T.length>0&&(c.extras={},c.extras.targetNames=T)}const g=Array.isArray(e.material);if(g&&o.groups.length===0)return null;let y=!1;if(g&&o.index===null){const _=[];for(let T=0,E=o.attributes.position.count;T<E;T++)_[T]=T;o.setIndex(_),y=!0}const A=g?e.material:[e.material],v=g?o.groups:[{materialIndex:0,start:void 0,count:void 0}];for(let _=0,T=v.length;_<T;_++){const E={mode:a,attributes:l};if(this.serializeUserData(o,E),d.length>0&&(E.targets=d),o.index!==null){let I=this.getUID(o.index);(v[_].start!==void 0||v[_].count!==void 0)&&(I+=":"+v[_].start+":"+v[_].count),t.attributes.has(I)?E.indices=t.attributes.get(I):(E.indices=this.processAccessor(o.index,o,v[_].start,v[_].count),t.attributes.set(I,E.indices)),E.indices===null&&delete E.indices}const M=this.processMaterial(A[v[_].materialIndex]);M!==null&&(E.material=M),h.push(E)}y===!0&&o.setIndex(null),c.primitives=h,i.meshes||(i.meshes=[]),this._invokeAll(function(_){_.writeMesh&&_.writeMesh(e,c)});const b=i.meshes.push(c)-1;return t.meshes.set(r,b),b}detectMeshQuantization(e,t){if(this.extensionsUsed[xC])return;let i;switch(t.array.constructor){case Int8Array:i="byte";break;case Uint8Array:i="unsigned byte";break;case Int16Array:i="short";break;case Uint16Array:i="unsigned short";break;default:return}t.normalized&&(i+=" normalized");const s=e.split("_",1)[0];JO[s]&&JO[s].includes(i)&&(this.extensionsUsed[xC]=!0,this.extensionsRequired[xC]=!0)}processCamera(e){const t=this.json;t.cameras||(t.cameras=[]);const i=e.isOrthographicCamera,s={type:i?"orthographic":"perspective"};return i?s.orthographic={xmag:e.right*2,ymag:e.top*2,zfar:e.far<=0?.001:e.far,znear:e.near<0?0:e.near}:s.perspective={aspectRatio:e.aspect,yfov:Vn.degToRad(e.fov),zfar:e.far<=0?.001:e.far,znear:e.near<0?0:e.near},e.name!==""&&(s.name=e.type),t.cameras.push(s)-1}processAnimation(e,t){const i=this.json,s=this.nodeMap;i.animations||(i.animations=[]),e=zI.Utils.mergeMorphTargetTracks(e.clone(),t);const r=e.tracks,o=[],a=[];for(let c=0;c<r.length;++c){const l=r[c],h=qt.parseTrackName(l.name);let d=qt.findNode(t,h.nodeName);const f=KO[h.propertyName];if(h.objectName==="bones"&&(d.isSkinnedMesh===!0?d=d.skeleton.getBoneByName(h.objectIndex):d=void 0),!d||!f)return console.warn('THREE.GLTFExporter: Could not export animation track "%s".',l.name),null;const p=1;let m=l.values.length/l.times.length;f===KO.morphTargetInfluences&&(m/=d.morphTargetInfluences.length);let g;l.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline===!0?(g="CUBICSPLINE",m/=3):l.getInterpolation()===ud?g="STEP":g="LINEAR",a.push({input:this.processAccessor(new it(l.times,p)),output:this.processAccessor(new it(l.values,m)),interpolation:g}),o.push({sampler:a.length-1,target:{node:s.get(d),path:f}})}return i.animations.push({name:e.name||"clip_"+i.animations.length,samplers:a,channels:o}),i.animations.length-1}processSkin(e){const t=this.json,i=this.nodeMap,s=t.nodes[i.get(e)],r=e.skeleton;if(r===void 0)return null;const o=e.skeleton.bones[0];if(o===void 0)return null;const a=[],c=new Float32Array(r.bones.length*16),l=new Ce;for(let d=0;d<r.bones.length;++d)a.push(i.get(r.bones[d])),l.copy(r.boneInverses[d]),l.multiply(e.bindMatrix).toArray(c,d*16);return t.skins===void 0&&(t.skins=[]),t.skins.push({inverseBindMatrices:this.processAccessor(new it(c,16)),joints:a,skeleton:i.get(o)}),s.skin=t.skins.length-1}processNode(e){const t=this.json,i=this.options,s=this.nodeMap;t.nodes||(t.nodes=[]);const r={};if(i.trs){const a=e.quaternion.toArray(),c=e.position.toArray(),l=e.scale.toArray();Zm(a,[0,0,0,1])||(r.rotation=a),Zm(c,[0,0,0])||(r.translation=c),Zm(l,[1,1,1])||(r.scale=l)}else e.matrixAutoUpdate&&e.updateMatrix(),Iie(e.matrix)===!1&&(r.matrix=e.matrix.elements);if(e.name!==""&&(r.name=String(e.name)),this.serializeUserData(e,r),e.isMesh||e.isLine||e.isPoints){const a=this.processMesh(e);a!==null&&(r.mesh=a)}else e.isCamera&&(r.camera=this.processCamera(e));if(e.isSkinnedMesh&&this.skins.push(e),e.children.length>0){const a=[];for(let c=0,l=e.children.length;c<l;c++){const h=e.children[c];if(h.visible||i.onlyVisible===!1){const d=this.processNode(h);d!==null&&a.push(d)}}a.length>0&&(r.children=a)}this._invokeAll(function(a){a.writeNode&&a.writeNode(e,r)});const o=t.nodes.push(r)-1;return s.set(e,o),o}processScene(e){const t=this.json,i=this.options;t.scenes||(t.scenes=[],t.scene=0);const s={};e.name!==""&&(s.name=e.name),t.scenes.push(s);const r=[];for(let o=0,a=e.children.length;o<a;o++){const c=e.children[o];if(c.visible||i.onlyVisible===!1){const l=this.processNode(c);l!==null&&r.push(l)}}r.length>0&&(s.nodes=r),this.serializeUserData(e,s)}processObjects(e){const t=new Ws;t.name="AuxScene";for(let i=0;i<e.length;i++)t.children.push(e[i]);this.processScene(t)}processInput(e){const t=this.options;e=e instanceof Array?e:[e],this._invokeAll(function(s){s.beforeParse&&s.beforeParse(e)});const i=[];for(let s=0;s<e.length;s++)e[s]instanceof Ws?this.processScene(e[s]):i.push(e[s]);i.length>0&&this.processObjects(i);for(let s=0;s<this.skins.length;++s)this.processSkin(this.skins[s]);for(let s=0;s<t.animations.length;++s)this.processAnimation(t.animations[s],e[0]);this._invokeAll(function(s){s.afterParse&&s.afterParse(e)})}_invokeAll(e){for(let t=0,i=this.plugins.length;t<i;t++)e(this.plugins[t])}}class Bie{constructor(e){this.writer=e,this.name="KHR_lights_punctual"}writeNode(e,t){if(!e.isLight)return;if(!e.isDirectionalLight&&!e.isPointLight&&!e.isSpotLight){console.warn("THREE.GLTFExporter: Only directional, point, and spot lights are supported.",e);return}const i=this.writer,s=i.json,r=i.extensionsUsed,o={};e.name&&(o.name=e.name),o.color=e.color.toArray(),o.intensity=e.intensity,e.isDirectionalLight?o.type="directional":e.isPointLight?(o.type="point",e.distance>0&&(o.range=e.distance)):e.isSpotLight&&(o.type="spot",e.distance>0&&(o.range=e.distance),o.spot={},o.spot.innerConeAngle=(1-e.penumbra)*e.angle,o.spot.outerConeAngle=e.angle),e.decay!==void 0&&e.decay!==2&&console.warn("THREE.GLTFExporter: Light decay may be lost. glTF is physically-based, and expects light.decay=2."),e.target&&(e.target.parent!==e||e.target.position.x!==0||e.target.position.y!==0||e.target.position.z!==-1)&&console.warn("THREE.GLTFExporter: Light direction may be lost. For best results, make light.target a child of the light with position 0,0,-1."),r[this.name]||(s.extensions=s.extensions||{},s.extensions[this.name]={lights:[]},r[this.name]=!0);const a=s.extensions[this.name].lights;a.push(o),t.extensions=t.extensions||{},t.extensions[this.name]={light:a.length-1}}}class Die{constructor(e){this.writer=e,this.name="KHR_materials_unlit"}writeMaterial(e,t){if(!e.isMeshBasicMaterial)return;const s=this.writer.extensionsUsed;t.extensions=t.extensions||{},t.extensions[this.name]={},s[this.name]=!0,t.pbrMetallicRoughness.metallicFactor=0,t.pbrMetallicRoughness.roughnessFactor=.9}}class Oie{constructor(e){this.writer=e,this.name="KHR_materials_clearcoat"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||e.clearcoat===0)return;const i=this.writer,s=i.extensionsUsed,r={};if(r.clearcoatFactor=e.clearcoat,e.clearcoatMap){const o={index:i.processTexture(e.clearcoatMap),texCoord:e.clearcoatMap.channel};i.applyTextureTransform(o,e.clearcoatMap),r.clearcoatTexture=o}if(r.clearcoatRoughnessFactor=e.clearcoatRoughness,e.clearcoatRoughnessMap){const o={index:i.processTexture(e.clearcoatRoughnessMap),texCoord:e.clearcoatRoughnessMap.channel};i.applyTextureTransform(o,e.clearcoatRoughnessMap),r.clearcoatRoughnessTexture=o}if(e.clearcoatNormalMap){const o={index:i.processTexture(e.clearcoatNormalMap),texCoord:e.clearcoatNormalMap.channel};i.applyTextureTransform(o,e.clearcoatNormalMap),r.clearcoatNormalTexture=o}t.extensions=t.extensions||{},t.extensions[this.name]=r,s[this.name]=!0}}class kie{constructor(e){this.writer=e,this.name="KHR_materials_iridescence"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||e.iridescence===0)return;const i=this.writer,s=i.extensionsUsed,r={};if(r.iridescenceFactor=e.iridescence,e.iridescenceMap){const o={index:i.processTexture(e.iridescenceMap),texCoord:e.iridescenceMap.channel};i.applyTextureTransform(o,e.iridescenceMap),r.iridescenceTexture=o}if(r.iridescenceIor=e.iridescenceIOR,r.iridescenceThicknessMinimum=e.iridescenceThicknessRange[0],r.iridescenceThicknessMaximum=e.iridescenceThicknessRange[1],e.iridescenceThicknessMap){const o={index:i.processTexture(e.iridescenceThicknessMap),texCoord:e.iridescenceThicknessMap.channel};i.applyTextureTransform(o,e.iridescenceThicknessMap),r.iridescenceThicknessTexture=o}t.extensions=t.extensions||{},t.extensions[this.name]=r,s[this.name]=!0}}class Lie{constructor(e){this.writer=e,this.name="KHR_materials_transmission"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||e.transmission===0)return;const i=this.writer,s=i.extensionsUsed,r={};if(r.transmissionFactor=e.transmission,e.transmissionMap){const o={index:i.processTexture(e.transmissionMap),texCoord:e.transmissionMap.channel};i.applyTextureTransform(o,e.transmissionMap),r.transmissionTexture=o}t.extensions=t.extensions||{},t.extensions[this.name]=r,s[this.name]=!0}}class Fie{constructor(e){this.writer=e,this.name="KHR_materials_volume"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||e.transmission===0)return;const i=this.writer,s=i.extensionsUsed,r={};if(r.thicknessFactor=e.thickness,e.thicknessMap){const o={index:i.processTexture(e.thicknessMap),texCoord:e.thicknessMap.channel};i.applyTextureTransform(o,e.thicknessMap),r.thicknessTexture=o}r.attenuationDistance=e.attenuationDistance,r.attenuationColor=e.attenuationColor.toArray(),t.extensions=t.extensions||{},t.extensions[this.name]=r,s[this.name]=!0}}class Uie{constructor(e){this.writer=e,this.name="KHR_materials_ior"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||e.ior===1.5)return;const s=this.writer.extensionsUsed,r={};r.ior=e.ior,t.extensions=t.extensions||{},t.extensions[this.name]=r,s[this.name]=!0}}class Nie{constructor(e){this.writer=e,this.name="KHR_materials_specular"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||e.specularIntensity===1&&e.specularColor.equals(wie)&&!e.specularIntensityMap&&!e.specularColorMap)return;const i=this.writer,s=i.extensionsUsed,r={};if(e.specularIntensityMap){const o={index:i.processTexture(e.specularIntensityMap),texCoord:e.specularIntensityMap.channel};i.applyTextureTransform(o,e.specularIntensityMap),r.specularTexture=o}if(e.specularColorMap){const o={index:i.processTexture(e.specularColorMap),texCoord:e.specularColorMap.channel};i.applyTextureTransform(o,e.specularColorMap),r.specularColorTexture=o}r.specularFactor=e.specularIntensity,r.specularColorFactor=e.specularColor.toArray(),t.extensions=t.extensions||{},t.extensions[this.name]=r,s[this.name]=!0}}class zie{constructor(e){this.writer=e,this.name="KHR_materials_sheen"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||e.sheen==0)return;const i=this.writer,s=i.extensionsUsed,r={};if(e.sheenRoughnessMap){const o={index:i.processTexture(e.sheenRoughnessMap),texCoord:e.sheenRoughnessMap.channel};i.applyTextureTransform(o,e.sheenRoughnessMap),r.sheenRoughnessTexture=o}if(e.sheenColorMap){const o={index:i.processTexture(e.sheenColorMap),texCoord:e.sheenColorMap.channel};i.applyTextureTransform(o,e.sheenColorMap),r.sheenColorTexture=o}r.sheenRoughnessFactor=e.sheenRoughness,r.sheenColorFactor=e.sheenColor.toArray(),t.extensions=t.extensions||{},t.extensions[this.name]=r,s[this.name]=!0}}class Gie{constructor(e){this.writer=e,this.name="KHR_materials_anisotropy"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||e.anisotropy==0)return;const i=this.writer,s=i.extensionsUsed,r={};if(e.anisotropyMap){const o={index:i.processTexture(e.anisotropyMap)};i.applyTextureTransform(o,e.anisotropyMap),r.anisotropyTexture=o}r.anisotropyStrength=e.anisotropy,r.anisotropyRotation=e.anisotropyRotation,t.extensions=t.extensions||{},t.extensions[this.name]=r,s[this.name]=!0}}class Vie{constructor(e){this.writer=e,this.name="KHR_materials_emissive_strength"}writeMaterial(e,t){if(!e.isMeshStandardMaterial||e.emissiveIntensity===1)return;const s=this.writer.extensionsUsed,r={};r.emissiveStrength=e.emissiveIntensity,t.extensions=t.extensions||{},t.extensions[this.name]=r,s[this.name]=!0}}class Hie{constructor(e){this.writer=e,this.name="EXT_materials_bump"}writeMaterial(e,t){if(!e.isMeshStandardMaterial||e.bumpScale===1&&!e.bumpMap)return;const i=this.writer,s=i.extensionsUsed,r={};if(e.bumpMap){const o={index:i.processTexture(e.bumpMap),texCoord:e.bumpMap.channel};i.applyTextureTransform(o,e.bumpMap),r.bumpTexture=o}r.bumpFactor=e.bumpScale,t.extensions=t.extensions||{},t.extensions[this.name]=r,s[this.name]=!0}}class Qie{constructor(e){this.writer=e,this.name="EXT_mesh_gpu_instancing"}writeNode(e,t){if(!e.isInstancedMesh)return;const i=this.writer,s=e,r=new Float32Array(s.count*3),o=new Float32Array(s.count*4),a=new Float32Array(s.count*3),c=new Ce,l=new w,h=new Me,d=new w;for(let p=0;p<s.count;p++)s.getMatrixAt(p,c),c.decompose(l,h,d),l.toArray(r,p*3),h.toArray(o,p*4),d.toArray(a,p*3);const f={TRANSLATION:i.processAccessor(new it(r,3)),ROTATION:i.processAccessor(new it(o,4)),SCALE:i.processAccessor(new it(a,3))};s.instanceColor&&(f._COLOR_0=i.processAccessor(s.instanceColor)),t.extensions=t.extensions||{},t.extensions[this.name]={attributes:f},i.extensionsUsed[this.name]=!0,i.extensionsRequired[this.name]=!0}}zI.Utils={insertKeyframe:function(n,e){const i=n.getValueSize(),s=new n.TimeBufferType(n.times.length+1),r=new n.ValueBufferType(n.values.length+i),o=n.createInterpolant(new n.ValueBufferType(i));let a;if(n.times.length===0){s[0]=e;for(let c=0;c<i;c++)r[c]=0;a=0}else if(e<n.times[0]){if(Math.abs(n.times[0]-e)<.001)return 0;s[0]=e,s.set(n.times,1),r.set(o.evaluate(e),0),r.set(n.values,i),a=0}else if(e>n.times[n.times.length-1]){if(Math.abs(n.times[n.times.length-1]-e)<.001)return n.times.length-1;s[s.length-1]=e,s.set(n.times,0),r.set(n.values,0),r.set(o.evaluate(e),n.values.length),a=s.length-1}else for(let c=0;c<n.times.length;c++){if(Math.abs(n.times[c]-e)<.001)return c;if(n.times[c]<e&&n.times[c+1]>e){s.set(n.times.slice(0,c+1),0),s[c+1]=e,s.set(n.times.slice(c+1),c+2),r.set(n.values.slice(0,(c+1)*i),0),r.set(o.evaluate(e),(c+1)*i),r.set(n.values.slice((c+1)*i),(c+2)*i),a=c+1;break}}return n.times=s,n.values=r,a},mergeMorphTargetTracks:function(n,e){const t=[],i={},s=n.tracks;for(let r=0;r<s.length;++r){let o=s[r];const a=qt.parseTrackName(o.name),c=qt.findNode(e,a.nodeName);if(a.propertyName!=="morphTargetInfluences"||a.propertyIndex===void 0){t.push(o);continue}if(o.createInterpolant!==o.InterpolantFactoryMethodDiscrete&&o.createInterpolant!==o.InterpolantFactoryMethodLinear){if(o.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline)throw new Error("THREE.GLTFExporter: Cannot merge tracks with glTF CUBICSPLINE interpolation.");console.warn("THREE.GLTFExporter: Morph target interpolation mode not yet supported. Using LINEAR instead."),o=o.clone(),o.setInterpolation(Gh)}const l=c.morphTargetInfluences.length,h=c.morphTargetDictionary[a.propertyIndex];if(h===void 0)throw new Error("THREE.GLTFExporter: Morph target name not found: "+a.propertyIndex);let d;if(i[c.uuid]===void 0){d=o.clone();const p=new d.ValueBufferType(l*d.times.length);for(let m=0;m<d.times.length;m++)p[m*l+h]=d.values[m];d.name=(a.nodeName||"")+".morphTargetInfluences",d.values=p,i[c.uuid]=d,t.push(d);continue}const f=o.createInterpolant(new o.ValueBufferType(1));d=i[c.uuid];for(let p=0;p<d.times.length;p++)d.values[p*l+h]=f.evaluate(d.times[p]);for(let p=0;p<o.times.length;p++){const m=this.insertKeyframe(d,o.times[p]);d.values[m*l+h]=o.values[p]}}return n.tracks=t,n}};const SC=re("debugexr");class jie{constructor(e){u(this,"parser");this.parser=e,SC&&console.log(e)}get name(){return"EXT_texture_exr"}loadTexture(e){const t=this.name,i=this.parser,r=i.json.textures[e];if(SC&&console.log("EXT_texture_exr.loadTexture",e,r),!r.extensions||!r.extensions[t])return null;const o=r.extensions[t],a=new bb(i.options.manager);return SC&&console.log("EXT_texture_exr.loadTexture",o),i.loadTextureImage(e,o.source,a)}}typeof window<"u"&&window.addEventListener("unhandledrejection",n=>{});const Uc=_s,r0="$___Export_Components",Wie="NEEDLE_components";var voe;class qie{constructor(){u(this,voe)}}voe=vf;class Xie{constructor(e,t,i){u(this,"node");u(this,"nodeIndex");u(this,"nodeDef");this.node=e,this.nodeIndex=t,this.nodeDef=i}}class Yie{constructor(){u(this,"parser");u(this,"nodeToObjectMap",{});u(this,"exportContext");u(this,"objectToNodeMap",{});u(this,"context");u(this,"writer")}get name(){return Wie}registerExport(e){e.register(t=>{if("serializeUserData"in t){const i=t.serializeUserData.bind(t);this.writer=t,t.serializeUserData=(s,r)=>{try{this.serializeUserData(s,r),i(s,r)}finally{this.afterSerializeUserData(s,r)}}}return this})}beforeParse(){this.exportContext={},this.objectToNodeMap={}}serializeUserData(e,t){var s;const i=(s=e.userData)==null?void 0:s.components;!i||i.length<=0||(delete e.userData.components,e[r0]=i)}afterSerializeUserData(e,t){if(e.type==="Scene"&&Uc&&console.log("DONE",JSON.stringify(t)),e[r0]===void 0)return;const i=e[r0];delete e[r0],i!==null&&(e.userData.components=i)}writeNode(e,t){const i=this.writer.json.nodes.length;Uc&&console.log(e.name,i,e.uuid);const s=new Xie(e,i,t);this.exportContext[i]=s,this.objectToNodeMap[e.uuid]=i}afterParse(e){var t;Uc&&console.log("AFTER",e);for(const i in this.exportContext){const s=this.exportContext[i],r=s.node,o=s.nodeDef,a=s.nodeIndex,c=(t=r.userData)==null?void 0:t.components;if(!c||c.length<=0)continue;const l=new qie;o.extensions=o.extensions||{},o.extensions[this.name]=l,this.context.object=r,this.context.nodeId=a,this.context.objectToNode=this.objectToNodeMap;const h=[];for(const d of c){this.context.target=d;const f=mc().writeBuiltinComponentData(d,this.context);f!==null&&h.push(f)}h.length>0&&(l[vf]=h,Uc&&console.log("DID WRITE",r,"nodeIndex",a,h))}}beforeRoot(){return Uc&&console.log("BEGIN LOAD"),this.nodeToObjectMap={},null}async afterRoot(e){const t=e.parser,i=t==null?void 0:t.extensions;if(!i)return;const s=i[this.name];Uc&&console.log("After root",e,this.parser,i);const r=[];if(s===!0){const o=t.json.nodes;if(o){for(let a=0;a<o.length;a++){const c=await t.getDependency("node",a);this.nodeToObjectMap[a]=c}for(let a=0;a<o.length;a++){const c=o[a],l=a,h=c.extensions;if(!h)continue;const d=h[this.name];if(!d)continue;Uc&&console.log("NODE",c);const f=this.nodeToObjectMap[l];if(!f){console.error("Could not find object for node index: "+l,c,t);continue}rI(f),r.push(this.createComponents(f,d))}}}await Promise.all(r)}async createComponents(e,t){if(!t)return;const i=t[vf];if(i){const s=new Array;Uc&&console.log(e.name,i);for(const r in i){const o=i[r];Uc&&console.log("Serialized data",JSON.parse(JSON.stringify(o))),o&&this.parser&&s.push(d1(this.parser,o).catch(a=>console.error(`Error while resolving references (see console for details)
`,a,e,o))),e.userData=e.userData||{},e.userData[vf]=e.userData[vf]||[],e.userData[vf].push(o)}await Promise.all(s).catch(r=>{console.error("Error while loading components",r)})}}}const ik="NEEDLE_gameobject_data";class Jie{constructor(e){u(this,"parser");this.parser=e}get name(){return ik}afterRoot(e){var i;const t=[];for(let s=0;s<((i=this.parser.json.nodes)==null?void 0:i.length);s++){const r=this.parser.json.nodes[s];if(r&&r.extensions){const o=r.extensions[ik];if(o){const a=this.findAndApplyExtensionData(s,o);t.push(a)}}}return Promise.all(t).then(()=>null)}async findAndApplyExtensionData(e,t){const i=await this.parser.getDependency("node",e);i&&this.applyExtensionData(i,t)}applyExtensionData(e,t){t.layers===void 0&&(t.layers=0),e.userData.layer=t.layers,e.layers.disableAll(),e.layers.set(t.layers),e.userData.tag=t.tag??"none",e.userData.hideFlags=t.hideFlags??0,e.userData.static=t.static??!1,e.visible=t.activeSelf??!0,e.guid=t.guid}}const nk="NEEDLE_lighting_settings",Ef=re("debugenvlight");class Kie{constructor(e,t,i){u(this,"parser");u(this,"sourceId");u(this,"context");this.parser=e,this.sourceId=t,this.context=i}get name(){return nk}afterRoot(e){const t=this.parser.json.extensions;if(t){const i=t[nk];if(i){Ef&&console.log('Loaded "'+this.name+'", src: "'+this.sourceId+'"',i);let s;if(e.scene.children.length===1){const r=e.scene.children[0];s=le.addNewComponent(r,zT,!1)}else{const r=new ge;r.name="LightSettings "+this.sourceId,e.scene.add(r),s=le.addNewComponent(r,zT,!1)}s.sourceId=this.sourceId,s.ambientIntensity=i.ambientIntensity,s.ambientLight=new ye().fromArray(i.ambientLight),Array.isArray(i.ambientTrilight)&&(s.ambientTrilight=i.ambientTrilight.map(r=>new ye().fromArray(r))),s.ambientMode=i.ambientMode,s.environmentReflectionSource=i.environmentReflectionSource}}return null}}zi.registerCallback(Cn.ContextCreated,n=>{const e=n.context,t=le.findObjectOfType(zT,e);t!=null&&t.sourceId&&(t.enabled=!0)});class zT extends Te{constructor(){super(...arguments);u(this,"ambientMode",Ja.Skybox);u(this,"ambientLight");u(this,"ambientTrilight");u(this,"ambientIntensity",1);u(this,"environmentReflectionSource",bA.Skybox);u(this,"_hasReflection",!1);u(this,"_ambientLightObj");u(this,"_hemisphereLightObj");u(this,"_lightProbeObj")}awake(){var i;if(this.sourceId){const s=this.environmentReflectionSource===bA.Skybox?sc.Skybox:sc.Reflection,r=this.context.lightmaps.tryGet(this.sourceId,s,0);this._hasReflection=r!=null,r&&this.context.sceneLighting.internalRegisterReflection(this.sourceId,r)}this.enabled=!1,this.context.sceneLighting.internalRegisterSceneLightSettings(this),Ef&&window.addEventListener("keydown",s=>{if(!this.destroyed)switch(s.key){case"l":this.enabled=!this.enabled;break}});const t=(i=this.gameObject.userData)==null?void 0:i.components;if(t){const s=t.indexOf(this);t.splice(s,1),t.push(this)}}onDestroy(){this.context.sceneLighting.internalUnregisterSceneLightSettings(this)}calculateIntensityFactor(t){const i=Math.max(t.r,t.g,t.b);return 2.2*nt.lerp(0,1.33,i)}onEnable(){if(Ef&&console.warn(" >>> Enable lighting",this.sourceId,this.enabled,this),this.ambientMode==Ja.Flat){if(this.ambientLight&&!this._ambientLightObj){const t=this.calculateIntensityFactor(this.ambientLight);this._ambientLightObj=new jM(this.ambientLight,this.ambientIntensity*t),Ef&&console.log("Created ambient light",this.sourceId,this._ambientLightObj,this.ambientIntensity,t)}this._ambientLightObj&&this.gameObject.add(this._ambientLightObj),this._lightProbeObj&&this._lightProbeObj.removeFromParent()}else if(this.ambientMode===Ja.Trilight){if(this.ambientTrilight){const t=this.ambientTrilight[0],i=this.ambientTrilight[this.ambientTrilight.length-1],s=this.calculateIntensityFactor(i);this._hemisphereLightObj=new HM(i,t,this.ambientIntensity*s),this.gameObject.add(this._hemisphereLightObj),Ef&&console.log("Created hemisphere ambient light",this.sourceId,this._hemisphereLightObj,this.ambientIntensity,s)}}else this._ambientLightObj&&this._ambientLightObj.removeFromParent(),this._hemisphereLightObj&&this._hemisphereLightObj.removeFromParent();this.sourceId&&this.context.sceneLighting.internalEnableReflection(this.sourceId)}onDisable(){Ef&&console.warn(" <<< Disable lighting:",this.sourceId,this),this._lightProbeObj&&this._lightProbeObj.removeFromParent(),this._ambientLightObj&&this._ambientLightObj.removeFromParent(),this._hemisphereLightObj&&this._hemisphereLightObj.removeFromParent(),this.sourceId&&this.context.sceneLighting.internalDisableReflection(this.sourceId)}}var sk;(function(n){n[n.Fragment=35632]="Fragment",n[n.Vertex=35633]="Vertex"})(sk||(sk={}));var GT;(function(n){n[n.INT=5124]="INT",n[n.FLOAT=5126]="FLOAT",n[n.FLOAT_VEC2=35664]="FLOAT_VEC2",n[n.FLOAT_VEC3=35665]="FLOAT_VEC3",n[n.FLOAT_VEC4=35666]="FLOAT_VEC4",n[n.INT_VEC2=35667]="INT_VEC2",n[n.INT_VEC3=35668]="INT_VEC3",n[n.INT_VEC4=35669]="INT_VEC4",n[n.BOOL=35670]="BOOL",n[n.BOOL_VEC2=35671]="BOOL_VEC2",n[n.BOOL_VEC3=35672]="BOOL_VEC3",n[n.BOOL_VEC4=35673]="BOOL_VEC4",n[n.FLOAT_MAT2=35674]="FLOAT_MAT2",n[n.FLOAT_MAT3=35675]="FLOAT_MAT3",n[n.FLOAT_MAT4=35676]="FLOAT_MAT4",n[n.SAMPLER_2D=35678]="SAMPLER_2D",n[n.SAMPLER_3D=35680]="SAMPLER_3D",n[n.SAMPLER_CUBE=35681]="SAMPLER_CUBE",n[n.UNKNOWN=0]="UNKNOWN"})(GT||(GT={}));const mh=re("debugcustomshader"),pf="NEEDLE_techniques_webgl";var rk;(function(n){n[n.INT=5124]="INT",n[n.FLOAT=5126]="FLOAT",n[n.FLOAT_VEC2=35664]="FLOAT_VEC2",n[n.FLOAT_VEC3=35665]="FLOAT_VEC3",n[n.FLOAT_VEC4=35666]="FLOAT_VEC4",n[n.INT_VEC2=35667]="INT_VEC2",n[n.INT_VEC3=35668]="INT_VEC3",n[n.INT_VEC4=35669]="INT_VEC4",n[n.BOOL=35670]="BOOL",n[n.BOOL_VEC2=35671]="BOOL_VEC2",n[n.BOOL_VEC3=35672]="BOOL_VEC3",n[n.BOOL_VEC4=35673]="BOOL_VEC4",n[n.FLOAT_MAT2=35674]="FLOAT_MAT2",n[n.FLOAT_MAT3=35675]="FLOAT_MAT3",n[n.FLOAT_MAT4=35676]="FLOAT_MAT4",n[n.SAMPLER_2D=35678]="SAMPLER_2D",n[n.SAMPLER_3D=35680]="SAMPLER_3D",n[n.SAMPLER_CUBE=35681]="SAMPLER_CUBE",n[n.UNKNOWN=0]="UNKNOWN"})(rk||(rk={}));class Zie{constructor(){u(this,"objectToWorldMatrix",new Ce);u(this,"worldToObjectMatrix",new Ce);u(this,"objectToWorld",new Array);u(this,"worldToObject",new Array)}updateFrom(e){this.objectToWorldMatrix.copy(e.matrixWorld),Db(this.objectToWorldMatrix,this.objectToWorld),this.worldToObjectMatrix.copy(e.matrixWorld).invert(),Db(this.worldToObjectMatrix,this.worldToObject)}}var Tg;(function(n){n[n.Off=0]="Off",n[n.Front=1]="Front",n[n.Back=2]="Back"})(Tg||(Tg={}));var Wc;(function(n){n[n.Never=1]="Never",n[n.Less=2]="Less",n[n.Equal=3]="Equal",n[n.LEqual=4]="LEqual",n[n.Greater=5]="Greater",n[n.NotEqual=6]="NotEqual",n[n.GEqual=7]="GEqual",n[n.Always=8]="Always"})(Wc||(Wc={}));const Xi=class extends HA{constructor(t,...i){super(...i);u(this,"identifier");u(this,"onBeforeRenderSceneCallback",this.onBeforeRenderScene.bind(this));u(this,"_sphericalHarmonicsName","unity_SpecCube0");u(this,"_objToWorldName","hlslcc_mtx4x4unity_ObjectToWorld");u(this,"_worldToObjectName","hlslcc_mtx4x4unity_WorldToObject");u(this,"_viewProjectionName","hlslcc_mtx4x4unity_MatrixVP");u(this,"_viewMatrixName","hlslcc_mtx4x4unity_MatrixV");u(this,"_rendererData",new Zie);this.identifier=t,mh&&console.log(this),this.type="NEEDLE_CUSTOM_SHADER",this.uniforms[this._objToWorldName]||(this.uniforms[this._objToWorldName]={value:[]}),this.uniforms[this._worldToObjectName]||(this.uniforms[this._worldToObjectName]={value:[]}),this.uniforms[this._viewProjectionName]||(this.uniforms[this._viewProjectionName]={value:[]}),this.uniforms[this._sphericalHarmonicsName],(this.depthTextureUniform||this.opaqueTextureUniform)&&Lt.Current.pre_render_callbacks.push(this.onBeforeRenderSceneCallback)}clone(){const t=super.clone();return Jz(t),t}dispose(){super.dispose();const t=Lt.Current.pre_render_callbacks.indexOf(this.onBeforeRenderSceneCallback);t>=0&&Lt.Current.pre_render_callbacks.splice(t,1)}get depthTextureUniform(){if(this.uniforms)return this.uniforms._CameraDepthTexture}get opaqueTextureUniform(){if(this.uniforms)return this.uniforms._CameraOpaqueTexture}onBeforeRenderScene(){this.opaqueTextureUniform&&Lt.Current.setRequireColor(!0),this.depthTextureUniform&&Lt.Current.setRequireDepth(!0)}onBeforeRender(t,i,s,r,o,a){r.attributes.tangent||r.computeTangents(),this.onUpdateUniforms(s,o)}onUpdateUniforms(t,i){const s=Lt.Current;if(t&&(Xi.viewProjection&&this.uniforms[this._viewProjectionName]&&(Xi.viewProjection.copy(t.projectionMatrix).multiply(t.matrixWorldInverse),Db(Xi.viewProjection,Xi._viewProjectionValues)),Xi.viewMatrix&&this.uniforms[this._viewMatrixName]&&(Xi.viewMatrix.copy(t.matrixWorldInverse),Db(Xi.viewMatrix,Xi._viewMatrixValues)),this.uniforms[Xi._worldSpaceCameraPosName]&&Xi._worldSpaceCameraPos.setFromMatrixPosition(t.matrixWorld)),this.uniforms._TimeParameters&&(this.uniforms._TimeParameters.value=s.sceneLighting.timeVec4),this.uniforms._Time){const c=this.uniforms._Time.value;c.x=s.sceneLighting.timeVec4.x/20,c.y=s.sceneLighting.timeVec4.x,c.z=s.sceneLighting.timeVec4.x*2,c.w=s.sceneLighting.timeVec4.x*3}if(this.uniforms._SinTime){const c=this.uniforms._SinTime.value;c.x=Math.sin(s.sceneLighting.timeVec4.x/8),c.y=Math.sin(s.sceneLighting.timeVec4.x/4),c.z=Math.sin(s.sceneLighting.timeVec4.x/2),c.w=Math.sin(s.sceneLighting.timeVec4.x)}if(this.uniforms._CosTime){const c=this.uniforms._CosTime.value;c.x=Math.cos(s.sceneLighting.timeVec4.x/8),c.y=Math.cos(s.sceneLighting.timeVec4.x/4),c.z=Math.cos(s.sceneLighting.timeVec4.x/2),c.w=Math.cos(s.sceneLighting.timeVec4.x)}if(this.uniforms.unity_DeltaTime){const c=this.uniforms.unity_DeltaTime.value;c.x=s.time.deltaTime,c.y=1/s.time.deltaTime,c.z=s.time.smoothedDeltaTime,c.w=1/s.time.smoothedDeltaTime}const r=s.mainLight;if(r){const c=Ht(r.gameObject,Xi._mainLightPosition);this.uniforms._MainLightPosition={value:c.normalize()},Xi._mainLightColor.set(r.color.r,r.color.g,r.color.b,0),this.uniforms._MainLightColor={value:Xi._mainLightColor};const l=r.intensity;Xi._lightData.z=l,this.uniforms.unity_LightData={value:Xi._lightData}}if(t&&(Xi.viewProjection&&this.uniforms[this._viewProjectionName]&&(this.uniforms[this._viewProjectionName].value=Xi._viewProjectionValues),Xi.viewMatrix&&this.uniforms[this._viewMatrixName]&&(this.uniforms[this._viewMatrixName].value=Xi._viewMatrixValues),this.uniforms[Xi._worldSpaceCameraPosName]&&(this.uniforms[Xi._worldSpaceCameraPosName]={value:Xi._worldSpaceCameraPos}),s.mainCameraComponent)){if(this.uniforms._ProjectionParams){const c=this.uniforms._ProjectionParams.value;c.x=1,c.y=s.mainCameraComponent.nearClipPlane,c.z=s.mainCameraComponent.farClipPlane,c.w=1/c.z,this.uniforms._ProjectionParams.value=c}if(this.uniforms._ZBufferParams){const c=this.uniforms._ZBufferParams.value,l=s.mainCameraComponent;c.x=1-l.farClipPlane/l.nearClipPlane,c.y=l.farClipPlane/l.nearClipPlane,c.z=c.x/l.farClipPlane,c.w=c.y/l.farClipPlane,this.uniforms._ZBufferParams.value=c}if(this.uniforms._ScreenParams){const c=this.uniforms._ScreenParams.value;c.x=s.domWidth,c.y=s.domHeight,c.z=1+1/c.x,c.w=1+1/c.y,this.uniforms._ScreenParams.value=c}}const o=this.depthTextureUniform;o&&(o.value=s.depthTexture);const a=this.opaqueTextureUniform;if(a&&(a.value=s.opaqueColorTexture),i){const c=this._rendererData;c.updateFrom(i),this.uniforms[this._worldToObjectName].value=c.worldToObject,this.uniforms[this._objToWorldName].value=c.objectToWorld}this.uniformsNeedUpdate=!0}};let yo=Xi;u(yo,"viewProjection",new Ce),u(yo,"_viewProjectionValues",[]),u(yo,"viewMatrix",new Ce),u(yo,"_viewMatrixValues",[]),u(yo,"_worldSpaceCameraPosName","_WorldSpaceCameraPos"),u(yo,"_worldSpaceCameraPos",new w),u(yo,"_mainLightColor",new tt),u(yo,"_mainLightPosition",new w),u(yo,"_lightData",new tt);class $ie{constructor(e,t){u(this,"parser");u(this,"identifier");this.parser=e,this.identifier=t}get name(){return pf}loadMaterial(e){const t=this.parser.json.materials[e];if(!t)return mh&&console.log(e,this.parser.json.materials),null;if(!t.extensions||!t.extensions[pf])return mh&&console.log("material "+e+" does not use NEEDLE_techniques_webgl"),null;const i=t.extensions[pf].technique;if(i<0)return null;const s=this.parser.json.extensions[pf];if(!s)return null;mh&&console.log(s);const r=s.techniques[i];return r?new Promise(async(o,a)=>{var A,v,b;const c=await kZ(s,r.program),l=c==null?void 0:c.fragmentShader,h=c==null?void 0:c.vertexShader;if(!l||!h)return a();mh&&console.log("loadMaterial",t,c);const d={},f=r.uniforms;(h.includes("_Time")||l.includes("_Time"))&&(d._Time={value:new tt(0,0,0,0)}),(h.includes("_SinTime")||l.includes("_SinTime"))&&(d._SinTime={value:new tt(0,0,0,0)}),(h.includes("_CosTime")||l.includes("_CosTime"))&&(d._CosTime={value:new tt(0,0,0,0)}),(h.includes("unity_DeltaTime")||l.includes("unity_DeltaTime"))&&(d.unity_DeltaTime={value:new tt(0,0,0,0)});for(const _ in f){const T=_;switch(T){case"_TimeParameters":const E=new tt;d[T]={value:E};break;case"hlslcc_mtx4x4unity_MatrixV":case"hlslcc_mtx4x4unity_MatrixVP":d[T]={value:[]};break;case"_MainLightPosition":case"_MainLightColor":case"_WorldSpaceCameraPos":d[T]={value:[0,0,0,1]};break;case"unity_OrthoParams":break;case"unity_SpecCube0":d[T]={value:null};break;default:case"_ScreenParams":case"_ZBufferParams":case"_ProjectionParams":d[T]={value:[0,0,0,0]};break;case"_CameraOpaqueTexture":case"_CameraDepthTexture":d[T]={value:null};break}}let p=!1;if(t.extensions&&t.extensions[pf]){const _=t.extensions[pf];if(_.technique===i){mh&&console.log(t.name,"Material Properties",_);for(const T in _.values){const E=_.values[T];if(typeof E=="string"){if(E.startsWith("/textures/")){const M=E.substring(10),I=Number.parseInt(M);if(I>=0){let S=await this.parser.getDependency("texture",I);S instanceof Ft&&(S=S.clone(),S.colorSpace=Ri,S.needsUpdate=!0),d[T]={value:S};continue}}switch(T){case"alphaMode":E==="BLEND"&&(p=!0);continue}}if(Array.isArray(E)&&E.length===4){d[T]={value:new tt(E[0],E[1],E[2],E[3])};continue}d[T]={value:E}}}}const m=new yo(this.identifier,{name:t.name??"",uniforms:d,vertexShader:h,fragmentShader:l,lights:!1});switch(m.glslVersion=ab,m.vertexShader=m.vertexShader.replace("#version 300 es",""),m.fragmentShader=m.fragmentShader.replace("#version 300 es",""),(A=d._Cull)==null?void 0:A.value){case Tg.Off:m.side=Ai;break;case Tg.Front:m.side=mn;break;case Tg.Back:m.side=Es;break;default:m.side=Es;break}switch((v=d._ZTest)==null?void 0:v.value){case Wc.Equal:m.depthTest=!0,m.depthFunc=hp;break;case Wc.NotEqual:m.depthTest=!0,m.depthFunc=BA;break;case Wc.Less:m.depthTest=!0,m.depthFunc=Vg;break;case Wc.LEqual:m.depthTest=!0,m.depthFunc=ld;break;case Wc.Greater:m.depthTest=!0,m.depthFunc=__;break;case Wc.GEqual:m.depthTest=!0,m.depthFunc=b_;break;case Wc.Always:m.depthTest=!1,m.depthFunc=y_;break}m.transparent=p,p&&(m.depthWrite=!1),DZ(d),m.onUpdateUniforms();for(const _ in f){const T=_,E=f[_].type;if(((b=d[T])==null?void 0:b.value)===void 0)switch(E){case GT.SAMPLER_2D:d[T]={value:PZ},console.warn("Missing/unassigned texture, fallback to white: "+T);break;default:T==="unity_OrthoParams"||console.warn("TODO: EXPECTED UNIFORM / fallback NOT SET: "+T,f[_]);break}}mh&&console.log(m.uuid,d),Jz(m),o(m)}):null}}function Jz(n){if(n.uniforms){mh&&console.log("Uniforms:",n.uniforms);for(const t in n.uniforms)switch(e(t,t),t){case"_Color":e("color",t);break}}function e(t,i){Object.getOwnPropertyDescriptor(n,t)||Object.defineProperty(n,t,{get:()=>n.uniforms[i].value,set:s=>{n.uniforms[i].value=s,n.needsUpdate=!0}})}}const ene=re("debugextensions");let t_;const tne=ux(()=>import("./GLTFLoaderAnimationPointer-1f7be9ad.js"),[],import.meta.url).then(async n=>(t_=n.GLTFAnimationPointerExtension,t_)).catch(n=>{console.warn("Failed to import GLTFLoaderAnimationPointer. Please use @needle-tools/three for full KHR_animation support",n)}),Kz=new Array;function Zz(n){const e=new Yie;return n.register(t=>(e.parser=t,e)),e}class ine{resolvePath(e){return e.includes("/extensions/builtin_components/")?e.replace("/extensions/builtin_components/","/userData/components/"):e.includes("extensions/builtin_components/")?e.replace("extensions/builtin_components/","/userData/components/"):e}}async function nne(n,e,t){const i=t.lastIndexOf("?");i>=0&&(t=t.substring(0,i)),n.register(s=>new Jie(s)),n.register(s=>new aq(s)),n.register(s=>new Jq(s,e.lightmaps,t)),n.register(s=>new Kie(s,t,e)),n.register(s=>new $ie(s,t)),n.register(s=>new vg(s,t)),n.register(s=>new Eo(s,t,e)),n.register(s=>new jie(s)),L8()&&n.register(s=>new cg(s));for(const s of Kz)s.onImport&&s.onImport(n,t,e);await tne.catch(s=>{}),n.register(s=>{if(t_){const r=new t_(s);return r.setAnimationPointerResolver.bind(r)(new ine),r}else return(ene||Tt())&&console.error("Missing KHR_animation_pointer extension..."),{name:"KHR_animation_pointer_NOT_AVAILABLE"}})}function sne(n,e){for(const t of Kz)t.onExport&&t.onExport(n,e)}class rne{constructor(e){this.writer=e,this.name="EXT_mesh_gpu_instancing"}writeNode(e,t){if(e.constructor.name!=="InstancedMesh")return;const i=this.writer,s=i.extensionsUsed,r={};t.extensions=t.extensions||{},t.extensions[this.name]=r;let o=new Ce;const a=new Array,c=new Array,l=new Array;for(let p=0;p<e.count;p++){e.getMatrixAt(p,o);let m=new w,g=new Me,y=new w;o.decompose(m,g,y),a.push(m.x,m.y,m.z),c.push(g.x,g.y,g.z,g.w),l.push(y.x,y.y,y.z)}const h=new Float32Array(a),d=new Float32Array(c),f=new Float32Array(l);r.attributes={TRANSLATION:i.processAccessor(new it(h,3)),ROTATION:i.processAccessor(new it(d,4)),SCALE:i.processAccessor(new it(f,3))},s[this.name]=!0}}var $z=globalThis&&globalThis.__decorate||function(n,e,t,i){var s=arguments.length,r=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(e,t,r):o(e,t))||r);return s>3&&r&&Object.defineProperty(e,t,r),r};const o0=re("debuggltfexport");class eG extends ra{constructor(){super(...arguments);u(this,"sceneRoot")}}class Ka extends Te{constructor(){super(...arguments);u(this,"binary",!0);u(this,"objects",[]);u(this,"ext")}async exportNow(t){o0&&console.log("Exporting objects as glTF",this.objects),t||(t="scene"),(!this.objects||this.objects.length<=0)&&(this.objects=[this.context.scene]);const i={binary:this.binary,pivot:Ka.calculateCenter(this.objects)},s=await this.export(this.objects,i).catch(r=>(console.error(r),!1));return s===!1?!1:(this.binary?t.endsWith(".glb")||(t+=".glb"):t.endsWith(".gltf")||(t+=".gltf"),this.binary?Ka.saveArrayBuffer(s,t):Ka.saveJson(s,t),!0)}async export(t,i){if(!t||t.length<=0){console.warn("No objects set to export");return}const s=new zI;s.register(l=>new rne(l)),sne(s,this.context),Ka.filterTopmostParent(t);const r={trs:!1,onlyVisible:!0,truncateDrawRange:!1,binary:!0,maxTextureSize:1/0,embedImages:!0,includeCustomExtensions:!0,animations:(i==null?void 0:i.animations)||Ka.collectAnimations(t),...i},o=new ge;i!=null&&i.pivot&&o.position.sub(i.pivot),o0&&console.log("EXPORT",t),t.forEach(l=>{l&&(o.children.push(l),l.matrixAutoUpdate=!1,l.matrix.copy(l.matrixWorld),le.getComponentsInChildren(l,an).forEach(h=>{le.isActiveInHierarchy(h.gameObject)&&h.setInstancingEnabled(!1)}))});const a=new WF(o);return this.ext&&(this.ext.context=a),new Promise((l,h)=>{o0&&console.log("Starting glTF export.");try{s==null||s.parse(o,d=>{c(),l(d)},d=>{c(),h(d)},r)}catch(d){console.error(d),h(d)}finally{o0&&console.log("Finished glTF export.")}});function c(){t.forEach(l=>{l&&(l.matrixAutoUpdate=!0,le.getComponentsInChildren(l,an).forEach(h=>{le.isActiveInHierarchy(h.gameObject)&&h.setInstancingEnabled(!1)}))})}}static saveArrayBuffer(t,i){this.save(new Blob([t],{type:"application/octet-stream"}),i)}static saveJson(t,i){this.save("data: text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(t)),i)}static save(t,i){const s=document.createElement("a");s.style.display="none",document.body.appendChild(s),typeof t=="string"?s.href=t:s.href=URL.createObjectURL(t),s.download=i,s.click(),s.remove()}static collectAnimations(t,i){i=i||[];for(const s of t)s&&s.traverseVisible(r=>{r.animations&&r.animations.length>0&&i.push(...r.animations)});return i}static calculateCenter(t,i){const s=i||new w;return s.set(0,0,0),t.forEach(r=>{s.add(Ht(r))}),console.log(s),s.divideScalar(t.length),s}static filterTopmostParent(t){if(!(t.length<=0))for(let i=0;i<t.length;i++){let s=t[i];if(!s){t.splice(i,1),i--;continue}for(;s.parent;){if(t.includes(s.parent)){t.splice(i,1),i--;break}s=s.parent}}}}$z([x()],Ka.prototype,"binary",void 0);$z([x(ge)],Ka.prototype,"objects",void 0);var GI=globalThis&&globalThis.__decorate||function(n,e,t,i){var s=arguments.length,r=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(e,t,r):o(e,t))||r);return s>3&&r&&Object.defineProperty(e,t,r),r};class _v extends Te{constructor(){super(...arguments);u(this,"isGizmo",!1);u(this,"color0");u(this,"color1");u(this,"gridHelper");u(this,"size");u(this,"divisions");u(this,"offset")}onEnable(){if(this.isGizmo&&!jA)return;const t=this.size,i=this.divisions;this.gridHelper||(this.gridHelper=new ex(t,i,this.color0??new ye(.4,.4,.4),this.color1??new ye(.6,.6,.6)),this.offset!==void 0&&(this.gridHelper.position.y+=this.offset)),this.gridHelper&&this.gameObject.add(this.gridHelper)}onDisable(){this.gridHelper&&(this.gameObject.remove(this.gridHelper),this.gridHelper=null)}}GI([x()],_v.prototype,"isGizmo",void 0);GI([x(ye)],_v.prototype,"color0",void 0);GI([x(ye)],_v.prototype,"color1",void 0);var nw=globalThis&&globalThis.__decorate||function(n,e,t,i){var s=arguments.length,r=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(e,t,r):o(e,t))||r);return s>3&&r&&Object.defineProperty(e,t,r),r};const one=re("debuggroundprojection");class Kp extends Te{constructor(){super(...arguments);u(this,"applyOnAwake",!1);u(this,"_scale",20);u(this,"_radius",100);u(this,"_height",100);u(this,"_lastEnvironment");u(this,"env");u(this,"_watcher")}set scale(t){var i;this._scale=t,(i=this.env)==null||i.scale.setScalar(t)}get scale(){return this._scale}set radius(t){this._radius=t,this.env&&(this.env.radius=t)}get radius(){return this._radius}set height(t){this._height=t,this.env&&(this.env.height=t)}get height(){return this._height}awake(){this.applyOnAwake&&this.updateAndCreate()}onEnable(){this.context.time.frameCount>0&&this.applyOnAwake&&this.updateAndCreate(),this._watcher||(this._watcher=new Rh(this.context.scene,"environment"),this._watcher.subscribeWrite(t=>{this.updateProjection()}))}onDisable(){var t,i;(t=this._watcher)==null||t.revoke(),(i=this.env)==null||i.removeFromParent()}updateAndCreate(){var t;this.updateProjection(),(t=this._watcher)==null||t.apply()}updateProjection(){var t;if(!this.context.scene.environment){(t=this.env)==null||t.removeFromParent();return}(!this.env||this.context.scene.environment!==this._lastEnvironment)&&(one&&console.log("Create/Update Ground Projection",this.context.scene.environment.name),this.env=new Sz(this.context.scene.environment,this._height,this.radius,32),this.env.position.y=this._height),this._lastEnvironment=this.context.scene.environment,this.env.parent||this.gameObject.add(this.env),this.env.isObject3D===!0&&this.env.layers.set(2)}}nw([x()],Kp.prototype,"applyOnAwake",void 0);nw([x()],Kp.prototype,"scale",null);nw([x()],Kp.prototype,"radius",null);nw([x()],Kp.prototype,"height",null);var sw=globalThis&&globalThis.__decorate||function(n,e,t,i){var s=arguments.length,r=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(e,t,r):o(e,t))||r);return s>3&&r&&Object.defineProperty(e,t,r),r};const xu=re("debuginputfield"),bt=class extends Te{constructor(){super(...arguments);u(this,"textComponent");u(this,"placeholder");u(this,"onValueChanged");u(this,"onEndEdit");u(this,"inputEventFn");u(this,"_iosEventFn")}get text(){var t;return((t=this.textComponent)==null?void 0:t.text)??""}get isFocused(){return bt.active===this}start(){xu&&console.log(this.name,this)}onEnable(){var t;bt.htmlField||(bt.htmlField=document.createElement("input"),bt.htmlField.style.width="0px",bt.htmlField.style.height="0px",bt.htmlField.style.padding="0px",bt.htmlField.style.border="none",bt.htmlField.style.overflow="hidden",bt.htmlField.style.caretColor="transparent",bt.htmlField.style.outline="none",bt.htmlField.classList.add("ar"),document.body.append(bt.htmlField)),this.inputEventFn||(this.inputEventFn=this.onInput.bind(this)),bt.htmlField.addEventListener("keyup",this.inputEventFn),this.placeholder&&((t=this.textComponent)!=null&&t.text.length)&&le.setActive(this.placeholder.gameObject,!1),QA()&&(this._iosEventFn=this.processInputOniOS.bind(this),window.addEventListener("touchend",this._iosEventFn))}onDisable(){var t;(t=bt.htmlField)==null||t.removeEventListener("keyup",this.inputEventFn),this.onDeselected(),this._iosEventFn&&window.removeEventListener("touchend",this._iosEventFn)}clear(){bt.active===this&&bt.htmlField?(bt.htmlField.value="",this.setTextFromInputField()):(this.textComponent&&(this.textComponent.text=""),this.placeholder&&le.setActive(this.placeholder.gameObject,!0))}select(){this.onSelected()}deselect(){this.onDeselected()}onPointerClick(t){xu&&console.log("CLICK",t,bt.active),bt.activeTime=this.context.time.time,bt.active!==this&&this.startCoroutine(this.activeLoop(),jt.LateUpdate),this.selectInputField()}*activeLoop(){for(this.onSelected();bt.active===this&&!(this.context.input.getPointerUp(0)&&this.context.time.time-bt.activeTime>.2);)this.setTextFromInputField(),yield;this.onDeselected()}onSelected(){var t,i,s,r;if(bt.active!==this&&(xu&&console.log("Select",this.name,this,bt.htmlField,this.context.isInXR,this.context.arOverlayElement,(t=this.textComponent)==null?void 0:t.text,(i=bt.htmlField)==null?void 0:i.value),(s=bt.active)==null||s.onDeselected(),bt.active=this,this.placeholder&&le.setActive(this.placeholder.gameObject,!1),bt.htmlField)){if(bt.htmlField.value=((r=this.textComponent)==null?void 0:r.text)||"",xu&&console.log("set input field value",bt.htmlField.value),this.context.isInXR){const o=this.context.arOverlayElement;o&&o.append(bt.htmlField)}this.selectInputField()}}onDeselected(){var t;bt.active===this&&(bt.active=null,xu&&console.log("Deselect",this.name,this),bt.htmlField&&(bt.htmlField.blur(),document.body.append(bt.htmlField)),this.placeholder&&(!this.textComponent||this.textComponent.text.length<=0)&&le.setActive(this.placeholder.gameObject,!0),bt.htmlField&&((t=this.onEndEdit)==null||t.invoke(bt.htmlField.value)))}update(){var t;bt.active===this&&((t=this.textComponent)==null||t.markDirty())}onInput(t){var i,s;if(bt.active===this){if(xu&&console.log(t.code,t,(i=bt.htmlField)==null?void 0:i.value,(s=this.textComponent)==null?void 0:s.text),t.code==="Escape"||t.code==="Enter"){this.onDeselected();return}bt.htmlField&&(this.textComponent&&(this.setTextFromInputField(),this.placeholder&&le.setActive(this.placeholder.gameObject,this.textComponent.text.length<=0)),this.selectInputField())}}setTextFromInputField(){var t;if(this.textComponent&&bt.htmlField){if(this.textComponent.text!==bt.htmlField.value){xu&&console.log("VALUE CHANGED");const i=this.textComponent.text,s=bt.htmlField.value;(t=this.onValueChanged)==null||t.invoke(s,i)}this.textComponent.text=bt.htmlField.value}}selectInputField(){bt.htmlField&&(bt.htmlField.setSelectionRange(bt.htmlField.value.length,bt.htmlField.value.length),bt.htmlField.focus())}processInputOniOS(){const t=this.context.physics.raycast();if(!t.length)return;const s=t[0].object,r=dI(s);((r==null?void 0:r.gameObject)===this.gameObject||(r==null?void 0:r.gameObject.parent)===this.gameObject)&&this.selectInputField()}};let aa=bt;u(aa,"active",null),u(aa,"activeTime",-1),u(aa,"htmlField",null);sw([x(er)],aa.prototype,"textComponent",void 0);sw([x(er)],aa.prototype,"placeholder",void 0);sw([x(Cs)],aa.prototype,"onValueChanged",void 0);sw([x(Cs)],aa.prototype,"onEndEdit",void 0);var Cc=globalThis&&globalThis.__decorate||function(n,e,t,i){var s=arguments.length,r=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(e,t,r):o(e,t))||r);return s>3&&r&&Object.defineProperty(e,t,r),r};function CC(n){return n*Math.PI/180}const ok=300,oh=re("debuglights");var qc;(function(n){n[n.Spot=0]="Spot",n[n.Directional=1]="Directional",n[n.Point=2]="Point",n[n.Area=3]="Area",n[n.Rectangle=3]="Rectangle",n[n.Disc=4]="Disc"})(qc||(qc={}));var i_;(function(n){n[n.Realtime=4]="Realtime",n[n.Baked=2]="Baked",n[n.Mixed=1]="Mixed"})(i_||(i_={}));var Mg;(function(n){n[n.None=0]="None",n[n.Hard=1]="Hard",n[n.Soft=2]="Soft"})(Mg||(Mg={}));class lo extends Te{constructor(){super(...arguments);u(this,"type",0);u(this,"range",1);u(this,"spotAngle",1);u(this,"innerSpotAngle",1);u(this,"_color",new ye(16777215));u(this,"_shadowNearPlane",.1);u(this,"_shadowBias",0);u(this,"_shadowNormalBias",0);u(this,"_overrideShadowBiasSettings",!1);u(this,"_shadows",1);u(this,"lightmapBakeType",i_.Realtime);u(this,"_intensity",-1);u(this,"_shadowDistance");u(this,"shadowWidth");u(this,"shadowHeight");u(this,"_shadowResolution");u(this,"light");u(this,"_webXRStartedListener");u(this,"_webXREndedListener");u(this,"_webARRoot")}set color(t){this._color=t,this.light!==void 0&&(this.light.color=t)}get color(){return this.light?this.light.color:this._color}set shadowNearPlane(t){var i,s;if(t!==this._shadowNearPlane&&(this._shadowNearPlane=t,((s=(i=this.light)==null?void 0:i.shadow)==null?void 0:s.camera)!==void 0)){const r=this.light.shadow.camera;r.near=t}}get shadowNearPlane(){return this._shadowNearPlane}set shadowBias(t){var i,s;t!==this._shadowBias&&(this._shadowBias=t,((s=(i=this.light)==null?void 0:i.shadow)==null?void 0:s.bias)!==void 0&&(this.light.shadow.bias=t,this.light.shadow.needsUpdate=!0))}get shadowBias(){return this._shadowBias}set shadowNormalBias(t){var i,s;t!==this._shadowNormalBias&&(this._shadowNormalBias=t,((s=(i=this.light)==null?void 0:i.shadow)==null?void 0:s.normalBias)!==void 0&&(this.light.shadow.normalBias=t,this.light.shadow.needsUpdate=!0))}get shadowNormalBias(){return this._shadowNormalBias}set shadows(t){this._shadows=t,this.light&&(this.light.castShadow=t!==Mg.None,this.updateShadowSoftHard())}get shadows(){return this._shadows}set intensity(t){var i;if(this._intensity=t,this.light){let s=1;if(this.context.isInXR&&this._webARRoot){const r=(i=this._webARRoot)==null?void 0:i.arScale;typeof r=="number"&&r>0&&(s/=r)}this.light.intensity=t*s}oh&&console.log("Set light intensity to "+this._intensity,t,this)}get intensity(){return this._intensity}get shadowDistance(){const t=this.light;return t!=null&&t.shadow?t.shadow.camera.far:-1}set shadowDistance(t){this._shadowDistance=t;const i=this.light;if(i!=null&&i.shadow){const s=i.shadow.camera;s.far=t,s.updateProjectionMatrix()}}get shadowResolution(){const t=this.light;return t!=null&&t.shadow?t.shadow.mapSize.x:-1}set shadowResolution(t){if(t===this._shadowResolution)return;this._shadowResolution=t;const i=this.light;i!=null&&i.shadow&&(i.shadow.mapSize.set(t,t),i.shadow.needsUpdate=!0)}get isBaked(){return this.lightmapBakeType===i_.Baked}get selfIsLight(){if(this.gameObject.isLight===!0)return!0;switch(this.gameObject.type){case"SpotLight":case"PointLight":case"DirectionalLight":return!0}return!1}getWorldPosition(t){return this.light?this.type===qc.Directional?this.light.getWorldPosition(t).multiplyScalar(1):this.light.getWorldPosition(t):t}awake(){this.color=new ye(this.color??16777215),oh&&console.log(this.name,this)}onEnable(){oh&&console.log("ENABLE LIGHT",this.name),this.createLight(),!this.isBaked&&(this.light&&(this.light.visible=!0,this.light.intensity=this._intensity,oh&&console.log("Set light intensity to "+this.light.intensity,this.name),this.selfIsLight||this.light.parent!==this.gameObject&&this.gameObject.add(this.light)),this.type===qc.Directional&&this.startCoroutine(this.updateMainLightRoutine(),jt.LateUpdate))}onDisable(){oh&&console.log("DISABLE LIGHT",this.name),this.light&&(this.selfIsLight?this.light.intensity=0:this.light.visible=!1)}onEnterXR(t){this._webARRoot=le.getComponentInParent(this.gameObject,zo)??void 0}onLeaveXR(t){}createLight(){const t=this.selfIsLight;if(t&&!this.light)switch(this.light=this.gameObject,this.light.name=this.name,this._intensity=this.light.intensity,this.type){case qc.Directional:this.setDirectionalLight(this.light);break}else if(!this.light)switch(this.type){case qc.Directional:const i=new mp(this.color,this.intensity*Math.PI);if(i.position.set(0,0,-ok*.5).applyQuaternion(this.gameObject.quaternion),this.gameObject.add(i.target),vA(i.target,0,0,0),this.light=i,this.gameObject.position.set(0,0,0),this.gameObject.rotation.set(0,0,0),oh){const a=new sF(this.light,.2,this.color);this.context.scene.add(a)}break;case qc.Spot:const s=new Y_(this.color,this.intensity*Math.PI,this.range,CC(this.spotAngle/2),1-CC(this.innerSpotAngle/2)/CC(this.spotAngle/2),2);s.position.set(0,0,0),s.rotation.set(0,0,0),this.light=s;const r=s.target;s.add(r),r.position.set(0,0,this.range),r.rotation.set(0,0,0);break;case qc.Point:const o=new J_(this.color,this.intensity*Math.PI,this.range);this.light=o;break}if(this.light){if(this._intensity>=0?this.light.intensity=this._intensity:this._intensity=this.light.intensity,this.shadows!==Mg.None?this.light.castShadow=!0:this.light.castShadow=!1,this.light.shadow){this._shadowResolution!==void 0&&this._shadowResolution>4?(this.light.shadow.mapSize.width=this._shadowResolution,this.light.shadow.mapSize.height=this._shadowResolution):(this.light.shadow.mapSize.width=2048,this.light.shadow.mapSize.height=2048),oh&&console.log("Override shadow bias?",this._overrideShadowBiasSettings,this.shadowBias,this.shadowNormalBias),this.light.shadow.bias=this.shadowBias,this.light.shadow.normalBias=this.shadowNormalBias,this.updateShadowSoftHard();const i=this.light.shadow.camera;if(i.near=this.shadowNearPlane,this._shadowDistance!==void 0&&typeof this._shadowDistance=="number"?i.far=this._shadowDistance:i.far=ok*Math.abs(this.gameObject.scale.z),this.gameObject.scale.set(1,1,1),this.shadowWidth!==void 0)i.left=-this.shadowWidth/2,i.right=this.shadowWidth/2;else{const s=this.gameObject.scale.x;i.left*=s,i.right*=s}if(this.shadowHeight!==void 0)i.top=this.shadowHeight/2,i.bottom=-this.shadowHeight/2;else{const s=this.gameObject.scale.y;i.top*=s,i.bottom*=s}this.light.shadow.needsUpdate=!0,oh&&this.context.scene.add(new rF(i))}this.isBaked?this.light.removeFromParent():t||this.gameObject.add(this.light)}}*updateMainLightRoutine(){for(;;){this.type===qc.Directional&&((!this.context.mainLight||this.intensity>this.context.mainLight.intensity)&&(this.context.mainLight=this),yield);break}}updateShadowSoftHard(){this.light&&this.light.shadow&&(this.shadows===Mg.Soft||(this.light.shadow.radius=1,this.light.shadow.blurSamples=1))}setDirectionalLight(t){t.add(t.target),t.target.position.set(0,0,-1)}}u(lo,"allowChangingRendererShadowMapType",!0);Cc([x()],lo.prototype,"type",void 0);Cc([x(ye)],lo.prototype,"color",null);Cc([x()],lo.prototype,"shadowNearPlane",null);Cc([x()],lo.prototype,"shadowBias",null);Cc([x()],lo.prototype,"shadowNormalBias",null);Cc([x()],lo.prototype,"shadows",null);Cc([x()],lo.prototype,"lightmapBakeType",void 0);Cc([x()],lo.prototype,"intensity",null);Cc([x()],lo.prototype,"shadowDistance",null);Cc([x()],lo.prototype,"shadowResolution",null);new w(0,0,0);var xv=globalThis&&globalThis.__decorate||function(n,e,t,i){var s=arguments.length,r=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(e,t,r):o(e,t))||r);return s>3&&r&&Object.defineProperty(e,t,r),r};const EC=re("debuglods"),ane=re("nolods");var VT;(function(n){n[n.None=0]="None",n[n.CrossFade=1]="CrossFade",n[n.SpeedTree=2]="SpeedTree"})(VT||(VT={}));class Zp{constructor(){u(this,"screenRelativeTransitionHeight");u(this,"distance");u(this,"renderers")}}xv([x()],Zp.prototype,"screenRelativeTransitionHeight",void 0);xv([x()],Zp.prototype,"distance",void 0);xv([x(an)],Zp.prototype,"renderers",void 0);class cne{constructor(e){u(this,"model");this.model=e}get renderers(){return this.model.renderers}}class rw extends Te{constructor(){super(...arguments);u(this,"fadeMode",VT.None);u(this,"localReferencePoint");u(this,"lodCount",0);u(this,"size",0);u(this,"animateCrossFading",!1);u(this,"lodModels");u(this,"_lods",[]);u(this,"_settings",[]);u(this,"_lodsHandler");u(this,"_distanceFactor",1)}start(){if(EC&&console.log("LODGROUP",this.name,this.lodModels,this),!ane&&!this._lodsHandler&&this.gameObject&&this.lodModels&&Array.isArray(this.lodModels)){const t=[];for(const s of this.lodModels){const r=new cne(s);this._lods.push(r);for(const o of r.renderers)t.includes(o)||t.push(o)}this._lodsHandler=new Array;for(let s=0;s<t.length;s++){const r=new TM;this._lodsHandler.push(r),this.gameObject.add(r)}const i=new ge;i.name="Cull "+this.name;for(let s=0;s<t.length;s++){const r=t[s],o=this._lodsHandler[s],a=r.gameObject;EC&&console.log(s,a.name);for(const c of this._lods){const l=c.model.distance;let h=null;if(c.renderers.includes(r)?h=a:h=i,h.type==="Group"){console.warn(`LODGroup ${this.name}: Group or MultiMaterial object's are not supported as LOD object: ${h.name}`);continue}EC&&console.log("LEVEL",h.name,l),o.autoUpdate=!1,this.onAddLodLevel(o,h,c.model.distance)}}}}onAfterRender(){if(!this.gameObject||!this._lodsHandler)return;const t=this.context.mainCamera;if(t)for(const i of this._lodsHandler)i.update(t)}onAddLodLevel(t,i,s){if(i===this.gameObject){console.warn("LODGroup component must be on parent object and not mesh directly at the moment",i.name,i);return}t.addLevel(i,s*this._distanceFactor,.01);const r={lod:t,levelIndex:t.levels.length-1,distance:s};this._settings.push(r)}distanceFactor(t){if(t!==this._distanceFactor){this._distanceFactor=t;for(const i of this._settings){const s=i.lod.levels[i.levelIndex];s.distance=i.distance*t}}}}xv([x(w)],rw.prototype,"localReferencePoint",void 0);xv([x(Zp)],rw.prototype,"lodModels",void 0);const lne=re("logstats");class tG extends Te{onEnable(){console.log(this),lne&&this.startCoroutine(this.run(),jt.OnAfterRender)}*run(){for(;this.enabled;){const e=this.context.renderer.info;console.log(e.memory,e.render,e.programs),yield}}}var ow=globalThis&&globalThis.__decorate||function(n,e,t,i){var s=arguments.length,r=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(e,t,r):o(e,t))||r);return s>3&&r&&Object.defineProperty(e,t,r),r};const gR=class extends Te{constructor(){super(...arguments);u(this,"target");u(this,"invertForward",!1);u(this,"keepUpDirection",!0);u(this,"copyTargetRotation",!1)}onBeforeRender(){let t=this.target;t||(t=this.context.mainCamera),t&&(_3(this.gameObject,t,this.keepUpDirection,this.copyTargetRotation),this.invertForward&&this.gameObject.quaternion.multiply(gR.flipYQuat))}createBehaviours(t,i,s){if(i.uuid===this.gameObject.uuid){let r=i;if(this.keepUpDirection){const a=Zr.createEmptyParent(i);r=a;const c=this.invertForward?-1:1;a.matrix.multiply(new Ce().makeRotationZ(Math.PI/2*c)),i.matrix.multiply(new Ce().makeRotationZ(-Math.PI/2*c))}const o=new ss("lookat "+this.name,js.sceneStartTrigger(),di.lookAtCameraAction(r,void 0,this.invertForward?kf.back:kf.forward,this.keepUpDirection?kf.up:kf.zero));t.addBehavior(o)}}};let yl=gR;u(yl,"flipYQuat",new Me().setFromAxisAngle(new w(0,1,0),Math.PI));ow([x(ge)],yl.prototype,"target",void 0);ow([x()],yl.prototype,"invertForward",void 0);ow([x()],yl.prototype,"keepUpDirection",void 0);ow([x()],yl.prototype,"copyTargetRotation",void 0);var hne=globalThis&&globalThis.__decorate||function(n,e,t,i){var s=arguments.length,r=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(e,t,r):o(e,t))||r);return s>3&&r&&Object.defineProperty(e,t,r),r};const a0=re("debugnestedgltf");class VI extends Te{constructor(){super(...arguments);u(this,"filePath");u(this,"_isLoadingOrDoneLoading",!1)}listenToProgress(t){var i;(i=this.filePath)==null||i.beginListenDownload(t)}preload(){var t;(t=this.filePath)==null||t.preload()}async start(){var i,s,r,o,a;if(this._isLoadingOrDoneLoading)return;a0&&console.log(this,this.guid);const t=this.gameObject.parent;if(t){this._isLoadingOrDoneLoading=!0;const c=new _c;c.idProvider=new Ss(this.hash(this.guid)),c.parent=t,this.gameObject.updateMatrix();const l=this.gameObject.matrix;a0&&console.log("Load nested:",((i=this.filePath)==null?void 0:i.uri)??this.filePath,this.gameObject.position);const h=await((r=(s=this.filePath)==null?void 0:s.instantiate)==null?void 0:r.call(this.filePath,c));a0&&console.log("Nested loaded:",((o=this.filePath)==null?void 0:o.uri)??this.filePath,h),h&&(h.matrixAutoUpdate=!1,h.matrix.identity(),h.applyMatrix4(l),h.matrixAutoUpdate=!0,h.layers.disableAll(),h.layers.set(this.layer),this.dispatchEvent(new CustomEvent("loaded",{detail:{instance:h,assetReference:this.filePath}}))),a0&&console.log("Nested loading done:",((a=this.filePath)==null?void 0:a.uri)??this.filePath,h)}}onDestroy(){var t;(t=this.filePath)==null||t.unload()}hash(t){let i=0;for(let s=0;s<t.length;s++)i=t.charCodeAt(s)+((i<<5)-i);return i}}hne([x(ii)],VI.prototype,"filePath",void 0);var aw=globalThis&&globalThis.__decorate||function(n,e,t,i){var s=arguments.length,r=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(e,t,r):o(e,t))||r);return s>3&&r&&Object.defineProperty(e,t,r),r};class $p extends Te{constructor(){super(...arguments);u(this,"referenceSpace");u(this,"from");u(this,"affectPosition",!1);u(this,"affectRotation",!1);u(this,"alignLookDirection",!1);u(this,"levelLookDirection",!1);u(this,"levelPosition",!1);u(this,"positionOffset",new w(0,0,0));u(this,"rotationOffset",new w(0,0,0));u(this,"offset",new w(0,0,0))}update(){if(!this.from)return;var t=Ht(this.from),i=In(this.from);this.offset.copy(this.positionOffset);const s=this.offset.length();if(this.referenceSpace&&this.offset.transformDirection(this.referenceSpace.matrixWorld).multiplyScalar(s),t.add(this.offset),this.levelPosition&&this.referenceSpace){const c=new hr(this.gameObject.up,0),l=Ht(this.referenceSpace);c.setFromNormalAndCoplanarPoint(this.gameObject.up,l);const h=new w(0,0,0);c.projectPoint(t,h),t.copy(h)}this.affectPosition&&vr(this.gameObject,t);const r=new ws(this.rotationOffset.x,this.rotationOffset.y,this.rotationOffset.z),o=new Me().setFromEuler(r);this.affectRotation&&fa(this.gameObject,i.multiply(o));const a=new w;this.from.getWorldDirection(a).multiplyScalar(50),this.levelLookDirection&&(a.y=0),this.alignLookDirection&&this.gameObject.lookAt(a)}}aw([x(le)],$p.prototype,"referenceSpace",void 0);aw([x(le)],$p.prototype,"from",void 0);aw([x(w)],$p.prototype,"positionOffset",void 0);aw([x(w)],$p.prototype,"rotationOffset",void 0);var HI=globalThis&&globalThis.__decorate||function(n,e,t,i){var s=arguments.length,r=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(e,t,r):o(e,t))||r);return s>3&&r&&Object.defineProperty(e,t,r),r},Vf;(function(n){n[n.NewTab=0]="NewTab",n[n.SameTab=1]="SameTab",n[n.NewWindow=2]="NewWindow"})(Vf||(Vf={}));class wv extends Te{constructor(){super(...arguments);u(this,"clickable",!0);u(this,"url");u(this,"mode",Vf.NewTab)}async open(){if(!this.url){console.warn("OpenURL: URL is not set, can't open.",this);return}switch(this._validateUrl(),Tt()&&Tn("Open URL: "+this.url),this.mode){case Vf.NewTab:og()?globalThis.open(this.url,"_blank"):globalThis.open(this.url,"_blank");break;case Vf.SameTab:og()&&QA()?globalThis.open(this.url,"_top"):globalThis.open(this.url,"_self");break;case Vf.NewWindow:og()?globalThis.open(this.url,"_top"):globalThis.open(this.url,"_new");break}}start(){this.gameObject.getComponentInParent(No)||this.gameObject.addNewComponent(No)}onPointerEnter(t){!t.used&&this.clickable&&this.context.input.setCursorPointer()}onPointerExit(){this.clickable&&this.context.input.setCursorNormal()}onPointerClick(t){var i;this.clickable&&!t.used&&((i=this.url)!=null&&i.length)&&this.open()}_validateUrl(){this.url&&this.url.startsWith("www.")&&(Tt()&&console.warn("URL is not valid, adding https:// to the start of the URL",this.url),this.url="https://"+this.url)}}HI([x()],wv.prototype,"clickable",void 0);HI([x()],wv.prototype,"url",void 0);HI([x()],wv.prototype,"mode",void 0);function une(n,e){var t=n==null?null:typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(t!=null){var i,s,r,o,a=[],c=!0,l=!1;try{if(r=(t=t.call(n)).next,e===0){if(Object(t)!==t)return;c=!1}else for(;!(c=(i=r.call(t)).done)&&(a.push(i.value),a.length!==e);c=!0);}catch(h){l=!0,s=h}finally{try{if(!c&&t.return!=null&&(o=t.return(),Object(o)!==o))return}finally{if(l)throw s}}return a}}function HT(){HT=function(){return e};var n,e={},t=Object.prototype,i=t.hasOwnProperty,s=Object.defineProperty||function(O,U,H){O[U]=H.value},r=typeof Symbol=="function"?Symbol:{},o=r.iterator||"@@iterator",a=r.asyncIterator||"@@asyncIterator",c=r.toStringTag||"@@toStringTag";function l(O,U,H){return Object.defineProperty(O,U,{value:H,enumerable:!0,configurable:!0,writable:!0}),O[U]}try{l({},"")}catch{l=function(U,H,Y){return U[H]=Y}}function h(O,U,H,Y){var J=U&&U.prototype instanceof A?U:A,se=Object.create(J.prototype),fe=new L(Y||[]);return s(se,"_invoke",{value:C(O,H,fe)}),se}function d(O,U,H){try{return{type:"normal",arg:O.call(U,H)}}catch(Y){return{type:"throw",arg:Y}}}e.wrap=h;var f="suspendedStart",p="suspendedYield",m="executing",g="completed",y={};function A(){}function v(){}function b(){}var _={};l(_,o,function(){return this});var T=Object.getPrototypeOf,E=T&&T(T(V([])));E&&E!==t&&i.call(E,o)&&(_=E);var M=b.prototype=A.prototype=Object.create(_);function I(O){["next","throw","return"].forEach(function(U){l(O,U,function(H){return this._invoke(U,H)})})}function S(O,U){function H(J,se,fe,_e){var Oe=d(O[J],O,se);if(Oe.type!=="throw"){var qe=Oe.arg,ae=qe.value;return ae&&typeof ae=="object"&&i.call(ae,"__await")?U.resolve(ae.__await).then(function(ve){H("next",ve,fe,_e)},function(ve){H("throw",ve,fe,_e)}):U.resolve(ae).then(function(ve){qe.value=ve,fe(qe)},function(ve){return H("throw",ve,fe,_e)})}_e(Oe.arg)}var Y;s(this,"_invoke",{value:function(J,se){function fe(){return new U(function(_e,Oe){H(J,se,_e,Oe)})}return Y=Y?Y.then(fe,fe):fe()}})}function C(O,U,H){var Y=f;return function(J,se){if(Y===m)throw new Error("Generator is already running");if(Y===g){if(J==="throw")throw se;return{value:n,done:!0}}for(H.method=J,H.arg=se;;){var fe=H.delegate;if(fe){var _e=D(fe,H);if(_e){if(_e===y)continue;return _e}}if(H.method==="next")H.sent=H._sent=H.arg;else if(H.method==="throw"){if(Y===f)throw Y=g,H.arg;H.dispatchException(H.arg)}else H.method==="return"&&H.abrupt("return",H.arg);Y=m;var Oe=d(O,U,H);if(Oe.type==="normal"){if(Y=H.done?g:p,Oe.arg===y)continue;return{value:Oe.arg,done:H.done}}Oe.type==="throw"&&(Y=g,H.method="throw",H.arg=Oe.arg)}}}function D(O,U){var H=U.method,Y=O.iterator[H];if(Y===n)return U.delegate=null,H==="throw"&&O.iterator.return&&(U.method="return",U.arg=n,D(O,U),U.method==="throw")||H!=="return"&&(U.method="throw",U.arg=new TypeError("The iterator does not provide a '"+H+"' method")),y;var J=d(Y,O.iterator,U.arg);if(J.type==="throw")return U.method="throw",U.arg=J.arg,U.delegate=null,y;var se=J.arg;return se?se.done?(U[O.resultName]=se.value,U.next=O.nextLoc,U.method!=="return"&&(U.method="next",U.arg=n),U.delegate=null,y):se:(U.method="throw",U.arg=new TypeError("iterator result is not an object"),U.delegate=null,y)}function G(O){var U={tryLoc:O[0]};1 in O&&(U.catchLoc=O[1]),2 in O&&(U.finallyLoc=O[2],U.afterLoc=O[3]),this.tryEntries.push(U)}function Q(O){var U=O.completion||{};U.type="normal",delete U.arg,O.completion=U}function L(O){this.tryEntries=[{tryLoc:"root"}],O.forEach(G,this),this.reset(!0)}function V(O){if(O||O===""){var U=O[o];if(U)return U.call(O);if(typeof O.next=="function")return O;if(!isNaN(O.length)){var H=-1,Y=function J(){for(;++H<O.length;)if(i.call(O,H))return J.value=O[H],J.done=!1,J;return J.value=n,J.done=!0,J};return Y.next=Y}}throw new TypeError(typeof O+" is not iterable")}return v.prototype=b,s(M,"constructor",{value:b,configurable:!0}),s(b,"constructor",{value:v,configurable:!0}),v.displayName=l(b,c,"GeneratorFunction"),e.isGeneratorFunction=function(O){var U=typeof O=="function"&&O.constructor;return!!U&&(U===v||(U.displayName||U.name)==="GeneratorFunction")},e.mark=function(O){return Object.setPrototypeOf?Object.setPrototypeOf(O,b):(O.__proto__=b,l(O,c,"GeneratorFunction")),O.prototype=Object.create(M),O},e.awrap=function(O){return{__await:O}},I(S.prototype),l(S.prototype,a,function(){return this}),e.AsyncIterator=S,e.async=function(O,U,H,Y,J){J===void 0&&(J=Promise);var se=new S(h(O,U,H,Y),J);return e.isGeneratorFunction(U)?se:se.next().then(function(fe){return fe.done?fe.value:se.next()})},I(M),l(M,c,"Generator"),l(M,o,function(){return this}),l(M,"toString",function(){return"[object Generator]"}),e.keys=function(O){var U=Object(O),H=[];for(var Y in U)H.push(Y);return H.reverse(),function J(){for(;H.length;){var se=H.pop();if(se in U)return J.value=se,J.done=!1,J}return J.done=!0,J}},e.values=V,L.prototype={constructor:L,reset:function(O){if(this.prev=0,this.next=0,this.sent=this._sent=n,this.done=!1,this.delegate=null,this.method="next",this.arg=n,this.tryEntries.forEach(Q),!O)for(var U in this)U.charAt(0)==="t"&&i.call(this,U)&&!isNaN(+U.slice(1))&&(this[U]=n)},stop:function(){this.done=!0;var O=this.tryEntries[0].completion;if(O.type==="throw")throw O.arg;return this.rval},dispatchException:function(O){if(this.done)throw O;var U=this;function H(Oe,qe){return se.type="throw",se.arg=O,U.next=Oe,qe&&(U.method="next",U.arg=n),!!qe}for(var Y=this.tryEntries.length-1;Y>=0;--Y){var J=this.tryEntries[Y],se=J.completion;if(J.tryLoc==="root")return H("end");if(J.tryLoc<=this.prev){var fe=i.call(J,"catchLoc"),_e=i.call(J,"finallyLoc");if(fe&&_e){if(this.prev<J.catchLoc)return H(J.catchLoc,!0);if(this.prev<J.finallyLoc)return H(J.finallyLoc)}else if(fe){if(this.prev<J.catchLoc)return H(J.catchLoc,!0)}else{if(!_e)throw new Error("try statement without catch or finally");if(this.prev<J.finallyLoc)return H(J.finallyLoc)}}}},abrupt:function(O,U){for(var H=this.tryEntries.length-1;H>=0;--H){var Y=this.tryEntries[H];if(Y.tryLoc<=this.prev&&i.call(Y,"finallyLoc")&&this.prev<Y.finallyLoc){var J=Y;break}}J&&(O==="break"||O==="continue")&&J.tryLoc<=U&&U<=J.finallyLoc&&(J=null);var se=J?J.completion:{};return se.type=O,se.arg=U,J?(this.method="next",this.next=J.finallyLoc,y):this.complete(se)},complete:function(O,U){if(O.type==="throw")throw O.arg;return O.type==="break"||O.type==="continue"?this.next=O.arg:O.type==="return"?(this.rval=this.arg=O.arg,this.method="return",this.next="end"):O.type==="normal"&&U&&(this.next=U),y},finish:function(O){for(var U=this.tryEntries.length-1;U>=0;--U){var H=this.tryEntries[U];if(H.finallyLoc===O)return this.complete(H.completion,H.afterLoc),Q(H),y}},catch:function(O){for(var U=this.tryEntries.length-1;U>=0;--U){var H=this.tryEntries[U];if(H.tryLoc===O){var Y=H.completion;if(Y.type==="throw"){var J=Y.arg;Q(H)}return J}}throw new Error("illegal catch attempt")},delegateYield:function(O,U,H){return this.delegate={iterator:V(O),resultName:U,nextLoc:H},this.method==="next"&&(this.arg=n),y}},e}function vt(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}function ak(n,e){for(var t=0;t<e.length;t++){var i=e[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(n,nG(i.key),i)}}function yt(n,e,t){return e&&ak(n.prototype,e),t&&ak(n,t),Object.defineProperty(n,"prototype",{writable:!1}),n}function te(n,e,t){return e=nG(e),e in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function em(n,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),Object.defineProperty(n,"prototype",{writable:!1}),e&&QT(n,e)}function n_(n){return n_=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},n_(n)}function QT(n,e){return QT=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(i,s){return i.__proto__=s,i},QT(n,e)}function dne(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function ti(n){if(n===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return n}function fne(n,e){if(e&&(typeof e=="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return ti(n)}function tm(n){var e=dne();return function(){var i=n_(n),s;if(e){var r=n_(this).constructor;s=Reflect.construct(i,arguments,r)}else s=i.apply(this,arguments);return fne(this,s)}}function rp(n,e){return pne(n)||une(n,e)||iG(n,e)||mne()}function pne(n){if(Array.isArray(n))return n}function iG(n,e){if(n){if(typeof n=="string")return ck(n,e);var t=Object.prototype.toString.call(n).slice(8,-1);if(t==="Object"&&n.constructor&&(t=n.constructor.name),t==="Map"||t==="Set")return Array.from(n);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return ck(n,e)}}function ck(n,e){(e==null||e>n.length)&&(e=n.length);for(var t=0,i=new Array(e);t<e;t++)i[t]=n[t];return i}function mne(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function lk(n,e){var t=typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(!t){if(Array.isArray(n)||(t=iG(n))||e&&n&&typeof n.length=="number"){t&&(n=t);var i=0,s=function(){};return{s,n:function(){return i>=n.length?{done:!0}:{done:!1,value:n[i++]}},e:function(c){throw c},f:s}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var r=!0,o=!1,a;return{s:function(){t=t.call(n)},n:function(){var c=t.next();return r=c.done,c},e:function(c){o=!0,a=c},f:function(){try{!r&&t.return!=null&&t.return()}finally{if(o)throw a}}}}function gne(n,e){if(typeof n!="object"||n===null)return n;var t=n[Symbol.toPrimitive];if(t!==void 0){var i=t.call(n,e||"default");if(typeof i!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(n)}function nG(n){var e=gne(n,"string");return typeof e=="symbol"?e:String(e)}var Ane=function(n){em(t,n);var e=tm(t);function t(i){var s;return vt(this,t),s=e.call(this),te(ti(s),"type","ParticleEmitter"),te(ti(s),"system",void 0),s.system=i,s}return yt(t,[{key:"clone",value:function(){var s=this.system.clone();return s.emitter.copy(this,!0),s.emitter}},{key:"dispose",value:function(){}},{key:"extractFromCache",value:function(s){var r=[];for(var o in s){var a=s[o];delete a.metadata,r.push(a)}return r}},{key:"toJSON",value:function(s){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},o=s===void 0||typeof s=="string",a={};o&&(s={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},a.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});var c={};if(c.uuid=this.uuid,c.type=this.type,this.name!==""&&(c.name=this.name),this.castShadow===!0&&(c.castShadow=!0),this.receiveShadow===!0&&(c.receiveShadow=!0),this.visible===!1&&(c.visible=!1),this.frustumCulled===!1&&(c.frustumCulled=!1),this.renderOrder!==0&&(c.renderOrder=this.renderOrder),JSON.stringify(this.userData)!=="{}"&&(c.userData=this.userData),c.layers=this.layers.mask,c.matrix=this.matrix.toArray(),this.matrixAutoUpdate===!1&&(c.matrixAutoUpdate=!1),this.system!==null&&(c.ps=this.system.toJSON(s,r)),this.children.length>0){c.children=[];for(var l=0;l<this.children.length;l++)this.children[l].type!=="ParticleSystemPreview"&&c.children.push(this.children[l].toJSON(s).object)}if(o){var h=this.extractFromCache(s.geometries),d=this.extractFromCache(s.materials),f=this.extractFromCache(s.textures),p=this.extractFromCache(s.images);h.length>0&&(a.geometries=h),d.length>0&&(a.materials=d),f.length>0&&(a.textures=f),p.length>0&&(a.images=p)}return a.object=c,a}}]),t}(ge),TC=function(){function n(e){vt(this,n),te(this,"data",void 0),te(this,"next",void 0),te(this,"prev",void 0),this.data=e,this.next=null,this.prev=null}return yt(n,[{key:"hasPrev",value:function(){return this.prev!==null}},{key:"hasNext",value:function(){return this.next!==null}}]),n}(),vne=function(){function n(){vt(this,n),te(this,"length",void 0),te(this,"head",void 0),te(this,"tail",void 0),this.length=0,this.head=this.tail=null}return yt(n,[{key:"isEmpty",value:function(){return this.head===null}},{key:"clear",value:function(){this.length=0,this.head=this.tail=null}},{key:"front",value:function(){return this.head===null?null:this.head.data}},{key:"back",value:function(){return this.tail===null?null:this.tail.data}},{key:"dequeue",value:function(){if(this.head){var t=this.head.data;return this.head=this.head.next,this.head?this.head.prev=null:this.tail=null,this.length--,t}}},{key:"pop",value:function(){if(this.tail){var t=this.tail.data;return this.tail=this.tail.prev,this.tail?this.tail.next=null:this.head=null,this.length--,t}}},{key:"queue",value:function(t){var i=new TC(t);this.tail||(this.tail=i),this.head&&(this.head.prev=i,i.next=this.head),this.head=i,this.length++}},{key:"push",value:function(t){var i=new TC(t);this.head||(this.head=i),this.tail&&(this.tail.next=i,i.prev=this.tail),this.tail=i,this.length++}},{key:"insertBefore",value:function(t,i){var s=new TC(i);s.next=t,s.prev=t.prev,s.prev!==null&&(s.prev.next=s),s.next.prev=s,t==this.head&&(this.head=s),this.length++}},{key:"remove",value:function(t){if(!(this.head===null||this.tail===null)){var i=this.head;for(t===this.head.data&&(this.head=this.head.next),t===this.tail.data&&(this.tail=this.tail.prev);i.next!==null&&i.data!==t;)i=i.next;i.data===t&&(i.prev!==null&&(i.prev.next=i.next),i.next!==null&&(i.next.prev=i.prev),this.length--)}}},{key:"values",value:HT().mark(function e(){var t;return HT().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:t=this.head;case 1:if(t===null){s.next=7;break}return s.next=4,t.data;case 4:t=t.next,s.next=1;break;case 7:case"end":return s.stop()}},e,this)})}]),n}(),TA=function(){function n(){vt(this,n),te(this,"parentMatrix",void 0),te(this,"startSpeed",0),te(this,"startColor",new tt),te(this,"startSize",1),te(this,"position",new w),te(this,"velocity",new w),te(this,"age",0),te(this,"life",1),te(this,"size",1),te(this,"angularVelocity",void 0),te(this,"rotation",0),te(this,"color",new tt),te(this,"uvTile",0)}return yt(n,[{key:"died",get:function(){return this.age>=this.life}}]),n}(),yne=yt(function n(e,t,i){vt(this,n),this.position=e,this.size=t,this.color=i}),MA=function(){function n(){vt(this,n),te(this,"parentMatrix",void 0),te(this,"startSpeed",0),te(this,"startColor",new tt),te(this,"startSize",1),te(this,"position",new w),te(this,"localPosition",void 0),te(this,"velocity",new w),te(this,"age",0),te(this,"life",1),te(this,"size",1),te(this,"length",100),te(this,"color",new tt),te(this,"previous",new vne),te(this,"uvTile",0)}return yt(n,[{key:"update",value:function(){for(this.age<=this.life?this.previous.push(new yne(this.position.clone(),this.size,this.color.clone())):this.previous.length>0&&this.previous.dequeue();this.previous.length>this.length;)this.previous.dequeue()}},{key:"died",get:function(){return this.age>=this.life}},{key:"reset",value:function(){this.previous.clear()}}]),n}(),Gs=function(){function n(e){vt(this,n),te(this,"type",void 0),this.value=e,this.type="value"}return yt(n,[{key:"genValue",value:function(){return this.value}},{key:"toJSON",value:function(){return{type:"ConstantValue",value:this.value}}},{key:"clone",value:function(){return new n(this.value)}}],[{key:"fromJSON",value:function(t){return new n(t.value)}}]),n}(),cw=function(){function n(e,t){vt(this,n),te(this,"type",void 0),this.a=e,this.b=t,this.type="value"}return yt(n,[{key:"genValue",value:function(){return Vn.lerp(this.a,this.b,Math.random())}},{key:"toJSON",value:function(){return{type:"IntervalValue",a:this.a,b:this.b}}},{key:"clone",value:function(){return new n(this.a,this.b)}}],[{key:"fromJSON",value:function(t){return new n(t.a,t.b)}}]),n}(),bne=function(){function n(){vt(this,n),te(this,"functions",void 0),this.functions=new Array}return yt(n,[{key:"findFunction",value:function(t){for(var i=0,s=0,r=this.functions.length-1;s+1<r;)if(i=Math.floor((s+r)/2),t<this.getStartX(i))r=i-1;else if(t>this.getEndX(i))s=i+1;else return i;for(var o=s;o<=r;o++)if(t>=this.functions[o][1]&&t<=this.getEndX(o))return o;return-1}},{key:"getStartX",value:function(t){return this.functions[t][1]}},{key:"setStartX",value:function(t,i){t>0&&(this.functions[t][1]=i)}},{key:"getEndX",value:function(t){return t+1<this.functions.length?this.functions[t+1][1]:1}},{key:"setEndX",value:function(t,i){t+1<this.functions.length&&(this.functions[t+1][1]=i)}},{key:"insertFunction",value:function(t,i){var s=this.findFunction(t);this.functions.splice(s+1,0,[i,t])}},{key:"removeFunction",value:function(t){return this.functions.splice(t,1)[0][0]}},{key:"getFunction",value:function(t){return this.functions[t][0]}},{key:"setFunction",value:function(t,i){this.functions[t][0]=i}},{key:"numOfFunctions",get:function(){return this.functions.length}}]),n}(),jT=function(){function n(e,t,i,s){vt(this,n),te(this,"p",void 0),this.p=[e,t,i,s]}return yt(n,[{key:"genValue",value:function(t){var i=t*t,s=t*t*t,r=1-t,o=r*r,a=o*r;return this.p[0]*a+this.p[1]*o*t*3+this.p[2]*r*i*3+this.p[3]*s}},{key:"derivativeCoefficients",value:function(t){for(var i=[],s=t,r=s.length-1;r>0;r--){for(var o=[],a=0;a<r;a++){var c=r*(s[a+1]-s[a]);o.push(c)}i.push(o),s=o}return i}},{key:"getSlope",value:function(t){var i=this.derivativeCoefficients(this.p)[0],s=1-t,r=s*s,o=s*t*2,a=t*t;return r*i[0]+o*i[1]+a*i[2]}},{key:"controlCurve",value:function(t,i){this.p[1]=t/3+this.p[0],this.p[2]=this.p[3]-i/3}},{key:"hull",value:function(t){var i=this.p,s=[],r,o=0,a=0,c=0,l=[];for(l[o++]=i[0],l[o++]=i[1],l[o++]=i[2],l[o++]=i[3];i.length>1;){for(s=[],a=0,c=i.length-1;a<c;a++)r=t*i[a]+(1-t)*i[a+1],l[o++]=r,s.push(r);i=s}return l}},{key:"split",value:function(t){var i=this.hull(t),s={left:new n(i[0],i[4],i[7],i[9]),right:new n(i[9],i[8],i[6],i[3]),span:i};return s}},{key:"clone",value:function(){return new n(this.p[0],this.p[1],this.p[2],this.p[3])}},{key:"toJSON",value:function(){return{p0:this.p[0],p1:this.p[1],p2:this.p[2],p3:this.p[3]}}}],[{key:"fromJSON",value:function(t){return new n(t.p0,t.p1,t.p2,t.p3)}}]),n}(),_ne=function(n){em(t,n);var e=tm(t);function t(){var i,s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[[new jT(0,.3333333333333333,.6666666666666666,1),0]];return vt(this,t),i=e.call(this),te(ti(i),"type",void 0),i.type="function",i.functions=s,i}return yt(t,[{key:"genValue",value:function(){var s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,r=this.findFunction(s);return r===-1?0:this.functions[r][0].genValue((s-this.getStartX(r))/(this.getEndX(r)-this.getStartX(r)))}},{key:"toSVG",value:function(s,r){if(r<1)return"";for(var o=["M",0,this.functions[0][0].p[0]].join(" "),a=1/r;a<=1;a+=1/r)o=[o,"L",a*s,this.genValue(a)].join(" ");return o}},{key:"toJSON",value:function(){return{type:"PiecewiseBezier",functions:this.functions.map(function(s){var r=rp(s,2),o=r[0],a=r[1];return{function:o.toJSON(),start:a}})}}},{key:"clone",value:function(){return new t(this.functions.map(function(s){var r=rp(s,2),o=r[0],a=r[1];return[o.clone(),a]}))}}],[{key:"fromJSON",value:function(s){return new t(s.functions.map(function(r){return[jT.fromJSON(r.function),r.start]}))}}]),t}(bne);function Gi(n){switch(n.type){case"ConstantValue":return Gs.fromJSON(n);case"IntervalValue":return cw.fromJSON(n);case"PiecewiseBezier":return _ne.fromJSON(n);default:return new Gs(0)}}var IA=function(e){return{r:e.x,g:e.y,b:e.z,a:e.w}},RA=function(e){return new tt(e.r,e.g,e.b,e.a)},xne=function(e,t){switch(t){case"Vector3":return new w(e.x,e.y,e.z);case"Vector4":return new tt(e.x,e.y,e.z,e.w);case"Color":return new w(e.r,e.g,e.b);case"Number":return e;default:return e}},wne=function(e,t){switch(t){case"Vector3":return{x:e.x,y:e.y,z:e.z};case"Vector4":return{x:e.x,y:e.y,z:e.z,w:e.w};case"Color":return{r:e.x,g:e.y,b:e.z};case"Number":return e;default:return e}},Sne=function(){function n(e,t){vt(this,n),te(this,"type",void 0),this.a=e,this.b=t,this.type="value"}return yt(n,[{key:"genColor",value:function(t){var i=Math.random();return t.copy(this.a).lerp(this.b,i)}},{key:"toJSON",value:function(){return{type:"RandomColor",a:IA(this.a),b:IA(this.b)}}},{key:"clone",value:function(){return new n(this.a.clone(),this.b.clone())}}],[{key:"fromJSON",value:function(t){return new n(RA(t.a),RA(t.b))}}]),n}(),WT=function(){function n(e,t){vt(this,n),te(this,"type",void 0),this.a=e,this.b=t,this.type="function"}return yt(n,[{key:"genColor",value:function(t,i){return t.copy(this.a).lerp(this.b,i)}},{key:"toJSON",value:function(){return{type:"ColorRange",a:IA(this.a),b:IA(this.b)}}},{key:"clone",value:function(){return new n(this.a.clone(),this.b.clone())}}],[{key:"fromJSON",value:function(t){return new n(RA(t.a),RA(t.b))}}]),n}(),c0=function(){function n(e,t){vt(this,n),te(this,"keys",void 0),te(this,"type",void 0),te(this,"subType",void 0),this.subType=t,this.type="function",this.keys=e}return yt(n,[{key:"findKey",value:function(t){for(var i=0,s=0,r=this.keys.length-1;s+1<r;)if(i=Math.floor((s+r)/2),t<this.getStartX(i))r=i-1;else if(t>this.getEndX(i))s=i+1;else return i;for(var o=s;o<=r;o++)if(t>=this.getStartX(o)&&t<=this.getEndX(o))return o;return-1}},{key:"getStartX",value:function(t){return this.keys[t][1]}},{key:"getEndX",value:function(t){return t+1<this.keys.length?this.keys[t+1][1]:1}},{key:"genValue",value:function(t,i){var s=this.findKey(i);return this.subType==="Number"?s===-1?this.keys[0][0]:s+1>=this.keys.length?this.keys[this.keys.length-1][0]:(this.keys[s+1][0]-this.keys[s][0])*((i-this.getStartX(s))/(this.getEndX(s)-this.getStartX(s)))+this.keys[s][0]:s===-1?t.copy(this.keys[0][0]):s+1>=this.keys.length?t.copy(this.keys[this.keys.length-1][0]):t.copy(this.keys[s][0]).lerp(this.keys[s+1][0],(i-this.getStartX(s))/(this.getEndX(s)-this.getStartX(s)))}},{key:"toJSON",value:function(){var t=this;return this.keys[0][0].constructor.name,{type:"CLinearFunction",subType:this.subType,keys:this.keys.map(function(i){var s=rp(i,2),r=s[0],o=s[1];return{value:wne(r,t.subType),pos:o}})}}},{key:"clone",value:function(){return this.subType==="Number"?new n(this.keys.map(function(t){var i=rp(t,2),s=i[0],r=i[1];return[s,r]}),this.subType):new n(this.keys.map(function(t){var i=rp(t,2),s=i[0],r=i[1];return[s.clone(),r]}),this.subType)}}],[{key:"fromJSON",value:function(t){return new n(t.keys.map(function(i){return[xne(i.value,t.subType),i.pos]}),t.subType)}}]),n}(),l0=new w,qT=function(){function n(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[[new w(0,0,0),0],[new w(1,1,1),0]],t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[[1,0],[1,1]];vt(this,n),te(this,"type",void 0),te(this,"color",void 0),te(this,"alpha",void 0),this.type="function",this.color=new c0(e,"Color"),this.alpha=new c0(t,"Number")}return yt(n,[{key:"genColor",value:function(t,i){return this.color.genValue(l0,i),t.set(l0.x,l0.y,l0.z,this.alpha.genValue(1,i))}},{key:"toJSON",value:function(){return{type:"Gradient",color:this.color.toJSON(),alpha:this.alpha.toJSON()}}},{key:"clone",value:function(){var t=new n;return t.alpha=this.alpha.clone(),t.color=this.color.clone(),t}}],[{key:"fromJSON",value:function(t){if(t.functions){var i=t.functions.map(function(r){return[WT.fromJSON(r.function).a,r.start]});return t.functions.length>0&&i.push([WT.fromJSON(t.functions[t.functions.length-1].function).b,1]),new n(i.map(function(r){return[new w(r[0].x,r[0].y,r[0].z),r[1]]}),i.map(function(r){return[r[0].w,r[1]]}))}else{var s=new n;return s.alpha=c0.fromJSON(t.alpha),s.color=c0.fromJSON(t.color),s}}}]),n}(),MC=new tt,Cne=function(){function n(e,t){vt(this,n),te(this,"gradient1",void 0),te(this,"gradient2",void 0),te(this,"type",void 0),this.type="memorizedFunction",this.gradient1=e,this.gradient2=t}return yt(n,[{key:"startGen",value:function(t){t.rand=Math.random()}},{key:"genColor",value:function(t,i,s){return this.gradient1.genColor(t,i),this.gradient2.genColor(MC,i),s&&s.rand?t.lerp(MC,s.rand):t.lerp(MC,Math.random()),t}},{key:"toJSON",value:function(){return{type:"RandomColorBetweenGradient",gradient1:this.gradient1.toJSON(),gradient2:this.gradient2.toJSON()}}},{key:"clone",value:function(){return new n(this.gradient1.clone(),this.gradient2.clone())}}],[{key:"fromJSON",value:function(t){return new n(qT.fromJSON(t.gradient1),qT.fromJSON(t.gradient2))}}]),n}(),s_=function(){function n(e){vt(this,n),te(this,"type",void 0),this.color=e,this.type="value"}return yt(n,[{key:"genColor",value:function(t){return t.copy(this.color)}},{key:"toJSON",value:function(){return{type:"ConstantColor",color:IA(this.color)}}},{key:"clone",value:function(){return new n(this.color.clone())}}],[{key:"fromJSON",value:function(t){return new n(RA(t.color))}}]),n}();function QI(n){switch(n.type){case"ConstantColor":return s_.fromJSON(n);case"ColorRange":return WT.fromJSON(n);case"RandomColor":return Sne.fromJSON(n);case"Gradient":return qT.fromJSON(n);case"RandomColorBetweenGradient":return Cne.fromJSON(n);default:return new s_(new tt(1,1,1,1))}}var hk=function(){function n(){vt(this,n),te(this,"type",void 0),this.type="rotation"}return yt(n,[{key:"genValue",value:function(t,i){var s,r,o,a,c,l;do s=Math.random()*2-1,r=Math.random()*2-1,o=s*s+r*r;while(o>1);do a=Math.random()*2-1,c=Math.random()*2-1,l=a*a+c*c;while(l>1);var h=Math.sqrt((1-o)/l);return t.set(s,r,h*a,h*c),t}},{key:"toJSON",value:function(){return{type:"RandomQuat"}}},{key:"clone",value:function(){return new n}}],[{key:"fromJSON",value:function(t){return new n}}]),n}(),sG=function(){function n(e,t){vt(this,n),te(this,"type",void 0),this.axis=e,this.angle=t,this.type="rotation"}return yt(n,[{key:"genValue",value:function(t,i){return t.setFromAxisAngle(this.axis,this.angle.genValue(i))}},{key:"toJSON",value:function(){return{type:"AxisAngle",axis:{x:this.axis.x,y:this.axis.y,z:this.axis.z},angle:this.angle.toJSON()}}},{key:"clone",value:function(){return new n(this.axis.clone(),this.angle.clone())}}],[{key:"fromJSON",value:function(t){return new n(t.axis,Gi(t.angle))}}]),n}(),Ene=function(){function n(e,t,i){vt(this,n),te(this,"type",void 0),this.angleX=e,this.angleY=t,this.angleZ=i,this.type="rotation"}return yt(n,[{key:"genValue",value:function(t,i){return t.setFromEuler(new ws(this.angleX.genValue(i),this.angleY.genValue(i),this.angleZ.genValue(i)))}},{key:"toJSON",value:function(){return{type:"Euler",angleX:this.angleX.toJSON(),angleY:this.angleY.toJSON(),angleZ:this.angleZ.toJSON()}}},{key:"clone",value:function(){return new n(this.angleX,this.angleY,this.angleZ)}}],[{key:"fromJSON",value:function(t){return new n(Gi(t.angleX),Gi(t.angleY),Gi(t.angleZ))}}]),n}();function rG(n){switch(n.type){case"AxisAngle":return sG.fromJSON(n);case"Euler":return Ene.fromJSON(n);case"RandomQuat":return hk.fromJSON(n);default:return new hk}}function Tne(n){switch(n.type){case"ConstantValue":case"IntervalValue":case"PiecewiseBezier":return Gi(n);case"AxisAngle":case"RandomQuat":case"Euler":return rG(n);default:return new Gs(0)}}var uk=function(){function n(e){vt(this,n),te(this,"type","ColorOverLife"),this.color=e}return yt(n,[{key:"initialize",value:function(t){this.color.type==="memorizedFunction"&&(t.colorOverLifeMemory={},this.color.startGen(t.colorOverLifeMemory))}},{key:"update",value:function(t,i){this.color.type==="memorizedFunction"?this.color.genColor(t.color,t.age/t.life,t.colorOverLifeMemory):this.color.genColor(t.color,t.age/t.life),t.color.x*=t.startColor.x,t.color.y*=t.startColor.y,t.color.z*=t.startColor.z,t.color.w*=t.startColor.w}},{key:"frameUpdate",value:function(t){}},{key:"toJSON",value:function(){return{type:this.type,color:this.color.toJSON()}}},{key:"clone",value:function(){return new n(this.color.clone())}},{key:"reset",value:function(){}}],[{key:"fromJSON",value:function(t){return new n(QI(t.color))}}]),n}(),dk=function(){function n(e,t){vt(this,n),te(this,"type","RotationOverLife"),te(this,"tempQuat",new Me),this.angularVelocity=e,this.dynamic=t}return yt(n,[{key:"initialize",value:function(t){!this.dynamic&&t instanceof TA&&(t.angularVelocity=this.angularVelocity.genValue())}},{key:"update",value:function(t,i){this.dynamic?t.rotation+=i*this.angularVelocity.genValue(t.age/t.life):t instanceof TA&&(t.rotation+=i*t.angularVelocity)}},{key:"toJSON",value:function(){return{type:this.type,angularVelocity:this.angularVelocity.toJSON(),dynamic:this.dynamic}}},{key:"frameUpdate",value:function(t){}},{key:"clone",value:function(){return new n(this.angularVelocity.clone(),this.dynamic)}},{key:"reset",value:function(){}}],[{key:"fromJSON",value:function(t){return new n(Gi(t.angularVelocity),t.dynamic)}}]),n}(),fk=function(){function n(e){vt(this,n),te(this,"type","SizeOverLife"),this.size=e}return yt(n,[{key:"initialize",value:function(t){}},{key:"update",value:function(t){t.size=t.startSize*this.size.genValue(t.age/t.life)}},{key:"toJSON",value:function(){return{type:this.type,size:this.size.toJSON()}}},{key:"frameUpdate",value:function(t){}},{key:"clone",value:function(){return new n(this.size.clone())}},{key:"reset",value:function(){}}],[{key:"fromJSON",value:function(t){return new n(Gi(t.size))}}]),n}(),pk=function(){function n(e){vt(this,n),te(this,"type","SpeedOverLife"),this.speed=e}return yt(n,[{key:"initialize",value:function(t){}},{key:"update",value:function(t){t.velocity.normalize().multiplyScalar(t.startSpeed*this.speed.genValue(t.age/t.life))}},{key:"toJSON",value:function(){return{type:this.type,speed:this.speed.toJSON()}}},{key:"frameUpdate",value:function(t){}},{key:"clone",value:function(){return new n(this.speed.clone())}},{key:"reset",value:function(){}}],[{key:"fromJSON",value:function(t){return new n(Gi(t.speed))}}]),n}(),mk=function(){function n(e,t){vt(this,n),te(this,"type","RotationBySpeed"),te(this,"tempQuat",new Me),this.angularVelocity=e,this.speedRange=t}return yt(n,[{key:"initialize",value:function(t){}},{key:"update",value:function(t,i){var s=(t.startSpeed-this.speedRange.a)/(this.speedRange.b-this.speedRange.a);t.rotation+=i*this.angularVelocity.genValue(s)}},{key:"toJSON",value:function(){return{type:this.type,angularVelocity:this.angularVelocity.toJSON(),speedRange:this.speedRange.toJSON()}}},{key:"frameUpdate",value:function(t){}},{key:"clone",value:function(){return new n(this.angularVelocity.clone(),this.speedRange.clone())}},{key:"reset",value:function(){}}],[{key:"fromJSON",value:function(t){return new n(Gi(t.angularVelocity),cw.fromJSON(t.speedRange))}}]),n}(),gk=function(){function n(e,t){vt(this,n),te(this,"type","SizeBySpeed"),this.size=e,this.speedRange=t}return yt(n,[{key:"initialize",value:function(t){}},{key:"update",value:function(t){var i=(t.startSpeed-this.speedRange.a)/(this.speedRange.b-this.speedRange.a);t.size=t.startSize*this.size.genValue(i)}},{key:"toJSON",value:function(){return{type:this.type,size:this.size.toJSON(),speedRange:this.speedRange.toJSON()}}},{key:"frameUpdate",value:function(t){}},{key:"clone",value:function(){return new n(this.size.clone(),this.speedRange.clone())}},{key:"reset",value:function(){}}],[{key:"fromJSON",value:function(t){return new n(Gi(t.size),cw.fromJSON(t.speedRange))}}]),n}(),Ak=function(){function n(e,t){vt(this,n),te(this,"type","ColorBySpeed"),this.color=e,this.speedRange=t}return yt(n,[{key:"initialize",value:function(t){this.color.type==="memorizedFunction"&&(t.colorOverLifeMemory={},this.color.startGen(t.colorOverLifeMemory))}},{key:"update",value:function(t,i){var s=(t.startSpeed-this.speedRange.a)/(this.speedRange.b-this.speedRange.a);this.color.type==="memorizedFunction"?this.color.genColor(t.color,s,t.colorOverLifeMemory):this.color.genColor(t.color,s),t.color.x*=t.startColor.x,t.color.y*=t.startColor.y,t.color.z*=t.startColor.z,t.color.w*=t.startColor.w}},{key:"frameUpdate",value:function(t){}},{key:"toJSON",value:function(){return{type:this.type,color:this.color.toJSON(),speedRange:this.speedRange.toJSON()}}},{key:"clone",value:function(){return new n(this.color.clone(),this.speedRange.clone())}},{key:"reset",value:function(){}}],[{key:"fromJSON",value:function(t){return new n(QI(t.color),cw.fromJSON(t.speedRange))}}]),n}(),vk=function(){function n(e){vt(this,n),te(this,"type","FrameOverLife"),this.frame=e}return yt(n,[{key:"initialize",value:function(t){}},{key:"update",value:function(t,i){t.uvTile=Math.floor(this.frame.genValue(t.age/t.life))}},{key:"frameUpdate",value:function(t){}},{key:"toJSON",value:function(){return{type:this.type,frame:this.frame.toJSON()}}},{key:"clone",value:function(){return new n(this.frame.clone())}},{key:"reset",value:function(){}}],[{key:"fromJSON",value:function(t){return new n(Gi(t.frame))}}]),n}();new w(0,0,1);var yk=function(){function n(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:new w(0,1,0);vt(this,n),te(this,"type","OrbitOverLife"),te(this,"rotation",void 0),te(this,"line",void 0),te(this,"temp",new w),this.orbitSpeed=e,this.axis=t,this.rotation=new Me,this.line=new KM}return yt(n,[{key:"initialize",value:function(t){}},{key:"update",value:function(t,i){this.line.set(new w(0,0,0),this.axis),this.line.closestPointToPoint(t.position,!1,this.temp),this.rotation.setFromAxisAngle(this.axis,this.orbitSpeed.genValue(t.age/t.life)*i),t.position.sub(this.temp),t.position.applyQuaternion(this.rotation),t.position.add(this.temp)}},{key:"frameUpdate",value:function(t){}},{key:"toJSON",value:function(){return{type:this.type,orbitSpeed:this.orbitSpeed.toJSON(),axis:[this.axis.x,this.axis.y,this.axis.z]}}},{key:"clone",value:function(){return new n(this.orbitSpeed.clone())}},{key:"reset",value:function(){}}],[{key:"fromJSON",value:function(t){return new n(Gi(t.orbitSpeed),t.axis?new w(t.axis[0],t.axis[1],t.axis[2]):void 0)}}]),n}(),bk=function(){function n(e,t){vt(this,n),te(this,"type","ApplyForce"),te(this,"magnitudeValue",void 0),this.direction=e,this.magnitude=t,this.magnitudeValue=this.magnitude.genValue()}return yt(n,[{key:"initialize",value:function(t){}},{key:"update",value:function(t,i){t.velocity.addScaledVector(this.direction,this.magnitudeValue*i)}},{key:"frameUpdate",value:function(t){this.magnitudeValue=this.magnitude.genValue()}},{key:"toJSON",value:function(){return{type:this.type,direction:[this.direction.x,this.direction.y,this.direction.z],magnitude:this.magnitude.toJSON()}}},{key:"clone",value:function(){return new n(this.direction.clone(),this.magnitude.clone())}},{key:"reset",value:function(){}}],[{key:"fromJSON",value:function(t){var i;return new n(new w(t.direction[0],t.direction[1],t.direction[2]),Gi((i=t.magnitude)!==null&&i!==void 0?i:t.force))}}]),n}(),_k=function(){function n(e,t){vt(this,n),te(this,"type","GravityForce"),te(this,"temp",new w),this.center=e,this.magnitude=t}return yt(n,[{key:"initialize",value:function(t){}},{key:"update",value:function(t,i){this.temp.copy(this.center).sub(t.position).normalize(),t.velocity.addScaledVector(this.temp,this.magnitude/t.position.distanceToSquared(this.center)*i)}},{key:"frameUpdate",value:function(t){}},{key:"toJSON",value:function(){return{type:this.type,center:[this.center.x,this.center.y,this.center.z],magnitude:this.magnitude}}},{key:"clone",value:function(){return new n(this.center.clone(),this.magnitude)}},{key:"reset",value:function(){}}],[{key:"fromJSON",value:function(t){return new n(new w(t.center[0],t.center[1],t.center[2]),t.magnitude)}}]),n}(),xk=function(){function n(e){vt(this,n),te(this,"type","WidthOverLength"),this.width=e}return yt(n,[{key:"initialize",value:function(t){}},{key:"update",value:function(t){if(t instanceof MA)for(var i=t.previous.values(),s=0;s<t.previous.length;s++){var r=i.next();r.value.size=this.width.genValue((t.previous.length-s)/t.length)}}},{key:"frameUpdate",value:function(t){}},{key:"toJSON",value:function(){return{type:this.type,width:this.width.toJSON()}}},{key:"clone",value:function(){return new n(this.width.clone())}},{key:"reset",value:function(){}}],[{key:"fromJSON",value:function(t){return new n(Gi(t.width))}}]),n}();new w(0,0,1);var wk=function(){function n(e){vt(this,n),te(this,"type","ChangeEmitDirection"),te(this,"_temp",new w),te(this,"_q",new Me),this.angle=e}return yt(n,[{key:"initialize",value:function(t){var i=t.velocity.length();i!=0&&(t.velocity.normalize(),t.velocity.x===0&&t.velocity.y===0?this._temp.set(0,t.velocity.z,0):this._temp.set(-t.velocity.y,t.velocity.x,0),this._q.setFromAxisAngle(this._temp.normalize(),this.angle.genValue()),this._temp.copy(t.velocity),t.velocity.applyQuaternion(this._q),this._q.setFromAxisAngle(this._temp,Math.random()*Math.PI*2),t.velocity.applyQuaternion(this._q),t.velocity.setLength(i))}},{key:"update",value:function(t,i){}},{key:"frameUpdate",value:function(t){}},{key:"toJSON",value:function(){return{type:this.type,angle:this.angle.toJSON()}}},{key:"clone",value:function(){return new n(this.angle)}},{key:"reset",value:function(){}}],[{key:"fromJSON",value:function(t){return new n(Gi(t.angle))}}]),n}(),Mne=new w(1,1,1),Sk=new w(0,0,1),Ck=function(){function n(e,t,i){vt(this,n),te(this,"type","EmitSubParticleSystem"),te(this,"q_",new Me),te(this,"v_",new w),te(this,"v2_",new w),this.particleSystem=e,this.useVelocityAsBasis=t,this.subParticleSystem=i,this.subParticleSystem&&this.subParticleSystem.system&&(this.subParticleSystem.system.onlyUsedByOther=!0)}return yt(n,[{key:"initialize",value:function(t){t.emissionState={burstIndex:0,burstWaveIndex:0,time:0,waitEmiting:0,matrix:new Ce}}},{key:"update",value:function(t,i){if(!(!this.subParticleSystem||!t.emissionState)){var s=t.emissionState.matrix,r;if(t.rotation===void 0||this.useVelocityAsBasis)if(t.velocity.x===0&&t.velocity.y===0&&(t.velocity.z===1||t.velocity.z===0))s.set(1,0,0,t.position.x,0,1,0,t.position.y,0,0,1,t.position.z,0,0,0,1);else{this.v_.copy(Sk).cross(t.velocity),this.v2_.copy(t.velocity).cross(this.v_);var o=this.v_.length(),a=this.v2_.length();s.set(this.v_.x/o,this.v2_.x/a,t.velocity.x,t.position.x,this.v_.y/o,this.v2_.y/a,t.velocity.y,t.position.y,this.v_.z/o,this.v2_.z/a,t.velocity.z,t.position.z,0,0,0,1)}else t.rotation instanceof Me?r=t.rotation:(this.q_.setFromAxisAngle(Sk,t.rotation),r=this.q_),s.compose(t.position,r,Mne);this.particleSystem.worldSpace||s.multiplyMatrices(this.particleSystem.emitter.matrixWorld,s),this.subParticleSystem.system.emit(i,t.emissionState,s)}}},{key:"frameUpdate",value:function(t){}},{key:"toJSON",value:function(){return{type:this.type,subParticleSystem:this.subParticleSystem?this.subParticleSystem.uuid:"",useVelocityAsBasis:this.useVelocityAsBasis}}},{key:"clone",value:function(){return new n(this.particleSystem,this.useVelocityAsBasis,this.subParticleSystem)}},{key:"reset",value:function(){}}],[{key:"fromJSON",value:function(t,i){return new n(i,t.useVelocityAsBasis,t.subParticleSystem)}}]),n}(),Ine=.5*(Math.sqrt(3)-1),Um=(3-Math.sqrt(3))/6,Rne=1/3,Ia=1/6,Pne=(Math.sqrt(5)-1)/4,ds=(5-Math.sqrt(5))/20,Yn=new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]),Bn=new Float32Array([0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0]),oG=function(){function n(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Math.random;vt(this,n),te(this,"p",void 0),te(this,"perm",void 0),te(this,"permMod12",void 0);var t=typeof e=="function"?e:Dne(e);this.p=Bne(t),this.perm=new Uint8Array(512),this.permMod12=new Uint8Array(512);for(var i=0;i<512;i++)this.perm[i]=this.p[i&255],this.permMod12[i]=this.perm[i]%12}return yt(n,[{key:"noise2D",value:function(t,i){var s=this.permMod12,r=this.perm,o=0,a=0,c=0,l=(t+i)*Ine,h=Math.floor(t+l),d=Math.floor(i+l),f=(h+d)*Um,p=h-f,m=d-f,g=t-p,y=i-m,A,v;g>y?(A=1,v=0):(A=0,v=1);var b=g-A+Um,_=y-v+Um,T=g-1+2*Um,E=y-1+2*Um,M=h&255,I=d&255,S=.5-g*g-y*y;if(S>=0){var C=s[M+r[I]]*3;S*=S,o=S*S*(Yn[C]*g+Yn[C+1]*y)}var D=.5-b*b-_*_;if(D>=0){var G=s[M+A+r[I+v]]*3;D*=D,a=D*D*(Yn[G]*b+Yn[G+1]*_)}var Q=.5-T*T-E*E;if(Q>=0){var L=s[M+1+r[I+1]]*3;Q*=Q,c=Q*Q*(Yn[L]*T+Yn[L+1]*E)}return 70*(o+a+c)}},{key:"noise3D",value:function(t,i,s){var r=this.permMod12,o=this.perm,a,c,l,h,d=(t+i+s)*Rne,f=Math.floor(t+d),p=Math.floor(i+d),m=Math.floor(s+d),g=(f+p+m)*Ia,y=f-g,A=p-g,v=m-g,b=t-y,_=i-A,T=s-v,E,M,I,S,C,D;b>=_?_>=T?(E=1,M=0,I=0,S=1,C=1,D=0):b>=T?(E=1,M=0,I=0,S=1,C=0,D=1):(E=0,M=0,I=1,S=1,C=0,D=1):_<T?(E=0,M=0,I=1,S=0,C=1,D=1):b<T?(E=0,M=1,I=0,S=0,C=1,D=1):(E=0,M=1,I=0,S=1,C=1,D=0);var G=b-E+Ia,Q=_-M+Ia,L=T-I+Ia,V=b-S+2*Ia,O=_-C+2*Ia,U=T-D+2*Ia,H=b-1+3*Ia,Y=_-1+3*Ia,J=T-1+3*Ia,se=f&255,fe=p&255,_e=m&255,Oe=.6-b*b-_*_-T*T;if(Oe<0)a=0;else{var qe=r[se+o[fe+o[_e]]]*3;Oe*=Oe,a=Oe*Oe*(Yn[qe]*b+Yn[qe+1]*_+Yn[qe+2]*T)}var ae=.6-G*G-Q*Q-L*L;if(ae<0)c=0;else{var ve=r[se+E+o[fe+M+o[_e+I]]]*3;ae*=ae,c=ae*ae*(Yn[ve]*G+Yn[ve+1]*Q+Yn[ve+2]*L)}var Ue=.6-V*V-O*O-U*U;if(Ue<0)l=0;else{var Ge=r[se+S+o[fe+C+o[_e+D]]]*3;Ue*=Ue,l=Ue*Ue*(Yn[Ge]*V+Yn[Ge+1]*O+Yn[Ge+2]*U)}var Xe=.6-H*H-Y*Y-J*J;if(Xe<0)h=0;else{var ze=r[se+1+o[fe+1+o[_e+1]]]*3;Xe*=Xe,h=Xe*Xe*(Yn[ze]*H+Yn[ze+1]*Y+Yn[ze+2]*J)}return 32*(a+c+l+h)}},{key:"noise4D",value:function(t,i,s,r){var o=this.perm,a,c,l,h,d,f=(t+i+s+r)*Pne,p=Math.floor(t+f),m=Math.floor(i+f),g=Math.floor(s+f),y=Math.floor(r+f),A=(p+m+g+y)*ds,v=p-A,b=m-A,_=g-A,T=y-A,E=t-v,M=i-b,I=s-_,S=r-T,C=0,D=0,G=0,Q=0;E>M?C++:D++,E>I?C++:G++,E>S?C++:Q++,M>I?D++:G++,M>S?D++:Q++,I>S?G++:Q++;var L=C>=3?1:0,V=D>=3?1:0,O=G>=3?1:0,U=Q>=3?1:0,H=C>=2?1:0,Y=D>=2?1:0,J=G>=2?1:0,se=Q>=2?1:0,fe=C>=1?1:0,_e=D>=1?1:0,Oe=G>=1?1:0,qe=Q>=1?1:0,ae=E-L+ds,ve=M-V+ds,Ue=I-O+ds,Ge=S-U+ds,Xe=E-H+2*ds,ze=M-Y+2*ds,Pe=I-J+2*ds,X=S-se+2*ds,Ae=E-fe+3*ds,ke=M-_e+3*ds,be=I-Oe+3*ds,je=S-qe+3*ds,ct=E-1+4*ds,F=M-1+4*ds,B=I-1+4*ds,ce=S-1+4*ds,Se=p&255,xe=m&255,Ie=g&255,et=y&255,Fe=.6-E*E-M*M-I*I-S*S;if(Fe<0)a=0;else{var Ke=o[Se+o[xe+o[Ie+o[et]]]]%32*4;Fe*=Fe,a=Fe*Fe*(Bn[Ke]*E+Bn[Ke+1]*M+Bn[Ke+2]*I+Bn[Ke+3]*S)}var rt=.6-ae*ae-ve*ve-Ue*Ue-Ge*Ge;if(rt<0)c=0;else{var At=o[Se+L+o[xe+V+o[Ie+O+o[et+U]]]]%32*4;rt*=rt,c=rt*rt*(Bn[At]*ae+Bn[At+1]*ve+Bn[At+2]*Ue+Bn[At+3]*Ge)}var Ee=.6-Xe*Xe-ze*ze-Pe*Pe-X*X;if(Ee<0)l=0;else{var Rt=o[Se+H+o[xe+Y+o[Ie+J+o[et+se]]]]%32*4;Ee*=Ee,l=Ee*Ee*(Bn[Rt]*Xe+Bn[Rt+1]*ze+Bn[Rt+2]*Pe+Bn[Rt+3]*X)}var dt=.6-Ae*Ae-ke*ke-be*be-je*je;if(dt<0)h=0;else{var ft=o[Se+fe+o[xe+_e+o[Ie+Oe+o[et+qe]]]]%32*4;dt*=dt,h=dt*dt*(Bn[ft]*Ae+Bn[ft+1]*ke+Bn[ft+2]*be+Bn[ft+3]*je)}var Ze=.6-ct*ct-F*F-B*B-ce*ce;if(Ze<0)d=0;else{var Ve=o[Se+1+o[xe+1+o[Ie+1+o[et+1]]]]%32*4;Ze*=Ze,d=Ze*Ze*(Bn[Ve]*ct+Bn[Ve+1]*F+Bn[Ve+2]*B+Bn[Ve+3]*ce)}return 27*(a+c+l+h+d)}}]),n}();function Bne(n){for(var e=new Uint8Array(256),t=0;t<256;t++)e[t]=t;for(var i=0;i<255;i++){var s=i+~~(n()*(256-i)),r=e[i];e[i]=e[s],e[s]=r}return e}function Dne(n){var e=0,t=0,i=0,s=1,r=One();return e=r(" "),t=r(" "),i=r(" "),e-=r(n),e<0&&(e+=1),t-=r(n),t<0&&(t+=1),i-=r(n),i<0&&(i+=1),function(){var o=2091639*e+s*23283064365386963e-26;return e=t,t=i,i=o-(s=o|0)}}function One(){var n=4022871197;return function(e){e=e.toString();for(var t=0;t<e.length;t++){n+=e.charCodeAt(t);var i=.02519603282416938*n;n=i>>>0,i-=n,i*=n,n=i>>>0,i-=n,n+=i*4294967296}return(n>>>0)*23283064365386963e-26}}var Ek=function(){function n(e,t,i,s){vt(this,n),te(this,"type","TurbulenceField"),te(this,"generator",new oG),te(this,"timeOffset",new w),te(this,"temp",new w),te(this,"temp2",new w),this.scale=e,this.octaves=t,this.velocityMultiplier=i,this.timeScale=s,this.timeOffset.x=Math.random()/this.scale.x*this.timeScale.x,this.timeOffset.y=Math.random()/this.scale.y*this.timeScale.y,this.timeOffset.z=Math.random()/this.scale.z*this.timeScale.z}return yt(n,[{key:"initialize",value:function(t){}},{key:"update",value:function(t,i){var s=t.position.x/this.scale.x,r=t.position.y/this.scale.y,o=t.position.z/this.scale.z;this.temp.set(0,0,0);for(var a=1,c=0;c<this.octaves;c++)this.temp2.set(this.generator.noise4D(s*a,r*a,o*a,this.timeOffset.x*a)/a,this.generator.noise4D(s*a,r*a,o*a,this.timeOffset.y*a)/a,this.generator.noise4D(s*a,r*a,o*a,this.timeOffset.z*a)/a),this.temp.add(this.temp2),a*=2;this.temp.multiply(this.velocityMultiplier),t.velocity.addScaledVector(this.temp,i)}},{key:"toJSON",value:function(){return{type:this.type,scale:[this.scale.x,this.scale.y,this.scale.z],octaves:this.octaves,velocityMultiplier:[this.velocityMultiplier.x,this.velocityMultiplier.y,this.velocityMultiplier.z],timeScale:[this.timeScale.x,this.timeScale.y,this.timeScale.z]}}},{key:"frameUpdate",value:function(t){this.timeOffset.x+=t*this.timeScale.x,this.timeOffset.y+=t*this.timeScale.y,this.timeOffset.z+=t*this.timeScale.z}},{key:"clone",value:function(){return new n(this.scale.clone(),this.octaves,this.velocityMultiplier.clone(),this.timeScale.clone())}},{key:"reset",value:function(){}}],[{key:"fromJSON",value:function(t){return new n(new w(t.scale[0],t.scale[1],t.scale[2]),t.octaves,new w(t.velocityMultiplier[0],t.velocityMultiplier[1],t.velocityMultiplier[2]),new w(t.timeScale[0],t.timeScale[1],t.timeScale[2]))}}]),n}(),Tk=new Me,Mk=function(){function n(e,t){vt(this,n),te(this,"type","Rotation3DOverLife"),te(this,"tempQuat",new Me),this.angularVelocity=e,this.dynamic=t}return yt(n,[{key:"initialize",value:function(t){!this.dynamic&&t instanceof TA&&(t.angularVelocity=new Me,this.angularVelocity.genValue(t.angularVelocity))}},{key:"update",value:function(t,i){this.dynamic?(this.angularVelocity.genValue(this.tempQuat,t.age/t.life),this.tempQuat.slerpQuaternions(Tk,this.tempQuat,i),t.rotation.multiply(this.tempQuat)):t instanceof TA&&(this.tempQuat.slerpQuaternions(Tk,t.angularVelocity,i),t.rotation.multiply(this.tempQuat))}},{key:"toJSON",value:function(){return{type:this.type,angularVelocity:this.angularVelocity.toJSON(),dynamic:this.dynamic}}},{key:"frameUpdate",value:function(t){}},{key:"clone",value:function(){return new n(this.angularVelocity.clone(),this.dynamic)}},{key:"reset",value:function(){}}],[{key:"fromJSON",value:function(t){return new n(rG(t.angularVelocity),t.dynamic)}}]),n}(),Ik=function(){function n(e,t,i){vt(this,n),te(this,"type","ForceOverLife"),te(this,"_temp",new w),this.x=e,this.y=t,this.z=i}return yt(n,[{key:"initialize",value:function(t){}},{key:"update",value:function(t){this._temp.set(this.x.genValue(t.age/t.life),this.y.genValue(t.age/t.life),this.z.genValue(t.age/t.life)),t.velocity.add(this._temp)}},{key:"toJSON",value:function(){return{type:this.type,x:this.x.toJSON(),y:this.y.toJSON(),z:this.z.toJSON()}}},{key:"frameUpdate",value:function(t){}},{key:"clone",value:function(){return new n(this.x.clone(),this.y.clone(),this.z.clone())}},{key:"reset",value:function(){}}],[{key:"fromJSON",value:function(t){return new n(Gi(t.x),Gi(t.y),Gi(t.z))}}]),n}(),Rk=function(){function n(e,t){vt(this,n),te(this,"type","Noise"),te(this,"generator",new oG),te(this,"duration",0),te(this,"temp",new w),this.frequency=e,this.power=t}return yt(n,[{key:"initialize",value:function(t){t.startTime=this.duration}},{key:"update",value:function(t,i){this.temp.set(this.generator.noise2D(t.startTime*this.frequency.x,t.life/t.age*this.frequency.x),this.generator.noise2D(t.startTime*this.frequency.y+100.25,t.life/t.age*this.frequency.y+100.154),this.generator.noise2D(t.startTime*this.frequency.z+200.89,t.life/t.age*this.frequency.z+200.1)).multiply(this.power),t.position.addScaledVector(this.temp,i)}},{key:"toJSON",value:function(){return{type:this.type,frequency:[this.frequency.x,this.frequency.y,this.frequency.z],power:[this.power.x,this.power.y,this.power.z]}}},{key:"frameUpdate",value:function(t){this.duration+=t}},{key:"clone",value:function(){return new n(this.frequency.clone(),this.power.clone())}},{key:"reset",value:function(){}}],[{key:"fromJSON",value:function(t){return new n(new w(t.frequency[0],t.frequency[1],t.frequency[2]),new w(t.power[0],t.power[1],t.power[2]))}}]),n}(),kne={ApplyForce:{type:"ApplyForce",constructor:bk,params:[["direction","vec3"],["magnitude","value"]],loadJSON:bk.fromJSON},Noise:{type:"Noise",constructor:Rk,params:[["frequency","vec3"],["power","vec3"]],loadJSON:Rk.fromJSON},TurbulenceField:{type:"TurbulenceField",constructor:Ek,params:[["scale","vec3"],["octaves","number"],["velocityMultiplier","vec3"],["timeScale","vec3"]],loadJSON:Ek.fromJSON},GravityForce:{type:"GravityForce",constructor:_k,params:[["center","vec3"],["magnitude","number"]],loadJSON:_k.fromJSON},ColorOverLife:{type:"ColorOverLife",constructor:uk,params:[["color","colorFunc"]],loadJSON:uk.fromJSON},RotationOverLife:{type:"RotationOverLife",constructor:dk,params:[["angularVelocity","valueFunc"],["dynamic","boolean"]],loadJSON:dk.fromJSON},Rotation3DOverLife:{type:"Rotation3DOverLife",constructor:Mk,params:[["angularVelocity","rotationFunc"],["dynamic","boolean"]],loadJSON:Mk.fromJSON},SizeOverLife:{type:"SizeOverLife",constructor:fk,params:[["size","valueFunc"]],loadJSON:fk.fromJSON},ColorBySpeed:{type:"ColorBySpeed",constructor:Ak,params:[["color","colorFunc"],["speedRange","range"]],loadJSON:Ak.fromJSON},RotationBySpeed:{type:"RotationBySpeed",constructor:mk,params:[["angularVelocity","valueFunc"],["speedRange","range"]],loadJSON:mk.fromJSON},SizeBySpeed:{type:"SizeBySpeed",constructor:gk,params:[["size","valueFunc"],["speedRange","range"]],loadJSON:gk.fromJSON},SpeedOverLife:{type:"SpeedOverLife",constructor:pk,params:[["speed","valueFunc"]],loadJSON:pk.fromJSON},FrameOverLife:{type:"FrameOverLife",constructor:vk,params:[["frame","valueFunc"]],loadJSON:vk.fromJSON},ForceOverLife:{type:"ForceOverLife",constructor:Ik,params:[["x","valueFunc"],["y","valueFunc"],["z","valueFunc"]],loadJSON:Ik.fromJSON},OrbitOverLife:{type:"OrbitOverLife",constructor:yk,params:[["orbitSpeed","valueFunc"],["axis","vec3"]],loadJSON:yk.fromJSON},WidthOverLength:{type:"WidthOverLength",constructor:xk,params:[["width","valueFunc"]],loadJSON:xk.fromJSON},ChangeEmitDirection:{type:"ChangeEmitDirection",constructor:wk,params:[["angle","value"]],loadJSON:wk.fromJSON},EmitSubParticleSystem:{type:"EmitSubParticleSystem",constructor:Ck,params:[["particleSystem","self"],["useVelocityAsBasis","boolean"],["subParticleSystem","particleSystem"]],loadJSON:Ck.fromJSON}};function Lne(n,e){return kne[n.type].loadJSON(n,e)}var Pk=function(){function n(){var e,t,i,s,r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};vt(this,n),te(this,"type","cone"),te(this,"radius",void 0),te(this,"arc",void 0),te(this,"thickness",void 0),te(this,"angle",void 0),this.radius=(e=r.radius)!==null&&e!==void 0?e:10,this.arc=(t=r.arc)!==null&&t!==void 0?t:2*Math.PI,this.thickness=(i=r.thickness)!==null&&i!==void 0?i:1,this.angle=(s=r.angle)!==null&&s!==void 0?s:Math.PI/6}return yt(n,[{key:"initialize",value:function(t){var i=Math.random(),s=Vn.lerp(1-this.thickness,1,Math.random()),r=i*this.arc,o=Math.sqrt(s),a=Math.sin(r),c=Math.cos(r);t.position.x=o*c,t.position.y=o*a,t.position.z=0;var l=this.angle*o;t.velocity.set(0,0,Math.cos(l)).addScaledVector(t.position,Math.sin(l)).multiplyScalar(t.startSpeed),t.position.multiplyScalar(this.radius)}},{key:"toJSON",value:function(){return{type:"cone",radius:this.radius,arc:this.arc,thickness:this.thickness,angle:this.angle}}},{key:"clone",value:function(){return new n({radius:this.radius,arc:this.arc,thickness:this.thickness,angle:this.angle})}}],[{key:"fromJSON",value:function(t){return new n(t)}}]),n}(),Bk=function(){function n(){var e,t,i,s,r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};vt(this,n),te(this,"type","donut"),te(this,"radius",void 0),te(this,"arc",void 0),te(this,"thickness",void 0),te(this,"angle",void 0),this.radius=(e=r.radius)!==null&&e!==void 0?e:10,this.arc=(t=r.arc)!==null&&t!==void 0?t:2*Math.PI,this.thickness=(i=r.thickness)!==null&&i!==void 0?i:1,this.angle=(s=r.angle)!==null&&s!==void 0?s:Math.PI/6}return yt(n,[{key:"initialize",value:function(t){var i=Math.random(),s=Vn.lerp(this.thickness,1,Math.random()),r=i*this.arc,o=Math.sqrt(s),a=Math.sin(r),c=Math.cos(r);t.position.x=o*c,t.position.y=o*a,t.position.z=0;var l=this.angle*o;t.velocity.set(0,0,Math.cos(l)).addScaledVector(t.position,Math.sin(l)).multiplyScalar(t.startSpeed),t.position.multiplyScalar(this.radius)}},{key:"toJSON",value:function(){return{type:"donut",radius:this.radius,arc:this.arc,thickness:this.thickness,angle:this.angle}}},{key:"clone",value:function(){return new n({radius:this.radius,arc:this.arc,thickness:this.thickness,angle:this.angle})}}],[{key:"fromJSON",value:function(t){return new n(t)}}]),n}(),Dk=function(){function n(){vt(this,n),te(this,"type","point")}return yt(n,[{key:"initialize",value:function(t){var i=Math.random(),s=Math.random(),r=i*Math.PI*2,o=Math.acos(2*s-1),a=Math.cbrt(Math.random()),c=Math.sin(r),l=Math.cos(r),h=Math.sin(o),d=Math.cos(o);t.velocity.x=a*h*l,t.velocity.y=a*h*c,t.velocity.z=a*d,t.velocity.multiplyScalar(t.startSpeed),t.position.setScalar(0)}},{key:"toJSON",value:function(){return{type:"point"}}},{key:"clone",value:function(){return new n}}],[{key:"fromJSON",value:function(t){return new n}}]),n}(),XT=function(){function n(){var e,t,i,s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};vt(this,n),te(this,"type","sphere"),te(this,"radius",void 0),te(this,"arc",void 0),te(this,"thickness",void 0),this.radius=(e=s.radius)!==null&&e!==void 0?e:10,this.arc=(t=s.arc)!==null&&t!==void 0?t:2*Math.PI,this.thickness=(i=s.thickness)!==null&&i!==void 0?i:1}return yt(n,[{key:"initialize",value:function(t){var i=Math.random(),s=Math.random(),r=Vn.lerp(1-this.thickness,1,Math.random()),o=i*this.arc,a=Math.acos(2*s-1),c=Math.cbrt(r),l=Math.sin(o),h=Math.cos(o),d=Math.sin(a),f=Math.cos(a);t.position.x=c*d*h,t.position.y=c*d*l,t.position.z=c*f,t.velocity.setScalar(0).addScaledVector(t.position,t.startSpeed),t.position.multiplyScalar(this.radius)}},{key:"toJSON",value:function(){return{type:"sphere",radius:this.radius,arc:this.arc,thickness:this.thickness}}},{key:"clone",value:function(){return new n({radius:this.radius,arc:this.arc,thickness:this.thickness})}}],[{key:"fromJSON",value:function(t){return new n(t)}}]),n}(),Ok=function(){function n(e){vt(this,n),te(this,"type","mesh_surface"),te(this,"_triangleIndexToArea",[]),te(this,"_geometry",void 0),te(this,"_tempA",new w),te(this,"_tempB",new w),te(this,"_tempC",new w),e&&(this.geometry=e)}return yt(n,[{key:"geometry",get:function(){return this._geometry},set:function(t){if(this._geometry=t,t!==void 0&&typeof t!="string"){var i=new dr;this._triangleIndexToArea.length=0;var s=0;if(t.getIndex()){var r=t.getIndex().array,o=r.length/3;this._triangleIndexToArea.push(0);for(var a=0;a<o;a++)i.setFromAttributeAndIndices(t.getAttribute("position"),r[a*3],r[a*3+1],r[a*3+2]),s+=i.getArea(),this._triangleIndexToArea.push(s);t.userData.triangleIndexToArea=this._triangleIndexToArea}}}},{key:"initialize",value:function(t){var i=this._geometry;if(!i||i.getIndex()===null){t.position.set(0,0,0),t.velocity.set(0,0,1).multiplyScalar(t.startSpeed);return}for(var s=this._triangleIndexToArea.length-1,r=0,o=s,a=Math.random()*this._triangleIndexToArea[s];r+1<o;){var c=Math.floor((r+o)/2);a<this._triangleIndexToArea[c]?o=c:r=c}var l=Math.random(),h=Math.random();l+h>1&&(l=1-l,h=1-h);var d=i.getIndex().array[r*3],f=i.getIndex().array[r*3+1],p=i.getIndex().array[r*3+2],m=i.getAttribute("position");this._tempA.fromBufferAttribute(m,d),this._tempB.fromBufferAttribute(m,f),this._tempC.fromBufferAttribute(m,p),this._tempB.sub(this._tempA),this._tempC.sub(this._tempA),this._tempA.addScaledVector(this._tempB,l).addScaledVector(this._tempC,h),t.position.copy(this._tempA),this._tempA.copy(this._tempB).cross(this._tempC).normalize(),t.velocity.copy(this._tempA).normalize().multiplyScalar(t.startSpeed)}},{key:"toJSON",value:function(){return{type:"mesh_surface",mesh:this._geometry?this._geometry.uuid:""}}},{key:"clone",value:function(){return new n(this._geometry)}}],[{key:"fromJSON",value:function(t,i){return new n(i.geometries[t.geometry])}}]),n}(),kk=function(){function n(){var e,t,i,s,r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};vt(this,n),te(this,"type","grid"),te(this,"width",void 0),te(this,"height",void 0),te(this,"column",void 0),te(this,"row",void 0),this.width=(e=r.width)!==null&&e!==void 0?e:1,this.height=(t=r.height)!==null&&t!==void 0?t:1,this.column=(i=r.column)!==null&&i!==void 0?i:10,this.row=(s=r.row)!==null&&s!==void 0?s:10}return yt(n,[{key:"initialize",value:function(t){var i=Math.floor(Math.random()*this.row),s=Math.floor(Math.random()*this.column);t.position.x=s*this.width/this.column-this.width/2,t.position.y=i*this.height/this.row-this.height/2,t.position.z=0,t.velocity.set(0,0,t.startSpeed)}},{key:"toJSON",value:function(){return{type:"grid",width:this.width,height:this.height,column:this.column,row:this.row}}},{key:"clone",value:function(){return new n({width:this.width,height:this.height,column:this.column,row:this.row})}}],[{key:"fromJSON",value:function(t){return new n(t)}}]),n}(),Fne={cone:{type:"cone",params:[["radius","number"],["arc","radian"],["thickness","number"],["angle","radian"]],constructor:Pk,loadJSON:Pk.fromJSON},donut:{type:"donut",params:[["radius","number"],["arc","radian"],["thickness","number"],["angle","radian"]],constructor:Bk,loadJSON:Bk.fromJSON},point:{type:"point",params:[],constructor:Dk,loadJSON:Dk.fromJSON},sphere:{type:"sphere",params:[["radius","number"],["arc","radian"],["thickness","number"],["angle","radian"]],constructor:XT,loadJSON:XT.fromJSON},grid:{type:"grid",params:[["width","number"],["height","number"],["rows","number"],["column","number"]],constructor:kk,loadJSON:kk.fromJSON},mesh_surface:{type:"mesh_surface",params:[["geometry","geometry"]],constructor:Ok,loadJSON:Ok.fromJSON}};function Une(n,e){return Fne[n.type].loadJSON(n,e)}var st=function(n){return n[n.BillBoard=0]="BillBoard",n[n.StretchedBillBoard=1]="StretchedBillBoard",n[n.Mesh=2]="Mesh",n[n.Trail=3]="Trail",n[n.HorizontalBillBoard=4]="HorizontalBillBoard",n[n.VerticalBillBoard=5]="VerticalBillBoard",n}({}),aG=function(n){em(t,n);var e=tm(t);function t(i){var s;vt(this,t),s=e.call(this),te(ti(s),"type","VFXBatch"),te(ti(s),"systems",void 0),te(ti(s),"settings",void 0),te(ti(s),"maxParticles",void 0),s.maxParticles=1e3,s.systems=new Set;var r=new Ar;return r.mask=i.layers.mask,s.settings={instancingGeometry:i.instancingGeometry,renderMode:i.renderMode,renderOrder:i.renderOrder,material:i.material.clone(),uTileCount:i.uTileCount,vTileCount:i.vTileCount,layers:r},s.frustumCulled=!1,s.renderOrder=s.settings.renderOrder,s}return yt(t,[{key:"addSystem",value:function(s){this.systems.add(s)}},{key:"removeSystem",value:function(s){this.systems.delete(s)}}]),t}(me),Nne=new w(0,0,1),IC=new Me,zne=new w,Gne=new w;new w;var Lk=60,Vne=new Wn(1,1,1,1),Hne=function(){function n(e){var t,i,s,r,o,a,c,l,h,d,f,p,m,g,y,A,v,b,_,T,E;vt(this,n),te(this,"autoDestroy",void 0),te(this,"prewarm",void 0),te(this,"looping",void 0),te(this,"duration",void 0),te(this,"startLife",void 0),te(this,"startSpeed",void 0),te(this,"startRotation",void 0),te(this,"startSize",void 0),te(this,"startColor",void 0),te(this,"startTileIndex",void 0),te(this,"rendererEmitterSettings",void 0),te(this,"emissionOverTime",void 0),te(this,"emissionOverDistance",void 0),te(this,"emissionBursts",void 0),te(this,"onlyUsedByOther",void 0),te(this,"worldSpace",void 0),te(this,"speedFactor",void 0),te(this,"particleNum",void 0),te(this,"paused",void 0),te(this,"particles",void 0),te(this,"emitterShape",void 0),te(this,"emitter",void 0),te(this,"rendererSettings",void 0),te(this,"neededToUpdateRender",void 0),te(this,"behaviors",void 0),te(this,"prewarmed",void 0),te(this,"emissionState",void 0),te(this,"emitEnded",void 0),te(this,"markForDestroy",void 0),te(this,"previousWorldPos",void 0),te(this,"temp",new w),te(this,"travelDistance",0),te(this,"normalMatrix",new Dt),te(this,"_renderer",void 0),this.autoDestroy=e.autoDestroy===void 0?!1:e.autoDestroy,this.duration=(t=e.duration)!==null&&t!==void 0?t:1,this.looping=e.looping===void 0?!0:e.looping,this.prewarm=e.prewarm===void 0?!1:e.prewarm,this.startLife=(i=e.startLife)!==null&&i!==void 0?i:new Gs(5),this.startSpeed=(s=e.startSpeed)!==null&&s!==void 0?s:new Gs(0),this.startRotation=(r=e.startRotation)!==null&&r!==void 0?r:new Gs(0),this.startSize=(o=e.startSize)!==null&&o!==void 0?o:new Gs(1),this.startColor=(a=e.startColor)!==null&&a!==void 0?a:new s_(new tt(1,1,1,1)),this.emissionOverTime=(c=e.emissionOverTime)!==null&&c!==void 0?c:new Gs(10),this.emissionOverDistance=(l=e.emissionOverDistance)!==null&&l!==void 0?l:new Gs(0),this.emissionBursts=(h=e.emissionBursts)!==null&&h!==void 0?h:[],this.onlyUsedByOther=(d=e.onlyUsedByOther)!==null&&d!==void 0?d:!1,this.emitterShape=(f=e.shape)!==null&&f!==void 0?f:new XT,this.behaviors=(p=e.behaviors)!==null&&p!==void 0?p:new Array,this.worldSpace=(m=e.worldSpace)!==null&&m!==void 0?m:!1,this.speedFactor=(g=e.speedFactor)!==null&&g!==void 0?g:0,this.rendererEmitterSettings=(y=e.rendererEmitterSettings)!==null&&y!==void 0?y:{},this.rendererSettings={instancingGeometry:(A=e.instancingGeometry)!==null&&A!==void 0?A:Vne,renderMode:(v=e.renderMode)!==null&&v!==void 0?v:st.BillBoard,renderOrder:(b=e.renderOrder)!==null&&b!==void 0?b:0,material:e.material,uTileCount:(_=e.uTileCount)!==null&&_!==void 0?_:1,vTileCount:(T=e.vTileCount)!==null&&T!==void 0?T:1,layers:(E=e.layers)!==null&&E!==void 0?E:new Ar},this.neededToUpdateRender=!0,this.particles=new Array,this.startTileIndex=e.startTileIndex||new Gs(0),this.emitter=new Ane(this),this.paused=!1,this.particleNum=0,this.emissionState={burstIndex:0,burstWaveIndex:0,time:0,waitEmiting:0},this.emitEnded=!1,this.markForDestroy=!1,this.prewarmed=!1}return yt(n,[{key:"time",get:function(){return this.emissionState.time},set:function(t){this.emissionState.time=t}},{key:"layers",get:function(){return this.rendererSettings.layers}},{key:"texture",get:function(){return this.rendererSettings.material.map},set:function(t){this.rendererSettings.material.map=t,this.neededToUpdateRender=!0}},{key:"material",get:function(){return this.rendererSettings.material},set:function(t){this.rendererSettings.material=t,this.neededToUpdateRender=!0}},{key:"uTileCount",get:function(){return this.rendererSettings.uTileCount},set:function(t){this.rendererSettings.uTileCount=t,this.neededToUpdateRender=!0}},{key:"vTileCount",get:function(){return this.rendererSettings.vTileCount},set:function(t){this.rendererSettings.vTileCount=t,this.neededToUpdateRender=!0}},{key:"instancingGeometry",get:function(){return this.rendererSettings.instancingGeometry},set:function(t){this.restart(),this.particles.length=0,this.rendererSettings.instancingGeometry=t,this.neededToUpdateRender=!0}},{key:"renderMode",get:function(){return this.rendererSettings.renderMode},set:function(t){if((this.rendererSettings.renderMode!=st.Trail&&t===st.Trail||this.rendererSettings.renderMode==st.Trail&&t!==st.Trail)&&(this.restart(),this.particles.length=0),this.rendererSettings.renderMode!==t)switch(t){case st.Trail:this.rendererEmitterSettings={startLength:new Gs(30),followLocalOrigin:!1};break;case st.Mesh:this.rendererEmitterSettings={geometry:new Wn(1,1)},this.startRotation=new sG(new w(0,1,0),new Gs(0));break;case st.BillBoard:case st.VerticalBillBoard:case st.HorizontalBillBoard:case st.StretchedBillBoard:this.rendererEmitterSettings={},this.rendererSettings.renderMode===st.Mesh&&(this.startRotation=new Gs(0));break}this.rendererSettings.renderMode=t,this.neededToUpdateRender=!0}},{key:"renderOrder",get:function(){return this.rendererSettings.renderOrder},set:function(t){this.rendererSettings.renderOrder=t,this.neededToUpdateRender=!0}},{key:"blending",get:function(){return this.rendererSettings.material.blending},set:function(t){this.rendererSettings.material.blending=t,this.neededToUpdateRender=!0}},{key:"pause",value:function(){this.paused=!0}},{key:"play",value:function(){this.paused=!1}},{key:"spawn",value:function(t,i,s){IC.setFromRotationMatrix(s);var r=zne,o=IC,a=Gne;s.decompose(r,o,a);for(var c=0;c<t;c++){for(this.particleNum++;this.particles.length<this.particleNum;)this.rendererSettings.renderMode===st.Trail?this.particles.push(new MA):this.particles.push(new TA);var l=this.particles[this.particleNum-1];if(this.startColor.genColor(l.startColor,this.emissionState.time,{}),l.color.copy(l.startColor),l.startSpeed=this.startSpeed.genValue(i.time/this.duration),l.life=this.startLife.genValue(i.time/this.duration),l.age=0,l.startSize=this.startSize.genValue(i.time/this.duration),l.uvTile=Math.floor(this.startTileIndex.genValue()),l.size=l.startSize,this.rendererSettings.renderMode===st.Mesh||this.rendererSettings.renderMode===st.BillBoard||this.rendererSettings.renderMode===st.VerticalBillBoard||this.rendererSettings.renderMode===st.HorizontalBillBoard||this.rendererSettings.renderMode===st.StretchedBillBoard){var h=l;this.rendererSettings.renderMode===st.Mesh?(h.rotation instanceof Me||(h.rotation=new Me),this.startRotation.type==="rotation"?this.startRotation.genValue(h.rotation,i.time/this.duration):h.rotation.setFromAxisAngle(Nne,this.startRotation.genValue(i.time/this.duration))):this.startRotation.type==="rotation"?h.rotation=0:h.rotation=this.startRotation.genValue(i.time/this.duration)}else if(this.rendererSettings.renderMode===st.Trail){var d=l;d.length=this.rendererEmitterSettings.startLength.genValue(i.time/this.duration),d.reset()}if(this.emitterShape.initialize(l),this.rendererSettings.renderMode===st.Trail&&this.rendererEmitterSettings.followLocalOrigin){var f=l;f.localPosition=new w().copy(f.position)}this.worldSpace?(l.position.applyMatrix4(s),l.startSize=l.startSize*(Math.abs(a.x)+Math.abs(a.y)+Math.abs(a.z))/3,l.size=l.startSize,l.velocity.multiply(a).applyMatrix3(this.normalMatrix),l.rotation&&l.rotation instanceof Me&&l.rotation.multiplyQuaternions(IC,l.rotation)):this.onlyUsedByOther&&(l.parentMatrix=s);for(var p=0;p<this.behaviors.length;p++)this.behaviors[p].initialize(l)}}},{key:"endEmit",value:function(){this.emitEnded=!0,this.autoDestroy&&(this.markForDestroy=!0)}},{key:"dispose",value:function(){this._renderer&&this._renderer.deleteSystem(this),this.emitter.dispose(),this.emitter.parent&&this.emitter.parent.remove(this.emitter)}},{key:"restart",value:function(){this.paused=!1,this.particleNum=0,this.emissionState.burstIndex=0,this.emissionState.burstWaveIndex=0,this.emissionState.time=0,this.emissionState.waitEmiting=0,this.behaviors.forEach(function(t){t.reset()}),this.emitEnded=!1,this.markForDestroy=!1,this.prewarmed=!1}},{key:"update",value:function(t){if(!this.paused){for(var i=this.emitter;i.parent;)i=i.parent;if(i.type!=="Scene"){this.dispose();return}if(this.emitEnded&&this.particleNum===0){this.markForDestroy&&this.emitter.parent&&this.dispose();return}if(this.looping&&this.prewarm&&!this.prewarmed){this.prewarmed=!0;for(var s=0;s<this.duration*Lk;s++)this.update(1/Lk)}t>.1&&(t=.1),this.neededToUpdateRender&&(this._renderer&&this._renderer.updateSystem(this),this.neededToUpdateRender=!1),this.onlyUsedByOther||this.emit(t,this.emissionState,this.emitter.matrixWorld);for(var r=0;r<this.behaviors.length;r++){for(var o=0;o<this.particleNum;o++)this.particles[o].died||this.behaviors[r].update(this.particles[o],t);this.behaviors[r].frameUpdate(t)}for(var a=0;a<this.particleNum;a++)this.rendererEmitterSettings.followLocalOrigin&&this.particles[a].localPosition?(this.particles[a].position.copy(this.particles[a].localPosition),this.particles[a].parentMatrix?this.particles[a].position.applyMatrix4(this.particles[a].parentMatrix):this.particles[a].position.applyMatrix4(this.emitter.matrixWorld)):this.particles[a].position.addScaledVector(this.particles[a].velocity,t),this.particles[a].age+=t;if(this.rendererSettings.renderMode===st.Trail)for(var c=0;c<this.particleNum;c++){var l=this.particles[c];l.update()}for(var h=0;h<this.particleNum;h++){var d=this.particles[h];d.died&&(!(d instanceof MA)||d.previous.length===0)&&(this.particles[h]=this.particles[this.particleNum-1],this.particles[this.particleNum-1]=d,this.particleNum--,h--)}}}},{key:"emit",value:function(t,i,s){i.time>this.duration&&(this.looping?(i.time-=this.duration,i.burstIndex=0,this.behaviors.forEach(function(l){l.reset()})):!this.emitEnded&&!this.onlyUsedByOther&&this.endEmit()),this.normalMatrix.getNormalMatrix(s);var r=Math.ceil(i.waitEmiting);for(this.spawn(r,i,s),i.waitEmiting-=r;i.burstIndex<this.emissionBursts.length&&this.emissionBursts[i.burstIndex].time<=i.time;){if(Math.random()<this.emissionBursts[i.burstIndex].probability){var o=this.emissionBursts[i.burstIndex].count;this.spawn(o,i,s)}i.burstIndex++}if(!this.emitEnded&&(i.waitEmiting+=t*this.emissionOverTime.genValue(i.time/this.duration),this.previousWorldPos!=null)){this.emitter.getWorldPosition(this.temp),this.travelDistance+=this.previousWorldPos.distanceTo(this.temp);var a=this.emissionOverDistance.genValue(i.time/this.duration);if(this.travelDistance*a>0){var c=Math.floor(this.travelDistance*a);this.travelDistance-=c/a,i.waitEmiting+=c}}this.previousWorldPos===void 0&&(this.previousWorldPos=new w),this.emitter.getWorldPosition(this.previousWorldPos),i.time+=t}},{key:"toJSON",value:function(t){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},s=t===void 0||typeof t=="string";if(s&&(t={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}}),t.materials[this.rendererSettings.material.uuid]=this.rendererSettings.material.toJSON(t),i.useUrlForImage&&this.texture.source!==void 0){var r=this.texture.source;t.images[r.uuid]={uuid:r.uuid,url:this.texture.image.url}}var o;this.renderMode===st.Trail?o={startLength:this.rendererEmitterSettings.startLength.toJSON(),followLocalOrigin:this.rendererEmitterSettings.followLocalOrigin}:this.renderMode===st.Mesh?o={}:o={};var a=this.rendererSettings.instancingGeometry;return t.geometries&&!t.geometries[a.uuid]&&(t.geometries[a.uuid]=a.toJSON()),{version:"2.0",autoDestroy:this.autoDestroy,looping:this.looping,prewarm:this.prewarm,duration:this.duration,shape:this.emitterShape.toJSON(),startLife:this.startLife.toJSON(),startSpeed:this.startSpeed.toJSON(),startRotation:this.startRotation.toJSON(),startSize:this.startSize.toJSON(),startColor:this.startColor.toJSON(),emissionOverTime:this.emissionOverTime.toJSON(),emissionOverDistance:this.emissionOverDistance.toJSON(),emissionBursts:this.emissionBursts,onlyUsedByOther:this.onlyUsedByOther,instancingGeometry:this.rendererSettings.instancingGeometry.uuid,renderOrder:this.renderOrder,renderMode:this.renderMode,rendererEmitterSettings:o,speedFactor:this.renderMode===st.StretchedBillBoard?this.speedFactor:0,material:this.rendererSettings.material.uuid,layers:this.layers.mask,startTileIndex:this.startTileIndex.toJSON(),uTileCount:this.uTileCount,vTileCount:this.vTileCount,behaviors:this.behaviors.map(function(c){return c.toJSON()}),worldSpace:this.worldSpace}}},{key:"addBehavior",value:function(t){this.behaviors.push(t)}},{key:"getRendererSettings",value:function(){return this.rendererSettings}},{key:"clone",value:function(){var t=[],i=lk(this.emissionBursts),s;try{for(i.s();!(s=i.n()).done;){var r=s.value,o={};Object.assign(o,r),t.push(o)}}catch(p){i.e(p)}finally{i.f()}var a=[],c=lk(this.behaviors),l;try{for(c.s();!(l=c.n()).done;){var h=l.value;a.push(h.clone())}}catch(p){c.e(p)}finally{c.f()}var d;this.renderMode===st.Trail?d={startLength:this.rendererEmitterSettings.startLength.clone(),followLocalOrigin:this.rendererEmitterSettings.followLocalOrigin}:d={};var f=new Ar;return f.mask=this.layers.mask,new n({autoDestroy:this.autoDestroy,looping:this.looping,duration:this.duration,shape:this.emitterShape.clone(),startLife:this.startLife.clone(),startSpeed:this.startSpeed.clone(),startRotation:this.startRotation.clone(),startSize:this.startSize.clone(),startColor:this.startColor.clone(),emissionOverTime:this.emissionOverTime.clone(),emissionOverDistance:this.emissionOverDistance.clone(),emissionBursts:t,onlyUsedByOther:this.onlyUsedByOther,instancingGeometry:this.rendererSettings.instancingGeometry,renderMode:this.renderMode,renderOrder:this.renderOrder,rendererEmitterSettings:d,speedFactor:this.speedFactor,material:this.rendererSettings.material,startTileIndex:this.startTileIndex,uTileCount:this.uTileCount,vTileCount:this.vTileCount,behaviors:a,worldSpace:this.worldSpace,layers:f})}}],[{key:"fromJSON",value:function(t,i,s){var r,o=Une(t.shape,i),a;t.renderMode===st.Trail?a={startLength:t.rendererEmitterSettings.startLength!=null?Gi(t.rendererEmitterSettings.startLength):new Gs(30),followLocalOrigin:t.rendererEmitterSettings.followLocalOrigin}:t.renderMode===st.Mesh?a={}:a={};var c=new Ar;t.layers&&(c.mask=t.layers);var l=new n({autoDestroy:t.autoDestroy,looping:t.looping,prewarm:t.prewarm,duration:t.duration,shape:o,startLife:Gi(t.startLife),startSpeed:Gi(t.startSpeed),startRotation:Tne(t.startRotation),startSize:Gi(t.startSize),startColor:QI(t.startColor),emissionOverTime:Gi(t.emissionOverTime),emissionOverDistance:Gi(t.emissionOverDistance),emissionBursts:t.emissionBursts,onlyUsedByOther:t.onlyUsedByOther,instancingGeometry:i.geometries[t.instancingGeometry],renderMode:t.renderMode,rendererEmitterSettings:a,renderOrder:t.renderOrder,speedFactor:t.speedFactor,layers:c,material:t.material?i.materials[t.material]:t.texture?new ri({map:i.textures[t.texture],transparent:(r=t.transparent)!==null&&r!==void 0?r:!0,blending:t.blending,side:Ai}):new ri({color:16777215,transparent:!0,blending:cd,side:Ai}),startTileIndex:typeof t.startTileIndex=="number"?new Gs(t.startTileIndex):Gi(t.startTileIndex),uTileCount:t.uTileCount,vTileCount:t.vTileCount,behaviors:[],worldSpace:t.worldSpace});return l.behaviors=t.behaviors.map(function(h){var d=Lne(h,l);return d.type==="EmitSubParticleSystem"&&(s[h.subParticleSystem]=d),d}),l}}]),n}(),RC=`

#include <common>
#include <uv_pars_fragment>
#include <color_pars_fragment>
#include <map_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
#include <alphatest_pars_fragment>

void main() {

    #include <clipping_planes_fragment>
    
    vec3 outgoingLight = vec3( 0.0 );
    vec4 diffuseColor = vColor;
    
    #include <logdepthbuf_fragment>
    
    #ifdef USE_MAP
    diffuseColor *= texture2D( map, vMapUv);
    #endif
    
    #include <alphatest_fragment>

    outgoingLight = diffuseColor.rgb;
    
    gl_FragColor = vec4( outgoingLight, diffuseColor.a );
    
    #include <tonemapping_fragment>

}
`,Qne=`
#define STANDARD
#ifdef PHYSICAL
#define IOR
#define SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
uniform float ior;
#endif
#ifdef SPECULAR
uniform float specularIntensity;
uniform vec3 specularColor;
#ifdef USE_SPECULARINTENSITYMAP
uniform sampler2D specularIntensityMap;
#endif
#ifdef USE_SPECULARCOLORMAP
uniform sampler2D specularColorMap;
#endif
#endif
#ifdef USE_CLEARCOAT
uniform float clearcoat;
uniform float clearcoatRoughness;
#endif
#ifdef USE_IRIDESCENCE
uniform float iridescence;
uniform float iridescenceIOR;
uniform float iridescenceThicknessMinimum;
uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
uniform vec3 sheenColor;
uniform float sheenRoughness;
#ifdef USE_SHEENCOLORMAP
uniform sampler2D sheenColorMap;
#endif
#ifdef USE_SHEENROUGHNESSMAP
uniform sampler2D sheenRoughnessMap;
#endif
#endif

varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <bsdfs>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>

void main() {
    #include <clipping_planes_fragment>
    vec4 diffuseColor = vec4( diffuse, opacity );
    ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
    vec3 totalEmissiveRadiance = emissive;
    #include <logdepthbuf_fragment>
    #include <map_fragment>
    #include <color_fragment>
    #include <alphamap_fragment>
    #include <alphatest_fragment>
    #include <roughnessmap_fragment>
    #include <metalnessmap_fragment>
    #include <normal_fragment_begin>
    #include <normal_fragment_maps>
    #include <clearcoat_normal_fragment_begin>
    #include <clearcoat_normal_fragment_maps>
    #include <emissivemap_fragment>
    // accumulation
    #include <lights_physical_fragment>
    #include <lights_fragment_begin>
    #include <lights_fragment_maps>
    #include <lights_fragment_end>
    // modulation
    #include <aomap_fragment>
    vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
    vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
    #include <transmission_fragment>
    vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
    #ifdef USE_SHEEN
    // Sheen energy compensation approximation calculation can be found at the end of
        // https://drive.google.com/file/d/1T0D1VSyR4AllqIJTQAraEIzjlb5h4FKH/view?usp=sharing
        float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
        outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecular;
    #endif
    #ifdef USE_CLEARCOAT
        float dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );
        vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
        outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;
    #endif
    #include <output_fragment>
    #include <tonemapping_fragment>
    #include <encodings_fragment>
    #include <fog_fragment>
    #include <premultiplied_alpha_fragment>
    #include <dithering_fragment>
}`,Sv=`

    #ifdef UV_TILE
        float col = mod(uvTile, tileCount.x);
        float row = (tileCount.y - floor(uvTile / tileCount.x) - 1.0);
        
        mat3 tileTransform = mat3(
          1.0 / tileCount.x, 0.0, 0.0,
          0.0, 1.0 / tileCount.y, 0.0, 
          col / tileCount.x, row / tileCount.y, 1.0);
    #else
        mat3 tileTransform = mat3(1.0, 0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 1.0);
    #endif

#if defined( USE_UV ) || defined( USE_ANISOTROPY )

vUv = (tileTransform *vec3( uv, 1 )).xy;

#endif
#ifdef USE_MAP

vMapUv = ( tileTransform * (mapTransform * vec3( MAP_UV, 1 ) )).xy;

#endif
#ifdef USE_ALPHAMAP

vAlphaMapUv = ( tileTransform * (alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_LIGHTMAP

vLightMapUv = ( tileTransform * (lightMapTransform * vec3( LIGHTMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_AOMAP

vAoMapUv = ( tileTransform * (aoMapTransform * vec3( AOMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_BUMPMAP

vBumpMapUv = ( tileTransform * (bumpMapTransform * vec3( BUMPMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_NORMALMAP

vNormalMapUv = ( tileTransform * (normalMapTransform * vec3( NORMALMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_DISPLACEMENTMAP

vDisplacementMapUv = ( tileTransform * (displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_EMISSIVEMAP

vEmissiveMapUv = ( tileTransform * (emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_METALNESSMAP

vMetalnessMapUv = ( tileTransform * (metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_ROUGHNESSMAP

vRoughnessMapUv = ( tileTransform * (roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_ANISOTROPYMAP

vAnisotropyMapUv = ( tileTransform * (anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_CLEARCOATMAP

vClearcoatMapUv = ( tileTransform * (clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_CLEARCOAT_NORMALMAP

vClearcoatNormalMapUv = ( tileTransform * (clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP

vClearcoatRoughnessMapUv = ( tileTransform * (clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_IRIDESCENCEMAP

vIridescenceMapUv = ( tileTransform * (iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP

vIridescenceThicknessMapUv = ( tileTransform * (iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_SHEEN_COLORMAP

vSheenColorMapUv = ( tileTransform * (sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_SHEEN_ROUGHNESSMAP

vSheenRoughnessMapUv = ( tileTransform * (sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_SPECULARMAP

vSpecularMapUv = ( tileTransform * (specularMapTransform * vec3( SPECULARMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_SPECULAR_COLORMAP

vSpecularColorMapUv = ( tileTransform * (specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_SPECULAR_INTENSITYMAP

vSpecularIntensityMapUv = ( tileTransform * (specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_TRANSMISSIONMAP

vTransmissionMapUv = ( tileTransform * transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_THICKNESSMAP

vThicknessMapUv = ( tileTransform * thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) )).xy;

#endif
`,jne=`
#include <common>
#include <color_pars_vertex>
#include <uv_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>

attribute vec3 offset;
attribute float rotation;
attribute float size;
attribute float uvTile;

#ifdef UV_TILE
uniform vec2 tileCount;
#endif

void main() {

    `.concat(Sv,`
	
    vec2 alignedPosition = ( position.xy ) * size;
    
    vec2 rotatedPosition;
    rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
    rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
#ifdef HORIZONTAL
    vec4 mvPosition = modelMatrix * vec4( offset, 1.0 );
    mvPosition.x += rotatedPosition.x;
    mvPosition.z -= rotatedPosition.y;
    mvPosition = viewMatrix * mvPosition;
#elif defined(VERTICAL)
    vec4 mvPosition = modelMatrix * vec4( offset, 1.0 );
    mvPosition.y += rotatedPosition.y;
    mvPosition = viewMatrix * mvPosition;
    mvPosition.x += rotatedPosition.x;
#else
    vec4 mvPosition = modelViewMatrix * vec4( offset, 1.0 );
    mvPosition.xy += rotatedPosition;
#endif

	vColor = color;

	gl_Position = projectionMatrix * mvPosition;

	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>

}
`),Wne=`
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>

attribute vec3 offset;
attribute vec4 rotation;
attribute float size;
// attribute vec4 color;
attribute float uvTile;

#ifdef UV_TILE
uniform vec2 tileCount;
#endif

void main() {

    `.concat(Sv,`
    
    float x2 = rotation.x + rotation.x, y2 = rotation.y + rotation.y, z2 = rotation.z + rotation.z;
    float xx = rotation.x * x2, xy = rotation.x * y2, xz = rotation.x * z2;
    float yy = rotation.y * y2, yz = rotation.y * z2, zz = rotation.z * z2;
    float wx = rotation.w * x2, wy = rotation.w * y2, wz = rotation.w * z2;
    float sx = size, sy = size, sz = size;
    
    mat4 matrix = mat4(( 1.0 - ( yy + zz ) ) * sx, ( xy + wz ) * sx, ( xz - wy ) * sx, 0.0,  // 1. column
                      ( xy - wz ) * sy, ( 1.0 - ( xx + zz ) ) * sy, ( yz + wx ) * sy, 0.0,  // 2. column
                      ( xz + wy ) * sz, ( yz - wx ) * sz, ( 1.0 - ( xx + yy ) ) * sz, 0.0,  // 3. column
                      offset.x, offset.y, offset.z, 1.0);
    
    vec4 mvPosition = modelViewMatrix * (matrix * vec4( position, 1.0 ));

	vColor = color;

	gl_Position = projectionMatrix * mvPosition;

	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>

}
`),qne=`
#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <uv_pars_vertex>

attribute vec3 offset;
attribute vec4 rotation;
attribute float size;
attribute float uvTile;

#ifdef UV_TILE
uniform vec2 tileCount;
#endif

#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>

void main() {
    `.concat(Sv,`

    float x2 = rotation.x + rotation.x, y2 = rotation.y + rotation.y, z2 = rotation.z + rotation.z;
    float xx = rotation.x * x2, xy = rotation.x * y2, xz = rotation.x * z2;
    float yy = rotation.y * y2, yz = rotation.y * z2, zz = rotation.z * z2;
    float wx = rotation.w * x2, wy = rotation.w * y2, wz = rotation.w * z2;
    float sx = size, sy = size, sz = size;

    mat4 particleMatrix = mat4(( 1.0 - ( yy + zz ) ) * sx, ( xy + wz ) * sx, ( xz - wy ) * sx, 0.0,  // 1. column
                      ( xy - wz ) * sy, ( 1.0 - ( xx + zz ) ) * sy, ( yz + wx ) * sy, 0.0,  // 2. column
                      ( xz + wy ) * sz, ( yz - wx ) * sz, ( 1.0 - ( xx + yy ) ) * sz, 0.0,  // 3. column
                      offset.x, offset.y, offset.z, 1.0);

	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>

	// replace defaultnormal_vertex
	vec3 transformedNormal = objectNormal;
    mat3 m = mat3( particleMatrix );
    transformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );
    transformedNormal = m * transformedNormal;
    transformedNormal = normalMatrix * transformedNormal;
    #ifdef FLIP_SIDED
        transformedNormal = - transformedNormal;
    #endif
    #ifdef USE_TANGENT
        vec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;
        #ifdef FLIP_SIDED
        transformedTangent = - transformedTangent;
        #endif
    #endif

	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>

	// replace include <project_vertex>
  vec4 mvPosition = vec4( transformed, 1.0 );
  mvPosition = modelViewMatrix * (particleMatrix * mvPosition);
	gl_Position = projectionMatrix * mvPosition;

	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	
	vViewPosition = - mvPosition.xyz;
	
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}
`),Xne=`
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>

attribute vec3 offset;
attribute float rotation;
attribute float size;
attribute vec3 velocity;
attribute float uvTile;

#ifdef UV_TILE
uniform vec2 tileCount;
#endif

uniform float speedFactor;

void main() {

    `.concat(Sv,`
	
    vec4 mvPosition = modelViewMatrix * vec4( offset, 1.0 );
    vec3 viewVelocity = normalMatrix * velocity;

    vec3 scaledPos = vec3(position.xy * size, position.z);
    mvPosition.xyz += scaledPos + dot(scaledPos, viewVelocity) * viewVelocity / length(viewVelocity) * speedFactor;

	vColor = color;

	gl_Position = projectionMatrix * mvPosition;

	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>

}
`);function YT(n){return n===0?"uv":"uv".concat(n)}new w(0,0,1);var Yne=function(n){em(t,n);var e=tm(t);function t(i){var s;return vt(this,t),s=e.call(this,i),te(ti(s),"offsetBuffer",void 0),te(ti(s),"rotationBuffer",void 0),te(ti(s),"sizeBuffer",void 0),te(ti(s),"colorBuffer",void 0),te(ti(s),"uvTileBuffer",void 0),te(ti(s),"velocityBuffer",void 0),te(ti(s),"vector_",new w),te(ti(s),"vector2_",new w),te(ti(s),"vector3_",new w),te(ti(s),"quaternion_",new Me),te(ti(s),"quaternion2_",new Me),te(ti(s),"quaternion3_",new Me),te(ti(s),"rotationMat_",new Dt),te(ti(s),"rotationMat2_",new Dt),s.maxParticles=1e3,s.setupBuffers(),s.rebuildMaterial(),s}return yt(t,[{key:"buildExpandableBuffers",value:function(){this.offsetBuffer=new Or(new Float32Array(this.maxParticles*3),3),this.offsetBuffer.setUsage(Vs),this.geometry.setAttribute("offset",this.offsetBuffer),this.colorBuffer=new Or(new Float32Array(this.maxParticles*4),4),this.colorBuffer.setUsage(Vs),this.geometry.setAttribute("color",this.colorBuffer),this.settings.renderMode===st.Mesh?(this.rotationBuffer=new Or(new Float32Array(this.maxParticles*4),4),this.rotationBuffer.setUsage(Vs),this.geometry.setAttribute("rotation",this.rotationBuffer)):(this.settings.renderMode===st.BillBoard||this.settings.renderMode===st.HorizontalBillBoard||this.settings.renderMode===st.VerticalBillBoard||this.settings.renderMode===st.StretchedBillBoard)&&(this.rotationBuffer=new Or(new Float32Array(this.maxParticles),1),this.rotationBuffer.setUsage(Vs),this.geometry.setAttribute("rotation",this.rotationBuffer)),this.sizeBuffer=new Or(new Float32Array(this.maxParticles),1),this.sizeBuffer.setUsage(Vs),this.geometry.setAttribute("size",this.sizeBuffer),this.uvTileBuffer=new Or(new Float32Array(this.maxParticles),1),this.uvTileBuffer.setUsage(Vs),this.geometry.setAttribute("uvTile",this.uvTileBuffer),this.settings.renderMode===st.StretchedBillBoard&&(this.velocityBuffer=new Or(new Float32Array(this.maxParticles*3),3),this.velocityBuffer.setUsage(Vs),this.geometry.setAttribute("velocity",this.velocityBuffer))}},{key:"setupBuffers",value:function(){this.geometry&&this.geometry.dispose(),this.geometry=new Z_,this.geometry.setIndex(this.settings.instancingGeometry.getIndex()),this.settings.instancingGeometry.hasAttribute("normal")&&this.geometry.setAttribute("normal",this.settings.instancingGeometry.getAttribute("normal")),this.geometry.setAttribute("position",this.settings.instancingGeometry.getAttribute("position")),this.geometry.setAttribute("uv",this.settings.instancingGeometry.getAttribute("uv")),this.buildExpandableBuffers()}},{key:"expandBuffers",value:function(s){for(;s>=this.maxParticles;)this.maxParticles*=2;this.setupBuffers()}},{key:"rebuildMaterial",value:function(){this.layers.mask=this.settings.layers.mask;var s,r={};if(this.settings.material.type==="MeshStandardMaterial"||this.settings.material.type==="MeshPhysicalMaterial"){var o=this.settings.material;s=Ep.merge([De.common,De.envmap,De.aomap,De.lightmap,De.emissivemap,De.bumpmap,De.normalmap,De.displacementmap,De.roughnessmap,De.metalnessmap,De.fog,De.lights,{emissive:{value:new ye(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),s.diffuse.value=o.color,s.opacity.value=o.opacity,s.emissive.value=o.emissive,s.roughness.value=o.roughness,s.metalness.value=o.metalness,o.envMap&&(s.envMap.value=o.envMap,s.envMapIntensity.value=o.envMapIntensity),o.normalMap&&(s.normalMap.value=o.normalMap,s.normalScale.value=o.normalScale),o.roughnessMap&&(s.roughnessMap.value=o.roughnessMap),o.metalnessMap&&(s.metalnessMap.value=o.metalnessMap),o.map&&(s.map=new we(o.map))}else s={},s.map=new we(this.settings.material.map);this.settings.material.alphaTest&&(r.USE_ALPHATEST="",s.alphaTest=new we(this.settings.material.alphaTest)),r.USE_UV="";var a=this.settings.uTileCount,c=this.settings.vTileCount;(a>1||c>1)&&(r.UV_TILE="",s.tileCount=new we(new ie(a,c))),this.settings.material.normalMap&&(r.USE_NORMALMAP="",r.NORMALMAP_UV=YT(this.settings.material.normalMap.channel),s.normalMapTransform=new we(new Dt().copy(this.settings.material.normalMap.matrix))),this.settings.material.map&&(r.USE_MAP="",r.MAP_UV=YT(this.settings.material.map.channel),s.mapTransform=new we(new Dt().copy(this.settings.material.map.matrix))),r.USE_COLOR_ALPHA="";var l=!1;if(this.settings.renderMode===st.BillBoard||this.settings.renderMode===st.VerticalBillBoard||this.settings.renderMode===st.HorizontalBillBoard||this.settings.renderMode===st.Mesh){var h,d;this.settings.renderMode===st.Mesh?this.settings.material.type==="MeshStandardMaterial"||this.settings.material.type==="MeshPhysicalMaterial"?(r.USE_COLOR="",h=qne,d=Qne,l=!0):(h=Wne,d=RC):(h=jne,d=RC),this.settings.renderMode===st.VerticalBillBoard?r.VERTICAL="":this.settings.renderMode===st.HorizontalBillBoard&&(r.HORIZONTAL=""),this.material=new Et({uniforms:s,defines:r,vertexShader:h,fragmentShader:d,transparent:this.settings.material.transparent,depthWrite:!this.settings.material.transparent,blending:this.settings.material.blending,side:this.settings.material.side,alphaTest:this.settings.material.alphaTest,lights:l})}else if(this.settings.renderMode===st.StretchedBillBoard)s.speedFactor=new we(1),this.material=new Et({uniforms:s,defines:r,vertexShader:Xne,fragmentShader:RC,transparent:this.settings.material.transparent,depthWrite:!this.settings.material.transparent,blending:this.settings.material.blending,side:this.settings.material.side,alphaTest:this.settings.material.alphaTest});else throw new Error("render mode unavailable")}},{key:"update",value:function(){var s=this,r=0,o=0;this.systems.forEach(function(a){o+=a.particleNum}),o>this.maxParticles&&this.expandBuffers(o),this.systems.forEach(function(a){var c=a.particles,l=a.particleNum,h=s.quaternion2_,d=s.vector2_,f=s.vector3_;a.emitter.matrixWorld.decompose(d,h,f),s.rotationMat_.setFromMatrix4(a.emitter.matrixWorld);for(var p=0;p<l;p++,r++){var m=c[p];if(s.settings.renderMode===st.Mesh){var g=void 0;if(a.worldSpace)g=m.rotation;else{var y=void 0;m.parentMatrix?y=s.quaternion3_.setFromRotationMatrix(m.parentMatrix):y=h,g=s.quaternion_,g.copy(m.rotation).multiply(y)}s.rotationBuffer.setXYZW(r,g.x,g.y,g.z,g.w)}else(s.settings.renderMode===st.StretchedBillBoard||s.settings.renderMode===st.VerticalBillBoard||s.settings.renderMode===st.HorizontalBillBoard||s.settings.renderMode===st.BillBoard)&&s.rotationBuffer.setX(r,m.rotation);var A=void 0;if(a.worldSpace?A=m.position:(A=s.vector_,m.parentMatrix?A.copy(m.position).applyMatrix4(m.parentMatrix):A.copy(m.position).applyMatrix4(a.emitter.matrixWorld)),s.offsetBuffer.setXYZ(r,A.x,A.y,A.z),s.colorBuffer.setXYZW(r,m.color.x,m.color.y,m.color.z,m.color.w),a.worldSpace||m.parentMatrix?s.sizeBuffer.setX(r,m.size):s.sizeBuffer.setX(r,m.size*(Math.abs(f.x)+Math.abs(f.y)+Math.abs(f.z))/3),s.uvTileBuffer.setX(r,m.uvTile),s.settings.renderMode===st.StretchedBillBoard&&s.velocityBuffer){var v=a.speedFactor,b=void 0;a.worldSpace?b=m.velocity:(b=s.vector_,m.parentMatrix?(s.rotationMat2_.setFromMatrix4(m.parentMatrix),b.copy(m.velocity).applyMatrix3(s.rotationMat2_)):b.copy(m.velocity).applyMatrix3(s.rotationMat_)),s.velocityBuffer.setXYZ(r,b.x*v,b.y*v,b.z*v)}}}),this.geometry.instanceCount=r,r>0&&(this.offsetBuffer.updateRange.count=r*3,this.offsetBuffer.needsUpdate=!0,this.sizeBuffer.updateRange.count=r,this.sizeBuffer.needsUpdate=!0,this.colorBuffer.updateRange.count=r*4,this.colorBuffer.needsUpdate=!0,this.uvTileBuffer.updateRange.count=r,this.uvTileBuffer.needsUpdate=!0,this.settings.renderMode===st.StretchedBillBoard&&this.velocityBuffer&&(this.velocityBuffer.updateRange.count=r*3,this.velocityBuffer.needsUpdate=!0),this.settings.renderMode===st.Mesh?(this.rotationBuffer.updateRange.count=r*4,this.rotationBuffer.needsUpdate=!0):(this.settings.renderMode===st.StretchedBillBoard||this.settings.renderMode===st.HorizontalBillBoard||this.settings.renderMode===st.VerticalBillBoard||this.settings.renderMode===st.BillBoard)&&(this.rotationBuffer.updateRange.count=r,this.rotationBuffer.needsUpdate=!0))}},{key:"dispose",value:function(){this.geometry.dispose()}}]),t}(aG),Jne=`

#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>

uniform sampler2D alphaMap;
uniform float useAlphaMap;
uniform float visibility;
uniform float alphaTest;
uniform vec2 repeat;

varying vec4 vColor;
    
void main() {
    #include <clipping_planes_fragment>
    #include <logdepthbuf_fragment>

    vec4 c = vColor;
    
    #ifdef USE_MAP
    c *= texture2D( map, vUv * repeat );
    #endif
    if( useAlphaMap == 1. ) c.a *= texture2D( alphaMap, vUv * repeat ).a;
    if( c.a < alphaTest ) discard;
    gl_FragColor = c;

    #include <fog_fragment>
    #include <tonemapping_fragment>
}`,Kne=`
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <clipping_planes_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <fog_pars_vertex>

attribute vec3 previous;
attribute vec3 next;
attribute float side;
attribute float width;

uniform vec2 resolution;
uniform float lineWidth;
uniform float sizeAttenuation;
    
vec2 fix(vec4 i, float aspect) {
    vec2 res = i.xy / i.w;
    res.x *= aspect;
    return res;
}
    
void main() {

    `.concat(Sv,`
    
    float aspect = resolution.x / resolution.y;

    vColor = color;

    mat4 m = projectionMatrix * modelViewMatrix;
    vec4 finalPosition = m * vec4( position, 1.0 );
    vec4 prevPos = m * vec4( previous, 1.0 );
    vec4 nextPos = m * vec4( next, 1.0 );

    vec2 currentP = fix( finalPosition, aspect );
    vec2 prevP = fix( prevPos, aspect );
    vec2 nextP = fix( nextPos, aspect );

    float w = lineWidth * width;

    vec2 dir;
    if( nextP == currentP ) dir = normalize( currentP - prevP );
    else if( prevP == currentP ) dir = normalize( nextP - currentP );
    else {
        vec2 dir1 = normalize( currentP - prevP );
        vec2 dir2 = normalize( nextP - currentP );
        dir = normalize( dir1 + dir2 );

        vec2 perp = vec2( -dir1.y, dir1.x );
        vec2 miter = vec2( -dir.y, dir.x );
        //w = clamp( w / dot( miter, perp ), 0., 4., * lineWidth * width );

    }

    //vec2 normal = ( cross( vec3( dir, 0. ) vec3( 0., 0., 1. ) ) ).xy;
    vec4 normal = vec4( -dir.y, dir.x, 0., 1. );
    normal.xy *= .5 * w;
    normal *= projectionMatrix;
    if( sizeAttenuation == 0. ) {
        normal.xy *= finalPosition.w;
        normal.xy /= ( vec4( resolution, 0., 1. ) * projectionMatrix ).xy;
    }

    finalPosition.xy += normal.xy * side;

    gl_Position = finalPosition;

	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	
    vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );
    
	#include <fog_vertex>
}`);new w(0,0,1);var Zne=function(n){em(t,n);var e=tm(t);function t(i){var s;return vt(this,t),s=e.call(this,i),te(ti(s),"positionBuffer",void 0),te(ti(s),"previousBuffer",void 0),te(ti(s),"nextBuffer",void 0),te(ti(s),"uvBuffer",void 0),te(ti(s),"sideBuffer",void 0),te(ti(s),"widthBuffer",void 0),te(ti(s),"colorBuffer",void 0),te(ti(s),"indexBuffer",void 0),te(ti(s),"vector_",new w),te(ti(s),"vector2_",new w),te(ti(s),"vector3_",new w),te(ti(s),"quaternion_",new Me),s.maxParticles=1e4,s.setupBuffers(),s.rebuildMaterial(),s}return yt(t,[{key:"setupBuffers",value:function(){this.geometry&&this.geometry.dispose(),this.geometry=new gt,this.indexBuffer=new it(new Uint32Array(this.maxParticles*6),1),this.indexBuffer.setUsage(Vs),this.geometry.setIndex(this.indexBuffer),this.positionBuffer=new it(new Float32Array(this.maxParticles*6),3),this.positionBuffer.setUsage(Vs),this.geometry.setAttribute("position",this.positionBuffer),this.previousBuffer=new it(new Float32Array(this.maxParticles*6),3),this.previousBuffer.setUsage(Vs),this.geometry.setAttribute("previous",this.previousBuffer),this.nextBuffer=new it(new Float32Array(this.maxParticles*6),3),this.nextBuffer.setUsage(Vs),this.geometry.setAttribute("next",this.nextBuffer),this.widthBuffer=new it(new Float32Array(this.maxParticles*2),1),this.widthBuffer.setUsage(Vs),this.geometry.setAttribute("width",this.widthBuffer),this.sideBuffer=new it(new Float32Array(this.maxParticles*2),1),this.sideBuffer.setUsage(Vs),this.geometry.setAttribute("side",this.sideBuffer),this.uvBuffer=new it(new Float32Array(this.maxParticles*4),2),this.uvBuffer.setUsage(Vs),this.geometry.setAttribute("uv",this.uvBuffer),this.colorBuffer=new it(new Float32Array(this.maxParticles*8),4),this.colorBuffer.setUsage(Vs),this.geometry.setAttribute("color",this.colorBuffer)}},{key:"expandBuffers",value:function(s){for(;s>=this.maxParticles;)this.maxParticles*=2;this.setupBuffers()}},{key:"rebuildMaterial",value:function(){this.layers.mask=this.settings.layers.mask;var s={lineWidth:{value:1},map:{value:null},useMap:{value:0},alphaMap:{value:null},useAlphaMap:{value:0},resolution:{value:new ie(1,1)},sizeAttenuation:{value:1},visibility:{value:1},alphaTest:{value:0},repeat:{value:new ie(1,1)}},r={};if(r.USE_UV="",r.USE_COLOR_ALPHA="",this.settings.material.map&&(r.USE_MAP="",r.MAP_UV=YT(this.settings.material.map.channel),s.map=new we(this.settings.material.map),s.mapTransform=new we(new Dt().copy(this.settings.material.map.matrix))),this.settings.renderMode===st.Trail)this.material=new Et({uniforms:s,defines:r,vertexShader:Kne,fragmentShader:Jne,transparent:this.settings.material.transparent,depthWrite:!this.settings.material.transparent,side:this.settings.material.side,blending:this.settings.material.blending||cd});else throw new Error("render mode unavailable")}},{key:"update",value:function(){var s=this,r=0,o=0,a=0;this.systems.forEach(function(c){for(var l=0;l<c.particleNum;l++)a+=c.particles[l].previous.length*2}),a>this.maxParticles&&this.expandBuffers(a),this.systems.forEach(function(c){var l=s.quaternion_,h=s.vector2_,d=s.vector3_;c.emitter.matrixWorld.decompose(h,l,d);for(var f=c.particles,p=c.particleNum,m=s.settings.uTileCount,g=s.settings.vTileCount,y=1/m,A=1/g,v=0;v<p;v++){var b=f[v],_=b.uvTile%g,T=Math.floor(b.uvTile/g),E=b.previous.values(),M=E.next(),I=M.value,S=I;M.done||(M=E.next());var C=void 0;M.value!==void 0?C=M.value:C=S;for(var D=0;D<b.previous.length;D++,r+=2){if(s.positionBuffer.setXYZ(r,S.position.x,S.position.y,S.position.z),s.positionBuffer.setXYZ(r+1,S.position.x,S.position.y,S.position.z),c.worldSpace?(s.positionBuffer.setXYZ(r,S.position.x,S.position.y,S.position.z),s.positionBuffer.setXYZ(r+1,S.position.x,S.position.y,S.position.z)):(b.parentMatrix?s.vector_.copy(S.position).applyMatrix4(b.parentMatrix):s.vector_.copy(S.position).applyMatrix4(c.emitter.matrixWorld),s.positionBuffer.setXYZ(r,s.vector_.x,s.vector_.y,s.vector_.z),s.positionBuffer.setXYZ(r+1,s.vector_.x,s.vector_.y,s.vector_.z)),c.worldSpace?(s.previousBuffer.setXYZ(r,I.position.x,I.position.y,I.position.z),s.previousBuffer.setXYZ(r+1,I.position.x,I.position.y,I.position.z)):(b.parentMatrix?s.vector_.copy(I.position).applyMatrix4(b.parentMatrix):s.vector_.copy(I.position).applyMatrix4(c.emitter.matrixWorld),s.previousBuffer.setXYZ(r,s.vector_.x,s.vector_.y,s.vector_.z),s.previousBuffer.setXYZ(r+1,s.vector_.x,s.vector_.y,s.vector_.z)),c.worldSpace?(s.nextBuffer.setXYZ(r,C.position.x,C.position.y,C.position.z),s.nextBuffer.setXYZ(r+1,C.position.x,C.position.y,C.position.z)):(b.parentMatrix?s.vector_.copy(C.position).applyMatrix4(b.parentMatrix):s.vector_.copy(C.position).applyMatrix4(c.emitter.matrixWorld),s.nextBuffer.setXYZ(r,s.vector_.x,s.vector_.y,s.vector_.z),s.nextBuffer.setXYZ(r+1,s.vector_.x,s.vector_.y,s.vector_.z)),s.sideBuffer.setX(r,-1),s.sideBuffer.setX(r+1,1),c.worldSpace)s.widthBuffer.setX(r,S.size),s.widthBuffer.setX(r+1,S.size);else if(b.parentMatrix)s.widthBuffer.setX(r,S.size),s.widthBuffer.setX(r+1,S.size);else{var G=(Math.abs(d.x)+Math.abs(d.y)+Math.abs(d.z))/3;s.widthBuffer.setX(r,S.size*G),s.widthBuffer.setX(r+1,S.size*G)}s.uvBuffer.setXY(r,(D/b.previous.length+_)*y,(g-T-1)*A),s.uvBuffer.setXY(r+1,(D/b.previous.length+_)*y,(g-T)*A),s.colorBuffer.setXYZW(r,S.color.x,S.color.y,S.color.z,S.color.w),s.colorBuffer.setXYZW(r+1,S.color.x,S.color.y,S.color.z,S.color.w),D+1<b.previous.length&&(s.indexBuffer.setX(o*3,r),s.indexBuffer.setX(o*3+1,r+1),s.indexBuffer.setX(o*3+2,r+2),o++,s.indexBuffer.setX(o*3,r+2),s.indexBuffer.setX(o*3+1,r+1),s.indexBuffer.setX(o*3+2,r+3),o++),I=S,S=C,M.done||(M=E.next(),M.value!==void 0&&(C=M.value))}}}),this.positionBuffer.updateRange.count=r*3,this.positionBuffer.needsUpdate=!0,this.previousBuffer.updateRange.count=r*3,this.previousBuffer.needsUpdate=!0,this.nextBuffer.updateRange.count=r*3,this.nextBuffer.needsUpdate=!0,this.sideBuffer.updateRange.count=r,this.sideBuffer.needsUpdate=!0,this.widthBuffer.updateRange.count=r,this.widthBuffer.needsUpdate=!0,this.uvBuffer.updateRange.count=r*2,this.uvBuffer.needsUpdate=!0,this.colorBuffer.updateRange.count=r*4,this.colorBuffer.needsUpdate=!0,this.indexBuffer.updateRange.count=o*3,this.indexBuffer.needsUpdate=!0,this.geometry.setDrawRange(0,o*3)}},{key:"dispose",value:function(){this.geometry.dispose()}}]),t}(aG),$ne=function(n){em(t,n);var e=tm(t);function t(){var i;return vt(this,t),i=e.call(this),te(ti(i),"batches",[]),te(ti(i),"systemToBatchIndex",new Map),te(ti(i),"type","BatchedRenderer"),i}return yt(t,[{key:"addSystem",value:function(s){s._renderer=this;for(var r=s.getRendererSettings(),o=0;o<this.batches.length;o++)if(t.equals(this.batches[o].settings,r)){this.batches[o].addSystem(s),this.systemToBatchIndex.set(s,o);return}var a;switch(r.renderMode){case st.Trail:a=new Zne(r);break;case st.Mesh:case st.BillBoard:case st.VerticalBillBoard:case st.HorizontalBillBoard:case st.StretchedBillBoard:a=new Yne(r);break}a.addSystem(s),this.batches.push(a),this.systemToBatchIndex.set(s,this.batches.length-1),this.add(a)}},{key:"deleteSystem",value:function(s){var r=this.systemToBatchIndex.get(s);r!=null&&(this.batches[r].removeSystem(s),this.systemToBatchIndex.delete(s))}},{key:"updateSystem",value:function(s){this.deleteSystem(s),this.addSystem(s)}},{key:"update",value:function(s){this.systemToBatchIndex.forEach(function(o,a){a.update(s)});for(var r=0;r<this.batches.length;r++)this.batches[r].update()}}],[{key:"equals",value:function(s,r){return s.material.side===r.material.side&&s.material.blending===r.material.blending&&s.material.transparent===r.material.transparent&&s.material.type===r.material.type&&s.material.alphaTest===r.material.alphaTest&&s.material.map===r.material.map&&s.renderMode===r.renderMode&&s.uTileCount===r.uTileCount&&s.vTileCount===r.vTileCount&&s.instancingGeometry===r.instancingGeometry&&s.renderOrder===r.renderOrder&&s.layers.mask===r.layers.mask}}]),t}(ge),ese=$ne,Fk=function(){function n(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:new w;vt(this,n),te(this,"locations",[]),this.scaleX=e,this.scaleY=t,this.position=i}return yt(n,[{key:"transform",value:function(t,i){t.x=this.locations[i%this.locations.length].x*this.scaleX+this.position.x,t.y=this.locations[i%this.locations.length].y*this.scaleY+this.position.y,t.z=this.position.z}},{key:"clone",value:function(){var t=new n(this.scaleX,this.scaleY,this.position.clone());return t.locations=this.locations.map(function(i){return i.clone()}),t}},{key:"toJSON",value:function(){return{scaleX:this.scaleX,scaleY:this.scaleY,position:this.position,locations:this.locations.map(function(t){return{x:t.x,y:t.y}})}}},{key:"fromImage",value:function(t,i){var s=document.createElement("canvas");s.width=t.width,s.height=t.height;var r=s.getContext("2d");if(r){r.drawImage(t,0,0);var o=r.getImageData(0,0,s.width,s.height,{colorSpace:"srgb"});s.remove(),this.locations.length=0;for(var a=0;a<o.height;a++)for(var c=0;c<o.width;c++)o.data[(a*o.width+c)*4+3]>i&&this.locations.push(new ie(c,o.height-a))}}}],[{key:"fromJSON",value:function(t){var i=new n(t.scaleX,t.scaleY,new w(t.position[0],t.position[1],t.position[2]));return i.locations=t.locations.map(function(s){return new ie(s.x,s.y)}),i}}]),n}();function tse(n){switch(n.type){case"TextureSequencer":return Fk.fromJSON(n);default:return new Fk}}var ise=function(){function n(e){vt(this,n),te(this,"type","ApplySequences"),te(this,"sequencers",[]),te(this,"time",0),te(this,"index",0),te(this,"pCount",0),te(this,"delay",void 0),te(this,"tempV",new w),this.delay=e}return yt(n,[{key:"initialize",value:function(t){t.id=this.pCount,t.dst=new w,t.begin=new w,t.inMotion=!1,this.pCount++}},{key:"reset",value:function(){this.time=0,this.index=0,this.pCount=0}},{key:"update",value:function(t,i){var s=this.sequencers[this.index],r=t.id*this.delay;this.time>=s[0].a+r&&this.time<=s[0].b+r?(t.inMotion||(t.inMotion=!0,t.begin.copy(t.position),s[1].transform(t.dst,t.id)),t.position.lerpVectors(t.begin,t.dst,n.BEZIER.genValue((this.time-s[0].a-r)/(s[0].b-s[0].a)))):this.time>s[0].b+r&&(t.inMotion=!1)}},{key:"frameUpdate",value:function(t){for(;this.index+1<this.sequencers.length&&this.time>=this.sequencers[this.index+1][0].a;)this.index++;this.time+=t}},{key:"appendSequencer",value:function(t,i){this.sequencers.push([t,i])}},{key:"toJSON",value:function(){return{type:this.type,delay:this.delay,sequencers:this.sequencers.map(function(t){var i=rp(t,2),s=i[0],r=i[1];return{range:s.toJSON(),sequencer:r.toJSON()}})}}},{key:"clone",value:function(){var t=new n(this.delay);return t.sequencers=this.sequencers.map(function(i){return[i[0].clone(),i[1].clone()]}),t}}],[{key:"fromJSON",value:function(t){var i=new n(t.delay);return t.sequencers.forEach(function(s){i.sequencers.push([Gi(s.range),tse(s.sequencer)])}),i}}]),n}();te(ise,"BEZIER",new jT(0,0,1,1));var de=function(n){return n[n.Number=0]="Number",n[n.Vec2=1]="Vec2",n[n.Vec3=2]="Vec3",n[n.Vec4=3]="Vec4",n[n.Boolean=4]="Boolean",n[n.AnyType=5]="AnyType",n}({}),Uk=yt(function n(e,t,i,s){vt(this,n),te(this,"input",void 0),te(this,"inputIndex",void 0),te(this,"output",void 0),te(this,"outputIndex",void 0),this.input=e,this.inputIndex=t,this.input.outputs[t].push(this),this.output=i,this.outputIndex=s,this.output.inputs[s]=this}),nse=function(){function n(){vt(this,n),te(this,"visited",new Set),te(this,"graph_",void 0),te(this,"context_",void 0),n.Instance=this}return yt(n,[{key:"traverse",value:function(t){if(this.context_===void 0)throw new Error("context is undefined");if(this.graph_===void 0)throw new Error("graph is undefined");this.visited.add(t.id);for(var i=[],s=0;s<t.inputs.length;s++)if(t.inputs[s]instanceof Uk){var r=t.inputs[s].input;this.visited.has(r.id)||this.traverse(r),i.push(r.outputValues[t.inputs[s].inputIndex])}else i.push(t.inputs[s].getValue(this.context_));t.func(this.context_,i,t.outputValues),this.graph_.nodesInOrder.push(t)}},{key:"executeCompiledGraph",value:function(){if(this.context_===void 0)throw new Error("context is undefined");if(this.graph_===void 0)throw new Error("graph is undefined");for(var t=this.graph_.nodesInOrder,i=0;i<t.length;i++){for(var s=[],r=t[i],o=0;o<r.inputs.length;o++)if(r.inputs[o]instanceof Uk)s.push(r.inputs[o].input.outputValues[r.inputs[o].inputIndex]);else if(r.inputs[o]!==void 0)s.push(r.inputs[o].getValue(this.context_));else throw new Error("miss input for node ".concat(r.id));r.func(this.context_,s,r.outputValues)}}},{key:"run",value:function(t,i){if(this.graph_=t,this.context_=i,t.compiled)this.executeCompiledGraph();else{t.nodesInOrder.length=0,this.visited.clear();for(var s=0;s<t.outputNodes.length;s++){var r=t.outputNodes[s];this.traverse(r)}t.compiled=!0}}}]),n}();te(nse,"Instance",void 0);var hi=function(){function n(e){vt(this,n),te(this,"name",void 0),te(this,"nodeTypeSignatures",[]),this.name=e}return yt(n,[{key:"addSignature",value:function(t,i,s){this.nodeTypeSignatures.push({inputTypes:t,outputTypes:i,func:s})}}]),n}(),lw=new hi("add");lw.addSignature([de.Number,de.Number],[de.Number],function(n,e,t,i){i[0]=t[0]+t[1]});lw.addSignature([de.Vec2,de.Vec2],[de.Vec2],function(n,e,t,i){i[0].addVectors(t[0],t[1])});lw.addSignature([de.Vec3,de.Vec3],[de.Vec3],function(n,e,t,i){i[0].addVectors(t[0],t[1])});lw.addSignature([de.Vec4,de.Vec4],[de.Vec4],function(n,e,t,i){i[0].addVectors(t[0],t[1])});var hw=new hi("sub");hw.addSignature([de.Number,de.Number],[de.Number],function(n,e,t,i){i[0]=t[0]-t[1]});hw.addSignature([de.Vec2,de.Vec2],[de.Vec2],function(n,e,t,i){i[0].subVectors(t[0],t[1])});hw.addSignature([de.Vec3,de.Vec3],[de.Vec3],function(n,e,t,i){i[0].subVectors(t[0],t[1])});hw.addSignature([de.Vec4,de.Vec4],[de.Vec4],function(n,e,t,i){i[0].subVectors(t[0],t[1])});var uw=new hi("mul");uw.addSignature([de.Number,de.Number],[de.Number],function(n,e,t,i){i[0]=t[0]*t[1]});uw.addSignature([de.Vec2,de.Number],[de.Vec2],function(n,e,t,i){i[0].copy(t[0]).multiplyScalar(t[1])});uw.addSignature([de.Vec3,de.Number],[de.Vec3],function(n,e,t,i){i[0].copy(t[0]).multiplyScalar(t[1])});uw.addSignature([de.Vec4,de.Number],[de.Vec4],function(n,e,t,i){i[0].copy(t[0]).multiplyScalar(t[1])});var dw=new hi("div");dw.addSignature([de.Number,de.Number],[de.Number],function(n,e,t,i){i[0]=t[0]/t[1]});dw.addSignature([de.Vec2,de.Number],[de.Vec2],function(n,e,t,i){i[0].copy(t[0]).divideScalar(t[1])});dw.addSignature([de.Vec3,de.Number],[de.Vec3],function(n,e,t,i){i[0].copy(t[0]).divideScalar(t[1])});dw.addSignature([de.Vec4,de.Number],[de.Vec4],function(n,e,t,i){i[0].copy(t[0]).divideScalar(t[1])});var sse=new hi("sin");sse.addSignature([de.Number],[de.Number],function(n,e,t,i){i[0]=Math.sin(t[0])});var rse=new hi("cos");rse.addSignature([de.Number],[de.Number],function(n,e,t,i){i[0]=Math.cos(t[0])});var ose=new hi("tan");ose.addSignature([de.Number],[de.Number],function(n,e,t,i){i[0]=Math.tan(t[0])});var ase=new hi("abs");ase.addSignature([de.Number],[de.Number],function(n,e,t,i){i[0]=Math.abs(t[0])});var cse=new hi("min");cse.addSignature([de.Number,de.Number],[de.Number],function(n,e,t,i){i[0]=Math.min(t[0],t[1])});var lse=new hi("max");lse.addSignature([de.Number,de.Number],[de.Number],function(n,e,t,i){i[0]=Math.max(t[0],t[1])});var jI=new hi("dot");jI.addSignature([de.Vec2,de.Vec2],[de.Number],function(n,e,t,i){i[0]=t[0].dot(t[1])});jI.addSignature([de.Vec3,de.Vec3],[de.Number],function(n,e,t,i){i[0]=t[0].dot(t[1])});jI.addSignature([de.Vec4,de.Vec4],[de.Number],function(n,e,t,i){i[0]=t[0].dot(t[1])});var hse=new hi("cross");hse.addSignature([de.Vec3,de.Vec3],[de.Vec3],function(n,e,t,i){i[0].crossVectors(t[0],t[1])});var WI=new hi("length");WI.addSignature([de.Vec2],[de.Number],function(n,e,t,i){i[0]=t[0].length()});WI.addSignature([de.Vec3],[de.Number],function(n,e,t,i){i[0]=t[0].length()});WI.addSignature([de.Vec4],[de.Number],function(n,e,t,i){i[0]=t[0].length()});var qI=new hi("lengthSq");qI.addSignature([de.Vec2],[de.Number],function(n,e,t,i){i[0]=t[0].lengthSq()});qI.addSignature([de.Vec3],[de.Number],function(n,e,t,i){i[0]=t[0].lengthSq()});qI.addSignature([de.Vec4],[de.Number],function(n,e,t,i){i[0]=t[0].lengthSq()});var XI=new hi("normalize");XI.addSignature([de.Vec2],[de.Vec2],function(n,e,t,i){i[0].copy(t[0]).normalize()});XI.addSignature([de.Vec3],[de.Vec3],function(n,e,t,i){i[0].copy(t[0]).normalize()});XI.addSignature([de.Vec4],[de.Vec4],function(n,e,t,i){i[0].copy(t[0]).normalize()});var cG=new hi("distance");cG.addSignature([de.Vec2,de.Vec2],[de.Number],function(n,e,t,i){i[0]=t[0].distanceTo(t[1])});cG.addSignature([de.Vec3,de.Vec3],[de.Number],function(n,e,t,i){i[0]=t[0].distanceTo(t[1])});var use=new hi("and");use.addSignature([de.Boolean,de.Boolean],[de.Boolean],function(n,e,t,i){i[0]=t[0]&&t[1]});var dse=new hi("or");dse.addSignature([de.Boolean,de.Boolean],[de.Boolean],function(n,e,t,i){i[0]=t[0]||t[1]});var fse=new hi("not");fse.addSignature([de.Boolean],[de.Boolean],function(n,e,t,i){i[0]=!t[0]});var fw=new hi("equal");fw.addSignature([de.Number,de.Number],[de.Boolean],function(n,e,t,i){i[0]=t[0]===t[1]});fw.addSignature([de.Vec2,de.Vec2],[de.Boolean],function(n,e,t,i){i[0]=t[0].equals(t[1])});fw.addSignature([de.Vec3,de.Vec3],[de.Boolean],function(n,e,t,i){i[0]=t[0].equals(t[1])});fw.addSignature([de.Vec4,de.Vec4],[de.Boolean],function(n,e,t,i){i[0]=t[0].equals(t[1])});var pse=new hi("lessThan");pse.addSignature([de.Number,de.Number],[de.Boolean],function(n,e,t,i){i[0]=t[0]<t[1]});var mse=new hi("greaterThan");mse.addSignature([de.Number,de.Number],[de.Boolean],function(n,e,t,i){i[0]=t[0]>t[1]});var gse=new hi("lessThanOrEqual");gse.addSignature([de.Number,de.Number],[de.Boolean],function(n,e,t,i){i[0]=t[0]<=t[1]});var Ase=new hi("greaterThanOrEqual");Ase.addSignature([de.Number,de.Number],[de.Boolean],function(n,e,t,i){i[0]=t[0]>=t[1]});var vse=new hi("if");vse.addSignature([de.Boolean,de.AnyType,de.AnyType],[de.AnyType],function(n,e,t,i){i[0]=t[0]?t[1]:t[2]});var yse=new hi("number");yse.addSignature([],[de.Number],function(n,e,t,i){i[0]=e.value});var bse=new hi("vec2");bse.addSignature([],[de.Vec2],function(n,e,t,i){i[0]=e.value});var _se=new hi("vec3");_se.addSignature([],[de.Vec3],function(n,e,t,i){i[0]=e.value});var xse=new hi("vec4");xse.addSignature([],[de.Vec4],function(n,e,t,i){i[0]=e.value});var wse=new hi("bool");wse.addSignature([],[de.Boolean],function(n,e,t,i){i[0]=e.value});var Sse=new hi("particlePosition");Sse.addSignature([],[de.Vec3],function(n,e,t,i){i[0]=n.particle[e.property]});var Cse=new hi("particleVelocity");Cse.addSignature([],[de.Vec3],function(n,e,t,i){i[0]=n.particle[e.property]});var Ese=new hi("particleRotation");Ese.addSignature([],[de.Number],function(n,e,t,i){i[0]=n.particle[e.property]});var Tse=new hi("particleAge");Tse.addSignature([],[de.Number],function(n,e,t,i){i[0]=n.particle[e.property]});var Cv=new hi("output");Cv.addSignature([de.Number],[de.Number],function(n,e,t,i){i[0]=t[0]});Cv.addSignature([de.Vec2],[de.Vec2],function(n,e,t,i){i[0]=t[0]});Cv.addSignature([de.Vec3],[de.Vec3],function(n,e,t,i){i[0]=t[0]});Cv.addSignature([de.Vec4],[de.Vec4],function(n,e,t,i){i[0]=t[0]});Cv.addSignature([de.Boolean],[de.Boolean],function(n,e,t,i){i[0]=t[0]});console.log("%c Particle system powered by three.quarks. https://quarks.art/","font-size: 16px; font-weight: bold;");var hn=globalThis&&globalThis.__decorate||function(n,e,t,i){var s=arguments.length,r=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(e,t,r):o(e,t))||r);return s>3&&r&&Object.defineProperty(e,t,r),r};const $m=re("debugparticles"),Mse=re("noprogressive"),Ise=re("debugprogressive");var r_;(function(n){n[n.Birth=0]="Birth",n[n.Collision=1]="Collision",n[n.Death=2]="Death",n[n.Trigger=3]="Trigger",n[n.Manual=4]="Manual"})(r_||(r_={}));class Sa extends Te{constructor(){super(...arguments);u(this,"renderMode");u(this,"particleMaterial");u(this,"trailMaterial");u(this,"particleMesh");u(this,"maxParticleSize");u(this,"minParticleSize");u(this,"velocityScale");u(this,"cameraVelocityScale");u(this,"lengthScale")}start(){if(this.maxParticleSize!==.5&&this.minParticleSize!==0&&Tt()){const t=`ParticleSystem "${this.name}" has non-default min/max particle size. This may not render correctly. Please set min size to 0 and the max size to 0.5 and use the "StartSize" setting instead`;console.warn(t)}}get transparent(){var i;return((i=this.particleMaterial)==null?void 0:i.transparent)??!1}getMaterial(t=!1){let i=t===!0&&this.trailMaterial?this.trailMaterial:this.particleMaterial;return i&&t&&i.side===Es&&(i=i.clone(),i.side=mn,t?this.trailMaterial=i:this.particleMaterial=i),i&&!Mse&&i._didRequestTextureLOD===void 0&&(i._didRequestTextureLOD=0,Ise&&console.log("Load material LOD",i.name),Eo.assignTextureLOD(this.context,this.sourceId,i)),i}getMesh(t){let i=null;if(!i&&(this.particleMesh instanceof me&&(i=this.particleMesh.geometry),i===null)){i=new Wn(1,1);const r=i.attributes.uv;for(let o=0;o<r.count;o++)r.setX(o,1-r.getX(o))}return new me(i,this.getMaterial())}}hn([x()],Sa.prototype,"renderMode",void 0);hn([x(Ot)],Sa.prototype,"particleMaterial",void 0);hn([x(Ot)],Sa.prototype,"trailMaterial",void 0);hn([x()],Sa.prototype,"maxParticleSize",void 0);hn([x()],Sa.prototype,"minParticleSize",void 0);hn([x()],Sa.prototype,"velocityScale",void 0);hn([x()],Sa.prototype,"cameraVelocityScale",void 0);hn([x()],Sa.prototype,"lengthScale",void 0);class h0{constructor(e,t=1){u(this,"_curve");u(this,"_factor");u(this,"type","function");this._curve=e,this._factor=t}genValue(e){return this._curve.evaluate(e,Math.random())*this._factor}toJSON(){throw new Error("Method not implemented.")}clone(){throw new Error("Method not implemented.")}}class YI{constructor(e){u(this,"type","value");u(this,"system");this.system=e}toJSON(){throw new Error("Method not implemented.")}clone(){throw new Error("Method not implemented.")}}class Rse extends YI{genValue(){return this.system.textureSheetAnimation.getStartIndex()}}class Pse extends YI{constructor(){super(...arguments);u(this,"_lastPosition",new w);u(this,"_lastDistance",0)}update(){const t=Ht(this.system.gameObject);this._lastDistance=this._lastPosition.distanceTo(t),this._lastPosition.copy(t)}genValue(){if(!this.system.isPlaying||!this.system.emission.enabled||this.system.currentParticles>=this.system.maxParticles)return 0;let t=this.system.emission.rateOverTime.evaluate(this.system.time/this.system.duration,Math.random());if(this.system.deltaTime>0){const r=this.system.emission.rateOverDistance.evaluate(this.system.time/this.system.duration,Math.random());let a=this._lastDistance/this.system.deltaTime*r;Number.isFinite(a)||(a=0),t+=a}const i=this.system.emission.getBurst();i>0&&(t+=i/this.system.deltaTime);const s=this.system.maxParticles-this.system.currentParticles;return nt.clamp(t,0,s/this.system.deltaTime)}}class Bse extends YI{genValue(){return this.system.isPlaying,0}}class Od{constructor(e){u(this,"system");u(this,"type");this.type=Object.getPrototypeOf(this).constructor.name||"ParticleSystemBaseBehaviour",e&&(this.system=e)}get context(){return this.system.context}initialize(e){}update(e,t){}frameUpdate(e){}toJSON(){throw new Error("Method not implemented.")}clone(){throw new Error("Method not implemented.")}reset(){}}class Dse extends Od{constructor(){super(...arguments);u(this,"type","NeedleTextureSheet")}update(t,i){const s=this.system.textureSheetAnimation;if(s.enabled){const r=t.age/t.life,o=s.evaluate(r);o!==void 0&&(t.uvTile=o)}}}const Nk=Symbol("particleRotation");class Ose extends Od{constructor(){super(...arguments);u(this,"type","NeedleRotation")}initialize(t){t[Nk]=Math.random()}update(t,i){if(t.rotation===void 0)return;const s=t.age/t.life;if(typeof t.rotation=="number"&&(this.system.rotationOverLifetime.enabled?t.rotation+=this.system.rotationOverLifetime.evaluate(s,t[Nk])*i:this.system.renderer.renderMode===Wa.Billboard&&(t.rotation=Math.PI),this.system.rotationBySpeed.enabled)){const r=t.velocity.length();t.rotation+=this.system.rotationBySpeed.evaluate(s,r)*i}}}const zk=Symbol("sizeLerpFactor"),kse=new w;class Lse extends Od{constructor(){super(...arguments);u(this,"type","NeedleSize");u(this,"_minSize",0);u(this,"_maxSize",1)}initialize(t){t[zk]=Math.random(),this._minSize=this.system.renderer.minParticleSize,this._maxSize=this.system.renderer.maxParticleSize}update(t,i){const s=t.age/t.life;let r=1;this.system.sizeOverLifetime.enabled&&(r*=this.system.sizeOverLifetime.evaluate(s,void 0,t[zk]).x);let o=1;if(this.system.renderer.renderMode!==Wa.Mesh&&(o=this.system.worldScale.x/this.system.cameraScale),t.size=t.startSize*r*o,this.system.localspace){const a=lG(this.system,kse);t.size*=a.x}}}const Hf=Symbol("particleLife"),PC=Symbol("trailLifetime"),Gk=Symbol("trailStartLength"),BC=Symbol("trailWidthRandom");class Fse extends Od{constructor(){super(...arguments);u(this,"type","NeedleTrail")}initialize(t){t instanceof MA&&(t[Hf]=t.life,this.system.trails.enabled&&this.system.trails.dieWithParticles===!1&&(t[PC]=this.system.trails.lifetime.evaluate(Math.random(),Math.random()),t.life+=t[PC]),t[Gk]=t.length,t[BC]=Math.random())}update(t){var i;if((i=this.system.trails)!=null&&i.enabled&&t instanceof MA){const s=t,r=t.age/t[Hf],o=t.previous.values(),a=t.previous.length;for(let c=0;c<a;c++){const h=o.next().value,d=1-c/(a-1);let f=t.size;f<=0&&!this.system.trails.sizeAffectsWidth&&(f=20*this.system.trails.widthOverTrail.evaluate(.5,s[BC])),h.size=this.system.trails.getWidth(f,r,d,s[BC]),h.color.copy(t.color),this.system.trails.getColor(h.color,r,d)}if(t.age>t[Hf]){t.velocity.set(0,0,0);const c=(t.age-t[Hf])/t[PC];s.length=nt.lerp(t[Gk],0,c)}}}}const u0=Symbol("startVelocity"),Vk=Symbol("gravityModifier"),DC=Symbol("gravitySpeed"),d0=Symbol("velocity lerp factor"),JT=new w;class Use extends Od{constructor(){super(...arguments);u(this,"type","NeedleVelocity");u(this,"_gravityDirection",new w)}initialize(t){var r,o;const i=this.system.main.simulationSpeed;t.startSpeed=this.system.main.startSpeed.evaluate(Math.random(),Math.random()),t.velocity.copy(this.system.shape.getDirection(t,t.position)).multiplyScalar(t.startSpeed),(r=this.system.inheritVelocity)!=null&&r.enabled&&this.system.inheritVelocity.applyInitial(t.velocity),t[u0]?t[u0].copy(t.velocity):t[u0]=t.velocity.clone();const s=this.system.main.gravityModifier.evaluate(Math.random(),Math.random());t[Vk]=s*i,t[DC]=s*i*.5,t[d0]=Math.random(),(o=this.system.velocityOverLifetime)==null||o.init(t),this._gravityDirection.set(0,-1,0),this.system.main.simulationSpace===da.Local&&this._gravityDirection.applyQuaternion(this.system.worldQuaternionInverted).normalize()}update(t,i){var f;const s=t[u0],r=t[Vk];if(r!==0){const p=r*t[DC];JT.copy(this._gravityDirection).multiplyScalar(p),t[DC]+=i*.05,s.add(JT)}t.velocity.copy(s);const o=t.age/t.life;(f=this.system.inheritVelocity)!=null&&f.enabled&&this.system.inheritVelocity.applyCurrent(t.velocity,o,t[d0]);const a=this.system.noise;a.enabled&&a.apply(0,t.position,t.velocity,i,t.age,t.life);const c=this.system.sizeBySpeed;c!=null&&c.enabled&&(t.size=c.evaluate(t.velocity,o,t[d0],t.size));const l=this.system.colorBySpeed;l!=null&&l.enabled&&l.evaluate(t.velocity,t[d0],t.color);const h=this.system.velocityOverLifetime;h.enabled&&h.apply(t,0,t.position,t.velocity,i,t.age,t.life);const d=this.system.limitVelocityOverLifetime;d.enabled&&d.apply(t.position,s,t.velocity,t.size,o,i,1),this.system.worldspace&&t.velocity.multiply(this.system.worldScale)}}const Hk=Symbol("colorLerpFactor"),Qk=new Ii(1,1,1,1),wu=new Ii(1,1,1,1);class Nse extends Od{constructor(){super(...arguments);u(this,"type","NeedleColor")}initialize(t){}_init(t){const i=this.system.renderer.particleMaterial;wu.copy(this.system.main.startColor.evaluate(Math.random())),i!=null&&i.color&&(Qk.copy(i.color),wu.multiply(Qk)),wu.convertLinearToSRGB(),t.startColor.set(wu.r,wu.g,wu.b,wu.alpha),t.color.copy(t.startColor),t[Hk]=Math.random()}update(t,i){if(t.age===0&&this._init(t),this.system.colorOverLifetime.enabled){const s=t.age/t.life,r=this.system.colorOverLifetime.color.evaluate(s,t[Hk]);t.color.set(r.r,r.g,r.b,r.alpha).multiply(t.startColor)}else t.color.copy(t.startColor)}}class zse{constructor(e){u(this,"system");u(this,"emission");u(this,"autoDestroy");u(this,"startLength");u(this,"emissionBursts");u(this,"onlyUsedByOther");u(this,"behaviors",[]);u(this,"rendererEmitterSettings",{startLength:new Gs(220),followLocalOrigin:!1});u(this,"flatWhiteTexture");u(this,"clonedTexture",{original:void 0,clone:void 0});this.system=e,this.emission=new Pse(this.system)}get anim(){return this.system.textureSheetAnimation}get prewarm(){return!1}get material(){return this.system.renderer.getMaterial(this.system.trails.enabled)}get layers(){return this.system.gameObject.layers}update(){this.emission.update()}get looping(){return this.system.main.loop}get duration(){return this.system.duration}get shape(){return this.system.shape}get startLife(){return new h0(this.system.main.startLifetime)}get startSpeed(){return new h0(this.system.main.startSpeed)}get startRotation(){return new h0(this.system.main.startRotation)}get startSize(){return new h0(this.system.main.startSize)}get startColor(){return new s_(new tt(1,1,1,1))}get emissionOverTime(){return this.emission}get emissionOverDistance(){return new Bse(this.system)}get instancingGeometry(){return this.system.renderer.getMesh(this.system.renderer.renderMode).geometry}get renderMode(){if(this.system.trails.enabled===!0)return st.Trail;switch(this.system.renderer.renderMode){case Wa.Billboard:return st.BillBoard;case Wa.Stretch:return st.StretchedBillBoard;case Wa.HorizontalBillboard:return st.HorizontalBillBoard;case Wa.VerticalBillboard:return st.VerticalBillBoard;case Wa.Mesh:return st.Mesh}return st.BillBoard}get speedFactor(){var t;let e=this.system.main.simulationSpeed;return((t=this.system.renderer)==null?void 0:t.renderMode)===Wa.Stretch&&(e*=this.system.renderer.velocityScale??1),e}get texture(){const e=this.material;if(e&&e.map){const t=e.map;if(this.clonedTexture.original!==t||!this.clonedTexture.clone){const i=t.clone();i.premultiplyAlpha=!1,i.colorSpace=Ri,this.clonedTexture.original=t,this.clonedTexture.clone=i}return this.clonedTexture.clone}return this.flatWhiteTexture||(this.flatWhiteTexture=M3(new Ii(1,1,1,1),1)),this.flatWhiteTexture}get startTileIndex(){return new Rse(this.system)}get uTileCount(){var e;return this.anim.enabled?(e=this.anim)==null?void 0:e.numTilesX:void 0}get vTileCount(){var e;return this.anim.enabled?(e=this.anim)==null?void 0:e.numTilesY:void 0}get renderOrder(){return 1}get blending(){var e;return((e=this.system.renderer.particleMaterial)==null?void 0:e.blending)??Th}get transparent(){return this.system.renderer.transparent}get worldSpace(){return this.system.main.simulationSpace===da.World}}class Gse{constructor(){u(this,"burstIndex",0);u(this,"burstWaveIndex",0);u(this,"time",0);u(this,"waitEmiting",0)}}class on extends Te{constructor(){super(...arguments);u(this,"_state");u(this,"colorOverLifetime");u(this,"main");u(this,"emission");u(this,"sizeOverLifetime");u(this,"shape");u(this,"noise");u(this,"trails");u(this,"velocityOverLifetime");u(this,"limitVelocityOverLifetime");u(this,"inheritVelocity");u(this,"colorBySpeed");u(this,"textureSheetAnimation");u(this,"rotationOverLifetime");u(this,"rotationBySpeed");u(this,"sizeBySpeed");u(this,"_cameraScale",1);u(this,"__worldQuaternion",new Me);u(this,"_worldQuaternionInverted",new Me);u(this,"_worldScale",new w);u(this,"_worldPositionFrame",-1);u(this,"_worldPos",new w);u(this,"_renderer");u(this,"_batchSystem");u(this,"_particleSystem");u(this,"_interface");u(this,"_container");u(this,"_time",0);u(this,"_isPlaying",!0);u(this,"_isUsedAsSubsystem",!1);u(this,"_didPreWarm",!1);u(this,"_bursts");u(this,"_subEmitterSystems");u(this,"_lastBatchesCount",-1);u(this,"lastMaterialVersion",-1)}play(t=!1){var i;t&&le.foreachComponent(this.gameObject,s=>{s instanceof on&&s!==this&&s.play(!1)},!0),this._isPlaying=!0,this._particleSystem&&(this._particleSystem.emissionState.time=0,this._particleSystem.emitEnded=!1),(i=this.emission)==null||i.reset()}pause(t=!0){t&&le.foreachComponent(this.gameObject,i=>{i instanceof on&&i!==this&&i.pause(!1)},!0),this._isPlaying=!1}stop(t=!0,i=!1){t&&le.foreachComponent(this.gameObject,s=>{s instanceof on&&s!==this&&s.stop(!1,i)},!0),this._isPlaying=!1,this._time=0,i&&this.reset()}reset(){var t;this._time=0,this._particleSystem&&(this._particleSystem.particleNum=0,this._particleSystem.emissionState.time=0,this._particleSystem.emitEnded=!1,(t=this.emission)==null||t.reset())}emit(t){if(this._particleSystem){this.onUpdate(),t=Math.min(t,this.maxParticles-this.currentParticles),this._state||(this._state=new Gse),this._state.waitEmiting=t,this._state.time=0;const i=this._particleSystem.emitEnded;this._particleSystem.emitEnded=!1,this._particleSystem.emit(this.deltaTime,this._state,this._particleSystem.emitter.matrixWorld),this._particleSystem.emitEnded=i}}get playOnAwake(){return this.main.playOnAwake}set playOnAwake(t){this.main.playOnAwake=t}get renderer(){return this._renderer}get isPlaying(){return this._isPlaying}get currentParticles(){var t;return((t=this._particleSystem)==null?void 0:t.particleNum)??0}get maxParticles(){return this.main.maxParticles}get time(){return this._time}get duration(){return this.main.duration}get deltaTime(){return this.context.time.deltaTime*this.main.simulationSpeed}get scale(){return this.gameObject.scale.x}get cameraScale(){return this._cameraScale}get container(){return this._container}get worldspace(){return this.main.simulationSpace===da.World}get localspace(){return this.main.simulationSpace===da.Local}get worldQuaternion(){return this.__worldQuaternion}get worldQuaternionInverted(){return this._worldQuaternionInverted}get worldScale(){return this._worldScale}get worldPos(){return this._worldPositionFrame!==this.context.time.frame&&(this._worldPositionFrame=this.context.time.frame,Ht(this.gameObject,this._worldPos)),this._worldPos}get matrixWorld(){return this._container.matrixWorld}get isSubsystem(){return this._isUsedAsSubsystem}addBehaviour(t){return this._particleSystem?(t instanceof Od&&(t.system=this),Tt()&&console.log("add behaviour",t),this._particleSystem.addBehavior(t),!0):!1}removeAllBehaviours(){return this._particleSystem?(this._particleSystem.behaviors.length=0,!0):!1}get behaviours(){return this._particleSystem?this._particleSystem.behaviors:null}get particleSystem(){return this._particleSystem??null}set bursts(t){for(let i=0;i<t.length;i++){const s=t[i];if(!(s instanceof Yb)){const r=new Yb;gp(r,s),t[i]=r}}this._bursts=t}set subEmitterSystems(t){for(let i=0;i<t.length;i++){const s=t[i];if(!(s instanceof o_)){const r=new o_;gp(r,s),t[i]=r}}$m&&t.length>0&&console.log("SubEmitters: ",t,this),this._subEmitterSystems=t}onAfterDeserialize(t){if(this._subEmitterSystems&&Array.isArray(this._subEmitterSystems))for(const i of this._subEmitterSystems)i._deserialize(this.context,this.gameObject)}awake(){if(this._worldPositionFrame=-1,this._renderer=this.gameObject.getComponent(Sa),!this.main)throw new Error("Not Supported: ParticleSystem needs a serialized MainModule. Creating new particle systems at runtime is currently not supported.");this._container=new ge,this._container.matrixAutoUpdate=!1,this.context.scene.add(this._container),this._batchSystem=new ese,this._batchSystem.name=this.gameObject.name,this._container.add(this._batchSystem),this._interface=new zse(this),this._particleSystem=new Hne(this._interface),this._particleSystem.addBehavior(new Lse(this)),this._particleSystem.addBehavior(new Nse(this)),this._particleSystem.addBehavior(new Dse(this)),this._particleSystem.addBehavior(new Ose(this)),this._particleSystem.addBehavior(new Use(this)),this._particleSystem.addBehavior(new Fse(this)),this._batchSystem.addSystem(this._particleSystem);const t=this._particleSystem.emitter;this.context.scene.add(t),this.inheritVelocity.system&&this.inheritVelocity.system!==this&&(this.inheritVelocity=this.inheritVelocity.clone()),this.inheritVelocity.awake(this),$m&&(console.log(this),this.gameObject.add(new Fo(1)))}start(){this.addSubParticleSystems(),this.updateLayers()}onDestroy(){var t,i,s,r;(t=this._container)==null||t.removeFromParent(),(i=this._batchSystem)==null||i.removeFromParent(),(s=this._particleSystem)==null||s.emitter.removeFromParent(),(r=this._particleSystem)==null||r.dispose()}onEnable(){this.main&&(this.inheritVelocity&&(this.inheritVelocity.system=this),this._batchSystem&&(this._batchSystem.visible=!0),this.playOnAwake&&this.play(),this._isPlaying=this.playOnAwake)}onDisable(){this._batchSystem&&(this._batchSystem.visible=!1)}onBeforeRender(){var t;this.main&&(this._didPreWarm===!1&&((t=this.main)==null?void 0:t.prewarm)===!0&&(this._didPreWarm=!0,this.preWarm()),this.onUpdate(),this.onSimulate(this.deltaTime))}preWarm(){var h;if(!((h=this.emission)!=null&&h.enabled)||this.emission.rateOverTime.getMax()<=0)return;const i=1/60,s=this.main.duration,r=this.main.startLifetime.getMax(),o=1e3,a=Math.min(Math.max(s,r)/Math.max(.01,this.main.simulationSpeed),o),c=Math.ceil(a/i),l=Date.now();$m&&console.log(`Particles ${this.name} - Prewarm for ${c} frames (${a} sec). Duration: ${s}, Lifetime: ${r}`);for(let d=0;d<c&&!(this.currentParticles>=this.maxParticles);d++){const f=Date.now()-l;if(f>2e3){console.warn(`Particles ${this.name} - Prewarm took too long. Aborting: ${f}`);break}this.onUpdate(),this.onSimulate(i)}}onSimulate(t){if(this._batchSystem){let i=this.context.time.frameCount%60===0;this._lastBatchesCount!==this._batchSystem.batches.length&&(this._lastBatchesCount=this._batchSystem.batches.length,i=!0),i&&this.updateLayers(),this._batchSystem.update(t)}this._time+=t,this._time>this.duration&&(this._time=0)}updateLayers(){if(this._batchSystem)for(let t=0;t<this._batchSystem.batches.length;t++){const i=this._batchSystem.batches[t];i.layers.disableAll();const s=this.layer;i.layers.mask=1<<s}}onUpdate(){var o,a;const t=this.renderer.getMaterial(this.trails.enabled);if(t&&t.version!=this.lastMaterialVersion&&this._particleSystem&&(this.lastMaterialVersion=t.version,this._particleSystem.texture=this._interface.texture),this._bursts&&(this.emission.bursts=this._bursts,delete this._bursts),!this._isPlaying)return;const i=this.context.mainCamera;if(i){const c=br(i);this._cameraScale=c.x}const s=!this.worldspace,r=this.gameObject;if(In(r,this.__worldQuaternion),this._worldQuaternionInverted.copy(this.__worldQuaternion).invert(),br(this.gameObject,this._worldScale),s&&this._container&&((o=this.gameObject)!=null&&o.parent)){const c=lG(this,JT);this._container.matrix.makeScale(c.x,c.y,c.z),this._container.matrix.makeRotationFromQuaternion(this.__worldQuaternion),this._container.matrix.setPosition(this.worldPos),this._container.matrix.scale(this.gameObject.scale)}this.emission.system=this,this._interface.update(),this.shape.update(this,this.context,this.main.simulationSpace,this.gameObject),this.noise.update(this.context),(a=this.inheritVelocity)==null||a.update(this.context),this.velocityOverLifetime.update(this)}addSubParticleSystems(){var t;if(this._subEmitterSystems&&this._particleSystem)for(const i of this._subEmitterSystems){i.particleSystem&&(i.particleSystem.__internalAwake?i.particleSystem.__internalAwake():Tt()&&console.warn("SubParticleSystem serialization issue(?)",i.particleSystem,i));const s=(t=i.particleSystem)==null?void 0:t._particleSystem;if(s){i.particleSystem._isUsedAsSubsystem=!0;const r=new JI(this,this._particleSystem,i.particleSystem,s);r.emitterType=i.type,r.emitterProbability=i.emitProbability,this._particleSystem.addBehavior(r)}else $m&&console.warn("Could not add SubParticleSystem",i,this)}}}hn([x(Kx)],on.prototype,"colorOverLifetime",void 0);hn([x(Zs)],on.prototype,"main",void 0);hn([x(Ul)],on.prototype,"emission",void 0);hn([x(Md)],on.prototype,"sizeOverLifetime",void 0);hn([x(Vi)],on.prototype,"shape",void 0);hn([x(Pi)],on.prototype,"noise",void 0);hn([x(ln)],on.prototype,"trails",void 0);hn([x(An)],on.prototype,"velocityOverLifetime",void 0);hn([x(qn)],on.prototype,"limitVelocityOverLifetime",void 0);hn([x(Nl)],on.prototype,"inheritVelocity",void 0);hn([x(Yp)],on.prototype,"colorBySpeed",void 0);hn([x($s)],on.prototype,"textureSheetAnimation",void 0);hn([x(wa)],on.prototype,"rotationOverLifetime",void 0);hn([x(Qo)],on.prototype,"rotationBySpeed",void 0);hn([x(Vr)],on.prototype,"sizeBySpeed",void 0);class o_{constructor(){u(this,"particleSystem");u(this,"emitProbability",1);u(this,"properties");u(this,"type")}_deserialize(e,t){const i=this.particleSystem;if(i instanceof on)return;let s="";i&&typeof i.guid=="string"&&(s=i.guid,this.particleSystem=le.findByGuid(s,t)),$m&&!(this.particleSystem instanceof on)&&console.warn("Could not find particle system for sub emitter",s,t,this)}}function lG(n,e){if(e.set(1,1,1),n.gameObject.parent&&n.localspace)switch(n.main.scalingMode){case Xb.Local:e=br(n.gameObject.parent,e),e.x=1/e.x,e.y=1/e.y,e.z=1/e.z;break;default:if(!n.unsupported_scaling_mode){n.unsupported_scaling_mode=!0;const t="ParticleSystem scale mode "+Xb[n.main.scalingMode]+" is not supported";Tt()&&gn(t),console.warn(t,n.name,n)}e=br(n.gameObject,e);break}return e}new w(1,1,1);new w(0,0,1);class JI{constructor(e,t,i,s){u(this,"system");u(this,"particleSystem");u(this,"subSystem");u(this,"subParticleSystem");u(this,"type","NeedleParticleSubEmitter");u(this,"emitterType");u(this,"emitterProbability");u(this,"q_",new Me);u(this,"v_",new w);u(this,"v2_",new w);u(this,"_emitterMatrix",new Ce);u(this,"_circularBuffer");this.system=e,this.particleSystem=t,this.subSystem=i,this.subParticleSystem=s,this.subParticleSystem&&this.subParticleSystem&&(this.subParticleSystem.onlyUsedByOther=!0);const r=1e3;this._circularBuffer=new wl(()=>new Ce,r)}clone(){throw new Error("Method not implemented.")}initialize(e){e.emissionState={burstIndex:0,burstWaveIndex:0,time:0,waitEmiting:0},this._emitterMatrix.copy(this.subSystem.matrixWorld).invert().premultiply(this.system.matrixWorld),this._emitterMatrix.setPosition(0,0,0),this.emitterType===r_.Birth&&this.run(e)}update(e,t){this.run(e)}frameUpdate(e){}toJSON(){}reset(){}run(e){if(this.subSystem.currentParticles>=this.subSystem.main.maxParticles||!this.subParticleSystem||!e.emissionState||this.emitterProbability&&Math.random()>this.emitterProbability)return;const t=this.system.deltaTime;if(this.emitterType===r_.Death){let s=e.life;if(e[Hf]!==void 0&&(s=e[Hf]),!(e.age+t*1.2>=s))return;const o=this.subSystem.main.maxParticles-this.subSystem.currentParticles;e.emissionState.waitEmiting=o}const i=new Ce;i.set(1,0,0,e.position.x,0,1,0,e.position.y,0,0,1,e.position.z,0,0,0,1),this.particleSystem.worldSpace||i.multiplyMatrices(this._emitterMatrix,i),this.subParticleSystem.emit(t,e.emissionState,i)}}var Vse=globalThis&&globalThis.__decorate||function(n,e,t,i){var s=arguments.length,r=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(e,t,r):o(e,t))||r);return s>3&&r&&Object.defineProperty(e,t,r),r};class pw extends xr{constructor(){super(...arguments);u(this,"granularity")}get typeName(){return"PixelationEffect"}onCreateEffect(){const t=new VF;return this.granularity.onValueChanged=i=>{t.granularity=i},t}}Vse([x(It)],pw.prototype,"granularity",void 0);_a("PixelationEffect",pw);class PA extends Te{constructor(){super(...arguments);u(this,"_didAssignPlayerColor",!1);u(this,"tryAssignColor",()=>{const t=le.getComponentInParent(this.gameObject,Hs);if(t&&t.owner)return this._didAssignPlayerColor=!0,this.assignUserColor(t.owner),!0;const i=le.getComponentInParent(this.gameObject,ns);return i!=null&&i.connectionId?(this._didAssignPlayerColor=!0,this.assignUserColor(i.connectionId),!0):!1})}onEnable(){this.context.connection.beginListen(Xt.JoinedRoom,this.tryAssignColor),this._didAssignPlayerColor||this.startCoroutine(this.waitForConnection())}onDisable(){this.context.connection.stopListen(Xt.JoinedRoom,this.tryAssignColor)}*waitForConnection(){for(;!this.destroyed&&this.activeAndEnabled&&(yield $F(.2),!this.tryAssignColor()););}assignUserColor(t){const i=PA.hashCode(t),s=PA.colorFromHashCode(i);if(this.gameObject.type==="Mesh"){const r=this.gameObject;this.assignColor(s,t,r)}else if(this.gameObject.children)for(const r of this.gameObject.children){const o=r;o.material&&o.material.color&&this.assignColor(s,t,o)}}assignColor(t,i,s){let r=s.material;r&&(r._playerMaterial!==i&&(r=r.clone(),r._playerMaterial=i,s.material=r),r.color=t)}static hashCode(t){var i=0,s,r;if(t.length===0)return i;for(s=0;s<t.length;s++)r=t.charCodeAt(s),i=(i<<5)-i+r,i|=0;return i}static colorFromHashCode(t){const i=(t&16711680)>>16,s=(t&65280)>>8,r=t&255;return new ye(i/255,s/255,r/255)}}new vc(-1,1,1,-1,0,1);class Hse extends gt{constructor(){super(),this.setAttribute("position",new ot([-1,3,0,-1,-1,0,3,-1,0],3)),this.setAttribute("uv",new ot([0,2,0,0,2,0],2))}}new Hse;const Ev=new gt;Ev.setAttribute("position",new it(new Float32Array([-1,-1,3,-1,-1,3]),2));Ev.setAttribute("uv",new it(new Float32Array([0,0,2,0,0,2]),2));Ev.boundingSphere=new Mn;Ev.computeBoundingSphere=function(){};const Qse=new vc;class Su{constructor(e){this._mesh=new me(Ev,e),this._mesh.frustumCulled=!1}render(e){e.render(this._mesh,Qse)}get material(){return this._mesh.material}set material(e){this._mesh.material=e}dispose(){this._mesh.material.dispose(),this._mesh.geometry.dispose()}}const jse={uniforms:{sceneDiffuse:{value:null},sceneDepth:{value:null},sceneNormal:{value:null},projMat:{value:new Ce},viewMat:{value:new Ce},projViewMat:{value:new Ce},projectionMatrixInv:{value:new Ce},viewMatrixInv:{value:new Ce},cameraPos:{value:new w},resolution:{value:new ie},time:{value:0},samples:{value:[]},bluenoise:{value:null},distanceFalloff:{value:1},radius:{value:5},near:{value:.1},far:{value:1e3},logDepth:{value:!1},ortho:{value:!1},screenSpaceRadius:{value:!1},frame:{value:0}},depthWrite:!1,depthTest:!1,vertexShader:`
varying vec2 vUv;
void main() {
  vUv = uv;
  gl_Position = vec4(position, 1);
}`,fragmentShader:`
    #define SAMPLES 16
    #define FSAMPLES 16.0
uniform sampler2D sceneDiffuse;
uniform highp sampler2D sceneNormal;
uniform highp sampler2D sceneDepth;
uniform mat4 projectionMatrixInv;
uniform mat4 viewMatrixInv;
uniform mat4 projMat;
uniform mat4 viewMat;
uniform mat4 projViewMat;
uniform vec3 cameraPos;
uniform vec2 resolution;
uniform float time;
uniform vec3[SAMPLES] samples;
uniform float radius;
uniform float distanceFalloff;
uniform float near;
uniform float far;
uniform float frame;
uniform bool logDepth;
uniform bool ortho;
uniform bool screenSpaceRadius;
uniform sampler2D bluenoise;
    varying vec2 vUv;
    highp float linearize_depth(highp float d, highp float zNear,highp float zFar)
    {
        return (zFar * zNear) / (zFar - d * (zFar - zNear));
    }
    highp float linearize_depth_ortho(highp float d, highp float nearZ, highp float farZ) {
      return nearZ + (farZ - nearZ) * d;
    }
    highp float linearize_depth_log(highp float d, highp float nearZ,highp float farZ) {
      float depth = pow(2.0, d * log2(farZ + 1.0)) - 1.0;
      float a = farZ / (farZ - nearZ);
      float b = farZ * nearZ / (nearZ - farZ);
      float linDepth = a + b / depth;
      return ortho ? linearize_depth_ortho(
        linDepth,
        nearZ,
        farZ
      ) :linearize_depth(linDepth, nearZ, farZ);
    }

    vec3 getWorldPosLog(vec3 posS) {
      vec2 uv = posS.xy;
      float z = posS.z;
      float nearZ =near;
      float farZ = far;
      float depth = pow(2.0, z * log2(farZ + 1.0)) - 1.0;
      float a = farZ / (farZ - nearZ);
      float b = farZ * nearZ / (nearZ - farZ);
      float linDepth = a + b / depth;
      vec4 clipVec = vec4(uv, linDepth, 1.0) * 2.0 - 1.0;
      vec4 wpos = projectionMatrixInv * clipVec;
      return wpos.xyz / wpos.w;
    }
    vec3 getWorldPos(float depth, vec2 coord) {
      #ifdef LOGDEPTH
        return getWorldPosLog(vec3(coord, depth));
      #endif
      float z = depth * 2.0 - 1.0;
      vec4 clipSpacePosition = vec4(coord * 2.0 - 1.0, z, 1.0);
      vec4 viewSpacePosition = projectionMatrixInv * clipSpacePosition;
      // Perspective division
     vec4 worldSpacePosition = viewSpacePosition;
     worldSpacePosition.xyz /= worldSpacePosition.w;
      return worldSpacePosition.xyz;
  }

  vec3 computeNormal(vec3 worldPos, vec2 vUv) {
    ivec2 p = ivec2(vUv * resolution);
    float c0 = texelFetch(sceneDepth, p, 0).x;
    float l2 = texelFetch(sceneDepth, p - ivec2(2, 0), 0).x;
    float l1 = texelFetch(sceneDepth, p - ivec2(1, 0), 0).x;
    float r1 = texelFetch(sceneDepth, p + ivec2(1, 0), 0).x;
    float r2 = texelFetch(sceneDepth, p + ivec2(2, 0), 0).x;
    float b2 = texelFetch(sceneDepth, p - ivec2(0, 2), 0).x;
    float b1 = texelFetch(sceneDepth, p - ivec2(0, 1), 0).x;
    float t1 = texelFetch(sceneDepth, p + ivec2(0, 1), 0).x;
    float t2 = texelFetch(sceneDepth, p + ivec2(0, 2), 0).x;

    float dl = abs((2.0 * l1 - l2) - c0);
    float dr = abs((2.0 * r1 - r2) - c0);
    float db = abs((2.0 * b1 - b2) - c0);
    float dt = abs((2.0 * t1 - t2) - c0);

    vec3 ce = getWorldPos(c0, vUv).xyz;

    vec3 dpdx = (dl < dr) ? ce - getWorldPos(l1, (vUv - vec2(1.0 / resolution.x, 0.0))).xyz
                          : -ce + getWorldPos(r1, (vUv + vec2(1.0 / resolution.x, 0.0))).xyz;
    vec3 dpdy = (db < dt) ? ce - getWorldPos(b1, (vUv - vec2(0.0, 1.0 / resolution.y))).xyz
                          : -ce + getWorldPos(t1, (vUv + vec2(0.0, 1.0 / resolution.y))).xyz;

    return normalize(cross(dpdx, dpdy));
}

mat3 makeRotationZ(float theta) {
	float c = cos(theta);
	float s = sin(theta);
	return mat3(c, - s, 0,
			s,  c, 0,
			0,  0, 1);
  }

void main() {
      vec4 diffuse = texture2D(sceneDiffuse, vUv);
      float depth = texture2D(sceneDepth, vUv).x;
      if (depth == 1.0) {
        gl_FragColor = vec4(vec3(1.0), 1.0);
        return;
      }
      vec3 worldPos = getWorldPos(depth, vUv);
      #ifdef HALFRES
        vec3 normal = texture2D(sceneNormal, vUv).rgb;
      #else
        vec3 normal = computeNormal(worldPos, vUv);
      #endif
      vec4 noise = texture2D(bluenoise, gl_FragCoord.xy / 128.0);
      vec2 harmoniousNumbers = vec2(
        1.618033988749895,
        1.324717957244746
      );
      noise.rg += harmoniousNumbers * frame;
      noise.rg = fract(noise.rg);
        vec3 helperVec = vec3(0.0, 1.0, 0.0);
        if (dot(helperVec, normal) > 0.99) {
          helperVec = vec3(1.0, 0.0, 0.0);
        }
        vec3 tangent = normalize(cross(helperVec, normal));
        vec3 bitangent = cross(normal, tangent);
        mat3 tbn = mat3(tangent, bitangent, normal) *  makeRotationZ(noise.r * 2.0 * 3.1415962) ;

      float occluded = 0.0;
      float totalWeight = 0.0;
      float radiusToUse = screenSpaceRadius ? distance(
        worldPos,
        getWorldPos(depth, vUv +
          vec2(radius, 0.0) / resolution)
      ) : radius;
      float distanceFalloffToUse =screenSpaceRadius ?
          radiusToUse * distanceFalloff
      : radiusToUse * distanceFalloff * 0.2;
      float bias = (min(
        0.1,
        distanceFalloffToUse * 0.1
      ) / near) * fwidth(distance(worldPos, cameraPos)) / radiusToUse;
      float phi = 1.61803398875;
      float offsetMove = 0.0;
      float offsetMoveInv = 1.0 / FSAMPLES;
      for(float i = 0.0; i < FSAMPLES; i++) {
        vec3 sampleDirection = tbn * samples[int(i)];

        float moveAmt = fract(noise.g + offsetMove);
        offsetMove += offsetMoveInv;

        vec3 samplePos = worldPos + radiusToUse * moveAmt * sampleDirection;
        vec4 offset = projMat * vec4(samplePos, 1.0);
        offset.xyz /= offset.w;
        offset.xyz = offset.xyz * 0.5 + 0.5;
        
        vec2 diff = gl_FragCoord.xy - floor(offset.xy * resolution);
        // From Rabbid76's hbao
        vec2 clipRangeCheck = step(vec2(0.0),offset.xy) * step(offset.xy, vec2(1.0));
          float sampleDepth = textureLod(sceneDepth, offset.xy, 0.0).x;

          #ifdef LOGDEPTH

          float distSample = linearize_depth_log(sampleDepth, near, far);

          #else

          float distSample = ortho ? linearize_depth_ortho(sampleDepth, near, far) : linearize_depth(sampleDepth, near, far);

          #endif

          float distWorld = ortho ? linearize_depth_ortho(offset.z, near, far) : linearize_depth(offset.z, near, far);
          
          float rangeCheck = distSample == distWorld ? 0.0 : smoothstep(0.0, 1.0, distanceFalloffToUse / (abs(distSample - distWorld)));
          
          float sampleValid = (clipRangeCheck.x * clipRangeCheck.y);
          occluded += rangeCheck * float(sampleDepth != depth) * float(distSample + bias < distWorld) * step(
            1.0,
            dot(diff, diff)
          ) * sampleValid;
          
          totalWeight += sampleValid;
      }
      float occ = clamp(1.0 - occluded / (totalWeight == 0.0 ? 1.0 : totalWeight), 0.0, 1.0);
      gl_FragColor = vec4(occ, 0.5 + 0.5 * normal);
}`},Wse={uniforms:{sceneDiffuse:{value:null},sceneDepth:{value:null},tDiffuse:{value:null},transparencyDWFalse:{value:null},transparencyDWTrue:{value:null},transparencyDWTrueDepth:{value:null},transparencyAware:{value:!1},projMat:{value:new Ce},viewMat:{value:new Ce},projectionMatrixInv:{value:new Ce},viewMatrixInv:{value:new Ce},cameraPos:{value:new w},resolution:{value:new ie},color:{value:new w(0,0,0)},blueNoise:{value:null},downsampledDepth:{value:null},time:{value:0},intensity:{value:10},renderMode:{value:0},gammaCorrection:{value:!1},logDepth:{value:!1},ortho:{value:!1},near:{value:.1},far:{value:1e3},screenSpaceRadius:{value:!1},radius:{value:0},distanceFalloff:{value:1},fog:{value:!1},fogExp:{value:!1},fogDensity:{value:0},fogNear:{value:1/0},fogFar:{value:1/0},colorMultiply:{value:!0}},depthWrite:!1,depthTest:!1,vertexShader:`
		varying vec2 vUv;
		void main() {
			vUv = uv;
			gl_Position = vec4(position, 1);
		}`,fragmentShader:`
		uniform sampler2D sceneDiffuse;
    uniform highp sampler2D sceneDepth;
    uniform highp sampler2D downsampledDepth;
    uniform highp sampler2D transparencyDWFalse;
    uniform highp sampler2D transparencyDWTrue;
    uniform highp sampler2D transparencyDWTrueDepth;
    uniform sampler2D tDiffuse;
    uniform sampler2D blueNoise;
    uniform vec2 resolution;
    uniform vec3 color;
    uniform mat4 projectionMatrixInv;
    uniform mat4 viewMatrixInv;
    uniform float intensity;
    uniform float renderMode;
    uniform float near;
    uniform float far;
    uniform bool gammaCorrection;
    uniform bool logDepth;
    uniform bool ortho;
    uniform bool screenSpaceRadius;
    uniform bool fog;
    uniform bool fogExp;
    uniform bool colorMultiply;
    uniform bool transparencyAware;
    uniform float fogDensity;
    uniform float fogNear;
    uniform float fogFar;
    uniform float radius;
    uniform float distanceFalloff;
    uniform vec3 cameraPos;
    varying vec2 vUv;
    highp float linearize_depth(highp float d, highp float zNear,highp float zFar)
    {
        return (zFar * zNear) / (zFar - d * (zFar - zNear));
    }
    highp float linearize_depth_ortho(highp float d, highp float nearZ, highp float farZ) {
      return nearZ + (farZ - nearZ) * d;
    }
    highp float linearize_depth_log(highp float d, highp float nearZ,highp float farZ) {
      float depth = pow(2.0, d * log2(farZ + 1.0)) - 1.0;
      float a = farZ / (farZ - nearZ);
      float b = farZ * nearZ / (nearZ - farZ);
      float linDepth = a + b / depth;
      return ortho ? linearize_depth_ortho(
        linDepth,
        nearZ,
        farZ
      ) :linearize_depth(linDepth, nearZ, farZ);
    }
    vec3 getWorldPosLog(vec3 posS) {
        vec2 uv = posS.xy;
        float z = posS.z;
        float nearZ =near;
        float farZ = far;
        float depth = pow(2.0, z * log2(farZ + 1.0)) - 1.0;
        float a = farZ / (farZ - nearZ);
        float b = farZ * nearZ / (nearZ - farZ);
        float linDepth = a + b / depth;
        vec4 clipVec = vec4(uv, linDepth, 1.0) * 2.0 - 1.0;
        vec4 wpos = projectionMatrixInv * clipVec;
        return wpos.xyz / wpos.w;
      }
      vec3 getWorldPos(float depth, vec2 coord) {
       // if (logDepth) {
        #ifdef LOGDEPTH
          return getWorldPosLog(vec3(coord, depth));
        #endif
      //  }
        float z = depth * 2.0 - 1.0;
        vec4 clipSpacePosition = vec4(coord * 2.0 - 1.0, z, 1.0);
        vec4 viewSpacePosition = projectionMatrixInv * clipSpacePosition;
        // Perspective division
       vec4 worldSpacePosition = viewSpacePosition;
       worldSpacePosition.xyz /= worldSpacePosition.w;
        return worldSpacePosition.xyz;
    }
  
    vec3 computeNormal(vec3 worldPos, vec2 vUv) {
      ivec2 p = ivec2(vUv * resolution);
      float c0 = texelFetch(sceneDepth, p, 0).x;
      float l2 = texelFetch(sceneDepth, p - ivec2(2, 0), 0).x;
      float l1 = texelFetch(sceneDepth, p - ivec2(1, 0), 0).x;
      float r1 = texelFetch(sceneDepth, p + ivec2(1, 0), 0).x;
      float r2 = texelFetch(sceneDepth, p + ivec2(2, 0), 0).x;
      float b2 = texelFetch(sceneDepth, p - ivec2(0, 2), 0).x;
      float b1 = texelFetch(sceneDepth, p - ivec2(0, 1), 0).x;
      float t1 = texelFetch(sceneDepth, p + ivec2(0, 1), 0).x;
      float t2 = texelFetch(sceneDepth, p + ivec2(0, 2), 0).x;
  
      float dl = abs((2.0 * l1 - l2) - c0);
      float dr = abs((2.0 * r1 - r2) - c0);
      float db = abs((2.0 * b1 - b2) - c0);
      float dt = abs((2.0 * t1 - t2) - c0);
  
      vec3 ce = getWorldPos(c0, vUv).xyz;
  
      vec3 dpdx = (dl < dr) ? ce - getWorldPos(l1, (vUv - vec2(1.0 / resolution.x, 0.0))).xyz
                            : -ce + getWorldPos(r1, (vUv + vec2(1.0 / resolution.x, 0.0))).xyz;
      vec3 dpdy = (db < dt) ? ce - getWorldPos(b1, (vUv - vec2(0.0, 1.0 / resolution.y))).xyz
                            : -ce + getWorldPos(t1, (vUv + vec2(0.0, 1.0 / resolution.y))).xyz;
  
      return normalize(cross(dpdx, dpdy));
  }

    #include <common>
    #include <dithering_pars_fragment>
    void main() {
        //vec4 texel = texture2D(tDiffuse, vUv);//vec3(0.0);
        vec4 sceneTexel = texture2D(sceneDiffuse, vUv);
        float depth = texture2D(
            sceneDepth,
            vUv
        ).x;
        #ifdef HALFRES 
        vec4 texel;
        if (depth == 1.0) {
            texel = vec4(0.0, 0.0, 0.0, 1.0);
        } else {
        vec3 worldPos = getWorldPos(depth, vUv);
        vec3 normal = computeNormal(getWorldPos(depth, vUv), vUv);
       // vec4 texel = texture2D(tDiffuse, vUv);
       // Find closest depth;
       float totalWeight = 0.0;
       float radiusToUse = screenSpaceRadius ? distance(
        worldPos,
        getWorldPos(depth, vUv +
          vec2(radius, 0.0) / resolution)
      ) : radius;
      float distanceFalloffToUse =screenSpaceRadius ?
          radiusToUse * distanceFalloff
      : distanceFalloff;
        for(float x = -1.0; x <= 1.0; x++) {
            for(float y = -1.0; y <= 1.0; y++) {
                vec2 offset = vec2(x, y);
                ivec2 p = ivec2(
                    (vUv * resolution * 0.5) + offset
                );
                vec2 pUv = vec2(p) / (resolution * 0.5);
                float sampleDepth = texelFetch(downsampledDepth,p, 0).x;
                vec4 sampleInfo = texelFetch(tDiffuse, p, 0);
                vec3 normalSample = sampleInfo.gba * 2.0 - 1.0;
                vec3 worldPosSample = getWorldPos(sampleDepth, pUv);
                float tangentPlaneDist = abs(dot(worldPosSample - worldPos, normal));
                float rangeCheck = exp(-1.0 * tangentPlaneDist * (1.0 / distanceFalloffToUse)) * max(dot(normal, normalSample), 0.0);
                float weight = rangeCheck;
                totalWeight += weight;
                texel += sampleInfo * weight;
            }
        }
        if (totalWeight == 0.0) {
            texel = texture2D(tDiffuse, vUv);
        } else {
            texel /= totalWeight;
        }
    }
        #else
        vec4 texel = texture2D(tDiffuse, vUv);
        #endif

        #ifdef LOGDEPTH
        texel.r = clamp(texel.r, 0.0, 1.0);
        if (texel.r == 0.0) {
          texel.r = 1.0;
        }
        #endif
     
        float finalAo = pow(texel.r, intensity);
        float fogFactor;
        float fogDepth = distance(
            cameraPos,
            getWorldPos(depth, vUv)
        );
        if (fog) {
            if (fogExp) {
                fogFactor = 1.0 - exp( - fogDensity * fogDensity * fogDepth * fogDepth );
            } else {
                fogFactor = smoothstep( fogNear, fogFar, fogDepth );
            }
        }
        if (transparencyAware) {
            float transparencyDWOff = texture2D(transparencyDWFalse, vUv).a;
            float transparencyDWOn = texture2D(transparencyDWTrue, vUv).a;
            float adjustmentFactorOff = transparencyDWOff;
            float adjustmentFactorOn = (1.0 - transparencyDWOn) * (
                texture2D(transparencyDWTrueDepth, vUv).r == texture2D(sceneDepth, vUv).r ? 1.0 : 0.0
            );
            float adjustmentFactor = max(adjustmentFactorOff, adjustmentFactorOn);
            finalAo = mix(finalAo, 1.0, adjustmentFactor);
        }
        finalAo = mix(finalAo, 1.0, fogFactor);
        vec3 aoApplied = color * mix(vec3(1.0), sceneTexel.rgb, float(colorMultiply));
        if (renderMode == 0.0) {
            gl_FragColor = vec4( mix(sceneTexel.rgb, aoApplied, 1.0 - finalAo), sceneTexel.a);
        } else if (renderMode == 1.0) {
            gl_FragColor = vec4( mix(vec3(1.0), aoApplied, 1.0 - finalAo), sceneTexel.a);
        } else if (renderMode == 2.0) {
            gl_FragColor = vec4( sceneTexel.rgb, sceneTexel.a);
        } else if (renderMode == 3.0) {
            if (vUv.x < 0.5) {
                gl_FragColor = vec4( sceneTexel.rgb, sceneTexel.a);
            } else if (abs(vUv.x - 0.5) < 1.0 / resolution.x) {
                gl_FragColor = vec4(1.0);
            } else {
                gl_FragColor = vec4( mix(sceneTexel.rgb, aoApplied, 1.0 - finalAo), sceneTexel.a);
            }
        } else if (renderMode == 4.0) {
            if (vUv.x < 0.5) {
                gl_FragColor = vec4( sceneTexel.rgb, sceneTexel.a);
            } else if (abs(vUv.x - 0.5) < 1.0 / resolution.x) {
                gl_FragColor = vec4(1.0);
            } else {
                gl_FragColor = vec4( mix(vec3(1.0), aoApplied, 1.0 - finalAo), sceneTexel.a);
            }
        }
        #include <dithering_fragment>
        if (gammaCorrection) {
            gl_FragColor = LinearTosRGB(gl_FragColor);
        }
    }
    `},qse={uniforms:{sceneDiffuse:{value:null},sceneDepth:{value:null},tDiffuse:{value:null},projMat:{value:new Ce},viewMat:{value:new Ce},projectionMatrixInv:{value:new Ce},viewMatrixInv:{value:new Ce},cameraPos:{value:new w},resolution:{value:new ie},time:{value:0},r:{value:5},blueNoise:{value:null},radius:{value:12},worldRadius:{value:5},index:{value:0},poissonDisk:{value:[]},distanceFalloff:{value:1},near:{value:.1},far:{value:1e3},logDepth:{value:!1},screenSpaceRadius:{value:!1}},depthWrite:!1,depthTest:!1,vertexShader:`
		varying vec2 vUv;
		void main() {
			vUv = uv;
			gl_Position = vec4(position, 1.0);
		}`,fragmentShader:`
		uniform sampler2D sceneDiffuse;
    uniform highp sampler2D sceneDepth;
    uniform sampler2D tDiffuse;
    uniform sampler2D blueNoise;
    uniform mat4 projectionMatrixInv;
    uniform mat4 viewMatrixInv;
    uniform vec2 resolution;
    uniform float r;
    uniform float radius;
     uniform float worldRadius;
    uniform float index;
     uniform float near;
     uniform float far;
     uniform float distanceFalloff;
     uniform bool logDepth;
     uniform bool screenSpaceRadius;
    varying vec2 vUv;

    highp float linearize_depth(highp float d, highp float zNear,highp float zFar)
    {
        highp float z_n = 2.0 * d - 1.0;
        return 2.0 * zNear * zFar / (zFar + zNear - z_n * (zFar - zNear));
    }
    highp float linearize_depth_log(highp float d, highp float nearZ,highp float farZ) {
     float depth = pow(2.0, d * log2(farZ + 1.0)) - 1.0;
     float a = farZ / (farZ - nearZ);
     float b = farZ * nearZ / (nearZ - farZ);
     float linDepth = a + b / depth;
     return linearize_depth(linDepth, nearZ, farZ);
   }
   highp float linearize_depth_ortho(highp float d, highp float nearZ, highp float farZ) {
     return nearZ + (farZ - nearZ) * d;
   }
   vec3 getWorldPosLog(vec3 posS) {
     vec2 uv = posS.xy;
     float z = posS.z;
     float nearZ =near;
     float farZ = far;
     float depth = pow(2.0, z * log2(farZ + 1.0)) - 1.0;
     float a = farZ / (farZ - nearZ);
     float b = farZ * nearZ / (nearZ - farZ);
     float linDepth = a + b / depth;
     vec4 clipVec = vec4(uv, linDepth, 1.0) * 2.0 - 1.0;
     vec4 wpos = projectionMatrixInv * clipVec;
     return wpos.xyz / wpos.w;
   }
    vec3 getWorldPos(float depth, vec2 coord) {
     #ifdef LOGDEPTH
          return getWorldPosLog(vec3(coord, depth));
     #endif
        
        float z = depth * 2.0 - 1.0;
        vec4 clipSpacePosition = vec4(coord * 2.0 - 1.0, z, 1.0);
        vec4 viewSpacePosition = projectionMatrixInv * clipSpacePosition;
        // Perspective division
       vec4 worldSpacePosition = viewSpacePosition;
       worldSpacePosition.xyz /= worldSpacePosition.w;
        return worldSpacePosition.xyz;
    }
    #include <common>
    #define NUM_SAMPLES 16
    uniform vec2 poissonDisk[NUM_SAMPLES];
    void main() {
        const float pi = 3.14159;
        vec2 texelSize = vec2(1.0 / resolution.x, 1.0 / resolution.y);
        vec2 uv = vUv;
        vec4 data = texture2D(tDiffuse, vUv);
        float occlusion = data.r;
        float baseOcc = data.r;
        vec3 normal = data.gba * 2.0 - 1.0;
        float count = 1.0;
        float d = texture2D(sceneDepth, vUv).x;
        if (d == 1.0) {
          gl_FragColor = data;
          return;
        }
        vec3 worldPos = getWorldPos(d, vUv);
        float size = radius;
        float angle;
        if (index == 0.0) {
             angle = texture2D(blueNoise, gl_FragCoord.xy / 128.0).x * PI2;
        } else if (index == 1.0) {
             angle = texture2D(blueNoise, gl_FragCoord.xy / 128.0).y * PI2;
        } else if (index == 2.0) {
             angle = texture2D(blueNoise, gl_FragCoord.xy / 128.0).z * PI2;
        } else {
             angle = texture2D(blueNoise, gl_FragCoord.xy / 128.0).w * PI2;
        }

        mat2 rotationMatrix = mat2(cos(angle), -sin(angle), sin(angle), cos(angle));
        float radiusToUse = screenSpaceRadius ? distance(
          worldPos,
          getWorldPos(d, vUv +
            vec2(worldRadius, 0.0) / resolution)
        ) : worldRadius;
        float distanceFalloffToUse =screenSpaceRadius ?
        radiusToUse * distanceFalloff
    : radiusToUse * distanceFalloff * 0.2;


        for(int i = 0; i < NUM_SAMPLES; i++) {
            vec2 offset = (rotationMatrix * poissonDisk[i]) * texelSize * size;
            vec4 dataSample = texture2D(tDiffuse, uv + offset);
            float occSample = dataSample.r;
            vec3 normalSample = dataSample.gba * 2.0 - 1.0;
            float dSample = texture2D(sceneDepth, uv + offset).x;
            vec3 worldPosSample = getWorldPos(dSample, uv + offset);
            float tangentPlaneDist = abs(dot(worldPosSample - worldPos, normal));
            float rangeCheck = dSample == 1.0 ? 0.0 :exp(-1.0 * tangentPlaneDist * (1.0 / distanceFalloffToUse)) * max(dot(normal, normalSample), 0.0) * (1.0 - abs(occSample - baseOcc));
            occlusion += occSample * rangeCheck;
            count += rangeCheck;
        }
        if (count > 0.0) {
          occlusion /= count;
        }
        #ifdef LOGDEPTH
          occlusion = clamp(occlusion, 0.0, 1.0);
          if (occlusion == 0.0) {
            occlusion = 1.0;
          }
        #endif
        gl_FragColor = vec4(occlusion, 0.5 + 0.5 * normal);
    }
    `},Xse={uniforms:{sceneDepth:{value:null},resolution:{value:new ie},near:{value:.1},far:{value:1e3},viewMatrixInv:{value:new Ce},projectionMatrixInv:{value:new Ce},logDepth:{value:!1}},depthWrite:!1,depthTest:!1,vertexShader:`
    varying vec2 vUv;
    void main() {
        vUv = uv;
        gl_Position = vec4(position, 1);
    }`,fragmentShader:`
    uniform highp sampler2D sceneDepth;
    uniform vec2 resolution;
    uniform float near;
    uniform float far;
    uniform bool logDepth;
    uniform mat4 viewMatrixInv;
    uniform mat4 projectionMatrixInv;
    varying vec2 vUv;
    layout(location = 1) out vec4 gNormal;
    vec3 getWorldPosLog(vec3 posS) {
        vec2 uv = posS.xy;
        float z = posS.z;
        float nearZ =near;
        float farZ = far;
        float depth = pow(2.0, z * log2(farZ + 1.0)) - 1.0;
        float a = farZ / (farZ - nearZ);
        float b = farZ * nearZ / (nearZ - farZ);
        float linDepth = a + b / depth;
        vec4 clipVec = vec4(uv, linDepth, 1.0) * 2.0 - 1.0;
        vec4 wpos = projectionMatrixInv * clipVec;
        return wpos.xyz / wpos.w;
      }
      vec3 getWorldPos(float depth, vec2 coord) {
        if (logDepth) {
          return getWorldPosLog(vec3(coord, depth));
        }
        float z = depth * 2.0 - 1.0;
        vec4 clipSpacePosition = vec4(coord * 2.0 - 1.0, z, 1.0);
        vec4 viewSpacePosition = projectionMatrixInv * clipSpacePosition;
        // Perspective division
       vec4 worldSpacePosition = viewSpacePosition;
       worldSpacePosition.xyz /= worldSpacePosition.w;
        return worldSpacePosition.xyz;
    }
  
    vec3 computeNormal(vec3 worldPos, vec2 vUv) {
      ivec2 p = ivec2(vUv * resolution);
      float c0 = texelFetch(sceneDepth, p, 0).x;
      float l2 = texelFetch(sceneDepth, p - ivec2(2, 0), 0).x;
      float l1 = texelFetch(sceneDepth, p - ivec2(1, 0), 0).x;
      float r1 = texelFetch(sceneDepth, p + ivec2(1, 0), 0).x;
      float r2 = texelFetch(sceneDepth, p + ivec2(2, 0), 0).x;
      float b2 = texelFetch(sceneDepth, p - ivec2(0, 2), 0).x;
      float b1 = texelFetch(sceneDepth, p - ivec2(0, 1), 0).x;
      float t1 = texelFetch(sceneDepth, p + ivec2(0, 1), 0).x;
      float t2 = texelFetch(sceneDepth, p + ivec2(0, 2), 0).x;
  
      float dl = abs((2.0 * l1 - l2) - c0);
      float dr = abs((2.0 * r1 - r2) - c0);
      float db = abs((2.0 * b1 - b2) - c0);
      float dt = abs((2.0 * t1 - t2) - c0);
  
      vec3 ce = getWorldPos(c0, vUv).xyz;
  
      vec3 dpdx = (dl < dr) ? ce - getWorldPos(l1, (vUv - vec2(1.0 / resolution.x, 0.0))).xyz
                            : -ce + getWorldPos(r1, (vUv + vec2(1.0 / resolution.x, 0.0))).xyz;
      vec3 dpdy = (db < dt) ? ce - getWorldPos(b1, (vUv - vec2(0.0, 1.0 / resolution.y))).xyz
                            : -ce + getWorldPos(t1, (vUv + vec2(0.0, 1.0 / resolution.y))).xyz;
  
      return normalize(cross(dpdx, dpdy));
  }
    void main() {
        vec2 uv = vUv - vec2(0.5) / resolution;
        vec2 pixelSize = vec2(1.0) / resolution;
        highp vec2[4] uvSamples;
        uvSamples[0] = uv;
        uvSamples[1] = uv + vec2(pixelSize.x, 0.0);
        uvSamples[2] = uv + vec2(0.0, pixelSize.y);
        uvSamples[3] = uv + pixelSize;
        float depth00 = texture2D(sceneDepth, uvSamples[0]).r;
        float depth10 = texture2D(sceneDepth, uvSamples[1]).r;
        float depth01 = texture2D(sceneDepth, uvSamples[2]).r;
        float depth11 = texture2D(sceneDepth, uvSamples[3]).r;
        float minDepth = min(min(depth00, depth10), min(depth01, depth11));
        float maxDepth = max(max(depth00, depth10), max(depth01, depth11));
        float targetDepth = minDepth;
        // Checkerboard pattern to avoid artifacts
        if (mod(gl_FragCoord.x + gl_FragCoord.y, 2.0) > 0.5) { 
            targetDepth = maxDepth;
        }
        int chosenIndex = 0;
        float[4] samples;
        samples[0] = depth00;
        samples[1] = depth10;
        samples[2] = depth01;
        samples[3] = depth11;
        for(int i = 0; i < 4; ++i) {
            if (samples[i] == targetDepth) {
                chosenIndex = i;
                break;
            }
        }
        gl_FragColor = vec4(samples[chosenIndex], 0.0, 0.0, 1.0);
        gNormal = vec4(computeNormal(
            getWorldPos(samples[chosenIndex], uvSamples[chosenIndex]), uvSamples[chosenIndex]
        ), 0.0);
    }`};var hG="5L7pP4UXrOIr/VZ1G3f6p89FIWU7lqc7J3DPxKjJUXODJoHQzf/aNVM+ABlvhXeBGN7iC0WkmTjEaAqOItBfBdaK5KSGV1ET5SOKl3x9JOX5w2sAl6+6KjDhVUHgbqq7DZ5EeYzbdSNxtrQLW/KkPJoOTG4u5CBUZkCKHniY9l7DUgjuz708zG1HIC8qfohi1vPjPH9Lq47ksjRrjwXD4MlVCjdAqYFGodQ8tRmHkOfq4wVRIAHvoavPHvN1lpk3X4Y1yzAPGe8S9KBs3crc4GwlU1dEOXiWol/mgQqxkNqB1xd04+0Bmpwj0GcCc4NUi+c731FUxjvaexCkCJ0qhrJJ++htWqetNC4NewClu8aFRSwrqiJEGe+qtTg4CYCHaF1wJI0sy/ZBQAI0qAMyBvVjWZlv2pdkCaro9eWDLK5I4mbb8E4d7hZr9dDJiTJm6Bmb5S+2F7yal/JPdeLUfwq7jmVLaQfhv4tWMJAt7V4sG9LuAv2oPJgSj1nnlBvPibfHM2TrlWHwGCLGxW/5Jm2TotaDL+pHDM5pn1r0UuTZ24N8S5k68bLHW9tfD+2k4zGev23ExJb4YTRKWrj82N5LjJ26lj1BkGZ0CsXLGGELoPaYQomjTqPxYqhfwOwDliNGVqux9ffuybqOKgsbB51B1GbZfG8vHDBE2JQGib1mnCmWOWAMJcHN0cKeDHYTflbDTVXajtr68mwfRje6WueQ/6yWqmZMLWNH7P27zGFhMFqaqfg11Q88g/9UA/FROe9yfq0yOO0pnNAxvepFy2BpEbcgG+mCyjCC01JWlOZlIPdf1TtlyOt7L94ToYGCukoFt4OqwOrofamjECpSgKLLmrRM+sNRAw12eaqk8KtdFk7pn2IcDQiPXCh16t1a+psi+w9towHTKPyQM0StKr61b2BnN1HU+aezFNBLfHTiXwhGTbdxLLmrsAGIVSiNAeCGE8GlB0iOv2v78kP0CTmAPUEqnHYRSDlP+L6m/rYjEK6Q85GRDJi2W20/7NLPpSOaMR++IFvpkcwRuc59j8hh9tYlc1xjdt2jmp9KJczB7U9P43inuxLOv11P5/HYH5d6gLB0CsbGC8APjh+EcCP0zFWqlaACZweLhVfv3yiyd8R3bdVg8sRKsxPvhDaPpiFp9+MN+0Ua0bsPr+lhxfZhMhlevkLbR4ZvcSRP6ApQLy3+eMh9ehCB3z5DVAaN3P6J8pi5Qa88ZQsOuCTWyH6q8yMfBw8y8nm6jaOxJhPH6Hf0I4jmALUBsWKH4gWBnyijHh7z3/1HhQzFLRDRrIQwUtu11yk7U0gDw/FatOIZOJaBx3UqbUxSZ6dboFPm5pAyyXC2wYdSWlpZx/D2C6hDO2sJM4HT9IKWWmDkZIO2si/6BKHruXIEDpfAtz3xDlIdKnnlqnkfCyy6vNOPyuoWsSWBeiN0mcfIrnOtp2j7bxjOkr25skfS/lwOC692cEp7TKSlymbsyzoWg/0AN66SvQYo6BqpNwPpTaUu25zMWlwVUdfu1EEdc0O06TI0JmHk4f6GZQbfOs//OdgtGPO6uLoadJycR8Z80rkd88QoNmimZd8vcpQKScCFkxH1RMTkPlN3K7CL/NSMOiXEvxrn9VyUPFee63uRflgaPMSsafvqMgzTt3T1RaHNLLFatQbD0Vha4YXZ/6Ake7onM65nC9cyLkteYkDfHoJtef7wCrWXTK0+vH38VUBcFJP0+uUXpkiK0gDXNA39HL/qdVcaOA16kd2gzq8aHpNSaKtgMLJC6fdLLS/I/4lUWV2+djY9Rc3QuJOUrlHFQERtXN4xJaAHZERCUQZ9ND2pEtZg8dsnilcnqmqYn3c1sRyK0ziKpHNytEyi2gmzxEFchvT1uBWxZUikkAlWuyqvvhteSG9kFhTLNM97s3X1iS2UbE6cvApgbmeJ/KqtP0NNT3bZiG9TURInCZtVsNZzYus6On0wcdMlVfqo8XLhT5ojaOk4DtCyeoQkBt1mf5luFNaLFjI/1cnPefyCQwcq5ia/4pN4NB+xE/3SEPsliJypS964SI6o5fDVa0IERR8DoeQ+1iyRLU1qGYexB61ph4pkG1rf3c2YD6By1pFCmww9B0r2VjFeaubkIdgWx4RKLQRPLENdGo8ezI5mkNtdCws19aP1uHhenD+HKa8GDeLulb2fiMRhU2xJzzz9e4yOMPvEnGEfbCiQ17nUDpcFDWthr68mhZ4WiHUkRpaVWJNExuULcGkuyVLsQj59pf6OHFR7tofhy9FMrWPCEvX1d5sCVJt8yBFiB6NoOuwMy4wlso9I2G4E5/5B2c6vIZUUY9fFujT3hpkdTuVhbhBwLCtnlIjBpN4cq+waZ0wXSrmebcl+dcrb7sPh9jKxFINkScDTBgjSUfLkC3huJJs/M4M8AOFxbbSIVpBUarYFmLpGsv+V6TJnWNTwI41tubwo7QSI1VOdRKT/Pp8U3oK2ciDbeuWnAGAANvQjGfcewdAdo6H83XzqlK/4yudtFHJSv9Y+qJskwnVToH1I0+tJ3vsLBXtlvMzLIxUj/8LcqZnrNHfVRgabFNXW0qpUvDgxnP3f54KooR3NI+2Q/VHAYFigMkQE5dLH6C6fGs/TKeE6E2jOhZQcP9/rrJjJKcLYdn5cw6XLCUe9F7quk5Yhac+nYL5HOXvp6Q/5qbiQHkuebanX77YSNx34YaWYpcEHuY1u/lEVTCQ7taPaw3oNcn/qJhMzGPZUs3XAq48wj/hCIO2d5aFdfXnS0yg57/jxzDJBwkdOgeVnyyh19Iz1UqiysT4J1eeKwUuWEYln23ydtP7g3R1BnvnxqFPAnOMgOIop2dkXPfUh/9ZKV3ZQbZNactPD4ql5Qg9CxSBnIwzlj/tseQKWRstwNbf17neGwDFFWdm/8f+nDWt/WlKV3MUiAm3ci6xXMDSL5ubPXBg/gKEE7TsZVGUcrIbdXILcMngvGs7unvlPJh6oadeBDqiAviIZ/iyiUMdQZAuf/YBAY0VP1hcgInuWoKbx31AOjyTN2OOHrlthB3ny9JKHOAc8BMvqopikPldcwIQoFxTccKKIeI815GcwaKDLsMbCsxegrzXl8E0bpic/xffU9y1DCgeKZoF2PIY77RIn6kSRdBiGd8NtNwT74dyeFBMkYraPkudN26x9NPuBt4iCOAnBFaNSKVgKiZQruw22kM1fgBKG7cPYAxdHJ8M4V/jzBn2jEJg+jk/jjV4oMmMNOpKB5oVpVh7tK529Z+5vKZ0NSY2A4YdcT0x4BdkoNEDrpsTmekSTjvx9ZBiTHrm9M/n/hGmgpjz4WEjttRfAEy5DYH5vCK/9GuVPa4hoApFaNlrFD/n2PpKOw24iKujKhVIz41p1E0HwsCd/c17OA0H0RjZi1V/rjJLexUzpmXTMIMuzaOBbU4dxvQMgyvxJvR6DyF3BaHkaqT4P3FRYlm+zh8EEGgmkNqD1WRUubDW62VqLoH8UEelIpL7C8CguWWGGCAIDPma9bnh+7IJSt0Cn6ACER2mYk8dLsrN70RUVLiE0ig+08yPY9IOtuqHf/KYsT84BwhMcVq7t8q1WVjpJGNyXdtIPIjhAzabtrX03Itn29QO3TCixE9WpkHIOdAoGvqCrw1D3x9g9Px8u0yZZuulZuGy0veSY34KDSlhsO1zx2ZMrpDBzCHPB4niwApk6NevIvmBxU3+4yaewDvgEQDJ6Of5iRxjAIpp9UO8EzNY4blj4qh8SCSZTqbe/lShE6tNU9Y5IoWHeJxPcHF9KwYQD7lFcIpcscHrcfkHJfL2lL1zczKywEF7BwkjXEirgBcvNWayatqdTVT5oLbzTmED3EOYBSXFyb2VIYk3t0dOZWJdG1nP+W7Qfyeb8MSIyUGKEA57ptPxrPHKYGZPHsuBqQuVSrn0i8KJX+rlzAqo8AawchsJ26FckxTf5+joTcw+2y8c8bushpRYEbgrdr64ltEYPV2AbVgKXV3XACoD1gbs01CExbJALkuItjfYN3+6I8kbiTYmdzBLaNC+xu9z/eXcRQV1Lo8cJoSsKyWJPuTncu5vcmfMUAWmuwhjymK1rhYR8pQMXNQg9X+5ha5fEnap+LhUL1d5SURZz9rGdOWLhrMcMKSaU3LhOQ/6a6qSCwgzQxCW2gFs53fpvfWxhH+xDHdKRV6w29nQ6rNqd9by+zm1OpzYyJwvFyOkrVXQUwt4HaapnweCa7Tj2Mp/tT4YcY3Q/tk1czgkzlV5mpDrdp1spOYB8ionAwxujjdhj5y9qEHu0uc36PAKAYsKLaEoiwPnob0pdluPWdv4sNSlG8GWViI+x/Z4DkW/kSs2iE3ADFjg4TCvgCbX3v0Hz0KZkerrpzEIukAusidDs2g/w0zgmLnZXvVr5kkpwQTLZ0L6uaTHl0LVikIuNIVPmL3fOQJqIdfzymUN0zucIrDintBn6ICl/inj5zteISv5hEMGMqtHc2ghcFJvmH3ZhIZi34vqqTFCb9pltTYz582Y3dwYaHb9khdfve1YryzEwEKbI8qm62qv+NyllC+WxLLAJjz0ZaEF2aTn35qeFmkbP6LDYcbwqWxA0WKsteB7vy8bRHE4r8LhubWDc0pbe90XckSDDAkRej0TQlmWsWwaz18Tx2phykVvwuIRzf4kt9srT8N7gsMjMs0NLAAldabFf2tiMoaaxHcZSX51WPc1BrwApMxih227qTZkcgtkdK1h314XvZKUKh/XysWYnk1ST4kiBI1B9OlfTjB3WHzTAReFLofsGtikwpIXzQBc/gOjz2Thlj36WN0sxyf4RmAFtrYt64fwm+ThjbhlmUTZzebLl4yAkAqzJSfjPBZS2H/IvkkTUdVh0qdB6EuiHEjEil5lk9BTPzxmoW4Jx543hiyy4ASdYA2DNoprsR9iwGFwFG3F2vIROy4L5CZrl230+k733JwboSNBKngsaFPtqo+q3mFFSjC1k0kIAFmKihaYSwaSF7konmYHZWmchuaq15TpneA2ADSRvA07I7US0lTOOfKrgxhzRl0uJihcEZhhYWxObjvNTJ/5sR4Aa5wOQhGClGLb746cJhQ2E6Jie1hbGgWxUH7YSKETptrTeR/xfcMNk2WM12S0XElC9klR8O7jLYekEOZdscP0ypSdoCVZAoK+2ju2PHE869Q9rxCs9DVQco4BriiPbCjN/8tBjsah4IuboR5QbmbyDpcdXVxGMxvWKIjocBuKbjb+B4HvkunbG0wX0IFCjQKoNMFIKcJSJXtkP3EO+J16uh4img0LQlBAOYwBLupu5r1NALMo0g3xkd9b4f7KoCBWHeyk24FmYUCy/PGLv0xErOTyORp8TJ5nnc2k1dOVBTJok7iHye9dwxwRVP3c7eAS8pMmJYHGpzIHz6ii2WJm8HMTPAZdA4q+ugj3PNCL/N45kyglqvQV4f/+ryDDG5RPy5HVoV9FVuJcq2dxF9Y0heVoipV6q1LyfAeuMzbsUV+rsSBmCSV+1CdKlxy0T0Y6Om0X6701URm2Ml6DIQgJ/3KO6kwcMYRrmKsY7TfxWhSXZll+1PfyRXe9HS0t1IKTQMZL7ZqQ8D/o+en57Y9XAQ9C+kZYykNr0xOMxEwu2+Cppm69mQyTm3H7QX6kHvXF201r+KVAf354qypJC5OHSeBU47bM1bTaVmdVEWQ+9CcvvHdu8Ue5UndHM+EeukmR82voQpetZ7WJjyXs+tPS60nk09gymuORoHNtbm0VuvyigiEvOsyHiRBW7V6FyTCppLPEHvesan91SlEh1/QEunq+qgREFXByDwNKcAH5s8/RFg8hP4wcPmFqX0xXGSKY087bqRLsBZe52jThx0XLkhKQUWPvI18WQQS3g2Ra1pzQ1oNFKdfJJjyaH5tJH6w0/upJobwB8KZ5cIs9LnVGxfBaHXBfvLkNpab7dpU6TdcbBIc+A4bqXE/Xt8/xsGQOdoXra4Us5nDAM6v2BNBQaGMmgMfQQV+ikTteSHvyl8wUxULiYRIEKaiDxpBJnyf9OoqQdZVJ8ahqOvuwqq5mnDUAUzUr/Lvs1wLu2F+r4eZMfJPL4gV5mKLkITmozRnTvA7VABaxZmFRtkhvU5iH9RQ1z26ku7aABokvptx7RKZBVL6dveLKOzg0NC7HAxcg5kE1wuyJiEQLOpO0ma3AtWD2Q2Wmn2oPZeDYAwVyEpxuwDy7ivmdUDSL95ol3h2JByTMovOCgxZ1q4E5nwwa7+4WtDAse6bDdr27XgAi5Px3IWbyZ/vRiECKwOMeJSuIl8A4Ds0emI3SgKVVWVO5uyiEUET+ucEq0casA+DQyhzRc8j+Plo0pxKynB/t0uXod1FVV4fX1sC4kDfwFaUDGQ4p9HYgaMqIWX3OF/S8+vcR0JS0bDapWKJwAIIQiRUzvh5YwtzkjccbbrT9Ky/qt5X7MAGA0lzh43mDF9EB6lCGuO/aFCMhdOqNryvd73KdJNy3mxtT8AqgmG4xq7eE1jKu6rV0g8UGyMatzyIMjiOCf4lIJFzAfwDbIfC72TJ/TK+cGsLR8blpjlEILjD8Mxr7IffhbFhgo12CzXRQ2O8JqBJ70+t12385tSmFC8Or+U8svOaoGoojT1/EmjRMT7x2iTUZ7Ny02VGeMZTtGy029tGN1/9k7x3mFu63lYnaWjfJT1m1zpWO3HSXpGkFqVd/m3kDMv4X9rmLOpwEeu8r6TI6C2zUG+MT6v90OU3y5hKqLhpyFLGtkZhDmUg/W1JGSmA8N1TapR4Kny+P6+DuMadZ9+xBbv06nfOjMwkoTsjG0zFmNbvlxEjw+Pl5QYK+V8Qyb+nknZ0Nb/Ofi9+V0eoNtTrtD1/0wzUGGG5u2D/J1ouO/PjXFJVx6LurVnPOyFVbZx7s3ZSjSq+7YN3wzTbFbUvP8GBh7cKieJt56SIowQ2I577+UEXrxUKMFO+XaLLCALuiJWB2vUdpsT+kQ+adoeTfwOulXhd/KZ7ygjj6PhvGT1xzfT7hTwd6dzSB4xV70CesHC0dsg2VyujlMGBKjg5snbrHHX/LNj3SsoLGSX+bZNTDDCNTXh+dCVPlj4K8+hJ/kVddrbtZw26Hx5qYiv3oNNg5blHRSPtmojhZmBQAz8sLC9nAuWNSz1dIofFtlryEKklbdkhBCcx5dhj7pinXDNlCeatCeTCEjYCpZ3HRf5QzUcRR1Tdb3gwtYtpPdgMxmWfJGoZSu1EsCJbIhS16Ed97+8br4Ar1mB1GcnZVx/HPtJl4CgbHXrrDPwlE4od8deRQYLt9IlsvCqgesMmLAVxB+igH7WGTcY/e3lLHJ4rkBgh2p1QpUBRb/cSQsJCbosFDkalbJigimldVK7TIHKSq2w8mezku9hgw8fXJxGdXoL1ggma52kXzjP78l0d0zMwtTVlt0FqnRyGLPGEjmICzgSp7XPFlUr7AeMclQ4opqwBFInziM5F8oJJ8qeuckGOnAcZZOLl1+ZhGF17pfIuujipwFJL7ChIIB2vlo0IQZGTJPNa2YjNcGUw+a/gWYLkCp+bOGIYhWr08UIE709ZEHlUoEbumzgpJv1D0+hWYNEpj+laoZIK5weO2DFwLL6UBYNrXTm9YvvxeN9U9oKsB3zKBwzFFwDgid5ESMhy68xBnVa55sCZd+l5AnzT8etYjIwF/BGwEx1jjzFv32bk6EeJulESARh8RZ48o7rKw67UZpudPa15SDnL8AL8xMV2SC0D1P53p190zhCFkMmEiir2olwxcJppl/kLm6/0QSUQLNaxi1AC3Pg1CTosX2YQr73PjEIxIlg4mJ62vP7ZyoHE55B0SX9YrrrCPtNsrJEwtn6KOSt7nLT3n3DLJTPbLulcqQ1kETP6Huts29oP+JLEqRGWgnrqMD+mhCl1XCZifjgQ39AeudE8pyu2DqnYU3PyPbJhStq1HbP+VxgseWL+hQ+4w1okADlA9WqoaRuoS7IY77Cm40cJiE6FLomUMltT+xO3Upcv5dzSh9F57hodSBnMHukcH1kd9tqlpprBQ/Ij9E+wMQXrZG5PlzwYJ6jmRdnQtRj64wC/7vsDaaMFteBOUDR4ebRrNZJHhwlNEK9Bz3k7jqOV5KJpL74p2sQnd7vLE374Jz+G7H3RUbX17SobYOe9wKkL/Ja/zeiKExOBmPo0X29bURQMxJkN4ddbrHnOkn6+M1zTZHo0efsB23WSSsByfmye2ZuTEZ12J3Y8ffT6Fcv8XVfA/k+p+xJGreKHJRVUIBqfEIlRt987/QXkssXuvLkECSpVEBs+gE1meB6Xn1RWISG6sV3+KOVjiE9wGdRHS8rmTERRnk0mDNU/+kOQYN/6jdeq0IHeh9c6xlSNICo9OcX1MmAiEuvGay43xCZgxHeZqD7etZMigoJI5V2q7xDcXcPort7AEjLwWlEf4ouzy2iPa3lxpcJWdIcHjhLZf1zg/Kv3/yN1voOmCLrI1Fe0MuFbB0TFSUt+t4Wqe2Mj1o2KS0TFQPGRlFm26IvVP9OXKIQkjfueRtMPoqLfVgDhplKvWWJA673+52FgEEgm+HwEgzOjaTuBz639XtCTwaQL/DrCeRdXun0VU3HDmNmTkc6YrNR6tTVWnbqHwykSBswchFLnvouR0KRhDhZiTYYYNWdvXzY+61Jz5IBcTJavGXr9BcHdk/3tqaLbwCbfpwjxCFSUs1xfFcRzRfMAl+QYuCpsYGz9H01poc1LyzhXwmODmUSg/xFq/RosgYikz4Om/ni9QCcr28ZPISaKrY7O+CspM/s+sHtnA9o9WgFWhcBX2LDN2/AL5uB6UxL/RaBp7EI+JHGz6MeLfvSNJnBgI9THFdUwmg1AXb9pvd7ccLqRdmcHLRT1I2VuEAghBduBm7pHNrZIjb2UVrijpZPlGL68hr+SDlC31mdis0BjP4aZFEOcw+uB17y5u7WOnho60Vcy7gRr7BZ9z5zY1uIwo+tW1YKpuQpdR0Vi7AxKmaIa4jXTjUh7MRlNM0W/Ut/CSD7atFd4soMsX7QbcrUZZaWuN0KOVCL9E09UcJlX+esWK56mre/s6UO9ks0owQ+foaVopkuKG+HZYbE1L1e0VwY2J53aCpwC77HqtpyNtoIlBVzOPtFvzBpDV9TjiP3CcTTGqLKh+m7urHvtHSB/+cGuRk4SsTma9sPCVJ19UPvaAv5WB8u57lNeUewwKpXmmKm5XZV91+FqCCT6nVrrrOgXfYmGFlVjqsSn3/yufkGIdtmdD0yVBcYFR3hDx43e3E4iuiEtP3Me9gcsBqveQdKojKR//qD2nEDY0IktMgFvH+SqVWi9mAorym92NEGbY8MeDjp553MiTXCRSASPt+Ga5q7pB9vwFQCTpaoevx0yEfrq9rMs3eU6wclBMJ9Ve8m6QuLYZ58J41YG3jW/khW92h6M/vbFIUPuopZ6VVtpciesU74Ef7ic8iSymDohGeUn4ubT0vRsXmbsjaJaYhL8f+8I5EiD5l680MJbxX/4GYrOg4iPQqpKp0qddSu/HKtznHeVyxgTwhfEORMCwnaqetVSzvidaWN9P+fXtGXfEP9cTdwx2gKVfDdICq7hecgRhIs0qlCt6+5pGlCc6kWoplHa/KjP+FJdXBU/IDoKMxRjFhSYkggIkhvRKiN/b2ud8URPF+lB87AGAwyMjr/Wju2Uj5IrppXZWjI3d14BdKE2fhALyQPmHqqA+AXd2LwvRHcBq4mhOQ4oNRWH7wpzc6Pggfcbv9kqhLxrJKEaJqA6Rxi+TDNOJstd5DoRVCDjmVspCVyHJsFEWPg9+NA8l1e4X2PDvOd5MPZAGw6LRhWqeZoSQcPf9/dGJYAyzCmttlRnx0BfrKQ/G9i5DVJft9fuJwMi3OD/0Dv1bRoxcXAyZ0wMJ6rwk9RjRTF4ZK8JviCCNuVt/BqQYiphOzWCpnbwOZt6qXuiAabQWrS4mNXQ7cEErXR/yJcbdFp5nWE1bPBjD0fmG3ovMxmOq5blpcOs0DtNQpci1t+9DKERWAO53IVV/S4yhMklvIp0j0FIQgwjdUptqmoMYGVWSI5YkTKLHZdXRDv9zs+HdFZt1QVcdlGOgATro3fg6ticCrDQKUJC7bYX50wdvetilEwVenHhlr85HMLRLTD6nDXWId4ORLwwe5IXiOhpuZTVTv+xdkTxJofqeCRM/jcZqQlU0gFVTlYlfwMi6HKR2YG4fQ8TOtgR+yV+BMZb6L5OwDc/28/xdfD7GXFaVA2ZSObiIxBwT2Zev637EuvpM6rxcogdM4FJFa0ZhF7nrqtNsqWg5M7hZMORpjd4szf/wS+Ahs1shY54Ct5J1dOBO4sdEtSnRc0P9PhgyOCt6aQW98R22DpAcNTDe72AHK40vutKTPfpokghRPuGvz0dulBPKfC3O4KVDCyWrJGO7Ikdu06A0keKlVfi0tGcpO0NhzXEh75NHyMysAMV19fq7//sPC0For1k2uFEvq8lwrMAfmP7afR69U2RqaILHe7glpc8HmVf87Qb2ohsw+Di9U+ePdHLecS66MhB/0OwdcXR5WBcWTZLGq/kiAaT+bzkjR8GIpWdv6pfIgQ+Q0xdiKvo+gNB7/Nf9knNJGxnh7LeZEFtMn517tNc74PPS0M4K3I6HHZqNPA+VZcBc/g5a2ARyqKrJ4Z3krsuA+VOJJz2KJpBMgCCWFln3u7k6/q3DETAubKG/pt3ObaNT0NI0Qug90L2ip5dHnZJUjPTvK5E96aX/4mRU2u8n8kh6MKbY7ANBro3huF06U+JvfyELQP25oIaj+n0ITQ4KT9rXZD4EtBIOj95fYNldDN3io/VMIvWNj9P/b95WEMq8UAVfG2XG0N6fSYdnBEC7sUEbatbDICH9qA8TTuW9kEt9DlFOZFP7bdfYLa/khSY8W5K/AkIIAPXtMvyVKyESjKx9nfragssxC0jFMVY94d8lOAwRocdS/l/P43cBGa3IqDa0ihGPcmwS8O8Vj16Uy55rOrnN0shhRJZdW8I7F0Q0KeHc35GFo4aJOFc25gNafBu1V/VO0qS4Qkb6wjRrnlepUWjtYyaDABZceValuOMtoDdeIITWKOJiwGPpB12lQgwkmXh9M86podb0D117mNQ8ElluFvbaS8RTKQ6lyj88dUwoJU/ofOeubhoXWBF8eNumkVJu+As3ED/AvLlrV91UowIWI2m8HBG+a3k247ZKAGYsOcWe7fTWqL8eqwM5ZFuoXbeugPKuMOAtOsN+4dSwkhrSAlfGNTzFwEmCNWtzpa9CgPbYNcmoHtO8pj8qMvlGET6nrkJoQ2lp5MEUV1E2A4ZH70JUlCLXvqTIpZlzyxdr5p/GZiD1/BuFOGbyfFzhuxaC/l3lC2jjt6GNRBa06AqqPlYtdA7kiidYa5Qi0/XpXiMDyMXNOj3kmJEaXufW0GO8+DF8OoMULX1vvjCePKNis4AmxQKLCF+cjf/wyilCJvuiyLVPSdsuRTPZ0AhpdDF/1uFmDwG7iP3qYwNsKzqd3sYdnMolCOuQOIHWy1eQpWhuV+jmSeAC5zCc0/KsOIXkZPdiw8vtB33jEBpezpGDBP4JLY2wH1J7Fzp8y8RICqVd25mDT2tDb/L1mh4fv9TOfDH5dTeATqu+diOZi+/sIt18hiTovPsVQVaqXLPRx/4R/uH/86tBMcF+WBkThKLfblcVCIECc8DgNRVX97KdrsCeIK+CvJZMfwrftcDZDZyp7G8HeKl7bPYnTKX88dXAwAyz66O2chkPDHy/2K2XcT/61XnlAKgPwtI8yP9Vu45yh55KHhJu93mL4nfo8szp/IyDjmFHtSMqqoWsj8WaVhbjXgzZxcqZcyOe7pUK6aXF/Y32LnBOt0WN28UmHRiOpL525C63I2JQPX8vvOU0fz2ij74OeJ1Apgu3JRObfdo9xGDpp7cv3TdULEfNS6Gu3EJu7drBsBsogUqUc6wAUW3ux0/1hLVI/JEKJrAGm8g72C2aJSsGAsKFW4CBvBXVlNIKa5r7HvT1BeGYBfxTR1vhNlFFNN8WQYwr39yT/13XzRGiF2IsfE8HcN0+lN1zN/OnzekVBKkFY11GgrK5CLxrE/2HCEMwQb9yOuP2rTXiZzTEETp/ismFGcTWmbM9G1Sn2D/x3G74uWYZY4rgKB2Zo2bTKS6QnM5x1Yee66Y1L7K44AyiY5K2MH5wrTwxMFh+S8LzNQ25z6sunWZyiRwFIIvSnioltUXNiOr+XMZ6O9h9HcHxZJkfF0tUm6QkU7iJ2ozXARitiL86aqVsMOpmvdIBROhUoanPtCjgft8up3hAaKpw9Qs9MzYtBA2ijHXotzarkV3zKEK0dFFQUwT74NgCmGGuSCEDmFCezXPC9BhyGhmzNa6rQeQQz+r9CmGUZjIQEPsHwe86oCOQhWaHERsv5ia9rZvJ//7UXO7B329YUkLLAiqpLRsVV5XpcfdawlJqi/BVcCqO6dr9YJTFFRMVGhfUbB9YWNvYPY6RyaydAFYq1YIBQxuNAGfYWLMAHtt2XRHoOKCLz+qf5HCVBDOPOktQ3SdJBfxUkaiD585bmTzMwU3oeXUHZ55EC99Kz9kk4ZXMIENwVVpqW2JmGIcUiutIMj2KkpjE2QD+dIZUCxcX57kH7hiuUPnKCTdaw4KN95XPeFRvMcvo5L8LexWqvaJPECzwXCs/4XPAlSMpWUzBBjK3pEnkbueMkMJQrYcnXf7PjbAoJra1VLX4YuscQLpaeYWbT+h24hCFrfcHjxxx6WTSe4AGY/KHRZCQKqTuFWt0D8RmGWmvXSdg1ptIefYPshuIVZT7CV4Ny67fvjJugy0TNYHqoCO45CB88kxrvIsih19DqjD0UqiJsTFPcGW3P/ULOG3nb8CjpgVTIoa5nO9ZYEX4uEHu8hLXrJPjV1lTQ5xTdZVagg+Wj8V0EE4yPsTc345KM6lVXqLiHtm+G6edC4GVEiPgd98g+twSYm18gCsPnjqlLcFm9e72CLJbYD+ocIZOxuVjrX6IKh9fh7WqdIZ66x9PWkDGOVVGkx7jM76Ywe16DX9ng205kg5eq+R2q2MguTJxYv/wWHliD9mOYpzZKNXYC3Wr4iBGkm54hBwkPzFhiX/VBHdVH/KJ1ZIMOHxIN6arKdxrm6EBsgwDt0mPe0MX1HRUMq8ctcmysU6xX0bzM1J07kAvq33jw1q0Pq2cyMWme8F7aVkfhzZEFdyi8fVBQav0YZqvAjZ83WKH726rBx5Bn7GHFthR6H4lFsltu+jWmsAibJ3kpWMG/QbncU7n9skIBL0MuXXtj9sJg+4Dl0XhKJ1LcrMydaIgyrgZgScP4k8YQvcsBmD26X1iYXKLzMYfZn2IfRjznsrJ1e5cnl/3a5xiNoI6n1x1U36FWckJbyx+hiSZg0QqAqeeSvzFYMlZ2REnO/a6yoQhu7PdHMYEPFIvfyGeyCU8e7rpju4DrlOhszj9rOIpNsvCkuD+TLyf5J7D/wsPkBpscFVI1q7oUSU9bN30vH5AqnO7bsf+9rGhtVjOJQ32H9hHSAzR2ape4L0Cz4WxaySm4jvuGXwkFp5NMMLrgZ8LdA+5uLuyxO5SMOmJNDBcbbLefv7z6LyxBwltnfQLd7qqpG1MmNcoLUcx73BkNF/xpdS0cKd6G646ntChXSeTZJJTFYGw39T7fqXDPKoG2cF7/ZcTvME42gXLVjTqzAER1Rt5m7GYsh0X0+XgOeW9MJqE5j/rpGzY6vUu6ACcCTzDMdZHiWELpDnvgE1hmztLcSYz0MtNyUBLqvylUJJnJu79Sku9NMHCTkgqozTnhMFfduV2NLCSYvAI5HUvQp1h/M02vKFD6eosIkGTg6mujUo1W8hy5Knf/erkBQC9LzNqPAYCgR+hczgevta88NNqSlBZryq9QNeUK7RpbvHjoNhUKAAeNYH55LeTW36KyFaXdAkBvyNP9xmRuBokPi2OhqDby6IZ61mwfzG+GmACkS+G80A4WGON5izgJWeeDK91jzusfOi0RmEsVJXwbVUr8u/J2LCQaMnHhi+wJTEPN9tS2b6W4GRGCNmtjAMgPsP357nOeD3H2tcDAPu5xQBKMHf/j4ZhXlkvvy3YmBJsjsd4pSOlfPZCnw5JvzxEXM5JIc+E2mU4CgB0mdJnH4NEsCHYNeVRDXFNuyZUE4nuvaJf1h+11AWLdAZ72D9XNRcxfb2+XHZN/SN48U7yl+sNZhg5gn/PD8wkBtnRj1zBUPIWnoMP6yGUEEzuT+VaX3x2jEIZAZsr3rs9wCfY1Ss0EdIFFzBbyruUup4EPanbSYew5tf16/ZWVup5iykttuqL4xoC/jdZWsAZeSfDSd3fP9kbyAFYXkf0Q2lmxaTkKRZrCo9XCoiUG4yP1URJ5G7+HSOhhJp0Anz0N07QZtyFUye6rcgiOFbtyoO1lkuV0iQ602MTyFK9xLqNHtNy4cJaTO6hjtiwNynVc34ZA6H7k8ai6S6eF6jIG0xJx+JfP97lzuCZr8vU5SIzImaNpiQhyvDbz23//PJcOk7hD4iIvJzfIgOGIR6ZPEJpWHZQoacbF+omeHw8aWHaNOfaIyGeG4lEryMfhtNmWh4RAIpn8dLs7ZE2eTVDwK++xDoSUgh47WDmKlZ/k6OosEUoQjk7Q+Kp7OxwgMFShAv6z4pTW8loVj2+qXLQ0T3hmIue8qHy1o/HXjm089m71t6mrrUyDftqMYtmfvQXKDlZ+K1HR/FkqPSqcjGlcPPIwbMw3wIFKBdVMJ4pFLt+oOIkWZMw8pkoYZ3byw4LmAF+7BdicGXFcb5PWtDw5XNNVc6eB9dv0rAEpgr5J+bLr010bpfGw+IkRoxDbkDFmQdEQUSElP5bViLo1ur/23KN0jEwl+rGC6AUMKxHcv+T9F1Ktpn8jSSrKxJnVkK8UD/tH5DN6nXB8mjUdFU539e9ywLtLYCwmHYVEVqnFmdubduaSd1ivIo4pTsX+mJcOAkrR1D60RIoocCBIdwJhCBM1rOE2XSlPo0U+khALvw+zfxYzwzd4roWlLJkZheFRR8QB8v4USwmAcDswUZ2P/7v7Xa51Fs7orYebYyww4YW5869Y/c6Kq2eTR9HLSjYuChTkXaDygoo8nz/yJ0KzfX8oowaNAwz8HvQdlLU9V9hjqYMURyYvPzZ60G0itmUdZwB+sY6rUkMAZZtWStbDFmnk/dQorhwr3121XQWffrK3as0g29ASwxbsZ3dZAq/96b7/XWckbjmo8+jwdE680DzoEUUivnBgowMuBQxHXoGyp+w/cSGY88rWtmwoyNNIvChs/QsZRnbdV7y8x7t2RkliJV/j8e6qfctrTsMV22zoqgQuTSNFh7U7p/Q49L0kygXNnEYXCBDgi5BeNWxu7VjULcUHI+lGj+OTCEATzWrDmaynq3wT9IAejtvh3esCu6sEu9JOsXxMDpqxm4Tzl+pt2Wa5Bq3TM5TKH4N7KLir8FGIPA569+uJ1VEL3fW8Jyigz/nEUjAVYrdCWq2MnS4hQVgcvXq9aF7Xke/k++rAtIQqckPNwjKrV2t7HCOrA1ps88Y5Rw1Zp+9itnB71j8tNiQc7mV1kUCQXkoi5fOsq1uC6hUPUL7Z69NAM6lg0c/aeiifHoi35v+pVBh7CDM1XfvYpiK5JIbIQFHafmnhHfRTnMagKcjdE7zzgtxkTPKVrObTySTT51g9bB5ro/dzn/sB24fNM2LGJuRQsmC49PLi1jTRfZaLpo8Txxxczij5Pl2vur+S1wQW3W5qyVcIUySZHtFDQHv+EYDoZG1T1J7D91vEIV8dHzUBzW1UyuxRbP+M/CM/vsas6RzmS5traXnQ0Jzv9hYXxKHcs15TQCP744XsLjzFjILYURXFnhM+nnV0iO6nwls9TR4tlz1J9/NvE8FGg5mgpZA4htS05AK0NnU2gxuqf2vjCyWlm3ypKvaX4vxh8Um1MHGB2NTeAFhbDyGm+5w2zqJAWxVlj6dVePb5yR+aMhuz05YubCQJ0BOtoYQ6PoDoW5fCwCtXj5SHvCgL/3B5z2mcXWaRTf8/GsFAfX/ntdWZWFc2xg8MJeenwZ4dZUToce43If4zVb1ex3BMAWGhgkPwR5EgktZhW3Yi+nsnZTUr9FYI160YhAraB0zMV+ouHz6hYm25/ETDM0MTmcypoGgZISSkfwYAQaHGY45yZ91K4A4Mm4fnbMk8GTc4orypT3NLBqAxYdcY/qCH82PpIkmVOEHi1NoYaUymuImLLcib5pmd2MHTB3JR+4rLdRc3gtQ9zeFdciciRiWviu3HkqaLSxJeI2rgc7OKQslItumACQow89elXmi4P3gTZeCauvMH5nF4VrBcLjjwGD+KlKqe/RWIEgT2wGqAgSuL6b+RTTPnQZzxZ5y5HQJkEEKJp5NfoB8hJBM8qn6xbOFtyzBjVBrwSS1zCJR3lEc9ODQ5Wu/xct9/2Q6qLHnmNx6XwZus/i8rEd6UsVxGtoDrm+Br0L5oUojlwdcqyVV4PIMsR60JhZwJtgX7izQWj+GOeF9DA8Wexdmv6DWjgR8LEBp9YuPAM8tJDu3uCumNqHnF2ATYX/tuVO55OgQuiUhmDmJbF9jJyifBRtxOVI9DCNLUY71IXZYTuiYcnILQ/XHuVJ8aHDStL0N+3eYNvXwHi2vEiTPnBqzsC4TsPnFVnYY042j5i7C11AVdBZ1pGSa52jM9dIL119rry0mgGxFzI8xPs+7bmMfYKh37A4HtA081olG1m9S4Zch2hoNCGVvVhd6UL7C2d5hKIBHoB+Uxarq/4aQXhh7IWjSj+ca7Vhqb4+ZwY3nHXh2S9JH4XZxQojbe/eINxYlozTYtT2rpU/xbj+W2hXjFQ+z+dQ8wh9751MP0UpjutQdxz3/FJYAEG5BF400JXWCBs7KrCRf/l+F+d9EuwVk6thOPDB+HNS9iWlLmDgXvY6K0vgiyoeA3An+jWufdAG1suUMBuJT+/w0FNJZbObUT8c5q5WtQxASQF6E+/u8UwVBs1eo8jTamCrcdhZJlADJbqn3crcDHQlBQNGq7btcGKiJXW6q0cn3F0xzf+k1JJS2testB3rx15ZPTDXm8QV5XE2qxBOdM2n6t5YbxyNOmEdsHx+hMp+y9pWkcgw1NikeXuafJvzcjaNwE1Ad6gG79S68aO7jWpKgBETYLmV4ONHhBk7Be8tjf2WVvWMDQvQdOnk448yeMv1tQKU1xev0L171e/qxkMZbmkfKnd29XRCK2hgNNJhwt1qiYWZGKz7Di6K3fGDT7DO2YQ7WU33svE/WKGbWQEvzUV2w+VNYDocI4yxQ6i3i4zU2TjmjCwu5Pk+Ja9HSwLpEoUswq3tFJ1jimthgMXd7KjSl6Qd0K+vxWT8G4/+xITHsWDGSfQTSdFQth5uVVfa8wrkDZHTGVgpJys2ik+3I0dSf6TNo6A/sVptyY/kx1hdAWKPI6t/xj6s+fPMU3hg1vkEB0RRHq/tCy3KUUhzU/d0JKxTyjvUms5iy1GbOFco0NA4t83SK9sBmtLWm4kOLLflyxqgQYP08iyXwYXzKnlQ6VTipuaspSJ9g5H5Lu3eLMnPKbhcwuEg0VZ80ppJWjUnhS3rL35erzysp+fJhxsUs86m28/UwW+IgrS5Y0zWaxlFJ8xML5wk8sg1ragF+eNajyI0Y4mwStxt1RZH2BjaAhvu+SnNNIK88thEgZEsoHv+ii+OMmXJL7dnAiINVDz3tCnqDgpQX9OguNGgZj3axcjq1UgxDw785yNIpqNiLgv57399jVmJ0/RStNswaFIs6FtnkilFZldxj6m562jL4p5g3Y9XCiXRJX6nq2PGJFifFR7EyPG4jDMnBM4t+O8ZpEp3th7TCxEw+ZG4afHl4sNFaqxyLh6+979tt0Aq9BrqI+CS2U7HJoKiGmyVU1lFa3/0O5mNC1bzRgNMy+GXyifLwJP7FwUSUmxmVRpn+gnXWoIuswPutsiciurvN6lsMG7yqEc2Y5ZI3jrPgPq0xEKPZpF7teJa0TQn8BQL4Th+hjv2ByfwKookyXEmj0d1KMcsmfKaeKK3cZZubiYqmSCrnGpYTwgPk5itKucVtjViuswQsDR6TuyGSIHYvlz7wkLg1Rr0K9kV1o8RgABlhbLrN74cVWJW6TnfXN0q12JFMpUbEa8t1+j440FA+17o8qa8PQ9igkctVROVIfB3jU5vtGm5pYYHYSDvU2TEc15pIz19ka1q6c/7WXfF8+POkApdOw7nn7Kqz6V4tru7NXgnA/u0g6+fPRT3hp/QrDQwMsjwNCZxdWrR6pgCBDJNc7/KAlwC0UZ4yWQs0KsuwbbOgcTxQPK54wiXr7s+221hzZ8RVxfoRUKM3e4lpxHC83JllxlrV760tl06f7/65qhE1jhMfivAUXIXfRMe3uY/G2TpWYzDrw5Cm5cS062Bx9lhHq9gtJp8xZwAtSdSuW/Kd7+orEAiswA76N8ezmVGYgNaYlQ/xk930LAWAtKVBC4U6R08L45IohB1kFia7XJs0TcaT2zBZoLFuOGu4iJaoAnfjL3uS6gnRH7G7A+aT6ETlmkYUfgrBuaSLLDJfhPJe01PfN0oqBTeQURasl3N8BZiQSgdr0aDv3hPTiog4NSyfAUyy98WP7dnTDWQTY+Qwzgk1uxwRqHl5MpC/84Cuw1TXfRlgJrwPop10kCHjmffnFdxCe2J3R3J5j+3H/sZn3IUu3Suy+I+dAOMWvzwExNR3RRPVelZAhtarKlXPWNjPRIVP4JsAFSRXs3o/fSYAPaV/zP8q6DltH47/rYhCLdy/LrpOsbaLf09eACcClJosNefetNElkSFSuCgeY7oTAAl+8Y2zOXJb/bgEDpoDXfQqc6lnlBr/WsmVznkBS1M7ufiqpxvKXjwvR4WxLbh5NbMNy8LsnX4UiuAi8XonbSUcVZKQOWBYUecSOMj6jMG8gHu7WNreBHY90lV7FocDprSrSbexkAtMW9KlXcnrOyLnZdodGYdxz8aw71HztIqLhRdCOB6NyzHPoS2hDy6wLk0I5Jr2t+U0A+A7EsgSn/Ih03A5CspHnVF4MOic+Lck3m61Um+GHDEe4DrHBhmgtDlRQl1XJ/V/VumCHtUDDcZCkgjVMBOmVOGYW0Rcdi1ahdjhBcFlfjA+5cRjBop1aNDvdrf7CxkLVgxiCxhRctW8wczM8+kVmIrGtkaHGlr8y2D098HXE23r7fnJFUU68zyeyM265igNOGPzFG0dIgUDWN6S3ZcfMERJdWVvpGhVEHXNLeWqHiTcF3wOt0FbJY4XHEpmkoG9MQPJJ4ueQ01+MB+SR0rCSGzlE8zod19q75LlLWgzogpnJoD4gPxUYcX+Gpc5Ly4nk+Zm8LDXcNR7SNVxLh6NAcx8ekjb/AC7ADlRnfuHaHJaBodZr7RBX9FLTvocY6kY8bavdAkQicE9bbwGLkZu6whTCJ56lOvM39ijehpTOFqR3V53nQx4hfOvwRPU2y2w7UU8yiRbcyaX6jGJ9CRvl9ybV1tebTp5MMuMnwLcx/lven0w9T0atJuiUE2WtYGiVMaP3EchABl5AsyaCpu/BKAWDFvU2vaCL2/fJBKCKLjxG6xzT4Mh4wHhH3/EqsGSoQAHu2wbHmXHj2LvoW19GXDa2oyeKRwGG1PU+S7mE/S+UmjHiDF1oqJ0R5QsdjAZYN1MzpNX5YDqWYfhfdjAXyFQaVyGKkp1oEGTR8MK6jaGfRDFd41u2Ex8ac8jKPYu3pXsk8gu+m9tr1RVzTTuDsACW4S1h32yFHX7qpXSmA0QVEcR8W9j2Juu0pcYqTmdis88VgT3gq7iYue5Hx/3K6hFQa9rZrNSDcjaSQlNn4LSqs20bypnKqpzvnnxjMdz5StbzvoAJKgVZa4DLCVoJW765/KyTF4s4YztmAT1c0pTmKJHTpa106FegDo8p2zD6uOnwpYi0vJlRMDe9wPT6964UfAf6lq3qWypUOx9q6BbKEYt7K3gWMXDNN6wAm1fNnSOnZ4JkbPq7jLQrl0wL1V7QwO/sXneKGfTgUL28I5iPVG9dA2gS7Ki005JUR7Vmw4gX4TJvy1WS74cIXD08LCF5obqcZwamuoZ+FPMJEck0TLHjyH1baPr55/Cy0ptDfRJ7d89pbP48tLMHG5dO11Z8xSSpPGQSgXDWmpsNsmm+MvxJjMCi7OFDHxxpmTtjgnOCq+c7Fi1DybfhAntviKccz+sj+OPKPYOKeYYPLvq6MpUx/chSvBccg9dfbeqetQNCs3eiCFZTU1mrDido/mib64STMgsa+IKLk9PyxGGbVSQB9GsHto6f5prAFIbRDSItDedz3t5+Nn69FFS0nEfmkF7hKBmNVce5xv65USKGBoHYxJyutSGnRIq7vMDsAMvirOEJOzNi5Kt7fypuSU2c2Npo6UH5jMOkePH0TwgpammO3Fb2FX6f11309z/mqRmQ949HHRj/wMzKNx95M9pwKf+UQkMEwisL3YVotvHhCv4y00Ui0Ql8dR7tGqFcSdYtmoAOuAodkBNs4PZSjAAF7S/szwLddFMdCyB/dWPgFUiUE+WmUUCjYrKfJLQfNNpQ4NKaF57w7Kp/isZVwQPUJyjJavN3fQNKU+F74jVBJYQEcEdw0Niinyea0l9PJ1/AcTm/LI91RZjDvLI81pnat7RKU2P4/TnIAa3hIEfeg4iGQ+wTDlURK6YjNpN5s5VkQW9w7sDYKU4XmjyZsCQLxztqd4SDQvLyuPDhURAJXKfR1c7tq3mRu4usFHPqz7HgS0X7kNxiWWR3fb3uVwbgKpmgLYkwKrXKt09COw4MjhxeZlDXKy7nNLHXAIKPtferWQnZLboonQXK81x+BB3oUidBehK1swSXxVbscj/LsfONu/xYEXYPM3aMqIYd+2hAnFvDHbdrJLhGEd3sG5PyxqhzejhQJo9wauFK3xmPYqxB99J8zYU9/yzrEZNzzbvPoR9vUlE3Ha4zspVDzHHffPZMJ1VLZkKqGCf8ZqupqMt6T+NRPfmPm2xeDgvzMrRJEL4/zzlu7Z35smvzbgeC25VP2CUrZkRxEi15A0769ojdO1d7C9OG+swj1ROMM3NgKdeBADoRMeJkRZcZ1FbQu6C0BS9NNSaoxtFzYT4lX7+PQ7BKa84yrN+ujVVef+SgnEie1G0N+eOtbZF/UU+wkeerWjloYqFiqo0vBnmxh+TwNMo9I/8lfU2XTCT0K4OoWE08ipyNHjxHvfhY6qa3x4HzdQ8+jkiO5+j91YkihS5memfpFREHP/2veN5XcRue2zCVuAub8V6vDlOvyP+PBm+owyRhMmng5wwGGIXsOkQekXrXpE/6dFjkHwwoFoj5bIFiqp+4wHpSWRbv2xGrRpd2c87FzMP6Hfj/3LWIBqFiNOAxBw+AAP1XqUBszdZhzOSQrQS4Ein4fyV7MaGsB0VsMF4bPb4lx/foTGQRJv45LpoxDd84xCawHaX7jpXUrOdkFxx2oUvY2xqpgIvcVufwd+zAnaaVTnEyDXD7S/o/xrrk4mgTjXhcjj5Rzrbr23NmuZQvpdNzny5MCR9bwvIRIqzOZZLsstZSCDYa56JTvzxgBs20dYTtTUbe21uljlWqGfSh2bYAzOpf6UguK30ZxNXgLHs6Y6urtxFA5iLYvlue5mDONW0MOtQjhqr8fRbCkYneiDkvzHkQVT4F9v9vxh2SIGPBH8bZb8ugo/BSgXojeSdNXbBAIDsB6DUNSXnwlu/bFLaCqSbvu4+YLplwO1JbtrMf9ZUfsxerAZjB7E/zl3qwgK27FswemUmSM4i37YAVhQSocuV8AcDI/CSeCDNPavESshDQ8A/lVIrAJAMdP/rHXouiNU8RL/TIvfQiuZEb6dkIKMGGOW5kT8vO8pivWnT4v7qmwuJo52AS1r/RyQ2g/7c9ZJgmMIzf0GvJJRfMNu1utRNuLWHOm9JIMcJK3qiDtVpGCDP45W1oTTMUnMC91kYhP0GHjhCW8V38xhjHgFFBfuWMsmSQ9MvNqKXiqtUhDAkIy0PW7YSKaKUv6zctAiIk+Jt17kG6LpNVOeMvJnlVBaJSkKe0HTJJUMvf8R2zna35/yh2wNlWLzIP3BJR5aRNxkV94ICOlycI1/JYRZtzvWMNoIpQrdNvyBuBydhSwhRwPo079Xk/XQZpbhzN/KK4NbdJQV0JIMP+Y5UBIM3TTYlFGYVjcvA5yVozkimco91Fx/eo+ydgAx1gMezTh+bYxCtXPYkMoPdtaElRusxlmdSV9zgF4Np+iylun3LVxCycAFxGCFsmARf6y4I6zXY0tx81aQyalr3/ih+ZjxGNWdhItgNLdEZ/BOIJpPoAveh2bKbEFxU/M0+4xqDo3Ox8MnNn8Lmv15NJigSvJV+y2W/ZogEXNiv0/nuFzZGr0pKujOShzcdkEVlMw8mNZXZCbtM9V+mfawtLxCTvo+enFWhJcFv8LVTFycDjPGBXRQKNN+z68HJtYdpH++g5WdhQpCO+DE7Qdu6TmZgtetrpU2ZlgpslOx+4hb3aXaqbdc92LCh51er8vm1GQ9uWD9+fAPRV50ixhgc5zi2Jsg1xQVxzlaELRWJ5biyF+eCwNV0oFnTbBHr3Glm9qlGVOpoOsQC8hlNG88fxeAekkCGnHFn6i5WzyO7ShDYbZ2KM4eqndyy01v+6TFhmkxgc0dndt7EzRCcEfBxSaWZwcev6MDZcuvSZQ9CNSd4Tx25TY6UAbrhikuP1vNFfPdZhCG1pe6vx4D6Ez3zIb0zDa42FPpxWvIpEeXb7YTcfZOahSpSYaWLH/vq0F3U1KO7ZxliZpoMBBYJs91IE0bOkrPNQ/USYY0qKCO3CU+AFbOYxzKWBkIglrX34377BZ18MKQCv1KWfIHEeguSpvrNH5RQOD4LeiH2gdx1MOAKphlL41F4RpxaU4dy8xERFgqoyICQq9XmQ8WJSokwqvhQM0fLtsvyCO2PAkJ3BZg5IqoR5q/GdTLgOWPFR53Nqw9Ma5vBzZcQ4+iZgetmKg5ZIn+/7Jbi+VlViXuD9CaAUtdEmnwWTS7wZWuskVvc/SDaaKV+Jz6HrZTHo3UrAu0IZDBkXWmL+mTTjdTb1A+MdhKkY/hvFNwXj1FzUngsN58u/kTdJ3Xi0hy7efR6faAOi4SKGaiOty8lxDFkiD9wq2GW1EZEsoWGw/WzxXhWDzYY8CC7WuLFHc+x19jhH+FiLXwDIARRtnkJPF2BUPZ9+grZ3tjqAWhhN3h74w5pooRQUNATy05A9HDLnILGSCtfESoSilqtqAIQ/TV2t3KhOc+teDf5t+DqZDdB8Ob9YXyklrSO73pR0QAxPvQj57c6FIR5dOciqeHZ2LRABMROo8Jk8V6JFewCL8TCd/A5MSbXLky1cW7mXobqgeEXdFDoEydKo5oCuyn+2JYI/7pIGFAzErlHZ5hOaiT17HC3zp2HpJwsIAb4/oIoZ8x8ak43Yp83Ermq55Dg8HxKGHXbXs47sh0PzQELTGFsf5eO3lYAuJjMneoYWk8W/3tW2WLntEKBZEW4hOFgo8K58Rj0vk5KLyezu1d8SO/JcuxpOJqFUM2sxBmbQ/9qqwb90R0WulpR/Ju84bQ5/fTh7po/pbBb7AQaYNdK3fatD3K4TLHAaa66MQzp/+ZGyCjzo5OXRzJ8UHyg/YpNHvvlOpwQIOjakpLHwGV4WsLDPjEIqG23ily3LL0dlkYQxj3Xx0ApCo35zYGoGOtIclYS83MnI5TwVdQ+Hg453WFQN694DaqhGaL/dm0KncXYqXLi5polgT4DOrzD4oSVhrkh8GW2PaXjOFDCLPcn4RQj8dRGIJuV81LxMPZ0UL6zpkaebhbFBxcRJe38UiTbUPDjFWk2jBqzrBvXcKmgdDcmRyJhIpuq+3DQY464AlY42z2EM0yIK0I6b+VgpanMfpdWo7OxKY8RM5tSJv340/qD8SxrYsybMuUkF8fHj7HcvxEPC5YYrH4LW1YKg6QaeFZLvPbrHZHvi4OXLKkN8cGQO8019OKqcv6QnBlj01e7qS5evoGm53rv+VmDxxCXDiOrDg+IaPeMPrn8TJ1oReXYI3yb+4HQbikxP5TQXHk4YXPUv95+KmkxGsRgTwP71YiMpqNXp0loHZeXRp9i3euKrVtxMM0e6XAoACwNtcc6sOuhZVb1htBLudzahrDFt5GkdlwHjZl5y0LbvSHwII+qYeDwRKTTzyXaInHIM+8rc5TrjUlPRVwB5LKFpQnV8e7vLv7T7V/iJTW9h9TnRtNCSGcofBWYm5P7wZcAq3AFamEW/GMbo27ldz0plt5HI53ddWkn9IuCZY+Iy0MATUh3YenRTbVgdLYtu893SuN6EL4e9V4NhlzUjI8nOS6B99ecyC1Ot8sDahQpWHbmt2YvWGyL3S9tEVLKYs+LnghBmmSl2uPWfqPobPwBHNLW21LUjfZb7jfLMTsMp3icGO1npK/rCsUgdBVKVg0Ys+/WKuTmVJoC8Oe5h3PK1TQhbpZ2ytP9nlutQPtLAEt+CVT90DfVkn7lHLOX8AfS6HLzfHeAhu1alnl19RHKV1LI0G7RPzYgVaSpX7th9f06uo2WpxjL86i/2uzK2qj/ClHbGDyQr3F9/axmq4kJ7zZFVXVVwfiFr5bhUGVZeQJHKFAcsnqPKsb8vHyB9SpFpT9U1U7D4aS9vYgqajxhC+hOkolJV2dKAxysCkWBo3SPiPUrSQYZxOWwWCoQzbV0oeaDEcgUtqI3nq9TSmpQ688/+wb26P2CHLY1H7q5lypXSrnwnnztq/jN1o9lyvLmLyGguV0VJnDCREkiUNrZqGG06MsyA+Phd9CuFoM5M1Pyk7S6TJaHdTw0ni3n5ysAup0kyxr65lFc81NcH8xSmpp+iOEtQZrH/y01k1rGMRJAGFhi+nDecpUlnrh+qBOCMZCcSCovOPJrxjZnZJDMLdpMVu+tBSVS1nKxsYjY9Dtq1/++riVfLUVhzofIcIgQQPOqHioELxU3EpCcZMoL9laa5YlOZAMEp5apx7CphrkL+fyKbBAf8ctwVd93FTo7F5Oc/alNsCgK6lHruPROtN2RybiLqx8P5LTUZXU+Aoyz08zYHasR3U8hPDKj+6arWXR9yWdJoMn45prCSURKKy3+JHgvs2Ot6v6GbEtdCumgCttv2VNoU3KOqUwqNIWHqYm4eMijTM9VWB7umEyp7UPOI8fduHJY0W9xSCZdvc2xMjo3Zdu2o/WZKDMOSh9UmLvo45IBppD2dG++HJu8kbfFdlwuIxk2KHhgHQeNKcHhFkYGRzL2VJVMOAb0Co64wvds5CaYl9ZmBm4zuGDeaO2eI1XM4+rD/HmZyRF62SabgAe8TF43VuMutigJJMfbW2UK0azGLFbOfujnHD+GGBYmSmOQbUCOY99HYvswBQA6r9hrc2jtsUUxLVjxnZ4JnIrTwIVdWCTPtpJpvlA7m01/4tbUMyz9mv1jdN1jkiHQCJXXKg8bJ+aqW6rbwbn5yDSHBTcFXIegrhHGAjJOZI1pyP83Z3vMYTAJoo8V9IwyS+U6OVg78+IhSYHDYjRs8FrF8smHQ9h4qAYxp49rRP2d5uxLAuP72GvZaYvfeLOkMrcg0PkPuq7NsXhMFmiZa6PKBH1l+oKHI5DBLdZCvCwTPdXqmnz8gLzVRb/ixLTSdit2nrzt0x+5rDeZT+ac31NKNskQs6noKlQccyD3UxzfVZFmcbpmrfPsZD0Ve34xpKWk/E9Khn4A5yVPVq+dwnv0EyYecPqXGU7R8suTW0A6NJWweLI3iSGDlQXzMYsSWkSMhFTfyA2vTDt/3wXk+mVU6bRNkZvNnyVHYiA4tmnNwdh/RVsk/EgSerfTIf5VBmuAc2IKSeL5Nbrg3acgFj80mI8SWsc3dNAGCBLLMP89gH5UnLTKq78d9SxQH/g7DVnBh/qnBdw5CDrw/uMzcdXSxWqGIFcnQZt/1aOHxUg88MN2w+FPx/V75gy2wzEVe6G51PQIR2tZsxbv62HhgjwtlzrVREw/yzlaAiuXC26cnpvQzWXp2mOgihyPCWqq38nEadX2T7f1Y5zGxEGBaT//IcL/BsquAJX5EDbX8X1p8nLWR2yyjFRvqC/jssoCJBCDJOsZvoBfXqQSEKhNARH1YfueeKBslAwLi24/wAO1BHptlf1kQFNsOPlDvlYednrEp3a4SAz/G7LIVEsZBu0EKWZu/euB/XKdkGonP6t6lgEcCOw8mceuzvEVzyoPnMyzrqoNQXJb9C8ZCXSiedKiCgNwfNkpVlHbUgE2Rb9WFScOeEad+T+jT8XlSc8rcvkIuhAv/gxRu2eb2GonLTyokjcGF1EBpCJbhy2H3lhL0rdZIw1okA5pBg2oRfQceXTPzhuNKorTEF7t1UIgDqIo7/loxyTgbtKu29o9K9KujvCqUGyPY7upcfiZLNBVKh5uXAAZjQjhlhBp0ukmO4Avxu4xAVhCtnsOIA/tAm94U3HEuSr3wq+ZLo8pyoC9EB/q3pOzQRyCTkozmJwo1Ln/2xEbtNnS2S0NUIS3yz3/mBIdxONHxqP9FW+uoGI1F415lI1nZwK0SoPA0+flaokBGEoXgZnO4GOExU7VOjdPns59ekmDxqNhEHeAF5i5N/3W2NC1XGFjTpqLrnCECiwVkOTrLtp2ehUIaejOG6+1336YQSKMSsL4zhUjw6SQKryVRz5Ldn3R5/r8AOi02RJkQXPdvPsl/FMg96E/cJmIFLmEDzr1Gkh9G3zisG4pqM/MV6XIz+CtDUh6hmJB97VzN8jaPSS90vgDjvnaNlKky2/zIhE9ObugwrftI+Oi2a4VVaB/Mwn3VmaWjsU9NOf2usbcN/GLQMjvfeU/YvyEERPKw1leXZWWk1HXzY3P9MUq6MZq1hkEgFzds51mv8mnp1i4pQprPwY0TId1szXwe5TG+R5mMD76nGPQr7/EhQWksjsgGs7Zy5QYvMcGV5tcXJR+6hlHFIAc/M6XjkKYtwm673Bi+K1tNO9i1YBePTur4I+gMsOK7f7980mcJXhgdWdhNzUN2JvFsvXq3zZRG2V30sJtJYxj0aUv1u4/ppVHi1iHnTY3gDHsrQS8YwMX5XwZ2gcFYYe2wd7ZO9swr0gb8zf/fXx8QWKPXcK1UdJk3760B/TMlpWLCbhkqVoSTsOqzgkmFmFteCCTGhNyvFhw1RrTIWzRxq8Tj5FirvKvtkp2GAVhnZ7vnr71pyI0rKwQbVxKZuqM7GAvn2mRBj5p8djlHUsh/r/eBECptpbbjP5nFyuN4mvQLZCaxeTkDUzd/kNGLIzBFv1CElQO+xmf7Dzt1f7GM1Bh+wLDCJZlhcVDXbtPuGssdEie3lZNiWcXMTjZtWAT5MCmpq6JCRuFSHZYGKcSFZ9kOYJfEqLIcWdzpTA+Hmu+ktgSUwXVSwkaa/aHdZXh7IOyrudCBalCZpgXGRNbhN2XpEY60DXXO1Ci5ayZSoxtG0WRCC50+XtgWz7qgX5MRA5S+jzXCYy7O7Nn0ljVxiBxQNCZKZMTqi6mPfy2LZx76uyRUXHjnpJJEimflHDUxyX7fFg7iJvSrsZMH6Uv2xbfQNx5eCbx3oKycUrBY22KPmgfg/w07CDVsw6tb5VxPg5/X38cQtXI47U7MAGGjO28II12T+PjaXHlstPtkUQNn0DKkCYis+kVAkA1wyAJgYKLGnKD3nlVCarYqCkNIZbiVwO2Ydjl7N6iOtvvbAfuq7VKZLo0jEdw1YdsRaHcuJQulgb51JyELzYBkP1hd03IDcZfPg5XmNvYQSOINsCSn3BuLtkCPZRalK7+S97zxvJHiJCZJM9XP785NZ8B8fqDe/Ot0BS3PH1ptErwxBtpgfOj4d/41nrSjJQf9bV1kfdBHJxYbHILxOsWkZvoP/Z4Sl0Yx3bDjTF96xf96+6uIoQ351Ce6DeTwTnkPr20YwATlnhskWIddUohklNITCq/07zkiEc3B58uiBG6d9YAc4h/7s44FN2RG1UuZWeojrOZIhElvDP4KqHcOYbqqS95o7ilQH5ONJfy+aYiB+sPpn35HfHG3duLpNvBjXc+Klf4IKrFHjeVty02xPTNnbdL4gtkqPqMLhSgR/fDXzxJbSScqewiF1wdVoJ/fGL/nGWZfVlDHOQKD+/i/mqwXqvNqxtZeRHwoe/bodk66B9soOnZp36gdzVMRRQsQiBFf+HXjRcrRf9FsGghw3+qoN0JeeMvDJrkSBPsESDai/uVOzn2Ohge+UVdi050fdWpsjP0D/QuTdYs6QyI9xnhU8WT2+KBKzoZ7Bq8fOdKPeLulUhJjT34/EOnUloqus8+pzqNh/UdUOhgTlrbkuTfsaIYDm87u/GNIl3N53uaU8bgaBjpz0jdu1f59K4KFDtwUUeEUoeYx6DEkWKHdi7dtHhQF44lbysk7PqERrsuAQu2D5tDMl7kFoGdI8r/s8rMytJzYBU40wqeFvTl0ZVLdOB6Ya9E/f8VPbGx5MdpYqYMLMyB0QxVdnoJ+tgAQVWfH+jtOHD3PsjuT8dOTSrupuvHWRHQoGI1Qj1Hc6k+Mg84FAZ/gzl3SEzuGWZKFwuo2D3EiG95D2Z1szTqAuFRmT1nEh20tkC4ysmXx6JtN0taK1iRR62s2uNW5rSAvMEJ8yotr3UhJe22brlQn8Gvcq1I0aODaHJucQKVe6SXyfcDWODMw8xf+2C7Zx5a4Qlh7pJs550DictL4OxcDXKvVmLgVWRwb3moxv4kcxzm89EERJXCl7X/BziBkGQWOHPGF+6K5NFJYOFVv4+NyFq+OPMaSWZKoydplufY+CYyL63T8MCMmwqLTmAE8h0prhi174wnx7DHZWYuRJSYZ63uz97AGOzyI3aebclnud77znbZetbWUripe+AadLQeZPtWsF+FNiaXCy/98km137lWewyc7Gamai1Hd3Ls+KMMVh0R3NKTQ08TIClDfMKwUGKy/7YZlJHU3uW60X0r74Afh02v5MJgVOYkjmors6GAaDU7yKHydfkXYd6nEjYc76xws1LDLWCNNKBtUHNyLseOyNDgmHiJ41lXvq638RzDGis8WIniOb/pbTs+HsQVGPi6mxG+CU+oflMR6/qx3pVP+GPgqa0U0lo8MVmI1cBgSnPGgrh+J+m9TVg8nivua0EQP7xai44ruC5gsAVOp9bLsDXfHQujo6IpBmpfbbU8PDavZpTuJtmflVQuOImnRQ5kKoQz2NBFjdiHH3cF9QLgDP5vz/W5trCy22Uk+TCjXjdbCCHB3rJhKYTwiyQUf8xu6yTKtIwrbw4tzFgXDODmWYEnnpDupk3b4AP3qz4AZ2En5wi6aZV287AgCF4vH8TlWLni1E5Hd93vLxSYLBWSuj3eXGFtWyWpBkIeKu+YsBh19VeakA8OePM0ILu6dYYl9DNIK3kU1ybH+A5xYhFI/EqSX3vtNs6V5eQgxYLvu0hYFjiG+n8JzqLQVROiVa8XNQDYJtDAetPFSuEtGI3B8rnbbrNo9TJn/z3lRYq0ecBIe7a03vLESwhKOm1bGTk2kPMv/Sh9wyCOmIore7JhSFT9HIjonBfi+gcdDLfFt7dpShJmW1gkcXmitWwm1cC480CraHm/or2MHphB9Q1bmt/SBXFqXJdcv5GTt3IS2fRgqThhInCjRkh7Dk1iS2vMBLSGtRPppb4FEu762JehUMQxxLQre365CKoJGvJwVde91XQ+bDp5ZsMu/QHmLgITmwGXSpQFQlQBajqquxlwIOe2cyfezaSHIoRNLcwjW+epnmAtmmWA9KU29v/cA2iuWbj9ZV7HR4anhHkjbxnzKPHnIZ7Mm5wAf2o/3xUhnfH++quS20TdhalHgNhusidPKWyKWV8ZjFLgb1fX2r7ifLyUtxuKHHIfCWXQJ/DKeU61vxmPT34MTi2Q9r7/sK1CYuHVqMBsgtfenn31bUzCoyPN89KiO5wHveqnk3uyHnJSUBVTQQ3NyRPmeRKTQvWEBZ4QWcSgMyZF0RQgvUXRcp6KflF056fwahSioP622TdcTVYi4cAwSZLWDvfjoKFLMowPQpzn6ogXHc93fFA5NZmnwslSuesOyNI1EE3RM8kzat6thkmpOiGmm69Yn8yNuxz1YuuPWekoybkee106T9WTPXo44ea9E5QH2Ig6FZn716DBa2FyXHG1B+YfnmhbEpANlOi61BoGO4+G3WMJDokJXj9GhNsFqdaLjA1pkhLP+/mGCZoYsxNI+A+sMvWyoj+PMWeR8koRz+r9pNVEWT70WhiAkNTrojdr0sBLwxIM7D4zT+cVy96ZE+ABi9CqkM9VK7iOfkJVp7AqCqQ9EZ9emn8rB8zfoQZUBrVd6YS2AqiTFt0nJ8HfPGmnBWf3Xi5CgyWoLAmHJp/AfTdHB0+Ns5DlhL6UJ+O/6xys+CWVKtL9S8fVHkpwZZMJn6jVtiUTtXjywmiVXw9a6f/G7Qd4tZtcoS3aytxXYA9aGGmEeBobjiammhUaMDicH3nlOkDvvz19NqWOvHC2SMv7OQHtDIykYerPuoLz6SQNOBtw6oX2Sj3ZLITBDcWNx9CuZYYVaE+vleXnATrwn+PnuQ34jL52tp85aIOk684SUlQ8uyO2t+eIOHndZ3oxD+BcMAba/JVxRYUAUZoEw3D80WWOz0/ul+fYbhFnffx3PgOy2LLiu82D5FMSpi+Pd4EkIFTgfv7p/0vnX1wp0VpNzyXs/5S/4z0RFS21vIF67k1ERTfFuhLM/8fdbKognohMqTNF/+oqvXXLuJB7IHeDdn1X2eParLBEpz8y9CAN2g5VdE7EimekAOhkw+tTzqeEsgyQL4iVDnWrP/RcBd6CDm16/5t+I1SAxCn9wo8knzmpg8DYP8V/vHw8Stu7cliAt+G/VR4XPNZXWF2rZBeQO75os2jFJrbtkfhN9BzHT4HGgXTjyTy8NGsiQdeOw12GjYKCyxP+34kRHZqYsn0pFvVubB0+/emKRgiGXNRWQwMSvAB1xvTprD0Zyt08BjP/4W9HGNfNBcA0Qb9qF5hdQ4dDqpKAFLoIW2gFEVKOganw3M9/4WP9ckP0/g6kaJDRurtxNgT+PjvWYEWlFa80wKYCkd/0ZChV94njjGyg0t98Pz3AL2AFAhvRRiJwdfRcQqqhWkv/o6X45d5w1YLJOye3v7rgta7Ya0jAl/an42ng5Wz4S5we7n2+1W94JnpoGyV8WW2HYjKLkKmp4hBKlNtb5y4W1MrsG/wfq2N5Xrz2kqhdPQL/YoxgCQd6Y2KNkADVu7TxugQRWVuNL0BUj3JRFyWNeCmB74Wsz54OPnbq0GFFxzSkoiJ3Rtq8yEJMKvOMMalFKH7YFHKjb2nwrKVfuUUuRtTfJDiBuaEHHoX+MUrM2bBaAsSdnY5PjqcMBn/wwojQxzt2MoOCC3OEArr09ghhsj2M0mue5ntQcmcC1R/sK3zfShGJuazS+mJUeKxk5u36CYj8+SJCq8ZEv7bNf1+BywGeDQoTDGq6Yh1xW3Suwo2O/ykazTPK/TdVOICyiwK8MuQpK+FX3mqSPzxfLwFJ/iYDjs0WgW2kqXYgm+gkNToB5+jYH83Xlt0cbtEmkkBaVGlHz61rVuWzrK1yjn5nYHKvKCrBPPRth3AKDQQB83fdrbgIeIfB3iHya5NPpEyxbzmtN5Dnk7GqrQ4uu4h3QSoHU+74zs31cWqIx4SZ2bwWLvIxUtR6gufZhNZoMcmSB5z1O9TKvHMORD+VmuiqzsyJKA1OaApB+b9x6u9FTvUkalgl0r7raV+wRqimc2D7B1z/OiSagdd5UME2igLGUcgPlMSX1VsKQp/9yDiYei87KTBA2NPCUmgaLwVdvQFFFxWp2vGCY/KCUvxt3FOu6xIgwS4Vybvbj6feUCkrQPpO/wPHJPhAobSj/aa5YrUvjHMcQkDZwfc9mvghrk/PIPvcJa5InhVBfjh3Xr9vIvA4ac+m+pywS/EqkSX55xgiyj0TB1EE0NT3W2CPFdVD88P72SpdFzHS/6XsmbGtM8JE/m8eojzd4PM1bNADliZ+XG/9hbcKg6PftVKyKKt/8Bz4lGsHyT0VKj2vDGp/qDGBajSHrqzmpEjW5LXsb5kTV6HgbMcnPW2dzQju9N1sI/gPVlgGmk0bHKOX2Ws1q4aPizhcM/XiJ5EZNUK6bZNUeFaUJVTvGxglRUY7vdnoVOe0Raho3huh1XDeTlHpk/2gBjjhUQXe8FN5A4zcRqkNtKpSVq0xyw9j3yQlQxq/Lnqklpz8lXmzHkz8sX9HJjHwyn8UAjblvN0ZFIk4liejx0lVACoKvpsT9+pQoLY4weMHRzcuVC60DUFkaqLfclS4UJti5WK4FE3dYcc0OilX50uscLJomlR6pXriD6ELNNBWOSMt50CJjPkyt3Zn/xj1dlPVP1t6XExK+b3jMoULLPOrEGvjELfAMM1qcuBb0AijkIuFca8f8xapUlkvLjmmJW7RK94r8HaPzvmHHSqX9MXdivNI4A+JHy0VCe79UZZJvzMGzpnsj+Q6k3EItDBiA12fTMlSbEOMAWCdQq9TtyUiAaAqJozMzryEg0k+yVHqCc/DyJcCE2V4WXIhEnsOc5c8f4ChWfUaONhPPWogpDs/lyVCvp3m0NSfrAJKNiVy5aNC9gZ6c9BqwYgj/cDO3kdam6gCjhR+akALFYmt4ixHkWxKhDTGs5K+CwRiKJnvxP9dbxRPCBHbiVa8gsd2GuiNHZD98MNwXMdMC0MubVodd7dnyk3UQFfCIIL1osPxY0ZJ6DvZXwtZ2I0th6aqlTMULVo+lhSIU/5qO63lTSa3MgPRJEOi0AJ8/UlZuvgqLw9dyEDQoHTKWOsq+6fzoAyvIpv14fLaY+braPd6NkSaq0RClMenK1QLH87NZriUaeuCo6SZ7/CfUt2K6VOt0AjIK2jR0vorf6R8+TVzxZb+QdLimH9pU5tQc73xW93QRPMGy/gCK+R+YzmV4fHK52GWBEBL05EEoTY6OYG1WWji66dWnVTg0uPNw839p/yjLxkCfdTaH+v6hVUCd6HlROj6W8Mil6AYGC7NI2+qkZvJh/dAw/iQspXQNwwWHr6slLIp0hBHYTDh/J7Ba7ZR6cp3iU4bSXdmzhTahYDev4yKiIHyN64EANhI5OHYv1G4KXfIOvQizYWchPhzQg5eVGNMxsqrvWVxjtIbkKuHzE+IcA2NZ83GKz0D8z5zmgRnoJGKigseP9TmMS7BgAqtqyixA/SLc1KEUWrhXOQ6kA5ZQRazp3wwSa404cppBnfsS8EsEpbr/gXyW36cZ9pt1RhzyxGxDUmnZeBz/Uf1AP+gyLIg9x04u1fThm2w/H1ZXGvVqsO1VqutV5gUhFkdkwoCjzz3F3FUr1v0njGYT2mSZYvoF/fSd1W11c5VIhkEO06US5wYRmHVPYXmZnbK5YHQ8pkIDJ0yqssqFK34CuHE8RWb+Dr4omk779QOOcYomAMYQ9ILt2KUk2uNlahW/IjGtenuGLxb/t3aFoVz4oNwMZ7iyp4td8mdzgJAfnCcYtklubGAUB9k6bGC5DSkf5VFarnGEBWz600VGR8QywZ+jIYFZbtKT2QdDOYP6k7D8qVgEZByGmRedZRWaQDTggLyNgDD6pQwEeSs82+hTxWypqwU3zuAWqfwil+mytzVnKztyvMFJyJwPFaPr4Z3mTjyxCR2Jv674JVGGMUSWb0l+GtcYtd+NBGChwr8mB2hlyccget9liJhQEb0XgXfgVRlHlbO+jlZ9CcAew0Nw+tRcWgNnz/GL9Kur7RohRhaYZBBmQA6JhvzkazHRcdZDn0zDkfBmYP1PfQjP3d6qqx6gE7vrb3lBKEfK3Y/nCe4COdpr23oZCoIpssGXmqE8CGpO2bEwkSN6uqeqR4UtWR+xsgOzNeR49PTLJpFEAkXha5YaecJ8t/KR+eG7/HKV23zPZAMvHDC1rdxQ0l+6wlIgZbUybjBe6yusL7isRuuYYwg4+8+4lia2ox8RCdvmXlt00ZshBnAIfLkSwIqUzCcsD/d1ZG6Az728L4FCIqBKpbA6bzkJ87lYQpbaHpwPpqu3S0UqNDCwgg3q9MEn02X16E4xibz/rLx7NMDtHcwMOt9r1dVU6Hws9TvJVH7THrnSFESgN5eBy53Nq2Fdb8mySTxz5CitvVE+ZjHaYS3hq9Bax+uS7TxMIT4qJE7HGdsHM1/9uPNBylhP04Lck39JMe8v2dPOSJzyQoy8m/8Fc6h+X+5/mBVA9jAsG4vmx/KdUW+NXxgRt//SS2Ib7aGILsjOz+ZZQu/NMeuAsP1pFRTN90rqIVULbJ20ZJlrjoZD1VxHEoDFFGVWCVOT3jGK+vFD06gc3yDUSnZ7ZHjGmw4ZiAglY2nm78aUpXxI4BfUHqL6YQKFDCazUIryLi53RczlaTh0ry7WN4WpWK9sPJ0J49fu6RGUMYZd3+NrRvEdOrS5n+EJOTkr4lNzo8vawcYnR/n1Dq0rCHu5o2BGBEHABJbsFLi/mlWFO1MjpvUu6UPJjXlXse6MtBROT/mQfyegWGmFRQ7Q/O+rJp471+tQF10+bvkExfBoTQrewd5UwhAUODpyeW+aK6vx2AroUo2bGBZ/ZjcsJFfMYEMsm47LdQSq7T7peI2Ex+4/9oIAJGfhidbXA9UYPNhxigFTg83CETNYfYVkoambj3vv4MZNtE/wrIfTguBNqkQk9ebLPTmY2U4UCzbYqPKO5vjaZXeVksobDAJzhVjoU7p9TdFmNMyLyCQJryBSOcm0hFk/pcwcV15KZ/+IIqeQGPkTbiY1haWSnuQYBeyW5uSPHGtYw28cQS/v3rToNAUGVBSQ6zpBt4CHvaOfEJhuDJYZCcxvPeOStdCzaoSQn9nDe8wDc1MXrJ0+9N9TAKcS6u8ANLCLY4UfHLGf884/LFIn4OLOlRcNl7FS1IJgu1/vLm4INkgHt5ISp2vC3MFJHz1zJnopnKS1AgJtCmhJRZDaW6wis8CJ0KAJW0Yy0+kWI3lJ9N8yqJht68FMNVgkgaAGi5LuKmkZWm+ztKvf9gT8hJrXZkM/QdHI6wy9BqVeWa7g7ZM1YLbUv37YSnLmGsCrl/UVi/tG+fZbzY4bGye0zH08VQpGmyd/v++fS9EtasmbkQEIYnmLZLxO+tNHp3myIGwYBZVXjlWvrCiQcsP/Fu9l0HWmLBu3gvuJ4phtJsXXllJdM8iZIQR8Z6zEMs+cqVL7+TYhxDd0c0l4sbyIEw6N+V0v3ZbUlidyekdcz/aIomGdZtmdI+1QUrrHw7eDXT+G3zbTZMXxpEgJc4zY5bH5az8eHzwoo8QUleUKpVRrsErGmSF6GPJ2OltKYL6/C4zx4rHdcfsrQTcWBmrBWMMiFiU4NGtpYeACqYafRyu8j8x7ltp3nxVbsPO0MSoaR8tv61/q+YCqHX3h4vy4HzjCYEl+4ZDtj2+mawuj4J0rBpcDw+spzuCQ2khFbks09lPGxK8HYJl0Y/lNLUxGLZ+2h6+EFSaD22bYzF7dk/EhCWh6u/v1HUVKC/r/Wl6JHtd1V68J9zdOTgbvJuQug4r4vUV3JJolQQ5tecHKqcNoYjOIs6BZTlfB+yHGfGdxTKsGxbU/4taKuH8Qpd/M7fIG5zebrpiDHV97T4jiUNt7K64/u1e/+erXV34aOjfddcKNO76EzIf1pfD+KivBsRlzlsjj17aDPq/lnKHQCLsD+3TK021HNzhZyuwpLRKS3KE0XH/0TqUOr3VqLMcsSZM6349QJDznPG+sUqeS6wwMWp28TAoDKdmjzW6f+2au71HsOzLIeWencRa5JapKkVTYpvwMIC8u2L+/hYGJmk0588rq6Nnqe041NMzU6lj1K5KmSj0ZRiVpzu2FSTl4PBYHAuhe5dtwnRQwvvNqIELVxKMFWedxxB7UO4zpYRe2x0zH4X6pI2m4g6YdCs08vR9B7omy/goQUYbUZA+wJamq7/c0FhkNm74Mp05NSCK1Dcy1+9qp82p8XVkUB4+SsVRJ/Tqtn8v2esmemr7zjCfjLicMb05JqNoL6zzz0KaYkXeStBrF9+T7EbZTo2Fa/wS5NhJvRoZc8QUfS46HX8HIZ8A6LK8zKtROnakAnEEFoonVlvYR71xYuBAXbjtxfu/bteN8WkArB3//qp+3btpi2SIMyK6rX03iCLnzOd2OrPnD6xqgVT35e6NUMpN7EJSz0DRRzyze1J+Dx3cfx0M577W84qifD51mZG8VNbBf+5PxmGGrGOmkO+Q41YnCkx51D+X3CXsNAjaz/XfcPJUXJ00vaQyfYDtmFq4kU1ZHdnep48T4IskzPsYT9or3rd/ubiYLqeBqjnGbuNWb9ZdPDxkeBmJwYTjsTU+VugQmtz5+C3QBX0piVh3d7BK+Hk4mO3q8qJVQXeIqs4hKuRvBfIwwUyKg9W1x8dv+EwESuk2Bgs1+Zc3wzx4eGasynWs3V360wH3fKXZFTckeHZdgtzTqcQPC2hCHhSXyFMyljvrneLE+c+b/YQ0XcDBam1oAPzvKmmcgER6AqnyC32Ic4HMP4FQN2rh4Y2ntrawByV+9oq/Z8hdwQEPYRYiELBCnuGGXDQbl3ZLuUo0vfKU/AuMwYfNXmNM2vkn/GRrpc5WDP+MEL80tbJDZfDNBRfpfcvVpf75u0LrkIIjnU4adaolZWzB2yjIVwNrF7zF//n4N5xHeaGc7Vh1EYRdc0h2l23qFvLBNQ5kHbmX8Yta2Vj4DU6eBN3XyJBvJf9iL4x+hw1hx/7Ej5U8EZr/Qhgoni5r9PxBfU3fdvXICGW9DzST7GV141bvyMDXblFG5PizNjJUVAWNSxIAStz6+eDAbkYeAKTj6DIR6ysFvZAloBLCgSdMFd3ol/WXDQh3BbBtLqO9hp08BfumZjLpTJGRAIHzDizXZfhbgqejNSS27BIXQLV0muwzgXGqYt9McSvtLWo1Fos3k6Nu2qGyFftqQyDz0/bmgvtZyiFce/SLYnjt2Q9BnlmUVBWOtbDPvUgOSizvJDhdiSkbLLP96MJ7dKO3eUK2nZnpb4s4b2XGF4T6gC4qo9TDv9z2SY4Rffb/RjPs76P0YiWADpPB/nQjC2tDRlxt4sdNCIjmMsLgU+cr8cpyaMSYI9maP4HHww2jTPkGKvF6H6+DFAF+jAZKT9oi23gpZ2zavE0xXPkF7a2FTNJ3bwxvsJV+o0fXZAkmouYq6B2+6ccHhnUIeL10QtZaPoZPJB7/Xry/2Nv+JJFmQ/p2NSiO5bYGA8ej1vh5QlWhaX3JMs5gMBnyyIfXIMf4im0WEUnCPAJzq9q04Tmxzy7nGKKEf31kAp6IFk95aj0AogL7iljLVJlOXNvV7BwZn4dKfuZweSEZBqy+Mvual0TVDHiwHuIuXbvaw+OkU7aeAfck0Hc6H0jgt9g6Rxb6dAuaiKEN1cUYtD88y0b9Arq1q6ML9B20/FunTnZNF+IHgsg641FfllDFpQ+dqrIPKQ8IkLx/2ppx0ivQSrehNaf5dwtBjnPHroRGzG/RWOdiW0COPzepxIqcsWjhfmBXSUD7YCvPm/qTGcSnhcriFKew6a5s0AgK03I1gEifX6y90cJBY9REbQ7yW/XB+zAXN1XZQVEs7r+0ajtx8KvVBKJksKj5YFGdhEennMbwgCJJIMdt/pJD6FIcNVegt2LiQS70DAJeiNNG86dQVNYNZmYEfo8oa002xKLh1+rHlBX40iY8Wlv7FqswQFktpyLn5oSdo1jBRz8V3aRIOmhSnrs2wxGwGBEVEXvRm8RZVvSQ0xlKMVWs9Y7nnmJ9jEVuDL08D2ES3plzvCNP3FpKQeSknFeVBXv5T1Yk0/X5vdj1J1LYa6Ffxxrv90ObLHARkCI+tz6+0i5cZTinvgIYLMVnV/OL+m4RCsTy/+9VQPsYv6X2qSSlVdQ3KM1SOntMNUBpb4C0MsDh10xHQ0cbJK0gsR6X93ru63BDYbRZmPISt1casVwVVE7+u3l55XJGJ0Ev6S+2zpNqOAH66RuzpVskXE6X8x6wHOfp5PAI/7YG3Zozh1U27IXGEEKIm13Rt/nTE3pKWA7i1NFdVQKQ0CNdqEsBkjiuM41dd5rIbR4DMnoDva07v1esxYBGU4JWJUJQyejYbI9p7pqjrpHZUNlz2exX1lTAks+WxY6CExoPlSlNNv6AIsE0VdPmHOj4m0a8bigDelTpIL1WoePLhblmhRlkPDKiZvkzz6eG8vLeJjCGJL1+VFa4QREBVyuhcpZm1ygJm9kuQ+8v4yEMw0VO+TKee6sMFRVc/kS4IirJupnw48LoR2aRk+GuDBZ25xnKFxdSYqZqvWlEcemsbzl7wvQg5z2xKxEUsquyGziyzd/X+XFl/ct9KRLzyyb6ComIL8Wam9x6LPNZXvhO0QQZmQ8T2MFjmRJ42WyRzfyLGkJKft94uO0Yy6Fflo3AoIEon3XBygpi3Je932ToU5EKoikvqkeLFACpsBN5dseemiMdHxOJKrVJDdTS0qCcTzPCyz506oyENFdelskwdghmUnWyXK2WeJX2CBXudNUBON/i8kMdtJm52REvmGqVmxe5aricuTCGLbgZtYvigT++E7xltEh/ZgUoMP+d8vaPU/HdhZaUjsgQ8OoqZeezvNR2JFm2on+IliVyYQ/58LmZ2stgKoBbs4SllwiTpNRw7ecL2WR8bbg05aTN00C8aGWtReWSsYsirJ0K0I97flI2gJRRN717wESryWahXUAFZAdyD08j9SIZQm+wq5GkoUkK5cQ3wk1x01x4fKLPgPIj6D6lZiylqvWGtl6KxCfoSQXlNZIHeDsrIRqhINxdrCinM0iMMkveNxhqrEzhnBn8F6nXVY5zUDLzOXpp338I2HycFa2pueObEof3HQgFEMnHS3/CDKwJAyYl3HyA4X5vXUE8MMa79gYELseTf0IEUJRsfSa873vl6n29lFq+GCqF1I+mB5PSyLFvgHv6hG5Hd14PAHTKhY+xzCgOwwRZxygPwNET0UiO9ynH0p3j7GAFEs+VSjl4ArhHJbySohRLfm6B7FxxYJLJxJlQr5UdD+5Vs0nM6CehSZZNYw4FzcpYoL6nS+wGGSNKLVLXgbgvzAbT4B1J4GMS16IKMlo5S/dzM/NM4NI+a1Fuk4qwaewoHqGp78vgp+SkuhLyAVhI2Or50Id4LlHwRon9o7JT3D2pibchFvFi2VTEx6cLX/qorW2YGSSmnu9+M8teW9DIRH1TfabuDIuLk16NFz3kNr5QLPGAd0JzN2IYFA140yqfi9LfBcZI3aUK/Gt2bfMMk8eqttN8c92OmUYKUaHbB9C9cpEwaOYs49MztuGtI0VMqDDHN8HiRP55BpRIJtIWbSyi0/LOC94XhzqGVyuzaVaBfg0f++sV8wy7ytxlQYA9w1ejE0XaCkpM9zbOrymf4OrEaIyQX84Z9e6wQ1czIvOihnSaq/fcFdkxJcMzE2kWcARwWT1U80dW6B+v6HdclWMyMWLYr49iKWrhm7o1yumJKxVGiv1Rx3Tw61jrh+vuNjikpFRxa0F9G7ZWs57nuhaIeT8ZRjYzuyq4WZBEXs4CyfvmZxGcS4/G2aWon2O/UkjqrfdbBUF0yavSPdNJacaaZxFQNejGDPK7SCF82XxiahbNpwFs/t07gbCJkDUvvKjqaYv1SNJBa21RKsOuGJNKO/F6HTjc1Q5t8lqLL4e83gWTT4aubYGtE+D4e9zdPPo2R3dvG7bDrCQosp62YhTaV3B/kEQGqtzvu59fbgA6lFyGe7urhYr3TWCBFYBmrEpB78fWnXUEd1z0LSzMcWL6vuh4CJYR0tg1jX4H0wkw9mkbM07MXopLJ2Rt7/aL3Hl3MjO8h/1lqNlK74QTbgkurmgd23XflEcMhjO52Y/Wsz+CqwkBCDN8SUcd0hvJ6srikURdDKw75ZZMyms8NdzvzfsXreeCzpVaPKbkgWo0BlD+qWqaXziVa7YTSezNkCD1UBphMwE3IFwG3+Oja0AILbwR+VMjirrIkRPt+DMtp+OKLpkiE15AVv3jn19brZGZkhhAsuT2sTiWSjLvxJkMICAGdQY6CcJ1bmQsycrXCCxoxrME8B5k7aYQkl31h4kmnvmUA1Uo5bGEJkzebQNuMeVIRwKr7shM3Y3iowzuO8Jm833ALhjeDbR9i+ajGdiv5nuQcBDW0PZ0CB/GHvnmE702e3iEmWKin/StmkbfvsVh9mXnjLzZCRfht3g5Fu6OpDSsq1DSVUie4hNThGTSTWkOhTKbARv54Bxp1m/BqW0CfvfUJMQYci+HzQBrAw7lHJI8klNzq1wbwtxf0zzTFIpYQcsU3ddDWDMuciKmN+BHJ47B6FkgX4uR5QSWzLqgN2wQK1aLp2hgMJGqMII4rLK56VcDk89QQhw6cy8PCM19olNpuDwdrQFvP+77wiyyKx8Z4MVJNxV5vJWOwvF+aDouZMW5HNno5d960qcPPO89qYm6Zh6UO7MyFx272aWYtu/0+UZ6eThOP3s/uMGRarrYNGVN2bkl0VbM7ZArP2AnCQLuPoIbkry4nTS/RsIdFmPg98zeYI4R0RY41FQsBym1OXnJcHtmKPjfEXuujVQGfCPrCZsaT+vFbMFWIvUy7OxquIvdi2DVp3+q3E3NGG06d/cz77wgHGWrfcy5LJIzCMZHkk6m2QnZCXYVXwMsVhJI9nJcgG/CrU5lgDb/DlVEsXG06BHIuqVfnTyLdAQZYmJlEEk43pdgF69V12XC+sB9W5Tfm3jPwiHn/VmGszkYx+Er49CLbyk3hDBSKuzDj+nzCo77ZO40EIP4ZROdSwWlf5S8wfYcAzjNdj/aZ8uknw3tur126RfCzMA+cUo5mPaZL9cVp33X0mRTUIS2vgtwDRgsSSX5xcJUWR8gZbdeqyqQEEAeDu3+BMlrgYP2SH/le2u1yfVFn5JX9VQ04X9mmABR/KOd3rAYqR+OQwLWao9MXVS1y+0OKo0FlXuirKuPaY1BQbY3Vo05Gf/+N+u4rDcFBQqiCrYhgRAEjvVW9eNCaOsukcJWEaDuo/pWCYGJLadm4ssTCPvVVEJNBfVXAcTIxH4EFtWFMJUy5of50QNXNZBl+oRuFIkdbt04DeU6j2A3vzzP+IkMahLD6zBVJv+xRBIc5fODvnJMmJRMI8kcyMFqxpeWZAHxC68tGFNyl6yyGN95SwNYXwDSIQCPlL9bzjZaWNWvs5puiP2lbEBlDw5vCHtVmb/sD8QBgOhRassChwM5o5g4lhlD4u86wmdmVmhmEXnCyLeQJ0rRtqYIWRhg72ieDnqmPvOkDTWtKR38TeJwrK/7IRYfbNspygrU6yV9YtJyw3I3uEkDgbPrpcNUpISYvzv3beFg3ZN+swedqf3IVKkcdiAezu/KpHGHPyvX9oT6qzTS342/DenW9ctM197UfFl4rk21KxSma1KnLIWlGGasMF4+G3dxTnqBscul4CqNda6Qy8ita7HCzKlYa86yljm+HQA2B5ArJoZy4LNxeT9izFuQhEoEhUTNJQj2pCc/O44h8GpQX6XgpaAvAQJLVNq0yXGFbzb3O54XQ6sm557+lT3A+VWPyCJn1MLbsssHIdFhJcMtBFQYi0bS+exQ4Rq74xNE2CIRSzi3nj5TNy2AoO0gdyBC0/2iH67UB581jmM92OHqgD4EzAzyxDauPnlIdZu0nWwB4dtxWN+meq/faIuQpK2hoRP/ULwIJ9r3xyxtXxfFwJ3YquXldSEnxoPiYD85u0OAHvKOG6+3eBraUiOgvdfp1EjiroeSLLFutuPPV9XqhAReYPaRy87OAkV5tzSqvyfufCvOMTtkpxApWsJ9n+cNM2uBWu4lj1oDjGasCfCt6cfgCzh6UbZanbL/qCgf/iHjKYaavIiRLJrU2BuzdsP97XHkXLYbbfsHVTlXSohKOXOJ+3LiR6ix9UFLo9qieejYk+P4e5wC64jGQLSxJzYt3cErx1Rtc2+xlJaEBynLN4hLl/qOrgBM7a+yswC0Mh2OieA4SR6MfM9WK/FOWbVyoUBIUAKOhhIZp2LOgukk0/DInn7sF7dRP6Nw77MaAcYg6k0gdjQN9/1wtGVSBm+6LwkI+xfcK9l+JiWepXul+/EEdV7XXp/9lUsW4RQmIkda9H38FJj3EYJTrG4hEU9YWtNd2lKI1683cXFVzSMkh+2nuu9K0JUBoAnrYkKVZpAKF9G7y5n/KMZrP2xPuUFSOaruqriffSEX9Euj/k5dgewEyQCFTif83LhkIjt5qJ1LyI4ynIznWl1SoAdecEp+I5WmKBB2fr5yw33NX94q6HIP0jW3Np2E0r1f7fUjqdxV+iCRULU+yAwPXFvTL7HqfFLj+wCfIbOg+nsW03rGTf1haLvAZA/nC52pSDnC4f0qOiA6WtK20BldZUaA6GO3m5ZOCGyemGK4a12hM3BXnbladA/yTRV+pH7IiT/9WOijGGNXzV+K4wmdmRjU3It+QwUCRat2mGkEHhOcQY06pWeQqBGjHkWcceX8/drkk+tYysHMXVk8hLhLGjUVgivK1Ra4K+RtUcZO5fkVkWQ4W8fyo2tafhGEDSsflUH7yj8wsATBE9YpskR+r7Ac8xqdxtEAfRioGXSprjbLI2DAZZz9HAYR7rUHzvh/UPpFvrLbd/hFf7sF3RimWNpiGsQRZ11RqfZkck9IJu/FPU2DYr/HWUdskJHuLufXCvDbKn0F9sM31Hn3zIuAMTUc+tQsO9ll6jnNnW9Ulo7d32jEQMqJIrWQL5+Se0a8lKRp+XhYp4IfyUaTRC58vFEjKupeFEpU4EOp1AjeALc7vZV0ovza8QSl3ru6xFpY0/ckElMOChkhLWSDHLCKaFK/qC/SIfT50GJZnkCr5SgXZRddXq8Gc6XNjIzSdCF+9YlUFKMiri/sn1Gp/dEMhARah97GidLqitLNBlF+H8XoQmdrM3GXBSCN6izNn2ON0OzpCxOuM917OZCw2ZC0DSvNuTOFCGGYf1TYgUbgK2KKc4zm/25dz3GhVpFqs6x4yhZBbiy/6FD1vXW/aIcDiSUoIhwrUtxuGGZijb47Jz8JfUTblzx4eNPbXeYpygkQo1xXonjeouTuJvAH/zH+FK50zOLAtbN9AO6xjfX09CsjKitMVlHWmmQybLoBHBPkC5IbAZxvs3cH1VAcy2X90WL6y/0SXNsGeLBdr1OWVuYg+/wUNiR7QnP2ec7jNrZZOosT6Olwn02Dh6zSwKoDnMFLfk7lBO0p9mWjex7gEFXNfxFO19qmaoISUZEgdTuy7sHgrD/36o3XeFdzLFoFnOJa4yaENBXdTSmVZacz+5IGdVkEgjQt/TxuhNGHGtQuzNDfM4iNZ28Ly9S9WkUGMNAfDRLr4ipZkJxUA6HnlOi4Yb04/Ze8rB+HEXpDGC5Jpr4fN62LQh8o6kxknE1P5/rNmz43jehFlRUvCyNi3Y5St7lC7a2ogCt3Za6M7AshQdbVV2+R2DuuiLEJz0MLhnn/1/F2Z2U3h560PrnhR0Gc/5GW5DwO/DGrR/4PvL046BKjUp1lfrtKfE4osRTS9/oB0GrNW3cYgvhU8ld61sHhKOf4P94t4n7h9zdRXDaFv4ORPHokkY+NA9QA49RmsGMfJLu1/RXuluq0J4fsUUBoa9dL9T0yDJXvGtuoln8aYrNzoapa7E8cR73/wX6KwBPpwCUUlxsBtOj0rnca7zu5FqJC5W0U8Yt529SAI0S6nmWnS8zguQLRzf/gRLaqSQ6E9T6Q84u1cs56dzBMv2eBG+zAKw2V0x1NJX1gC8M2MYZpScdXEKPG1442UFWTEUlkM9OjbR4FurtJNV4IqEu1htlgltESO0SeZMHZ1JM7bNtYegevwPSCmW+S8uEGj7FTSSV0HbDg1rOnt4Ws8DxqN2T/HOXNd5NGboZ8VTSD6g6rLWcoWOwsyeG08GPG6KHPiLRunEdTPNmY74ObRGT1VCHP7nmBYmjnH+kqK6rDyrEoNjdqc8uG8yZrHWBXU9weqD5rpQ6S/annq7P/GiYepA2ZDdJA/GbdxpHYatPgkXt5sop564gVHZamW6cq/cdADaLCXWt1WgK7y11WaQR90YOen8BECQ56pmJbLvzzfWBhUUJP+dAEEK4o4wZv2+IBAFEdNkNF3mKntsLE5PDLA/IEiV0rziyORzLJsoxRMCQV/HlpCkXsaizcHT/vxU9iadf2hOkKehGum3973fFs7uRlqxz/oDerFL0617PqG+VYIxjeRb2IRLZJGH8vp8ITzF7U7HUg8Crs3WpVY5r8wxn8tzGvUUwY5csVu15Vmm1xcs0UL/lUCkrOXdLtlaa4pHLeQgpd/vu1ZzjMOcgzfQaIwiZK+fMZjRLAHUf83TSCOkovb3xPkD0jElmb4TBqFrwn8G4KWr+RM58qhCnlVimQ390m8YLz+fNHbBRDs7GJgHSK+v5Z9cwZq4glnR2eTjnqTy8Wo7BEg24CL/RT1AKzOIE7muo8oegzn8R6qab08LzTcbb0ippsScfjQoJhsr4jKG2pMVczpCYqptZcGD5rxTHFbL3+NDnEUptRMyARhF2FMiM7pgaB/IpAna1AHa5EPt7oBdzMGg7kOdSOpxrPXbdP3l/+QCfCLMpCsxFd3VAxA/IPVvK8JaenCYCadhyZ6rJeGxTUh11+OOAjrXIJxb/EbIy8rv6h7hywPp9ZhPCcgt9BN808JhGIaKwtL85jO5nipQyAF690xJ9A2DMuCx55TSG88fN6rqBMYDI+I+DtFmoAqJB27B/xxN9xMLnQwLcLCHOx4GIFCq3/6i7gwJePjoG/HKNb0XjhuEQmYFzTgtt/uIo1bBX4C+y1jrb+R0mRj+RyaDkRus8W4WW73qbcjpjIh2tGUY6KJyhEaKiK+LHG5euQeYZO4zXoKbZOWiJTvJNNVrWugpXkIIIE4zK/g4JKATQjtaC1qbJ6khaJHxOTS2goU5zGyjmaPKvVPrBh27E7E2iZ/6omwpBARV/9EKeU1m4Msz8Q7y3MzEF0C8VIIqAxB+Fk8qG970lhV/ZIX6CsxiHqybemqil3Qv/cWKm96fPoMJWSA1dcF03dSwSyNMdvKKBCYVYLuqr2pISKPaNRJJw2R43RNE6avh/TNA1tGJ/ilW/e4LbOvIh7cS2OsbjyXcD6WS0DYaDa+og0lSxehZQiDSt2fVdtF+DO7/cEUAM3uju47Fl17rUPkRPaheA+6/jpSYK5Nh6rSwO8Pbi1y4/L0L5SStva0NcscpH0pw/3Y9+Eqw1SDVvRn2r2d8vRC6YhQywdhKWraKGBMILqjiU2l5d3jb1tnQIwi95QiTJW7MAjJD4Plr9FGRGlM4NQyAiG8wSAKUbRCpmxE+zk9YhXjiC/Rbt983pV0VzovJW+90dH65IOb2VS+Wk+MpsRgZ86uEuxeGPyB++07HlAwqFjq0sm5Lvom/rcHSaLduJrDdabujYJRWbbY2QZptvGwTHAiaqsAafE9NQa2oq6hV8+E2YRbdEcrirxyx9JVWpti7CsFfA/egMevH0MR40/X1jQzMYbw6mr01MI833RiE3EuU79cpspC8tuN6QxFB7ExHF8yrFQ4vRniEkTgKc8kT2tC2HgNJJ+l/FwYXky6qbHj1cMtBGVOw3SFMHn5l5odYVrLqhL6R4DujKq/CEsEj742QjUogvrSb9DOh1Mm5Z7n6MI+YHii3bWp2abi25FJIiX3GM/137MQVr4wwQ5IQETnYx0CoXX1nLeqLjQ2VlOulhy58iVxN5d0Q2TEV6MPr+wA6lluGEC5890db42elDUvTbbMcjHGrT7WA4eEhNLqVT35NhLruSPkwg1UCAUz94Dj23i6dqS1MPh40Oyi0W+wfoWYXIw+siweU3qKdQM/IWLUwDjgMQuiK+CTyRgR/Cg+XmfazCLiF1JChK7C2x+ROCl4t2WjYngGRxBWRQqqrNqx1EesLx8Z8GOimBJK3Ip3O0TWp1z6fhibUBvCtBpCBH7Wz0MrsYEtW/6gd/rLbB2IcMxOrxgW5u+/ZBOjd+9Zg9SRf7ln5tqXgM7wZE2rj4u7BOezWvuyca2TpJkQOR8U/bR+LRjmN6RAS7MCfYSPtJWSbZYnQL8vGmJb39SyiYiER2Via1nlShjJEe3JgCwTOTiIQJ5h+NQeEs7qWkpIDJiQHb7VwcR7T1gLGhKAqUT5DPO5zvGPny/DOh+Lo+Xhxf5wTkF5p5yY0vM1gw2UZQ2nhCedQ+PBxACaAeuBYTyBs9aNWvYATPBLUtXJ3H/+rMIUQ3Xz5MJKdV6OhLEEK73rb9hfjPlA0gKO4j120U6VHh4AJvL3WqjaY/KCbwpCzUCADZmnJdpD4p4U5ry6/YuhcWXcVV4dFm5J8qADBWw9jPITjUtkf0lhIJkzhXLTcXQBZaaunvCCxyWh6ifYzNTTCGJcUD6DyfGam2zj4qdBy7DwBaL2S2IxicF7F2ubPDvx0+DEQVydAIF4Utn+/niyxDQpGlaaG5eRQcfYEHaZeHBOfZ8x6KnSsZnB8YZbLVBcEF3Mv/87cj4r/BYDYAaUWrrm/rWPImSVpvPlB3xQvVG305B+bCj4kIW4ZWzFnX7/nApDibPZxncAV04laDsD872g54z55DZylkUKHXF7Y5iFwsc0HDovYpJ1P+XIAb4pKZnw/e2BrTZn6jCeAAvAt6Z8EdXqS/KoRwK37xhZL7w17n2PYpqnoCtRAvnU/CocUq+el+PFEwM2GkhLBAJXvVbqxBMfPWlA8XMNY1+dfsV9Uy0C+WgSzcXw/ylN23DlELK9DPZ1nzFCvyDWygh1ABv0LXhuVuDEraYOrX0J/NpbYoxjl/mfncXN1DorfumMjOo/dWEk/OvdZ8w/66CtISpGM2htGRpT929qEz+kRM+2XpAqcSS9GOrLWVVUVIm3Ez/yIqAWm019Td/ytbE6eeYJaY+mJpelcp0h+4Y1hmcF9J6cZQEJi7foY8n1psVTCzE0QYMX+ScYxKxb/bU9eproUaSNTxHeNhomtba4y/CfLAZYXndn5ndeIjFIsRWRpwX3HwrIsKxRgd52tRs/iun5uy44w8u2wZgayiPbOTWGXUn/BDqak5EZebXbdQHyE0yEhUO5HcDnE6xlAuZFDSKLDTTZz9bWcfe1wy8KhSOwh15cBRibt+faUQgl7/5na6Nl5d1o7iUWTjOhjQa4z2Pha1PNGSn0hZFeICMKGtHJ6EGQbB+HF6+M2e8YSQjJ2cnG2SVpdzXlnkzxYqwXv0s0WM8nggSh7Viq5joXNiF3RJ0A9637p1HFJd2I7GrQ4ZTOWRi8jcZaL/25Pox9feMT7VDPV6TT++0Ri3a1aLS8IABZh2dWfxnBmXDWPdvrxmBiF3eePVqd2ZM5bI9YAN23/3qVLElDeD61xvgRdjkXkl2tqif3zsX1gGp9mzEm6suh1kWL75XC2kXlrCreiNi2pfI+iWVFJDXPd3MBNp7VSAZRp1jpt3ug1pQEM470lZXwotpDljklvGxuNeKwTuKNJw0EK74nc0d851QXL9P4pxZdM7pkmbA7IU2S2Xa/AJRP2VOz3Kyp9oW6FgoQi4noNkoHeNnprbQod8n+dQSSbMzNRZIuL/riHaxoOHkaGYwROCZwqcbK1tUnU2Qt1J+3UTvklj6wOD/d8lrZG7ucjZiCyHxK5XVtzq9lDJ4N1FvARCTUfnLeOLc5bmrtGvb8mmsr0lDDyR5607k41wzglZH1fExfmsXrEjiNLSzSKGb7FVusl07/BgeCclDsQkds2G654GVeUpX7UHaqQBEmJsIyvfxvz85+WyRaoYuQfSH9WpJLeUoXpUt7+Crnl1Jqz+eARyCmzL59OUUBwBuoQAl5VddIrfG6xvDA/RZBOV5AfwjOrJ2xRo4N42rCSFCcnOY7xfewl6tVLetiM2tGLqRLc9k/owyHriX1A9BnluzfDc5xdEUKyuwzWPG+tZGNDV0WLl1JyHPflzcBpj92G0AR0lGaMSZuKui5/LUMn69X9wPKc6FVkNEHEjHjQKPQjuFCokjN+N/6DlMscpE48IhHIa0Ghrc36GwGEiPRymXWKD/di92yfjZjDM3fdHBdwSxJRSBVKHSwh6Ey1/zWZRZ4kk+KMS8HuroIw1UPa+PDVpsSIKvmqZnZisbfHFWNW/dl9n5+wM4VIzhmrETz3k9WU3s+z84SHh2f7dGT/G5WvoisBYAgwm+pqFS0A8xyhy4PiKfgS+6TgnQD5hDEerpzgFSaMcw3yvDZ0+xfL0yznf0uY8N6APiqHdoJZOWqTPnTIbeBLc5dvFdh+mvD+sDtl8BAWzYR7QkSgnx30Ru7TH5a/g4byacurCNvG0lTgpkj9w42uqBp1zMsKr2riOCQwfCRKkuSX9CGADOYGqCHh1JUsk6RwvI9OvM9fCJoL7Sap8NUQ7mAvdB2ougA01NdqxVo8NeGta0R9C7QybiN4uAtDxw2zLTG9+0we68JkqZrj9tJilUV/f4wOLc83GfstXOVF2bAJ6zf56YworQQEDj6QnC+lqyMkGAr0QuAikm0jqS7fy9bYSBz5hekPILc94b8aUau3Kt69QI1kFEmcb19aFQA4bSegA9/hFi61RDIVQ7iOBqViYdGaK8d3zH5qWIjed0hR9e6o4zELdXWhOVOcPCmZIYYXvgUsAyGUoCszsCiTdwOaPEL2kRnYh0mNSZGb6/kr8XfbyUdbEZ7mDBYy0yTDxhkrpIoJmVutN6FHk/E4cTEolaGnv7x+QxQIKZus8IEygpdtBDxj+lC5M6HaJ313pLDYbjpCA+oYl11ISRJ/fB2oIdDBHFLefQmF1uHk7vtSmIyI7Q9HG0qxu8QRWecP8ipKR1o4bGrAhR2KcGEDE6k8r2F7N9lNUZCswXi/EXaOlPb9fdsaw1Sspku1xrmyADIImEs//XiPqI3Jl8BlrsHf1mAVCBmlqE7usMbDEpilt45ia5CXzVqlIZ95Fesu48LEATS3dyXVEjwQAqVbFBttbLfXvX4LhaGKv6P3XBsKWvqEFfq1rPYdohHtQH03ehlVMpZ/BRCBFV6dffGCrIa7OngRAbORd6wsIcR/gQSxhfrfHFmb9Ws3Pk/SikwIvAIYljNbXbvIpKTROSiPcmBDp4hxLkrjR+MfBFZLV5I4usLY6WYmjhT2kzW9XAxxLYCELLIf6lg6p/GFgpoRTm+yQ6PYtmKVvdTHyBxv28y3vTiy+reYBZqmC7x0TDasiMCcA+TxdKgDY4s61MpZyI1+RUzeMfx1qh9MBXg1tI/HSKpcUj7+qTrwp35J3ezefo6UZiEWMPBtx0/tJyaej7NUmUHVRBJfB1q0bsw4yHfui2ZOPNh/6R2/I0j09t9QGeRxpuJzB6DNbaPTOmER6WTXYEGXq7DhzkvCP247uSz6r7MfaasDs419fVF4RAt4XoxkFRmk3sjrhpNSeuDoG5RpjE4pI3rH/ESPaF6RIIJBiAbVU/ct/nKrDmBQPBYlNob0WmW07GhOvvz0m/BXTsPB8qA8Iesm6PsDuOLEEm5+jbniDFyXfndwIXHgWBB1GCyGV52MU+5iXguncQS8T+WyxaPDqCCXMjwPJxGObdF8mBkG2+SpqaBQkeN+1IL8Cbb72d3ySQUR/uO+N9v36KAiKVEPx8EERU0vfKi53JWN50+LSYqgHmF0UrnnHCNpcwfX8ezokGL4sK/rgFZlXnIqg6a8EJh7DfMOwMgTwRjjZ+TrXsj7SA6EaMRroFgxXRIOGDPYZgkadllrCosfuVZqNQwAY1cDJzuD4ocR7PgZYXbCA3g9Jd1PRx7PyRTNad56qFMVIv/9AYYd32opL/KQOuEa2LIoyMUHWsHVeJEgDnTAizkdfigKSmZVUDrztoGXA+B+9B+MYT2q5BETXJUKRLiEw3upTpXnlh7hkEk8/0D3rV1lUxxSlnDzLfFArxdnXRhBNu085RxiTwTISjItGPuj0MQknBfLTi9AeLTT9QUKRG7bxHm7P2Kei6fVAeNBP31q/OVsTuBJZfKaxLodsCxObxFdyJNLV2tAt+2SCAO5/VWcDOd7Or0wzbVGwbXJr73+/PYn3VfNQ4CSxdqgXNPWDqh9ZFVRQbSeb+bFmOpdkO7C70y6dTSHVuHlIY33/KV1QHDJ226atG4ltS4fk0ZNDrmPZ2Lps6qyMYO+Wkmsyw/ECuxfXcZ0zM7vmLjkk/LsX/XG0vaL3KZb2C51I5TVf8fBJmMxHHzKvaXDwSTGiya0f8ZZ3olqbqcd2cjXM0jicXlX0cJsaB81POyuItwEiYZwsHn4gymrnlD0mfAro2YoSC7KxDdL1DQVO+0a7fN1fLkv8ElaXx46Z8EGJ/W6akIr6uEuiFIQB9fHujgNzIzAgaDEYVITJJO5XQkyimdgaTBvra1hUbw4jb8imqVpd7G9dSoQVNPatqBlbm7NLsdI/einfpw6HdFlo9bpLb/wBxf2BGK/YWhn6LhzEvBuRuBZJTDv7HV9WfnA2SyT3HV/F6f+23aOYC8rxO7QQ1FI4/0m/OAHdCwYedzx6F6TIlSh668B+Id3ZxNP3V+Z82Tt/AHYSzDsxyYC8mxyk+Za4Q6u8y70AKpUm1NPP2WMeSHfqCc5mUcG67RR+sJWZg7P5iG4FPnFmWKv1nwwk+fM0IIA5p7xmHnj1zbj89sN0hc81tzI6enBjIyPd6P5GXzsmp9IRHKS506SAEK7IxfjQLxkNK1x+M8YAYLrD1qWXqo03kTvXgYllmtbguZX1FQGpXYjbZzgqSLxcXTKqQ/GhYqBJzZtvPaYGODBTozt0Rw6/vP+hTUJGOAYcEWWr5Mqy4792lLWmElkf2k2HiF5268DSkEL2oQl+VXl2NXgbfa8xxQoI7lpuNkURcA/pNz/go3LD+w41q4eQy20ecjCwekr0XfODump0XPUm2vvNfk4P/tAVA2PLhl21zoFOrSKjd6D1AiMtz/f41uWlBWCDDY4tDRMhyGsls4GW7P8b0/dGx6VTgC6oCCWxMyJyOgl5RPaFDE/EzGGGL9XUm5X9L3crn0DvEELm/Vx6HwlGWtnfZK7dA8/zJkr9b7PBgLeFlmXyfUBxZHF8kxgW5tcxvkEz0roS70jNLvk3QNCTUIwCHnqk5NRDEaewDCzjTR5lKzNzx1RHHJNiZZJ0lXrAsSM03iKPyYNdJfMwUAvRlKP49yIx7XS9cvseBWVvGNAc2I0PmR6Xc9KjqauqjgG/Q8i16OIPtQ2Ll3qDkunTNq2O65AEFG5qycHaB2/159N4n67iMEpyNowNdkq/ZlDxsX4dRKNvBUJaYqhID70qa2Rgq8+AzqTaJhuYrqrDDO1n/0rWggrBcFsYwo7ujJZblKGamFf+3B5MTAXNUOKn5PW91Gx56gtqTqz1dYMML1dFR/KZUZom7Wky7v9EfKnYbBseAvDuBFBFFCuXnhvWc/JS4ipUIe59Ls/kL+W5lteo1xt5bkJYfug17vGw6cqrOjTG4nQXZ+RbEDCMTf5JZ4DBcuVv+tGPyucc3B6R9NMF/lc4ubulrqcBPhRUjGBILbQ+4uBJ9eUHMAj2ijfMskRMLcV5FdgqIWhiEvxNVlZSRrzTzySfBUjZHCJQtbgDZ8nRWLwk6rQKWD5aSHuJh0vBgvlNTP+a4P7p59l0FYBPtoNpiFl/dOo05KHesQCueTxj7IB6io9sqTWxTu2PK2C3ACiXWNyxs52441hxg3eco87pSRV1NUvQeac35o3tgUpXtmtl2yHh3QO1mQ55wSqIri3PtVxJ57l0nOuyav/0ixzLEq3QlLZmLb8Y2JVlrdQMjhpcC1j0DS+VHrYIB4JgyXacVu9PCRoC5Y2+p8qfeJA3OFreaabxWxz5omyn/l55+ufQkO5e9iODCdLWl2crwLrUpaMCi8EUcVXGb3Z8oBCUdwuuohn1sivwQp1O+DaRFYXIbHQibdPfq4dU8WeiYJ4WKMlNEuQr/BRIGwOrAIM3Ppjmzvh27Lyx6xK14sUHgNy2ggNG57CBbXznFP/0NVrUQef5mMdso3AJ33SJxInqYebzcZ2pEVYHYczXE/+mcptBHb4ANtGohwQabL1xmFHav/wFH/al8TKjzGnYiFLEifJHL7OJD0x/rtzWuCrDToEWPBNtRKXFZqz/kBH6gsxzy/TUzP6R+C/A456FbGm8soK/uYyafgNmX0re6fgXeehUvtDCXdAUJElJt7AMv+VMdIrrOK7TAaHo6E8Khx1rq48yOqMqtC08so9cQh/AV760CiEtSm6PBL7JKCZBV4m7t8Gbbc4TQRawpuwTFyS/vt1JBnAQUBDPdEddlJlVAfbGy+OKkohOw9BB/JY9rDZQK1o/kpfl82umHijUnj0gVqhJCsrzUxYl+ygkRPDEPZqUIo/+AtsGplmBSxL8bUE1iBc8lCtShF2iqMC1DdHIH1DcucbSNtxOF9LY4IMng4T9eTYzDr+gnOPVxWBYMambJUexTzxyvFOneFg3r4FBEHqG3QZRgnKISYUQKv9B23A8vhFRe8uNZpBtiMtXqOQlVEbO/HzkRbqVaGj4s2XRVlhO+ewkvEaTp4pNLXG1OVF6ncxf3Fq94KmGuG29LLsFI1fuX35J0TsRNGo+TCioyTrXLVEjPztNVQL1/q5tGSrMPhfJEaQxHcrnqhVVqN1gfF+JK9Pgcud/lGa+Ig7eKQpJuUN+PYhBYQ/b6ahi4nLNe5+d8rQlfK/gl3OQ3WDGWuUMOt1YlBKoX+99JWlZr6tTAVgDF0NSHs5fqbU0euO7cXKnvVB3taBFHP6/KKZCBfGqzNo6DgZgiAELh1EYOni64dmOWUuwAQCKu+L8tnTFLlL6uKkaNtO8YGlOBVU9mQFYx4aGPgGEI/HTycxYXBClfKbmSErtcsuhalOh73FnzRz/thPjvRJcRwPtZmCHs1nYjivLMWWGprl4fRUOlrCDiwNU+9TZuaVsuCxj/4DzKfcla139igH7Z+0uskWkEq/c0mrsRLlVpl8ln0G77hwK9rLKc+RLeI6KLKy3Um5C6Of3qiKNoY/7ad3EFvdP4VICsuTMTii/bee9efmKAiym0A+l3hS7SofuEJ46In7BEO+Kf597wnd6s5mL1d5zNRBdOEmfNKyPdUuCW3u/SfFQes7nYlfV/B1DOE9p/pmgK+bx+eZdZUMu44uBGlaPvej5wxU9aumiyt/uCCZ4PyO0OYfFAMMqTaYcI8GxYeHO/3tDJsJisLleLpS/gvPLbEksIm3R4OCJ21S4P//uyzQ4EJZyYmWZjtknKJbz0vFEi0zDWnZHl4kvpMSPlVI8cEAG5r0JoNN59joEsMhUcPZ1YtIDYX9cnR711x6SQEnBGgTz6d3b1iebIdotlgqE03w87xlD0+qEykcVizaOB3Z+ocaMGWybZTIdpR4niV9mDm65EzKK8VQq59iMlABk54A7zAlMdkYNmaRuWJN+bLJ7RqEZf8vrpM0+3cwD0NctuwJJA13JIJVFlPStNIXzAW4pp1OnTx3rMZQfF+o4p92WDkF2tx1MUdC14Er9l1RlYsEYnOubj2IotL4tkgKwnE219ZsjXb8PJFkzakaWhRBJAkgbR6myiYFsJgC/lellsN9g1ML0j4HX4rwIzHbq20FDkBdfqN9SUnIbJf0QQr+QxHx4f0kRekXaqKZYUXYMbRKa6OObLPOaKGft7xFAgT2pHuSw7kdfloER91zsJPWQJbkAzyDFkkgUg80kW7n7n+WBN3CMXA3lU6QR23Ipx/98577h2OGkpcp5YiTX/TikBkcza+iwBGNBi/j+GwW8tGbKxpiSNEQqUDdqfscbVMQ+OSYGoeQKSLwREfUGDjR/emc+ZAJsy3sraTZkpHFZAI69dwO1dvsOw/Q+O/2lgghmEsk6NKzmfI+OYuOG2UoagP9Le/y9UABk4VHk54+6fW891qe1yVDT2KUc5hNeePBaQwVb5BQYPt/+2xEpqsHC4GY37hXyRSGvfwYa7DGUDbMKd8vud28h67mpOl7fe4uFRe/HOKf3TFs+9RX+QpL0+C2b4R/8VfkUQOABt4tcaDV34nU/UFXBUDvPYMYe0F24AZPIWphY9bLwt+tWvmuWwhvAgPN1rxvo3hpXvQNSPsVKgFUKENrmSCjWPYCUoQfJFpepI6oqpsVwJt6IlBFGO4soABNOS2KtnF9P7E9sSLK1WWOdGvYNhxKO5/D5ACMSM3oLy6XvjzPe57hP26DKKsIbhLZqcz8tJOcm1zlVKV87cVqDh5iOgGkNIKp7JU8eBp4VRPvv6peu3DR+ROhro3GOnpo6Cdltkq395hUi+pDXzwcONA2YjC4BKvX3JGZi77wJboSzwwPelRCe5297Gau3hHdjkNfDMaoCdfo4BX1IthlFNEHUm2nTsuiPe/rOux7FSlxIwT09NqnvyBmWQYcleqlPEreuoCZRFvXL07v84AxlxNdJM/atDmCjpmzumIoYOf4uVqV/8ZnSwV78WW0S0R7AwI0EDq4B6IaI6AUBwPrNLY0eeSw24zQ6qVAgBGW5aK79Mg+Skj4XxdPl8axMl4x6nwmnAfEBIju1ssp4yr/gdi9kl+ScGW3r5NVqJ1fXRkW9O0A6JBottvWGypQioSH2C46bepNpt5dXRK28XY0hseEnW9fDBaUMHziavWy8Q7jttulrsjOd5WunqGz20rPiwX/3fdKuQgv0g4CDqGBMamo9htCyKqN0qTOxWP5MmZG0lur+eIMwtcrfYqJujT19J3dps8mrCySt1MRdmlNIykG8cIMszw/nMlRV1DmpxNn2zf3gflXm1sXSH00EqrICj29dnyNSbIteQOqjPLqBf2QDDVVCAgcCz7vER9m5X4XkTIeB4ppqaFa2UHE05QSkAhs7FkyPf40UFGlKG8GnrdKq0ZLUk9m5jleTBwhdDsYP8HCDKRE6LS48qLHD4pvSl3XFvmH8KBEmyeyNwwJzAJQd8MqhmKsdandB6Ec1bHOw8agmVGP/vvY2C60X8AnR2r2HhdkUbclW9+ozjmxmipA1AJIZnqxg4aa1Le0RHfU2vkpf68y/rFMYgCXue7eNqxoS0NkOw9a9/WcDFJOh0Grb8zYjPgaSDENIFMCM0H5OlIqq2r2FKGkaQSMzVm87r9L7fysa4xxVMD0h7CIExLBVbCe1/r/WavK3yPhHVe3XBjyVTDOqI4/90N/Cm5KnqxFrVYOHbwMIXa3GwNwVME+38OpXvNwD6l+jN8BDCRDEjGDFC+WObTdm+5/tfm0QeEfVUYFtA7gTobiCnl8rywroMyBHNClofz+W7OhssrGuos+fRhh8kBA+Ni0fYdhKK+qCZaY0LUDpn17UUKCX6dOZccCYzSsD2iSQP74pFnhlkOzACsapdT20zbjF6ZqLgELUPT8IglaX38zP6zfdyBF+NjNf247XNtmIz4QCO5iRy/GcS8jjaWMfTxI3EbUvzrprtgRQDOz/eMnyVQVbbFiTMZfhfQLeu+j6iY0Qs/QYGFdHefwzAYuVpPhVZK/tXsy6DAioLlmNDzAu1eQ5ihCnobO+MOZtSD0+uTpiOAvPwGWf52xDUHj4zbdFtZULPV4c1TmWflDGMkg/Ia6kPHprHErwFTGoBg+1D6oX8lSPdz5srAF0RbktUTmq44+USAYYowZQOVbM3BWMc603Oy9SQD3buNTgzJ7yaMBbo/pjkzVrpW5xYH0Ra11ykiz32vo4nBg9Zvm92KHWhJm7uQJV5DMPA1JHBWBMcjz/uZupwXqjoTffeHZ17N3waXUaR7cZDs94ewlhsbQrmI7/A4zJDUZj0qKiVQhn3f3AneEhDwl6GUdCBdKY14q9n6ay58twW2PRXXPJ6UE6TUs6oqH/0xgDpP3bx/mfcCUy5oo91agCPtpTfowGZ0tyw5mIOsUqvdURDhjuWLX/WIqaPlYx3zmJ3ahTcxtC5xQgKWrQskF57LaOvwYN0lzIwz/joNYkiZwLyB7Joi0CsWWRC6SapEN5TClIisNQtNPmfwKaKYb+Hguo76RtcQMXdRZWjEJNHq8KZKeg/uWWDOW6aygLP9JDrNNW7JfWDyHPR8GL+29zBAD5FY1WZXsmYfdKU1VTLLzAHERJJGTpwKZH5k0uZrDYM8zG9WX+RVDM8bsmN8cI2wKz0Td8GEq9T4DvY6FuhMsqPGHC1tkLdxuwBYP0Lu2RvjXaxodrZhKfkkIwGcfm+lFS4WMFPCz3FwWwuvNLNqv7c85xnk3aXWl49yCW0YTzTqwyKuKWSIFJum5G8BBjvxx2yDOZMh18M2WhRGX5VA0p3eAilBsGa54P+iEat2c0lLnTrXg7fzDLJrjO/213hRmT/92zHwHShntUiR+9KUWKWRcx9OrMWfefEo/p2FR7dbNWoP/P/se7JJUfBzJixcPvTzMvSTQrccDAmpwoLnh6pnsAF37U9Cakvwb0EZzywhYhfUyAZ4oAu4R1X55yrbJifKRbLIC6NaYqZxbpzV9ec4/SFSjJKEvmVGa9tHfUJayAvrPPbVHNaxlbdJOOn7f43GTTdGGufXu/daAhuYtol2y5rFVUxlDpyKCfYRz3fOyJZEjhxizetlF5kpK8kUuEpKNWnSG9VEdmcn7Tu0/U9Pho+IZiTincXepD9zQXGusmr6j19TKRCe4dmbGmRl1cDDNABYeOKT51fHc6+d1Q9T2n1UMmkd+aiSUgNIrogqtnInezaEs7HmtmpjKttWg7ulLhPvEEnGE5TqPY3iCItPzYojGET4V755b+cNmqdG6OBTlbYjDs4AAp+ho1Iq8R/eWa0/FOyB4K5JLQ/WqwpaNPuaoufHcJMEld4peiw/7uIRZ9U4otV2lACBY2PfSUUu7vJ/iZUtvPoJmd8K/BmbnNo2iumTtQxEeARnjsHdzf1JrE1L6NGFsI7t81c5GCgmWILKM5pWDA5HO53I6aju6916JkUl1YcYyk9Hwwf/waKzGbNaeXD2d1jBd+rriDyPgR5p32kxAb41vjMM5QjUrVztISMmbVDBnx2qArnLJ6ECRGZcfK4U6LCAMxRtE+Y32MobWIYqbeJLCsaF4pCXyZjPABVmN36NRAavX8RXO80JuF2m/Snmg2NL0dSW67EVH9I4fcFSjpL73r6ohLh/V+uK3786Tpz4u9p1byZEEFVjn4eK4wBNeQ7DGhdbFbRTt6/9b55EBMfJGakrqZ4U+Fgnh2uIpidUcG+iBjHE5HMRX2ZKkKLyYQElkw/Kbj2w8OvDaxd8rzWoSUnwkiP9DB4L1FBdrrf9anTqNfPehHTBlyG9cgcQLrR8tQEZN9zuxs8BV1Zf+cIk9kSStcCODphQCbZP7NYhgTuqPh967gyo6DhJVEeM/gq2arEo3NkVtX7D7mzM4zzsjwEazeZbygY6xwP5F5NLqPJ0Hxncni2XMn/GdHQmTbQF1zee4LOhZaDlBzMZLsKXcJ3sJsBmPODcSW/FKYiVgzz7wLdz0C3bFpTwedWpIZzG+H0kpS6hOFF5yNj/xUGHEQK75qxYUFuXq2vFITPVf7aaAWUF+eBV5VbBqFcUccHNaTmGaDdRTdXTurKJ8ATxX0DHWz2qNhGP4nrYJRCKI12hvvahdfR6RlR+zca42mjybVuHEEGrU2KvnHy9+mmlQDH4jYHZKC6knkne5Q28ldgrISAF0p2u8YVTy2bGLZqUkIV6zWDXi0DuZMiQhOJwUgZQNnrjzpboxif7CaCAFdxHukA5fPTubF6aLOTWCnS/EP8ZSOIyNGpkn86BVLEgxNoCo5XDdJHdnSB0Zy+5O4NQSsoKdZzikwg0eSvXAE6j6WW27irlXjNHHxiuOY/LaFsSgXv62JfK2/O09r1DMjpxv32Y457Wd8wFBf9V6i6CdLP2Z9qNFsxcP88S7N6b5FAkZAkO78T3f4mpUVnXed/QQC1AAudBr+gg118i202+jHf4m1tBvD2iwt/8PqoAWQSajReU2kDJ91lZ9cqfgKVbzge5mUlKDSh7aeClFOoVz9UEdTQyNyjj+u7JaX9DWyqtt6955fcvBJF1aKEjjPQjYV4+FQr9Fnd8NqWavBRL91OUcILzXVselzvLQtPmmvtdhkUNi8G+O+b/qcVyHvls9lJjRGbe0YWtuq9zXA02yIjtBjoQd1vY0EmEFvb3u3xiPt9Wix6NZ7ljWQVbw229SAPrh/hsIECHTLmxKxWD3/K6TUieQeqJIfpcIoOQcgmvHDyyRUevzKImeikRzg+ly1+qSicz7hh/DCm/39Fyk6M86XNkhcEgJKANNt1matUHBPuMmqkqR0Irsee0uIofjg8efSzC4Ml6OzAV1PuydANODV+SaVqKrg8qTvT2ROpiQHqoOAq3EdFRo1QW+1ak/AYmGEVA4cF99A82GRm5mLHhLHqOSqBVNF5d+tjFko2morW+bAtWqE3Mhi2uYPJEeL+puWOoJaLV9uHtQIj2GvjqEnPiF3gSNk2kq1rb+v31DDwcalu1nsmfE1n7J39uQgliDyyoBoudkZrUtnIUrDsC6iGs/DA1YU+EpC8VYQ4iw91D0O8kJIRK0Zo3YzUzYnm6vxq+9EDAP5SWf+Eyupwlhcyq7rgfu0UcsS/cyy18bZBvpooyg1q0GNkTJ+MwtXBtDoaChHEqMdF/a7GjUgboSb8jHDJrfqRhQ/bbI62r8nHoOa6UgOaJLxxg1EhXpXmkd3Rch7uNxgpPzxP/mBdrGsygnoth1z7Q/YLYJb7LwpuGREdhP+ef4imi3CBmJrq9pWR8/s43S4uxqNYHUv9ha9RBACBhuz+S4xTQTZaCKSoDHnxC8CxGhiHczvJUTlt4rrWQpu9+AvsrR2wMvwqpTTd2ETTsO/P3JJiLBUvcs0TXCPCRY2h9Nx8ZqMz8XSEqa9ByDLoNM8PxxK/62v/Wkztb9dlxfHsl4u4UjIZo5lD7knNDevOZvFRYHhwFE22lXrX+Sffrt3y9R1DKaG/GlAPLQQX/Hetzpmce0TT69U3cFZSUWj1hcJa25OoCXx3O5jXSizjPu68eF6JRu4ly0GPmihJAcdY54LAu+PeTtHdGWaRfb6RVp9zxwP+2PoTSQm+qFhD5LkhsYuT1IwWLIAUjU9P0z7IOUj2QP4sYABt2vX5hJCVUnjOBPVGQTmwyR8LSRc2WvhlmD4DMitovW8AmruHvsuxxMnY/ybXB0f6jgvY+7tMu0sJN5r4DBEBXa37SH5PepbiAlY5L6+09qF9dbg57qZdXr+Lkj+9ODwIdoY9Ogs9QXAMPBK9sNLNDM1mFaODMVpqeBBx3+/X8BkyPofOmxl+kYJsG1PP50FDBXj0A4uVUwSXOnyDvjHd5pupMiy5DyOMVDjPDi22YVTeKKPxtGz5/wLm/x/DzHO4PBKlriUyR2fdazZ8MZwZO2yzm40RwLqezNhsNT7aqhOqWBMfTbYcyVtVzrROKLQ/cw8h9MBYgLQZ5m7RtajLhjAmwWRubbOysVY9+MbTxulvSqQymjxTj0/yGmowXOk8LorLHbyciHZbi5Wipq5e028xOnXPq0SO1Ei/BmXFCr+iw4toQwld1d5KXZJaq1eDPduqLEuVRpKA9CzB7KJsTTpdrYpMaOsIFM7Wgr9Oh/caoRAohQN6A6HSrmbUuxffYlS4ymc4W40QYfauuqpQ/JTXe2l3gW1vBU3Q0CQWi+YnGMAlM7QCe806vIrrgQmejgYb3z21bFn0KNZj8qMbtk0fubcrDYYwmBhjZezZtAK7N3MQKKCODWwtmN/WYEGctudKJzRB3xrBGIXPbh2oyOsQ4psvw2packPl36ulG2AlW5rvS3xsDrZG0jPgcLNOBZVquBKudvtx5EyYnivmLREWPn30cbkfL4RsfTwuJVSFZZJFh6UkofGq/bkz/WqbPwyDk8xppCVNz7JQstijvxEWrb40THMQJebLnzyY2q2jx2SLecaR7/0b676f5ddR3aDQqQxzS6YlPvFcYbw+8vic5SAk75H9CSsEorQCVlJSk7DU5HBRkzDnV2QtTJe9fsfqy1sQNBXqUXzv+3HDVDSjlHNPKEmNGm5+zlEP/Pa0mLR8hxOG5PeuHfsO4YAaC+btxGwKVWC9Se7tv8fBJBx1n+Kox6GyPB1SVukkNQkjh9dl8s6dR8uwRo6Ep3zrpyoDHwNvpGU0zV5/27gpveUjCyrt2ZF4TOPsS/WygLkfE2dbNXsNDXjU0kggbh+REnbrOGVNbeYAoc4ZX0aRdyTYOFzlRKaGo4MoHLkMH9FMwYlY+jItBYVbIzsByLIUmu7xM7N3q4VtOAzdBtYpwYx/5yTIIJ9yh2VZWg/uPZimDRgASUeaIeF/TU+n3NBLOkQvsf4CKuJi9s4FqpE2p0HLaw6yIcFU8mcl8Jx6XPWv+eL9Uv+Eyr1QVYQfaJcVwJ6kjFn9GSZ3uvbIxaZMwi7x+nNLp60sgdzogotqc5oVT+LDsygUDk+S361me7L2BWYFkcDER/Rx+J0tgDZ6wwKRu7kFtxCpqtt19WgsF6LzpqmDlLORvOsY68JnuZgBdo7ozFmFR6uGXxbySNeCvPKl92vkVsYEYjZ70nSsNQz9WiIy0pcd4Cjnd16gHVj3X+IIr+ZH/gTnYy0JQvVtpoQKA3yqTH8ZK5WAWFLSXjNeHCwtYmaan6uJoOWW3ktmR0n9j0uxSEniCHfobcaa4adhh6U65iKCHer9DsvpoFJxkj5jhGLhPSjJ+hLddzatV/1Ocn1CE5uZoZAMtgkhUYN5zk9+VUjJxOTjDsX8kQFan+fCSw0rK8IhXNp3dynfHXSYCNq076Pn60lpsgbLC41pl75UNjAtdkXJ0OFBP9SOFxYd/qxoACmCf2c4BNjgll3P8P77ikGQPLbKe6Bprf5RR7SLTcoLj+WEriYD+XvlnCQ6gwN09MIkc6PH+xS8JfJD7iyBoSsLx/L/1AzaxG7e0eIP2dxroERhpC6jg8arrg7XQBksDHIJZIPRhy16WjWaucMUOLtxrgBU9rezETjoCtMnBYdaOAagkVHdueRkp+p0+SRoZ4ejQaCwhOiYRYYJC7NsV73oO8dwYLioC3qILoo9B/eMud5uERJdTB+L3gaZcXObntZ43fegezhpmSwHyw4dM10xfsXF1MY5XAR1XmGR9Qz8Yrc2BSBiUUf1wSye1tGQLKtmsheBI0zWEKzJu8/tdWQ84lcWgnXo9INPwDU5XiJi0OyBQbwRH1ahR14L10g9kAYWlDK/0N3VzcgYYursjTtw/2wSHmfTGJsx5NOXmMmVliBLLHGu6G0jFBLZtUkH7EzFzorhlKhKRrLqXXlXpO8crQ3CHEcZLu9XzwCc9SvkPe94gxwonijdizLHtGfLLKLF1cdtXMFa7Mf4P/JQHiBZIRXBzCKoqPaIuvh7X4/SQdEJnxbsIECUF90ZnrLUpBjTXiX4XAc3Mse7eTXKyZp8Q3Sf1S3esZyDQl+BBER4PmbGOeQ+K1112FbEeyqQZg56WiQ0jRCUmP+Kew9A1ZxSjutLVOfkpuBwoSkP4RGNoe7WrmyTXKI6nk1Tnz0oe2Vm3PjBDf8Gwhe+fwAYSAjlPra1TtCj1uu1GcdIAm6ViQn9Srqf1ym9fPIxInLxt48mCIl6DSTi4ZJ+XkJrz2dXWQqhpSF4nNWapdIjJH+p1Opedufkw0xHlr4vORb9BCJ3W8vAPdZSqI7VxbNaaOfqhI/8w7L9horVKv7MLnEr2l2XgUM6+i5Ix58xgRlYVxa+ltEdaupD5yktPEOlldMIatEHTM9j7h7hxVvQPEbtQP6BmDdVaPz2u/o7+Aiy4lsXGE+Km2ss6828uqY4y28croxcwQBaemP2+4hEA88WmmXnQTmIMFje/i5qVzP/dynhApy5GEB55hU7+jPdveexxyrULupZB1hjyqISvKscuKXOXZUnp8dPLlTkOIlOhMu9t4Vx5PLPIDK0SdUiZ95AlS0+/1macnq6hXYYejgXigt9NePxN2PY9CC0HftH0q8httvBeLZ48ootbmSIZgK7/Wm1zqq/lUDZBL6CYC5KDyLg/WfRKIQMNyN2X432uLr/f/9AoV132hvDNWvIbdgJKmzFwnqjd8+MjwrCINW480Y/0ve7EpvtXHg4WzJv5MuILg89gjdMk86QRO9Q/YKdmb+HV6eMqRTq/oudO/E6zvH3NzGgHNz/zI4Clc1kXUMDTrnDpBI2KbWe//7iI6d1A8nhX4F+4tGki7hfsA4VOK83fdLmcdAGqQRjtItVXa3J7vhE+x0h3K+fVJpM2FZDdY7gVF9ME1rtQmyQOE+F7b6vQAUregqMnIegpxtIKRhyTvfx+DFWZLf+VUZHUO+CicH8sE+9LpldACFUpG+WMfE56X+8xIB5l+Eu4ij2kBUNYythq4o1kyIEuD1kt9XQ97gS9+waaIHokWae6jm/Y8Govgmk31Z2M0SBZAIeudbA/y6RkBys3zsWVHoPxD73jIs92cougppJ3Uxf/pQcoOw/qt20epdVJgHhT5/Rg5mNf+bvQ4LJnwSxs7VE9Qc/myZF4IFBUAom49bMTIghVW6RJ2gfXkP6ovc0THTEpxZWx4zTkARVTfH75vftaIkZptS+h3ERciwL+zFBfxojqrdRqqdkYWAVmXpf+ueckOfXPrN5b9eEwl8OJWgoXwyPM73RDn5ix09+qYTUbhIRquBAIHnO03H3q5TFdSXzP+sPDF+FV61ALiJwLttts7/NF2qhFJI57p4sixeZfoEtm0Dg5wGwPCH6tc6aqO8oe5R+IkDR8TuyFEN2w2kBdTxxvejaSoap3bQlCW4svakUIjVrpe7zCbbcGL0xSe/T3hysCfb20Xj0oFitmmY1Q+1QAbHJj3MfeeZfxuvYYoF7mLnb9sF2SPQEFrRwt08qapY0ODw4ReEM3TamVg4j3BvgKWWLIeWrMXPSM+I3hBzjUn6TbqMNWIPDWj5FBYrWBwXYB71BOpmX+5iYomjHoQ7LUcQ867QRS3qZXYnBbLy/FO2tEGfzE/rGyNxED2nvMySIIs4Fx3fZIsIZn/tCkocG9krZ5TWha4eDI3zmyCQeBMYsXlRDNsMfjEEBFh6/Qhq12c9IUp606kEY5bwbG/QnU+IAyJhlftn2f8iRL5A7v4R9oAJGU2GYjNHqZUGg2z6az4YMtQyXcV9X9WBRlaYnfVIRsmuVGDhDBIoG6C8AkCK6LdXd0NgeShgVCNpx7iacd6L5r4rVi1Gco6rCBwBfwyIJs4Fhnq8IZrURn9zhkJ2FenUPijnbIom4cDNJT3zqMfvySGt4ko2KqwoGDH25QLfuWMbcuRhuQwYKgCX9VgClxETR6DM5DNjTv7F3ysG0kI8NKZ5AZDzjJnJD4VVPwVR/fNKHpzgM8QQGSapVEbQCuiSw0xjHphp0eDxZeames1Mp9WwQ2puhmhj5ql1Lv0eYJEpN8RFa01yfNY0KZkTpYzcO/Ckhbb36k9esVXSMPl1G/K7/sR9Mcqvz7tEmdFwGaO02c6azfLxlRg6byx5y5aqHXBgH+N8X+0pGSjHsaENs0tEcJU4XtLrRLBJGIFVEe3TvIYkvc3siaU1d3xi9t7TPq1L/+hMRqojqmp8jBLyo7KEuYZeOKHFM3mUkV+XkyhiFhmwxtLgSsGMbh8fE6hCR2rTOIinlmsF74yj7IpViQkLbyCbrvDt5/yX6I7Y1abrFs7QBI3D9QnlxlwbgZHvFTKeaFKcI3NvUQFQURMimQ5M+eF6vwSlYff+7/cWpYmvPrIh9BVONzVYOe2tQdAWWT5fJSYL5Upt0L6Dl/pZObBEdo+FPC4b2+iU09eJ6vb/kc2/uq9CvCUV9KB+C/CPAJdOu7vq8wf/Yxy8081PEnm7VGsIzzoFYnDvfYTUyPhdXV2yICWljxWqkyEe4e1n+SZCRACDyiLTdzj5Dq5ThMdA+CNJhV09iM2iW1Pgf2XiLDkIpNo8ugDtNdVTMEBsO+uHzrqEI+EwMOFr2gevD8TkmyjvrYH9Bw6rkARUFwc7DRpOCIaACn2Edjv7bmiS3MFeVgdj1y0Rv+v1DYqY6EwHst3CNlpq6XBW7Q/fu+F1R20aHUR5Z1LIZ7wvY0E/w99bKzAyUjG7671ZUYF6F5+Ynv4Cm0twLZ+GTrBp8VL/LMeq8XYgzYldrklMglyWJS7iWBhdA5GraO3m3rO2AorN4N62bHcpIhG8kbvIkybnRVTEWt5a5f7iIYJN61OO1gLp+lMKa9CuaUR/y9eoF3/jHgqh6iPSadglFYQ/GTsLkzIXMTFtBelXwJHtvmQtoXItuOsLGvL2IK/M295YD8SaNfSND8zTfgUXGYQRyrzsPYC1cxWOto+YkW9R3EinZBFUy/5HWXF6WeqLcPADGeJH3U642mjV9hMqA/GY+7DcN2bpls25VizlGv+FyH0qhDmmd0gUS8y90rDX+Xk6y6McJ6S7gM/DYcoTHv/2NeKg4rjMw8TqrlL9LBcLKWQxtuJxVX7ObKDCs6fNlfUj6iRrGPFdJD+ziFknCJKgixZ5RJQEQZi2MefRmUYi5crYu3Oh50a5Jf+upvNzFAo7KhxO8WRvoqnLO0wvvdcPsaVUOIcvfZoUierdTyFyoxwnJI91KCBroEodybtBGshuLseewOL8RJP+H2Oqsca/SYdeeRtivXY+FFQeTQ33eeX3DdtS0+wgHXVCCQk/CkG/az4aY+ExO9eyJRmpeKAXose57USPZEoRKo6m3uIY0rsGhjw0xAS7X1DuBTFVuo29v3dChgu70cPjpl5/xQmrPdA36PXNZRWOszr9FtTYYxG7dHUooremnYo1QnUGWsN/xygLq9TDGLLhVH/pc4pD+15uGiALFzU4PINmfD25G8LAsJea1dQlpC1s7rkYJUQqIwFNDY4Eh0dawLn8fCol/rhUCEbEHM1dJlCBpXxKfm7zt/ZpsbXgy68nEkEoLjs9rk0E9GFFZoYLZv/4qZR7nl7qBbeALu0FWvdWoNb4hCvlkME+i5nbMafn9uVxxXlpXBlOxHA7IKvKJLMXQanWkuK9A+2VI1JSDoY06+R0/g5TPJIHfO3roljfhM9ncx6Qrk66xY1H0+2UgF+oQgm28A27u9+T4rGo0sT6suA8Jdwthg1T9gojZro33dFb5pubkZ5ZHchLzsKkibaR3DHxf769V4iImNuKKrpgMMK8vcvF4YgFx9Asca63MVyNPtp5+zXPASns3bwdmsxnn1S54GTdkB4DwX4L7JXMnQGqIaS+mPgWxbIZbFcDNIrMilEIEGFczfvcACtmReTyzqnpITyfsh5QK4RKX9ZWtvUy4bWXjsLYbNV7MrrZsT82c9cmf4f8I0sSYqVIlcUYgI782imxBuEKs3OWcogWDmwlr9TGLtVSSTlyzHUW4PU9f7Wv06gLioBSoAf5esTj3FD9kKtTKQZfTKEIOcCYWcfIk4IkcfoFGKSLqsHhBpBOTfEJ6dxkBJXCSlknDrb8XJYO4/96XFd4ThAg4/Heg3u5p1kP3QG2yMuUrty2cFQaT3cWMABIB2diEu/1KfFFSKbfjTp8aUhb99C/ZA5m7h8JWsGwT5Ml9Uhw6CmNHyRA15TyVwIsOH0I1tFeVqQaoqT7wGjyqrJ9bI+WtpjMv5CAGQfj+k2aPOJZ/zLvxAtkd/Bzh9BZPEwVE0I0DI82uWK72P5+mHKig5zbXYrQE5bSNA9/gHvSND2qLV3hLPnoJp5q/NeZX7mhb2aWf7qkF8iM4HEHQ6YiYA+E+kPmfMGabHq62QBi8sSJ3yb68iTcA4YT6f+gJb6G3adGkY9eeu7XQZiQEi2fXRSKUOj/zLkyh4R3hOAX6xhT1yCvCHT2Jb9tAzSMxe0RFbM3g6b/VHgP8nyZkt45j1ZYBTwOpQIaFU7nU5focNbiclNOds9b6I+FOnBXwyAf1ViJPMKBBofmR8wg+77g5o3CiYUzQ+KdNxUo14XQc58/GKrIq3XSIefM9azql5sX7KlTsU8DGT1HlHIYnd10cJYsAEHoN0mLKcHTySHsjTFesKWsmK+siZFXhlavE6F44mweXOrX6FBoELRrvIrsst4OH+O47VaML4CK/cNrjlTodfRr3u2XZsHCcw9kXLGX/15sm10DYmP3G3387x7LDyVoplrs0pzIvfcy41eb2Ob/wM6tQNLxQKnfSbL0eyYL+RWR09qeHT/lWpCFvcISYlmdF/jMaIWDyxE/LA1tguYOSiQtSqHfgqHr1n/k5nFhnUBnU1J1eys/8qySmWwIplgfD3uNcFHlg6trf2B11Om/f7E9onO53sWHhas4nNuhBJsUn2OjOnOAFZi2dcAvexHytVxIdybjHcEdXUcp0jkab19hwZ0RddTUGjtyulBmpbfGD+4d+oynTEjmMlYS/pfoCyhEk9XbgbBf7wtFs5qleFrCmB0NrUYZLxmw+2wFqYEUy2hYP3ZxY8uhRZeFXZfhOD58zGBx7lo4yMjiBc0zvOGqVQm8d4tk1CRpyGJOGJWVU4EpHPxqgMP6hV7f0IxJugziIEJHavrZauRXe0/THYEOKpl/a4jm/fah+oAzHRBqwetjJBSjNp5LaZ3ZUNQElZJBDOF1e4muumSHF6da394Cvppq45QN1B2wYBfbx4Y9fnq5b+heTNTCmP9XhMQGniDhmdhGzfPUY5YPvTUhEcaaA2ucNDUO/xvaUVhXDIodrM/05R31bnFkjUjn34N7Aiuagl9VB9SjYsu83Ws9eoevaZVwZMC4uiZko2GtNzZCyMHRq6GKhvEGBiM1gLyvMZk3eR2dGcn19YX72JnDBY6RWncG7lGAg0YZR9lyoCyQ13gtnyBi05gPlO9yOeIYGqQrhgRpR+pAvx4czdaBMpVI7SgZMAhMSsdPUEQ9stTtwSabBmrln0uHsOMhDvi0bNRUWUmqnu3eiLgzk2XKGyTaHCe59vZZcmDkk8aOO6pTw5H+DWALBPMcCOmfIz4cF9E5zesXbQkQNDFk7vlnAcetbpid+Ce9MnTb3Clhv0lL7lyusJYCpLpalVXmQ67YNR+IIDh9vW7XeWnU3FFfdnO0yqCON1josSLVMTTaH/T3Q7Y+gOUofDwwXaGyGRB+4GRC2kk7zANlgd7PmE5kXda4IpmTbP2OqUJ/O9EXW4aslQR5PtYy3tNMamtk4Lwzb6WIFll7MVBneG5vPfEGslblvK4unzLLIvceI6WxhiZNc/nr10k9nn8ikKPz5jmA9oC+lWIE8QR4XYTcO6WZ7VMORykmWLBbTE1NQc8/TBpYSaYjlsyOK50EEwZC6/hyMiltFDU/OcVfSs/4s0Rk68qJkU5mIFxzQcySQSzLKmqQzkbb2ZlC8MLMP8Tt/ui2UK3r3IoyOWjDNfAV+2/iYAbaU/gcEuC9PqZbBCpHpobrsMSJpIpAbdk+lZArMaQfdQP2kY9Krk6TsjNb/ad7Ghc/HTlJyxRISEoijGyuLhUJB5Ch35PrR1oibmRE3vvhC5cWj/AFFMlliT5ELHoj9ieMLEG0BOkVRUXKuv2bfaF8AdXORnzTtMfXYqB8UVY5TvybX4Mkg9YXaiDDrp7KV8wVHpmx3MIlmRkznG4Q7DbYNTZBEi2yxQfQW37NrAOyCP8AXP/EHi/BLLFg/ip1tleZLojlnpdzKgSmJyi4IRDWNifCtFxTRjzh2z9DNa3KUZLZnixrksQWHwp2gRkmuu7HYPHYIQrdjih0WnNb7CL7hFDLjbfGaVLQh5Fu7SHtZTqDYzgY4QnM/x2PC8v6+qmCAMbOvWxZOIxjgpUF1ud2/e41K1bJAXPTZ0ctJLsigJDqNH6fNsXGGXNx7cwJPgP6INK3Qxc3ylfv0L1e9m37k+CqkJJTN6MvvQuae8WjO1l0JvBh6yHIrZgf/Bt/DNS1QULgHfUCLdwH6GVXxn8JChzrTEJL4dTZGD6nCwPWD+eeU/jxNc/wph/HYngIZcSTOnA7ZoHemc7pUYXx0Nr45Sbce9CyAvFnCzoIYbXxoDXYVwt/7sf509VEfvoLzjbFrRKr4vntb5dgeDiwRX6neO0yQZsOSoVjVvOOSAuP4PT+ezKgOTL5CMeBFh5fTyCTneXHNexLrs1pBpLHH3kmt/Gi6938ByjJyGR1wM7/rvRQQoS1drQjQ0vefqIJKlavxUAyi0PuILAyGGfaeCzz00DKjY1cowpRuwwf7rYPEZOByjttnqj6EUZ84F5gZp+4HJmTpMjNq0q/lyKFhwHKG0wkVp5h+gESx82VKGR+mbao8YOh23JnEy+eNJ45yos7d1gFc6GC67dt+OzE5TpAYicEpe2YtuuIHNt0hQpdLBdS8eqx9D9RSrya3h16jYIp9Ogfv58USTrQa6bOJgC6Fuw3VSohoUOQpQ/XY+PVKw2eV8Q1N6yxzymT6QIiLizm3kcA+jtFVJVj/IlTTGr7Tj6P8fQmh0ag3AJfRbLs8nmEQ1QHGUtaUv9djTgKNG5hVLyiujHLL77tNlHcYLwqquU6Z2V+WMoDwfBiMDqK39/tNhs7dXQhQTHYkold5VgNmV+WJr8ETyoKTHTS8g1RZL+KCbZw1LZoGTgR6eNleq+XGRggG9pbw1+WcW0jzJpvQle+pDWTA3yPaJogeuohg7EijR/48Se6kjwNpGStelAHWNOtzrfgmNxtH9r1eSRWLz79nRNF5th43Vy+rZ9FcwK7PlfJojQmk6yDIgDVpS2IJtFflHkl2pdrA/ZK4Grks9dfURGUNk54HimplKaYEZX5dE2M9W/60vxTLBE6XeIZ01h4YiHBHGMX+eAHZAHpSk2dFZUbQL/ylbq8VdzyOCnwzB532xAsz2XqmJFNJCZ6YuvEpyZtLa07GuhPki8MeZUI63KN4jC30SSX7/bWpsMyfpqrzmMI+cCYlmRUB0Mu4kG/untuIlFzWG2JnuSThOvNB87WuxDF4K9MPLtApA2nPV+2yMqZtQu/5eBgMzg8/6FBhddJz3kV0onK4Jbo71w6dhI4czF3ksh7/wVe0vAH8B/pVGb1v7xscPIhg6KL+hvTtq6g1+kCPpBURUhkj6yrfPgZ3/Xtc22MaQJp0ouI8smF0IW7P8ZfkCNRlxyoz5rOlXJ2YoBYf+hZJACLpIW6Ecg7s2fptIWtvuAgGvGV7dSNLkYv17ghjkJQx6tLucnApd6V56PAKNj/7Yyi6MOC9uwvXC4HnQSolMT49c6/5ZRIfWauOyw+arQBxET3gqjgZPldHDuhPDdYxffuJ1ityuwa75OUwVzCfQ3DhhKAfuieBFYqqN1i5usxjNFwKad4V39gjt2wLjcS1yX59qz0LCyVW9KbSYU9A28hy5DC7hdtdQxRU9PX4vfg8R4KZzpT7OhJe4Rwnuob88KsYJT3Xdb5uQj/iI2b9k+IAL2RazReg2nxwi3ia771jH8mWcStAs1NJu+cMgx6oarFqLe8b1HSRxQ7za0WtQhVKdhOSo+l5MyUbO7l4rtMf8vOidRDYSBoESyiDirZR/lirb7mNwOHR9B00U3KDHjR+/6/p0FjHCVpWNOzJcWfIRQkZ6XmbdXoGNbYi+/6K31kVQSpEiFHlf0XTAzQKDh03BJv6aoldSXInQfAEINY34mN7TGvaILI1iq1F8qQD9LdUyM1y1GkmIcoViAyaqPmTF6srtanuyTM4L1D0wyuj0tEVAfuycGdwEON4fnsCqlt5T6S1obgnUutprS4s5WpzQgzd4U9TRXJErli2+o2bS7A/uISBZhgh/679K/zLda6gWtuZwAvTGNdCbAN9uwZti3Hk9kKWrIq/zDHz00+fSYLcc5sgjgY5sWd/F9nGirgGojICMTxUzGmVVyjsC+0iZ7i++UKuLA2KCekIgylXj+DAZVKUFgBgXYW5+1bwyASMUltB5MhCcaMuivyyhZw3MJ7OjjmJyH+sH7zwWOwFaztw+KQpl6ETunGZ4wgXDkkep9RDpXHKdERy5R1KfOfi61l4kXklOVi+UvIPbGuKxTqSuKxjgg5aUU0X3V/EKdOugbYyeYKlYTyfe6Py6u2Z+A0k4k2giHiUVqkoC8MKxTXxmChSs68WryAMhUxyo84ORdwTONcLdmrVJbnyH+ugmyyx9iKEPADsMijuo2U3uJDa7Wnfr9gcycQq006VxIwrhk0FV/BDjqzquNOsEJXdrimGw0G+JVU4/5BNk+lE5kSCYz9cOOfNBtbtPUoVHnu1jfPwwGlaTc7GUxPcDFnEgwaHh5znVnSwPAAdXz5o6vI34Epz0NKfx11wmUjfW8nTAn60/CwPV4XjHM2yzXbq/EA9hUimpPyH+gMWQc8fiEpaTtk7l1iADxvDO8EMdlaQ0nXdXnhCuCrsoC+Uvlb9IaXpTbhDyzTzYYUPRsJ1khYU6+UMPk1YHn7mE5V3/F28Yia/wrwDdF+R6TmVzsqudzix7NyUGk46wXs0WaHIURcZDicGiV7SEhoVNTU0zgBoaSd49LNnCcmSgWRMUa0JKdpcVnfovdDcIyEcqOXD4VeP1baW1O5XKi8DuZzNuEL/drafxlkHz2RIla0Jp8ILNn7S3fdeg9UhAx9q0+SKtkZq2KsJrdjjyAjr3GfTjVIDAz98414NxYOtS7EWs2ZaFK7+4WBYoC5Hkeq4b/TVXen2W5sxGUXGVbea0PfIOieEzqtacY9iZH8JBwrLvaO9mQx8S8Xs1qoQA5mRuhLUFIcDGMj1wJK/K+vclB5Bl071Plrpq5+L4WJ77f/haemR3QBDVN+DYo/NMMFkqokI7b1nRwuzDmI5dEx4XMlGANd6UtZZVQ12+CHjwiLfAM9yPWaei6wRjGbxBRZUWxyt/lA3BanlqVbrdSdMBG5p3j4Pa9sSfYjUr77zB9h2qpnC6V8u1+XFmGBTP3y97KCCHykGfB6mbCNng2OYcDfFxSp12MaqtqOwry+xB9gUkHlnfW9DENAGqcYOxFOWwZHAJEeIuPuyLr3pc8euQGkJA6K1rmHJDoeAl370hmHY+Wk02WBNr6bOj8owlbEPXZobBQ/xU4JVN9l2GH0nnIedokXyCvBiq+jOf90wECFhhyXgaKiOos+J5t5i72+cySCooSeyr88ULT2mwUuMCLDw9Pty72PByiEtatpiqNeZF8Kladg4jD+8iY+w8ru/PveAVmrABMft/YevFyzmyB1LNidUz8yrnolKmitwK2bPJrQzSfyMg7RCZtnj801QmxB2Hh1RdODJ04NYCR84mkyeVmLrySQsPfWBiZawIPusj3W803YTrCIFZh55a7RhYSAh5uolGsv0TMC+pfZ8CJFMfhrjIkPX4iPlpoVij0m+1EDPaObMhssohxiQLjAb8un88eH/6Z8SnJxoDDY9JjIkM28xe9G9BMqE8CdRizNqXF+yzFoq+i0JXmGCunk6mGwVz7dw0Aht2yZLXL1jgrrUpP84ikBVljLiJmABWcOUt5aq4e2FLPP4IYwNw6/6kBGhUw92jqGvzzSz2IXFoSGkFThCZ6Hdi95k3hbTR+UyOtNXxKf3qOHtoG1+tO5u2H6XvCe4OZ0IsSdV2C22f4X0XRjnoLI9dkAJcmaPzyLbgrWgj/dizWHsrNz5PzGCCZ7zywhZMyk6RrEJ5ucZ5k4Fosm8+U94ZyJFHYaHthMhJSLgoHd9plpggxNFeaBMx2BdSg8d0qM1P9s3xHTr7n+uvFsfU5qJafAkyfAi/gC+OLxCw0uMl/XJ+id3bpdG4VxQwyKvZaxCWrPaRHIy9KcdR43jv9jfykGUTzB9KjyF1G0SkyMHMeY5wgAmcEp9B8ffD92GR4FQExXAD/Rm70xyf9mrg0HowJ+Y5o1trz3gJx6Em+pGPt0PvCVSXsmyA7BLMqIiL8iKyvmFzR0O7FJPoUD5dZJ1eKn4tDUJJ4Umb72XTHqR1qs8KsHPpu1Bas2jM6FoTMyoX5aScTz2RVJH0xso6SkxxuMBg3uUblz4fj83SnK1GADX8ZJtrY6l5lrbF1/ZuSi1BShVAdFnfBB3Sh1SW4KQz2mL+Y4svWwspzeGp4W6pTFKdMDjOxHzkJHkAfLjLjqf+T1Axa9og+Cl7gRTi70bSWjsQM9F19HqH1IdJOoerLMQTLpuVpFU//G6/hsxG6sFsnzMJ7n73SbIizBrcriqJQot6sKe+uP1gONUVuBIPlDJA49atkvafSdkS4NR+zciAFrwoHjdIsVSJKqDxAVrM15uFJb4cUI1Z5j3Wgo4gLqLZDMdNtYKJ1P7oBTGSBKZGTqguAYXj9FtcQ4sSbuwAvEKj0iSHfGzNYpAzMhIVEl+O5tVLe4s/3uEd9Gsrl6bogS5HKQwX3XK8Vnj7lf+5qIQiTSzRnfkEpdxxgU0LAZG7OSxjiHkVD2gFaZ1GjKhIedce7dFUwac8qA8Ut250wwH7O4rKHFECWEhhPfyyNNFFWeFrcIjCB9QkpXuz0U80DXFirexggv6bCvxlzrpYL2A02HykHogeIIum14ATyzZnKSfKNZqYUHkFr6qN2/mPO1WK01C9CpwXcl3fLEficn+qMiFNH5a/JFJBAF2ZZWJ5EP8mGzPCF9CDlr0z0YHruP+6bAUG47CNw5yDdR0WDTjq/DqDE8W+/fc6iTB4r9945YbHjR76ZqoOFAkp3KnRniRLdWK5iKvLCCH/Jf9vzHnX4LfdHlAiEucOADd6aaTJnMDTB0DnLoW9pvA/TvJPoH2GYOwUyBgDkGv7VLqRPzjz9nIWylnnWqIlm7L9YRAuucHIleKaTQCeUrXP0Wnyp2nmBxzeDiVOPsap6l6MYLHO4xg8HBAK3J1dgvBpIjcYDKZexJV5mf8c0hpw5ODKTwdkKCeeTezcPXh/9nI/FlRcIYy8sH3nKCQ0EEucVi+uinLNXGTmZXSuB5jYC2k1R6X8FYDLSs7G3qg+Wa30/SZZVsN+vbIWPDRqs9HMz/V2eXRrxClGwzMRZTnpwuqrD1GTjLUluOf9uPygJGxe+/EB6Ak5UCCsCWe2GLD5iZX8ywqGyaP9CGKOOsQ504tSVjAMPPpKo7Ex8LT3xYdh4QReijfasLvMKd8/bu689y+WY+S8IO9LXV7KYzmOOycnb7imsjeiBPCZgNd2Hd2fLIQOaLorPkKjFZcGRaNO6lp+pBPTMvw9QIbYuQZBlhu48VmV3i/3Y0m71BChUWR3cdNSS4D96YC5J0Y7ZFqMHBW6G9p9pf1EMvsoq2dzX2wSvNYXqdP47zyePLrk+nreb97cBNao7U34lHDXeFQ+HqT8XvcE26g42SyQZmHFRlH2UZ0kohpcgm7Li2wAo0IHMre/0XfRV0HtarB6og11KC3Z7/RUcqKzEPA7ZEJQgZNgBZE02MFT702HN67p516Nvqkm0Gjx83wQdQMeqxlml8LDK0V5SdTdnatEK7C+bhiQ3CLRBupVuTeGYhJY/BbrqiE1SY1vdXZ2SFuvNbcrI6ErGJV8/qH1acDEtu58Cm9IYXlR4R//8FS+sjKjiIPcuzVQ+9bV25MODrRYTzxFJYbLhp2Um/HKOncgLdKHj7tOrMZfxR6CrV1qRAGh+vD5dMMDkqvh3RtFI8M/B+95gOm4879zLjARkfVycAOqjJdoBfgWjWNsJnafTkmc7B3nIQv/Doeol9zaGW/DlpeEHHLSCVAFpPcoRFbXqIB0NIfCnsKcK8GmaNVe1S1WmDjR9kV2WjYdDpu3d+gX3edjZ363f9jQEbUhFXtuRXOQv+gmYCubqBrqUoagUdP7xj0HIFEZg93/KZ2CrZfN9t0A6WcpUJBI5WLyoLnqf11jJxzi7XP7icTGifXh8HPdPwOvmb7A1BFcfY2H1yrgpQ9LL1WPc8f4dqfuE91BNq8DtcEql3/06rGk4gsNyWI77GnH9IKwUsAFlrpUmA3zzUPojorig8/2Cbd3TjsCKM9wxliCLyKPngKsM1KFkqM6bMFtyxYYrU2eewcxYM6RkLIzuCbt2tjjkrWkSVoIS5lGaeH9ACsgsCD8uBJTg2FG+jOXwTTSCvGIWOiSPmrIKKcqEISVvUcMWhHEeUKjXTMdtBmPl8s4WipwTYa2j7rmaa0RNf7IXAOT77NGep/q0h0KdWRo5UPERTufgAqHgtum1dZEPq6OH8ILA+nokd8MXPhCko+zgkNqNlrLQew5ugiVBI+TSaF0+Nh/0lIpsCoBQWlDacVD+Vx3x3aSXTbkp6URafBo7r4W0YMJYL0MnwFM5mzSBvH459mHAZ0yzT09dEXgjVW9/ggg2LxRO6yGo5FTpGQS5EwMSjG3crtd3U4X4CO+KX5W46TC5B/X/DpEipFhWLaE6rpYO0r44KwsS9Ge9H2dfFY3QNvXA1sWHN6WR25HgQ091u/FmxcmTXpvXerH0b5xRi1MwmGmrK4ZAT1TapoD8+smzXuW4xfFWkVDOL7zk9xNtB53A3+dJrIzc5OTB601UXSFtQkX3hWaSnhB0fIWaxp9w7vGQDYtDAeTTDigrLMhVNfLUpJcIxhrMjO0Amicb+Ubauev6gApJbByzVQRTWq047GGRSYgxukHnlk5+xWTYTi31cQQCJ9ILZRJ3tV05M1AIgNeeDW2H8IBJqkzSl9nnKSajGYOD7eMyjHHWbG4SEV8CvAH8Iew6SodPSlX4spOyb4O8XdYQ2bne98jMMolgBIbc8j1VfPhmdPcqVcmf5qMjZcC2VzGSMF9s4863hYPVGq86Huy5cmg6zBz+qDU3yje9vmEr3yJ6kZhF5z8UdlkJdjq/581O9VuCR2B3lyEAfQoUZot9HdVILawreyRxAy11JlpE3UoO/fi5/5omkUs0A7Gvb5+bsteFVIW+9l+qR2dINow47smAidv0bLLEr/yqKcUanjvixyzAQCM5CVzq0r7rDR9M7wjLxBq9eBWRVmyK9TfSJqXHjL8T3l8phqzWGZrkRC5oiPO6C5Wf59fFDP+ituUaiEqytebX0Feyu7U5Leql5gBMTdDPsmK7KUOyA5TuWxjGc7dN7kJKEYpro0VWRhjMArMIGbutu6vN2OSHb6nvd508S4Q34uCRKu96bSAD7YHASNVhzXv8N8jroYf5Y7E9s4wTpkvo3BZkkWqpF0M1vka3jjUC/JuZvw9V8avX+D9bciICl12vr/bQJxDe+TN9MQwDJwOe5HRWZKtCtH/1/2brHVDE381FF3JIILjZf20UTFL4MLwmZtFv3M88Bv1x6hEyoaAlZ5p5QEWzlw8bJBt8orARhiododtduYtJBSF7octT9JzbeKdozaif0LBWL/u9RjbeVNLZ8UV44Ye6Sz56Vn8QlwftWL01WoPryii3ZZ930Zx6Ins/HGvGQmHAD+2qvuKQAs8Y6ublb+Dvhp3Y2NNMjsuzOvb6m4YtkPzbhlctKadex8tBQuo0zhmSxfDIZm5VnEDdG2vZ6kcykYFxgAz3wrkVyXQnwxyQIeYMIHQYT+257jBWD0yJIiC3PqmohMzTC/65XVgSsowG2kgnlR7pYY18nBQ8aVfJ64D79rH2pymM4xMU1Zk/OS14XiDcldhO0c0RhQxiPSY72XYxpiaKVYmzOcEvI1PzQa7+LVZ6pBIwn8ffWvhqa38b3IskTs4RBkYs9i+i9/AqdAQg2IOeWv2fuo5tEcFyefI9nATJXQchbBEQO2Cj3kaBe2X+81o97B22kYSwjOkgZybf53qZFQ6p/N0dL/VnuL1cYTGi8k6rMpkKGx4j+Mc/fcHUVNXTKhyO10FkvHiN+qSbJGepJ/aLXoLZ8RET0Bshv/4hAQgzeS7yl0n74cedqdnmAeHmQ2CyXvMM0MWpEvA2ezZIKU+WvUSaGpTt1kvMloerqnqxHLfT01Yh2n3iD29EWnrQsyjedi1I5SUgvQKBM9G+oAai15cO1con2QFz3UK7w7ZgzM+vPmbk2QqR87fzlbdTSAhrLXzqVfLnWBA/4+5aC+0BRMZ6iX9lH3QXtKU9D01K3HprdilL456y5lsl38VQaMbz9hk0LgquziMY01Znz2WE4ClHG9cF/e7stVmn89oNFUE9NZ1RAc97KzDEWHLoKwlCG6L20/2Gj7/M6PDhsvhY+FMzYRg+v/0jo2gPT0UTCfaLBDRVvKQgUSYPMG1dr6ox7ohepBUS0msHq/V7A6Y9WfKDgSLatqTzwhOXnuXAoFc1LsdlV/Nv7XHqg5TAohZGa1mOn44SyY1fyPMCxL1QmxvhBC7mxDyj9DUnBpbjdAzrBW0mUzZ51brDVW3f0A8oKL6FYBf0mwK6YxDMJogq94OPgpZyKHKBYvJXMfs6u0pYnEn/jPeTVQMK6uY9Egww5setjqwdQmwi1ea0/uoNw7QKPorCWZohFt4VB+HUy/ObjCDdxryIg/y0wXGMwFyftSyf0v/ESOVaUNOHg1aA0SQ0KOwx/oqBneMvSoxZc7SqvQaHcx3ZLg7I0FQgQ9799KuVGTfGNgWvzIMnHqMNnCyCLJMNoNQK9XA4Wkq+6tVuCUREehKj+szE6KlaSwgAPfb6JeGqIyBrjJK/wNw2yPaYB9wHia3A56M5r4OplAvdVjO1vrsc4I8LAy1zqqpo0yM1hfixHeLNDG6ufXaX/4mWxYpqL3hBHpPbnox49P3jj/wGgdZFaJe1JTer036xd0Xak5qCI6SV86xqAdAChv6sj7ESw0SU7w0leCi/08lfYfucRQHdzjO3JkA7lvHw0ouMCSCweP+ms5HlStT1HLlgQ/pkLQ0HiDkuoPtTY6fDW0UPlH3ebKJKJsiIlEwAnWQ1ExfQhfs1IRdbEO6sgyC7u2YqSye9WFoH3s0+d4P2X78UPcUsRitbiSflMds3+5ixk47wEAbwHOouv3l0AUb9zZIP32hh+8n3fJx3LXT4wqErJXRmufydvyJuKW5IkA+rD7B5y3hJGUFrf+je8x2WEZ93MMZZjKF3R4hY4E82J7y0z9znWEXqtnGce0dejOBkrf6CbP1VCh4ixhRvmOXO9yA0A2XQqeWYNfk1eUkRWlybRDBiE5SOOtjudxOpqC6Hv0XRqdL58/dsrEItVoppvb13l9MrZRKzOe/vtw9JP9aAkOa7ra6MbT/3YE4LlEJ5ticKWKe+rOGibg+N20Vx6Vg7J3byZG9+hIpULnZWH4Tq3LmlMA+oUfgAbbzPl3twbDuQozSElI95KSsXaBWevUxIWPQdY+4eolMlTtLwn+51SP6BWFEiioYy+r2Rza4OqKJPMbx7t0CZCtpMKxYQ5JCowbAH7J4Y3Eh3C04j1H/2a7qH3cVo01mg0KjVVR59qENmLLCnQ4LNMS3i2XshEK7QAIvi4D+egZPpMUywog3s+tqRiaGXIEMFp3rd3TuvLXVT9tpJGxjgQLGMKXmGL1MVjoN97by2NaOn0JoIbOQqeBIHTVbBYNON5DD3XP+rStPIfVbuHd+90TJpGh8BlfV0dLneK2wDMnndVGVvQLhvaQxu6sL3XsvtxmQzeFWUSHLeAlmTc9yNQKkXtOJWS9faewS8yotiXdJQ6EI1vpVOHgh46gljSllVDRx9qlH7i2QFU/dKpaQEbpAFUBI/eSUGbpgT2ORGcUGXXDWjQJQo+nCkQVnIMRUCP367os5Iw4Rb3LDvOi+/mwcBozzUa4WkjVcSIURKO3RTFCiY9j3O6C5MBS6Y0WbBooC0nOzhKxL8xMIIaM/tnyEzIdlABrz3f9XlCiQ0hh+C7/bNp14eUvnjcHWjBOSw8E7BjzeXkRQkpIuZSOriwZ8PiOLZxCkXFOQ4hbXa4Tu69lccJ9Hd0F1lxkg5QnAhhfx5WdcTkBH3SibBUMCLPb/cYypz6s4GGDMV5smYibldp//j9gbCEhqanpxLsoexOMik4SOt879z21iz+8V3wgG8CicQsmxcsqCc5QUqOZhnpO4qAFgzHF+noxN835P4xf5EsOcPvYWwtzK3WEYVGy5tuvxE5WZB246SGIDgeC4sMge0B4p70Tse4b6NjlPHW+90GmqnySqY83r0ilaew46qmwi4RzmOcPehbn4YPCoISjQ44RURV++dfU53vcKhkSj6cWuh75tdSSUNMysFwoP+lN2gGTwxOfrha9wWxDPpimhEBVrt6dcBIvdoUbCLTDQDZuUOVVhZP4sATqq8z7Ai0STnGxzKmAHG+3I+/tvrDN/OOTHwR6W5aWSRj+M5wmS5hfdvimlus2z4pE6RV+l6scSEX3XjFUVgbSuuufln4qZfmgBxNvIZmkPtMh4WHAtuqRVdgDOLksqdhjqc9jrNVpRsYL4L5fXaKhNXYNJfTorxbaoSpoqj6ZEp05xsc4y4Qryx7BRs3iYvuHRbCUsiCPmmGdUPXDn6H7woEjiz1YeriH6NPF5au5aVrtcw0DvEgLLKMuVq6QvzE1mu+x9AFhhIEE3jVvzGWs7x+IBGJ2hfG8Kb57q5sDsPmddrc0s2doavGt3j59SpKkbETAVxcSwwHbpAEsYTNPM1KhVl7EPpQp+gNotyPx7hI11xG47CrYE7+4xlCFpaDwvf9FWescjE9qNrcgCXvSeme0GAOo6QjsttWQcRguwWZb6OG1VPN2xZcfyUeEGLHhPkrziDDf4SHNaCcXXJ9CtFdyRMVueZNWqaoSKhpFI91MMLSXju3pGbSzJlM8FPf/oxZbRADvlZZCyb8fbb4mQVBZZ3GWV4hj4PCrLA1qQvEqs9XLsRnoal9WaSQhWRzLJmCurnGGRc6wxyAAejp0pAR70k0M8R+ziXphTbSz5jU2xp2cFe1EhegrqPqjFAtYWbYwsm9X969oYf76RSVpD5DfI8iDfFILBkfvnZaZtHikQ2tfNY1T0QOYafZ+dfiQjWZxqrDxXDWbc/jYZSbOzpgJ0HvC9wodOgTk5d5d9dmNrnM0LH8bvtI4zgktUZdf/DkYM10EF8yMhbFqvpMTi+TaLBUNd9aLSzSGAqu41xsKxsEYHFPhxozYZMPCafc4U5t8Ja7k34czb9pTsN2JFnwl8AmZSpI39KzBoEcD8fz0CAcio2KlaDIhPF8V0HkEbwc2c0mkpBazhOMI1d4cxnKG15nlJ+haP4D9g/H1z7jIEHS7enL9st+r19iJpqLFuJiKD2NT7LXyBzaAcFxIJ/fo4roeZSvHUyfgqUjSVcPiszEAuk4Fgqjxih+ln6TZW8b5sbDIvrB1Ul++c1B63XbFgHdVJTaRPzIXeh5f5u+QYvfa7pHyQV0ZUIv4SnfFMvTC0g0/fdaaBd9rcpxu/CBpbobKZgCIyVRDZGdPlZs8UGyu7+Hxb64E/k0YIIyG0d7ZSIcU1dOwyAQt25Ow5B4W/oUhgU+Gf+qB/Eqf+V11+GylEkiyGag2sSabnAwgaqTr549u7USX8FH6EnKLv1g9jl2zIU7C6GM3aeDn8kP+9aBM0Agrl165RV4/UHaXPnrBjs3YOHlrMK9jziNkwwt6+rC5FPPvSm2uVuOQouD4+Rk/8X2VoT+8bijB9PNpfsOsNhiSOVgntu7dzfzJItraFExs2ylPt0vanTgZJP3SIxPvZsgaDSBNmxIh0KPLS+EZkJ1Xy0gY8WVOZDbYF9v0GJta6+GUy7ek8lisYumJ1nyw90NF5n7L6H1aFMYqA/WI2COJA7pWaf9Ugf5pniETIJNyNXtonwZOLeCG380p2a2m5Fs4WDJIbVCtkJ77ah+h3HMvJJ0fzW8OXfnZDuzbWB935lP5zr2+vOc7CL44LjNt8p2deJJKd+d8n1mwKwxWxUjkxJRVlpIqwq1a+Sfeu1oNGDaOXyS/LVoiWAi4/RFFK77j8sVBWyTeqc13DCYWKdEbHTgEcIdtBewm3fvU99V8J4gYLJijdis2O/D+3FBz8kG/SwAXwjzKgO1TmXuA3syLPxxfnEUxttkUPpzQJgAzcN6o79tpHr3QWX3TVy4USKZJPX/G7/sFv7TB2RKaM9LvG8518UTl/oNK6/mqMpSOqsv0xRVzNjumgamqz/e3LG3e1lkrW5SquqlrDJIrN90AProjO2hsva2vAv1ZNPbHVfvH6K8KnMmDbXcZImS+YAXafdXLVILS/Q0MSKuRaLPQABT6AsH1SpBlkiSLXyhT/gT5IbfD6Z1Jx0n7l33o2uGW4lgd8BRn8WUeEHBHEn2SCXVQwlREQtvN7iSC2y8qSngF4ytc3vgOucrGccauebyUn9sdKmkhMom+XHRGLg4yr7NW/ZAq8UDCTjimw0unj204NYoihtZTNdXwgmCpqzA6Y4a3S/braI7FEXELgpjVSnB+dqkyFq3Tny2G8lAz1OtN0TZdE3wgbqL8XtsE5Ut1NayTqmPNmEhJVC0f6ZfMop0HP5VawTxA+lq1XoeRAoIGH0ojuV+9O13sh2V2zoxj5jVyNGuZDtqZVlEeSIRI05PVi7nZfKw+EuT5YTkdX/qnx/AmQXABJR8mEbt5A8Oab2RqMdG+P0zvDI0gODnGDSO2w4ZOrD1zi5LnYaIljibbOMhpDWcwsd6Ry5eUmiLQ24OpaErO6a3/sYLybm9xOJLqfn7DNg/5SKBxEfKNyyUYP4KtkSMQI5Xo7dHcIhqH4l3CRK/gB7WtFU6bj0mReNJIitL8grYbUyZpqDuMDT5s5WQsWjOEmRSbMiH7HIkEIPvRu0WxMnRCJKjGFWdlKGqK96T7jlsEHCjsPjk/9VEQ4W5qB2tRAFGJ5YGgbmyYxqxGxduvkNdd3IZKcIbvtEtH4X7aHeyV4Dcn4wkEzUNRRhISM51Av5I1mwi2lj3DP8d6K9iFzNVDCSb+eb9pBu+SEqYrvFC8WKSi8OcZDj50KV871120hgz6n6OZy1KOh8OzKNuCKFt9mVlUfJKzD9gcuL53q+oTHGGIKFz4+4/zLC13N3l3y4Fn9dzM02uGyBGoJXmF3jrwW9OguOsh1FVykE1suM6kC/e005VRngkgcn29tixbfGSx7k8JzTId+5wTXE1HgKXCtGlwA7L6FxS+RUGGP2az1Em91D7THACjjqlVdoDOltQ7Yb4S8n4kG/m/CvtFfQB0e/e/JMgICLGKds6v5THENB7WYOdJ0P5s3GQzdbeXjUAG5Y2WCUBs5LZ6xDZzv1L7jfUHqBbmnHW7U4g+UTYB/tW7B0Ya0JAbpzWFSoVQH6CbY6q9fM8ccelwWdxeWdjZm+TcmBAHpje+emw8T5mUgl7Omvks7D2xk04/HjynzVyBN2dI3dBgxTkB1keL9tMN0WgyjY0ddKI8pigHP9lOa8hb7F2bZIa/FqS6JJPPHnlyPbVl+weIG7j4ocmWH/OkvaT4qtcbnafk2ocwOkjSqUob66ehit1UDMwKXreD2R92MZugTHNe/PWAZesANg9eBbm2p+4kqK52j8MW3AhqaffDN+kK195DUM4FLVYm8BQhOF+OWoM5tTD8LImCNRenutbU6qRxpaMDXCBU37/K3Y7eobcg/IaZaBuw44FteI67Hdgufk5VqCDjlK7jDBUtVq07hpPI9ymWW/m3nNLQlusNGDSBNYXOUBDRWNnHira/1eo9GEwVgpXn2tG1PUUxT15p/fbfGXCvpsj0QlzwErC0ge/Oqlsh7E0QhpqDAcvlBJOiXDD/bv01SkM269rmghWHJPUbmpq4trj7H6cCMXMIwWgOLaTXR0w3tamzJpReC8FXDNwkxSCbmg/ag17JdPyptz7mR3k6KvXor6tFCfEv85TW7CDWLEap1AC12Ym+LK9/CxdKPnXz9Qz4xNXGn3sG1wAfthifQfjDyiCnLo2uhuMzI9yKxH4PUTt52mReMLmnHFrrLpDYcPC+cU7ge55guYhGv/ANB92YzoXrI+Hs6gdXnnfE8GGhfydGwvKBKCtpDecGnu41Mz28j9/LTVtSV9WZEoxANMgPGo4BDbY2p69ixYGQWATdyg9TRDAK7f/Lrlubat60yuVZ9wcwqZ7NBP71mX6NEgdvfK1EgMnkZzsDQl/wWDHdAoOYCo4pKwY5I/V26cKTO4aMYcV/YDdgglOtas2KtIXBJAcgotsV4YfF+CDN4T5WdX808VdXh3/UXLrAdcMDF3QIXj1HyUHIOkXBH7DXICbJt9eNiowRXiuB0d1J/FqjPFe2IlNdXnwFwpRusB5PLSv0Lk/AdI1gQmao8wwLmnoh/L9riMbMMsWAOI+5B71d+lGTKlxx4hQn4ixRfedyZUUsRcpGrgAS1XqCKzggl0/LFuyQpe9BsgvZGkEHQ4ELkl6bcLtiHZ+7uFxmRjnV7v8PP1Whug1igIT3OTMnmb/dGJPuGKY5fRdvWoatxfNU3ABi+fY7eHiPqC0gQDpAC19twVfWBtBur+ST+y7fzmSE5Q0C3mcp8/31XIdqm7sEZJHtFnXBgaTyG+fWRGAY70K10IBvKH2TE6IMzm1k92/Cn2payTupKTtojgP3uaWIgFVgV0lD0WGR0PanqiKtrBFwqznvb/rz2PgpSjWd2BESLQpxY+6tmKXZnjvY9xfR12CQ8o/aKz1t+XxCSzy0uE5f/kaFUCrwxjL8gT7SEUJshp//5/yvPFJHgJlgsvXp+gRQCSzz+vS6rl3BhMsbj/HzwJYz8GsWppOQDGVswlOHEaFE/qhImhDrt2DUfNxtt21GW7KwJRn9/mtYIjlnnwgESPEpwoLyTru3SsVGzRxnZG6x+BiseUs57lTdb3H8KG7UPeH1SSjy9wZHELnar9x5cOtOR7lOvyjWm4Ab18Q+qoMxxLCFit0V8SmOu7AU8XGY3eSXb6Ly+kaQmDkRlOstgmcj+rD34KNz7LTvLL0O1Z9J/nCjp+1flOFgtbd7Yg0t5eNrPuppxYxJfSpnJRNL4S3YTffnV+x+zVsuioseET/On2wNi/TnL2rAQIKswi7Er3Sv48D/+PLsa2WJOSk6DqcCLmusILDiz0FwKEhMewrxtNyM2IAE0/6hiopIQoUgC6U8CLirhWbfVibSnCGZlF5uywIcaUlcEaYP/evokbi1NSquO62XNnWR4+fB3M1N7LaI5pwdHYOKEjg9OaSiTtEDypKGOVxZhdQS0jEvZ46foNS4SBpwZfPn60p6pQldNUmimhWeU5LUnEpZYjPJU6hmAsh4AKaLFfJANrZ9ou428yoEIFuiY9UgOYkqtSUocWxyijxK+NTtuDdbh7NJcyLIl6CUBWQjZiL34Bk0Qe3vmT9tpIKus3r5CvEdEu5Va2Wxm8CQJT9bESzuFBeH0QIRybKFAUVqNa9tCXukd1jwLXYKWsuMuFda8R1UjVG2cvAZ+R3lBV+nLksL4Ti6lubX3hKFcSyFsG5rK9pJt5nlSGIkBLP/HFqLL/KX0S96NdOo4CS+GYPBk+lBZxz6Yie12vvUj8l4t1ik/5PmvbLOTPCcaoPeZ7APUQIKIcxcNUDin3R1okbeAUGwt7Ja3G0ntQokBhlajisyXeqbfPLrTTKpTauclKp+DGdyBsbzFHEYtIqZnlLe5wjluF/UID6EgwWPGj0FVKM59Jom3+0Y1QTb+IKqHZv/0FIEEuVItlJHSixdza2w0UN80Hyc/eUGv6SBybC/EEs9cOcLBR1eeQXXe7p7hfIhtxxBrGhk9n7jom/4LXF125WzPmMCUiNyE8iO7sVSmRf/iSNFBveZWGPeCirfJ8a43fk5jCfA3NPEJyMAamu3Q5im0DKo8aonWXtye9iE8vraixlVTAGSXFMjP3+XiOE9jrnXTDzARnt7+9gvHctQpaAI0za6N7bq9R1lb55jILwmx4Ih4OA0K1/Xx7B9jytPFBRhEO8xqXLhxotsIRjnGRvnkMK/KJ1YhE9T2mNmclLYgMSn+7dzik8BzoHt+EcXstV8yNpTspqsnS96ATq3A66NbF449w9JqViBt4gWi7yVzt3kR4XSJ8iEB5anMqG+EsSyrMQVv0sMeEysGx+yYs6G2xPJw3zqTq4RzDQXPhYra/VMlt7E8zzl4D7L3HS3kkWf4ZkmFmnjcENPQdkmohl6p/gqkOg+8McyzNxxb5Fl19DsSr3MTuSMqhSKDn95ibzYCEdrZXJiKaqu7BFBuju+jSObOPchog2IsE/u/3U/UK2mntvSnD0qNkPYoRTskBnLJ3NJamL0V4sEbryX8NMr7MKMJ0+h2+xMKY4KERpvUrd0c6ABXWHqLdY1QTugC/5dhdoLy3+KwgG5FnL0MZw6qvOvHkKQRoQrcKLuwUld15s05QxurH67A9eAr02a/vUWNBIgP6vOa69ZZuZKElWttIerRDGIAkZ54fw7HBctSZtfspPxaliwbOEH/Laxot3ZQonzvXknSVodzZHA1Jw7BcNRsYvl+KJ0Y6pMRPpIbaN/QSuHtnjUoej+vlVhq5021xMUPKxCK/D8rSRbOmduHG85/JrIimgo5wXWP83lLvRaxwCxeTGVt44fTUqsfUARmQcS3f5DbHR9SZ4nJYIEvcCjIqLezJ3I6S7xBop57j3ZyMQX0Xxr5mc6IUmrlOXM9fJG5iDZQQ9rWsGZ0Y26GzTAEsD6pjPuDa1XAT1MRpxyZ8zN53sl1YEV0E0EHvZqcnBnqMTXRh6zC9PwDXEk3OHs2zLLIjBhY5+7lDxp1X0qcm8XtWorat33mUx+kEDDgaDUdpclQq/ZM6mMYoF433nKbCKDxCozugSPVaRjNPosMDy8FujvIJSb763XuBGBIYLS9x+HZhYiUa9xod0xKV9aRt7yczWWlLgfK8qn4fULHMBSP48m/wTWfDBdTH8uDAKt5WM033+2bCpxDhmZtE+d7XP65yBTOf9/EWaCG+Gs9/5kVbWS0JlfoDH6Si2tVCzCRGfV0XZAUWfXOMJ5F9dkMagbwaeqVqqbVONDQGg8zID5MUV7IkazdAz4JLOXsn1RuZnoZNIGV2Na15+dRKYUAmXFmkWBJpPMBwT8N4bd8VZwBnhm3WzH9S0sbpoP0sgf2OmPvQ6smMyfkVK+OLjXYubmtioAhdwDb5/pLRg3PGwfHEz6v9OOe4AK8iw2cma49tV44In8Rc9jGcqSQlFXPdlC8366ke4U/ITFy0/SQBl1vWvGk40KycwWGaLf8cCtEi/4X2W8961i6lYnpfNQhGcQyC8s2oIOW+Pw545Thq3ZBEyNC8YDr/pzCEmBI8U3A4IiQJoHiD9kUMNd8wfzysC2Kqc4OGeWYsJxmDev4Jn4HV+vqpgN6xxSEMABhRMdTteHiJAgnQEX9BR2V1sNqh5EcMvQNYYa5+bblQn7Rli1UFCtQkP6ECmGkxmPNkg2CGS2mmf0/WEuTZSyPMtbbrnftPgleOmJ3jSm0m1EU9fQHQo1NZti+KczpJ8mSYIVtXzXh4rNJcL3Fm7Bbftpjmj5UnuDpPk8HvqKOj2DGJyk4R0Md1x7umiH0DTOXaLwO0EI94k7n6R8nfqiwekgUQZ1rRek0HViM5YN0JLWp4f4NRE8ErcGNSHZd58+9Kx8lmkc9ogfQmX0rX1kB8QQzNbH+eVDee0jOQNUgQcew3y+0QbifXrtLHXDIxsqsej41Kz7vfcQRE1zUnY2phYNILK8a657zyHNMzPiRhxs28s1JX2kiCMEloubOXnc8BzU+n7LM9wztf63eFWN/eWHXVivSdCWg5DfWsk2CF8aFJrOP277QEPdkWlOlewCVEkLjyd5wUn9ZzaKOJKnDQDLfliiRLTKlU8TOeQj8jOU8FfpM9tayJTDpxw6sVlZuJRAILfxn+QAGIB/W1FGDjuuVu62hFDBdvzVSfge95Ebf9pclp0GrpV3S+gwBWn5J7aGiim/fRyIN7YVVXJsnAnVeq90vDdAV0XearTqjT2Ck/AMkBW6T/ls/6VUVnFWs01wxkahKR0tRwyLRKgHefm3RWie/pTVQpUMZw+/7ozQSW+7vuZd8lsvT1iX5rwlpiaFnOnDbHsr1As6vLETd5HVbcBCGbJHcS7ax9Byd50jdYyagUtjAaHYX8ryyuR/bDkw1o4j8+hXMfbzy+CVmgrfRDyl4dn+5LxrqRAXLoDKpQREAHqdLSsVSJh1s8KnZ/SsUVq27cq+O6LMSBmhT4X3E750rmWwCsoCre6bT//oFWYALjp2SbcxnULBaTvnYDHtfEbO1m/3c9nJk8ZO5KHQTV88ivTWN/S2EXwmisTPdcupMrvI8e48QZdkZu9WHyKron7MKhGFJw6Z0KZ3tleVrvvJo89siUwByPY+Hs4gkKPBQbLQOaedcv/xeM+Ih8rl1eHEC/C65xWVciToVqSGp9HfbhVzFSrO6kBnv7mJwnRLvMEwqiNankVdJJMw4icU3lKyw/ecNSWIUddqlbThYMiq8nHjRRufs+28cq0OI9zhpvxFvFgSZE/eAYvm0x+9lZO+EH9NkBngaqU1NMYhdombNuy3awUN9p0mJQ//e9L65YbShgoc+ZUlNy+c6F6gDEHXV0JrzevPIZFAe2RyRa2dNqzLvihAAMCszYueqszzXRkSyobx5+LTLK2V3lfg3wbS9DzP3QW7VHdHbjZcttQRvtjrGveJnNn2DE2ZDIbvkCrT0H8RzbGDdmIq4P1ey+hoY/W6NuZKOz4dv4HUNznxdKV1Wf3MvqUv35r2jTKvpPWBUWNm5fytX/QJwp6qkIOsSx7Y67BSCbCDVLM8/VcMG+T0j+INrgL9sfT1ICtACH8BI0G6ViUZPVzzCmQHW2oVIwZjAoFl6+meO/pD8teO1E+1y03mCpYfW9S8qhtH2GhlFlebPf4NbezVv9xbXKWz0xezRNQWqUqtYRTUbuzK7KTvjG4rQHfzBpVmK4wDLnSIwdSzTSk1fPNeY0WOpPZTLlvQ59xwgfFrb326vT2hS1JAZ9E6sujFtKTiJ7bxI6o4cBhDaX+adXREThhR+MwA4TqD7rga/o9iY7d6TVRe14CS2S3iSQsD0R6ApnhG/2Wa0A0AY2NtWTjmabdKU+KgIRDP9RQYVjXiF1qC+xyNVG03I9vpmEpY/G/zC4nLOKgXAZ/uTikHI9Afbkhfgfgo9arWbix5eH7WUo9RQygDzwCnVSjbXc7MihEufVj6WGbK963pw8VjY3RS8IH1cy2yZbIcKLO5CgAUcXJfF2+McnDLKtXxyZaf7SPA6KJq+zF2NHyfoeTOwHhGqNcnHVr1hT73pcoyXyfvCYBnG1Bp/aR9t8hoI7CXM3UZOisWGA1SHZ2jf7k9GlRnp3mF/c1AV+JjvUsnZrsybEOQJg/dn/9eJkyykQHjbF56zgcPX6DdMG03WKUMlYz+uOZ+5DZy9E9MZOZ9GMoLFdrIPPQQLjv+GlCMpoyHPXkzIODjHAID2PrnaRpqWVHh0rnieDILKq+Emrd5RnjgE9pDUXWTmHaKuqqYlcgEz4zbi46dbWrAAFBjsQq1rLHIiPJEcwFLCOY4JNlXRXQJqCUKXk2d1RSBGzDP6HDSpo863BhVRFFF6uIpjQV7j5ebFe3UkkO/+coIo2BTAcgBqOtQ134s9a4QJvofuqBYMGOBMsWZ+sn/2AOxDx6SfAnDFGw==";const Yse=Uint8Array.from(atob(hG),n=>n.charCodeAt(0));function uG(n,e,t){if(e.getQueryParameter(n,e.QUERY_RESULT_AVAILABLE)){const r=e.getQueryParameter(n,e.QUERY_RESULT)/1e6;t.lastTime=r}else setTimeout(()=>{uG(n,e,t)},1)}class dG extends Js{constructor(e,t,i=512,s=512){super(),this.width=i,this.height=s,this.clear=!0,this.camera=t,this.scene=e,this.autosetGamma=!0,this.configuration=new Proxy({aoSamples:16,aoRadius:5,denoiseSamples:8,denoiseRadius:12,distanceFalloff:1,intensity:5,denoiseIterations:2,renderMode:0,color:new ye(0,0,0),gammaCorrection:!0,logarithmicDepthBuffer:!1,screenSpaceRadius:!1,halfRes:!1,depthAwareUpsampling:!0,colorMultiply:!0,transparencyAware:!1,accumulate:!1},{set:(r,o,a)=>{const c=r[o];return r[o]=a,a.equals?a.equals(c)||this.firstFrame():c!==a&&this.firstFrame(),o==="aoSamples"&&c!==a&&this.configureAOPass(this.configuration.logarithmicDepthBuffer),o==="denoiseSamples"&&c!==a&&this.configureDenoisePass(this.configuration.logarithmicDepthBuffer),o==="halfRes"&&c!==a&&(this.configureAOPass(this.configuration.logarithmicDepthBuffer),this.configureHalfResTargets(),this.configureEffectCompositer(this.configuration.logarithmicDepthBuffer),this.setSize(this.width,this.height)),o==="depthAwareUpsampling"&&c!==a&&this.configureEffectCompositer(this.configuration.logarithmicDepthBuffer),o==="gammaCorrection"&&(this.autosetGamma=!1),o==="transparencyAware"&&c!==a&&(this.autoDetectTransparency=!1,this.configureTransparencyTarget()),!0}}),this.samples=[],this.samplesDenoise=[],this.autoDetectTransparency=!0,this.frames=0,this.lastViewMatrix=new Ce,this.lastProjectionMatrix=new Ce,this.configureEffectCompositer(this.configuration.logarithmicDepthBuffer),this.configureSampleDependentPasses(),this.configureHalfResTargets(),this.detectTransparency(),this.configureTransparencyTarget(),this.copyQuad=new Su(new Et({uniforms:{tDiffuse:{value:null}},depthWrite:!1,vertexShader:`
            varying vec2 vUv;
            void main() {
                vUv = uv;
                gl_Position = vec4(position, 1);
            }
            `,fragmentShader:`
            uniform sampler2D tDiffuse;
            varying vec2 vUv;
            void main() {
                gl_FragColor = texture2D(tDiffuse, vUv);
            }
            `})),this.writeTargetInternal=new Zt(this.width,this.height,{minFilter:St,magFilter:St,depthBuffer:!1}),this.readTargetInternal=new Zt(this.width,this.height,{minFilter:St,magFilter:St,depthBuffer:!1}),this.outputTargetInternal=new Zt(this.width,this.height,{minFilter:St,magFilter:St,depthBuffer:!1}),this.accumulationRenderTarget=new Zt(this.width,this.height,{minFilter:St,magFilter:St,depthBuffer:!1,format:xi,type:sn,stencilBuffer:!1,depthBuffer:!1,alpha:!0}),this.accumulationQuad=new Su(new Et({uniforms:{frame:{value:0},tDiffuse:{value:null}},transparent:!0,opacity:1,vertexShader:`
             varying vec2 vUv;
             void main() {
                 vUv = uv;
                 gl_Position = vec4(position, 1);
             }`,fragmentShader:`
             uniform sampler2D tDiffuse;
             uniform float frame;
                varying vec2 vUv;
                void main() {
                    vec4 color = texture2D(tDiffuse, vUv);
                    gl_FragColor = vec4(color.rgb, 1.0 / (frame + 1.0));
                }
                `})),this.bluenoise=new io(Yse,128,128),this.bluenoise.colorSpace=is,this.bluenoise.wrapS=Lo,this.bluenoise.wrapT=Lo,this.bluenoise.minFilter=Nt,this.bluenoise.magFilter=Nt,this.bluenoise.needsUpdate=!0,this.lastTime=0,this.needsDepthTexture=!0,this.needsSwap=!0,this._r=new ie,this._c=new ye}configureHalfResTargets(){this.firstFrame(),this.configuration.halfRes?(this.depthDownsampleTarget=new h2(this.width/2,this.height/2,2),this.depthDownsampleTarget.texture[0].format=tc,this.depthDownsampleTarget.texture[0].type=Ji,this.depthDownsampleTarget.texture[0].minFilter=Nt,this.depthDownsampleTarget.texture[0].magFilter=Nt,this.depthDownsampleTarget.texture[0].depthBuffer=!1,this.depthDownsampleTarget.texture[1].format=xi,this.depthDownsampleTarget.texture[1].type=sn,this.depthDownsampleTarget.texture[1].minFilter=Nt,this.depthDownsampleTarget.texture[1].magFilter=Nt,this.depthDownsampleTarget.texture[1].depthBuffer=!1,this.depthDownsampleQuad=new Su(new Et(Xse))):(this.depthDownsampleTarget&&(this.depthDownsampleTarget.dispose(),this.depthDownsampleTarget=null),this.depthDownsampleQuad&&(this.depthDownsampleQuad.dispose(),this.depthDownsampleQuad=null))}detectTransparency(){if(this.autoDetectTransparency){let e=!1;this.scene.traverse(t=>{t.material&&t.material.transparent&&(e=!0)}),e&&(this.configuration.transparencyAware=!0)}}configureTransparencyTarget(){this.configuration.transparencyAware?(this.transparencyRenderTargetDWFalse=new Zt(this.width,this.height,{minFilter:St,magFilter:Nt,type:sn,format:xi}),this.transparencyRenderTargetDWTrue=new Zt(this.width,this.height,{minFilter:St,magFilter:Nt,type:sn,format:xi}),this.transparencyRenderTargetDWTrue.depthTexture=new Tp(this.width,this.height,ca),this.depthCopyPass=new Su(new Et({uniforms:{depthTexture:{value:this.depthTexture}},vertexShader:`
            varying vec2 vUv;
            void main() {
                vUv = uv;
                gl_Position = vec4(position, 1);
            }`,fragmentShader:`
            uniform sampler2D depthTexture;
            varying vec2 vUv;
            void main() {
               gl_FragDepth = texture2D(depthTexture, vUv).r + 0.00001;
               gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);
            }
            `}))):(this.transparencyRenderTargetDWFalse&&(this.transparencyRenderTargetDWFalse.dispose(),this.transparencyRenderTargetDWFalse=null),this.transparencyRenderTargetDWTrue&&(this.transparencyRenderTargetDWTrue.dispose(),this.transparencyRenderTargetDWTrue=null),this.depthCopyPass&&(this.depthCopyPass.dispose(),this.depthCopyPass=null))}renderTransparency(e){const t=this.scene.background,i=e.getClearColor(new ye),s=e.getClearAlpha(),r=new Map,o=e.autoClearDepth;this.scene.traverse(a=>{r.set(a,a.visible)}),this.scene.background=null,e.autoClearDepth=!1,e.setClearColor(new ye(0,0,0),0),this.depthCopyPass.material.uniforms.depthTexture.value=this.depthTexture,e.setRenderTarget(this.transparencyRenderTargetDWFalse),this.scene.traverse(a=>{a.material&&(a.visible=r.get(a)&&a.material.transparent&&!a.material.depthWrite&&!a.userData.treatAsOpaque)}),e.clear(!0,!0,!0),this.depthCopyPass.render(e),e.render(this.scene,this.camera),e.setRenderTarget(this.transparencyRenderTargetDWTrue),this.scene.traverse(a=>{a.material&&(a.visible=r.get(a)&&a.material.transparent&&a.material.depthWrite&&!a.userData.treatAsOpaque)}),e.clear(!0,!0,!0),this.depthCopyPass.render(e),e.render(this.scene,this.camera),this.scene.traverse(a=>{a.visible=r.get(a)}),e.setClearColor(i,s),this.scene.background=t,e.autoClearDepth=o}configureSampleDependentPasses(){this.configureAOPass(this.configuration.logarithmicDepthBuffer),this.configureDenoisePass(this.configuration.logarithmicDepthBuffer)}configureAOPass(e=!1){this.firstFrame(),this.samples=this.generateHemisphereSamples(this.configuration.aoSamples);const t={...jse};t.fragmentShader=t.fragmentShader.replace("16",this.configuration.aoSamples).replace("16.0",this.configuration.aoSamples+".0"),e&&(t.fragmentShader=`#define LOGDEPTH
`+t.fragmentShader),this.configuration.halfRes&&(t.fragmentShader=`#define HALFRES
`+t.fragmentShader),this.effectShaderQuad?(this.effectShaderQuad.material.dispose(),this.effectShaderQuad.material=new Et(t)):this.effectShaderQuad=new Su(new Et(t))}configureDenoisePass(e=!1){this.firstFrame(),this.samplesDenoise=this.generateDenoiseSamples(this.configuration.denoiseSamples,11);const t={...qse};t.fragmentShader=t.fragmentShader.replace("16",this.configuration.denoiseSamples),e&&(t.fragmentShader=`#define LOGDEPTH
`+t.fragmentShader),this.poissonBlurQuad?(this.poissonBlurQuad.material.dispose(),this.poissonBlurQuad.material=new Et(t)):this.poissonBlurQuad=new Su(new Et(t))}configureEffectCompositer(e=!1){this.firstFrame();const t={...Wse};e&&(t.fragmentShader=`#define LOGDEPTH
`+t.fragmentShader),this.configuration.halfRes&&this.configuration.depthAwareUpsampling&&(t.fragmentShader=`#define HALFRES
`+t.fragmentShader),this.effectCompositerQuad?(this.effectCompositerQuad.material.dispose(),this.effectCompositerQuad.material=new Et(t)):this.effectCompositerQuad=new Su(new Et(t))}generateHemisphereSamples(e){const t=[];for(let i=0;i<e;i++){const s=2.399963*i,r=Math.sqrt(i+.5)/Math.sqrt(e),o=r*Math.cos(s),a=r*Math.sin(s),c=Math.sqrt(1-(o*o+a*a));t.push(new w(o,a,c))}return t}generateDenoiseSamples(e,t){const i=2*Math.PI*t/e,s=1/e,r=s,o=[];let a=s,c=0;for(let l=0;l<e;l++)o.push(new ie(Math.cos(c),Math.sin(c)).multiplyScalar(Math.pow(a,.75))),a+=r,c+=i;return o}setSize(e,t){this.firstFrame(),this.width=e,this.height=t;const i=this.configuration.halfRes?.5:1;this.writeTargetInternal.setSize(e*i,t*i),this.readTargetInternal.setSize(e*i,t*i),this.accumulationRenderTarget.setSize(e*i,t*i),this.configuration.halfRes&&this.depthDownsampleTarget.setSize(e*i,t*i),this.configuration.transparencyAware&&(this.transparencyRenderTargetDWFalse.setSize(e,t),this.transparencyRenderTargetDWTrue.setSize(e,t)),this.outputTargetInternal.setSize(e,t)}setDepthTexture(e){this.depthTexture=e}firstFrame(){this.needsFrame=!0}render(e,t,i){const s=e.xr.enabled;e.xr.enabled=!1,e.capabilities.logarithmicDepthBuffer!==this.configuration.logarithmicDepthBuffer&&(this.configuration.logarithmicDepthBuffer=e.capabilities.logarithmicDepthBuffer,this.configureAOPass(this.configuration.logarithmicDepthBuffer),this.configureDenoisePass(this.configuration.logarithmicDepthBuffer),this.configureEffectCompositer(this.configuration.logarithmicDepthBuffer)),this.detectTransparency(),(t.texture.type!==this.outputTargetInternal.texture.type||t.texture.format!==this.outputTargetInternal.texture.format)&&(this.outputTargetInternal.texture.type=t.texture.type,this.outputTargetInternal.texture.format=t.texture.format,this.outputTargetInternal.texture.needsUpdate=!0),this.camera.updateMatrixWorld(),this.lastViewMatrix.equals(this.camera.matrixWorldInverse)&&this.lastProjectionMatrix.equals(this.camera.projectionMatrix)&&this.configuration.accumulate&&!this.needsFrame?this.frame++:(e.setRenderTarget(this.accumulationRenderTarget),e.clear(!0,!0,!0),this.frame=0,this.needsFrame=!1),this.lastViewMatrix.copy(this.camera.matrixWorldInverse),this.lastProjectionMatrix.copy(this.camera.projectionMatrix);let r,o,a;this.debugMode&&(r=e.getContext(),o=r.getExtension("EXT_disjoint_timer_query_webgl2"),o===null&&(console.error("EXT_disjoint_timer_query_webgl2 not available, disabling debug mode."),this.debugMode=!1)),this.debugMode&&(a=r.createQuery(),r.beginQuery(o.TIME_ELAPSED_EXT,a)),this.configuration.transparencyAware&&this.renderTransparency(e),this._r.set(this.width,this.height);let c=this.configuration.aoRadius;if(this.configuration.halfRes&&this.configuration.screenSpaceRadius&&(c*=.5),this.frame<1024/this.configuration.aoSamples){this.configuration.halfRes&&(e.setRenderTarget(this.depthDownsampleTarget),this.depthDownsampleQuad.material.uniforms.sceneDepth.value=this.depthTexture,this.depthDownsampleQuad.material.uniforms.resolution.value=this._r,this.depthDownsampleQuad.material.uniforms.near.value=this.camera.near,this.depthDownsampleQuad.material.uniforms.far.value=this.camera.far,this.depthDownsampleQuad.material.uniforms.projectionMatrixInv.value=this.camera.projectionMatrixInverse,this.depthDownsampleQuad.material.uniforms.viewMatrixInv.value=this.camera.matrixWorld,this.depthDownsampleQuad.material.uniforms.logDepth.value=this.configuration.logarithmicDepthBuffer,this.depthDownsampleQuad.render(e)),this.effectShaderQuad.material.uniforms.sceneDiffuse.value=t.texture,this.effectShaderQuad.material.uniforms.sceneDepth.value=this.configuration.halfRes?this.depthDownsampleTarget.texture[0]:this.depthTexture,this.effectShaderQuad.material.uniforms.sceneNormal.value=this.configuration.halfRes?this.depthDownsampleTarget.texture[1]:null,this.effectShaderQuad.material.uniforms.projMat.value=this.camera.projectionMatrix,this.effectShaderQuad.material.uniforms.viewMat.value=this.camera.matrixWorldInverse,this.effectShaderQuad.material.uniforms.projViewMat.value=this.camera.projectionMatrix.clone().multiply(this.camera.matrixWorldInverse.clone()),this.effectShaderQuad.material.uniforms.projectionMatrixInv.value=this.camera.projectionMatrixInverse,this.effectShaderQuad.material.uniforms.viewMatrixInv.value=this.camera.matrixWorld,this.effectShaderQuad.material.uniforms.cameraPos.value=this.camera.getWorldPosition(new w),this.effectShaderQuad.material.uniforms.resolution.value=this.configuration.halfRes?this._r.clone().multiplyScalar(.5).floor():this._r,this.effectShaderQuad.material.uniforms.time.value=performance.now()/1e3,this.effectShaderQuad.material.uniforms.samples.value=this.samples,this.effectShaderQuad.material.uniforms.bluenoise.value=this.bluenoise,this.effectShaderQuad.material.uniforms.radius.value=c,this.effectShaderQuad.material.uniforms.distanceFalloff.value=this.configuration.distanceFalloff,this.effectShaderQuad.material.uniforms.near.value=this.camera.near,this.effectShaderQuad.material.uniforms.far.value=this.camera.far,this.effectShaderQuad.material.uniforms.logDepth.value=e.capabilities.logarithmicDepthBuffer,this.effectShaderQuad.material.uniforms.ortho.value=this.camera.isOrthographicCamera,this.effectShaderQuad.material.uniforms.screenSpaceRadius.value=this.configuration.screenSpaceRadius,this.effectShaderQuad.material.uniforms.frame.value=this.frame,e.setRenderTarget(this.writeTargetInternal),this.effectShaderQuad.render(e);for(let h=0;h<this.configuration.denoiseIterations;h++)[this.writeTargetInternal,this.readTargetInternal]=[this.readTargetInternal,this.writeTargetInternal],this.poissonBlurQuad.material.uniforms.tDiffuse.value=this.readTargetInternal.texture,this.poissonBlurQuad.material.uniforms.sceneDepth.value=this.configuration.halfRes?this.depthDownsampleTarget.texture[0]:this.depthTexture,this.poissonBlurQuad.material.uniforms.projMat.value=this.camera.projectionMatrix,this.poissonBlurQuad.material.uniforms.viewMat.value=this.camera.matrixWorldInverse,this.poissonBlurQuad.material.uniforms.projectionMatrixInv.value=this.camera.projectionMatrixInverse,this.poissonBlurQuad.material.uniforms.viewMatrixInv.value=this.camera.matrixWorld,this.poissonBlurQuad.material.uniforms.cameraPos.value=this.camera.getWorldPosition(new w),this.poissonBlurQuad.material.uniforms.resolution.value=this.configuration.halfRes?this._r.clone().multiplyScalar(.5).floor():this._r,this.poissonBlurQuad.material.uniforms.time.value=performance.now()/1e3,this.poissonBlurQuad.material.uniforms.blueNoise.value=this.bluenoise,this.poissonBlurQuad.material.uniforms.radius.value=this.configuration.denoiseRadius*(this.configuration.halfRes?.5:1),this.poissonBlurQuad.material.uniforms.worldRadius.value=c,this.poissonBlurQuad.material.uniforms.distanceFalloff.value=this.configuration.distanceFalloff,this.poissonBlurQuad.material.uniforms.index.value=h,this.poissonBlurQuad.material.uniforms.poissonDisk.value=this.samplesDenoise,this.poissonBlurQuad.material.uniforms.near.value=this.camera.near,this.poissonBlurQuad.material.uniforms.far.value=this.camera.far,this.poissonBlurQuad.material.uniforms.logDepth.value=e.capabilities.logarithmicDepthBuffer,this.poissonBlurQuad.material.uniforms.screenSpaceRadius.value=this.configuration.screenSpaceRadius,e.setRenderTarget(this.writeTargetInternal),this.poissonBlurQuad.render(e);e.setRenderTarget(this.accumulationRenderTarget);const l=e.autoClear;e.autoClear=!1,this.accumulationQuad.material.uniforms.tDiffuse.value=this.writeTargetInternal.texture,this.accumulationQuad.material.uniforms.frame.value=this.frame,this.accumulationQuad.render(e),e.autoClear=l}this.configuration.transparencyAware&&(this.effectCompositerQuad.material.uniforms.transparencyDWFalse.value=this.transparencyRenderTargetDWFalse.texture,this.effectCompositerQuad.material.uniforms.transparencyDWTrue.value=this.transparencyRenderTargetDWTrue.texture,this.effectCompositerQuad.material.uniforms.transparencyDWTrueDepth.value=this.transparencyRenderTargetDWTrue.depthTexture,this.effectCompositerQuad.material.uniforms.transparencyAware.value=!0),this.effectCompositerQuad.material.uniforms.sceneDiffuse.value=t.texture,this.effectCompositerQuad.material.uniforms.sceneDepth.value=this.depthTexture,this.effectCompositerQuad.material.uniforms.near.value=this.camera.near,this.effectCompositerQuad.material.uniforms.far.value=this.camera.far,this.effectCompositerQuad.material.uniforms.projectionMatrixInv.value=this.camera.projectionMatrixInverse,this.effectCompositerQuad.material.uniforms.viewMatrixInv.value=this.camera.matrixWorld,this.effectCompositerQuad.material.uniforms.logDepth.value=e.capabilities.logarithmicDepthBuffer,this.effectCompositerQuad.material.uniforms.ortho.value=this.camera.isOrthographicCamera,this.effectCompositerQuad.material.uniforms.downsampledDepth.value=this.configuration.halfRes?this.depthDownsampleTarget.texture[0]:this.depthTexture,this.effectCompositerQuad.material.uniforms.resolution.value=this._r,this.effectCompositerQuad.material.uniforms.blueNoise.value=this.bluenoise,this.effectCompositerQuad.material.uniforms.intensity.value=this.configuration.intensity,this.effectCompositerQuad.material.uniforms.renderMode.value=this.configuration.renderMode,this.effectCompositerQuad.material.uniforms.screenSpaceRadius.value=this.configuration.screenSpaceRadius,this.effectCompositerQuad.material.uniforms.radius.value=c,this.effectCompositerQuad.material.uniforms.distanceFalloff.value=this.configuration.distanceFalloff,this.effectCompositerQuad.material.uniforms.gammaCorrection.value=this.autosetGamma?this.renderToScreen:this.configuration.gammaCorrection,this.effectCompositerQuad.material.uniforms.tDiffuse.value=this.accumulationRenderTarget.texture,this.effectCompositerQuad.material.uniforms.color.value=this._c.copy(this.configuration.color).convertSRGBToLinear(),this.effectCompositerQuad.material.uniforms.colorMultiply.value=this.configuration.colorMultiply,this.effectCompositerQuad.material.uniforms.cameraPos.value=this.camera.getWorldPosition(new w),this.effectCompositerQuad.material.uniforms.fog.value=!!this.scene.fog,this.scene.fog&&(this.scene.fog.isFog?(this.effectCompositerQuad.material.uniforms.fogExp.value=!1,this.effectCompositerQuad.material.uniforms.fogNear.value=this.scene.fog.near,this.effectCompositerQuad.material.uniforms.fogFar.value=this.scene.fog.far):this.scene.fog.isFogExp2?(this.effectCompositerQuad.material.uniforms.fogExp.value=!0,this.effectCompositerQuad.material.uniforms.fogDensity.value=this.scene.fog.density):console.error(`Unsupported fog type ${this.scene.fog.constructor.name} in SSAOPass.`)),e.setRenderTarget(this.outputTargetInternal),this.effectCompositerQuad.render(e),e.setRenderTarget(this.renderToScreen?null:i),this.copyQuad.material.uniforms.tDiffuse.value=this.outputTargetInternal.texture,this.copyQuad.render(e),this.debugMode&&(r.endQuery(o.TIME_ELAPSED_EXT),uG(a,r,this)),e.xr.enabled=s}enableDebugMode(){this.debugMode=!0}disableDebugMode(){this.debugMode=!1}setDisplayMode(e){this.configuration.renderMode=["Combined","AO","No AO","Split","Split AO"].indexOf(e)}setQualityMode(e){e==="Performance"?(this.configuration.aoSamples=8,this.configuration.denoiseSamples=4,this.configuration.denoiseRadius=12):e==="Low"?(this.configuration.aoSamples=16,this.configuration.denoiseSamples=4,this.configuration.denoiseRadius=12):e==="Medium"?(this.configuration.aoSamples=16,this.configuration.denoiseSamples=8,this.configuration.denoiseRadius=12):e==="High"?(this.configuration.aoSamples=64,this.configuration.denoiseSamples=8,this.configuration.denoiseRadius=6):e==="Ultra"&&(this.configuration.aoSamples=64,this.configuration.denoiseSamples=16,this.configuration.denoiseRadius=6)}}Uint8Array.from(atob(hG),n=>n.charCodeAt(0));const f0=re("debugpost"),OC=Symbol("needle:postprocessing-handler"),kC=Symbol("needle:previous-autoclear-state");class KI{constructor(e){u(this,"_composer",null);u(this,"_lastVolumeComponents");u(this,"_effects",[]);u(this,"_isActive",!1);u(this,"context");this.context=e}get isActive(){return this._isActive}get composer(){return this._composer}apply(e){this._isActive=!0,this.onApply(this.context,e)}unapply(){var i;if(this._isActive=!1,this._lastVolumeComponents){for(const s of this._lastVolumeComponents)s.unapply();this._lastVolumeComponents.length=0}const e=this.context;e[OC]===this&&delete e[OC],e.composer===this._composer&&((i=e.composer)==null||i.dispose(),e.composer=null),typeof e.renderer[kC]=="boolean"&&(e.renderer.autoClear=e.renderer[kC])}dispose(){this.unapply();for(const e of this._effects)e.dispose();this._effects.length=0,this._composer=null}onApply(e,t){if(t){e[OC]=this,f0&&console.log("refreshing volume profile",t),this._lastVolumeComponents=[...t],this._effects.length=0;for(const i of t)if(i.context=e,i.apply){if(i.active){if(!e.mainCameraComponent){console.error("No camera in scene found or available yet - can not create postprocessing effects");return}const s=i.apply();if(!s)continue;Array.isArray(s)?this._effects.push(...s):this._effects.push(s)}}else i.active&&gn("Volume component is not a VolumeComponent: "+i.__type);this.applyEffects(e)}}applyEffects(e){const t=this._effects;if(t.length<=0)return;const i=e.mainCameraComponent,s=e.renderer,r=e.scene,o=i.cam;s[kC]=s.autoClear,this._composer||(this._composer=new h1(s,{frameBufferType:sn,stencilBuffer:!0,multisampling:Pl()?0:8})),e.composer=this._composer;const a=e.composer;a.setMainCamera(o),a.setRenderer(s),a.setMainScene(r);for(const l of a.passes)l.dispose();a.removeAllPasses();const c=new ax(r,o);c.mainScene=r,a.addPass(c);try{this.orderEffects();const l=[];for(const h of t)if(h instanceof ya)l.push(h);else if(h instanceof Js){const d=new wB(o,...l);d.mainScene=r,d.name=l.map(f=>f.constructor.name).join(", "),d.enabled=!0,l.length=0,a.addPass(h)}if(l.length>0){const h=new wB(o,...l);h.mainScene=r,h.enabled=!0,a.addPass(h)}}catch(l){console.error("Error while applying postprocessing effects",l),a.removeAllPasses(),a.addPass(c)}f0&&console.log("PostProcessing Passes",t,"->",a.passes)}orderEffects(){var t;f0&&console.log("Before ordering effects",[...this._effects]);const e=this._effects;e.sort((i,s)=>{const r=jk.indexOf(i.constructor),o=jk.indexOf(s.constructor);return r<0&&o<0?-1:r<0?1:o<0?-1:r-o}),f0&&console.log("After ordering effects",[...this._effects]);for(let i=0;i<e.length;i++){const s=e[i];if(((t=s==null?void 0:s.configuration)==null?void 0:t.gammaCorrection)!==void 0){const r=i===e.length-1;s.configuration.gammaCorrection=r}}}}const jk=[FF,c1,QF,dG,zF,u1,HF,jF,GF,NF,UF,VF];async function ZI(n){const{NeedleEngineHTMLElement:e}=await ux(()=>Promise.resolve().then(()=>loe),void 0,import.meta.url);e.observedAttributes.includes(n)||e.observedAttributes.push(n)}var mw=globalThis&&globalThis.__decorate||function(n,e,t,i){var s=arguments.length,r=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(e,t,r):o(e,t))||r);return s>3&&r&&Object.defineProperty(e,t,r),r};const Za=re("debugskybox");ZI("skybox-image");ZI("environment-image");function Wk(n,e,t,i,s){const r=new Wh;r.allowDrop=!1,r.allowNetworking=!1,r.background=t,r.environment=i,le.addComponent(n.scene,r);const o=a=>{typeof a=="string"&&(Za&&console.log(s,"CHANGED TO",a),r.setSkybox(a))};return n8(n.domElement,s,o),r.addEventListener("destroy",()=>{Za&&console.log("Destroyed attribute remote skybox",s),s8(n.domElement,s,o)}),r.setSkybox(e)}zi.addContextCreatedCallback(n=>{var r;const e=n.context,t=e.domElement.getAttribute("skybox-image"),i=e.domElement.getAttribute("environment-image"),s=new Array;if(t){Za&&console.log("Creating remote skybox to load "+t),((r=e.mainCameraComponent)==null?void 0:r.clearFlags)!==Mo.Skybox&&console.warn('"skybox-image" attribute has no effect: camera clearflags are not set to "Skybox"');const o=Wk(e,t,!0,!1,"skybox-image");s.push(o)}if(i){Za&&console.log("Creating remote environment to load "+i);const o=Wk(e,i,!1,!0,"environment-image");s.push(o)}return s.length>0?ix(s):Promise.resolve()});function fG(){return globalThis.NEEDLE_ENGINE_SKYBOX_TEXTURES||(globalThis.NEEDLE_ENGINE_SKYBOX_TEXTURES=new Array),globalThis.NEEDLE_ENGINE_SKYBOX_TEXTURES}function Jse(n){const t=fG().find(i=>i.src===n);return t?(Za&&console.log("Skybox: Found previously loaded texture for "+n),t.texture):null}async function Kse(n){const e=await n;yF(e,!0),Qi(e)}function Zse(n,e){const t=fG();for(;t.length>5;){const i=t.shift();i&&Kse(i.texture)}e.then(i=>yF(i,!1)),t.push({src:n,texture:e})}class Wh extends Te{constructor(){super(...arguments);u(this,"url");u(this,"allowDrop",!0);u(this,"background",!0);u(this,"environment",!0);u(this,"allowNetworking",!0);u(this,"_loader");u(this,"_prevUrl");u(this,"_prevLoadedEnvironment");u(this,"_prevEnvironment",null);u(this,"_prevBackground",null);u(this,"dragOverEvent");u(this,"dropEvent")}onEnable(){this.setSkybox(this.url),this.registerDropEvents()}onDisable(){var t;this.context.scene.environment===this._prevLoadedEnvironment&&(this.context.scene.environment=this._prevEnvironment,Di.backgroundShouldBeTransparent(this.context)||(this.context.scene.background=this._prevBackground),this._prevLoadedEnvironment=void 0),this.unregisterDropEvents(),(t=this.context.mainCameraComponent)==null||t.applyClearFlags()}urlChangedSyncField(){this.allowNetworking&&this.setSkybox(this.url)}async setSkybox(t){var r;if(!this.activeAndEnabled||!t)return!1;if(!(t!=null&&t.endsWith(".hdr"))&&!t.endsWith(".exr")&&!t.endsWith(".jpg")&&!t.endsWith(".png")&&!t.endsWith(".jpeg")&&console.warn("Potentially invalid skybox url",this.url,"on",this.name),Za&&console.log("Remote skybox url?: "+t),this._prevUrl===t&&this._prevLoadedEnvironment)return this.applySkybox(),!0;(r=this._prevLoadedEnvironment)==null||r.dispose(),this._prevLoadedEnvironment=void 0,this._prevUrl=t;const i=await this.loadTexture(t);if(!i||!this.enabled)return!1;this.url=t;const s=t.lastIndexOf("/");return i.name=t.substring(s>=0?s+1:0),this._loader instanceof dl&&(i.colorSpace=zt),this._prevLoadedEnvironment=i,this.applySkybox(),!0}async loadTexture(t){var c,l,h,d,f;if(!t)return Promise.resolve(null);const i=Jse(t);if(i){const p=await i;if(((l=(c=p.source)==null?void 0:c.data)==null?void 0:l.length)>0||(f=(d=(h=p.source)==null?void 0:h.data)==null?void 0:d.data)!=null&&f.length)return p}const s=t.endsWith(".exr"),r=t.endsWith(".hdr");s?this._loader instanceof bb||(this._loader=new bb):r?this._loader instanceof QE||(this._loader=new QE):this._loader instanceof dl||(this._loader=new dl),Za&&console.log("Loading skybox: "+t);const o=this._loader.loadAsync(t);return Zse(t,o),await o}applySkybox(){var i;const t=this._prevLoadedEnvironment;t&&(t.mapping=up,t.needsUpdate=!0,this.context.scene.background!==t&&(this._prevBackground=this.context.scene.background),this.context.scene.environment!==t&&(this._prevEnvironment=this.context.scene.environment),Za&&console.log("Set remote skybox",this.url),this.environment&&(this.context.scene.environment=t),this.background&&!Di.backgroundShouldBeTransparent(this.context)&&(this.context.scene.background=t),((i=this.context.mainCameraComponent)==null?void 0:i.backgroundBlurriness)!==void 0&&(this.context.scene.backgroundBlurriness=this.context.mainCameraComponent.backgroundBlurriness))}registerDropEvents(){this.dragOverEvent||(this.dragOverEvent=t=>{if(this.allowDrop&&t.dataTransfer)for(const i of t.dataTransfer.types)i==="text/uri-list"&&t.preventDefault()},this.dropEvent=t=>{var i,s,r,o;if(this.allowDrop&&(t.preventDefault(),!!t.dataTransfer)){for(const a of t.dataTransfer.types)if(a==="text/uri-list"){const c=t.dataTransfer.getData(a);Za&&console.log(a,c);let l=(s=(i=new RegExp(/polyhaven.com\/asset_img\/.+?\/(?<name>.+)\.png/).exec(c))==null?void 0:i.groups)==null?void 0:s.name;if(l||(l=(o=(r=new RegExp(/polyhaven\.com\/a\/(?<name>.+)/).exec(c))==null?void 0:r.groups)==null?void 0:o.name),Za&&console.log(l),l){const h="https://dl.polyhaven.org/file/ph-assets/HDRIs/exr/1k/"+l+"_1k.exr";this.setSkybox(h)}else console.warn("Could not resolve skybox name from dropped url",c)}}},this.context.domElement.addEventListener("dragover",this.dragOverEvent),this.context.domElement.addEventListener("drop",this.dropEvent))}unregisterDropEvents(){this.dragOverEvent&&(this.context.domElement.removeEventListener("dragover",this.dragOverEvent),this.context.domElement.removeEventListener("drop",this.dropEvent))}}mw([Mz(Wh.prototype.urlChangedSyncField),x(URL)],Wh.prototype,"url",void 0);mw([x()],Wh.prototype,"allowDrop",void 0);mw([x()],Wh.prototype,"background",void 0);mw([x()],Wh.prototype,"environment",void 0);var ho=globalThis&&globalThis.__decorate||function(n,e,t,i){var s=arguments.length,r=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(e,t,r):o(e,t))||r);return s>3&&r&&Object.defineProperty(e,t,r),r};const Jr=re("debugsceneswitcher"),X0="scene";ZI(X0);const ah=Promise.resolve(!1);class Sr extends Te{constructor(){super(...arguments);u(this,"autoLoadFirstScene",!0);u(this,"scenes");u(this,"loadingScene");u(this,"queryParameterName","scene");u(this,"useSceneName",!0);u(this,"clamp",!0);u(this,"useHistory",!0);u(this,"useKeyboard",!0);u(this,"useSwipe",!0);u(this,"useSceneLighting",!0);u(this,"preloadNext",1);u(this,"preloadPrevious",1);u(this,"preloadConcurrent",2);u(this,"_currentIndex",-1);u(this,"_currentScene");u(this,"_engineElementOverserver");u(this,"_preloadScheduler");u(this,"onPopState",async t=>{if(!this.useHistory)return;const i=this.useHistory;try{this.useHistory=!1;let s=!1;if(this.queryParameterName&&(s=await this.tryLoadFromQueryParam()),!s){const r=t==null?void 0:t.state;if(r&&r.startsWith(this.guid)){const o=r.substr(this.guid.length+2);Jr&&console.log("PopState",o),await this.trySelectSceneFromValue(o)}}}finally{this.useHistory=i}});u(this,"normalizedSwipeThresholdX",.1);u(this,"_didSwipe",!1);u(this,"onInputPointerMove",t=>{if(this.useSwipe&&!this._didSwipe&&t.button===0&&t.pointerType==="touch"&&this.context.input.getPointerPressedCount()===1){const i=this.context.input.getPointerPositionDelta(t.button);if(i){const s=i.x/this.context.domWidth;s>=this.normalizedSwipeThresholdX?(this._didSwipe=!0,this.selectPrev()):s<=-this.normalizedSwipeThresholdX&&(this._didSwipe=!0,this.selectNext())}}});u(this,"onInputPointerUp",t=>{t.button===0&&(this._didSwipe=!1)});u(this,"onInputKeyDown",t=>{if(!this.useKeyboard||!this.scenes)return;const i=t.key.toLowerCase();if(!i)return;const s=parseInt(i)-1;if(s>=0){this.trySelectSceneFromValue(s);return}switch(i){case"arrowright":case"d":this.selectNext();break;case"arrowleft":case"a":this.selectPrev();break}});u(this,"__lastSwitchScene");u(this,"__lastSwitchScenePromise");u(this,"_currentlyLoadingScene");u(this,"_lastLoadingScene");u(this,"_loadingScenePromise");u(this,"_isCurrentlyLoading",!1);u(this,"_currentLoadingProgress")}get currentIndex(){return this._currentIndex}get currentLoadingProgress(){return this._currentLoadingProgress}get currentlyLoadingScene(){return this._currentlyLoadingScene}awake(){Jr&&console.log("SceneSwitcher",this)}async onEnable(){if(globalThis.addEventListener("popstate",this.onPopState),this.context.input.addEventListener(li.KeyDown,this.onInputKeyDown),this.context.input.addEventListener(li.PointerMove,this.onInputPointerMove),this.context.input.addEventListener(li.PointerUp,this.onInputPointerUp),this._engineElementOverserver||(this._engineElementOverserver=new MutationObserver(t=>{for(const i of t)if(i.type==="attributes"&&i.attributeName===X0){const s=this.context.domElement.getAttribute(X0);s!==null&&this.trySelectSceneFromValue(s)}})),this._engineElementOverserver.observe(this.context.domElement,{attributes:!0}),this._preloadScheduler||(this._preloadScheduler=new $se(this)),this._preloadScheduler.maxLoadAhead=this.preloadNext,this._preloadScheduler.maxLoadBehind=this.preloadPrevious,this._preloadScheduler.maxConcurrent=this.preloadConcurrent,this._preloadScheduler.begin(),this.autoLoadFirstScene&&this._currentIndex===-1&&!await this.tryLoadFromQueryParam()){const t=this.context.domElement.getAttribute(X0);try{(t===null||!await this.trySelectSceneFromValue(t))&&this._currentIndex===-1&&this.select(0)}finally{}}}onDisable(){var t;globalThis.removeEventListener("popstate",this.onPopState),this.context.input.removeEventListener(li.KeyDown,this.onInputKeyDown),this.context.input.removeEventListener(li.PointerMove,this.onInputPointerMove),this.context.input.removeEventListener(li.PointerUp,this.onInputPointerUp),(t=this._preloadScheduler)==null||t.stop()}selectNext(){return this.select(this._currentIndex+1)}selectPrev(){return this.select(this._currentIndex-1)}select(t){var s,r,o;if(Jr&&console.log("select",t),typeof t=="object"&&console.warn('Switching to "'+t+'" might not work. Please either use an index or a AssetReference (not a scene reference)'),typeof t=="string"){const a=(s=this.scenes)==null?void 0:s.find(c=>c.uri===t);if(!a){const c=ii.getOrCreate(this.sourceId??"",t,this.context);return this.switchScene(c)}if(a)t=(r=this.scenes)==null?void 0:r.indexOf(a);else return ah}if(!((o=this.scenes)!=null&&o.length))return ah;if(t<0){if(this.clamp)return ah;t=this.scenes.length-1}else if(t>=this.scenes.length){if(this.clamp)return ah;t=0}const i=this.scenes[t];return this.switchScene(i)}async switchScene(t){if(!(t instanceof ii)){const s=typeof t;return s==="string"?this.select(t):s==="number"?this.select(t):(console.warn("SceneSwitcher: Can't switch to scene",t,"of type",s),!1)}return t.uri===this.sourceId?(console.warn("SceneSwitcher: can't load own scene - prevent recursive loading",this.sourceId),!1):this.__lastSwitchScene===t&&this.__lastSwitchScenePromise?this.__lastSwitchScenePromise:(this.__lastSwitchScene=t,this.__lastSwitchScenePromise=this.__internalSwitchScene(t),await this.__lastSwitchScenePromise)}async __internalSwitchScene(t){var s,r;if(this._currentScene){Jr&&console.log("UNLOAD",t.uri);const o=this.tryGetSceneEventListener(this._currentScene.asset);if(o!=null&&o.sceneClosing){const a=o.sceneClosing();a instanceof Promise&&await a}this._currentScene.unload()}this._currentScene=void 0;const i=this._currentIndex=((s=this.scenes)==null?void 0:s.indexOf(t))??-1;try{this._currentlyLoadingScene=t,this._currentLoadingProgress=new ProgressEvent("progress",{loaded:0,total:1});const o=new CustomEvent("loadscene-start",{detail:{scene:t,switcher:this,index:i}});this.dispatchEvent(o),await this.onStartLoading(),await t.loadAssetAsync((c,l)=>{this._currentLoadingProgress=l,this.dispatchEvent(l)}).catch(console.error),await this.onEndLoading();const a=new CustomEvent("loadscene-finished",{detail:{scene:t,switcher:this,index:i}});if(this.dispatchEvent(a),this._currentLoadingProgress=void 0,this._currentlyLoadingScene=void 0,a.defaultPrevented)return Jr&&console.warn("Adding loaded scene prevented:",t,a),!1;if(!t.asset)return Jr&&console.warn("Failed loading scene:",t),!1;if(this._currentIndex===i){if(Jr&&console.log("ADD",t.uri),this._currentScene=t,le.add(t.asset,this.gameObject),this.useSceneLighting&&this.context.sceneLighting.enable(t),this.useHistory&&i>=0){let l=i.toString();if(this.useSceneName&&(l=qk(t.uri)),(r=this.queryParameterName)!=null&&r.length)XW(this.queryParameterName,l,this.useHistory);else{const h=history.state,d=this.guid+"::"+i;h!==d&&history.pushState(d,"unused",location.href)}}const c=this.tryGetSceneEventListener(t.asset);if(c!=null&&c.sceneOpened){const l=c.sceneOpened(this);l instanceof Promise&&await l}return!0}}catch(o){console.error(o)}return!1}preload(t){if(t>=0&&t<this.scenes.length){const i=this.scenes[t];if(i instanceof ii)return i.preload()}return ah}tryLoadFromQueryParam(){var i;if(!((i=this.queryParameterName)!=null&&i.length))return ah;const t=re(this.queryParameterName);return typeof t=="boolean"?ah:this.trySelectSceneFromValue(t)}trySelectSceneFromValue(t){if(typeof t=="string"){const i=parseInt(t);if(i>=0&&i<this.scenes.length)return this.select(i);{const s=t.toLowerCase();for(let r=0;r<this.scenes.length;r++){const o=this.scenes[r];if(o&&qk(o.uri).toLowerCase().includes(s))return this.select(r)}}}else if(typeof t=="number"&&t>=0&&t<this.scenes.length)return this.select(t);return zr()&&console.warn('Can not find scene: "'+t+'"',this),ah}async onStartLoading(){var t,i;if(this._isCurrentlyLoading=!0,this.loadingScene&&(this._lastLoadingScene!==this.loadingScene&&(this._loadingScenePromise=void 0),this._lastLoadingScene=this.loadingScene,this._loadingScenePromise||(this._loadingScenePromise=(t=this.loadingScene)==null?void 0:t.loadAssetAsync()),await this._loadingScenePromise,this._isCurrentlyLoading&&((i=this.loadingScene)!=null&&i.asset))){Jr&&console.log("Add loading scene",this.loadingScene.uri,this.loadingScene.asset);const s=this.loadingScene.asset;le.add(s,this.gameObject);const r=this.tryGetSceneEventListener(s);if(r!=null&&r.sceneOpened){const o=r.sceneOpened(this);o instanceof Promise&&await o}}}async onEndLoading(){var t;if(this._isCurrentlyLoading=!1,(t=this.loadingScene)!=null&&t.asset){Jr&&console.log("Remove loading scene",this.loadingScene.uri);const i=this.loadingScene.asset,s=this.tryGetSceneEventListener(i);if(typeof(s==null?void 0:s.sceneClosing)=="function"){const r=s.sceneClosing();r instanceof Promise&&await r}le.remove(i)}}tryGetSceneEventListener(t,i=0){const s=le.foreachComponent(t,r=>r.sceneClosing?r:void 0);if(i===0&&!s&&t.children.length)for(const r of t.children){const o=this.tryGetSceneEventListener(r,i+1);if(o)return o}return s||null}}ho([x()],Sr.prototype,"autoLoadFirstScene",void 0);ho([x(ii)],Sr.prototype,"scenes",void 0);ho([x(ii)],Sr.prototype,"loadingScene",void 0);ho([x()],Sr.prototype,"queryParameterName",void 0);ho([x()],Sr.prototype,"useSceneName",void 0);ho([x()],Sr.prototype,"clamp",void 0);ho([x()],Sr.prototype,"useHistory",void 0);ho([x()],Sr.prototype,"useKeyboard",void 0);ho([x()],Sr.prototype,"useSwipe",void 0);ho([x()],Sr.prototype,"useSceneLighting",void 0);ho([x()],Sr.prototype,"preloadNext",void 0);ho([x()],Sr.prototype,"preloadPrevious",void 0);ho([x()],Sr.prototype,"preloadConcurrent",void 0);function qk(n){const e=n.split("/").pop(),t=e==null?void 0:e.split(".").shift();return t!=null&&t.length?t:n}class $se{constructor(e,t=1,i=1,s=2){u(this,"maxLoadAhead");u(this,"maxLoadBehind");u(this,"maxConcurrent");u(this,"_isRunning",!1);u(this,"_switcher");u(this,"_loadTasks",[]);u(this,"_maxConcurrentLoads",1);this._switcher=e,this.maxLoadAhead=t,this.maxLoadBehind=i,this.maxConcurrent=s}begin(){if(this._isRunning)return;Jr&&console.log("Preload begin"),this._isRunning=!0;let e=-1,t,i;const s=this._switcher.scenes,r=setInterval(()=>{if(this.allLoaded()&&(Jr&&console.log("All scenes loaded"),this.stop()),!this._isRunning){clearInterval(r);return}if(this.canLoadNewScene()===!1)return;e!==this._switcher.currentIndex&&(e=this._switcher.currentIndex,i=0,t=0);const o=i%2===0;o&&(t+=1),i+=1;const a=o?this.maxLoadAhead:this.maxLoadBehind;if(t>a)return;const c=o?e+t:e-t;if(c<0||c<0||c>=s.length)return;const l=s[c];new ere(c,l,this._loadTasks)},200)}stop(){this._isRunning=!1}canLoadNewScene(){return this._loadTasks.length<this._maxConcurrentLoads}allLoaded(){if(this._switcher.scenes){for(const e of this._switcher.scenes)if((e==null?void 0:e.isLoaded())===!1)return!1}return!0}}class ere{constructor(e,t,i){u(this,"index");u(this,"asset");u(this,"tasks");this.index=e,this.asset=t,this.tasks=i,i.push(this),this.awaitLoading()}async awaitLoading(){this.asset&&!this.asset.isLoaded()&&(Jr&&console.log("Preload start: "+this.asset.uri,this.index),await this.asset.preload(),Jr&&console.log("Preload finished: "+this.asset.uri,this.index));const e=this.tasks.indexOf(this);e>=0&&this.tasks.splice(e,1)}}function tre(){return new Promise((n,e)=>{const i=()=>{i!=null&&(document.removeEventListener("pointerdown",i),document.removeEventListener("click",i),document.removeEventListener("dragstart",i),document.removeEventListener("touchstart",i),n())};document.addEventListener("pointerdown",i),document.addEventListener("click",i),document.addEventListener("dragstart",i),document.addEventListener("touchstart",i)})}async function ire(n){await tre(),n()}var uo=globalThis&&globalThis.__decorate||function(n,e,t,i){var s=arguments.length,r=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(e,t,r):o(e,t))||r);return s>3&&r&&Object.defineProperty(e,t,r),r};const Jn=re("debugvideo");var xh;(function(n){n[n.None=0]="None",n[n.AdjustHeight=1]="AdjustHeight",n[n.AdjustWidth=2]="AdjustWidth"})(xh||(xh={}));var Xc;(function(n){n[n.VideoClip=0]="VideoClip",n[n.Url=1]="Url"})(Xc||(Xc={}));var Ig;(function(n){n[n.None=0]="None",n[n.AudioSource=1]="AudioSource",n[n.Direct=2]="Direct",n[n.APIOnly=3]="APIOnly"})(Ig||(Ig={}));var Rg;(function(n){n[n.CameraFarPlane=0]="CameraFarPlane",n[n.CameraNearPlane=1]="CameraNearPlane",n[n.RenderTexture=2]="RenderTexture",n[n.MaterialOverride=3]="MaterialOverride"})(Rg||(Rg={}));class cs extends Te{constructor(){super();u(this,"playOnAwake",!0);u(this,"aspectMode",xh.None);u(this,"clip",null);u(this,"source",Xc.Url);u(this,"url",null);u(this,"renderMode");u(this,"targetMaterialProperty");u(this,"targetMaterialRenderer");u(this,"targetTexture");u(this,"time",0);u(this,"_playbackSpeed",1);u(this,"_isLooping",!1);u(this,"_muted",!1);u(this,"_audioOutputMode",Ig.Direct);u(this,"playInBackground",!0);u(this,"_crossOrigin","anonymous");u(this,"_videoElement",null);u(this,"_videoTexture",null);u(this,"_videoMaterial",null);u(this,"_isPlaying",!1);u(this,"wasPlaying",!1);u(this,"visibilityChanged",t=>{switch(document.visibilityState){case"hidden":this.playInBackground||(this.wasPlaying=this._isPlaying,this.pause());break;case"visible":this.wasPlaying&&!this._isPlaying&&this.play();break}});u(this,"_receivedInput",!1);u(this,"_overlay",null);u(this,"_targetObjects");u(this,"_updateAspectRoutineId",-1);u(this,"_hls");u(this,"onHlsAvailable",()=>{var t;Jn&&console.log("HLS: available",this.clip),!(!this.shouldUseM3U8||!this.url)&&(this._hls||(this._hls=new Hls),this.videoElement.autoplay=!0,this._hls.loadSource(this.url),this._hls.attachMedia(this.videoElement),(t=this._videoElement)==null||t.play(),Jn&&console.log("HLS: loaded",this.clip))});ire(()=>{this._receivedInput=!0,this.updateVideoElementSettings()}),this._targetObjects=[],re("videoscreenspace")&&window.addEventListener("keydown",t=>{t.key==="f"&&(this.screenspace=!this.screenspace)})}get playbackSpeed(){var t;return((t=this._videoElement)==null?void 0:t.playbackRate)??this._playbackSpeed}set playbackSpeed(t){this._playbackSpeed=t,this._videoElement&&(this._videoElement.playbackRate=t)}get isLooping(){var t;return((t=this._videoElement)==null?void 0:t.loop)??this._isLooping}set isLooping(t){this._isLooping=t,this._videoElement&&(this._videoElement.loop=t)}get currentTime(){var t;return((t=this._videoElement)==null?void 0:t.currentTime)??this.time}set currentTime(t){this._videoElement?this._videoElement.currentTime=t:this.time=t}get isPlaying(){const t=this._videoElement;if(t){if(t.currentTime>0&&!t.paused&&!t.ended&&t.readyState>t.HAVE_CURRENT_DATA)return!0;if(t.srcObject&&t.srcObject.active)return!0}return!1}get crossOrigin(){var t;return((t=this._videoElement)==null?void 0:t.crossOrigin)??this._crossOrigin}set crossOrigin(t){this._crossOrigin=t,this._videoElement&&(t!==null?this._videoElement.setAttribute("crossorigin",t):this._videoElement.removeAttribute("crossorigin"))}get videoMaterial(){return!this._videoMaterial&&!this.create(!1)?null:this._videoMaterial}get videoTexture(){return!this._videoTexture&&!this.create(!1)?null:this._videoTexture}get videoElement(){return this._videoElement&&!this.create(!1)?null:this._videoElement}get muted(){var t;return((t=this._videoElement)==null?void 0:t.muted)??this._muted}set muted(t){this._muted=t,this._videoElement&&(this._videoElement.muted=t)}get currentVideo(){return this.clip}set audioOutputMode(t){t!==this._audioOutputMode&&(t===Ig.AudioSource&&Tt()&&console.warn("VideoAudioOutputMode.AudioSource is not yet implemented"),this._audioOutputMode=t,this.updateVideoElementSettings())}get audioOutputMode(){return this._audioOutputMode}preloadVideo(){Jn&&console.log("Video Preload: "+this.name,this.clip),this.create(!1)}preload(){this.preloadVideo()}setVideo(t){this.clip=t,this.source=Xc.VideoClip,this._videoElement?(this._videoElement.srcObject=t,this._isPlaying&&this.play(),this.updateAspect()):this.create(this.playOnAwake)}setClipURL(t){this.url!==t&&(this.url=t,this.source=Xc.Url,Jn&&console.log("set url",t),this._videoElement?t.endsWith(".m3u8")?this.ensureM3U8CanBePlayed():(this._videoElement.src=t,this._isPlaying&&(this.stop(),this.play())):this.create(this.playOnAwake))}onEnable(){var t,i;Jn&&console.log("VideoPlayer.onEnable",Xc[this.source],this.clip,this.url,this),window.addEventListener("visibilitychange",this.visibilityChanged),this.playOnAwake===!0?this.create(!0):this.preloadVideo(),this.screenspace?(t=this._overlay)==null||t.start():(i=this._overlay)==null||i.stop()}onDisable(){var t;window.removeEventListener("visibilitychange",this.visibilityChanged),(t=this._overlay)==null||t.stop(),this.pause()}onDestroy(){var t;this._videoElement&&((t=this.videoElement)==null||t.remove(),this._videoElement=null),this._videoTexture&&(this._videoTexture.dispose(),this._videoTexture=null)}play(){var t,i;if(this._videoElement||this.create(!1),!this._videoElement){Jn&&console.warn("Can not play: no video element found",this);return}if(!(this._isPlaying&&!((t=this._videoElement)!=null&&t.ended)&&!((i=this._videoElement)!=null&&i.paused))){if(this._isPlaying=!0,this._receivedInput||(this._videoElement.muted=!0),this.handleBeginPlaying(!1),this.shouldUseM3U8){this.ensureM3U8CanBePlayed();return}Jn&&console.log("Video Play()",this.clip,this._videoElement,this.time),this._videoElement.currentTime=this.time,this._videoElement.play().catch(s=>{var r;console.log(s),Jn&&console.error("Error playing video",s,"CODE="+s.code,(r=this.videoElement)==null?void 0:r.src,this),setTimeout(()=>{this._isPlaying&&!this.destroyed&&this.activeAndEnabled&&this.play()},1e3)}),Jn&&console.log("play",this._videoElement,this.time)}}stop(){this._isPlaying=!1,this.time=0,this._videoElement&&(this._videoElement.currentTime=0,this._videoElement.pause(),Jn&&console.log("STOP",this))}pause(){var t,i;this.time=((t=this._videoElement)==null?void 0:t.currentTime)??0,this._isPlaying=!1,(i=this._videoElement)==null||i.pause(),Jn&&console.log("PAUSE",this,this.currentTime)}create(t){let i;switch(this.source){case Xc.VideoClip:i=this.clip;break;case Xc.Url:i=this.url,!(i!=null&&i.length)&&typeof this.clip=="string"&&(i=this.clip);break}return i?(this._videoElement||(Jn&&console.warn("Create VideoElement",this),this._videoElement=this.createVideoElement(),this.context.domElement.shadowRoot.prepend(this._videoElement),this.updateVideoElementStyles()),typeof i=="string"?(Jn&&console.log("Set Video src",i),this._videoElement.src=i):(Jn&&console.log("Set Video srcObject",i),this._videoElement.srcObject=i),this._videoTexture||(this._videoTexture=new E2(this._videoElement)),this._videoTexture.flipY=!1,this._videoTexture.colorSpace=zt,t&&this.handleBeginPlaying(t),Jn&&console.log("Video: handle playing done...",i,t),!0):(Jn&&console.warn("No video source set",this),!1)}updateAspect(){this.aspectMode!==xh.None&&this.startCoroutine(this.updateAspectImpl())}get screenspace(){var t;return((t=this._overlay)==null?void 0:t.enabled)??!1}set screenspace(t){var i;if(t){if(!this._videoTexture)return;this._overlay||(this._overlay=new nre(this.context)),this._overlay.add(this._videoTexture)}else(i=this._overlay)==null||i.remove(this._videoTexture);this._overlay&&(this._overlay.enabled=t)}createVideoElement(){const t=document.createElement("video");return this._crossOrigin&&t.setAttribute("crossorigin",this._crossOrigin),Jn&&console.log("created video element",t),t}handleBeginPlaying(t){var r,o;if(!this.activeAndEnabled||!this._videoElement)return;this._targetObjects.length=0;let i=this.gameObject;switch(this.renderMode){case Rg.MaterialOverride:i=(r=this.targetMaterialRenderer)==null?void 0:r.gameObject,i||(i=(o=le.getComponent(this.gameObject,an))==null?void 0:o.gameObject);break;case Rg.RenderTexture:console.error("VideoPlayer renderTexture not implemented yet. Please use material override instead");return}if(!i){console.error("Missing target for video material renderer",this.name,Rg[this.renderMode],this);return}const s=i.material;if(s){this._targetObjects.push(i),s!==this._videoMaterial&&(this._videoMaterial=s.clone(),i.material=this._videoMaterial);const a="map",c=this._videoMaterial;if(!this.targetMaterialProperty)c[a]=this._videoTexture;else switch(this.targetMaterialProperty){default:c[a]=this._videoTexture;break}}else{console.warn("Can not play video, no material found, this might be a multimaterial case which is not supported yet");return}this.updateVideoElementSettings(),this.updateVideoElementStyles(),t&&(this.shouldUseM3U8&&this.ensureM3U8CanBePlayed(),this.play())}updateVideoElementSettings(){if(!this._videoElement)return;this._videoElement.loop=this._isLooping,this._videoElement.currentTime=this.currentTime,this._videoElement.playbackRate=this._playbackSpeed,this._videoElement.playsInline=!0;let t=!this._receivedInput||this.audioOutputMode===Ig.None;!t&&this._muted&&(t=!0),this._videoElement.muted=t,this.playOnAwake&&(this._videoElement.autoplay=!0)}updateVideoElementStyles(){this._videoElement&&(this._videoElement.style.userSelect="none",this._videoElement.style.visibility="hidden",this._videoElement.style.display="none",this.updateAspect())}*updateAspectImpl(){const t=++this._updateAspectRoutineId,i=void 0,s=this.clip;for(;t===this._updateAspectRoutineId&&this.aspectMode!==xh.None&&this.clip&&s===this.clip&&this._isPlaying;){if(!s||typeof s=="string")return;let r;for(const o of s.getVideoTracks()){const a=o.getSettings();if(a&&a.width&&a.height){r=a.width/a.height;break}else r=this.context.renderer.domElement.clientWidth/this.context.renderer.domElement.clientHeight}if(r===void 0){for(let o=0;o<10;o++)yield;if(!this.isPlaying)break;continue}if(i===r){yield;continue}for(const o of this._targetObjects){let a=1;if(o.parent){const c=br(o.parent);a=c.x/c.y}switch(this.aspectMode){case xh.AdjustHeight:o.scale.y=1/r*o.scale.x*a;break;case xh.AdjustWidth:o.scale.x=r*o.scale.y*a;break}}for(let o=0;o<3;o++)yield}}get shouldUseM3U8(){return this.url!=null&&this.url.endsWith(".m3u8")&&this.source===Xc.Url}ensureM3U8CanBePlayed(){if(!this.shouldUseM3U8)return;let t=document.head.querySelector("script[data-hls_library]");t?globalThis.Hls?this.onHlsAvailable():t.addEventListener("load",this.onHlsAvailable):(Jn&&console.log("HLS: load script"),t=document.createElement("script"),t.dataset.hls_library="hls.js",t.src="https://cdn.jsdelivr.net/npm/hls.js@1",t.addEventListener("load",this.onHlsAvailable),document.head.append(t))}}uo([x()],cs.prototype,"playOnAwake",void 0);uo([x()],cs.prototype,"aspectMode",void 0);uo([x(URL)],cs.prototype,"clip",void 0);uo([x()],cs.prototype,"source",void 0);uo([x(URL)],cs.prototype,"url",void 0);uo([x()],cs.prototype,"renderMode",void 0);uo([x()],cs.prototype,"targetMaterialProperty",void 0);uo([x(an)],cs.prototype,"targetMaterialRenderer",void 0);uo([x(Ft)],cs.prototype,"targetTexture",void 0);uo([x()],cs.prototype,"time",void 0);uo([x()],cs.prototype,"playbackSpeed",null);uo([x()],cs.prototype,"isLooping",null);uo([x()],cs.prototype,"audioOutputMode",null);class nre{constructor(e){u(this,"context");u(this,"_videos",[]);u(this,"_screenspaceModeQuad");u(this,"_isInScreenspaceMode",!1);u(this,"_input");this.context=e,this._input=new sre(this)}get enabled(){return this._isInScreenspaceMode}set enabled(e){e?this.start():this.stop()}add(e){this._videos.indexOf(e)===-1&&this._videos.push(e)}remove(e){if(!e)return;const t=this._videos.indexOf(e);t>=0&&this._videos.splice(t,1)}start(){var s;if(this._isInScreenspaceMode||this._videos.length<0)return;const e=this._videos[this._videos.length-1];if(!e)return;if(this._isInScreenspaceMode=!0,!this._screenspaceModeQuad){if(this._screenspaceModeQuad=yA.createPrimitive(fc.Quad,{material:new rre(e)}),!this._screenspaceModeQuad)return;this._screenspaceModeQuad.geometry.scale(2,2,2)}const t=this._screenspaceModeQuad;this.context.scene.add(t),this.updateScreenspaceMaterialUniforms();const i=t.material;i==null||i.reset(),(s=this._input)==null||s.enable(i)}stop(){var e;this._isInScreenspaceMode=!1,this._screenspaceModeQuad&&((e=this._input)==null||e.disable(),this._screenspaceModeQuad.removeFromParent())}updateScreenspaceMaterialUniforms(){var t;const e=(t=this._screenspaceModeQuad)==null?void 0:t.material;e&&(e.screenAspect=this.context.domElement.clientWidth/this.context.domElement.clientHeight)}}class sre{constructor(e){u(this,"_onResizeScreenFn");u(this,"_onKeyUpFn");u(this,"_onMouseWheelFn");u(this,"context");u(this,"overlay");u(this,"_material");u(this,"_isPinching",!1);u(this,"_lastPinch",0);this.overlay=e,this.context=e.context}enable(e){this._material=e,window.addEventListener("resize",this._onResizeScreenFn=()=>{this.overlay.updateScreenspaceMaterialUniforms()}),window.addEventListener("keyup",this._onKeyUpFn=s=>{s.key==="Escape"&&this.overlay.stop()}),window.addEventListener("wheel",this._onMouseWheelFn=s=>{this.overlay.enabled&&(e.zoom+=s.deltaY*5e-4,s.preventDefault())},{passive:!1});const t=new ie;window.addEventListener("mousemove",s=>{if(this.overlay.enabled&&this.context.input.getPointerPressed(0)){const r=new ie(s.movementX,s.movementY);r.x/=this.context.domElement.clientWidth,r.y/=this.context.domElement.clientHeight,t.set(r.x,r.y),t.multiplyScalar(e.zoom/-this.context.time.deltaTime*.01),e.offset=e.offset.add(t)}}),window.addEventListener("pointermove",s=>{this.overlay.enabled&&this.context.input.getPointerPressed(0)&&this.context.input.getTouchesPressedCount()===1&&(t.set(s.movementX,s.movementY),t.multiplyScalar(e.zoom*-this.context.time.deltaTime*.05),e.offset=e.offset.add(t))});let i=0;window.addEventListener("touchstart",s=>{if(s.touches.length<2){this.context.time.time-i<.3&&this.overlay.stop(),i=this.context.time.time;return}this._isPinching=!0,this._lastPinch=0}),window.addEventListener("touchmove",s=>{if(!this._isPinching||!this._material)return;const r=s.touches[0],o=s.touches[1],a=r.clientX-o.clientX,c=r.clientY-o.clientY,l=Math.sqrt(a*a+c*c);if(this._lastPinch!==0){const h=l-this._lastPinch;this._material.zoom-=h*.004}this._lastPinch=l}),window.addEventListener("touchend",()=>{this._isPinching=!1})}disable(){this._onResizeScreenFn&&(window.removeEventListener("resize",this._onResizeScreenFn),this._onResizeScreenFn=void 0),this._onKeyUpFn&&(window.removeEventListener("keyup",this._onKeyUpFn),this._onKeyUpFn=void 0),this._onMouseWheelFn&&(window.removeEventListener("wheel",this._onMouseWheelFn),this._onMouseWheelFn=void 0)}}class rre extends Et{constructor(t){super();u(this,"_offset",new ie);this.uniforms={map:{value:t},screenAspect:{value:1},offsetScale:{value:new tt(0,0,1,1)}},this.vertexShader=`
        uniform sampler2D map;
        uniform float screenAspect;
        uniform vec4 offsetScale;
        varying vec2 vUv;

        void main() {

            gl_Position = vec4( position , 1.0 );
            vUv = uv;
            vUv.y = 1. - vUv.y;

            // fit into screen
            ivec2 res = textureSize(map, 0);
            float videoAspect = float(res.x) / float(res.y);
            float aspect = videoAspect / screenAspect;
            if(aspect >= 1.0) 
            {
                vUv.y = vUv.y * aspect;
                float offset = (1. - aspect) * .5;
                vUv.y = vUv.y + offset;
            }
            else
            {
                vUv.x = vUv.x / aspect;
                float offset = (1. - 1. / aspect) * .5;
                vUv.x = vUv.x + offset;
            }

            vUv.x -= .5;
            vUv.y -= .5;

            vUv.x *= offsetScale.z;
            vUv.y *= offsetScale.z;
            vUv.x += offsetScale.x;
            vUv.y += offsetScale.y;

            vUv.x += .5;
            vUv.y += .5;
        }

        `,this.fragmentShader=`
        uniform sampler2D map;
        varying vec2 vUv;
        void main() {
            if(vUv.x < 0. || vUv.x > 1. || vUv.y < 0. || vUv.y > 1.)
                gl_FragColor = vec4(0., 0., 0., 1.);
            else
            {
                vec4 texcolor = texture2D(map, vUv);
                texcolor = LinearTosRGB(texcolor);
                gl_FragColor = texcolor;
            }
        }
        `}set screenAspect(t){this.uniforms.screenAspect.value=t,this.needsUpdate=!0}set offset(t){const i=this.uniforms.offsetScale.value;i.x=t.x,i.y=t.y,this.uniforms.offsetScale.value=i,this.needsUpdate=!0}get offset(){const t=this.uniforms.offsetScale.value;return this._offset.set(t.x,t.y),this._offset}set zoom(t){const i=this.uniforms.offsetScale.value;t<.001&&(t=.001),i.z=t,this.needsUpdate=!0}get zoom(){return this.uniforms.offsetScale.value.z}reset(){this.offset=this.offset.set(0,0),this.zoom=1,this.needsUpdate=!0}}var gw=globalThis&&globalThis.__decorate||function(n,e,t,i){var s=arguments.length,r=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(e,t,r):o(e,t))||r);return s>3&&r&&Object.defineProperty(e,t,r),r};const Cu=re("debugscreensharing");var Yc;(function(n){n[n.Screen=0]="Screen",n[n.Camera=1]="Camera",n[n.Canvas=2]="Canvas",n[n.Microphone=3]="Microphone"})(Yc||(Yc={}));var Xr;(function(n){n[n.Idle=0]="Idle",n[n.Sending=1]="Sending",n[n.Receiving=2]="Receiving"})(Xr||(Xr={}));class im extends Te{constructor(){super(...arguments);u(this,"allowStartOnClick",!0);u(this,"autoConnect",!1);u(this,"_videoPlayer");u(this,"_audioSource");u(this,"device",Yc.Screen);u(this,"_net");u(this,"_requestOpen",!1);u(this,"_currentStream",null);u(this,"_currentMode",Xr.Idle);u(this,"onJoinedRoom",async()=>{await ha(1e3),this.autoConnect&&!this.isSending&&!this.isReceiving&&this.context.connection.isInRoom&&this.share()});u(this,"_activeShareRequest",null);u(this,"onReceiveStream",t=>{var i;((i=t.stream)==null?void 0:i.active)===!0&&this.setStream(t.stream,Xr.Receiving)});u(this,"onCallEnded",t=>{Cu&&console.log("CALL ENDED",this.isReceiving,this==null?void 0:this.screenspace),this.isReceiving&&(this.screenspace=!1)})}onPointerEnter(){this.allowStartOnClick&&this.context.input.setCursorPointer()}onPointerExit(){this.allowStartOnClick&&this.context.input.setCursorNormal()}onPointerClick(t){var i;if(this.allowStartOnClick&&!(t&&t.pointerId!==0)){if(this.isReceiving&&((i=this.videoPlayer)!=null&&i.isPlaying)){this.videoPlayer&&(this.videoPlayer.screenspace=!this.videoPlayer.screenspace);return}if(this.isSending){this.close();return}this.share()}}set videoPlayer(t){this._videoPlayer&&(this.isSending||this.isReceiving)&&this._videoPlayer.stop(),this._videoPlayer=t,this._videoPlayer&&this._currentStream&&(this.isSending||this.isReceiving)&&this._videoPlayer.setVideo(this._currentStream)}get videoPlayer(){return this._videoPlayer}get screenspace(){var t;return((t=this.videoPlayer)==null?void 0:t.screenspace)??!1}set screenspace(t){this.videoPlayer&&(this.videoPlayer.screenspace=t)}get currentScream(){return this._currentStream}get currentMode(){return this._currentMode}get isSending(){var t;return((t=this._currentStream)==null?void 0:t.active)&&this._currentMode===Xr.Sending}get isReceiving(){if(this._currentMode===Xr.Receiving){if(!this._currentStream||this._currentStream.active===!1)return!1;const t=this._currentStream.getTracks();for(const i of t)if(i.readyState==="live")return!0}return!1}get requiresVideoPlayer(){return this.device!==Yc.Microphone}awake(){Cu&&console.log("Screensharing",this.name,this),Ti.registerWaitForAllowAudio(()=>{this._videoPlayer&&this._currentStream&&this._currentMode===Xr.Receiving&&(this._videoPlayer.playInBackground=!0,this._videoPlayer.setVideo(this._currentStream))});const t=xg.getOrCreate(this.context,this.guid);this._net=new zx(this.context,t)}onEnable(){var t,i,s;(t=this._net)==null||t.enable(),(i=this._net)==null||i.addEventListener(fn.StreamReceived,this.onReceiveStream),(s=this._net)==null||s.addEventListener(fn.StreamEnded,this.onCallEnded),this.context.connection.beginListen(Xt.JoinedRoom,this.onJoinedRoom),this.autoConnect&&ha(1e3).then(()=>(this.enabled&&this.autoConnect&&!this.isReceiving&&!this.isSending&&this.context.connection.isInRoom&&this.share(),0))}onDisable(){var t,i,s;(t=this._net)==null||t.removeEventListener(fn.StreamReceived,this.onReceiveStream),(i=this._net)==null||i.removeEventListener(fn.StreamEnded,this.onCallEnded),this.context.connection.stopListen(Xt.JoinedRoom,this.onJoinedRoom),(s=this._net)==null||s.disable(),this.close()}_ensureVideoPlayer(){const t=new cs;t.aspectMode=xh.AdjustWidth,le.addComponent(this.gameObject,t),this._videoPlayer=t}async share(t){return this._activeShareRequest?this._activeShareRequest:(this._activeShareRequest=this.internalShare(t),this._activeShareRequest.then(()=>this._activeShareRequest=null))}async internalShare(t){if(this.context.connection.isInRoom===!1){console.warn("Can not start screensharing: requires network connection");return}if(t!=null&&t.device&&(this.device=t.device),!this.videoPlayer&&this.requiresVideoPlayer&&(this._videoPlayer||(this._videoPlayer=le.getComponent(this.gameObject,cs)??void 0),this.videoPlayer||this._ensureVideoPlayer(),!this.videoPlayer)){console.warn("Can not share video without a videoPlayer assigned");return}this._requestOpen=!0;try{const i=(t==null?void 0:t.constraints)??{echoCancellation:!0,autoGainControl:!1},s={video:i,audio:i},r=s.video;switch(r!==void 0&&typeof r!="boolean"&&(r.width||(r.width={max:1920}),r.height||(r.height={max:1920}),r.aspectRatio||(r.aspectRatio={ideal:1.7777777778}),r.frameRate||(r.frameRate={ideal:24}),r.facingMode||(r.facingMode={ideal:"user"})),this.device){case Yc.Camera:this.tryShareUserCamera(s,t);break;case Yc.Screen:{if(!navigator.mediaDevices.getDisplayMedia){console.error("No getDisplayMedia support");return}const c=await navigator.mediaDevices.getDisplayMedia(s);this._requestOpen?this.setStream(c,Xr.Sending):Eh(c)}break;case Yc.Canvas:const o=0,a=this.context.renderer.domElement.captureStream(o);this.setStream(a,Xr.Sending);break;case Yc.Microphone:{if(!navigator.mediaDevices.getUserMedia){console.error("No getDisplayMedia support");return}s.video=!1;const c=await navigator.mediaDevices.getUserMedia(s);this._requestOpen?this.setStream(c,Xr.Sending):Eh(c)}break}}catch(i){if(i.name==="NotAllowedError"){console.log("Selection cancelled"),this._requestOpen=!1;return}console.error("Error opening video",i)}}close(){var t;this._requestOpen=!1,this._currentStream&&(Cu&&console.warn("Close current stream / disposing resources, stream was active?",this._currentStream.active),(t=this._net)==null||t.stopSendingStream(this._currentStream),Eh(this._currentStream),this._currentMode=Xr.Idle,this._currentStream=null)}setStream(t,i){var o,a,c;if(t===this._currentStream||(this.close(),!t))return;this._currentStream=t,this._requestOpen=!0,this._currentMode=i;const s=this.device!==Yc.Microphone,r=i===Xr.Sending;s?(this._videoPlayer||this._ensureVideoPlayer(),this._videoPlayer?this._videoPlayer.setVideo(t):console.error("No video player assigned for video stream")):(this._audioSource||(this._audioSource=new Ti,this._audioSource.spatialBlend=0,this._audioSource.volume=1,this.gameObject.addComponent(this._audioSource)),r||(console.log("PLAY",t.getAudioTracks()),this._audioSource.volume=1,(o=this._audioSource)==null||o.play(t))),r&&((a=this._net)==null||a.startSendingStream(t)),r&&(this._videoPlayer&&(this._videoPlayer.muted=!0),(c=this._audioSource)==null||c.stop());for(const l of t.getTracks())l.addEventListener("ended",()=>{Cu&&console.log("Track ended",l),this.close()}),Cu&&l.kind==="video"&&console.log(r?"Video ":"Video ",l.getSettings())}async tryShareUserCamera(t,i){var r;const s=(await navigator.mediaDevices.enumerateDevices()).filter(o=>o.kind==="videoinput");Cu&&console.log("Request camera",s);for(const o of s)try{if(!this._requestOpen)break;if(o.kind!=="videoinput")continue;const a=o.deviceId;if((i==null?void 0:i.deviceId)!==void 0&&a!==i.deviceId||((r=i==null?void 0:i.deviceFilter)==null?void 0:r.call(this,o))===!1)continue;t.video!==!1&&((typeof t.video>"u"||typeof t.video=="boolean")&&(t.video={}),t.video.deviceId=a);const l=await navigator.mediaDevices.getUserMedia(t);this._requestOpen?this.setStream(l,Xr.Sending):Eh(l),Cu&&console.log("Selected camera",o);break}catch(a){if(a.message==="Failed to allocate videosource"||a.message==="Could not start video source"){gn("Failed to start video: Try another camera (Code "+a.code+")"),console.warn(a);continue}else console.error("Failed to get user media",a.message,a.code,a)}}}gw([x()],im.prototype,"allowStartOnClick",void 0);gw([x()],im.prototype,"autoConnect",void 0);gw([x(cs)],im.prototype,"videoPlayer",null);gw([x()],im.prototype,"device",void 0);var Tv=globalThis&&globalThis.__decorate||function(n,e,t,i){var s=arguments.length,r=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(e,t,r):o(e,t))||r);return s>3&&r&&Object.defineProperty(e,t,r),r};class iu extends xr{constructor(){super(...arguments);u(this,"intensity");u(this,"falloff");u(this,"samples");u(this,"color");u(this,"luminanceInfluence");u(this,"_ssao")}get typeName(){return"ScreenSpaceAmbientOcclusion"}onBeforeRender(){if(this._ssao&&this.context.mainCamera instanceof Wt){const t=this.context.mainCamera.far-this.context.mainCamera.near;this._ssao.ssaoMaterial.worldDistanceFalloff=t*.01,this._ssao.ssaoMaterial.worldDistanceThreshold=this.context.mainCamera.far}}onCreateEffect(){const t=this.context.mainCamera,i=new FF(this.context.scene,t),s=new c1({normalBuffer:i.texture,resolutionScale:.5}),r=this._ssao=new QF(t,i.texture,{normalDepthBuffer:s.texture,worldDistanceThreshold:1,worldDistanceFalloff:1,worldProximityThreshold:.1,worldProximityFalloff:2,intensity:1,blendFunction:Gt.MULTIPLY,luminanceInfluence:.5});this.intensity.onValueChanged=a=>{r.intensity=a},this.falloff.onValueChanged=a=>{r.ssaoMaterial.radius=a*.1},this.samples.onValueChanged=a=>{r.samples=a},this.color.onValueChanged=a=>{r.color||(r.color=new ye),r.color.copy(a)},this.luminanceInfluence.onValueChanged=a=>{r.luminanceInfluence=a};const o=new Array;return o.push(i),o.push(s),o.push(r),o}}Tv([x(It)],iu.prototype,"intensity",void 0);Tv([x(It)],iu.prototype,"falloff",void 0);Tv([x(It)],iu.prototype,"samples",void 0);Tv([x(It)],iu.prototype,"color",void 0);Tv([x(It)],iu.prototype,"luminanceInfluence",void 0);_a("ScreenSpaceAmbientOcclusion",iu);var kd=globalThis&&globalThis.__decorate||function(n,e,t,i){var s=arguments.length,r=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(e,t,r):o(e,t))||r);return s>3&&r&&Object.defineProperty(e,t,r),r},Pg;(function(n){n[n.Performance=0]="Performance",n[n.Low=1]="Low",n[n.Medium=2]="Medium",n[n.High=3]="High",n[n.Ultra=4]="Ultra"})(Pg||(Pg={}));class Ec extends xr{constructor(){super(...arguments);u(this,"gammaCorrection",!0);u(this,"intensity");u(this,"falloff");u(this,"aoRadius");u(this,"screenspaceRadius",!1);u(this,"color");u(this,"quality",Pg.Medium);u(this,"_ssao")}get typeName(){return"ScreenSpaceAmbientOcclusionN8"}onValidate(){this._ssao&&(this._ssao.setQualityMode(Pg[this.quality]),this._ssao.configuration.gammaCorrection=this.gammaCorrection,this._ssao.configuration.screenSpaceRadius=this.screenspaceRadius)}onCreateEffect(){const t=this.context.mainCamera,i=this._ssao=new dG(this.context.scene,t,this.context.domWidth,this.context.domHeight),s=Pg[this.quality];i.setQualityMode(s),i.configuration.gammaCorrection=this.gammaCorrection,i.configuration.screenSpaceRadius=this.screenspaceRadius,this.intensity.onValueChanged=o=>{i.configuration.intensity=o},this.falloff.onValueChanged=o=>{i.configuration.distanceFalloff=o},this.aoRadius.onValueChanged=o=>{i.configuration.aoRadius=o},this.color.onValueChanged=o=>{i.color||(i.color=new ye),i.configuration.color.copy(o)};const r=new Array;return r.push(i),r}}kd([Ks(),x()],Ec.prototype,"gammaCorrection",void 0);kd([x(It)],Ec.prototype,"intensity",void 0);kd([x(It)],Ec.prototype,"falloff",void 0);kd([x(It)],Ec.prototype,"aoRadius",void 0);kd([Ks(),x()],Ec.prototype,"screenspaceRadius",void 0);kd([x(It)],Ec.prototype,"color",void 0);kd([Ks(),x()],Ec.prototype,"quality",void 0);_a("ScreenSpaceAmbientOcclusionN8",Ec);var pG=globalThis&&globalThis.__decorate||function(n,e,t,i){var s=arguments.length,r=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(e,t,r):o(e,t))||r);return s>3&&r&&Object.defineProperty(e,t,r),r},Qf;(function(n){n[n.ShadowMask=0]="ShadowMask",n[n.Additive=1]="Additive",n[n.Occluder=2]="Occluder"})(Qf||(Qf={}));class Aw extends Te{constructor(){super(...arguments);u(this,"mode",Qf.ShadowMask);u(this,"shadowColor",new Ii(0,0,0,1));u(this,"targetMesh")}awake(){if(this.gameObject instanceof me)this.gameObject instanceof me&&this.gameObject.material&&(this.gameObject.material=this.gameObject.material.clone(),this.targetMesh=this.gameObject);else{const t=yA.createPrimitive(fc.Quad,{name:"ShadowCatcher",material:new Ur({color:10066329,roughness:1,metalness:0,transparent:!0})});t.receiveShadow=!0,t.geometry.rotateX(-Math.PI/2),this.gameObject.add(t),this.targetMesh=t}if(!this.targetMesh){console.warn("ShadowCatcher: no mesh to apply shadow catching to. Groups are currently not supported.");return}switch(this.mode){case Qf.ShadowMask:this.applyShadowMaterial();break;case Qf.Additive:this.applyLightBlendMaterial();break;case Qf.Occluder:this.applyOccluderMaterial();break}}applyLightBlendMaterial(){if(!this.targetMesh)return;const t=this.targetMesh.material;t.blending=cd,this.applyMaterialOptions(t),t.onBeforeCompile=i=>{i.fragmentShader=i.fragmentShader.replace("vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;",`vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
            // diffuse-only lighting with overdrive to somewhat compensate
            // for the loss of indirect lighting and to make it more visible.
            vec3 direct = (reflectedLight.directDiffuse + reflectedLight.directSpecular) * 6.6;
            float max = max(direct.r, max(direct.g, direct.b));
            
            // early out - we're simply returning direct lighting and some alpha based on it so it can 
            // be blended onto the scene.
            gl_FragColor = vec4(direct, max);
            return;
            `)}}applyShadowMaterial(){if(this.targetMesh)if(this.targetMesh.material.type!=="ShadowMaterial"){const t=new W_;t.color=this.shadowColor,t.opacity=this.shadowColor.alpha,this.applyMaterialOptions(t),this.targetMesh.material=t}else{const t=this.targetMesh.material;t.color=this.shadowColor,t.opacity=this.shadowColor.alpha,this.applyMaterialOptions(t)}}applyOccluderMaterial(){if(this.targetMesh){let t=this.targetMesh.material;if(!t){const i=new ri;this.targetMesh.material=i,t=i}t.depthWrite=!0,t.stencilWrite=!0,t.colorWrite=!1,this.gameObject.renderOrder=-100}}applyMaterialOptions(t){t&&(t.depthWrite=!1,t.stencilWrite=!1)}}pG([x()],Aw.prototype,"mode",void 0);pG([x(Ii)],Aw.prototype,"shadowColor",void 0);var vw=globalThis&&globalThis.__decorate||function(n,e,t,i){var s=arguments.length,r=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(e,t,r):o(e,t))||r);return s>3&&r&&Object.defineProperty(e,t,r),r};const AR=class extends Te{constructor(){super(...arguments);u(this,"target",null);u(this,"followFactor",.1);u(this,"rotateFactor",.1);u(this,"positionAxes",Lf.All);u(this,"flipForward",!1);u(this,"_firstUpdate",!0)}onBeforeRender(){this.updateNow(!1)}updateNow(t){if(!(!this.target||this.target===this.gameObject)){if(this.followFactor>0){const i=Ht(this.target),s=this._firstUpdate||t?1:nt.clamp01(this.context.time.deltaTime*this.followFactor),r=this.worldPosition;this.positionAxes&Lf.X&&(r.x=nt.lerp(r.x,i.x,s)),this.positionAxes&Lf.Y&&(r.y=nt.lerp(r.y,i.y,s)),this.positionAxes&Lf.Z&&(r.z=nt.lerp(r.z,i.z,s)),this.worldPosition=r}if(this.rotateFactor>0){const i=In(this.target);this.flipForward&&i.premultiply(AR._invertForward);const s=this._firstUpdate||t?1:nt.clamp01(this.context.time.deltaTime*this.rotateFactor);this.worldQuaternion=this.worldQuaternion.slerp(i,s)}this._firstUpdate=!1}}};let pc=AR;u(pc,"_invertForward",new Me().setFromAxisAngle(new w(0,1,0),Math.PI));vw([x(ge)],pc.prototype,"target",void 0);vw([x()],pc.prototype,"followFactor",void 0);vw([x()],pc.prototype,"rotateFactor",void 0);vw([x()],pc.prototype,"positionAxes",void 0);class ore extends me{constructor(e){const t=new are(e),i=new Wn(t.image.width*.001,t.image.height*.001),s=new ri({map:t,toneMapped:!1,transparent:!0});super(i,s);function r(o){s.map.dispatchDOMEvent(o)}this.addEventListener("mousedown",r),this.addEventListener("mousemove",r),this.addEventListener("mouseup",r),this.addEventListener("click",r),this.dispose=function(){i.dispose(),s.dispose(),s.map.dispose(),KT.delete(e),this.removeEventListener("mousedown",r),this.removeEventListener("mousemove",r),this.removeEventListener("mouseup",r),this.removeEventListener("click",r)}}}class are extends RM{constructor(e){super(Xk(e)),this.dom=e,this.anisotropy=16,this.colorSpace=zt,this.minFilter=St,this.magFilter=St;const t=new MutationObserver(()=>{this.scheduleUpdate||(this.scheduleUpdate=setTimeout(()=>this.update(),16))}),i={attributes:!0,childList:!0,subtree:!0,characterData:!0};t.observe(e,i),this.observer=t}dispatchDOMEvent(e){e.data&&cre(this.dom,e.type,e.data.x,e.data.y)}update(){this.image=Xk(this.dom),this.needsUpdate=!0,this.scheduleUpdate=null}dispose(){this.observer&&this.observer.disconnect(),this.scheduleUpdate=clearTimeout(this.scheduleUpdate),super.dispose()}}const KT=new WeakMap;function Xk(n){const e=document.createRange(),t=new ye;function i(f){const p=[];let m=!1;function g(){if(m&&(m=!1,f.restore()),p.length===0)return;let y=-1/0,A=-1/0,v=1/0,b=1/0;for(let _=0;_<p.length;_++){const T=p[_];y=Math.max(y,T.x),A=Math.max(A,T.y),v=Math.min(v,T.x+T.width),b=Math.min(b,T.y+T.height)}f.save(),f.beginPath(),f.rect(y,A,v-y,b-A),f.clip(),m=!0}return{add:function(y){p.push(y),g()},remove:function(){p.pop(),g()}}}function s(f,p,m,g){g!==""&&(f.textTransform==="uppercase"&&(g=g.toUpperCase()),h.font=f.fontWeight+" "+f.fontSize+" "+f.fontFamily,h.textBaseline="top",h.fillStyle=f.color,h.fillText(g,p,m+parseFloat(f.fontSize)*.1))}function r(f,p,m,g,y){m<2*y&&(y=m/2),g<2*y&&(y=g/2),h.beginPath(),h.moveTo(f+y,p),h.arcTo(f+m,p,f+m,p+g,y),h.arcTo(f+m,p+g,f,p+g,y),h.arcTo(f,p+g,f,p,y),h.arcTo(f,p,f+m,p,y),h.closePath()}function o(f,p,m,g,y,A){const v=f[p+"Width"],b=f[p+"Style"],_=f[p+"Color"];v!=="0px"&&b!=="none"&&_!=="transparent"&&_!=="rgba(0, 0, 0, 0)"&&(h.strokeStyle=_,h.lineWidth=parseFloat(v),h.beginPath(),h.moveTo(m,g),h.lineTo(m+y,g+A),h.stroke())}function a(f,p){let m=0,g=0,y=0,A=0;if(f.nodeType===Node.TEXT_NODE){e.selectNode(f);const b=e.getBoundingClientRect();m=b.left-c.left-.5,g=b.top-c.top-.5,y=b.width,A=b.height,s(p,m,g,f.nodeValue.trim())}else{if(f.nodeType===Node.COMMENT_NODE)return;if(f instanceof HTMLCanvasElement){if(f.style.display==="none")return;const b=f.getBoundingClientRect();m=b.left-c.left-.5,g=b.top-c.top-.5,h.save();const _=window.devicePixelRatio;h.scale(1/_,1/_),h.drawImage(f,m,g),h.restore()}else if(f instanceof HTMLImageElement){if(f.style.display==="none")return;const b=f.getBoundingClientRect();m=b.left-c.left-.5,g=b.top-c.top-.5,y=b.width,A=b.height,h.drawImage(f,m,g,y,A)}else{if(f.style.display==="none")return;const b=f.getBoundingClientRect();m=b.left-c.left-.5,g=b.top-c.top-.5,y=b.width,A=b.height,p=window.getComputedStyle(f),r(m,g,y,A,parseFloat(p.borderRadius));const _=p.backgroundColor;_!=="transparent"&&_!=="rgba(0, 0, 0, 0)"&&(h.fillStyle=_,h.fill());const T=["borderTop","borderLeft","borderBottom","borderRight"];let E=!0,M=null;for(const I of T){if(M!==null&&(E=p[I+"Width"]===p[M+"Width"]&&p[I+"Color"]===p[M+"Color"]&&p[I+"Style"]===p[M+"Style"]),E===!1)break;M=I}if(E===!0){const I=parseFloat(p.borderTopWidth);p.borderTopWidth!=="0px"&&p.borderTopStyle!=="none"&&p.borderTopColor!=="transparent"&&p.borderTopColor!=="rgba(0, 0, 0, 0)"&&(h.strokeStyle=p.borderTopColor,h.lineWidth=I,h.stroke())}else o(p,"borderTop",m,g,y,0),o(p,"borderLeft",m,g,0,A),o(p,"borderBottom",m,g+A,y,0),o(p,"borderRight",m+y,g,0,A);if(f instanceof HTMLInputElement){let I=p.accentColor;(I===void 0||I==="auto")&&(I=p.color),t.set(I);const C=Math.sqrt(.299*t.r**2+.587*t.g**2+.114*t.b**2)<.5?"white":"#111111";if(f.type==="radio"&&(r(m,g,y,A,A),h.fillStyle="white",h.strokeStyle=I,h.lineWidth=1,h.fill(),h.stroke(),f.checked&&(r(m+2,g+2,y-4,A-4,A),h.fillStyle=I,h.strokeStyle=C,h.lineWidth=2,h.fill(),h.stroke())),f.type==="checkbox"&&(r(m,g,y,A,2),h.fillStyle=f.checked?I:"white",h.strokeStyle=f.checked?C:I,h.lineWidth=1,h.stroke(),h.fill(),f.checked)){const D=h.textAlign;h.textAlign="center";const G={color:C,fontFamily:p.fontFamily,fontSize:A+"px",fontWeight:"bold"};s(G,m+y/2,g,""),h.textAlign=D}if(f.type==="range"){const[D,G,Q]=["min","max","value"].map(V=>parseFloat(f[V])),L=(Q-D)/(G-D)*(y-A);r(m,g+A/4,y,A/2,A/4),h.fillStyle=C,h.strokeStyle=I,h.lineWidth=1,h.fill(),h.stroke(),r(m,g+A/4,L+A/2,A/2,A/4),h.fillStyle=I,h.fill(),r(m+L,g,A,A,A/2),h.fillStyle=I,h.fill()}(f.type==="color"||f.type==="text"||f.type==="number")&&(d.add({x:m,y:g,width:y,height:A}),s(p,m+parseInt(p.paddingLeft),g+parseInt(p.paddingTop),f.value),d.remove())}}}const v=p.overflow==="auto"||p.overflow==="hidden";v&&d.add({x:m,y:g,width:y,height:A});for(let b=0;b<f.childNodes.length;b++)a(f.childNodes[b],p);v&&d.remove()}const c=n.getBoundingClientRect();let l=KT.get(n);l===void 0&&(l=document.createElement("canvas"),l.width=c.width,l.height=c.height,KT.set(n,l));const h=l.getContext("2d"),d=new i(h);return h.clearRect(0,0,l.width,l.height),a(n),l}function cre(n,e,t,i){const s={clientX:t*n.offsetWidth+n.offsetLeft,clientY:i*n.offsetHeight+n.offsetTop,view:n.ownerDocument.defaultView};window.dispatchEvent(new MouseEvent(e,s));const r=n.getBoundingClientRect();t=t*r.width+r.left,i=i*r.height+r.top;function o(a){if(a.nodeType!==Node.TEXT_NODE&&a.nodeType!==Node.COMMENT_NODE){const c=a.getBoundingClientRect();if(t>c.left&&t<c.right&&i>c.top&&i<c.bottom&&(a.dispatchEvent(new MouseEvent(e,s)),a instanceof HTMLInputElement&&a.type==="range"&&(e==="mousedown"||e==="click"))){const[l,h]=["min","max"].map(m=>parseFloat(a[m])),d=c.width,p=(t-c.x)/d;a.value=l+(h-l)*p,a.dispatchEvent(new InputEvent("input",{bubbles:!0}))}for(let l=0;l<a.childNodes.length;l++)o(a.childNodes[l])}}o(n)}const Y0=new ie,mf={type:"",data:Y0};class lre extends fr{constructor(e,t){super();const i=this,s=new Pp,r=new Ce,o=e.domElement;function a(f){f.stopPropagation();const p=e.domElement.getBoundingClientRect();Y0.x=(f.clientX-p.left)/p.width*2-1,Y0.y=-(f.clientY-p.top)/p.height*2+1,s.setFromCamera(Y0,t);const m=s.intersectObjects(i.children,!1);if(m.length>0){const g=m[0],y=g.object,A=g.uv;mf.type=f.type,mf.data.set(A.x,1-A.y),y.dispatchEvent(mf)}}o.addEventListener("pointerdown",a),o.addEventListener("pointerup",a),o.addEventListener("pointermove",a),o.addEventListener("mousedown",a),o.addEventListener("mouseup",a),o.addEventListener("mousemove",a),o.addEventListener("click",a);const c={move:"mousemove",select:"click",selectstart:"mousedown",selectend:"mouseup"};function l(f){const p=f.target;r.identity().extractRotation(p.matrixWorld),s.ray.origin.setFromMatrixPosition(p.matrixWorld),s.ray.direction.set(0,0,-1).applyMatrix4(r);const m=s.intersectObjects(i.children,!1);if(m.length>0){const g=m[0],y=g.object,A=g.uv;mf.type=c[f.type],mf.data.set(A.x,1-A.y),y.dispatchEvent(mf)}}const h=e.xr.getController(0);h.addEventListener("move",l),h.addEventListener("select",l),h.addEventListener("selectstart",l),h.addEventListener("selectend",l);const d=e.xr.getController(1);d.addEventListener("move",l),d.addEventListener("select",l),d.addEventListener("selectstart",l),d.addEventListener("selectend",l)}}class mG extends Te{constructor(){super(...arguments);u(this,"id",null);u(this,"keepAspect",!1)}start(){if(!this.id||!this.context.mainCamera)return;const t=document.getElementById(this.id);if(!t){console.warn('Could not find element with id "'+this.id+'"');return}t.style.display="block",t.style.visibility="hidden";const i=new lre(this.context.renderer,this.context.mainCamera);this.gameObject.add(i);const s=new ore(t);i.add(s),s.visible=!1,console.log(s);const r=s.material;r.transparent=!0,setTimeout(()=>{s.visible=!0;const o=_x(this.gameObject).clone();xx(this.gameObject,0,0,0),this.gameObject.updateMatrixWorld();const a=new Mi;a.setFromObject(i),this.setWorldRotation(o.x,o.y,o.z);const c=a.max.x-a.min.x,l=a.max.y-a.min.y;if(this.keepAspect){const d=c/l;c>l?s.scale.set(1/c,1/l/d,1):s.scale.set(1/c*d,1/l,1)}else s.scale.set(1/c,1/l,1);const h=this.gameObject.scale;s.scale.multiply(h)},1)}}var Mv=globalThis&&globalThis.__decorate||function(n,e,t,i){var s=arguments.length,r=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(e,t,r):o(e,t))||r);return s>3&&r&&Object.defineProperty(e,t,r),r};const Bg=re("debugspatialtrigger"),Yk=new Ar,Jk=new Ar;function hre(n,e){return Yk.mask=n,Jk.mask=e,Yk.test(Jk)}class bl extends Te{constructor(){super(...arguments);u(this,"triggerMask",0);u(this,"onEnter");u(this,"onStay");u(this,"onExit");u(this,"currentIntersected",[]);u(this,"lastIntersected",[])}start(){Bg&&console.log(this.name,this.triggerMask,this)}update(){this.currentIntersected.length=0;for(const t of od.triggers)hre(t.triggerMask,this.triggerMask)&&t.test(this.gameObject)&&this.currentIntersected.push(t);for(let t=this.lastIntersected.length-1;t>=0;t--){const i=this.lastIntersected[t];this.currentIntersected.indexOf(i)<0&&(this.onExitTrigger(i),this.lastIntersected.splice(t,1))}for(const t of this.currentIntersected)this.lastIntersected.indexOf(t)<0&&this.onEnterTrigger(t),this.onStayTrigger(t);this.lastIntersected.length=0,this.lastIntersected.push(...this.currentIntersected)}onEnterTrigger(t){var i;Bg&&console.log("ENTER TRIGGER",this.name,t.name,this,t),t.raiseOnEnterEvent(this),(i=this.onEnter)==null||i.invoke(this,t)}onExitTrigger(t){var i;Bg&&console.log("EXIT TRIGGER",this.name,t.name,this,t),t.raiseOnExitEvent(this),(i=this.onExit)==null||i.invoke(this,t)}onStayTrigger(t){var i;t.raiseOnStayEvent(this),(i=this.onStay)==null||i.invoke(this,t)}}Mv([x()],bl.prototype,"triggerMask",void 0);Mv([x(Cs)],bl.prototype,"onEnter",void 0);Mv([x(Cs)],bl.prototype,"onStay",void 0);Mv([x(Cs)],bl.prototype,"onExit",void 0);const zg=class extends Te{constructor(){super(...arguments);u(this,"triggerMask");u(this,"boxHelper")}start(){Bg&&console.log(this.name,this.triggerMask,this)}onEnable(){var t;zg.triggers.push(this),this.boxHelper||(this.boxHelper=le.addNewComponent(this.gameObject,ra),(t=this.boxHelper)==null||t.showHelper(null,Bg))}onDisable(){zg.triggers.splice(zg.triggers.indexOf(this),1)}test(t){return this.boxHelper?this.boxHelper.isInBox(t)??!1:!1}raiseOnEnterEvent(t){le.foreachComponent(this.gameObject,i=>{i!==t&&i instanceof bl&&i.onEnterTrigger(this)},!1)}raiseOnStayEvent(t){le.foreachComponent(this.gameObject,i=>{i!==t&&i instanceof bl&&i.onStayTrigger(this)},!1)}raiseOnExitEvent(t){le.foreachComponent(this.gameObject,i=>{i!==t&&i instanceof bl&&i.onExitTrigger(this)},!1)}};let od=zg;u(od,"triggers",[]);Mv([x()],od.prototype,"triggerMask",void 0);var ure=globalThis&&globalThis.__decorate||function(n,e,t,i){var s=arguments.length,r=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(e,t,r):o(e,t))||r);return s>3&&r&&Object.defineProperty(e,t,r),r},wp;(function(n){n[n.FirstPerson=0]="FirstPerson",n[n.ThirdPerson=1]="ThirdPerson"})(wp||(wp={}));const Kr=re("debugspectator");class $I extends Te{constructor(){super(...arguments);u(this,"cam",null);u(this,"useKeys",!0);u(this,"_mode",wp.FirstPerson);u(this,"orbit",null);u(this,"_handler");u(this,"eventSub_WebXRRequestStartEvent",null);u(this,"eventSub_WebXRStartEvent",null);u(this,"eventSub_WebXREndEvent",null);u(this,"_debug");u(this,"_networking")}get mode(){return this._mode}set mode(t){this._mode=t}get isSpectating(){var t;return((t=this._handler)==null?void 0:t.currentTarget)!==void 0}isSpectatingUser(t){var i;return((i=this.target)==null?void 0:i.userId)===t}isFollowedBy(t){var i;return(i=this.followers)==null?void 0:i.includes(t)}get followers(){return this._networking.followers}stopSpectating(){if(this.context.isInXR){this.followSelf();return}this.target=void 0}get localId(){return this.context.connection.connectionId??"local"}set target(t){var i;if(this._handler){const s=(i=this._handler.currentTarget)==null?void 0:i.userId,r=this.context.players.getPlayerView(this.localId);t===void 0||this.context.isInXR===!1&&(r==null?void 0:r.currentObject)===t.currentObject?this._handler.currentTarget!==void 0&&(this._handler.disable(),le.setActive(this.gameObject,!1),this.orbit&&(this.orbit.enabled=!0),this._networking.onSpectatedObjectChanged(t,s)):this._handler.currentTarget!==t&&(this._handler.set(t),le.setActive(this.gameObject,!0),this.orbit&&(this.orbit.enabled=!1),this._networking.onSpectatedObjectChanged(t,s))}}get target(){var t;return(t=this._handler)==null?void 0:t.currentTarget}requestAllFollowMe(){this._networking.onRequestFollowMe()}get isSpectatingSelf(){var t,i;return this.isSpectating&&((t=this.target)==null?void 0:t.currentObject)===((i=this.context.players.getPlayerView(this.localId))==null?void 0:i.currentObject)}awake(){if(this._debug=new pre(this.context,this),this._networking=new Are(this.context,this),this._networking.awake(),le.setActive(this.gameObject,!1),this.cam=le.getComponent(this.gameObject,Di),!this.cam){console.warn("SpectatorCamera: Spectator camera needs camera component on the same object.",this);return}!this._handler&&this.cam&&(this._handler=new dre(this.context,this.cam,this)),this.orbit=le.getComponent(this.context.mainCamera,$i)}onDestroy(){var t,i;this.stopSpectating(),(t=this._handler)==null||t.destroy(),(i=this._networking)==null||i.destroy()}isSupportedPlatform(){const t=window.navigator.userAgent,i=/Windows|MacOS/.test(t),s=/Windows NT/.test(t)&&/Edg/.test(t)&&!/Win64/.test(t);return i&&!s}onBeforeXR(t){this.isSupportedPlatform()&&le.setActive(this.gameObject,!0)}onEnterXR(t){this.isSupportedPlatform()&&(Kr&&console.log(this.context.mainCamera),this.context.mainCamera&&this.followSelf())}onLeaveXR(t){var i,s;this.context.removeCamera(this.cam),le.setActive(this.gameObject,!1),this.orbit&&(this.orbit.enabled=!0),(i=this._handler)==null||i.set(void 0),(s=this._handler)==null||s.disable(),this.isSpectatingSelf&&this.stopSpectating()}followSelf(){this.target=this.context.players.getPlayerView(this.context.connection.connectionId),this.target||(this.context.players.setPlayerView(this.localId,this.context.mainCamera,gl.Headset),this.target=this.context.players.getPlayerView(this.localId)),Kr&&console.log("Follow self",this.target)}onAfterRender(){var h,d,f;if(!this.cam)return;const t=this.context.renderer,i=t.xr.enabled;if(!t.xr.isPresenting&&!((h=this._handler)!=null&&h.currentTarget))return;(d=this._handler)==null||d.update(this._mode);const s=t.getRenderTarget();let r=null;const o=t.state;if(!s){if(!t.state.bindFramebuffer||!o.bindXRFramebuffer)return;r=t._framebuffer,o.bindXRFramebuffer(null)}this.setAvatarFlagsBeforeRender();const a=this.context.mainCameraComponent;if(a){const p=a.backgroundColor;p&&t.setClearColor(p,p.alpha),this.cam.backgroundColor=p,this.cam.clearFlags=a.clearFlags,this.cam.nearClipPlane=a.nearClipPlane,this.cam.farClipPlane=a.farClipPlane}else t.setClearColor(new ye(1,1,1));t.setRenderTarget(null),t.xr.enabled=!1;const c=(f=this.cam)==null?void 0:f.cam;this.context.updateAspect(c);const l=t.xr.isPresenting;t.xr.isPresenting=!1,t.setSize(this.context.domWidth,this.context.domHeight),t.render(this.context.scene,c),t.xr.isPresenting=l,t.xr.enabled=i,s?t.setRenderTarget(s):o.bindXRFramebuffer&&o.bindXRFramebuffer(r),this.resetAvatarFlags()}setAvatarFlagsBeforeRender(){const t=this._mode===wp.FirstPerson;for(const i of ns.instances)if(i.avatar&&"isLocalAvatar"in i.avatar&&"flags"in i.avatar){let s=Do.All;this.isSpectatingSelf&&(s=t&&i.avatar.isLocalAvatar?Do.FirstPerson:Do.ThirdPerson);const r=i.avatar.flags;if(!r)continue;for(const o of r)o.UpdateVisible(s)}}resetAvatarFlags(){var t;for(const i of ns.instances)if(i.avatar&&"flags"in i.avatar){const s=i.avatar.flags;if(!s)continue;for(const r of s)"isLocalAvatar"in i.avatar&&((t=i.avatar)!=null&&t.isLocalAvatar)?r.UpdateVisible(Do.FirstPerson):r.UpdateVisible(Do.ThirdPerson)}}}ure([x()],$I.prototype,"useKeys",void 0);class dre{constructor(e,t,i){u(this,"context");u(this,"cam");u(this,"spectator");u(this,"follow");u(this,"target");u(this,"view");u(this,"currentObject");this.context=e,this.cam=t,this.spectator=i}get currentTarget(){return this.view}set(e){const t=e==null?void 0:e.currentObject;if(!t){this.spectator.stopSpectating();return}t!==this.currentObject&&(this.currentObject=t,this.view=e,this.follow||(this.follow=le.addNewComponent(this.cam.gameObject,pc)),this.target||(this.target=new ge),t.add(this.target),this.follow.enabled=!0,this.follow.target=this.target,Kr&&console.log("FOLLOW",t),this.context.isInXR?this.context.removeCamera(this.cam):this.context.setCurrentCamera(this.cam))}disable(){Kr&&console.log("STOP FOLLOW",this.currentObject),this.view=void 0,this.currentObject=void 0,this.context.removeCamera(this.cam),this.follow&&(this.follow.enabled=!1)}destroy(){var e;(e=this.target)==null||e.removeFromParent(),this.follow&&le.destroy(this.follow)}update(e){var s,r,o,a,c,l;if(((s=this.currentTarget)==null?void 0:s.isConnected)===!1||((r=this.currentTarget)==null?void 0:r.removed)===!0){Kr&&console.log("Target disconnected or timeout",this.currentTarget),this.spectator.stopSpectating();return}this.currentTarget&&((o=this.currentTarget)==null?void 0:o.currentObject)!==this.currentObject&&(Kr&&console.log("Target changed",this.currentObject,"to",this.currentTarget.currentObject),this.set(this.currentTarget));const t=this.context.mainCamera;t&&(this.cam.cam.near!==t.near||this.cam.cam.far!==t.far)&&(this.cam.cam.near=t.near,this.cam.cam.far=t.far,this.cam.cam.updateProjectionMatrix());const i=(a=this.follow)==null?void 0:a.target;if(!(!i||!this.follow)){switch(e){case wp.FirstPerson:((c=this.view)==null?void 0:c.viewDevice)!==gl.Browser?(this.follow.followFactor=5,this.follow.rotateFactor=5):(this.follow.followFactor=50,this.follow.rotateFactor=50),i.position.set(0,0,0);break;case wp.ThirdPerson:this.follow.followFactor=3,this.follow.rotateFactor=2,i.position.set(0,.5,1.5);break}this.follow.flipForward=!1,((l=this.view)==null?void 0:l.viewDevice)!==gl.Browser?i.quaternion.copy(fre):i.quaternion.identity()}}}const fre=new Me().setFromAxisAngle(new w(0,1,0),Math.PI);class pre{constructor(e,t){u(this,"context");u(this,"spectator");this.context=e,this.spectator=t,console.log("Click other avatars or cameras to follow them. Press ESC to exit spectator mode."),this.context.domElement.addEventListener("keydown",s=>{if(!this.spectator.useKeys)return;s.key==="Escape"&&this.spectator.stopSpectating()});let i=0;this.context.input.addEventListener(li.PointerDown,s=>{i=this.context.time.time}),this.context.input.addEventListener(li.PointerUp,s=>{const r=this.context.time.time-i;r>1?this.spectator.stopSpectating():this.context.input.getPointerClicked(0)&&r<.3&&this.trySelectObject()})}trySelectObject(){const e=new pa;e.setMask(16777215);const t=this.context.physics.raycast(e);if(Kr&&console.log(...t),t!=null&&t.length)for(const i of t){if(i.distance<.2)continue;const s=i.object,r=le.getComponentInParent(s,ns),o=r==null?void 0:r.connectionId;if(o){const a=this.context.players.getPlayerView(o);this.spectator.target=a,Kr&&console.log("spectate",o,r);break}}}}class mre{constructor(e,t,i){u(this,"guid");u(this,"dontSave",!0);u(this,"targetUserId");u(this,"stoppedFollowing");this.guid=e,this.targetUserId=t,this.stoppedFollowing=i}}class gre{constructor(e,t){u(this,"guid");u(this,"userId");this.guid=e.guid,this.userId=t}}class Are{constructor(e,t){u(this,"followers",[]);u(this,"context");u(this,"spectator");u(this,"_followerEventMethod");u(this,"_requestFollowMethod");u(this,"_joinedRoomMethod");u(this,"_lastRequestFollowUser");u(this,"_enforceFollowInterval");this.context=e,this.spectator=t,this._followerEventMethod=this.onFollowerEvent.bind(this),this._requestFollowMethod=this.onRequestFollowEvent.bind(this),this._joinedRoomMethod=this.onUserJoinedRoom.bind(this)}awake(){this.context.connection.beginListen("spectator-follower-changed",this._followerEventMethod),this.context.connection.beginListen("spectator-request-follow",this._requestFollowMethod),this.context.connection.beginListen(Xt.JoinedRoom,this._joinedRoomMethod),this.context.domElement.addEventListener("keydown",e=>{this.spectator.useKeys&&(e.key==="f"?this.onRequestFollowMe():e.key==="Escape"&&this.onRequestFollowMe(!0))})}destroy(){this.context.connection.stopListen("spectator-follower-changed",this._followerEventMethod),this.context.connection.stopListen("spectator-request-follow",this._requestFollowMethod),this.context.connection.stopListen(Xt.JoinedRoom,this._joinedRoomMethod)}onSpectatedObjectChanged(e,t){if(Kr&&console.log(this.context.connection.connectionId,"onSpectatedObjectChanged",e,t),this.context.connection.connectionId){const i=(e==null?void 0:e.userId)===void 0,s=i?t:e==null?void 0:e.userId,r=new mre(this.context.connection.connectionId,s,i);this.context.connection.send("spectator-follower-changed",r)}}onRequestFollowMe(e=!1){if(Kr&&console.log("Request follow",this.context.connection.connectionId),this.context.connection.connectionId){this.spectator.stopSpectating();const t=e?void 0:this.context.connection.connectionId,i=new gre(this.spectator,t);this.context.connection.send("spectator-request-follow",i)}}onUserJoinedRoom(){re("followme")&&this.onRequestFollowMe()}onFollowerEvent(e){const t=e.targetUserId,i=e.guid;if(Kr&&console.log(e),t===this.context.connection.connectionId)if(e.stoppedFollowing){const s=this.followers.indexOf(i);s!==-1&&(this.followers.splice(s,1),this.removeDisconnectedFollowers(),console.log(i,"unfollows you",this.followers.length))}else this.followers.includes(i)||(this.followers.push(i),this.removeDisconnectedFollowers(),console.log(i,"follows you",this.followers.length))}removeDisconnectedFollowers(){for(let e=this.followers.length-1;e>=0;e--){const t=this.followers[e];this.context.connection.userIsInRoom(t)===!1&&this.followers.splice(e,1)}}onRequestFollowEvent(e){if(this._lastRequestFollowUser=e,e.userId===this.context.connection.connectionId)this.spectator.stopSpectating();else if(e.userId===void 0)this.spectator.stopSpectating();else{const t=this.context.players.getPlayerView(e.userId);if(t)this.spectator.target=t;else return Kr&&console.warn("Could not find view",e.userId),this.enforceFollow(),!1}return!0}enforceFollow(){this._enforceFollowInterval||(this._enforceFollowInterval=setInterval(()=>{this._lastRequestFollowUser===void 0||this._lastRequestFollowUser.userId&&this.spectator.isFollowedBy(this._lastRequestFollowUser.userId)?(clearInterval(this._enforceFollowInterval),this._enforceFollowInterval=void 0):(Kr&&console.log("REQUEST FOLLOW AGAIN",this._lastRequestFollowUser.userId),this.onRequestFollowEvent(this._lastRequestFollowUser))},1e3))}}var Cr=globalThis&&globalThis.__decorate||function(n,e,t,i){var s=arguments.length,r=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(e,t,r):o(e,t))||r);return s>3&&r&&Object.defineProperty(e,t,r),r};const a_=re("debugspriterenderer"),vre=re("wireframe"),A_=class{static getOrCreateGeometry(e){if(e._geometry)return e._geometry;if(e.guid&&A_.cache[e.guid])return a_&&console.log("Take cached geometry for sprite",e.guid),A_.cache[e.guid];const t=new gt;e._geometry=t;const i=new Float32Array(e.triangles.length*3),s=new Float32Array(e.triangles.length*2);for(let r=0;r<e.triangles.length;r+=1){const o=e.triangles[r];i[r*3]=-e.vertices[o].x,i[r*3+1]=e.vertices[o].y,i[r*3+2]=0;const a=e.uv[o];s[r*2]=a.x,s[r*2+1]=1-a.y}return t.setAttribute("position",new it(i,3)),t.setAttribute("uv",new it(s,2)),e.guid&&(this.cache[e.guid]=t),a_&&console.log("Built sprite geometry",e,t),t}};let Dg=A_;u(Dg,"cache",{});var c_;(function(n){n[n.Simple=0]="Simple",n[n.Sliced=1]="Sliced",n[n.Tiled=2]="Tiled"})(c_||(c_={}));class Tc{constructor(){u(this,"guid");u(this,"texture");u(this,"triangles");u(this,"uv");u(this,"vertices");u(this,"_geometry")}}Cr([x()],Tc.prototype,"guid",void 0);Cr([x(Ft)],Tc.prototype,"texture",void 0);Cr([sv()],Tc.prototype,"triangles",void 0);Cr([sv()],Tc.prototype,"uv",void 0);Cr([sv()],Tc.prototype,"vertices",void 0);const LC=Symbol("spriteOwner");class yw{constructor(){u(this,"sprites")}}Cr([x(Tc)],yw.prototype,"sprites",void 0);class Iv{constructor(){u(this,"spriteSheet");u(this,"index",0)}update(){if(!this.spriteSheet)return;const e=this.index;if(e<0||e>=this.spriteSheet.sprites.length)return;const t=this.spriteSheet.sprites[e],i=t==null?void 0:t.texture;i&&(i.colorSpace=zt,i.minFilter==Nt&&i.magFilter==Nt&&(i.anisotropy=1),i.needsUpdate=!0)}}Cr([x(yw)],Iv.prototype,"spriteSheet",void 0);Cr([x()],Iv.prototype,"index",void 0);class Gl extends Te{constructor(){super(...arguments);u(this,"drawMode",c_.Simple);u(this,"size",{x:1,y:1});u(this,"color");u(this,"sharedMaterial");u(this,"_spriteSheet");u(this,"_currentSprite");u(this,"transparent",!0);u(this,"cutoutThreshold",0);u(this,"castShadows",!1)}get sprite(){return this._spriteSheet}set sprite(t){if(t!==this._spriteSheet)if(typeof t=="number"){const i=Math.floor(t);i===t&&(this.spriteIndex=i);return}else this._spriteSheet=t,this.updateSprite()}set spriteIndex(t){this._spriteSheet&&(this._spriteSheet.index=t,this.updateSprite())}get spriteIndex(){var t;return((t=this._spriteSheet)==null?void 0:t.index)??0}get spriteFrames(){var t,i;return((i=(t=this._spriteSheet)==null?void 0:t.spriteSheet)==null?void 0:i.sprites.length)??0}awake(){this._currentSprite=void 0,a_&&console.log("Awake",this.name,this,this.sprite)}start(){this._currentSprite?this.gameObject&&this.gameObject.add(this._currentSprite):this.updateSprite()}updateSprite(){var i,s,r;if(!this.__didAwake||!((s=(i=this.sprite)==null?void 0:i.spriteSheet)!=null&&s.sprites))return;const t=this.sprite.spriteSheet.sprites[this.spriteIndex];if(!t){a_&&console.warn("Sprite not found",this.spriteIndex,this.sprite.spriteSheet.sprites);return}if(this._currentSprite)this._currentSprite.geometry=Dg.getOrCreateGeometry(t),this._currentSprite.material.map=t.texture;else{const o=new ri({color:16777215,side:Ai});if(!o)return;if(vre&&(o.wireframe=!0),this.color&&(o.color||(o.color=new ye),o.color.copy(this.color),o.opacity=this.color.alpha),o.transparent=!0,t.texture&&!o.wireframe){let a=t.texture;a[LC]!==void 0&&a[LC]!==this&&this.spriteFrames>1&&(a=t.texture=a.clone()),a[LC]=this,o.map=a}this.sharedMaterial=o,this._currentSprite=new me(Dg.getOrCreateGeometry(t),o)}this._currentSprite.parent!==this.gameObject&&(this.drawMode===c_.Tiled&&this._currentSprite.scale.set(this.size.x,this.size.y,1),this.gameObject&&this.gameObject.add(this._currentSprite)),this._currentSprite&&this._currentSprite.layers.set(this.layer),this.sharedMaterial&&(this.sharedMaterial.alphaTest=this.cutoutThreshold,this.sharedMaterial.transparent=this.transparent),this._currentSprite.castShadow=this.castShadows,(r=this._spriteSheet)==null||r.update()}}Cr([x()],Gl.prototype,"drawMode",void 0);Cr([x(Ii)],Gl.prototype,"color",void 0);Cr([x(Ot)],Gl.prototype,"sharedMaterial",void 0);Cr([x(Iv)],Gl.prototype,"sprite",null);Cr([x()],Gl.prototype,"transparent",void 0);Cr([x()],Gl.prototype,"cutoutThreshold",void 0);Cr([x()],Gl.prototype,"castShadows",void 0);class Xa{constructor(){u(this,"bb",null);u(this,"bb_pos",0)}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsSyncedCameraModel(e,t){return(t||new Xa).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsSyncedCameraModel(e,t){return e.setPosition(e.position()+g1),(t||new Xa).__init(e.readInt32(e.position())+e.position(),e)}userId(e){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.__string(this.bb_pos+t,e):null}guid(e){const t=this.bb.__offset(this.bb_pos,6);return t?this.bb.__string(this.bb_pos+t,e):null}dontSave(){const e=this.bb.__offset(this.bb_pos,8);return e?!!this.bb.readInt8(this.bb_pos+e):!1}pos(e){const t=this.bb.__offset(this.bb_pos,10);return t?(e||new nd).__init(this.bb_pos+t,this.bb):null}rot(e){const t=this.bb.__offset(this.bb_pos,12);return t?(e||new nd).__init(this.bb_pos+t,this.bb):null}static startSyncedCameraModel(e){e.startObject(5)}static addUserId(e,t){e.addFieldOffset(0,t,0)}static addGuid(e,t){e.addFieldOffset(1,t,0)}static addDontSave(e,t){e.addFieldInt8(2,+t,0)}static addPos(e,t){e.addFieldStruct(3,t,0)}static addRot(e,t){e.addFieldStruct(4,t,0)}static endSyncedCameraModel(e){return e.endObject()}static finishSyncedCameraModelBuffer(e,t){e.finish(t)}static finishSizePrefixedSyncedCameraModelBuffer(e,t){e.finish(t,void 0,!0)}}var yre=globalThis&&globalThis.__decorate||function(n,e,t,i){var s=arguments.length,r=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(e,t,r):o(e,t))||r);return s>3&&r&&Object.defineProperty(e,t,r),r};const l_="SCAM";cU(l_,Xa.getRootAsSyncedCameraModel);const Wr=new WA;class bre{constructor(e,t){u(this,"userId");u(this,"guid");this.guid=t,this.userId=e}send(e,t){if(e){Wr.clear();const i=Wr.createString(this.guid),s=Wr.createString(this.userId);Xa.startSyncedCameraModel(Wr),Xa.addGuid(Wr,i),Xa.addUserId(Wr,s);const r=Ht(e),o=_x(e);Xa.addPos(Wr,nd.createVec3(Wr,r.x,r.y,r.z)),Xa.addRot(Wr,nd.createVec3(Wr,o.x,o.y,o.z));const a=Xa.endSyncedCameraModel(Wr);Wr.finish(a,l_),t.sendBinary(Wr.asUint8Array())}}}const v_=class extends Te{constructor(){super(...arguments);u(this,"cameraPrefab",null);u(this,"_lastWorldPosition");u(this,"_lastWorldQuaternion");u(this,"_model",null);u(this,"_needsUpdate",!0);u(this,"_lastUpdateTime",0);u(this,"remoteCams",{});u(this,"userToCamMap",{});u(this,"_camTimeoutInSeconds",10);u(this,"_receiveCallback",null)}getCameraObject(t){const i=this.userToCamMap[t];return i?this.remoteCams[i].obj:null}async awake(){this._lastWorldPosition=this.worldPosition.clone(),this._lastWorldQuaternion=this.worldQuaternion.clone(),this.cameraPrefab&&("uri"in this.cameraPrefab&&(this.cameraPrefab=await this.cameraPrefab.instantiate(this.gameObject)),this.cameraPrefab&&"isObject3D"in this.cameraPrefab&&(this.cameraPrefab.visible=!1))}onEnable(){this._receiveCallback=this.context.connection.beginListenBinary(l_,this.onReceivedRemoteCameraInfoBin.bind(this))}onDisable(){this.context.connection.stopListenBinary(l_,this._receiveCallback)}update(){for(const r in this.remoteCams){const o=this.remoteCams[r],a=this.context.time.realtimeSinceStartup-o.lastUpdate;if(!o||a>this._camTimeoutInSeconds){Tt()&&console.log("Remote cam timeout",r),o!=null&&o.obj&&le.destroy(o.obj),delete this.remoteCams[r],o&&delete this.userToCamMap[o.userId],v_.instances.push(o),this.context.players.removePlayerView(o.userId,gl.Browser);continue}}if(this.context.isInXR)return;const t=this.context.mainCamera;if(t===null){this.enabled=!1;return}if(!this.context.connection.isConnected||this.context.connection.connectionId===null)return;this._model===null&&(this._model=new bre(this.context.connection.connectionId,this.context.connection.connectionId+"_camera"));const i=Ht(t),s=In(t);(i.distanceTo(this._lastWorldPosition)>.001||s.angleTo(this._lastWorldQuaternion)>.01)&&(this._needsUpdate=!0),this._lastWorldPosition.copy(i),this._lastWorldQuaternion.copy(s),!((!this._needsUpdate||this.context.time.frameCount%2!==0)&&!(this.context.time.realtimeSinceStartup-this._lastUpdateTime>this._camTimeoutInSeconds*.5))&&(this._lastUpdateTime=this.context.time.realtimeSinceStartup,this._needsUpdate=!1,this._model.send(t,this.context.connection),this.context.isInXR||this.context.players.setPlayerView(this.context.connection.connectionId,t,gl.Browser))}onReceivedRemoteCameraInfoBin(t){const i=t.guid();if(!i)return;const s=t.userId();if(!s||!this.context.connection.userIsInRoom(s)||!this.cameraPrefab)return;let r=this.remoteCams[i];if(!r)if("isObject3D"in this.cameraPrefab){const l=new _c;l.context=this.context;const h=le.instantiate(this.cameraPrefab,l);r=this.remoteCams[i]={obj:h,lastUpdate:this.context.time.realtimeSinceStartup,userId:s},r.obj.visible=!0,this.gameObject.add(h),this.userToCamMap[s]=i,v_.instances.push(r);const d=le.getOrAddComponent(h,ns);d.connectionId=s,d.avatar=h}else return;const o=r.obj;this.context.players.setPlayerView(s,o,gl.Browser),r.lastUpdate=this.context.time.realtimeSinceStartup,uc.markDirty(o);const a=t.pos();a&&vA(o,a.x(),a.y(),a.z());const c=t.rot();c&&xx(o,c.x(),c.y(),c.z())}};let op=v_;u(op,"instances",[]);yre([x([ge,ii])],op.prototype,"cameraPrefab",void 0);var Rv=globalThis&&globalThis.__decorate||function(n,e,t,i){var s=arguments.length,r=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(e,t,r):o(e,t))||r);return s>3&&r&&Object.defineProperty(e,t,r),r};const FC="view",UC=re("debugsyncedroom");class Ld extends Te{constructor(){super(...arguments);u(this,"roomName");u(this,"urlParameterName","room");u(this,"joinRandomRoom",!0);u(this,"requireRoomParameter",!1);u(this,"autoRejoin",!0);u(this,"_roomPrefix");u(this,"_lastPingTime",0);u(this,"_lastRoomTime",-1)}get RoomPrefix(){return this._roomPrefix}awake(){UC&&console.log("Room",this.roomName,this.urlParameterName,this.joinRandomRoom,this.requireRoomParameter,this.autoRejoin),this._roomPrefix===void 0&&(this._roomPrefix=this.roomName,this.roomName="")}onEnable(){const t=re(FC);if(t&&typeof t=="string"&&t.length>0){console.log("Join as viewer"),this.context.connection.joinRoom(t,!0);return}(this.joinRandomRoom||re(this.urlParameterName))&&this.tryJoinRoom()}onDisable(){this.roomName&&this.roomName.length>0&&this.context.connection.leaveRoom(this.roomName)}tryJoinRandomRoom(){this.setRandomRoomUrlParameter(),this.tryJoinRoom()}tryJoinRoom(t=0){t===void 0&&(t=0);let i=!1;if(this.urlParameterName){const s=re(this.urlParameterName);if(s&&typeof s=="string"||s==="number"){i=!0;const r=ZW(s);this.roomName=r}else if(this.joinRandomRoom&&(console.log("No room name found in url, generating random one"),this.setRandomRoomUrlParameter(),t<1))return this.tryJoinRoom(t+1)}else this.joinRandomRoom&&(this.roomName===null||this.roomName===void 0||this.roomName.length<=0)&&(console.log("generate room name"),this.roomName=this.generateRoomName());return this.requireRoomParameter&&!i?(UC&&console.log('No required room parameter "'+this.urlParameterName+'" in url - will not connect to networking backend.'),!1):(this.context.connection.isConnected||this.context.connection.connect(),UC&&console.log("Join "+this.roomName),this._roomPrefix&&(this.roomName=this._roomPrefix+this.roomName),this.context.connection.joinRoom(this.roomName),!0)}update(){this.context.connection.isConnected&&(this.context.time.time-this._lastPingTime>3&&(this._lastPingTime=this.context.time.time,this.context.connection.sendPing()),this.context.connection.isInRoom&&(this._lastRoomTime=this.context.time.time)),this._lastRoomTime>0&&this.context.time.time-this._lastRoomTime>.3&&(this._lastRoomTime=-1,this.autoRejoin?(console.log("Disconnected from networking backend - attempt reconnecting now"),this.tryJoinRoom()):console.warn("You are not connected to a room anymore (possibly because the tab was inactive for too long and the server kicked you)"))}get currentRoomName(){const t=re(FC);return t||re(this.urlParameterName)}setRandomRoomUrlParameter(){const t=e1(),i=this.generateRoomName();re(this.urlParameterName)?t.set(this.urlParameterName,i):t.append(this.urlParameterName,i),oF(i,t)}generateRoomName(){return KW()+"_"+JW(100,999)}getViewOnlyUrl(){if(this.context.connection.isConnected&&this.context.connection.currentRoomViewId){const t=window.location.search,i=new URLSearchParams(t);return i.has(this.urlParameterName)&&i.delete(this.urlParameterName),i.set(FC,this.context.connection.currentRoomViewId),window.location.origin+window.location.pathname+"?"+i.toString()}return null}}Rv([x()],Ld.prototype,"roomName",void 0);Rv([x()],Ld.prototype,"urlParameterName",void 0);Rv([x()],Ld.prototype,"joinRandomRoom",void 0);Rv([x()],Ld.prototype,"requireRoomParameter",void 0);Rv([x()],Ld.prototype,"autoRejoin",void 0);class eR extends Te{}function _re(){const n=re("testwindowcount")||0;n&&n>0&&xre(n)}function xre(n){if(re("testwindow"))return null;const e=new URL(window.location.href);ZP(e.searchParams,qte,1),ZP(e.searchParams,"testwindow",1);const t=e.toString(),i=[];window.onbeforeunload=()=>{for(const c of i)c.close()};const s=.05,r=128;let o=0,a=0;for(let c=0;c<n;c++){o*r+r*.01>=window.innerWidth&&(a+=1,o=0);const l=o*(r*(1+s))+window.screenLeft,h=a*(r*(1+s))+window.screenTop+90+60*a;o+=1;const d=window.open(t,"test window "+c,`popup=yes width=${r} height=${r} top=${h} left=${l}`);if(!d){console.warn("Failed to open window");continue}i.push(d),d.onload=()=>{d.onbeforeunload=()=>{for(let f=0;f<i.length;f++){const p=i[f];p!==d&&p.close()}i.length=0}}}return i}class gG extends Te{awake(){_re()}}class AG extends Te{constructor(){super(...arguments);u(this,"transformsPerFrame",10);u(this,"interval",0);u(this,"useFlatbuffers",!0);u(this,"builder",null);u(this,"models",null)}awake(){if(this.useFlatbuffers)this.context.connection.beginListenBinary(EA,t=>{});else{this.models=[];for(let t=0;t<this.transformsPerFrame;t++)this.models.push(new vG(this.context.connection.connectionId+"_simulatedTransform_"+t,this))}}update(){if(this.context.connection.isConnected){if(this.useFlatbuffers){if(!this.context.connection.connectionId||this.context.time.frameCount%this.interval!==0)return;this.builder===null&&(this.builder=new WA(1024));const t=this.builder;for(let i=0;i<this.transformsPerFrame;i++){t.clear();const s=Ez(this.context.connection.connectionId,this);this.context.connection.sendBinary(s)}}else if(this.models)for(let t=0;t<this.models.length;t++){const i=this.models[t];i.dontSave=!0,i.update(this,null),this.context.connection.send("TestSimulateUserData-"+t,i)}}}}class vG{constructor(e,t){u(this,"guid");u(this,"fast",!1);u(this,"position");u(this,"rotation");u(this,"velocity");u(this,"dontSave");this.guid=e,this.position={x:0,y:0,z:0},this.rotation={x:0,y:0,z:0,w:0},this.update(t,null)}isValid(){return this.fast!==void 0||this.position!==void 0||this.rotation!==void 0||this.velocity!==void 0}update(e,t){const i=e.worldPosition;this.position.x=i.x,this.position.y=i.y,this.position.z=i.z;const s=e.worldQuaternion;if(this.rotation.x=s.x,this.rotation.y=s.y,this.rotation.z=s.z,this.rotation.w=s.w,this.fast=!1,t){const r=t.getVelocity();this.velocity===void 0&&(this.velocity={x:0,y:0,z:0}),this.velocity.x=r.x,this.velocity.y=r.y,this.velocity.z=r.z}}}u(vG,"temp",new w);var nm=globalThis&&globalThis.__decorate||function(n,e,t,i){var s=arguments.length,r=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(e,t,r):o(e,t))||r);return s>3&&r&&Object.defineProperty(e,t,r),r};class Vl extends xr{constructor(){super(...arguments);u(this,"offset");u(this,"rotation");u(this,"focusArea");u(this,"feather");u(this,"kernelSize");u(this,"resolutionScale")}get typeName(){return"TiltShiftEffect"}init(){this.offset.defaultValue=0,this.rotation.defaultValue=0,this.focusArea.defaultValue=.4,this.feather.defaultValue=.3,this.kernelSize.defaultValue=Sl.MEDIUM,this.resolutionScale.defaultValue=1/window.devicePixelRatio}onCreateEffect(){console.log(this);const t=new $6({kernelSize:Sl.VERY_LARGE});return this.offset.onValueChanged=i=>t.offset=i,this.rotation.onValueChanged=i=>t.rotation=i,this.focusArea.onValueChanged=i=>t.focusArea=i,this.feather.onValueChanged=i=>t.feather=i,this.kernelSize.onValueChanged=i=>t.blurPass.kernelSize=i,this.resolutionScale.onValueChanged=i=>t.resolution.scale=i/window.devicePixelRatio,t}}nm([x(It)],Vl.prototype,"offset",void 0);nm([x(It)],Vl.prototype,"rotation",void 0);nm([x(It)],Vl.prototype,"focusArea",void 0);nm([x(It)],Vl.prototype,"feather",void 0);nm([x(It)],Vl.prototype,"kernelSize",void 0);nm([x(It)],Vl.prototype,"resolutionScale",void 0);_a("TiltShiftEffect",Vl);var wre=globalThis&&globalThis.__decorate||function(n,e,t,i){var s=arguments.length,r=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(e,t,r):o(e,t))||r);return s>3&&r&&Object.defineProperty(e,t,r),r},Og;(function(n){n[n.None=0]="None",n[n.Neutral=1]="Neutral",n[n.ACES=2]="ACES"})(Og||(Og={}));class bw extends xr{constructor(){super(...arguments);u(this,"mode")}get typeName(){return"ToneMapping"}get isToneMapping(){return!0}init(){this.mode.defaultValue=Fr}apply(){this.mode.onValueChanged=this._apply.bind(this),this._apply(this.mode.value)}unapply(){this.context.renderer.toneMapping=Fr}_apply(t){switch(t){case Og.None:this.context.renderer.toneMapping=Hg;break;case Og.Neutral:this.context.renderer.toneMapping=rM;break;case Og.ACES:this.context.renderer.toneMapping=oM;break}}}wre([x(It)],bw.prototype,"mode",void 0);_a("Tonemapping",bw);var _w=globalThis&&globalThis.__decorate||function(n,e,t,i){var s=arguments.length,r=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(e,t,r):o(e,t))||r);return s>3&&r&&Object.defineProperty(e,t,r),r};class sm extends Te{constructor(){super(...arguments);u(this,"isGizmo",!1);u(this,"translationSnap",1);u(this,"rotationSnapAngle",15);u(this,"scaleSnap",.25);u(this,"control");u(this,"orbit");u(this,"onControlChangedEvent",t=>{const i=this.orbit;if(i&&(i.enabled=!t.value),t.value){const s=le.getComponentInParent(this.gameObject,Ad);s&&s.requestOwnership()}});u(this,"windowKeyDownListener",t=>{if(this.enabled&&this.control)switch(t.keyCode){case 81:this.control.setSpace(this.control.space==="local"?"world":"local");break;case 16:this.enableSnapping();break;case 87:this.control.setMode("translate");break;case 69:this.control.setMode("rotate");break;case 82:this.control.setMode("scale");break;case 187:case 107:this.control.setSize(this.control.size+.1);break;case 189:case 109:this.control.setSize(Math.max(this.control.size-.1,.1));break;case 88:this.control.showX=!this.control.showX;break;case 89:this.control.showY=!this.control.showY;break;case 90:this.control.showZ=!this.control.showZ;break;case 32:this.control.enabled=!this.control.enabled;break}});u(this,"windowKeyUpListener",t=>{if(this.enabled)switch(t.keyCode){case 16:this.disableSnapping();break}})}onEnable(){var t;this.isGizmo&&!jA||this.context.mainCamera&&(this.control||(this.control=new C8(this.context.mainCamera,this.context.domElement),this.control.visible=!0,this.control.enabled=!0,this.control.getRaycaster().layers.set(2),this.control.size=1,this.control.traverse(i=>{const s=i;if(s.layers.set(2),s){const r=s.material;r&&(r.opacity=.3)}}),this.orbit=le.getComponentInParent(this.context.mainCamera,$i)??void 0),this.control&&(this.context.scene.add(this.control),this.control.attach(this.gameObject),(t=this.control)==null||t.addEventListener("dragging-changed",this.onControlChangedEvent),window.addEventListener("keydown",this.windowKeyDownListener),window.addEventListener("keyup",this.windowKeyUpListener)))}onDisable(){var t,i;(t=this.control)==null||t.removeFromParent(),(i=this.control)==null||i.removeEventListener("dragging-changed",this.onControlChangedEvent),window.removeEventListener("keydown",this.windowKeyDownListener),window.removeEventListener("keyup",this.windowKeyUpListener)}enableSnapping(){this.control&&(this.control.setTranslationSnap(this.translationSnap),this.control.setRotationSnap(Vn.degToRad(this.rotationSnapAngle)),this.control.setScaleSnap(this.scaleSnap))}disableSnapping(){this.control&&(this.control.setTranslationSnap(null),this.control.setRotationSnap(null),this.control.setScaleSnap(null))}}_w([x()],sm.prototype,"isGizmo",void 0);_w([x()],sm.prototype,"translationSnap",void 0);_w([x()],sm.prototype,"rotationSnapAngle",void 0);_w([x()],sm.prototype,"scaleSnap",void 0);var tR=globalThis&&globalThis.__decorate||function(n,e,t,i){var s=arguments.length,r=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(e,t,r):o(e,t))||r);return s>3&&r&&Object.defineProperty(e,t,r),r};class rm extends xr{constructor(){super(...arguments);u(this,"color");u(this,"intensity");u(this,"center")}get typeName(){return"Vignette"}init(){this.color.defaultValue={r:0,g:0,b:0,a:1},this.intensity.defaultValue=0,this.center.defaultValue={x:.5,y:.5}}onCreateEffect(){const t=new jF;return this.intensity.onValueChanged=i=>{t.offset=i,this.updateDarkness(t)},this.color.onValueChanged=i=>{this.updateDarkness(t)},t}updateDarkness(t){const i=this.intensity.value;t.darkness=i}}tR([x(It)],rm.prototype,"color",void 0);tR([x(It)],rm.prototype,"intensity",void 0);tR([x(It)],rm.prototype,"center",void 0);_a("Vignette",rm);var Sre=globalThis&&globalThis.__decorate||function(n,e,t,i){var s=arguments.length,r=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(e,t,r):o(e,t))||r);return s>3&&r&&Object.defineProperty(e,t,r),r};const Nm=re("debugpost");class iR extends Te{constructor(){super(...arguments);u(this,"sharedProfile");u(this,"_postprocessing");u(this,"_effects",[]);u(this,"_lastApplyTime");u(this,"_rapidApplyCount",0);u(this,"_isDirty",!1);u(this,"_modificationQueue");u(this,"_recreateId",-1)}markDirty(){this._isDirty=!0}awake(){var t;(t=this.sharedProfile)==null||t.init(),Nm&&(console.log(this),console.log("Press P to toggle post processing"),window.addEventListener("keydown",i=>{i.key==="p"&&(console.log("Toggle volume: "+this.name,!this.enabled),this.enabled=!this.enabled,this.markDirty())}))}onDisable(){var t;(t=this._postprocessing)==null||t.unapply()}onBeforeRender(){if(!this.context.isInXR){if(this.context.composer&&!(this.context.composer instanceof h1)){Nm&&console.warn("PostProcessing: The current composer is not an EffectComposer - this is not supported");return}this.context.mainCamera&&(!this._postprocessing||!this._postprocessing.isActive||this._isDirty)&&this.apply(),this.context.composer&&(this.context.composer.setRenderer(this.context.renderer),this.context.composer.setMainScene(this.context.scene),this.context.mainCamera&&this.context.composer.setMainCamera(this.context.mainCamera))}}onDestroy(){var t;(t=this._postprocessing)==null||t.dispose()}apply(){var i,s;Nm&&console.log("Apply PostProcessing",this,(i=this.context.mainCamera)==null?void 0:i.name),Tt()&&(this._lastApplyTime!==void 0&&Date.now()-this._lastApplyTime<100&&(this._rapidApplyCount++,this._rapidApplyCount===5&&console.warn("Detected rapid post processing modifications - this might be a bug",this)),this._lastApplyTime=Date.now()),this._isDirty=!1,this.unapply(),this._effects.length=0,(s=this.sharedProfile)!=null&&s.components&&this._effects.push(...this.sharedProfile.components);const t=this.gameObject.getComponentsInChildren(xr);if(Nm&&(t!=null&&t.length)&&console.log("Additional",t),t)for(const r of t)r.active&&this._effects.push(r);this._effects.length>0&&(this._postprocessing||(this._postprocessing=new KI(this.context)),this._postprocessing.apply(this._effects),this._applyPostQueue())}unapply(){var t;Nm&&console.log("Unapply PostProcessing",this),(t=this._postprocessing)==null||t.unapply()}_applyPostQueue(){if(this._modificationQueue){for(const t of this._modificationQueue.values())this.onEditorModification(t);this._modificationQueue.clear()}}onEditorModification(t){var i,s;if(t.propertyName.startsWith("postprocessing.")){if(!this._postprocessing)return this._modificationQueue||(this._modificationQueue=new Map),this._modificationQueue.set(t.propertyName,t),!0;if(!((i=this._effects)!=null&&i.length))return;const r=t.propertyName.split(".");if(r.length===3||r.length===4){const o=r[1],a=r[2];for(const c of this._effects)if(((s=c.typeName)==null?void 0:s.toLowerCase())===o.toLowerCase()){if(a==="active"){c.active=t.value,this.scheduleRecreate();return}if(!p0.has(o)){const l=new Array;p0.set(o,l);const h=Object.keys(c);for(const d of h)c[d]instanceof It&&l.push(d)}if(p0.has(o)){const l=a.toLowerCase(),h=p0.get(o);for(const d of h)if(d.toLowerCase()===l){const f=c[d];f instanceof It&&(r.length===4&&r[3]==="active"?(f.overrideState=t.value,this.scheduleRecreate()):f&&f.value!==void 0&&(f.value=t.value));return}}console.warn("Unknown modification",a);return}}return!0}return!1}scheduleRecreate(){const t=++this._recreateId;setTimeout(()=>{t===this._recreateId&&(this.onDisable(),this.onEnable())},200)}}Sre([sv(Fx)],iR.prototype,"sharedProfile",void 0);const p0=new Map;var Cre=globalThis&&globalThis.__decorate||function(n,e,t,i){var s=arguments.length,r=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(e,t,r):o(e,t))||r);return s>3&&r&&Object.defineProperty(e,t,r),r};const J0=re("debugarcamera");class nR extends Te{constructor(){super(...arguments);u(this,"backgroundTint",new Ii(1,1,1,1));u(this,"backgroundPlane");u(this,"threeTexture");u(this,"forceTextureInitialization",function(){const t=new ri,i=new Wn,s=new Ws;s.add(new me(i,t));const r=new Wt;return function(a,c){t.map=c,a.render(s,r),J0&&console.warn("Force texture initialization")}}());u(this,"preRender",()=>{if(!this||!this.gameObject)return;const i=this.context.renderer.xr.getFrame();i&&(!this.threeTexture&&this.context.renderer&&(this.threeTexture=new Ft,this.forceTextureInitialization(this.context.renderer,this.threeTexture)),this.backgroundPlane===void 0&&(this.backgroundPlane=Tre(this.backgroundTint)),this.backgroundPlane.parent!==this.scene&&this.scene.add(this.backgroundPlane),this.updateFromFrame(i))})}onBeforeXR(t,i){i.optionalFeatures=i.optionalFeatures||[],i.optionalFeatures.push("camera-access"),J0&&console.warn("Requesting camera-access")}onEnterXR(t){this.backgroundPlane&&(this.context.scene.add(this.backgroundPlane),this.backgroundPlane.visible=!1),this.backgroundPlane&&this.context.scene.add(this.backgroundPlane),this.context.pre_render_callbacks.push(this.preRender)}onLeaveXR(t){this.backgroundPlane&&this.backgroundPlane.removeFromParent();const i=this.context.pre_render_callbacks.indexOf(this.preRender);i>=0&&this.context.pre_render_callbacks.splice(i,1)}get background(){return this.backgroundPlane}onBeforeRender(t){this.updateFromFrame(t)}updateFromFrame(t){if(!t)return;const i=t.getViewerPose(this.context.renderer.xr.getReferenceSpace());if(i){for(const s of i.views)if("camera"in s&&s.camera){let o=this.context.renderer.xr.getBinding();if(o||(o=new XRWebGLBinding(t.session,this.context.renderer.getContext())),o){let a=null;if("getCameraImage"in o){a=o.getCameraImage(s.camera);const c=this.context.renderer.properties.get(this.threeTexture);c.__webglTexture=a,this.backgroundPlane?(this.backgroundPlane.setTexture(this.threeTexture),this.backgroundPlane.visible=!0):J0&&console.warn("No background plane to set texture on")}}}}}}Cre([x()],nR.prototype,"backgroundTint",void 0);const Ere=`
uniform sampler2D t2D;

varying vec2 vUv;

void main() {

    vec4 texColor = texture2D( t2D, vUv );
    texColor.w = 1.0;

    // inline sRGB decode
    texColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );

    gl_FragColor = texColor * <backgroundTint>;

    #include <tonemapping_fragment>
    #include <colorspace_fragment>
}
`;function Tre(n){const e="vec4("+n.r.toFixed(3)+","+n.g.toFixed(3)+","+n.b.toFixed(3)+","+n.a.toFixed(3)+")";J0&&console.log(e);const t=new me(new Wn(2,2),new Et({name:"BackgroundMaterial",uniforms:Ep.clone(ys.background.uniforms),vertexShader:ys.background.vertexShader,fragmentShader:Ere.replaceAll("<backgroundTint>",e),side:Ai,depthTest:!1,depthWrite:!1,fog:!1}));return t.geometry.deleteAttribute("normal"),Object.defineProperty(t.material,"map",{get:function(){return this.threeTexture}}),t.renderOrder=-1e4,t.layers.set(2),t.frustumCulled=!1,t.setTexture=function(i){t.material.uniforms.t2D.value=i},t}const dn={Handedness:Object.freeze({NONE:"none",LEFT:"left",RIGHT:"right"}),ComponentState:Object.freeze({DEFAULT:"default",TOUCHED:"touched",PRESSED:"pressed"}),ComponentProperty:Object.freeze({BUTTON:"button",X_AXIS:"xAxis",Y_AXIS:"yAxis",STATE:"state"}),ComponentType:Object.freeze({TRIGGER:"trigger",SQUEEZE:"squeeze",TOUCHPAD:"touchpad",THUMBSTICK:"thumbstick",BUTTON:"button"}),ButtonTouchThreshold:.05,AxisTouchThreshold:.1,VisualResponseProperty:Object.freeze({TRANSFORM:"transform",VISIBILITY:"visibility"})};async function yG(n){const e=await fetch(n);if(e.ok)return e.json();throw new Error(e.statusText)}async function Mre(n){if(!n)throw new Error("No basePath supplied");return await yG(`${n}/profilesList.json`)}async function Ire(n,e,t=null,i=!0){if(!n)throw new Error("No xrInputSource supplied");if(!e)throw new Error("No basePath supplied");const s=await Mre(e);let r;if(n.profiles.some(c=>{const l=s[c];return l&&(r={profileId:c,profilePath:`${e}/${l.path}`,deprecated:!!l.deprecated}),!!r}),!r){if(!t)throw new Error("No matching profile name found");const c=s[t];if(!c)throw new Error(`No matching profile name found and default profile "${t}" missing.`);r={profileId:t,profilePath:`${e}/${c.path}`,deprecated:!!c.deprecated}}const o=await yG(r.profilePath);let a;if(i){let c;if(n.handedness==="any"?c=o.layouts[Object.keys(o.layouts)[0]]:c=o.layouts[n.handedness],!c)throw new Error(`No matching handedness, ${n.handedness}, in profile ${r.profileId}`);c.assetPath&&(a=r.profilePath.replace("profile.json",c.assetPath))}return{profile:o,assetPath:a}}const Rre={xAxis:0,yAxis:0,button:0,state:dn.ComponentState.DEFAULT};function Pre(n=0,e=0){let t=n,i=e;if(Math.sqrt(n*n+e*e)>1){const o=Math.atan2(e,n);t=Math.cos(o),i=Math.sin(o)}return{normalizedXAxis:t*.5+.5,normalizedYAxis:i*.5+.5}}class Bre{constructor(e){this.componentProperty=e.componentProperty,this.states=e.states,this.valueNodeName=e.valueNodeName,this.valueNodeProperty=e.valueNodeProperty,this.valueNodeProperty===dn.VisualResponseProperty.TRANSFORM&&(this.minNodeName=e.minNodeName,this.maxNodeName=e.maxNodeName),this.value=0,this.updateFromComponent(Rre)}updateFromComponent({xAxis:e,yAxis:t,button:i,state:s}){const{normalizedXAxis:r,normalizedYAxis:o}=Pre(e,t);switch(this.componentProperty){case dn.ComponentProperty.X_AXIS:this.value=this.states.includes(s)?r:.5;break;case dn.ComponentProperty.Y_AXIS:this.value=this.states.includes(s)?o:.5;break;case dn.ComponentProperty.BUTTON:this.value=this.states.includes(s)?i:0;break;case dn.ComponentProperty.STATE:this.valueNodeProperty===dn.VisualResponseProperty.VISIBILITY?this.value=this.states.includes(s):this.value=this.states.includes(s)?1:0;break;default:throw new Error(`Unexpected visualResponse componentProperty ${this.componentProperty}`)}}}class Dre{constructor(e,t){if(!e||!t||!t.visualResponses||!t.gamepadIndices||Object.keys(t.gamepadIndices).length===0)throw new Error("Invalid arguments supplied");this.id=e,this.type=t.type,this.rootNodeName=t.rootNodeName,this.touchPointNodeName=t.touchPointNodeName,this.visualResponses={},Object.keys(t.visualResponses).forEach(i=>{const s=new Bre(t.visualResponses[i]);this.visualResponses[i]=s}),this.gamepadIndices=Object.assign({},t.gamepadIndices),this.values={state:dn.ComponentState.DEFAULT,button:this.gamepadIndices.button!==void 0?0:void 0,xAxis:this.gamepadIndices.xAxis!==void 0?0:void 0,yAxis:this.gamepadIndices.yAxis!==void 0?0:void 0}}get data(){return{id:this.id,...this.values}}updateFromGamepad(e){if(this.values.state=dn.ComponentState.DEFAULT,this.gamepadIndices.button!==void 0&&e.buttons.length>this.gamepadIndices.button){const t=e.buttons[this.gamepadIndices.button];this.values.button=t.value,this.values.button=this.values.button<0?0:this.values.button,this.values.button=this.values.button>1?1:this.values.button,t.pressed||this.values.button===1?this.values.state=dn.ComponentState.PRESSED:(t.touched||this.values.button>dn.ButtonTouchThreshold)&&(this.values.state=dn.ComponentState.TOUCHED)}this.gamepadIndices.xAxis!==void 0&&e.axes.length>this.gamepadIndices.xAxis&&(this.values.xAxis=e.axes[this.gamepadIndices.xAxis],this.values.xAxis=this.values.xAxis<-1?-1:this.values.xAxis,this.values.xAxis=this.values.xAxis>1?1:this.values.xAxis,this.values.state===dn.ComponentState.DEFAULT&&Math.abs(this.values.xAxis)>dn.AxisTouchThreshold&&(this.values.state=dn.ComponentState.TOUCHED)),this.gamepadIndices.yAxis!==void 0&&e.axes.length>this.gamepadIndices.yAxis&&(this.values.yAxis=e.axes[this.gamepadIndices.yAxis],this.values.yAxis=this.values.yAxis<-1?-1:this.values.yAxis,this.values.yAxis=this.values.yAxis>1?1:this.values.yAxis,this.values.state===dn.ComponentState.DEFAULT&&Math.abs(this.values.yAxis)>dn.AxisTouchThreshold&&(this.values.state=dn.ComponentState.TOUCHED)),Object.values(this.visualResponses).forEach(t=>{t.updateFromComponent(this.values)})}}class Ore{constructor(e,t,i){if(!e)throw new Error("No xrInputSource supplied");if(!t)throw new Error("No profile supplied");this.xrInputSource=e,this.assetUrl=i,this.id=t.profileId,this.layoutDescription=t.layouts[e.handedness],this.components={},Object.keys(this.layoutDescription.components).forEach(s=>{const r=this.layoutDescription.components[s];this.components[s]=new Dre(s,r)}),this.updateFromGamepad()}get gripSpace(){return this.xrInputSource.gripSpace}get targetRaySpace(){return this.xrInputSource.targetRaySpace}get data(){const e=[];return Object.values(this.components).forEach(t=>{e.push(t.data)}),e}updateFromGamepad(){Object.values(this.components).forEach(e=>{e.updateFromGamepad(this.xrInputSource.gamepad)})}}const kre="https://cdn.jsdelivr.net/npm/@webxr-input-profiles/assets@1.0/dist/profiles",Lre="generic-trigger";let Fre=class extends ge{constructor(){super(),this.motionController=null,this.envMap=null}setEnvironmentMap(e){return this.envMap==e?this:(this.envMap=e,this.traverse(t=>{t.isMesh&&(t.material.envMap=this.envMap,t.material.needsUpdate=!0)}),this)}updateMatrixWorld(e){super.updateMatrixWorld(e),this.motionController&&(this.motionController.updateFromGamepad(),Object.values(this.motionController.components).forEach(t=>{Object.values(t.visualResponses).forEach(i=>{const{valueNode:s,minNode:r,maxNode:o,value:a,valueNodeProperty:c}=i;s&&(c===dn.VisualResponseProperty.VISIBILITY?s.visible=a:c===dn.VisualResponseProperty.TRANSFORM&&(s.quaternion.slerpQuaternions(r.quaternion,o.quaternion,a),s.position.lerpVectors(r.position,o.position,a)))})}))}};function Ure(n,e){Object.values(n.components).forEach(t=>{const{type:i,touchPointNodeName:s,visualResponses:r}=t;if(i===dn.ComponentType.TOUCHPAD)if(t.touchPointNode=e.getObjectByName(s),t.touchPointNode){const o=new Aa(.001),a=new ri({color:255}),c=new me(o,a);t.touchPointNode.add(c)}else console.warn(`Could not find touch dot, ${t.touchPointNodeName}, in touchpad component ${t.id}`);Object.values(r).forEach(o=>{const{valueNodeName:a,minNodeName:c,maxNodeName:l,valueNodeProperty:h}=o;if(h===dn.VisualResponseProperty.TRANSFORM){if(o.minNode=e.getObjectByName(c),o.maxNode=e.getObjectByName(l),!o.minNode){console.warn(`Could not find ${c} in the model`);return}if(!o.maxNode){console.warn(`Could not find ${l} in the model`);return}}o.valueNode=e.getObjectByName(a),o.valueNode||console.warn(`Could not find ${a} in the model`)})})}function Kk(n,e){Ure(n.motionController,e),n.envMap&&e.traverse(t=>{t.isMesh&&(t.material.envMap=n.envMap,t.material.needsUpdate=!0)}),n.layers.mask!=0&&e.traverse(t=>{t.layers.mask=n.layers.mask}),n.add(e)}class Nre{constructor(e=null,t=null){this.gltfLoader=e,this.path=kre,this._assetCache={},this.onLoad=t,this.gltfLoader||(this.gltfLoader=new Gp)}createControllerModel(e){const t=new Fre;let i=null;return e.addEventListener("connected",s=>{const r=s.data;r.targetRayMode!=="tracked-pointer"||!r.gamepad||Ire(r,this.path,Lre).then(({profile:o,assetPath:a})=>{t.motionController=new Ore(r,o,a);const c=this._assetCache[t.motionController.assetUrl];if(c)i=c.scene.clone(),Kk(t,i),this.onLoad&&this.onLoad(i);else{if(!this.gltfLoader)throw new Error("GLTFLoader not set.");this.gltfLoader.setPath(""),this.gltfLoader.load(t.motionController.assetUrl,l=>{this._assetCache[t.motionController.assetUrl]=l,i=l.scene.clone(),Kk(t,i),this.onLoad&&this.onLoad(i)},null,()=>{throw new Error(`Asset ${t.motionController.assetUrl} missing or malformed.`)})}}).catch(o=>{console.warn(o)})}),e.addEventListener("disconnected",()=>{t.motionController=null,t.remove(i),i=null}),t}}const zre="https://cdn.jsdelivr.net/npm/@webxr-input-profiles/assets@1.0/dist/profiles/generic-hand/";class Gre{constructor(e,t,i,s,r=null,o=null){this.controller=t,this.handModel=e,this.bones=[],r===null&&(r=new Gp,r.setPath(i||zre)),r.load(`${s}.glb`,a=>{const c=a.scene.children[0];this.handModel.add(c),c.layers.mask=this.handModel.layers.mask;const l=c.getObjectByProperty("type","SkinnedMesh");l.frustumCulled=!1,l.castShadow=!0,l.receiveShadow=!0,["wrist","thumb-metacarpal","thumb-phalanx-proximal","thumb-phalanx-distal","thumb-tip","index-finger-metacarpal","index-finger-phalanx-proximal","index-finger-phalanx-intermediate","index-finger-phalanx-distal","index-finger-tip","middle-finger-metacarpal","middle-finger-phalanx-proximal","middle-finger-phalanx-intermediate","middle-finger-phalanx-distal","middle-finger-tip","ring-finger-metacarpal","ring-finger-phalanx-proximal","ring-finger-phalanx-intermediate","ring-finger-phalanx-distal","ring-finger-tip","pinky-finger-metacarpal","pinky-finger-phalanx-proximal","pinky-finger-phalanx-intermediate","pinky-finger-phalanx-distal","pinky-finger-tip"].forEach(d=>{const f=c.getObjectByName(d);f!==void 0?f.jointName=d:console.warn(`Couldn't find ${d} in ${s} hand mesh`),this.bones.push(f)}),o&&o(c)})}updateMesh(){const e=this.controller.joints;for(let t=0;t<this.bones.length;t++){const i=this.bones[t];if(i){const s=e[i.jointName];if(s.visible){const r=s.position;i.position.copy(r),i.quaternion.copy(s.quaternion)}}}}}var xw=globalThis&&globalThis.__decorate||function(n,e,t,i){var s=arguments.length,r=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(e,t,r):o(e,t))||r);return s>3&&r&&Object.defineProperty(e,t,r),r};const Ra=re("debugwebxr"),ch=new Array;class Il extends Te{constructor(){super(...arguments);u(this,"createControllerModel",!0);u(this,"createHandModel",!0);u(this,"customLeftHand");u(this,"customRightHand");u(this,"_models",new Array)}supportsXR(t){return t==="immersive-vr"||t==="immersive-ar"}async onXRControllerAdded(t){var r,o,a;if(!(t.xr.isVR||t.xr.isPassThrough))return;const{controller:s}=t;if(Ra&&console.warn("Add Controller Model for",s.side,s.index),this.createControllerModel){if(s.hand){if(this.createHandModel){const c=await this.loadHandModel(s);if(!c||!s.connected){(r=c==null?void 0:c.handObject)==null||r.removeFromParent(),(a=(o=c==null?void 0:c.handmesh)==null?void 0:o.controller)==null||a.removeFromParent();return}this._models.push({controller:s,model:c.handObject,handmesh:c.handmesh}),this._models.sort((l,h)=>l.controller.index-h.controller.index),this.scene.add(c.handObject)}}else if(this.createControllerModel){const c=await s.getModelUrl();if(c){const l=await this.loadModel(s,c);if(!l||!s.connected)return;this._models.push({controller:s,model:l}),this._models.sort((h,d)=>h.controller.index-d.controller.index),this.scene.add(l),l.traverse(h=>{h.layers.set(2)})}else console.warn("XRControllerModel: no model found for "+s.side)}}}onXRControllerRemoved(t){var r;const i=this._models.findIndex(o=>(o==null?void 0:o.controller)===t.controller),s=this._models[i];s&&(this._models.splice(i,1),s.handmesh&&((r=s.handmesh.handModel)==null||r.removeFromParent()),s.model&&s.model.removeFromParent())}onBeforeRender(){if(mt.active&&(Ra&&(ch[0]=Date.now()),this.updateRendering(mt.active),Ra)){const t=Date.now()-ch[0];if(ch.push(t),ch.length>=30){ch[0]=0;const i=ch.reduce((s,r)=>s+r,0)/ch.length;ch.length=0,console.log("[XRControllerModel] "+i.toFixed(2)+" ms")}}}onLeaveXR(t){var i;for(const s of this._models)s&&((i=s.model)==null||i.removeFromParent());this._models=[]}updateRendering(t){var i,s,r,o,a;for(let c=0;c<this._models.length;c++){const l=this._models[c];if(!l)continue;const h=l.controller;if(!h.connected){Ra&&console.warn("XRControllerModel.onUpdateXR: controller is not connected anymore",h.side,h.hand);continue}if(l.model&&!l.handmesh)l.model.position.copy(h.gripPosition),l.model.quaternion.copy(h.gripQuaternion),l.model.visible=h.isTracking,(i=t.rig)==null||i.gameObject.add(l.model);else if(h.inputSource.hand&&l.handmesh){const d=t.referenceSpace,f=this.context.renderer.xr.getHand(h.index);if(d&&t.frame.getJointPose){for(const p of h.inputSource.hand.values()){const m=f.joints[p.jointName];if(m){const g=h.getHandJointPose(p);if(g){const{position:y,quaternion:A}=t.convertSpace(g.transform);m.position.copy(y),m.quaternion.copy(A),m.matrixWorldAutoUpdate=!1}m.visible=g!=null}}l.model&&(l.model.visible=h.isTracking,l.model.visible&&l.model.parent!==((s=t.rig)==null?void 0:s.gameObject)&&((r=t.rig)==null||r.gameObject.add(l.model)),l.model.position.set(0,0,0)),(o=l.model)!=null&&o.visible&&((a=l.handmesh)==null||a.updateMesh())}}}}async loadModel(t,i){var o;if(!t.connected)return console.warn("XRControllerModel.onXRControllerAdded: controller is not connected anymore",t.side),null;const r=await ii.getOrCreate("",i).instantiate();return WD(r),(o=mt.active)!=null&&o.isPassThrough&&r.traverseVisible(a=>{this.makeOccluder(a)}),r}async loadHandModel(t){const i=this.context,s=i.renderer.xr.getHand(t.index);s||(Ra?kt.DrawLabel(t.rayWorldPosition,"No hand found for index "+t.index,.05,5):console.warn("No hand found for index "+t.index));const r=new Gp;nv(r,i),r.setPath("https://cdn.jsdelivr.net/npm/@webxr-input-profiles/assets@1.0/dist/profiles/generic-hand/");const o=t.side==="left"?"left.":"right.",a=t.side==="left"?this.customLeftHand:this.customRightHand;if(a)if(!a.uri.includes(o))console.warn("XRControllerModel: custom hand model must be named "+o),gn("Custom Hand: unexpected name, please see the console for details");else{const h=a.uri.substring(0,a.uri.indexOf(o));r.setPath(h),Ra&&console.log("XRControllerModel: loading custom hand model from "+h)}const c=new ge;WD(c);const l=new Gre(c,s,r.path,t.inputSource.handedness,r,h=>{h.traverseVisible(d=>{var f;d.layers.set(2),(f=mt.active)!=null&&f.isPassThrough&&this.makeOccluder(d)}),t.connected||(Ra&&kt.DrawLabel(t.rayWorldPosition,"Hand is loaded but not connected anymore",.05,5),h.removeFromParent())});if(Ra&&c.add(new Fo(.5)),t.inputSource.hand){Ra&&console.log(t.inputSource.hand);for(const h of t.inputSource.hand.values())if(s.joints[h.jointName]===void 0){const d=new fr;d.matrixAutoUpdate=!1,d.visible=!0,s.joints[h.jointName]=d,s.add(d)}}else Ra&&kt.DrawLabel(t.rayWorldPosition,"No inputSource.hand found for index "+t.index,.05,5);return{handObject:c,handmesh:l}}makeOccluder(t){if(t instanceof me){let i=t.material;i instanceof Ot&&(i=t.material=i.clone(),i.depthWrite=!0,i.depthTest=!0,i.colorWrite=!1,t.renderOrder=-100)}}}u(Il,"factory",new Nre);xw([x()],Il.prototype,"createControllerModel",void 0);xw([x()],Il.prototype,"createHandModel",void 0);xw([x(ii)],Il.prototype,"customLeftHand",void 0);xw([x(ii)],Il.prototype,"customRightHand",void 0);const Zk=new Mi,m0=new w;class bG extends Z_{constructor(){super(),this.isLineSegmentsGeometry=!0,this.type="LineSegmentsGeometry";const e=[-1,2,0,1,2,0,-1,1,0,1,1,0,-1,0,0,1,0,0,-1,-1,0,1,-1,0],t=[-1,2,1,2,-1,1,1,1,-1,-1,1,-1,-1,-2,1,-2],i=[0,2,1,2,3,1,2,4,3,4,5,3,4,6,5,6,7,5];this.setIndex(i),this.setAttribute("position",new ot(e,3)),this.setAttribute("uv",new ot(t,2))}applyMatrix4(e){const t=this.attributes.instanceStart,i=this.attributes.instanceEnd;return t!==void 0&&(t.applyMatrix4(e),i.applyMatrix4(e),t.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}setPositions(e){let t;e instanceof Float32Array?t=e:Array.isArray(e)&&(t=new Float32Array(e));const i=new db(t,6,1);return this.setAttribute("instanceStart",new pr(i,3,0)),this.setAttribute("instanceEnd",new pr(i,3,3)),this.computeBoundingBox(),this.computeBoundingSphere(),this}setColors(e){let t;e instanceof Float32Array?t=e:Array.isArray(e)&&(t=new Float32Array(e));const i=new db(t,6,1);return this.setAttribute("instanceColorStart",new pr(i,3,0)),this.setAttribute("instanceColorEnd",new pr(i,3,3)),this}fromWireframeGeometry(e){return this.setPositions(e.attributes.position.array),this}fromEdgesGeometry(e){return this.setPositions(e.attributes.position.array),this}fromMesh(e){return this.fromWireframeGeometry(new UM(e.geometry)),this}fromLineSegments(e){const t=e.geometry;return this.setPositions(t.attributes.position.array),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Mi);const e=this.attributes.instanceStart,t=this.attributes.instanceEnd;e!==void 0&&t!==void 0&&(this.boundingBox.setFromBufferAttribute(e),Zk.setFromBufferAttribute(t),this.boundingBox.union(Zk))}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Mn),this.boundingBox===null&&this.computeBoundingBox();const e=this.attributes.instanceStart,t=this.attributes.instanceEnd;if(e!==void 0&&t!==void 0){const i=this.boundingSphere.center;this.boundingBox.getCenter(i);let s=0;for(let r=0,o=e.count;r<o;r++)m0.fromBufferAttribute(e,r),s=Math.max(s,i.distanceToSquared(m0)),m0.fromBufferAttribute(t,r),s=Math.max(s,i.distanceToSquared(m0));this.boundingSphere.radius=Math.sqrt(s),isNaN(this.boundingSphere.radius)&&console.error("THREE.LineSegmentsGeometry.computeBoundingSphere(): Computed radius is NaN. The instanced position data is likely to have NaN values.",this)}}toJSON(){}applyMatrix(e){return console.warn("THREE.LineSegmentsGeometry: applyMatrix() has been renamed to applyMatrix4()."),this.applyMatrix4(e)}}De.line={worldUnits:{value:1},linewidth:{value:1},resolution:{value:new ie(1,1)},dashOffset:{value:0},dashScale:{value:1},dashSize:{value:1},gapSize:{value:1}};ys.line={uniforms:Ep.merge([De.common,De.fog,De.line]),vertexShader:`
		#include <common>
		#include <color_pars_vertex>
		#include <fog_pars_vertex>
		#include <logdepthbuf_pars_vertex>
		#include <clipping_planes_pars_vertex>

		uniform float linewidth;
		uniform vec2 resolution;

		attribute vec3 instanceStart;
		attribute vec3 instanceEnd;

		attribute vec3 instanceColorStart;
		attribute vec3 instanceColorEnd;

		#ifdef WORLD_UNITS

			varying vec4 worldPos;
			varying vec3 worldStart;
			varying vec3 worldEnd;

			#ifdef USE_DASH

				varying vec2 vUv;

			#endif

		#else

			varying vec2 vUv;

		#endif

		#ifdef USE_DASH

			uniform float dashScale;
			attribute float instanceDistanceStart;
			attribute float instanceDistanceEnd;
			varying float vLineDistance;

		#endif

		void trimSegment( const in vec4 start, inout vec4 end ) {

			// trim end segment so it terminates between the camera plane and the near plane

			// conservative estimate of the near plane
			float a = projectionMatrix[ 2 ][ 2 ]; // 3nd entry in 3th column
			float b = projectionMatrix[ 3 ][ 2 ]; // 3nd entry in 4th column
			float nearEstimate = - 0.5 * b / a;

			float alpha = ( nearEstimate - start.z ) / ( end.z - start.z );

			end.xyz = mix( start.xyz, end.xyz, alpha );

		}

		void main() {

			#ifdef USE_COLOR

				vColor.xyz = ( position.y < 0.5 ) ? instanceColorStart : instanceColorEnd;

			#endif

			#ifdef USE_DASH

				vLineDistance = ( position.y < 0.5 ) ? dashScale * instanceDistanceStart : dashScale * instanceDistanceEnd;
				vUv = uv;

			#endif

			float aspect = resolution.x / resolution.y;

			// camera space
			vec4 start = modelViewMatrix * vec4( instanceStart, 1.0 );
			vec4 end = modelViewMatrix * vec4( instanceEnd, 1.0 );

			#ifdef WORLD_UNITS

				worldStart = start.xyz;
				worldEnd = end.xyz;

			#else

				vUv = uv;

			#endif

			// special case for perspective projection, and segments that terminate either in, or behind, the camera plane
			// clearly the gpu firmware has a way of addressing this issue when projecting into ndc space
			// but we need to perform ndc-space calculations in the shader, so we must address this issue directly
			// perhaps there is a more elegant solution -- WestLangley

			bool perspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 ); // 4th entry in the 3rd column

			if ( perspective ) {

				if ( start.z < 0.0 && end.z >= 0.0 ) {

					trimSegment( start, end );

				} else if ( end.z < 0.0 && start.z >= 0.0 ) {

					trimSegment( end, start );

				}

			}

			// clip space
			vec4 clipStart = projectionMatrix * start;
			vec4 clipEnd = projectionMatrix * end;

			// ndc space
			vec3 ndcStart = clipStart.xyz / clipStart.w;
			vec3 ndcEnd = clipEnd.xyz / clipEnd.w;

			// direction
			vec2 dir = ndcEnd.xy - ndcStart.xy;

			// account for clip-space aspect ratio
			dir.x *= aspect;
			dir = normalize( dir );

			#ifdef WORLD_UNITS

				vec3 worldDir = normalize( end.xyz - start.xyz );
				vec3 tmpFwd = normalize( mix( start.xyz, end.xyz, 0.5 ) );
				vec3 worldUp = normalize( cross( worldDir, tmpFwd ) );
				vec3 worldFwd = cross( worldDir, worldUp );
				worldPos = position.y < 0.5 ? start: end;

				// height offset
				float hw = linewidth * 0.5;
				worldPos.xyz += position.x < 0.0 ? hw * worldUp : - hw * worldUp;

				// don't extend the line if we're rendering dashes because we
				// won't be rendering the endcaps
				#ifndef USE_DASH

					// cap extension
					worldPos.xyz += position.y < 0.5 ? - hw * worldDir : hw * worldDir;

					// add width to the box
					worldPos.xyz += worldFwd * hw;

					// endcaps
					if ( position.y > 1.0 || position.y < 0.0 ) {

						worldPos.xyz -= worldFwd * 2.0 * hw;

					}

				#endif

				// project the worldpos
				vec4 clip = projectionMatrix * worldPos;

				// shift the depth of the projected points so the line
				// segments overlap neatly
				vec3 clipPose = ( position.y < 0.5 ) ? ndcStart : ndcEnd;
				clip.z = clipPose.z * clip.w;

			#else

				vec2 offset = vec2( dir.y, - dir.x );
				// undo aspect ratio adjustment
				dir.x /= aspect;
				offset.x /= aspect;

				// sign flip
				if ( position.x < 0.0 ) offset *= - 1.0;

				// endcaps
				if ( position.y < 0.0 ) {

					offset += - dir;

				} else if ( position.y > 1.0 ) {

					offset += dir;

				}

				// adjust for linewidth
				offset *= linewidth;

				// adjust for clip-space to screen-space conversion // maybe resolution should be based on viewport ...
				offset /= resolution.y;

				// select end
				vec4 clip = ( position.y < 0.5 ) ? clipStart : clipEnd;

				// back to clip space
				offset *= clip.w;

				clip.xy += offset;

			#endif

			gl_Position = clip;

			vec4 mvPosition = ( position.y < 0.5 ) ? start : end; // this is an approximation

			#include <logdepthbuf_vertex>
			#include <clipping_planes_vertex>
			#include <fog_vertex>

		}
		`,fragmentShader:`
		uniform vec3 diffuse;
		uniform float opacity;
		uniform float linewidth;

		#ifdef USE_DASH

			uniform float dashOffset;
			uniform float dashSize;
			uniform float gapSize;

		#endif

		varying float vLineDistance;

		#ifdef WORLD_UNITS

			varying vec4 worldPos;
			varying vec3 worldStart;
			varying vec3 worldEnd;

			#ifdef USE_DASH

				varying vec2 vUv;

			#endif

		#else

			varying vec2 vUv;

		#endif

		#include <common>
		#include <color_pars_fragment>
		#include <fog_pars_fragment>
		#include <logdepthbuf_pars_fragment>
		#include <clipping_planes_pars_fragment>

		vec2 closestLineToLine(vec3 p1, vec3 p2, vec3 p3, vec3 p4) {

			float mua;
			float mub;

			vec3 p13 = p1 - p3;
			vec3 p43 = p4 - p3;

			vec3 p21 = p2 - p1;

			float d1343 = dot( p13, p43 );
			float d4321 = dot( p43, p21 );
			float d1321 = dot( p13, p21 );
			float d4343 = dot( p43, p43 );
			float d2121 = dot( p21, p21 );

			float denom = d2121 * d4343 - d4321 * d4321;

			float numer = d1343 * d4321 - d1321 * d4343;

			mua = numer / denom;
			mua = clamp( mua, 0.0, 1.0 );
			mub = ( d1343 + d4321 * ( mua ) ) / d4343;
			mub = clamp( mub, 0.0, 1.0 );

			return vec2( mua, mub );

		}

		void main() {

			#include <clipping_planes_fragment>

			#ifdef USE_DASH

				if ( vUv.y < - 1.0 || vUv.y > 1.0 ) discard; // discard endcaps

				if ( mod( vLineDistance + dashOffset, dashSize + gapSize ) > dashSize ) discard; // todo - FIX

			#endif

			float alpha = opacity;

			#ifdef WORLD_UNITS

				// Find the closest points on the view ray and the line segment
				vec3 rayEnd = normalize( worldPos.xyz ) * 1e5;
				vec3 lineDir = worldEnd - worldStart;
				vec2 params = closestLineToLine( worldStart, worldEnd, vec3( 0.0, 0.0, 0.0 ), rayEnd );

				vec3 p1 = worldStart + lineDir * params.x;
				vec3 p2 = rayEnd * params.y;
				vec3 delta = p1 - p2;
				float len = length( delta );
				float norm = len / linewidth;

				#ifndef USE_DASH

					#ifdef USE_ALPHA_TO_COVERAGE

						float dnorm = fwidth( norm );
						alpha = 1.0 - smoothstep( 0.5 - dnorm, 0.5 + dnorm, norm );

					#else

						if ( norm > 0.5 ) {

							discard;

						}

					#endif

				#endif

			#else

				#ifdef USE_ALPHA_TO_COVERAGE

					// artifacts appear on some hardware if a derivative is taken within a conditional
					float a = vUv.x;
					float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
					float len2 = a * a + b * b;
					float dlen = fwidth( len2 );

					if ( abs( vUv.y ) > 1.0 ) {

						alpha = 1.0 - smoothstep( 1.0 - dlen, 1.0 + dlen, len2 );

					}

				#else

					if ( abs( vUv.y ) > 1.0 ) {

						float a = vUv.x;
						float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
						float len2 = a * a + b * b;

						if ( len2 > 1.0 ) discard;

					}

				#endif

			#endif

			vec4 diffuseColor = vec4( diffuse, alpha );

			#include <logdepthbuf_fragment>
			#include <color_fragment>

			gl_FragColor = vec4( diffuseColor.rgb, alpha );

			#include <tonemapping_fragment>
			#include <colorspace_fragment>
			#include <fog_fragment>
			#include <premultiplied_alpha_fragment>

		}
		`};class sR extends Et{constructor(e){super({type:"LineMaterial",uniforms:Ep.clone(ys.line.uniforms),vertexShader:ys.line.vertexShader,fragmentShader:ys.line.fragmentShader,clipping:!0}),this.isLineMaterial=!0,this.setValues(e)}get color(){return this.uniforms.diffuse.value}set color(e){this.uniforms.diffuse.value=e}get worldUnits(){return"WORLD_UNITS"in this.defines}set worldUnits(e){e===!0?this.defines.WORLD_UNITS="":delete this.defines.WORLD_UNITS}get linewidth(){return this.uniforms.linewidth.value}set linewidth(e){this.uniforms.linewidth&&(this.uniforms.linewidth.value=e)}get dashed(){return"USE_DASH"in this.defines}set dashed(e){e===!0!==this.dashed&&(this.needsUpdate=!0),e===!0?this.defines.USE_DASH="":delete this.defines.USE_DASH}get dashScale(){return this.uniforms.dashScale.value}set dashScale(e){this.uniforms.dashScale.value=e}get dashSize(){return this.uniforms.dashSize.value}set dashSize(e){this.uniforms.dashSize.value=e}get dashOffset(){return this.uniforms.dashOffset.value}set dashOffset(e){this.uniforms.dashOffset.value=e}get gapSize(){return this.uniforms.gapSize.value}set gapSize(e){this.uniforms.gapSize.value=e}get opacity(){return this.uniforms.opacity.value}set opacity(e){this.uniforms&&(this.uniforms.opacity.value=e)}get resolution(){return this.uniforms.resolution.value}set resolution(e){this.uniforms.resolution.value.copy(e)}get alphaToCoverage(){return"USE_ALPHA_TO_COVERAGE"in this.defines}set alphaToCoverage(e){this.defines&&(e===!0!==this.alphaToCoverage&&(this.needsUpdate=!0),e===!0?(this.defines.USE_ALPHA_TO_COVERAGE="",this.extensions.derivatives=!0):(delete this.defines.USE_ALPHA_TO_COVERAGE,this.extensions.derivatives=!1))}}const $k=new w,eL=new w,fs=new tt,ps=new tt,Pa=new tt,NC=new w,zC=new Ce,As=new KM,tL=new w,g0=new Mi,A0=new Mn,Ba=new tt;let $a,ad;function iL(n,e,t){return Ba.set(0,0,-e,1).applyMatrix4(n.projectionMatrix),Ba.multiplyScalar(1/Ba.w),Ba.x=ad/t.width,Ba.y=ad/t.height,Ba.applyMatrix4(n.projectionMatrixInverse),Ba.multiplyScalar(1/Ba.w),Math.abs(Math.max(Ba.x,Ba.y))}function Vre(n,e){const t=n.matrixWorld,i=n.geometry,s=i.attributes.instanceStart,r=i.attributes.instanceEnd,o=Math.min(i.instanceCount,s.count);for(let a=0,c=o;a<c;a++){As.start.fromBufferAttribute(s,a),As.end.fromBufferAttribute(r,a),As.applyMatrix4(t);const l=new w,h=new w;$a.distanceSqToSegment(As.start,As.end,h,l),h.distanceTo(l)<ad*.5&&e.push({point:h,pointOnLine:l,distance:$a.origin.distanceTo(h),object:n,face:null,faceIndex:a,uv:null,uv1:null})}}function Hre(n,e,t){const i=e.projectionMatrix,r=n.material.resolution,o=n.matrixWorld,a=n.geometry,c=a.attributes.instanceStart,l=a.attributes.instanceEnd,h=Math.min(a.instanceCount,c.count),d=-e.near;$a.at(1,Pa),Pa.w=1,Pa.applyMatrix4(e.matrixWorldInverse),Pa.applyMatrix4(i),Pa.multiplyScalar(1/Pa.w),Pa.x*=r.x/2,Pa.y*=r.y/2,Pa.z=0,NC.copy(Pa),zC.multiplyMatrices(e.matrixWorldInverse,o);for(let f=0,p=h;f<p;f++){if(fs.fromBufferAttribute(c,f),ps.fromBufferAttribute(l,f),fs.w=1,ps.w=1,fs.applyMatrix4(zC),ps.applyMatrix4(zC),fs.z>d&&ps.z>d)continue;if(fs.z>d){const b=fs.z-ps.z,_=(fs.z-d)/b;fs.lerp(ps,_)}else if(ps.z>d){const b=ps.z-fs.z,_=(ps.z-d)/b;ps.lerp(fs,_)}fs.applyMatrix4(i),ps.applyMatrix4(i),fs.multiplyScalar(1/fs.w),ps.multiplyScalar(1/ps.w),fs.x*=r.x/2,fs.y*=r.y/2,ps.x*=r.x/2,ps.y*=r.y/2,As.start.copy(fs),As.start.z=0,As.end.copy(ps),As.end.z=0;const g=As.closestPointToPointParameter(NC,!0);As.at(g,tL);const y=Vn.lerp(fs.z,ps.z,g),A=y>=-1&&y<=1,v=NC.distanceTo(tL)<ad*.5;if(A&&v){As.start.fromBufferAttribute(c,f),As.end.fromBufferAttribute(l,f),As.start.applyMatrix4(o),As.end.applyMatrix4(o);const b=new w,_=new w;$a.distanceSqToSegment(As.start,As.end,_,b),t.push({point:_,pointOnLine:b,distance:$a.origin.distanceTo(_),object:n,face:null,faceIndex:f,uv:null,uv1:null})}}}class Qre extends me{constructor(e=new bG,t=new sR({color:Math.random()*16777215})){super(e,t),this.isLineSegments2=!0,this.type="LineSegments2"}computeLineDistances(){const e=this.geometry,t=e.attributes.instanceStart,i=e.attributes.instanceEnd,s=new Float32Array(2*t.count);for(let o=0,a=0,c=t.count;o<c;o++,a+=2)$k.fromBufferAttribute(t,o),eL.fromBufferAttribute(i,o),s[a]=a===0?0:s[a-1],s[a+1]=s[a]+$k.distanceTo(eL);const r=new db(s,2,1);return e.setAttribute("instanceDistanceStart",new pr(r,1,0)),e.setAttribute("instanceDistanceEnd",new pr(r,1,1)),this}raycast(e,t){const i=this.material.worldUnits,s=e.camera;s===null&&!i&&console.error('LineSegments2: "Raycaster.camera" needs to be set in order to raycast against LineSegments2 while worldUnits is set to false.');const r=e.params.Line2!==void 0&&e.params.Line2.threshold||0;$a=e.ray;const o=this.matrixWorld,a=this.geometry,c=this.material;ad=c.linewidth+r,a.boundingSphere===null&&a.computeBoundingSphere(),A0.copy(a.boundingSphere).applyMatrix4(o);let l;if(i)l=ad*.5;else{const d=Math.max(s.near,A0.distanceToPoint($a.origin));l=iL(s,d,c.resolution)}if(A0.radius+=l,$a.intersectsSphere(A0)===!1)return;a.boundingBox===null&&a.computeBoundingBox(),g0.copy(a.boundingBox).applyMatrix4(o);let h;if(i)h=ad*.5;else{const d=Math.max(s.near,g0.distanceToPoint($a.origin));h=iL(s,d,c.resolution)}g0.expandByScalar(h),$a.intersectsBox(g0)!==!1&&(i?Vre(this,t):Hre(this,s,t))}}class _G extends bG{constructor(){super(),this.isLineGeometry=!0,this.type="LineGeometry"}setPositions(e){const t=e.length-3,i=new Float32Array(2*t);for(let s=0;s<t;s+=3)i[2*s]=e[s],i[2*s+1]=e[s+1],i[2*s+2]=e[s+2],i[2*s+3]=e[s+3],i[2*s+4]=e[s+4],i[2*s+5]=e[s+5];return super.setPositions(i),this}setColors(e){const t=e.length-3,i=new Float32Array(2*t);for(let s=0;s<t;s+=3)i[2*s]=e[s],i[2*s+1]=e[s+1],i[2*s+2]=e[s+2],i[2*s+3]=e[s+3],i[2*s+4]=e[s+4],i[2*s+5]=e[s+5];return super.setColors(i),this}fromLine(e){const t=e.geometry;return this.setPositions(t.attributes.position.array),this}}class jre extends Qre{constructor(e=new _G,t=new sR({color:Math.random()*16777215})){super(e,t),this.isLine2=!0,this.type="Line2"}}var Fd=globalThis&&globalThis.__decorate||function(n,e,t,i){var s=arguments.length,r=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(e,t,r):o(e,t))||r);return s>3&&r&&Object.defineProperty(e,t,r),r};const nL=re("debugwebxr");class ma extends Te{constructor(){super(...arguments);u(this,"movementSpeed",1);u(this,"rotationStep",60);u(this,"useTeleport",!0);u(this,"useTeleportTarget",!1);u(this,"useTeleportFade",!1);u(this,"showRays",!0);u(this,"showHits",!0);u(this,"isXRMovementHandler",!0);u(this,"xrSessionMode","immersive-vr");u(this,"_didApplyRotation",!1);u(this,"_didTeleport",!1);u(this,"_lines",[]);u(this,"_hitDiscs",[]);u(this,"_hitDistances",[]);u(this,"hitPointRaycastFilter",t=>t.type==="SkinnedMesh"?"continue in children":!0)}onUpdateXR(t){const i=t.xr.rig;if(!(i!=null&&i.gameObject)||t.xr.isPassThrough)return;const s=t.xr.leftController,r=t.xr.rightController;s&&this.onHandleMovement(s,i.gameObject),r&&(this.onHandleRotation(r,i.gameObject),this.useTeleport&&this.onHandleTeleport(r,i.gameObject))}onLeaveXR(t){for(const i of this._lines)i.removeFromParent();for(const i of this._hitDiscs)i==null||i.removeFromParent()}onBeforeRender(){var t;(t=this.context.xr)!=null&&t.running&&(this.showRays&&this.renderRays(this.context.xr),this.showHits&&this.renderHits(this.context.xr))}onHandleMovement(t,i){const s=t.getStick("xr-standard-thumbstick"),r=new w(s.x,0,s.y);r.multiplyScalar(this.context.time.deltaTime*this.movementSpeed);const o=br(i);r.multiplyScalar(o.x),r.applyQuaternion(t.xr.poseOrientation),r.y=0,r.applyQuaternion(i.worldQuaternion),i.position.add(r),i.updateMatrixWorld()}onHandleRotation(t,i){const r=t.getStick("xr-standard-thumbstick").x;if(this._didApplyRotation)Math.abs(r)<.3&&(this._didApplyRotation=!1);else if(Math.abs(r)>.5){this._didApplyRotation=!0;const o=r>0?1:-1;i.rotateY(o*nt.toRadians(this.rotationStep))}}onHandleTeleport(t,i){var r;const s=t.getStick("xr-standard-thumbstick");if(this._didTeleport)s.y<.2&&(this._didTeleport=!1);else if(s.y>.8){this._didTeleport=!0;const o=this.context.physics.raycastFromRay(t.ray)[0];if(o){if(this.useTeleportTarget&&!le.getComponentInParent(o.object,eR))return;nL&&kt.DrawSphere(o.point,.025,16711680,5);const a=o.point.clone();this.useTeleportFade?(r=t.xr.fadeTransition())==null||r.then(()=>{i.worldPosition=a}):i.worldPosition=a}}}renderRays(t){for(let i=0;i<this._lines.length;i++){const s=this._lines[i];s.visible=!1}for(let i=0;i<t.controllers.length;i++){const s=t.controllers[i];let r=this._lines[i];if(!s.connected||!s.isTracking){r&&(r.visible=!1);continue}r||(r=this.createRayLineObject(),r.scale.z=.5,this._lines[i]=r),s.updateRayWorldPosition(),s.updateRayWorldQuaternion();const o=s.rayWorldPosition,a=s.rayWorldQuaternion;r.position.copy(o),r.quaternion.copy(a);const c=t.rigScale,l=this._hitDistances[i]??1;r.scale.set(c,c,c*l),r.visible=!0,r.layers.disableAll(),r.layers.enable(2),r.parent!==this.context.scene&&this.context.scene.add(r)}}renderHits(t){for(const i of this._hitDiscs)i&&(i.visible=!1);for(let i=0;i<t.controllers.length;i++){const s=t.controllers[i];if(!s.connected||!s.isTracking)continue;if(this.context.time.frame%2!==0){const a=this._hitDiscs[i];a&&a.hit&&(a.visible=!0);continue}const r=this.context.physics.raycastFromRay(s.ray,{testObject:this.hitPointRaycastFilter})[0];this._hitDistances[i]=r==null?void 0:r.distance;let o=this._hitDiscs[i];if(o&&(o.hit=r),r){const a=t.rigScale??1;nL&&(kt.DrawWireSphere(r.point,.025*a,16711680),kt.DrawLabel(Gn(0,.2,0).add(r.point),r.object.name,.02,0)),o||(o=this.createHitPointObject(),this._hitDiscs[i]=o),o.visible=!0;const c=.01*(1+r.distance);if(o.scale.set(c,c,c),o.layers.disableAll(),o.layers.enable(2),o.hit=r,r.normal){const l=.02*a;o.position.set(0,0,-.1*l).applyQuaternion(s.rayWorldQuaternion),o.position.add(r.point);const h=r.normal.applyQuaternion(In(r.object));o.quaternion.setFromUnitVectors(Wre,h)}else o.position.add(r.point);o.parent!==this.context.scene&&this.context.scene.add(o)}else this._hitDiscs[i]&&(this._hitDiscs[i].visible=!1)}}createHitPointObject(){var t=new ge;const i=new me(new fd(.3,.5,32).rotateX(-Math.PI/2),new ri({color:15658734,opacity:.7,transparent:!0,side:Ai}));i.layers.disableAll(),i.layers.enable(2),t.add(i);const s=new me(new fd(.43,.5,32).rotateX(-Math.PI/2),new ri({color:0,opacity:.2,transparent:!0,side:Ai}));return s.layers.disableAll(),s.layers.enable(2),s.position.z-=.01,t.add(s),t}createRayLineObject(){const t=new jre;t.layers.disableAll(),t.layers.enable(2);const i=new _G;t.geometry=i;const s=new Float32Array(9);s.set([0,0,.02,0,0,.4,0,0,1]),i.setPositions(s);const r=new Float32Array(9);r.set([1,1,1,.1,.1,.1,0,0,0]),i.setColors(r);const o=new sR({color:16777215,vertexColors:!0,worldUnits:!0,linewidth:.004,transparent:!0,blending:cd,dashed:!1,alphaToCoverage:!0});return t.material=o,t}}Fd([x()],ma.prototype,"movementSpeed",void 0);Fd([x()],ma.prototype,"rotationStep",void 0);Fd([x()],ma.prototype,"useTeleport",void 0);Fd([x()],ma.prototype,"useTeleportTarget",void 0);Fd([x()],ma.prototype,"useTeleportFade",void 0);Fd([x()],ma.prototype,"showRays",void 0);Fd([x()],ma.prototype,"showHits",void 0);const Wre=new w(0,1,0);var qre=globalThis&&globalThis.__decorate||function(n,e,t,i){var s=arguments.length,r=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(e,t,r):o(e,t))||r);return s>3&&r&&Object.defineProperty(e,t,r),r};const zm=re("debugwebxr"),Xre=re("debugusdz");class rR extends Te{constructor(){super(...arguments);u(this,"createVRButton",!0);u(this,"createARButton",!0);u(this,"createSendToQuestButton",!0);u(this,"createQRCode",!0);u(this,"useDefaultControls",!0);u(this,"showControllerModels",!0);u(this,"showHandModels",!0);u(this,"usePlacementReticle",!0);u(this,"usePlacementAdjustment",!0);u(this,"arSceneScale",1);u(this,"useXRAnchor",!1);u(this,"useQuicklookExport",!1);u(this,"useDepthSensing",!1);u(this,"defaultAvatar");u(this,"_playerSync");u(this,"_createdComponentsInSession",[]);u(this,"_usdzExporter");u(this,"_previousXRState",0);u(this,"onAvatarSpawned",t=>{zm&&console.log("WebXR.onAvatarSpawned",t),le.getOrAddComponent(t,Vp)});u(this,"_container")}awake(){mt.getXRSync(this.context),zm&&window.addEventListener("keydown",t=>{t.key==="x"&&this.exitXR()})}onEnable(){var t,i,s;window.location.protocol!=="https:"&&gn('<a href="https://developer.mozilla.org/en-US/docs/Web/API/WebXR_Device_API" target="_blank">WebXR</a> only works on secure connections (https).'),this.useQuicklookExport&&(le.findObjectOfType(kn)||(zm&&console.log("WebXR: Adding USDZExporter"),this._usdzExporter=le.addNewComponent(this.gameObject,kn),this._usdzExporter.objectToExport=this.context.scene)),this.handleCreatingHTML(),this.handleOfferSession(),this.defaultAvatar&&(this._playerSync=this.gameObject.getOrAddComponent(lv),this._playerSync.autoSync=!1),this._playerSync&&(this._playerSync.asset=this.defaultAvatar,(t=this._playerSync.onPlayerSpawned)==null||t.removeEventListener(this.onAvatarSpawned),(i=this._playerSync.onPlayerSpawned)==null||i.addEventListener(this.onAvatarSpawned)),this._container&&!this._container.parentNode&&((s=this.context.domElement.shadowRoot)==null||s.appendChild(this._container))}onDisable(){var t,i;(t=this._container)==null||t.remove(),(i=this._usdzExporter)==null||i.destroy()}async handleOfferSession(){return this.createVRButton&&await mt.isVRSupported()&&this.createVRButton?mt.offerSession("immersive-vr","default",this.context):this.createARButton&&await mt.isARSupported()&&this.createARButton?mt.offerSession("immersive-ar","default",this.context):!1}get session(){return mt.active??null}get sessionMode(){return mt.activeMode??null}async enterVR(t){return mt.start("immersive-vr",t,this.context)}async enterAR(t){return mt.start("immersive-ar",t,this.context)}exitXR(){mt.stop()}onBeforeXR(t,i){t=="immersive-ar"&&this.useDepthSensing&&(i.optionalFeatures=i.optionalFeatures||[],i.optionalFeatures.push("depth-sensing"))}async onEnterXR(t){zm&&console.log("WebXR onEnterXR"),this._previousXRState=Qs.Global.Mask;const i=t.xr.isVR;if(Qs.Global.Set(i?Do.VR:Do.AR),this.usePlacementReticle&&t.xr.isAR){let r=le.findObjectOfType(zo);if(r)zm&&console.log("WebXR: WebARSessionRoot already exists, not creating a new one");else{const o=new ge;for(const a of this.context.scene.children)o.add(a);this.context.scene.add(o),r=le.addNewComponent(o,zo),this._createdComponentsInSession.push(r),r.arScale=this.arSceneScale,r.arTouchTransform=this.usePlacementAdjustment,r.useXRAnchor=this.useXRAnchor}}this.useDefaultControls&&this.setDefaultMovementEnabled(!0),(this.showControllerModels||this.showHandModels)&&this.setDefaultControllerRenderingEnabled(!0);let s=le.findObjectOfType(Vb);s||(s=this.gameObject.addNewComponent(Vb)),this.createLocalAvatar(t.xr)}onLeaveXR(t){var i;Qs.Global.Set(this._previousXRState),(i=this._playerSync)==null||i.destroyInstance();for(const s of this._createdComponentsInSession)s.destroy();this._createdComponentsInSession.length=0,this.handleOfferSession()}setDefaultMovementEnabled(t){let i=this.gameObject.getComponent(ma);return!i&&t&&(i=this.gameObject.addNewComponent(ma),this._createdComponentsInSession.push(i)),i&&(i.enabled=t),i}setDefaultControllerRenderingEnabled(t){let i=this.gameObject.getComponent(Il);return!i&&t&&(i=this.gameObject.addNewComponent(Il),this._createdComponentsInSession.push(i),i.createControllerModel=this.showControllerModels,i.createHandModel==this.showHandModels),i&&(i.enabled=t),i}async createLocalAvatar(t){this._playerSync&&t.running&&(this._playerSync.asset=this.defaultAvatar,await this._playerSync.getInstance())}getButtonsContainer(){return this._container||(this._container=Rd.getOrCreate(this.context)),this._container}handleCreatingHTML(){(this.createARButton||this.createVRButton||this.useQuicklookExport)&&((QA()&&og()||Xre)&&this.useQuicklookExport&&this.getButtonsContainer().createQuicklookButton(),this.createARButton&&this.getButtonsContainer().createARButton(),this.createVRButton&&this.getButtonsContainer().createVRButton()),this.createSendToQuestButton&&!i1()&&mt.isVRSupported().then(t=>{t||this.getButtonsContainer().createSendToQuestButton()}),this.createQRCode&&!Pl()&&mt.isXRSupported().then(t=>{(fb()||!t)&&this.getButtonsContainer().createQRCode()})}}qre([x(ii)],rR.prototype,"defaultAvatar",void 0);var om=globalThis&&globalThis.__decorate||function(n,e,t,i){var s=arguments.length,r=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(e,t,r):o(e,t))||r);return s>3&&r&&Object.defineProperty(e,t,r),r};const sL=re("debugimagetracking"),Gg=class{constructor(e,t,i,s,r,o){u(this,"measuredSize");u(this,"state");u(this,"_position");u(this,"_rotation");u(this,"_trackingComponent");u(this,"_trackedImage");u(this,"_bitmap");u(this,"_pose");this._trackingComponent=e,this._trackedImage=t,this._bitmap=i,this.measuredSize=s,this.state=r,this._pose=o}get url(){return this._trackedImage.image??""}get widthInMeters(){return this._trackedImage.widthInMeters??void 0}get bitmap(){return this._bitmap}get model(){return this._trackedImage}getPosition(e){return this.ensureTransformData(),e.copy(this._position),e}getQuaternion(e){return this.ensureTransformData(),e.copy(this._rotation),e}applyToObject(e,t=void 0){this.ensureTransformData();const i=e.position.distanceToSquared(this._position)>.05||e.quaternion.angleTo(this._rotation)>.05;t===void 0||t>=1||i?(e.position.copy(this._position),e.quaternion.copy(this._rotation)):(t=Math.max(0,Math.min(1,t)),e.position.lerp(this._position,t),e.quaternion.slerp(this._rotation,t)),e.quaternion.multiply(Gg.y180)}ensureTransformData(){if(!this._position){this._position=Gg._positionBuffer.get(),this._rotation=Gg._rotationBuffer.get();const e=this._pose.transform,t=mt.active.convertSpace(e);this._position.copy(t==null?void 0:t.position),this._rotation.copy(t==null?void 0:t.quaternion)}}};let wh=Gg;u(wh,"y180",new Me().setFromAxisAngle(new w(0,1,0),Math.PI)),u(wh,"_positionBuffer",new wl(()=>new w,20)),u(wh,"_rotationBuffer",new wl(()=>new Me,20));class nu{constructor(){u(this,"image");u(this,"widthInMeters");u(this,"object");u(this,"createObjectInstance",!1);u(this,"imageDoesNotMove",!1)}}om([x(URL)],nu.prototype,"image",void 0);om([x()],nu.prototype,"widthInMeters",void 0);om([x(ii)],nu.prototype,"object",void 0);om([x()],nu.prototype,"createObjectInstance",void 0);om([x()],nu.prototype,"imageDoesNotMove",void 0);class Yre{constructor(e,t,i){u(this,"filename");u(this,"widthInMeters");u(this,"imageData");this.filename=e,this.imageData=t,this.widthInMeters=i}get extensionName(){return"image-tracking"}onAfterHierarchy(e,t){t.beginBlock('def Preliminary_ReferenceImage "AnchoringReferenceImage"'),t.appendLine("uniform asset image = @tracker/"+this.filename+"@"),t.appendLine("uniform double physicalWidth = "+(this.widthInMeters*100).toFixed(8)),t.closeBlock()}onAfterSerialize(e){e.files["tracker/"+this.filename]=this.imageData}}const Kf=class extends Te{constructor(){super(...arguments);u(this,"trackedImages");u(this,"trackedImageIndexMap",new Map);u(this,"imageToObjectMap",new Map);u(this,"currentImages",[]);u(this,"onImageTrackingUpdate",t=>{const i=mt.active;if(i)for(const s of t){const r=s.model,o=s.state==="tracked";if(!r.object)continue;let a=this.imageToObjectMap.get(r);if(a===void 0)a={object:null,frames:0,lastTrackingTime:Date.now()},this.imageToObjectMap.set(r,a),r.object.loadAssetAsync().then(c=>{if(r.createObjectInstance&&c&&(c=le.instantiate(c)),c){a.object=c;for(const l of c.getComponentsInChildren(an))l.setInstancingEnabled(!1);i.rig?(i.rig.gameObject.add(c),s.applyToObject(c),c.activeSelf||le.setActive(c,!0)):console.warn("XRImageTracking: missing XRRig")}});else{if(a.frames++,o&&(a.lastTrackingTime=Date.now()),r.imageDoesNotMove&&a.frames>10||!a.object)continue;i.rig&&(i.rig.gameObject.add(a.object),s.applyToObject(a.object),a.object.activeSelf||le.setActive(a.object,!0))}}})}awake(){if(sL&&console.log(this),!!this.trackedImages){for(const t of this.trackedImages)if(t.image&&!Kf._imageElements.has(t.image)){const i=t.image;Kf._imageElements.set(i,null);const s=document.createElement("img");s.src=i,s.addEventListener("load",async()=>{const r=await createImageBitmap(s);Kf._imageElements.set(i,r);const o=await vz(r);if(o){const c=await(await o.convertToBlob({type:"image/png"})).arrayBuffer(),l=le.findObjectOfType(kn);l&&this.trackedImages&&(l.extensions.push(new Yre("marker.png",new Uint8Array(c),this.trackedImages[0].widthInMeters)),l.anchoringType="image")}})}}}onBeforeXR(t,i){var s;if(this.trackedImages){i.optionalFeatures=i.optionalFeatures||[],i.optionalFeatures.includes("image-tracking")||i.optionalFeatures.push("image-tracking"),i.trackedImages=[];for(const r of this.trackedImages)if((s=r.image)!=null&&s.length&&r.widthInMeters>0){const o=Kf._imageElements.get(r.image);o&&(this.trackedImageIndexMap.set(i.trackedImages.length,r),i.trackedImages.push({image:o,widthInMeters:r.widthInMeters}))}}}onEnterXR(t){var i;if(this.trackedImages)for(const s of this.trackedImages)(i=s.object)!=null&&i.asset&&s.object.asset;for(const s of this.imageToObjectMap.values())s.frames=0}onUpdateXR(t){this.currentImages.length=0;const i=t.xr.frame;if(!i)return;if("getImageTrackingResults"in i){if(i.session&&typeof i.getImageTrackingResults=="function"){const r=i.getImageTrackingResults();if(r.length>0){const o=this.context.renderer.xr.getReferenceSpace();if(o){for(const a of r){const c=a.trackingState,l=a.index,h=this.trackedImageIndexMap.get(l);if(h){const d=i.getPose(a.imageSpace,o),f=new wh(this,h,a.image,a.measuredSize,c,d);this.currentImages.push(f)}else sL&&console.warn("No tracked image for index",l)}if(this.currentImages.length>0)try{this.dispatchEvent(new CustomEvent("image-tracking",{detail:this.currentImages})),this.onImageTrackingUpdate(this.currentImages)}catch(a){console.error(a)}}}}}else{const r=`Image tracking is currently not supported on this device. On Chrome for Android, you can enable the <a target="_blank" href="#" onclick="() => console.log('I')">chrome://flags/#webxr-incubations</a> flag.`;this.didPrintWarning||(this.didPrintWarning=!0,console.log(r)),gn(r);return}const s=1e3;for(const[r,o]of this.imageToObjectMap){if(!o.object||!r)continue;let a=!1;for(const c of this.currentImages)if(c.model===r){const l=Date.now()-o.lastTrackingTime;if(r.imageDoesNotMove||c.state==="tracked"||l<=s){a=!0;break}}a||le.setActive(o.object,!1)}}};let ap=Kf;u(ap,"_imageElements",new Map);om([x(nu)],ap.prototype,"trackedImages",void 0);var Pv=globalThis&&globalThis.__decorate||function(n,e,t,i){var s=arguments.length,r=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(e,t,r):o(e,t))||r);return s>3&&r&&Object.defineProperty(e,t,r),r};const v0=re("debugplanetracking");class Ud extends Te{constructor(){super(...arguments);u(this,"dataTemplate");u(this,"initiateRoomCaptureIfNoData",!0);u(this,"usePlaneData",!0);u(this,"useMeshData",!0);u(this,"runInVR",!0);u(this,"_dataId",1);u(this,"_allPlanes",new Map);u(this,"_allMeshes",new Map);u(this,"firstTimeNoPlanesDetected",-100);u(this,"_flipForwardMatrix",new Ce().makeRotationY(Math.PI));u(this,"_verticesCache",new Map)}get trackedPlanes(){return this._allPlanes.values()}get trackedMeshes(){return this._allMeshes.values()}onBeforeXR(t,i){t==="immersive-vr"&&!this.runInVR||(i.optionalFeatures=i.optionalFeatures||[],this.usePlaneData&&!i.optionalFeatures.includes("plane-detection")&&i.optionalFeatures.push("plane-detection"),this.useMeshData&&!i.optionalFeatures.includes("mesh-detection")&&i.optionalFeatures.push("mesh-detection"))}onEnterXR(t){for(const i of this._allPlanes.keys())this.removeData(i,this._allPlanes);for(const i of this._allMeshes.keys())this.removeData(i,this._allMeshes)}onUpdateXR(t){if(!this.runInVR&&t.xr.isVR)return;const i=t.xr.rig;if(!i){console.warn("No XR rig found, cannot parent tracked planes to it");return}const s=t.xr.frame;if(!this.context.renderer.xr.getReferenceSpace())return;const a=s.detectedPlanes,c=s.detectedMeshes,l=a!==void 0&&a.size>0,h=c!==void 0&&c.size>0;this.initiateRoomCaptureIfNoData&&(!l&&!h&&this.firstTimeNoPlanesDetected<-10&&(this.firstTimeNoPlanesDetected=Date.now()),(l||h)&&(this.firstTimeNoPlanesDetected=-1),this.firstTimeNoPlanesDetected>0&&Date.now()-this.firstTimeNoPlanesDetected>2500&&"initiateRoomCapture"in s.session&&(s.session.initiateRoomCapture(),this.firstTimeNoPlanesDetected=-1)),a!==void 0&&this.processFrameData(t.xr,i.gameObject,s,a,this._allPlanes),c!==void 0&&this.processFrameData(t.xr,i.gameObject,s,c,this._allMeshes)}removeData(t,i){const s=i.get(t);if(!s)return;i.delete(t),v0&&console.log("Plane no longer tracked, id="+s.id),s.mesh&&s.mesh.parent&&(s.mesh.parent.remove(s.mesh),gc(s.mesh,!0,!0));const r=new CustomEvent("plane-tracking",{detail:{type:"plane-removed",context:s}});this.dispatchEvent(r)}processFrameData(t,i,s,r,o){const c=this.context.renderer.xr.getReferenceSpace();if(c){for(const l of o.keys())r.has(l)||this.removeData(l,o);for(const l of r){const h="planeSpace"in l?l.planeSpace:"meshSpace"in l?l.meshSpace:void 0;if(!h)continue;const d=s.getPose(h,c);let f;const p=m=>{if(m){if(m instanceof Array){for(const g of m)p(g);return}m.name.includes("Occlu")&&(m.colorWrite=!1,m.depthWrite=!0,m.transparent=!1,m.polygonOffset=!0,m.polygonOffsetFactor=1,m.polygonOffsetUnits=.1,m._renderOrder=-1e3)}};if(o.has(l)){const m=o.get(l);if(f=m.mesh,m.timestamp<l.lastChangedTime){if(m.timestamp=l.lastChangedTime,m.mesh){const y=this.createGeometry(l);if(m.mesh instanceof me)m.mesh.geometry.dispose(),m.mesh.geometry=y,p(m.mesh.material);else if(m.mesh instanceof fr)for(const A of m.mesh.children)A instanceof me&&(A.geometry.dispose(),A.geometry=y,p(A.material));if(m.collider){const A=m.mesh;m.collider.sharedMesh=A,m.collider.convex=this.checkIfContextShouldBeConvex(A,m.xrData),m.collider.onDisable(),m.collider.onEnable()}v0&&console.log("Plane updated, id="+m.id,m)}const g=new CustomEvent("plane-tracking",{detail:{type:"plane-updated",context:m}});this.dispatchEvent(g)}}else{if(!this.dataTemplate){const m=new me;v0?m.material=new q_:m.material=new ri({wireframe:!0,opacity:.33,transparent:!0,color:0}),this.dataTemplate=new ii("","",m)}if(!this.dataTemplate.asset)this.dataTemplate.loadAssetAsync();else{const m=le.instantiate(this.dataTemplate.asset);if(f=m,m instanceof me)Qi(m.geometry),m.geometry=this.createGeometry(l),p(m.material);else if(m instanceof fr)for(const A of m.children)A instanceof me&&(Qi(A.geometry),A.geometry=this.createGeometry(l),p(A.material));const g=m.getComponent(uv);if(g){const A=m;g.sharedMesh=A,g.convex=this.checkIfContextShouldBeConvex(A,l),g.onDisable(),g.onEnable()}m.matrixAutoUpdate=!1,m.matrixWorldNeedsUpdate=!0,i.add(m);const y={id:this._dataId++,xrData:l,timestamp:l.lastChangedTime,mesh:m,collider:g};o.set(l,y),v0&&console.log("New plane detected, id="+y.id,y);try{const A=new CustomEvent("plane-tracking",{detail:{type:"plane-added",context:y}});this.dispatchEvent(A)}catch(A){console.error(A)}}}f&&(d?(f.visible=!0,f.matrix.fromArray(d.transform.matrix),f.matrix.premultiply(this._flipForwardMatrix)):f.visible=!1)}}}checkIfContextShouldBeConvex(t,i){if(!t)return!0;if(t){const s=new Mi;s.expandByObject(t);const r=new w;s.getSize(r);let o=!0;return r.x>2&&r.y>2&&r.z>1.5&&(o=!1),o&&"semanticLabel"in i&&i.semanticLabel==="wall"&&(o=!0),o}return!0}createGeometry(t){return"polygon"in t?this.createPlaneGeometry(t.polygon):"vertices"in t&&"indices"in t?this.createMeshGeometry(t.vertices,t.indices):new gt}createMeshGeometry(t,i){const s=t.toString()+"_"+i.toString();if(this._verticesCache.has(s))return this._verticesCache.get(s);const r=new gt;r.setIndex(new it(i,1)),r.setAttribute("position",new it(t,3));const o=Array();for(let a=0;a<t.length;a+=3)o.push(t[a],t[a+2]);return r.setAttribute("uv",new it(new Float32Array(o),2)),this._verticesCache.set(s,r),r}createPlaneGeometry(t){const i=new gt,s=[],r=[];t.forEach(p=>{s.push(p.x,p.y,p.z),r.push(p.x,p.z)});const o=new w(s[0],s[1],s[2]),a=new w(s[3],s[4],s[5]),c=new w(s[6],s[7],s[8]),l=new w,h=new w;l.subVectors(a,o),h.subVectors(c,o),l.cross(h),l.normalize();const d=[];for(let p=0;p<s.length/3;p++)d.push(l.x,l.y,l.z);const f=[];for(let p=2;p<t.length;++p)f.push(0,p-1,p);return i.setAttribute("position",new it(new Float32Array(s),3)),i.setAttribute("uv",new it(new Float32Array(r),2)),i.setAttribute("normal",new it(new Float32Array(d),3)),i.setIndex(f),i}}Pv([x(ii)],Ud.prototype,"dataTemplate",void 0);Pv([x()],Ud.prototype,"initiateRoomCaptureIfNoData",void 0);Pv([x()],Ud.prototype,"usePlaneData",void 0);Pv([x()],Ud.prototype,"useMeshData",void 0);Pv([x()],Ud.prototype,"runInVR",void 0);var xG=globalThis&&globalThis.__decorate||function(n,e,t,i){var s=arguments.length,r=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(e,t,r):o(e,t))||r);return s>3&&r&&Object.defineProperty(e,t,r),r};class ww extends Te{constructor(){super(...arguments);u(this,"side","none");u(this,"controller",!0);u(this,"hands",!1);u(this,"controlVisibility",!0);u(this,"useGripSpace",!1)}get activeAndEnabled(){return!0}onUpdateXR(t){const i=t.xr.getController(this.side);if(i){if(i.hand&&!this.hands){this.controlVisibility&&(this.gameObject.visible=!1);return}else if(!this.controller){this.controlVisibility&&(this.gameObject.visible=!1);return}this.controlVisibility&&(this.gameObject.visible=!0),this.useGripSpace?(this.gameObject.worldPosition=i.gripWorldPosition,this.gameObject.worldQuaternion=i.gripWorldQuaternion):(this.gameObject.worldPosition=i.rayWorldPosition,this.gameObject.worldQuaternion=i.rayWorldQuaternion)}}}xG([x()],ww.prototype,"side",void 0);xG([x()],ww.prototype,"controller",void 0);var Jre=globalThis&&globalThis.__decorate||function(n,e,t,i){var s=arguments.length,r=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(e,t,r):o(e,t))||r);return s>3&&r&&Object.defineProperty(e,t,r),r};const rL=re("debugwebxr");class oR extends Te{constructor(){super(...arguments);u(this,"priority",0);u(this,"_startScale")}get isActive(){return this.activeAndEnabled&&this.gameObject.visible}setAsActiveXRRig(){var t;(t=mt.active)==null||t.setRigActive(this)}awake(){if(rL){const t=new ge;t.position.y+=.5,this.gameObject.add(t);const i=t.addNewComponent(Wp);i&&(i.isGizmo=!1);const s=new Fo(.5);this.gameObject.add(s)}}isXRRig(){return!0}supportsXR(t){return!0}onEnterXR(t){this._startScale=this.gameObject.scale.clone(),t.xr.addRig(this),rL&&console.log("WebXR: add Rig",this.name,this.priority)}onLeaveXR(t){t.xr.removeRig(this),this._startScale&&this.gameObject&&this.gameObject.scale.copy(this._startScale)}}Jre([x()],oR.prototype,"priority",void 0);class wG{}const Kre=Object.freeze(Object.defineProperty({__proto__:null,ActionBuilder:di,ActionCollection:xz,ActionModel:To,AlignmentConstraint:Mx,Animation:Uo,AnimationCurve:Tl,AnimationExtension:Lx,AnimationTrackHandler:fI,Animator:Xs,AnimatorController:ko,Antialiasing:Ux,AudioExtension:gI,AudioListener:sd,AudioSource:Ti,AudioTrackHandler:np,Avatar:Vp,AvatarBlink_Simple:Qp,AvatarEyeLook_Rotation:Fh,AvatarLoader:Dz,AvatarMarker:ns,AvatarModel:bI,Avatar_Brain_LookAt:qb,Avatar_MouthShapes:Gx,Avatar_MustacheShake:Bz,Avatar_POI:Al,AxesHelper:hv,BaseUIComponent:Ac,BasicIKConstraint:Oz,BehaviorExtension:xI,BehaviorModel:ss,Bloom:jp,BoxCollider:Qx,BoxGizmo:Wp,BoxHelperComponent:ra,Button:$h,CallInfo:_A,Camera:Di,CameraTargetReachedEvent:Qb,Canvas:as,CanvasGroup:yd,CapsuleCollider:vd,ChangeMaterialOnClick:ll,ChangeTransformOnClick:qp,CharacterController:Xp,CharacterControllerInput:tu,ChromaticAberration:Yx,Collider:xa,ColorAdjustments:Ed,ColorBySpeedModule:Yp,ColorOverLifetimeModule:Kx,ContactShadows:Id,ControlTrackHandler:pI,CustomBranding:Pd,Deletable:Qz,DeleteBox:RI,DepthOfField:Sc,DeviceFlag:PI,DocumentExtension:jz,DragControls:gr,DropListener:ew,Duplicatable:Jp,EmissionModule:Ul,EmphasizeOnClick:mv,EventList:Cs,EventListEvent:lI,EventSystem:$r,EventTrigger:LI,FieldWithDefault:uz,FixedJoint:qz,FlyControls:Xz,Fog:bv,GltfExport:Ka,GltfExportBox:eG,Gradient:Td,Graphic:vl,GraphicRaycaster:hI,GridHelper:_v,GridLayoutGroup:Gz,GroundProjectedEnv:Kp,GroupActionModel:Hu,HideOnStart:Vz,HingeJoint:iw,HorizontalLayoutGroup:zz,Image:Ll,InheritVelocityModule:Nl,InputField:aa,LODGroup:rw,LODModel:Zp,Light:lo,LimitVelocityOverLifetimeModule:qn,LogStats:tG,LookAt:yl,LookAtConstraint:Rx,MainModule:Zs,MaskableGraphic:jx,MeshCollider:uv,MeshRenderer:Tx,MinMaxCurve:ht,MinMaxGradient:xs,NeedleWebXRHtmlElement:Rd,NestedGltf:VI,Networking:Ml,NoiseModule:Pi,ObjectRaycaster:No,OffsetConstraint:$p,OpenURL:wv,OrbitControls:$i,Outline:dv,Padding:Cd,ParticleBurst:Yb,ParticleSubEmitter:JI,ParticleSystem:on,ParticleSystemRenderer:Sa,PixelationEffect:pw,PlayAnimationOnClick:hl,PlayAudioOnClick:gv,PlayableDirector:Lh,PlayerColor:PA,PointerEventData:ov,PostProcessingHandler:KI,PreliminaryAction:Av,PreliminaryTrigger:qx,RGBAColor:Ii,RawImage:EI,Rect:Fz,RectTransform:Ys,ReflectionProbe:cl,RegisteredAnimationInfo:mI,RemoteSkybox:Wh,Renderer:an,RendererLightmap:Fb,Rigidbody:ki,RotationBySpeedModule:Qo,RotationOverLifetimeModule:wa,SceneSwitcher:Sr,ScreenCapture:im,ScreenSpaceAmbientOcclusion:iu,ScreenSpaceAmbientOcclusionN8:Ec,SetActiveOnClick:Ro,ShadowCatcher:Aw,ShapeModule:Vi,SignalAsset:Dx,SignalReceiver:kh,SignalReceiverEvent:cv,SignalTrackHandler:jb,Size:Lz,SizeBySpeedModule:Vr,SizeOverLifetimeModule:Md,SkinnedMeshRenderer:dz,SmoothFollow:pc,SpatialGrabRaycaster:Vb,SpatialHtml:mG,SpatialTrigger:od,SpatialTriggerReceiver:bl,SpectatorCamera:$I,SphereCollider:Hx,Sprite:Tc,SpriteData:Iv,SpriteRenderer:Gl,SpriteSheet:yw,SubEmitterSystem:o_,SyncedCamera:op,SyncedRoom:Ld,SyncedTransform:Ad,TapGestureTrigger:Hz,TeleportTarget:eR,TestRunner:gG,TestSimulateUserData:AG,Text:er,TextBuilder:MI,TextExtension:Zx,TextureSheetAnimationModule:$s,TiltShiftEffect:Vl,ToneMapping:bw,TrailModule:ln,TransformData:oa,TransformGizmo:sm,TriggerBuilder:js,TriggerModel:Oh,UIRaycastUtils:uI,UIRootComponent:Px,USDZExporter:kn,USDZText:ju,USDZUIExtension:II,UsageMarker:$x,VariantAction:_z,VelocityOverLifetimeModule:An,VerticalLayoutGroup:Nz,VideoPlayer:cs,Vignette:rm,VisibilityAction:Xx,Voip:Hp,Volume:iR,VolumeParameter:It,VolumeProfile:Fx,WebARCameraBackground:nR,WebARSessionRoot:zo,WebXR:rR,WebXRImageTracking:ap,WebXRImageTrackingModel:nu,WebXRPlaneTracking:Ud,WebXRTrackedImage:wh,XRControllerFollow:ww,XRControllerModel:Il,XRControllerMovement:ma,XRFlag:bs,XRRig:oR,XRState:Qs,__Ignore:wG},Symbol.toStringTag,{value:"Module"}));class Zre extends Te{constructor(){super(...arguments);u(this,"toggleKey","KeyP")}update(){this.context.input.isKeyDown(this.toggleKey)&&this.context.domElement.classList.toggle("presentation-mode")}}ee.add("__Ignore",wG);ee.add("ActionBuilder",di);ee.add("ActionCollection",xz);ee.add("ActionModel",To);ee.add("AlignmentConstraint",Mx);ee.add("Animation",Uo);ee.add("AnimationCurve",Tl);ee.add("AnimationExtension",Lx);ee.add("AnimationTrackHandler",fI);ee.add("Animator",Xs);ee.add("AnimatorController",ko);ee.add("Antialiasing",Ux);ee.add("AudioExtension",gI);ee.add("AudioListener",sd);ee.add("AudioSource",Ti);ee.add("AudioTrackHandler",np);ee.add("Avatar",Vp);ee.add("Avatar_Brain_LookAt",qb);ee.add("Avatar_MouthShapes",Gx);ee.add("Avatar_MustacheShake",Bz);ee.add("Avatar_POI",Al);ee.add("AvatarBlink_Simple",Qp);ee.add("AvatarEyeLook_Rotation",Fh);ee.add("AvatarLoader",Dz);ee.add("AvatarMarker",ns);ee.add("AvatarModel",bI);ee.add("AxesHelper",hv);ee.add("BaseUIComponent",Ac);ee.add("BasicIKConstraint",Oz);ee.add("BehaviorExtension",xI);ee.add("BehaviorModel",ss);ee.add("Bloom",jp);ee.add("BoxCollider",Qx);ee.add("BoxGizmo",Wp);ee.add("BoxHelperComponent",ra);ee.add("Button",$h);ee.add("CallInfo",_A);ee.add("Camera",Di);ee.add("CameraTargetReachedEvent",Qb);ee.add("Canvas",as);ee.add("CanvasGroup",yd);ee.add("CapsuleCollider",vd);ee.add("ChangeMaterialOnClick",ll);ee.add("ChangeTransformOnClick",qp);ee.add("CharacterController",Xp);ee.add("CharacterControllerInput",tu);ee.add("ChromaticAberration",Yx);ee.add("Collider",xa);ee.add("ColorAdjustments",Ed);ee.add("ColorBySpeedModule",Yp);ee.add("ColorOverLifetimeModule",Kx);ee.add("ContactShadows",Id);ee.add("ControlTrackHandler",pI);ee.add("CustomBranding",Pd);ee.add("Deletable",Qz);ee.add("DeleteBox",RI);ee.add("DepthOfField",Sc);ee.add("DeviceFlag",PI);ee.add("DocumentExtension",jz);ee.add("DragControls",gr);ee.add("DropListener",ew);ee.add("Duplicatable",Jp);ee.add("EmissionModule",Ul);ee.add("EmphasizeOnClick",mv);ee.add("EventList",Cs);ee.add("EventListEvent",lI);ee.add("EventSystem",$r);ee.add("EventTrigger",LI);ee.add("FieldWithDefault",uz);ee.add("FixedJoint",qz);ee.add("FlyControls",Xz);ee.add("Fog",bv);ee.add("GltfExport",Ka);ee.add("GltfExportBox",eG);ee.add("Gradient",Td);ee.add("Graphic",vl);ee.add("GraphicRaycaster",hI);ee.add("GridHelper",_v);ee.add("GridLayoutGroup",Gz);ee.add("GroundProjectedEnv",Kp);ee.add("GroupActionModel",Hu);ee.add("HideOnStart",Vz);ee.add("HingeJoint",iw);ee.add("HorizontalLayoutGroup",zz);ee.add("Image",Ll);ee.add("InheritVelocityModule",Nl);ee.add("InputField",aa);ee.add("Light",lo);ee.add("LimitVelocityOverLifetimeModule",qn);ee.add("LODGroup",rw);ee.add("LODModel",Zp);ee.add("LogStats",tG);ee.add("LookAt",yl);ee.add("LookAtConstraint",Rx);ee.add("MainModule",Zs);ee.add("MaskableGraphic",jx);ee.add("MeshCollider",uv);ee.add("MeshRenderer",Tx);ee.add("MinMaxCurve",ht);ee.add("MinMaxGradient",xs);ee.add("NeedleWebXRHtmlElement",Rd);ee.add("NestedGltf",VI);ee.add("Networking",Ml);ee.add("NoiseModule",Pi);ee.add("ObjectRaycaster",No);ee.add("OffsetConstraint",$p);ee.add("OpenURL",wv);ee.add("OrbitControls",$i);ee.add("Outline",dv);ee.add("Padding",Cd);ee.add("ParticleBurst",Yb);ee.add("ParticleSubEmitter",JI);ee.add("ParticleSystem",on);ee.add("ParticleSystemRenderer",Sa);ee.add("PixelationEffect",pw);ee.add("PlayableDirector",Lh);ee.add("PlayAnimationOnClick",hl);ee.add("PlayAudioOnClick",gv);ee.add("PlayerColor",PA);ee.add("PlayerState",Hs);ee.add("PlayerSync",lv);ee.add("PointerEventData",ov);ee.add("PostProcessingHandler",KI);ee.add("PreliminaryAction",Av);ee.add("PreliminaryTrigger",qx);ee.add("PresentationMode",Zre);ee.add("RawImage",EI);ee.add("Rect",Fz);ee.add("RectTransform",Ys);ee.add("ReflectionProbe",cl);ee.add("RegisteredAnimationInfo",mI);ee.add("RemoteSkybox",Wh);ee.add("Renderer",an);ee.add("RendererLightmap",Fb);ee.add("RGBAColor",Ii);ee.add("Rigidbody",ki);ee.add("RotationBySpeedModule",Qo);ee.add("RotationOverLifetimeModule",wa);ee.add("SceneSwitcher",Sr);ee.add("ScreenCapture",im);ee.add("ScreenSpaceAmbientOcclusion",iu);ee.add("ScreenSpaceAmbientOcclusionN8",Ec);ee.add("SetActiveOnClick",Ro);ee.add("ShadowCatcher",Aw);ee.add("ShapeModule",Vi);ee.add("SignalAsset",Dx);ee.add("SignalReceiver",kh);ee.add("SignalReceiverEvent",cv);ee.add("SignalTrackHandler",jb);ee.add("Size",Lz);ee.add("SizeBySpeedModule",Vr);ee.add("SizeOverLifetimeModule",Md);ee.add("SkinnedMeshRenderer",dz);ee.add("SmoothFollow",pc);ee.add("SpatialGrabRaycaster",Vb);ee.add("SpatialHtml",mG);ee.add("SpatialTrigger",od);ee.add("SpatialTriggerReceiver",bl);ee.add("SpectatorCamera",$I);ee.add("SphereCollider",Hx);ee.add("Sprite",Tc);ee.add("SpriteData",Iv);ee.add("SpriteRenderer",Gl);ee.add("SpriteSheet",yw);ee.add("SubEmitterSystem",o_);ee.add("SyncedCamera",op);ee.add("SyncedRoom",Ld);ee.add("SyncedTransform",Ad);ee.add("TapGestureTrigger",Hz);ee.add("TeleportTarget",eR);ee.add("TestRunner",gG);ee.add("TestSimulateUserData",AG);ee.add("Text",er);ee.add("TextBuilder",MI);ee.add("TextExtension",Zx);ee.add("TextureSheetAnimationModule",$s);ee.add("TiltShiftEffect",Vl);ee.add("ToneMapping",bw);ee.add("TrailModule",ln);ee.add("TransformData",oa);ee.add("TransformGizmo",sm);ee.add("TriggerBuilder",js);ee.add("TriggerModel",Oh);ee.add("UIRaycastUtils",uI);ee.add("UIRootComponent",Px);ee.add("UsageMarker",$x);ee.add("USDZExporter",kn);ee.add("USDZText",ju);ee.add("USDZUIExtension",II);ee.add("VariantAction",_z);ee.add("VelocityOverLifetimeModule",An);ee.add("VerticalLayoutGroup",Nz);ee.add("VideoPlayer",cs);ee.add("Vignette",rm);ee.add("VisibilityAction",Xx);ee.add("Voip",Hp);ee.add("Volume",iR);ee.add("VolumeParameter",It);ee.add("VolumeProfile",Fx);ee.add("WebARCameraBackground",nR);ee.add("WebARSessionRoot",zo);ee.add("WebXR",rR);ee.add("WebXRImageTracking",ap);ee.add("WebXRImageTrackingModel",nu);ee.add("WebXRPlaneTracking",Ud);ee.add("WebXRTrackedImage",wh);ee.add("XRControllerFollow",ww);ee.add("XRControllerModel",Il);ee.add("XRControllerMovement",ma);ee.add("XRFlag",bs);ee.add("XRRig",oR);ee.add("XRState",Qs);const kg=_s,$re=re("debugtypestore");$re&&console.log(ee);function eoe(n,e){const i=hq(n,e);return i!==void 0?i:null}const toe=new lq,GC=Symbol("deserialize-queue");async function ioe(n,e,t,i=null,s){if(!t)return;let r=i;typeof r=="number"&&(r=new Ss(i));const o=e.indexOf("?");e=o===-1?e:e.substring(0,o);const a=new WF(t.scene);a.gltfId=e,a.context=n,a.gltf=t,a.nodeToObject=s==null?void 0:s.nodeToObjectMap,a.implementationInformation=toe;let c=n[GC];if(c||(c=n[GC]=[]),t.scenes)for(const l of t.scenes)await eM(a,l,c);if(t.children)for(const l of t.children)await eM(a,l,c);n.new_scripts_pre_setup_callbacks.push(()=>{const l=n[GC];if(l){for(const h of l)noe(h,a);l.length=0}if(r){const h={},d=[];$T(t,r,h,d);for(const f of t.scenes)$T(f,r,h,d);for(const f of d)f.resolveGuids(h)}})}const ZT=Symbol("original-component-name"),gf=new Map;function $T(n,e,t,i){if(e===null||!n)return;const s=n.guid,r=n.guid;r!=null&&r.length&&(gf.has(r)||(kg&&console.log('Creating InstanceIdProvider with key "'+r+'" for object '+n.name),gf.set(r,new Ss(r))));const o=r&&gf.get(r)||e;if(n.guid=o.generateUUID(),s&&s!=="invalid"&&(t[s]=n.guid),n&&n.userData&&n.userData.components)for(const a of n.userData.components){if(a===null)continue;const c=a.guid;c?gf.has(c)||(kg&&console.log('Creating InstanceIdProvider with key "'+c+'" for component '+a[ZT]),gf.set(c,new Ss(c))):kg&&console.warn("Can not create IdProvider: component "+a[ZT]+" has no guid",a.guid);const l=gf.get(c)||e,h=a.guid;a.guid=l.generateUUID(),h&&h!=="invalid"&&(t[h]=a.guid),a.resolveGuids&&i.push(a)}if(n.children)for(const a of n.children)$T(a,e,t,i)}const Gm=[];async function eM(n,e,t,i){if(!e)return;const s=e.userData;if(s){const r=s.builtin_components;if(r&&r.length>0)for(const o of r)try{if(o===null)continue;const a=ee.get(o.name);if(a!=null){const c=new a;c.sourceId=n.gltfId,gp(c,o,n.implementationInformation),"guid"in o&&(c[S0]=o.guid),c[ZT]=o.name,wd(e,c,!1),t.push({instance:c,compData:o,obj:e}),c.isCamera&&n.context&&n.context.mainCamera===null&&c.tag==="MainCamera"&&n.context.setCurrentCamera(c)}else kg&&console.debug("unknown component: "+o.name),Gm.includes(o.name)||Gm.push(o.name)}catch(a){console.error(o.name+" - "+a.message,a)}if(Gm.length>0){const o=Gm.join(", ");console.warn("unknown components: "+o),Gm.length=0,zr()&&Tn(`<strong>Unknown components in scene</strong>:

${o}

This could mean you forgot to add a npmdef to your ExportInfo
<a href="https://engine.needle.tools/docs/project_structure.html#creating-and-installing-a-npmdef" target="_blank">documentation</a>`,rs.Warn)}}if(e.children)for(const r of e.children)await eM(n,r,t)}function noe(n,e){const{instance:t,compData:i,obj:s}=n;e.object=s,e.target=t,kE(t,i,e),kg&&console.debug("add "+i.name,i,t)}class SG{createBuiltinComponents(e,t,i,s,r){return ioe(e,t,i,s,r)}writeBuiltinComponentData(e,t){return eoe(e,t)}parseSync(e,t,i,s){return soe(e,t,i,s)}loadSync(e,t,i,s,r){return IG(e,t,i,s,r)}}lL(SG);const CG=re("printGltf")||re("printgltf"),EG=re("downloadgltf");var Uh;(function(n){n[n.BeforeLoad=0]="BeforeLoad",n[n.AfterLoaded=1]="AfterLoaded",n[n.FinishedSetup=10]="FinishedSetup"})(Uh||(Uh={}));class cp{constructor(e,t,i,s){u(this,"context");u(this,"loader");u(this,"path");u(this,"gltf");this.context=e,this.path=t,this.loader=i,this.gltf=s}}const oL={};function lp(n,e){if(oL[n])for(const t of oL[n])t(e)}async function TG(n,e,t,i,s){CG&&console.warn("glTF",e,t),e.includes("?")&&(e=e.split("?")[0]),await mc().createBuiltinComponents(n,e,t,i,s)}async function MG(n,e){const t=new Gp;return await nne(t,e,n),t}async function soe(n,e,t,i){typeof t!="string"&&(console.warn("Parse gltf binary without path, this might lead to errors in resolving extensions. Please provide the source path of the gltf/glb file",t,typeof t),t=""),CG&&console.log("Parse glTF",t);const s=await MG(t,n),r=Zz(s);return new Promise((o,a)=>{try{let c=t.split("?")[0].trimEnd();if(c.endsWith(".glb")||c.endsWith(".gltf")){const l=c.split("/");l.pop(),c=l.join("/"),c.endsWith("/")||(c+="/")}s.resourcePath=c,nv(s,n),lp(Uh.BeforeLoad,new cp(n,t,s)),s.parse(e,"",async l=>{lp(Uh.AfterLoaded,new cp(n,t,s,l)),await TG(n,t,l,i,r),lp(Uh.FinishedSetup,new cp(n,t,s,l)),MF(l.scene,n),o(l),EG&&RG(e)},l=>{console.error("failed loading "+t,l),o(void 0)})}catch(c){console.error(c),a(c)}})}async function IG(n,e,t,i,s){roe(e);const r=await MG(e,n),o=Zz(r);return new Promise((a,c)=>{try{nv(r,n),lp(Uh.BeforeLoad,new cp(n,e,r)),r.load(e,async l=>{lp(Uh.AfterLoaded,new cp(n,e,r,l)),await TG(n,t,l,i,o),lp(Uh.FinishedSetup,new cp(n,e,r,l)),MF(l.scene,n),a(l),EG&&RG(e)},l=>{s==null||s.call(r,l)},l=>{console.error("failed loading "+e,l),a(void 0)})}catch(l){console.error(l),c(l)}})}function roe(n){if(new URL(n,window.location.href).href.startsWith("file://")){const t=`Hi - it looks like you are trying to load a local file which will not work. You need to use a webserver to serve your files.
Please refer to the documentation on <a href="https://fwd.needle.tools/needle-engine/docs/local-server">https://docs.needle.tools</a> or ask for help in our <a href="https://discord.needle.tools">discord community</a>`;Tn(t),console.warn(t)}}function RG(n){if(typeof n=="string"){const e=document.createElement("a");e.href=n,e.download=n.split("/").pop(),e.click()}else{const e=new Blob([n],{type:"application/octet-stream"}),t=window.URL.createObjectURL(e),i=document.createElement("a");i.href=t,i.download="download.glb",i.click()}}lL(SG);const tn=re("debugwebcomponent"),aL="needle-engine",PG="vr",BG="desktop",ooe=[j3,PG,BG],Vm="ar-session-active",Hm="desktop-session-active",aoe=["hash","src","camera-controls","loadstart","progress","loadfinished","dracoDecoderPath","dracoDecoderType","ktx2DecoderPath"];class DG extends HTMLElement{constructor(){super();u(this,"gameObject",le);u(this,"GameObject",le);u(this,"_context");u(this,"_overlay_ar");u(this,"_loadingProgress01",0);u(this,"_loadingView");u(this,"_previousSrc",null);u(this,"_didFullyLoad",!1);u(this,"_loadId",0);u(this,"_lastSourceFiles",null);u(this,"onXRSessionStarted",()=>{var i;const t=this.context.xrSessionMode;t==="immersive-ar"?this.onEnterAR(this.context.xrSession):t==="immersive-vr"&&this.onEnterVR(this.context.xrSession),(i=this.context.xrSession)==null||i.addEventListener("end",()=>{this.dispatchEvent(new CustomEvent("xr-session-ended",{detail:{session:this.context.xrSession,context:this._context,sessionMode:t}})),t==="immersive-ar"?this.onExitAR(this.context.xrSession):t==="immersive-vr"&&this.onExitVR(this.context.xrSession)})});u(this,"onReady",()=>{var t;return(t=this._loadingView)==null?void 0:t.onLoadingFinished()});u(this,"onError",()=>{var t;return(t=this._loadingView)==null?void 0:t.setMessage("Loading failed!")});u(this,"_previouslyRegisteredMap",new Map);this._overlay_ar=new x$,this.addEventListener("ready",this.onReady),this.attachShadow({mode:"open"});const t=document.createElement("template");t.innerHTML=`<style>
@import url('https://fonts.googleapis.com/css2?family=Roboto:wght@300&display=swap');

    :host {
        position: absolute;
        display: block;
        width: max(600px, 100%);
        height: max(300px, 100%);
    }

    @media (max-width: 600px) {
        :host {
            width: 100%;
        }
    }
    @media (max-height: 300px) {
        :host {
            height: 100%;
        }
    }
    :host canvas {   
        position: absolute;
        user-select: none;
        /** allow touch panning but no pinch zoom **/
        /** but this doesnt work yet: 
         * touch-action: pan-x, pan-y;
         **/
    }
    :host .content {
        position: absolute;
        width: 100%;
        height: 100%;
        visibility: visible;
        z-index: 500; /* < must be less than the webxr buttons element */
        pointer-events: none;
    }
    :host .overlay-content {
        position: absolute;
        user-select: auto;
        pointer-events: all;
    }
    :host slot[name="quit-ar"]:hover {
        cursor: pointer;
    }
    :host .quit-ar-button {
        position: absolute;
        // top: env(titlebar-area-y); /** this doesnt work **/
        top: 60px; /** camera access needs a bit more space **/
        right: 20px;
        z-index: 9999;
    }
</style>
<div> <!-- this wrapper is necessary for WebXR https://github.com/meta-quest/immersive-web-emulator/issues/55 -->
    <canvas></canvas>
</div>
<div class="content">
    <slot class="overlay-content"></slot>
</div>
`,this.shadowRoot&&this.shadowRoot.appendChild(t.content.cloneNode(!0)),this._context=new Lt({domElement:this}),this.addEventListener("error",this.onError)}static get observedAttributes(){return aoe}get loadingProgress01(){return this._loadingProgress01}get loadingFinished(){return this.loadingProgress01>.999}get cameraControls(){const t=this.getAttribute("camera-controls");return!(t===null||t==="False"||t==="false"||t==="0")}getContext(){return new Promise((t,i)=>{if(this._context&&this.loadingFinished)t(this._context);else{const s=()=>{this.removeEventListener("loadfinished",s),this._context&&this.loadingFinished&&t(this._context)};this.addEventListener("loadfinished",s)}})}get context(){return this._context}get Context(){return this._context}async connectedCallback(){if(tn&&console.log("<needle-engine> connected"),this.addEventListener("xr-session-started",this.onXRSessionStarted),this.onSetupDesktop(),!this.getAttribute("src")){const i=globalThis["needle:codegen_files"];tn&&console.log('src is null, trying to load from globalThis["needle:codegen_files"]',i),i&&(tn&&console.log('globalThis["needle:codegen_files"]',i),this.setAttribute("src",i))}tn&&console.log("src",this.getAttribute("src"));const t=this._loadId;setTimeout(()=>{this.isConnected!==!1&&t===this._loadId&&this.onLoad()},1),ol!=null&&ol.length&&this.setAttribute("version",ol)}disconnectedCallback(){var s;this.removeEventListener("xr-session-started",this.onXRSessionStarted),this._didFullyLoad=!1;const t=this.getAttribute("keep-alive"),i=t==null||(t==null?void 0:t.length)>0&&t!=="true"&&t!=="1";tn&&console.warn('<needle-engine> disconnected, keep-alive: "'+t+'"',typeof t,"Dispose=",i),i?(tn&&console.warn("<needle-engine> dispose"),(s=this._context)==null||s.dispose(),this._context=null,this._lastSourceFiles=null,this._loadId+=1):tn&&console.warn("<needle-engine> is not disposed because keep-alive is set")}attributeChangedCallback(t,i,s){switch(tn&&console.log("attributeChangedCallback",t,i,s),t){case"src":tn&&console.warn("src changed to type:",typeof s,', from "',i,'" to "',s,'"'),this.onLoad();break;case"hash":this._context&&(this._context.hash=s);break;case"loadstart":case"progress":case"loadfinished":typeof s=="string"&&s.length>0&&(tn&&console.log(t+" attribute changed",s),this.registerEventFromAttribute(t,s));break;case"dracoDecoderPath":tn&&console.log("dracoDecoderPath",s),sO(s);break;case"dracoDecoderType":s==="wasm"||s==="js"?(tn&&console.log("dracoDecoderType",s),rO(s)):console.error("Invalid dracoDecoderType",s,"expected js or wasm");break;case"ktx2DecoderPath":tn&&console.log("ktx2DecoderPath",s),oO(s);break}}async onLoad(){var p,m;if(!this.isConnected)return;if(this._context||(tn&&console.warn("Create new context"),this._context=new Lt({domElement:this})),!this._context){console.error("Needle Engine: Context not initialized");return}const t=this.getSourceFiles();if(t==null||t.length<=0)tn&&console.warn("Clear scene",t),this._context.clear();else if(!this.checkIfSourceHasChanged(t,this._lastSourceFiles))return;this._lastSourceFiles=t;const i=++this._loadId,s=this.getAttribute("alias");this.classList.add("loading");const r=td();this.ensureLoadStartIsRegistered();let o=this.dispatchEvent(new CustomEvent("loadstart",{detail:{context:this._context,alias:s},cancelable:!0}));if(r){const g=this.getAttribute("hide-loading-overlay");g!=null&&g!=="0"&&(o=!1)}o===!1&&!r&&(Tt()||(o=!0),console.warn("Needle Engine: You need a commercial license to override the default loading view. Visit https://needle.tools/pricing"),Tt()&&gn('You need a <a target="_blank" href="https://needle.tools/pricing">commercial license</a> to override the default loading view. This will not work in production.')),!this._loadingView&&o&&(this._loadingView=new G0(this)),o&&(this._didFullyLoad!==!0?(p=this._loadingView)==null||p.onLoadingBegin("begin load"):setTimeout(()=>{this._loadingView&&this._loadingProgress01<.3&&this._loadId===i&&this._loadingView.onLoadingBegin("begin load")},300)),tn&&console.warn("--------------",i,"Needle Engine: Begin loading",s??"",t),this.onBeforeBeginLoading();const a=[],c={context:this._context,name:"",progress:{},index:0,count:t.length,totalProgress01:this._loadingProgress01},l=new CustomEvent("progress",{detail:c}),h=new Array,d={files:t,onLoadingProgress:g=>{var A;const y=g.index;!h[y]&&g.name&&(h[y]=coe(g.name)),g.name=h[y],o&&((A=this._loadingView)==null||A.onLoadingUpdate(g)),c.name=g.name,c.progress=g.progress,this._loadingProgress01=Q3(g),c.totalProgress01=this._loadingProgress01,this.dispatchEvent(l)},onLoadingFinished:(g,y,A)=>{A&&a.push({src:y,file:A})}},f=this.getAttribute("hash");f!=null&&(this._context.hash=f),this._context.alias=s,await this._context.create(d),this._loadId===i&&(tn&&console.warn("--------------",i,"Needle Engine: finished loading",s??"",t),this._loadingProgress01=1,o&&((m=this._loadingView)==null||m.onLoadingUpdate(1,"creating scene")),this._didFullyLoad=!0,this.classList.remove("loading"),this.classList.add("loading-finished"),this.dispatchEvent(new CustomEvent("loadfinished",{detail:{context:this._context,src:s,loadedFiles:a}})))}internalSetLoadingMessage(t){var i;(i=this._loadingView)==null||i.setMessage(t)}getSourceFiles(){const t=this.getAttribute("src");if(!t)return[];let i;Array.isArray(t)?i=t:t.startsWith("[")&&t.endsWith("]")?i=JSON.parse(t):t.includes(",")?i=t.split(","):i=[t];for(let s=i.length-1;s>=0;s--){const r=i[s];(r==="null"||r==="undefined"||(r==null?void 0:r.length)<=0)&&i.splice(s,1)}return i}checkIfSourceHasChanged(t,i){if((t==null?void 0:t.length)!==(i==null?void 0:i.length)||t==null&&i!==null||t!==null&&i==null)return!0;if(t!==null&&i!==null){for(let s=0;s<(t==null?void 0:t.length);s++)if(t[s]!==i[s])return!0}return!1}ensureLoadStartIsRegistered(){const t=this.getAttribute("loadstart");t&&this.registerEventFromAttribute("loadstart",t)}registerEventFromAttribute(t,i){const s=this._previouslyRegisteredMap.get(t);if(s&&(this._previouslyRegisteredMap.delete(t),this.removeEventListener(t,s)),typeof i=="string"&&i.length>0)try{const r=(0,eval)(i);typeof r=="function"&&(this._previouslyRegisteredMap.set(t,r),this.addEventListener(t,o=>r==null?void 0:r.call(globalThis,this._context,o)))}catch(r){console.error("Error registering event "+t+'="'+i+`" failed with the following error:
`,r)}}getAROverlayContainer(){return this._overlay_ar.createOverlayContainer(this)}getVROverlayContainer(){for(let t=0;t<this.children.length;t++){const i=this.children[t];if(i.classList.contains("vr"))return i}return null}onEnterAR(t){var s;this.onSetupAR();const i=this.getAROverlayContainer();this._overlay_ar.onBegin(this._context,i,t),this.dispatchEvent(new CustomEvent("enter-ar",{detail:{session:t,context:this._context,htmlContainer:(s=this._overlay_ar)==null?void 0:s.ARContainer}}))}onExitAR(t){var i;this._overlay_ar.onEnd(this._context),this.onSetupDesktop(),this.dispatchEvent(new CustomEvent("exit-ar",{detail:{session:t,context:this._context,htmlContainer:(i=this._overlay_ar)==null?void 0:i.ARContainer}}))}onEnterVR(t){this.onSetupVR(),this.dispatchEvent(new CustomEvent("enter-vr",{detail:{session:t,context:this._context}}))}onExitVR(t){this.onSetupDesktop(),this.dispatchEvent(new CustomEvent("exit-vr",{detail:{session:t,context:this._context}}))}onSetupAR(){this.classList.add(Vm),this.classList.remove(Hm);const t=this.getAROverlayContainer();tn&&console.warn("onSetupAR:",t),t&&(t.classList.add(Vm),t.classList.remove(Hm)),this.foreachHtmlElement(i=>this.setupElementsForMode(i,j3))}onSetupVR(){this.classList.remove(Vm),this.classList.remove(Hm),this.foreachHtmlElement(t=>this.setupElementsForMode(t,PG))}onSetupDesktop(){this.classList.remove(Vm),this.classList.add(Hm);const t=this.getAROverlayContainer();t&&(t.classList.remove(Vm),t.classList.add(Hm)),this.foreachHtmlElement(i=>this.setupElementsForMode(i,BG))}setupElementsForMode(t,i,s=null){var o,a;if(t===((a=(o=this._context)==null?void 0:o.renderer)==null?void 0:a.domElement)||t.id==="VRButton"||t.id==="ARButton")return;if(t.classList.contains(i))t.style.visibility="visible",t.style.display==="none"&&(t.style.display="block");else for(const c of ooe)t.classList.contains(c)&&(t.style.visibility="hidden",t.style.display="none")}foreachHtmlElement(t){for(let i=0;i<this.children.length;i++){const s=this.children[i];s.style&&t(s)}}onBeforeBeginLoading(){const t=this.getAttribute("dracoDecoderPath");t&&(tn&&console.log("using custom draco decoder path",t),sO(t));const i=this.getAttribute("dracoDecoderType");i&&(tn&&console.log("using custom draco decoder type",i),rO(i));const s=this.getAttribute("ktx2DecoderPath");s&&(tn&&console.log("using custom ktx2 decoder path",s),oO(s))}}typeof window<"u"&&!window.customElements.get(aL)&&window.customElements.define(aL,DG);function coe(n){const e=n.split("/");let t=e[e.length-1];const i=t.indexOf("?");i>0&&(t=t.substring(0,i));const s=t.split(".").pop();if((s==="glb"||s==="gltf")&&(t=t.substring(0,t.length-4)),t=decodeURIComponent(t),t.length>3){let r="";for(let o=0;o<t.length;o++){let a=t[o];if(a===" "&&r.length<=0)continue;const c=r.length===0;c==!1&&a===a.toUpperCase()?r+=" "+a:(c&&(a=a.toUpperCase()),r+=a)}return tn&&console.log("displayName",t,r),r}return tn&&console.log("displayName",t),t}const loe=Object.freeze(Object.defineProperty({__proto__:null,NeedleEngineHTMLElement:DG},Symbol.toStringTag,{value:"Module"}));re("debughotreload");const hoe=re("debugphysics");re("debugcolliderplacement");re("debugcollisions");re("showcolliders");re("debugraycasts");globalThis.false=globalThis.false!==void 0?globalThis.false:!0;hoe&&console.log("Use Rapier",!1,globalThis.false);Object.defineProperty(Wt.prototype,"fov",{get:function(){return this._fov},set:function(n){const e=n!==this._fov;this._fov=n,e&&this.view!==void 0&&this.updateProjectionMatrix()}});Object.defineProperty(Wt.prototype,"near",{get:function(){return this._near},set:function(n){const e=n!==this._near;this._near=n,e&&this.view!==void 0&&this.updateProjectionMatrix()}});Object.defineProperty(Wt.prototype,"far",{get:function(){return this._far},set:function(n){const e=n!==this._far;this._far=n,e&&this.view!==void 0&&this.updateProjectionMatrix()}});const h_=re("debugmissingcamera");zi.registerCallback(Cn.MissingCamera,n=>{var r,o,a;h_&&console.warn("Creating missing camera");const e=n.context.scene,t=new ge;t.name="Default Fallback Camera",e.add(t);const i=new Di;i.sourceId=((o=(r=n.files)==null?void 0:r[0])==null?void 0:o.src)??"unknown",(a=n.context.domElement.getAttribute("skybox-image"))!=null&&a.length||0>0||n.context.lightmaps.tryGetSkybox(i.sourceId)?i.clearFlags=Mo.Skybox:i.clearFlags=Mo.SolidColor,i.backgroundColor=new Ii(.5,.5,.5,1),i.fieldOfView=35,i.backgroundBlurriness=.2;const s=wd(t,i,!0);return t.position.x=0,t.position.y=1,t.position.z=2,OG(n.context,s),s});zi.registerCallback(Cn.ContextCreated,n=>{if(!n.context.mainCamera){h_&&console.log("Will not auto-fit because a default camera exists");return}const e=n.context.domElement;if((e==null?void 0:e.cameraControls)===!0){const t=ote(n.context.mainCamera);if((t==null?void 0:t.isCameraController)===!0){h_&&console.log("Will not auto-fit because a camera controller exists");return}OG(n.context)}});function OG(n,e){e=e??n.mainCameraComponent;const t=e==null?void 0:e.gameObject;if(h_&&console.log("Creating default camera controls",e==null?void 0:e.name),t){const i=oI(t,$i);i.sourceId=(e==null?void 0:e.sourceId)??"unknown";const s=n.domElement.getAttribute("auto-rotate");i.autoRotate=s!==void 0&&(s===""||s==="true"),i.autoRotateSpeed=.5;const r=n,o=()=>{r.pre_render_callbacks.splice(r.pre_render_callbacks.indexOf(o),1),i.fitCamera()};r.pre_render_callbacks.push(o)}else console.warn("Missing camera object, can not add orbit controls")}const aR={Context:Lt,glTF:{loadFromURL:IG}};globalThis.Needle!==void 0&&console.warn("Needle Engine is already imported");globalThis.Needle=aR;function kG(n){for(const e in n)aR[e]=n[e]}kG(h$);kG(Kre);for(const n of Object.getOwnPropertyNames(le))switch(n){case"prototype":case"constructor":case"length":case"name":continue;default:aR[n]=le[n];break}globalThis.THREE?console.warn("Threejs is already imported"):globalThis.THREE=WW;var uoe=Object.defineProperty,doe=Object.getOwnPropertyDescriptor,foe=(n,e,t,i)=>{for(var s=i>1?void 0:i?doe(e,t):e,r=n.length-1,o;r>=0;r--)(o=n[r])&&(s=(i?o(e,t,s):o(s))||s);return i&&s&&uoe(e,t,s),s};class LG extends Te{constructor(){super(...arguments);u(this,"fpsText");u(this,"deltaTime",0)}update(){this.deltaTime+=(this.context.time.deltaTime-this.deltaTime)*.1;const t=1/this.deltaTime;this.fpsText!==void 0&&(this.fpsText.text="FPS : "+Math.round(t))}}foe([x(er)],LG.prototype,"fpsText",2);var poe=Object.defineProperty,moe=Object.getOwnPropertyDescriptor,Hl=(n,e,t,i)=>{for(var s=i>1?void 0:i?moe(e,t):e,r=n.length-1,o;r>=0;r--)(o=n[r])&&(s=(i?o(e,t,s):o(s))||s);return i&&s&&poe(e,t,s),s};class Mc extends Te{constructor(){super(...arguments);u(this,"card1");u(this,"card2");u(this,"cardaniation");u(this,"cardsnumber",144);u(this,"currentcard",0);u(this,"animation");u(this,"timer1",0);u(this,"timer2",0);u(this,"startPosition1");u(this,"startPosition2");u(this,"endcardstopimage",null);u(this,"cardtochange",null);u(this,"cardsfaces",null)}onEnable(){this.timer1=0,this.timer2=0,this.startPosition1=this.card1?this.card1.position.clone():void 0,this.startPosition2=this.card2?this.card2.position.clone():void 0}update(){if(this.timer1+=this.context.time.deltaTime,this.timer1>=1&&this.card1){this.currentcard=Math.floor(Math.random()*this.cardsfaces.length);const t=this.card1.position.clone();this.cardtochange.sprite=this.cardsfaces[this.currentcard],t.y-=198e-6,this.card1.position.copy(t),this.timer1=0,t.y<=-.063&&(this.card1.position.setY(-.063),this.gameObject&&(this.gameObject.active=!1))}if(this.timer2+=this.context.time.deltaTime,this.timer2>=2&&this.card2){const t=this.card2.position.clone();t.y+=404e-6,this.endcardstopimage.sprite=this.cardsfaces[this.currentcard],this.card2.position.copy(t),this.timer2=0,t.y>=.056&&this.card2.position.setY(.056)}}onDisable(){this.card1&&this.startPosition1&&this.card1.position.copy(this.startPosition1),this.card2&&this.startPosition2&&this.card2.position.copy(this.startPosition2)}}Hl([x(ge)],Mc.prototype,"card1",2);Hl([x(ge)],Mc.prototype,"card2",2);Hl([x(ge)],Mc.prototype,"cardaniation",2);Hl([x()],Mc.prototype,"cardsnumber",2);Hl([x()],Mc.prototype,"currentcard",2);Hl([x(Nr)],Mc.prototype,"animation",2);Hl([x(Ll)],Mc.prototype,"endcardstopimage",2);Hl([x(Ll)],Mc.prototype,"cardtochange",2);Hl([x(Tc)],Mc.prototype,"cardsfaces",2);var goe=Object.defineProperty,Aoe=Object.getOwnPropertyDescriptor,Bv=(n,e,t,i)=>{for(var s=i>1?void 0:i?Aoe(e,t):e,r=n.length-1,o;r>=0;r--)(o=n[r])&&(s=(i?o(e,t,s):o(s))||s);return i&&s&&goe(e,t,s),s};class am extends Te{constructor(){super(...arguments);u(this,"textComponent");u(this,"imageComponent");u(this,"textList",[]);u(this,"imageField",null);u(this,"images",null);u(this,"timer",0);u(this,"currentIndex",0)}onEnable(){this.timer=0,this.currentIndex=0,this.startCoroutine(this.updateTextAndImage())}*updateTextAndImage(){for(;;)this.timer+=this.context.time.deltaTime,this.timer>=2&&this.textComponent&&this.imageComponent&&(this.timer=0,this.currentIndex=(this.currentIndex+1)%Math.min(this.textList.length,5),this.displayTextAndImage(),this.changeFontSize(),yield $F(2)),yield}displayTextAndImage(){if(this.textList.length>0&&this.textComponent){const t=Math.floor(Math.random()*this.textList.length);this.textComponent.text=this.textList[t]}if(this.images&&this.imageComponent){const t=Math.floor(Math.random()*this.images.length);this.imageComponent.sprite=this.images[t]}}changeFontSize(){if(this.textComponent){const t=Math.floor(Math.random()*31)+10;this.textComponent.fontSize=t}}}Bv([x(er)],am.prototype,"textComponent",2);Bv([x(Ll)],am.prototype,"imageComponent",2);Bv([x(String)],am.prototype,"textList",2);Bv([x(Ll)],am.prototype,"imageField",2);Bv([x(Tc)],am.prototype,"images",2);ee.add("FPSDisplay",LG);ee.add("StartCard",Mc);ee.add("TextImageCycle",am);const cR=new Array;globalThis["needle:codegen_files"]=cR;cR.push("assets/scene.glb?v=1708089998680");document.addEventListener("DOMContentLoaded",()=>{const n=document.querySelector("needle-engine");n&&n.getAttribute("src")===null&&(n.setAttribute("hash","1708089998680"),n.setAttribute("src",JSON.stringify(cR)))});console.log("Made with  by  Needle - https://needle.tools  Version 3.32.21-exp");export{Nr as A,GM as C,Gh as I,pd as N,qt as P,xl as Q,cc as S,Vh as V,ud as a};
